/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
(function(){var c="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},h="undefined"!==typeof module&&module.exports,f="undefined"!==typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,g=function(){for(var a,e=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),
"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],d=0,f=e.length,k={};d<f;d++)if((a=e[d])&&a[1]in c){for(d=0;d<a.length;d++)k[e[0][d]]=
a[d];return k}return!1}(),d={change:g.fullscreenchange,error:g.fullscreenerror},a={request:function(a){var b=g.requestFullscreen;a=a||c.documentElement;if(/5\.1[.\d]* Safari/.test(navigator.userAgent))a[b]();else a[b](f&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){c[g.exitFullscreen]()},toggle:function(a){this.isFullscreen?this.exit():this.request(a)},onchange:function(a){this.on("change",a)},onerror:function(a){this.on("error",a)},on:function(a,e){var b=d[a];b&&c.addEventListener(b,e,!1)},off:function(a,
e){var b=d[a];b&&c.removeEventListener(b,e,!1)},raw:g};g?(Object.defineProperties(a,{isFullscreen:{get:function(){return!!c[g.fullscreenElement]}},element:{enumerable:!0,get:function(){return c[g.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!c[g.fullscreenEnabled]}}}),h?module.exports=a:window.screenfull=a):h?module.exports=!1:window.screenfull=!1})();
(function(){function c(a){a=String(a);return a.charAt(0).toUpperCase()+a.slice(1)}function h(a,b){var e=-1,d=a?a.length:0;if("number"==typeof d&&-1<d&&d<=w)for(;++e<d;)b(a[e],e,a);else g(a,b)}function f(a){a=String(a).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(a)?a:c(a)}function g(a,b){for(var e in a)r.call(a,e)&&b(a[e],e,a)}function d(a){return null==a?c(a):B.call(a).slice(8,-1)}function a(a,b){var e=null!=a?typeof a[b]:"number";return!/^(?:boolean|number|string|undefined)$/.test(e)&&
("object"==e?!!a[b]:!0)}function b(a){return String(a).replace(/([ -])(?!$)/g,"$1?")}function e(a,b){var e=null;h(a,function(d,l){e=b(e,d,l,a)});return e}function l(c){function m(a){return e(a,function(a,e){var d=e.pattern||b(e);!a&&(a=RegExp("\\b"+d+" *\\d+[.\\w_]*","i").exec(c)||RegExp("\\b"+d+" *\\w+-[\\w]*","i").exec(c)||RegExp("\\b"+d+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(c))&&((a=String(e.label&&!RegExp(d,"i").test(e.label)?e.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=
" "+a[1]),e=e.label||e,a=f(a[0].replace(RegExp(d,"i"),e).replace(RegExp("; *(?:"+e+"[_-])?","i")," ").replace(RegExp("("+e+")[-_.]?(\\w)","i"),"$1 $2")));return a})}function h(a){return e(a,function(a,b){return a||(RegExp(b+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(c)||0)[1]||null})}var p=k,q=c&&"object"==typeof c&&"String"!=d(c);q&&(p=c,c=null);var w=p.navigator||{},r=w.userAgent||"";c||(c=r);var E=q?!!w.likeChrome:/\bChrome\b/.test(c)&&!/internal|\n/i.test(B.toString()),
A=q?"Object":"ScriptBridgingProxyObject",L=q?"Object":"Environment",H=q&&p.java?"JavaPackage":d(p.java),Q=q?"Object":"RuntimeObject";L=(H=/\bJava/.test(H)&&p.java)&&d(p.environment)==L;var R=H?"a":"\u03b1",S=H?"b":"\u03b2",M=p.document||{},F=p.operamini||p.opera,I=v.test(I=q&&F?F["[[Class]]"]:d(F))?I:F=null,n,J=c;q=[];var K=null,G=c==r;r=G&&F&&"function"==typeof F.version&&F.version();var x=function(a){return e(a,function(a,e){return a||RegExp("\\b"+(e.pattern||b(e))+"\\b","i").exec(c)&&(e.label||
e)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),t=function(a){return e(a,function(a,e){return a||RegExp("\\b"+(e.pattern||b(e))+"\\b","i").exec(c)&&(e.label||e)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),y=m([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(a){return e(a,function(a,e,d){return a||(e[y]||e[/^[a-z]+(?: +[a-z]+\b)*/i.exec(y)]||RegExp("\\b"+b(d)+"(?:\\b|\\w*\\d)","i").exec(c))&&d})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),u=function(a){return e(a,function(a,e){var d=e.pattern||b(e);if(!a&&(a=RegExp("\\b"+d+"(?:/[\\d.]+|[ \\w.]*)","i").exec(c))){var l=a,k=e.label||e,m={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};d&&k&&/^Win/i.test(l)&&!/^Windows Phone /i.test(l)&&(m=m[/[\d.]+$/.exec(l)])&&(l="Windows "+m);l=String(l);d&&k&&(l=l.replace(RegExp(d,"i"),k));a=l=f(l.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/,
" $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return a})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac",
"Windows 98;","Windows "]);x&&(x=[x]);D&&!y&&(y=m([D]));if(n=/\bGoogle TV\b/.exec(y))y=n[0];/\bSimulator\b/i.test(c)&&(y=(y?y+" ":"")+"Simulator");"Opera Mini"==t&&/\bOPiOS\b/.test(c)&&q.push("running in Turbo/Uncompressed mode");"IE"==t&&/\blike iPhone OS\b/.test(c)?(n=l(c.replace(/like iPhone OS/,"")),D=n.manufacturer,y=n.product):/^iP/.test(y)?(t||(t="Safari"),u="iOS"+((n=/ OS ([\d_]+)/i.exec(c))?" "+n[1].replace(/_/g,"."):"")):"Konqueror"!=t||/buntu/i.test(u)?D&&"Google"!=D&&(/Chrome/.test(t)&&
!/\bMobile Safari\b/i.test(c)||/\bVita\b/.test(y))||/\bAndroid\b/.test(u)&&/^Chrome/.test(t)&&/\bVersion\//i.test(c)?(t="Android Browser",u=/\bAndroid\b/.test(u)?u:"Android"):"Silk"==t?(/\bMobi/i.test(c)||(u="Android",q.unshift("desktop mode")),/Accelerated *= *true/i.test(c)&&q.unshift("accelerated")):"PaleMoon"==t&&(n=/\bFirefox\/([\d.]+)\b/.exec(c))?q.push("identifying as Firefox "+n[1]):"Firefox"==t&&(n=/\b(Mobile|Tablet|TV)\b/i.exec(c))?(u||(u="Firefox OS"),y||(y=n[1])):!t||(n=!/\bMinefield\b/i.test(c)&&
/\b(?:Firefox|Safari)\b/.exec(t))?(t&&!y&&/[\/,]|^[^(]+?\)/.test(c.slice(c.indexOf(n+"/")+8))&&(t=null),(n=y||D||u)&&(y||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(u))&&(t=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(u)?u:n)+" Browser")):"Electron"==t&&(n=(/\bChrome\/([\d.]+)\b/.exec(c)||0)[1])&&q.push("Chromium "+n):u="Kubuntu";r||(r=h(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",b(t),"(?:Firefox|Minefield|NetFront)"]));
if(n="iCab"==x&&3<parseFloat(r)&&"WebKit"||/\bOpera\b/.test(t)&&(/\bOPR\b/.test(c)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(c)&&!/^(?:Trident|EdgeHTML)$/.test(x)&&"WebKit"||!x&&/\bMSIE\b/i.test(c)&&("Mac OS"==u?"Tasman":"Trident")||"WebKit"==x&&/\bPlayStation\b(?! Vita\b)/i.test(t)&&"NetFront")x=[n];"IE"==t&&(n=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(c)||0)[1])?(t+=" Mobile",u="Windows Phone "+(/\+$/.test(n)?n:n+".x"),q.unshift("desktop mode")):/\bWPDesktop\b/i.test(c)?(t="IE Mobile",u="Windows Phone 8.x",
q.unshift("desktop mode"),r||(r=(/\brv:([\d.]+)/.exec(c)||0)[1])):"IE"!=t&&"Trident"==x&&(n=/\brv:([\d.]+)/.exec(c))&&(t&&q.push("identifying as "+t+(r?" "+r:"")),t="IE",r=n[1]);if(G){if(a(p,"global"))if(H&&(n=H.lang.System,J=n.getProperty("os.arch"),u=u||n.getProperty("os.name")+" "+n.getProperty("os.version")),L){try{r=p.require("ringo/engine").version.join("."),t="RingoJS"}catch(P){(n=p.system)&&n.global.system==p.system&&(t="Narwhal",u||(u=n[0].os||null))}t||(t="Rhino")}else"object"==typeof p.process&&
!p.process.browser&&(n=p.process)&&("object"==typeof n.versions&&("string"==typeof n.versions.electron?(q.push("Node "+n.versions.node),t="Electron",r=n.versions.electron):"string"==typeof n.versions.nw&&(q.push("Chromium "+r,"Node "+n.versions.node),t="NW.js",r=n.versions.nw)),t||(t="Node.js",J=n.arch,u=n.platform,r=(r=/[\d.]+/.exec(n.version))?r[0]:null));else d(n=p.runtime)==A?(t="Adobe AIR",u=n.flash.system.Capabilities.os):d(n=p.phantom)==Q?(t="PhantomJS",r=(n=n.version||null)&&n.major+"."+n.minor+
"."+n.patch):"number"==typeof M.documentMode&&(n=/\bTrident\/(\d+)/i.exec(c))?(r=[r,M.documentMode],(n=+n[1]+4)!=r[1]&&(q.push("IE "+r[1]+" mode"),x&&(x[1]=""),r[1]=n),r="IE"==t?String(r[1].toFixed(1)):r[0]):"number"==typeof M.documentMode&&/^(?:Chrome|Firefox)\b/.test(t)&&(q.push("masking as "+t+" "+r),t="IE",r="11.0",x=["Trident"],u="Windows");u=u&&f(u)}r&&(n=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(r)||/(?:alpha|beta)(?: ?\d)?/i.exec(c+";"+(G&&w.appMinorVersion))||/\bMinefield\b/i.test(c)&&
"a")&&(K=/b/i.test(n)?"beta":"alpha",r=r.replace(RegExp(n+"\\+?$"),"")+("beta"==K?S:R)+(/\d+\+?/.exec(n)||""));if("Fennec"==t||"Firefox"==t&&/\b(?:Android|Firefox OS)\b/.test(u))t="Firefox Mobile";else if("Maxthon"==t&&r)r=r.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(y))"Xbox 360"==y&&(u=null),"Xbox 360"==y&&/\bIEMobile\b/.test(c)&&q.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(t)&&(!t||y||/Browser|Mobi/.test(t))||"Windows CE"!=u&&!/Mobi/i.test(c))if("IE"==t&&G)try{null===p.external&&
q.unshift("platform preview")}catch(P){q.unshift("embedded")}else(/\bBlackBerry\b/.test(y)||/\bBB10\b/.test(c))&&(n=(RegExp(y.replace(/ +/g," *")+"/([.\\d]+)","i").exec(c)||0)[1]||r)?(n=[n,/BB10/.test(c)],u=(n[1]?(y=null,D="BlackBerry"):"Device Software")+" "+n[0],r=null):this!=g&&"Wii"!=y&&(G&&F||/Opera/.test(t)&&/\b(?:MSIE|Firefox)\b/i.test(c)||"Firefox"==t&&/\bOS X (?:\d+\.){2,}/.test(u)||"IE"==t&&(u&&!/^Win/.test(u)&&5.5<r||/\bWindows XP\b/.test(u)&&8<r||8==r&&!/\bTrident\b/.test(c)))&&!v.test(n=
l.call(g,c.replace(v,"")+";"))&&n.name&&(n="ing as "+n.name+((n=n.version)?" "+n:""),v.test(t)?(/\bIE\b/.test(n)&&"Mac OS"==u&&(u=null),n="identify"+n):(n="mask"+n,t=I?f(I.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(n)&&(u=null),G||(r=null)),x=["Presto"],q.push(n));else t+=" Mobile";if(n=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(c)||0)[1]){n=[parseFloat(n.replace(/\.(\d)$/,".0$1")),n];if("Safari"==t&&"+"==n[1].slice(-1))t="WebKit Nightly",K="alpha",r=n[1].slice(0,-1);else if(r==n[1]||r==(n[2]=
(/\bSafari\/([\d.]+\+?)/i.exec(c)||0)[1]))r=null;n[1]=(/\bChrome\/([\d.]+)/i.exec(c)||0)[1];537.36==n[0]&&537.36==n[2]&&28<=parseFloat(n[1])&&"WebKit"==x&&(x=["Blink"]);G&&(E||n[1])?(x&&(x[1]="like Chrome"),n=n[1]||(n=n[0],530>n?1:532>n?2:532.05>n?3:533>n?4:534.03>n?5:534.07>n?6:534.1>n?7:534.13>n?8:534.16>n?9:534.24>n?10:534.3>n?11:535.01>n?12:535.02>n?"13+":535.07>n?15:535.11>n?16:535.19>n?17:536.05>n?18:536.1>n?19:537.01>n?20:537.11>n?"21+":537.13>n?23:537.18>n?24:537.24>n?25:537.36>n?26:"Blink"!=
x?"27":"28")):(x&&(x[1]="like Safari"),n=(n=n[0],400>n?1:500>n?2:526>n?3:533>n?4:534>n?"4+":535>n?5:537>n?6:538>n?7:601>n?8:"8"));x&&(x[1]+=" "+(n+="number"==typeof n?".x":/[.+]/.test(n)?"":"+"));"Safari"==t&&(!r||45<parseInt(r))&&(r=n)}"Opera"==t&&(n=/\bzbov|zvav$/.exec(u))?(t+=" ",q.unshift("desktop mode"),"zvav"==n?(t+="Mini",r=null):t+="Mobile",u=u.replace(RegExp(" *"+n+"$"),"")):"Safari"==t&&/\bChrome\b/.exec(x&&x[1])&&(q.unshift("desktop mode"),t="Chrome Mobile",r=null,/\bOS X\b/.test(u)?(D=
"Apple",u="iOS 4.3+"):u=null);r&&0==r.indexOf(n=/[\d.]+$/.exec(u))&&-1<c.indexOf("/"+n+"-")&&(u=String(u.replace(n,"")).replace(/^ +| +$/g,""));x&&!/\b(?:Avant|Nook)\b/.test(t)&&(/Browser|Lunascape|Maxthon/.test(t)||"Safari"!=t&&/^iOS/.test(u)&&/\bSafari\b/.test(x[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(t)&&x[1])&&(n=x[x.length-1])&&q.push(n);q.length&&(q=["("+q.join("; ")+")"]);D&&y&&0>y.indexOf(D)&&q.push("on "+D);y&&q.push((/^on /.test(q[q.length-
1])?"":"on ")+y);if(u){var O=(n=/ ([\d.+]+)$/.exec(u))&&"/"==u.charAt(u.length-n[0].length-1);u={architecture:32,family:n&&!O?u.replace(n[0],""):u,version:n?n[1]:null,toString:function(){var a=this.version;return this.family+(a&&!O?" "+a:"")+(64==this.architecture?" 64-bit":"")}}}(n=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(J))&&!/\bi686\b/i.test(J)?(u&&(u.architecture=64,u.family=u.family.replace(RegExp(" *"+n),"")),t&&(/\bWOW64\b/i.test(c)||G&&/\w(?:86|32)$/.test(w.cpuClass||w.platform)&&!/\bWin64; x64\b/i.test(c))&&
q.unshift("32-bit")):u&&/^OS X/.test(u.family)&&"Chrome"==t&&39<=parseFloat(r)&&(u.architecture=64);c||(c=null);p={};p.description=c;p.layout=x&&x[0];p.manufacturer=D;p.name=t;p.prerelease=K;p.product=y;p.ua=c;p.version=t&&r;p.os=u||{architecture:null,family:null,version:null,toString:function(){return"null"}};p.parse=l;p.toString=function(){return this.description||""};p.version&&q.unshift(r);p.name&&q.unshift(t);u&&t&&(u!=String(u).split(" ")[0]||u!=t.split(" ")[0]&&!y)&&q.push(y?"("+u+")":"on "+
u);q.length&&(p.description=q.join(" "));return p}var m={"function":!0,object:!0},k=m[typeof window]&&window||this,p=m[typeof exports]&&exports;m=m[typeof module]&&module&&!module.nodeType&&module;var q=p&&m&&"object"==typeof global&&global;!q||q.global!==q&&q.window!==q&&q.self!==q||(k=q);var w=Math.pow(2,53)-1,v=/\bOpera/;q=Object.prototype;var r=q.hasOwnProperty,B=q.toString,A=l();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(k.platform=A,define(function(){return A})):p&&
m?g(A,function(a,b){p[b]=a}):k.platform=A}).call(this);
function buildIOSMeta(){for(var c=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],h=0;h<c.length;h++){var f=document.createElement("meta");f.name=c[h].name;f.content=c[h].content;var g=window.document.head.querySelector('meta[name="'+f.name+'"]');g&&g.parentNode.removeChild(g);window.document.head.appendChild(f)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;
case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}function iosInIframe(){try{return window.self!==window.top}catch(c){return!0}}$(document).ready(function(){platform&&"iPhone"===platform.product&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&!iosInIframe()&&iosResize()});
function CAreYouSurePanel(c){var h,f,g,d,a,b,e,l;this._init=function(c){b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=0;l=b.on("mousedown",function(){});s_oStage.addChild(b);(new createjs.Tween.get(b)).to({alpha:.7},500);e=new createjs.Container;s_oStage.addChild(e);c=s_oSpriteLibrary.getSprite("msg_box");var k=createBitmap(c);k.regX=c.width/2;k.regY=c.height/2;e.addChild(k);e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT+c.height/2;h=e.y;(new createjs.Tween.get(e)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.cubicOut);f=new createjs.Text(TEXT_ARE_SURE," 100px "+PRIMARY_FONT,"#000000");f.y=-c.height/2+120;f.textAlign="center";f.textBaseline="middle";f.lineWidth=600;f.outline=5;g=new createjs.Text(TEXT_ARE_SURE," 100px "+PRIMARY_FONT,"#ffffff");g.y=f.y;g.textAlign="center";g.textBaseline="middle";g.lineWidth=600;e.addChild(g);d=new CGfxButton(170,80,s_oSpriteLibrary.getSprite("but_yes"),e);d.addEventListener(ON_MOUSE_UP,this._onButYes,this);a=new CGfxButton(-170,80,s_oSpriteLibrary.getSprite("but_no"),
e);a.addEventListener(ON_MOUSE_UP,this._onButNo,this);a.pulseAnimation()};this._onButYes=function(){a.setClickable(!1);d.setClickable(!1);(new createjs.Tween.get(b)).to({alpha:0},500);(new createjs.Tween.get(e)).to({y:h},400,createjs.Ease.backIn).call(function(){m.unload();c()})};this._onButNo=function(){a.setClickable(!1);d.setClickable(!1);(new createjs.Tween.get(b)).to({alpha:0},500);(new createjs.Tween.get(e)).to({y:h},400,createjs.Ease.backIn).call(function(){m.unload()})};this.changeMessage=
function(a,b){f.text=a;g.text=a;b&&(f.font=" "+b+"px "+PRIMARY_FONT,g.font=" "+b+"px "+PRIMARY_FONT)};this.unload=function(){a.unload();d.unload();s_oStage.removeChild(b);s_oStage.removeChild(e);b.off("mousedown",l)};var m=this;this._init(c)}
!function(c){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=c();else if("function"==typeof define&&define.amd)define([],c);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.TreeModel=c()}}(function(){return function d(h,f,g){function a(e,m){if(!f[e]){if(!h[e]){var l="function"==typeof require&&require;if(!m&&l)return l(e,!0);if(b)return b(e,!0);l=Error("Cannot find module '"+e+"'");throw l.code="MODULE_NOT_FOUND",
l;}l=f[e]={exports:{}};h[e][0].call(l.exports,function(b){var d=h[e][1][b];return a(d?d:b)},l,l.exports,d,h,f,g)}return f[e].exports}for(var b="function"==typeof require&&require,e=0;e<g.length;e++)a(g[e]);return a}({1:[function(h,f,g){var d=h("mergesort");var a=h("find-insert-index");f.exports=function(){function b(a){this.config=a=a||{};this.config.childrenPropertyName=a.childrenPropertyName||"children";this.config.modelComparatorFn=a.modelComparatorFn}function e(a,b){this.config=a;this.model=b;
this.children=[]}function l(b,d,l){if(!(d instanceof e))throw new TypeError("Child must be of type Node.");d.parent=b;b.model[b.config.childrenPropertyName]instanceof Array||(b.model[b.config.childrenPropertyName]=[]);if("function"===typeof b.config.modelComparatorFn){var k=a(b.config.modelComparatorFn,b.model[b.config.childrenPropertyName],d.model);b.model[b.config.childrenPropertyName].splice(k,0,d.model);b.children.splice(k,0,d)}else if(void 0===l)b.model[b.config.childrenPropertyName].push(d.model),
b.children.push(d);else{if(0>l||l>b.children.length)throw Error("Invalid index.");b.model[b.config.childrenPropertyName].splice(l,0,d.model);b.children.splice(k,0,d)}return d}function f(){var a={};1===arguments.length?a.fn=arguments[0]:2===arguments.length?"function"===typeof arguments[0]?(a.fn=arguments[0],a.ctx=arguments[1]):(a.options=arguments[0],a.fn=arguments[1]):(a.options=arguments[0],a.fn=arguments[1],a.ctx=arguments[2]);a.options=a.options||{};a.options.strategy||(a.options.strategy="pre");
if(!k[a.options.strategy])throw Error("Unknown tree walk strategy. Valid strategies are 'pre' [default], 'post' and 'breadth'.");return a}var k={};b.prototype.parse=function(a){var b;if(!(a instanceof Object))throw new TypeError("Model must be of type object.");var l=new e(this.config,a);if(a[this.config.childrenPropertyName]instanceof Array){this.config.modelComparatorFn&&(a[this.config.childrenPropertyName]=d(this.config.modelComparatorFn,a[this.config.childrenPropertyName]));var k=0;for(b=a[this.config.childrenPropertyName].length;k<
b;k++){var f=l,m=this.parse(a[this.config.childrenPropertyName][k]);m.parent=f;f.children.push(m)}}return l};e.prototype.isRoot=function(){return void 0===this.parent};e.prototype.hasChildren=function(){return 0<this.children.length};e.prototype.addChild=function(a){return l(this,a)};e.prototype.addChildAtIndex=function(a,b){if("function"===typeof this.config.modelComparatorFn)throw Error("Cannot add child at index when using a comparator function.");return l(this,a,b)};e.prototype.getPath=function(){var a=
[];(function v(b){a.unshift(b);b.isRoot()||v(b.parent)})(this);return a};e.prototype.walk=function(){var a=f.apply(this,arguments);k[a.options.strategy].call(this,a.fn,a.ctx)};k.pre=function v(a,b){var e;var d=a.call(b,this);var l=0;for(e=this.children.length;l<e;l++){if(!1===d)return!1;d=v.call(this.children[l],a,b)}return d};k.post=function r(a,b){var e;var d=0;for(e=this.children.length;d<e;d++){var l=r.call(this.children[d],a,b);if(!1===l)return!1}return l=a.call(b,this)};k.breadth=function(a,
b){var e=[this];(function A(){var d;if(0!==e.length){var l=e.shift();var k=0;for(d=l.children.length;k<d;k++)e.push(l.children[k]);!1!==a.call(b,l)&&A()}})()};e.prototype.all=function(){var a=[];var b=f.apply(this,arguments);k[b.options.strategy].call(this,function(e){b.fn.call(b.ctx,e)&&a.push(e)},b.ctx);return a};e.prototype.first=function(){var a;var b=f.apply(this,arguments);k[b.options.strategy].call(this,function(e){if(b.fn.call(b.ctx,e))return a=e,!1},b.ctx);return a};e.prototype.drop=function(){if(!this.isRoot()){var a=
this.parent.children.indexOf(this);this.parent.children.splice(a,1);this.parent.model[this.config.childrenPropertyName].splice(a,1);this.parent=void 0;delete this.parent}return this};return b}()},{"find-insert-index":2,mergesort:3}],2:[function(h,f,g){f.exports=function(){return function(d,a,b){var e;var l=0;for(e=a.length;l<e&&!(0<d(a[l],b));l++);return l}}()},{}],3:[function(h,f,g){f.exports=function(){function d(a,b){var e=b.length;if(2<=e){var l=b.slice(0,e/2);e=b.slice(e/2,e);l=d(a,l);e=d(a,
e);for(var f=[],k=l.length,g=e.length;0<k&&0<g;)0>=a(l[0],e[0])?(f.push(l.shift()),k--):(f.push(e.shift()),g--);0<k?f.push.apply(f,l):f.push.apply(f,e);return f}return b.slice()}return d}()},{}]},{},[1])(1)});
function CTreeDecision(c){var h,f,g;this._init=function(d){h=[];for(var a=0;a<SEARCH_DEPTH+1;a++)h[a]=[];f=new TreeModel;g=f.parse(d);h[0][0]=g};this.getRoot=function(){return g};this.initNewNode=function(d){h[d].push(f.parse({rating:0,moves:[],depth:d}));return h[d][h[d].length-1]};this.addNode=function(d,a,b){var e=d+1,l=h[e].length-1;h[e][l].model.moves=b;h[e][l].model.rating=a;h[d][h[d].length-1].addChild(h[e][l])};this.rateNode=function(d,a){d.model.rating=a};this.getNode=function(d,a){return g.all(function(b){return b.model.rating===
d&&b.model.depth===a})};this.getPath=function(d){return d.getPath()};this.getTerminalNodes=function(){return g.all(function(d){return!d.hasChildren()})};this._init(c)}var s_iScaleFactor=1,s_bIsIphone=!1,s_iOffsetX,s_iOffsetY;
(function(c){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(c)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(c.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(c){console.log(c)}
function getSize(c){var h=c.toLowerCase(),f=window.document,g=f.documentElement;if(void 0===window["inner"+c])c=g["client"+c];else if(window["inner"+c]!=g["client"+c]){var d=f.createElement("body");d.id="vpw-test-b";d.style.cssText="overflow:scroll";var a=f.createElement("div");a.id="vpw-test-d";a.style.cssText="position:absolute;top:-1000px";a.innerHTML="<style>@media("+h+":"+g["client"+c]+"px){body#vpw-test-b div#vpw-test-d{"+h+":7px!important}}</style>";d.appendChild(a);g.insertBefore(d,f.head);
c=7==a["offset"+c]?g["client"+c]:window["inner"+c];g.removeChild(d)}else c=window["inner"+c];return c}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}
function isIOS(){var c="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");for(-1!==navigator.userAgent.toLowerCase().indexOf("iphone")&&(s_bIsIphone=!0);c.length;)if(navigator.platform===c.pop())return!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var c=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<c?c:0}
function playSound(c,h,f){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[c].play(),s_aSounds[c].volume(h),s_aSounds[c].loop(f),s_aSounds[c]):null}function stopSound(c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[c].stop()}function setVolume(c,h){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[c].volume(h)}function setMute(c,h){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[c].mute(h)}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var c=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var h=getSize("Width");_checkOrientation(h,c);var f=Math.min(c/CANVAS_HEIGHT,h/CANVAS_WIDTH),g=CANVAS_WIDTH*f;f*=CANVAS_HEIGHT;if(f<c){var d=c-f;f+=d;g+=CANVAS_WIDTH/CANVAS_HEIGHT*d}else g<h&&(d=h-g,g+=d,f+=CANVAS_HEIGHT/CANVAS_WIDTH*d);d=c/2-f/2;var a=h/2-g/2,b=CANVAS_WIDTH/g;if(a*b<-EDGEBOARD_X||d*b<-EDGEBOARD_Y)f=Math.min(c/(CANVAS_HEIGHT-2*
EDGEBOARD_Y),h/(CANVAS_WIDTH-2*EDGEBOARD_X)),g=CANVAS_WIDTH*f,f*=CANVAS_HEIGHT,d=(c-f)/2,a=(h-g)/2,b=CANVAS_WIDTH/g;s_iOffsetX=-1*a*b;s_iOffsetY=-1*d*b;0<=d&&(s_iOffsetY=0);0<=a&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oModeMenu&&s_oModeMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_bIsIphone?(canvas=document.getElementById("canvas"),s_oStage.canvas.width=2*g,s_oStage.canvas.height=
2*f,canvas.style.width=g+"px",canvas.style.height=f+"px",s_oStage.scaleX=s_oStage.scaleY=2*Math.min(g/CANVAS_WIDTH,f/CANVAS_HEIGHT)):s_bMobile||isChrome()?($("#canvas").css("width",g+"px"),$("#canvas").css("height",f+"px")):(s_oStage.canvas.width=g,s_oStage.canvas.height=f,s_iScaleFactor=Math.min(g/CANVAS_WIDTH,f/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor);0>d?$("#canvas").css("top",d+"px"):$("#canvas").css("top","0px");$("#canvas").css("left",a+"px");fullscreenHandler()}}
function _checkOrientation(c,h){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(c>h?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function createBitmap(c,h,f){var g=new createjs.Bitmap(c),d=new createjs.Shape;h&&f?d.graphics.beginFill("#fff").drawRect(0,0,h,f):d.graphics.beginFill("#ff0").drawRect(0,0,c.width,c.height);g.hitArea=d;return g}function createSprite(c,h,f,g,d,a){c=null!==h?new createjs.Sprite(c,h):new createjs.Sprite(c);h=new createjs.Shape;h.graphics.beginFill("#000000").drawRect(-f,-g,d,a);c.hitArea=h;return c}
function pad(c,h,f){c+="";return c.length>=h?c:Array(h-c.length+1).join(f||"0")+c}function randomFloatBetween(c,h,f){"undefined"===typeof f&&(f=2);return parseFloat(Math.min(c+Math.random()*(h-c),h).toFixed(f))}function rotateVector2D(c,h){var f=h.getX()*Math.cos(c)+h.getY()*Math.sin(c),g=h.getX()*-Math.sin(c)+h.getY()*Math.cos(c);h.set(f,g)}function tweenVectorsOnX(c,h,f){return c+f*(h-c)}
function shuffle(c){for(var h=c.length,f,g;0!==h;)g=Math.floor(Math.random()*h),--h,f=c[h],c[h]=c[g],c[g]=f;return c}function bubbleSort(c){do{var h=!1;for(var f=0;f<c.length-1;f++)c[f]>c[f+1]&&(h=c[f],c[f]=c[f+1],c[f+1]=h,h=!0)}while(h)}function compare(c,h){return c.index>h.index?-1:c.index<h.index?1:0}function easeLinear(c,h,f,g){return f*c/g+h}function easeInQuad(c,h,f,g){return f*(c/=g)*c+h}function easeInSine(c,h,f,g){return-f*Math.cos(c/g*(Math.PI/2))+f+h}
function easeInCubic(c,h,f,g){return f*(c/=g)*c*c+h}function getTrajectoryPoint(c,h){var f=new createjs.Point,g=(1-c)*(1-c),d=c*c;f.x=g*h.start.x+2*(1-c)*c*h.traj.x+d*h.end.x;f.y=g*h.start.y+2*(1-c)*c*h.traj.y+d*h.end.y;return f}function formatTime(c){c/=1E3;var h=Math.floor(c/60);c=Math.floor(c-60*h);var f="";f=10>h?f+("0"+h+":"):f+(h+":");return 10>c?f+("0"+c):f+c}function degreesToRadians(c){return c*Math.PI/180}
function checkRectCollision(c,h){var f=getBounds(c,.9);var g=getBounds(h,.98);return calculateIntersection(f,g)}function calculateIntersection(c,h){var f,g,d,a;var b=c.x+(f=c.width/2);var e=c.y+(g=c.height/2);var l=h.x+(d=h.width/2);var m=h.y+(a=h.height/2);b=Math.abs(b-l)-(f+d);e=Math.abs(e-m)-(g+a);return 0>b&&0>e?(b=Math.min(Math.min(c.width,h.width),-b),e=Math.min(Math.min(c.height,h.height),-e),{x:Math.max(c.x,h.x),y:Math.max(c.y,h.y),width:b,height:e,rect1:c,rect2:h}):null}
function getBounds(c,h){var f={x:Infinity,y:Infinity,width:0,height:0};if(c instanceof createjs.Container){f.x2=-Infinity;f.y2=-Infinity;var g=c.children,d=g.length,a;for(a=0;a<d;a++){var b=getBounds(g[a],1);b.x<f.x&&(f.x=b.x);b.y<f.y&&(f.y=b.y);b.x+b.width>f.x2&&(f.x2=b.x+b.width);b.y+b.height>f.y2&&(f.y2=b.y+b.height)}Infinity==f.x&&(f.x=0);Infinity==f.y&&(f.y=0);Infinity==f.x2&&(f.x2=0);Infinity==f.y2&&(f.y2=0);f.width=f.x2-f.x;f.height=f.y2-f.y;delete f.x2;delete f.y2}else{if(c instanceof createjs.Bitmap){d=
c.sourceRect||c.image;a=d.width*h;var e=d.height*h}else if(c instanceof createjs.Sprite)if(c.spriteSheet._frames&&c.spriteSheet._frames[c.currentFrame]&&c.spriteSheet._frames[c.currentFrame].image){d=c.spriteSheet.getFrame(c.currentFrame);a=d.rect.width;e=d.rect.height;g=d.regX;var l=d.regY}else f.x=c.x||0,f.y=c.y||0;else f.x=c.x||0,f.y=c.y||0;g=g||0;a=a||0;l=l||0;e=e||0;f.regX=g;f.regY=l;d=c.localToGlobal(0-g,0-l);b=c.localToGlobal(a-g,e-l);a=c.localToGlobal(a-g,0-l);g=c.localToGlobal(0-g,e-l);f.x=
Math.min(Math.min(Math.min(d.x,b.x),a.x),g.x);f.y=Math.min(Math.min(Math.min(d.y,b.y),a.y),g.y);f.width=Math.max(Math.max(Math.max(d.x,b.x),a.x),g.x)-f.x;f.height=Math.max(Math.max(Math.max(d.y,b.y),a.y),g.y)-f.y}return f}function NoClickDelay(c){this.element=c;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(c){for(var h=c.length,f,g;0<h;)g=Math.floor(Math.random()*h),h--,f=c[h],c[h]=c[g],c[g]=f;return c}
NoClickDelay.prototype={handleEvent:function(c){switch(c.type){case "touchstart":this.onTouchStart(c);break;case "touchmove":this.onTouchMove(c);break;case "touchend":this.onTouchEnd(c)}},onTouchStart:function(c){c.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(c){this.moved=!0},onTouchEnd:function(c){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){c=document.elementFromPoint(c.changedTouches[0].clientX,c.changedTouches[0].clientY);3==c.nodeType&&(c=c.parentNode);var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0);c.dispatchEvent(h)}}};
(function(){function c(c){var f={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};c=c||window.event;c.type in f?document.body.className=f[c.type]:(document.body.className=this[h]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var h="hidden";h in document?document.addEventListener("visibilitychange",c):(h="mozHidden")in document?document.addEventListener("mozvisibilitychange",c):(h="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",c):(h="msHidden")in document?document.addEventListener("msvisibilitychange",c):"onfocusin"in document?document.onfocusin=document.onfocusout=c:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=c})();function compareRow(c,h){return c.row>h.row?1:c.row<h.row?-1:0}function compareCol(c,h){return c.col>h.col?1:c.col<h.col?-1:0}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}
function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(c){for(var h=window.location.search.substring(1).split("&"),f=0;f<h.length;f++){var g=h[f].split("=");if(g[0]==c)return g[1]}}String.prototype.format=function(){for(var c=this,h=arguments.length;h--;)c=c.replace(new RegExp("\\{"+h+"\\}","gm"),arguments[h]);return c};
function fullscreenHandler(){ENABLE_FULLSCREEN&&!1!==screenfull.enabled&&(s_bFullscreen=screen.height<window.innerHeight+3&&screen.height>window.innerHeight-3?!0:!1,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oModeMenu&&s_oModeMenu.resetFullscreenBut())}
if(screenfull.enabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oModeMenu&&s_oModeMenu.resetFullscreenBut()});
function CSpriteLibrary(){var c,h,f,g,d,a;this.init=function(b,e,l){f=h=0;g=b;d=e;a=l;c={}};this.addSprite=function(a,e){c.hasOwnProperty(a)||(c[a]={szPath:e,oSprite:new Image},h++)};this.getSprite=function(a){return c.hasOwnProperty(a)?c[a].oSprite:null};this._onSpritesLoaded=function(){d.call(a)};this._onSpriteLoaded=function(){g.call(a);++f==h&&this._onSpritesLoaded()};this.loadSprites=function(){for(var a in c)c[a].oSprite.oSpriteLibrary=this,c[a].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
c[a].oSprite.src=c[a].szPath};this.getNumSprites=function(){return h}}
var CANVAS_WIDTH=1280,CANVAS_HEIGHT=1920,EDGEBOARD_X=150,EDGEBOARD_Y=280,FPS_TIME=1E3/24,DISABLE_SOUND_MOBILE=!1,PRIMARY_FONT="arialrounded",STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,MODE_HUMAN=0,MODE_COMPUTER=1,EASY_MODE=0,MEDIUM_MODE=1,HARD_MODE=2,WHITE="white",BLACK="black",PAWN="pawn",ROOK="rook",KNIGHT="knight",BISHOP="bishop",QUEEN="queen",KING="king",PLAYER_STATE_WAIT=0,PLAYER_STATE_SELECTED=
1,PLAYER_STATE_MOVING=2,BOARD_STATE_STALEMATE=0,BOARD_STATE_CHECK=1,BOARD_STATE_PROMOTION=2,BOARD_STATE_CHECKMATE=3,BOARD_SPECIAL_CASTLING_RIGHT=0,BOARD_SPECIAL_CASTLING_LEFT=1,BOARD_SPECIAL_ENPASSANT=2,NUM_CELL=8,BOARD_LENGTH=815,CELL_LENGTH=BOARD_LENGTH/NUM_CELL,DRAW=-1,TIME_MOVE=1E3,TIME_LOOP_WAIT=1E3,MIN_AI_THINKING=1E3,MAX_AI_THINKING=1500,INFINITE=99999,SEARCH_DEPTH,DRAW_COUNTER=50,START_SCORE,SCORE_DECREASE_PER_SECOND,SHOW_SCORE,ENABLE_CHECK_ORIENTATION,ENABLE_FULLSCREEN,TEXT_PRELOADER_CONTINUE=
"START",TEXT_DRAW="DRAW",TEXT_WINS="({0} wins)",TEXT_CHECKMATE="CHECKMATE!",TEXT_STALEMATE="STALEMATE!",TEXT_THINKING="THINKING",TEXT_ARE_SURE="ARE YOU SURE?",TEXT_MODE="CHOOSE GAME MODE",TEXT_BLACK="BLACK",TEXT_WHITE="WHITE",TEXT_PROMOTION="SELECT THE PIECE YOU WANT TO PROMOTE YOUR PAWN INTO",TEXT_CHECK="CHECK!",TEXT_CREDITS_DEVELOPED="DEVELOPED BY",TEXT_SHARE_IMAGE="200x200.jpg",TEXT_SHARE_TITLE="Congratulations!",TEXT_SHARE_MSG1="You collected <strong>",TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!",
TEXT_SHARE_SHARE1="My score is ",TEXT_SHARE_SHARE2=" points! Can you do better?";
function CPreloader(){var c,h,f,g,d,a,b,e,l,m;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","sprites/but_start.png");s_oSpriteLibrary.loadSprites();m=new createjs.Container;s_oStage.addChild(m)};this.unload=function(){m.removeAllChildren();l.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var k=new createjs.Shape;k.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);m.addChild(k);k=s_oSpriteLibrary.getSprite("200x200");b=createBitmap(k);b.regX=.5*k.width;b.regY=.5*k.height;b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2-180;m.addChild(b);e=new createjs.Shape;e.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(b.x-100,b.y-100,200,200,10);m.addChild(e);b.mask=e;
k=s_oSpriteLibrary.getSprite("progress_bar");g=createBitmap(k);g.x=CANVAS_WIDTH/2-k.width/2;g.y=CANVAS_HEIGHT/2+50;m.addChild(g);c=k.width;h=k.height;d=new createjs.Shape;d.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(g.x,g.y,1,h);m.addChild(d);g.mask=d;f=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2+100;f.textBaseline="alphabetic";f.textAlign="center";m.addChild(f);k=s_oSpriteLibrary.getSprite("but_start");l=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2,k,TEXT_PRELOADER_CONTINUE,"Arial","#000",40,m);l.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);l.setVisible(!1);a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);m.addChild(a);createjs.Tween.get(a).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(a);m.removeChild(a)})};this._onButStartRelease=function(){$(s_oMain).trigger("show_preroll_ad");s_oMain._onPreloaderComplete()};this.refreshLoader=function(a){f.text=a+"%";100===a&&(l.setVisible(!0),
f.visible=!1,g.visible=!1);d.graphics.clear();a=Math.floor(a*c/100);d.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(g.x,g.y,a,h)};this._init()}
function CCreditsPanel(){var c,h,f,g,d,a,b,e,l;this._init=function(){d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=0;s_oStage.addChild(d);(new createjs.Tween.get(d)).to({alpha:.7},500);var m=s_oSpriteLibrary.getSprite("msg_box");l=new createjs.Container;l.y=CANVAS_HEIGHT+m.height/2;s_oStage.addChild(l);c=createBitmap(m);c.regX=m.width/2;c.regY=m.height/2;c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2;l.addChild(c);b=new createjs.Shape;b.graphics.beginFill("#0f0f0f").drawRect(0,
0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.01;a=b.on("click",this._onLogoButRelease);l.addChild(b);m=s_oSpriteLibrary.getSprite("but_exit");f=new CGfxButton(1E3,610,m,l);f.addEventListener(ON_MOUSE_UP,this.unload,this);g=new createjs.Text(TEXT_CREDITS_DEVELOPED,"80px "+PRIMARY_FONT,"#402604");g.textAlign="center";g.textBaseline="alphabetic";g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT/2-100;l.addChild(g);m=s_oSpriteLibrary.getSprite("logo_ctl");h=createBitmap(m);h.regX=m.width/2;h.regY=m.height/2;h.x=CANVAS_WIDTH/
2;h.y=CANVAS_HEIGHT/2;l.addChild(h);e=new createjs.Text("www.codethislab.com","68px "+PRIMARY_FONT,"#402604");e.textAlign="center";e.textBaseline="alphabetic";e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/2+130;l.addChild(e);(new createjs.Tween.get(l)).to({y:0},1E3,createjs.Ease.backOut)};this.unload=function(){b.off("click",a);f.unload();f=null;s_oStage.removeChild(d);s_oStage.removeChild(l)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CMain(c){var h,f=0,g=0,d=STATE_LOADING,a,b;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);createjs.Touch.enable(s_oStage);s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(a){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=30;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=
!0);s_oSpriteLibrary=new CSpriteLibrary;};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();h=!0};this.soundLoaded=function(){f++;a.refreshLoader(Math.floor(f/g*100))};this._initSounds=function(){var a=[];a.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,ingamename:"game_over"});a.push({path:"./sounds/",filename:"click",loop:!1,
volume:1,ingamename:"click"});a.push({path:"sounds/default.htm",filename:"win",loop:!1,volume:1,ingamename:"win"});g+=a.length;s_aSounds=[];for(var b=0;b<a.length;b++)s_aSounds[a[b].ingamename]=new Howl({src:[a[b].path+a[b].filename+".mp3",a[b].path+a[b].filename+".ogg"],autoplay:!1,preload:!0,loop:a[b].loop,volume:a[b].volume,onload:s_oMain.soundLoaded})};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","sprites/but_play.png");
s_oSpriteLibrary.addSprite("msg_box","sprites/msg_box.png");s_oSpriteLibrary.addSprite("bg_menu","sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_mod_menu","sprites/bg_mod_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("but_credits","sprites/but_credits.png");s_oSpriteLibrary.addSprite("but_fullscreen","sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("logo_ctl","sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_vs_man",
"sprites/vs_man_panel.png");s_oSpriteLibrary.addSprite("but_vs_pc","sprites/vs_pc_panel.png");s_oSpriteLibrary.addSprite("message","sprites/message.png");s_oSpriteLibrary.addSprite("but_home","sprites/but_home.png");s_oSpriteLibrary.addSprite("but_show","sprites/but_show.png");s_oSpriteLibrary.addSprite("but_exit","sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon","sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_settings","sprites/but_settings.png");s_oSpriteLibrary.addSprite("board8",
"sprites/grid_8.png");s_oSpriteLibrary.addSprite("threat","sprites/threat.png");s_oSpriteLibrary.addSprite("highlight","sprites/highlight.png");s_oSpriteLibrary.addSprite("bg_turn","sprites/player_panel.png");s_oSpriteLibrary.addSprite("audio_icon_big","sprites/audio_icon_big.png");s_oSpriteLibrary.addSprite("black_bishop","sprites/pieces/black_bishop.png");s_oSpriteLibrary.addSprite("black_king","sprites/pieces/black_king.png");s_oSpriteLibrary.addSprite("black_knight","sprites/pieces/black_knight.png");
s_oSpriteLibrary.addSprite("black_pawn","sprites/pieces/black_pawn.png");s_oSpriteLibrary.addSprite("black_queen","sprites/pieces/black_queen.png");s_oSpriteLibrary.addSprite("black_rook","sprites/pieces/black_rook.png");s_oSpriteLibrary.addSprite("white_bishop","sprites/pieces/white_bishop.png");s_oSpriteLibrary.addSprite("white_king","sprites/pieces/white_king.png");s_oSpriteLibrary.addSprite("white_knight","sprites/pieces/white_knight.png");s_oSpriteLibrary.addSprite("white_pawn","sprites/pieces/white_pawn.png");
s_oSpriteLibrary.addSprite("white_queen","sprites/pieces/white_queen.png");s_oSpriteLibrary.addSprite("white_rook","sprites/pieces/white_rook.png");s_oSpriteLibrary.addSprite("white_king_marker","sprites/white_king_marker.png");s_oSpriteLibrary.addSprite("black_king_marker","sprites/black_king_marker.png");s_oSpriteLibrary.addSprite("score_panel","sprites/score_panel.png");s_oSpriteLibrary.addSprite("toggle_easy","sprites/toggle_easy.png");s_oSpriteLibrary.addSprite("toggle_medium","sprites/toggle_medium.png");
s_oSpriteLibrary.addSprite("toggle_hard","sprites/toggle_hard.png");s_oSpriteLibrary.addSprite("but_yes","sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","sprites/but_no.png");s_oSpriteLibrary.addSprite("but_restart","sprites/but_restart.png");g+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){f++;a.refreshLoader(Math.floor(f/g*100))};this._onPreloaderComplete=function(){a.unload();this.gotoMenu()};this._onAllImagesLoaded=function(){};
this.gotoMenu=function(){new CMenu;d=STATE_MENU};this.gotoModeMenu=function(){new CModeMenu;d=STATE_MENU};this.gotoGame=function(a){s_iGameType=a;b=new CGame(e);d=STATE_GAME};this.gotoHelp=function(){new CHelp;d=STATE_HELP};this.stopUpdate=function(){h=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();h=!0;createjs.Ticker.paused=!1;$("#block_game").css("display",
"none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(a){if(!1!==h){var e=(new Date).getTime();s_iTimeElaps=e-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=e;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);d===STATE_GAME&&b.update();s_oStage.update(a)}};s_oMain=this;var e=c;ENABLE_CHECK_ORIENTATION=c.check_orientation;ENABLE_FULLSCREEN=c.fullscreen;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_bFullscreen=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oStage,s_oMain,s_oSpriteLibrary,s_oCanvas,s_iGameType,s_aSounds,s_bWeightSquares=!1,s_bEdgeSensitive=!1;
function CTextButton(c,h,f,g,d,a,b,e){var l,m,k,p,q,w,v;this._init=function(a,b,e,d,c,f,g,h){l=[];m=[];var r=createBitmap(e),v=Math.ceil(g/20);q=new createjs.Text(d,"bold "+g+"px "+c,"#000000");q.textAlign="center";q.textBaseline="alphabetic";var w=q.getBounds();q.x=e.width/2+v;q.y=Math.floor(e.height/2)+w.height/3+v;p=new createjs.Text(d,"bold "+g+"px "+c,f);p.textAlign="center";p.textBaseline="alphabetic";w=p.getBounds();p.x=e.width/2;p.y=Math.floor(e.height/2)+w.height/3;k=new createjs.Container;
k.x=a;k.y=b;k.regX=e.width/2;k.regY=e.height/2;k.addChild(r,q,p);h.addChild(k);this._initListener()};this.unload=function(){k.off("mousedown",w);k.off("pressup",v);e.removeChild(k)};this.setVisible=function(a){k.visible=a};this._initListener=function(){oParent=this;w=k.on("mousedown",this.buttonDown);v=k.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,e){l[a]=b;m[a]=e};this.buttonRelease=function(){k.scaleX=1;k.scaleY=1;l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(m[ON_MOUSE_UP])};this.buttonDown=
function(){k.scaleX=.9;k.scaleY=.9;l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(m[ON_MOUSE_DOWN])};this.setTextPosition=function(a){p.y=a;q.y=a+2};this.setPosition=function(a,b){k.x=a;k.y=b};this.setX=function(a){k.x=a};this.setY=function(a){k.y=a};this.getButtonImage=function(){return k};this.getX=function(){return k.x};this.getY=function(){return k.y};this._init(c,h,f,g,d,a,b,e);return this}
function CToggle(c,h,f,g,d){var a,b,e,l,m=[],k,p,q,w;this._init=function(c,f,g,m){b=!1;e=[];l=[];var h=new createjs.SpriteSheet({images:[g],frames:{width:g.width/2,height:g.height,regX:g.width/2/2,regY:g.height/2},animations:{state_true:[0],state_false:[1]}});a=m;k=createSprite(h,"state_"+a,g.width/2/2,g.height/2,g.width/2,g.height);k.x=c;k.y=f;k.stop();d.addChild(k);this._initListener()};this.unload=function(){s_bMobile?k.off("mousedown",p):(k.off("mousedown",p),k.off("mouseover",q));k.off("pressup",
w);d.removeChild(k)};this._initListener=function(){s_bMobile?p=k.on("mousedown",this.buttonDown):(p=k.on("mousedown",this.buttonDown),q=k.on("mouseover",this.buttonOver));w=k.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,d){e[a]=b;l[a]=d};this.addEventListenerWithParams=function(a,b,d,c){e[a]=b;l[a]=d;m=c};this.setActive=function(b){a=b;k.gotoAndStop("state_"+a)};this.buttonRelease=function(){k.scaleX=1;k.scaleY=1;playSound("click",1,!1);a=!a;k.gotoAndStop("state_"+a);e[ON_MOUSE_UP]&&
e[ON_MOUSE_UP].call(l[ON_MOUSE_UP],m)};this.buttonDown=function(){k.scaleX=.9;k.scaleY=.9;e[ON_MOUSE_DOWN]&&e[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN],m)};this.buttonOver=function(a){s_bMobile||b||(a.target.cursor="pointer")};this.setPosition=function(a,b){k.x=a;k.y=b};this.setVisible=function(a){k.visible=a};this._init(c,h,f,g)}
function CGfxButton(c,h,f,g){var d,a,b,e,l,m,k,p;this._init=function(c,f,k,g){d=!1;a=1;b=[];e=[];l=createBitmap(k);l.x=c;l.y=f;l.scaleX=l.scaleY=a;l.regX=k.width/2;l.regY=k.height/2;g.addChild(l);this._initListener()};this.unload=function(){s_bMobile?l.off("mousedown",m):(l.off("mousedown",m),l.off("mouseover",k));l.off("pressup",p);g.removeChild(l)};this.setVisible=function(a){l.visible=a};this.setClickable=function(a){d=!a};this._initListener=function(){s_bMobile?m=l.on("mousedown",this.buttonDown):
(m=l.on("mousedown",this.buttonDown),k=l.on("mouseover",this.buttonOver));p=l.on("pressup",this.buttonRelease)};this.addEventListener=function(a,d,l){b[a]=d;e[a]=l};this.buttonRelease=function(){d||(l.scaleX=a,l.scaleY=a,b[ON_MOUSE_UP]&&b[ON_MOUSE_UP].call(e[ON_MOUSE_UP]))};this.buttonDown=function(){d||(l.scaleX=.9*a,l.scaleY=.9*a,playSound("click",1,!1),b[ON_MOUSE_DOWN]&&b[ON_MOUSE_DOWN].call(e[ON_MOUSE_DOWN]))};this.buttonOver=function(a){s_bMobile||d||(a.target.cursor="pointer")};this.pulseAnimation=
function(){createjs.Tween.get(l).to({scaleX:.9*a,scaleY:.9*a},850,createjs.Ease.quadOut).to({scaleX:a,scaleY:a},650,createjs.Ease.quadIn).call(function(){q.pulseAnimation()})};this.trembleAnimation=function(){createjs.Tween.get(l).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){q.trebleAnimation()})};this.setPosition=function(a,b){l.x=a;l.y=b};this.setX=function(a){l.x=a};this.setY=function(a){l.y=
a};this.getButtonImage=function(){return l};this.getX=function(){return l.x};this.getY=function(){return l.y};var q=this;this._init(c,h,f,g);return this}
function CMessage(c,h){var f,g,d,a;this._init=function(b,l){b===WHITE?(f=306,g=-200,d=1580):(f=976,g=CANVAS_HEIGHT+200,d=338);a=new createjs.Container;a.x=f;a.y=g;s_bMobile&&b===BLACK&&s_iGameType===MODE_HUMAN&&(a.rotation=180);s_oStage.addChild(a);var e=s_oSpriteLibrary.getSprite("message"),c=createBitmap(e);c.regX=e.width/2;c.regY=e.height/2;e=new createjs.Text(l," 40px "+PRIMARY_FONT,"#ffffff");e.textAlign="center";e.textBaseline="top";e.lineWidth=350;e.regY=e.getBounds().height/2;a.addChild(c,
e);createjs.Tween.get(a).to({y:d},750,createjs.Ease.cubicOut)};this.unload=function(){s_oStage.removeChild(a)};this.removeAnimated=function(){a.x>CANVAS_WIDTH/2?createjs.Tween.get(a).to({x:CANVAS_WIDTH+200},500,createjs.Ease.cubicOut).call(function(){b.unload()}):createjs.Tween.get(a).to({x:-200},500,createjs.Ease.cubicOut).call(function(){b.unload()})};var b=this;this._init(c,h)}
function CMenu(){var c,h,f,g,d,a,b,e,l,m,k,p,q=null,w=null;this._init=function(){b=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(b);var v=s_oSpriteLibrary.getSprite("but_play");e=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-450,v,s_oStage);e.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);e.pulseAnimation();v=s_oSpriteLibrary.getSprite("but_credits");d=10+v.width/2;a=v.height/2+25;k=new CGfxButton(d,a,v,s_oStage);k.addEventListener(ON_MOUSE_UP,this._onCredits,this);
if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)v=s_oSpriteLibrary.getSprite("audio_icon"),c=CANVAS_WIDTH-v.height/2-10,h=v.height/2+25,m=new CToggle(c,h,v,s_bAudioActive,s_oStage),m.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);v=window.document;var r=v.documentElement;q=r.requestFullscreen||r.mozRequestFullScreen||r.webkitRequestFullScreen||r.msRequestFullscreen;w=v.exitFullscreen||v.mozCancelFullScreen||v.webkitExitFullscreen||v.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(q=!1);q&&screenfull.enabled&&
(v=s_oSpriteLibrary.getSprite("but_fullscreen"),f=d+v.width/2+10,g=a,p=new CToggle(f,g,v,s_bFullscreen,s_oStage),p.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));l=new createjs.Shape;l.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(l);createjs.Tween.get(l).to({alpha:0},1E3).call(function(){l.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){e.unload();e=null;l.visible=!1;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)m.unload(),
m=null;k.unload();q&&screenfull.enabled&&p.unload();s_oStage.removeChild(b);s_oMenu=b=null};this.refreshButtonPos=function(b,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||m.setPosition(c-b,e+h);k.setPosition(d+b,e+a);q&&screenfull.enabled&&p.setPosition(f+b,e+g)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButPlayRelease=function(){this.unload();$(s_oMain).trigger("start_session");s_oMain.gotoModeMenu()};this._onCredits=function(){new CCreditsPanel};
this.resetFullscreenBut=function(){p.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?w.call(window.document):q.call(window.document.documentElement);sizeHandler()};s_oMenu=this;this._init()}var s_oMenu=null;
function CModeMenu(){var c,h,f,g,d,a,b,e,l,m,k,p=null,q,w,v,r,B=null,A=null;this._init=function(){var b=createBitmap(s_oSpriteLibrary.getSprite("bg_mod_menu"));s_oStage.addChild(b);b=s_oSpriteLibrary.getSprite("but_exit");f=CANVAS_WIDTH-b.height/2-10;g=b.height/2+25;k=new CGfxButton(f,g,b,s_oStage);k.addEventListener(ON_MOUSE_UP,this._onExit,this);d=CANVAS_WIDTH-b.width/2-125;a=b.height/2+25;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)b=s_oSpriteLibrary.getSprite("audio_icon"),p=new CToggle(d,a,
b,s_bAudioActive,s_oStage),p.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);b=window.document;var C=b.documentElement;B=C.requestFullscreen||C.mozRequestFullScreen||C.webkitRequestFullScreen||C.msRequestFullscreen;A=b.exitFullscreen||b.mozCancelFullScreen||b.webkitExitFullscreen||b.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(B=!1);B&&screenfull.enabled&&(b=s_oSpriteLibrary.getSprite("but_fullscreen"),c=b.width/4+10,h=g,r=new CToggle(c,h,b,s_bFullscreen,s_oStage),r.addEventListener(ON_MOUSE_UP,
this._onFullscreenRelease,this));e=new createjs.Text(TEXT_MODE,"bold 80px "+PRIMARY_FONT,"#ffffff");e.x=CANVAS_WIDTH/2;e.y=400;e.textAlign="center";e.textBaseline="middle";e.lineWidth=600;s_oStage.addChild(e);b=s_oSpriteLibrary.getSprite("but_vs_man");l=new CGfxButton(CANVAS_WIDTH/2,800,b,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onButHumanRelease,this);b=s_oSpriteLibrary.getSprite("message");C=createBitmap(b);C.regX=b.width/2;C.regY=b.height/2;C.x=CANVAS_WIDTH/2;C.y=1532;s_oStage.addChild(C);
b=s_oSpriteLibrary.getSprite("toggle_easy");q=new CToggle(CANVAS_WIDTH/2-130+2,1550,b,!1,s_oStage);q.addEventListenerWithParams(ON_MOUSE_UP,this._onDifficultyToggle,this,EASY_MODE);b=s_oSpriteLibrary.getSprite("toggle_medium");w=new CToggle(CANVAS_WIDTH/2+2,1550,b,!0,s_oStage);w.addEventListenerWithParams(ON_MOUSE_UP,this._onDifficultyToggle,this,MEDIUM_MODE);b=s_oSpriteLibrary.getSprite("toggle_hard");v=new CToggle(CANVAS_WIDTH/2+132,1550,b,!1,s_oStage);v.addEventListenerWithParams(ON_MOUSE_UP,this._onDifficultyToggle,
this,HARD_MODE);b=s_oSpriteLibrary.getSprite("but_vs_pc");m=new CGfxButton(CANVAS_WIDTH/2,1300,b,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onButComputerRelease,this);this._onDifficultyToggle(MEDIUM_MODE);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){l.unload();m.unload();k.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)p.unload(),p=null;B&&screenfull.enabled&&r.unload();s_oModeMenu=null;s_oStage.removeAllChildren()};this._onDifficultyToggle=function(a){switch(a){case EASY_MODE:q.setActive(!0);
w.setActive(!1);v.setActive(!1);b=EASY_MODE;SEARCH_DEPTH=1;break;case MEDIUM_MODE:q.setActive(!1);w.setActive(!0);v.setActive(!1);b=MEDIUM_MODE;SEARCH_DEPTH=2;break;case HARD_MODE:q.setActive(!1),w.setActive(!1),v.setActive(!0),b=HARD_MODE,SEARCH_DEPTH=3}};this.refreshButtonPos=function(b,e){k.setPosition(f-b,e+g);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||p.setPosition(d-b,e+a);B&&screenfull.enabled&&r.setPosition(c+b,e+h)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=
!s_bAudioActive};this.resetFullscreenBut=function(){r.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?A.call(window.document):B.call(window.document.documentElement);sizeHandler()};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this._onButHumanRelease=function(){this.unload();s_oMain.gotoGame(MODE_HUMAN)};this._onButComputerRelease=function(){this.unload();s_oMain.gotoGame(MODE_COMPUTER,b)};s_oModeMenu=this;this._init()}var s_oModeMenu=null;
function CGame(c){var h,f,g,d,a,b,e,l,m,k,p,q=null,w,v,r,B,A,E=null,C,z,N;this._init=function(){h=!0;f=!1;g=PLAYER_STATE_WAIT;d=WHITE;b=a=m=0;l=e=START_SCORE;A=z=null;var c=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(c);w=new createjs.Container;w.x=CANVAS_WIDTH/2;w.y=CANVAS_HEIGHT/2;w.scaleX=w.scaleY=1.2;s_oStage.addChild(w);v=new createjs.Container;s_oStage.addChild(v);r=new createjs.Container;r.x=CANVAS_WIDTH/2;r.y=CANVAS_HEIGHT/2;r.scaleX=r.scaleY=1.2;s_oStage.addChild(r);
B=new createjs.Container;B.x=CANVAS_WIDTH/2;B.y=CANVAS_HEIGHT/2;B.scaleX=B.scaleY=1.2;s_oStage.addChild(B);p=new CInterface(v);c=s_oSpriteLibrary.getSprite("board8");C=new createBitmap(c);C.regX=c.width/2;C.regY=c.height/2;w.addChild(C);this._initBoard();this.setPieceDepth();new CMovesController(k);new CMovesControllerFaster(k);new CBoardStateController;p.activePlayer(d);N=new CAI};this._initBoard=function(){var a=NUM_CELL,b=CELL_LENGTH,e=-BOARD_LENGTH/2+b/2;k=[];for(var d=0;d<a;d++){k[d]=[];for(var l=
0;l<a;l++)k[d][l]=new CCell(e+l*b,e+d*b,null,d,l,w,r,B)}for(d=0;d<a;d++)k[1][d].createPiece(m,BLACK,PAWN);for(d=0;d<a;d++)k[6][d].createPiece(m,WHITE,PAWN);k[0][0].createPiece(m,BLACK,ROOK);k[0][7].createPiece(m,BLACK,ROOK);k[7][0].createPiece(m,WHITE,ROOK);k[7][7].createPiece(m,WHITE,ROOK);k[0][1].createPiece(m,BLACK,KNIGHT);k[0][6].createPiece(m,BLACK,KNIGHT);k[7][1].createPiece(m,WHITE,KNIGHT);k[7][6].createPiece(m,WHITE,KNIGHT);k[0][2].createPiece(m,BLACK,BISHOP);k[0][5].createPiece(m,BLACK,BISHOP);
k[7][2].createPiece(m,WHITE,BISHOP);k[7][5].createPiece(m,WHITE,BISHOP);k[0][3].createPiece(m,BLACK,QUEEN);k[0][4].createPiece(m,BLACK,KING);k[7][3].createPiece(m,WHITE,QUEEN);k[7][4].createPiece(m,WHITE,KING)};this.changeTurn=function(){null!==A&&A.removeAnimated();f=!1;g=PLAYER_STATE_WAIT;if(d===WHITE){d=BLACK;var a=this.checkGameState();s_iGameType===MODE_COMPUTER&&this._playAI(a)}else d=WHITE,this.checkGameState();p.activePlayer(d)};this._playAI=function(a){if(!a){E=new CThinking;E.update();a=
MIN_AI_THINKING+Math.random()*(MAX_AI_THINKING-MIN_AI_THINKING);var b=N.getMove();null!==b&&setTimeout(function(){E.unload();E=null;s_oGame.cellClicked(b.sourcerow,b.sourcecol);s_oGame.cellClicked(b.destrow,b.destcol)},a)}};this.cellClicked=function(a,b){switch(g){case PLAYER_STATE_WAIT:this._disableAllThreat();if(null!==k[a][b].getColor()&&k[a][b].getColor()!==d)break;this._selectPiece(a,b);break;case PLAYER_STATE_SELECTED:z.getLogicPos().row===a&&z.getLogicPos().col===b?this._deselectPiece():k[a][b].getColor()===
d?(this._deselectPiece(),this._selectPiece(a,b)):k[a][b].isHighlight()?this._checkLegalMove(a,b):this._deselectPiece(),playSound("click",1,!1)}};this._checkLegalMove=function(a,b){var e=s_oBoardStateController.copyBoard(k);s_oBoardStateController.moveCopiedPiece(e,z.getLogicPos().row,z.getLogicPos().col,a,b);e=s_oBoardStateController.findAllChecks(d,e);if(0===e.length){switch(s_oBoardStateController.getSpecialMoves(z.getLogicPos().row,z.getLogicPos().col,a,b,k)){case BOARD_SPECIAL_CASTLING_RIGHT:var l=
k[z.getLogicPos().row][7];e=k[z.getLogicPos().row][5];l.shift(e);break;case BOARD_SPECIAL_CASTLING_LEFT:l=k[z.getLogicPos().row][0];e=k[z.getLogicPos().row][3];l.shift(e);break;case BOARD_SPECIAL_ENPASSANT:k[z.getLogicPos().row][b].eatUp()}z.setActive(!1);this._movePiece(a,b);this._deselectPiece();g=PLAYER_STATE_MOVING}else for(this._disableAllThreat(),l=0;l<e.length;l++)k[e[l].getLogicPos().row][e[l].getLogicPos().col].threat(!0)};this._movePiece=function(a,b){var e=k[a][b];z.move(e);null!==e.getColor()&&
e.eatUp()};this._selectPiece=function(a,b){z=k[a][b];z.setActive(!0);for(var e=s_oMovesController.getMovesList(a,b,k),d=0;d<e.length;d++)k[e[d].row][e[d].col].highlight(!0);g=PLAYER_STATE_SELECTED;playSound("click",1,!1)};this._deselectPiece=function(){this._disableAllHighlight();z.setActive(!1);z=null;g=PLAYER_STATE_WAIT};this.onFinishMove=function(){this.setPieceDepth();var a=s_oBoardStateController.checkPromotion(k);null===a?this.changeTurn():s_iGameType===MODE_HUMAN?new CPromoPanel(d,a):d===BLACK?
(this.changePiece(QUEEN,a),this.changeTurn()):new CPromoPanel(d,a)};this.checkGameState=function(){var a=!1;switch(s_oBoardStateController.getState(d,k)){case BOARD_STATE_STALEMATE:this.gameOver(DRAW);A=new CMessage(d,TEXT_STALEMATE);a=!0;break;case BOARD_STATE_CHECK:f=!0;for(var b=s_oBoardStateController.findAllChecks(d,k),e=0;e<b.length;e++)k[b[e].getLogicPos().row][b[e].getLogicPos().col].threat(!0);A=new CMessage(d,TEXT_CHECK);break;case BOARD_STATE_CHECKMATE:a=s_oBoardStateController.getOtherOpponent(d),
A=new CMessage(d,TEXT_CHECKMATE),this.gameOver(a),a=!0}return a};this.setPieceDepth=function(){for(var a=[],b=0;b<r.children.length;b++){var e=r.children[b];a.push({height:e.y,piece:e})}a.sort(this.compareHeight);for(b=e=0;b<r.children.length;b++)r.setChildIndex(a[b].piece,e++)};this.compareHeight=function(a,b){return a.height<b.height?-1:a.height>b.height?1:0};this.getCells=function(){return k};this.restartGame=function(){this.unload();this._init()};this.pauseGame=function(a){h=!a};this.unload=function(){h=
!1;p.unload();null!==q&&q.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};this._disableAllHighlight=function(){null!==z&&z.setActive(!1);for(var a=0;a<NUM_CELL;a++)for(var b=0;b<NUM_CELL;b++)k[a][b].highlight(!1),k[a][b].threat(!1)};this._disableAllThreat=function(){for(var a=0;a<NUM_CELL;a++)for(var b=0;b<NUM_CELL;b++)k[a][b].threat(!1)};this.setAllVisible=function(a){for(var b=0;b<NUM_CELL;b++)for(var e=0;e<NUM_CELL;e++)k[b][e].setVisible(a)};this.isCheck=function(){return f};
this.onExitPromoPanel=function(){this.changeTurn()};this.changePiece=function(a,b){k[b.row][b.col].changePiece(d,a)};this.getNewHistoryID=function(){return++m};this.onExit=function(){$(s_oMain).trigger("end_session");$(s_oMain).trigger("show_interlevel_ad");s_oGame.unload();s_oMain.gotoMenu()};this._onExitHelp=function(){h=!0};this.gameOver=function(d){h=!1;d===WHITE?e=0:d===BLACK?l=0:d===DRAW&&(l=e=0);q=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));setTimeout(function(){q.show(d,a,b,e,l);
p.setInfoVisible(!1)},1E3)};this.update=function(){h&&(null!==E&&E.update(),this.setPieceDepth(),d===WHITE?(b+=s_iTimeElaps,p.refreshWhiteTime(b),l-=SCORE_DECREASE_PER_SECOND*s_iTimeElaps/1E3,0>l&&(l=0),p.refreshWhiteScore(Math.floor(l))):(a+=s_iTimeElaps,p.refreshBlackTime(a),e-=SCORE_DECREASE_PER_SECOND*s_iTimeElaps/1E3,0>e&&(e=0),p.refreshBlackScore(Math.floor(e))))};SHOW_SCORE=c.show_score;START_SCORE=c.start_score;SCORE_DECREASE_PER_SECOND=c.score_decrease_per_second;s_oGame=this;this._init()}
var s_oGame;
function CInterface(c){var h,f,g,d,a,b,e,l,m,k,p,q=null,w=null;this._init=function(c){var r=s_oSpriteLibrary.getSprite("but_exit");g=CANVAS_WIDTH-r.height/2-10;d=r.height/2+25;e=new CGfxButton(g,d,r,s_oStage);e.addEventListener(ON_MOUSE_UP,this._onExit,this);var v=CANVAS_WIDTH-r.width/2-125;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)r=s_oSpriteLibrary.getSprite("audio_icon"),h=v,f=25+r.height/2,l=new CToggle(h,f,r,s_bAudioActive,s_oStage),l.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);
v=window.document;r=v.documentElement;q=r.requestFullscreen||r.mozRequestFullScreen||r.webkitRequestFullScreen||r.msRequestFullscreen;w=v.exitFullscreen||v.mozCancelFullScreen||v.webkitExitFullscreen||v.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(q=!1);q&&screenfull.enabled&&(r=s_oSpriteLibrary.getSprite("but_fullscreen"),a=r.width/4+10,b=r.height/2+25,p=new CToggle(a,b,r,s_bFullscreen,s_oStage),p.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));m=new CInfoTurn(950,1570,WHITE,c);k=new CInfoTurn(s_iGameType===
MODE_HUMAN&&s_bMobile?330:310,350,BLACK,c);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){e.unload();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.unload();k.unload();m.unload();q&&screenfull.enabled&&p.unload();s_oInterface=null};this.refreshButtonPos=function(c,k){e.setPosition(g-c,k+d);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(h-c,k+f);q&&screenfull.enabled&&p.setPosition(a+c,k+b)};this.refreshWhiteTime=function(a){50<a&&m.refreshTime(formatTime(a))};this.refreshBlackTime=
function(a){50<a&&k.refreshTime(formatTime(a))};this.refreshWhiteScore=function(a){m.refreshScore(a)};this.refreshBlackScore=function(a){k.refreshScore(a)};this.activePlayer=function(a){a===WHITE?(k.active(!1),m.active(!0)):(m.active(!1),k.active(!0))};this.setInfoVisible=function(a){m.setPanelVisible(a);k.setPanelVisible(a)};this._onButConfigRelease=function(){new CConfigPanel};this._onButRestartRelease=function(){s_oGame.restartGame()};this.onExitFromHelp=function(){null.unload()};this._onExit=
function(){new CAreYouSurePanel(s_oGame.onExit)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=function(){p.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?w.call(window.document):q.call(window.document.documentElement);sizeHandler()};s_oInterface=this;this._init(c);return this}var s_oInterface=null;
function CInfoTurn(c,h,f,g){var d,a,b,e,l,m,k;this._init=function(c,f,g,h){d=new createjs.Container;d.x=c;d.y=f;s_iGameType===MODE_HUMAN&&g===BLACK&&s_bMobile&&(d.rotation=180);h.addChild(d);m=new createjs.Container;c=-324;f=30;g===WHITE?(m.x=c,m.y=-f):(m.x=-c+20,s_iGameType===MODE_HUMAN&&g===BLACK&&s_bMobile?(m.x=c,m.y=-f):m.y=f);d.addChild(m);if(!SHOW_SCORE||s_iGameType===MODE_COMPUTER&&g===BLACK)m.visible=!1;c=s_oSpriteLibrary.getSprite("score_panel");f=createBitmap(c);f.regX=c.width/2;f.regY=
c.height/2;m.addChild(f);k=new createjs.Text(START_SCORE," 30px "+PRIMARY_FONT,"#ffffff");k.x=90;k.textAlign="right";k.textBaseline="middle";k.lineWidth=200;m.addChild(k);c=s_oSpriteLibrary.getSprite("bg_turn");f=new createjs.SpriteSheet({images:[c],framerate:58,frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{off:[0,0,"on"],on:[1,1,"off"]}});a=createSprite(f,0,c.width/2/2,c.height/2,c.width/2,c.height);a.stop();d.addChild(a);b=createSprite(f,1,c.width/2/2,c.height/
2,c.width/2,c.height);b.stop();b.x=10;b.alpha=0;d.addChild(b);c=s_oSpriteLibrary.getSprite(g+"_king_marker");l=createBitmap(c);l.x=160;l.regX=c.width/2;l.regY=c.height/2;d.addChild(l);e=new createjs.Text("00:00"," 58px "+PRIMARY_FONT,"#ffffff");e.x=-65;e.y=2;e.textBaseline="middle";e.lineWidth=200;d.addChild(e)};this.refreshTime=function(a){e.text=a};this.refreshScore=function(a){k.text=a};this.invert=function(){e.x=0;l.x=-100};this.active=function(e){e?(createjs.Tween.get(a).to({alpha:0},750,createjs.Ease.cubicOut).to({alpha:1},
750,createjs.Ease.cubicIn).call(function(){p.active(e)}),createjs.Tween.get(b).to({alpha:1},750,createjs.Ease.cubicOut).to({alpha:0},750,createjs.Ease.cubicIn)):(a.alpha=1,b.alpha=0,createjs.Tween.removeTweens(a),createjs.Tween.removeTweens(b))};this.unload=function(){g.removeChild(d)};this.setBgVisible=function(b){a.visible=b;m.visible=b};this.setPanelVisible=function(a){d.visible=a};this.setPawn=function(a){l.gotoAndStop(a)};var p=this;this._init(c,h,f,g)}
function CThinking(){var c,h,f,g,d,a,b;this._init=function(){c=!0;h=0;f=new createjs.Container;var e=(new createjs.Graphics).beginFill("rgba(0,0,0,0.3)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a=new createjs.Shape(e);b=a.on("click",function(){});g=new createjs.Text(TEXT_THINKING,"bold 60px "+PRIMARY_FONT,"#ffffff");g.x=.5*CANVAS_WIDTH;g.y=.5*CANVAS_HEIGHT-100;g.textAlign="center";g.textBaseline="alphabetic";g.lineWidth=800;d=new createjs.Text("","bold 180px "+PRIMARY_FONT,"#ffffff");d.x=.5*CANVAS_WIDTH-
76;d.y=.5*CANVAS_HEIGHT-50;d.textAlign="left";d.textBaseline="alphabetic";d.lineWidth=800;f.addChild(a,g,d);s_oStage.addChild(f)};this.unload=function(){c=!1;a.off("click",b);s_oStage.removeChild(f)};this.update=function(){c&&(h+=s_iTimeElaps,0<=h&&h<TIME_LOOP_WAIT/4?d.text="":h>=TIME_LOOP_WAIT/4&&h<2*TIME_LOOP_WAIT/4?d.text=".":h>=2*TIME_LOOP_WAIT/4&&h<3*TIME_LOOP_WAIT/4?d.text="..":h>=3*TIME_LOOP_WAIT/4&&h<TIME_LOOP_WAIT?d.text="...":h=0)};this._init()}
function CEndPanel(c){var h,f,g,d,a,b,e,l,m,k,p;this._init=function(c){s_oGame.pauseGame(!0);e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=.7;h=createBitmap(c);h.regX=c.width/2;h.regY=c.height/2;h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2;a=new createjs.Text("","bold 90px "+PRIMARY_FONT,"#ffffff");a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT/2-280;a.textAlign="center";a.textBaseline="alphabetic";a.lineWidth=800;b=new createjs.Text("","bold 40px "+PRIMARY_FONT,
"#ffffff");b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2-230;b.textAlign="center";b.textBaseline="alphabetic";b.lineWidth=800;f=new createjs.Container;f.alpha=0;f.visible=!1;f.addChild(e,h,a,b);g=new CInfoTurn(CANVAS_WIDTH/2,1E3,BLACK,f);g.setBgVisible(!1);g.invert();d=new CInfoTurn(CANVAS_WIDTH/2,850,WHITE,f);d.setBgVisible(!1);d.invert();c=s_oSpriteLibrary.getSprite("but_restart");k=new CGfxButton(CANVAS_WIDTH/2-180,CANVAS_HEIGHT/2+250,c,f);k.addEventListener(ON_MOUSE_UP,this._onRestart,this);c=s_oSpriteLibrary.getSprite("but_home");
l=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+250,c,f);l.addEventListener(ON_MOUSE_UP,this._onExit,this);c=s_oSpriteLibrary.getSprite("but_show");m=new CGfxButton(CANVAS_WIDTH/2+180,CANVAS_HEIGHT/2+250,c,f);m.addEventListener(ON_MOUSE_UP,this._onShow,this);s_oStage.addChild(f)};this.unload=function(){f.off("mousedown",p)};this._initListener=function(){p=f.on("mousedown",this._onExit)};this.show=function(e,c,l,k,h){g.refreshTime(formatTime(c));d.refreshTime(formatTime(l));e===WHITE?(playSound("win",
1,!1),a.text=TEXT_CHECKMATE,b.text=TEXT_WINS.format(WHITE)):e===BLACK?(s_iGameType===MODE_HUMAN?playSound("win",1,!1):playSound("game_over",1,!1),a.text=TEXT_CHECKMATE,b.text=TEXT_WINS.format(BLACK)):e===DRAW&&(playSound("game_over",1,!1),a.text=TEXT_STALEMATE,b.text=DRAW);f.visible=!0;createjs.Tween.get(f).to({alpha:1},500);$(s_oMain).trigger("save_score",[e,c,l,s_iGameType,h,k]);$(s_oMain).trigger("share_event",[h,s_iGameType,e])};this._onRestart=function(){s_oGame.restartGame()};this._onExit=function(){f.off("mousedown",
p);g.unload();d.unload();s_oStage.removeChild(f);l.unload();m.unload();$(s_oMain).trigger("end_session");$(s_oMain).trigger("show_interlevel_ad");s_oGame.onExit()};this._onShow=function(){f.visible=!1;$(s_oMain).trigger("end_session")};this._init(c);return this}
function CCell(c,h,f,g,d,a,b,e){var l,m,k,p,q,w,v,r;this._init=function(a,b,e,d,c,f,g,h){l=d;m=c;k=new createjs.Container;k.x=a;k.y=b;f.addChild(k);p=null;a=s_oSpriteLibrary.getSprite("highlight");v=createBitmap(a);v.regX=a.width/2;v.regY=a.height/2;v.alpha=.8;v.visible=!1;k.addChild(v);a=s_oSpriteLibrary.getSprite("threat");w=createBitmap(a);w.regX=a.width/2;w.regY=a.height/2;w.visible=!1;k.addChild(w);q=new createjs.Shape;q.graphics.beginFill("rgba(158,0,0,0.01)").drawRect(-CELL_LENGTH/2,-CELL_LENGTH/
2,CELL_LENGTH,CELL_LENGTH);r=q.on("mousedown",this._onCellClick);k.addChild(q)};this.unload=function(){a.removeChild(k);q.off("mousedown",r)};this.setClickableArea=function(a){q.visible=a};this.changePiece=function(a,l){var f=p.getHistory();p.unload();p=new CPiece(c,h,a,l,b,e);p.setHistory(f);p.setNewMoveInHistory(s_oGame.getNewHistoryID(),g,d,l)};this.createPiece=function(a,l,f){p=new CPiece(c,h,l,f,b,e);p.setNewMoveInHistory(a,g,d,f)};this.getPieceContainer=function(){return p.getContainer()};this.setPiece=
function(a){p=a};this.getType=function(){return null!==p?p.getType():null};this.getColor=function(){return null!==p?p.getColor():null};this.getPieceHistory=function(){return null!==p?p.getHistory():[]};this.threat=function(a){w.visible=a};this.highlight=function(a){v.visible=a};this.isHighlight=function(){return v.visible};this._onCellClick=function(){s_oGame.cellClicked(l,m)};this.setActive=function(a){null!==p&&p.setActive(a)};this.setVisible=function(a){k.visible=a};this.getPos=function(){return{x:c,
y:h}};this.getLogicPos=function(){return{row:g,col:d}};this.move=function(a){p.move(a);p=null};this.shift=function(a){p.shift(a);p=null};this.eatUp=function(){p.disappear()};this._init(c,h,f,g,d,a,b,e)}
function CPiece(c,h,f,g,d,a){var b,e,l,m;this._init=function(a,d,c,f,k,g){b=c;e=f;l=[];c=this._getSpriteName();c=s_oSpriteLibrary.getSprite(c);f=c.width/2;g=c.height;c=new createjs.SpriteSheet({images:[c],frames:{width:f,height:g,regX:f/2,regY:g-40},animations:{idle:[0],lit:[1]}});m=createSprite(c,"idle",0,0,0,0);m.x=a;m.y=d;k.addChild(m)};this.unload=function(){d.removeChild(m)};this._getSpriteName=function(){var a=f===WHITE?"white":"black";switch(g){case PAWN:var b="pawn";break;case ROOK:b="rook";
break;case KNIGHT:b="knight";break;case BISHOP:b="bishop";break;case QUEEN:b="queen";break;case KING:b="king"}return a+"_"+b};this.getContainer=function(){return m};this.getType=function(){return e};this.getColor=function(){return b};this.setPos=function(a,b){m.x=a;m.y=b};this.getPos=function(){return{x:m.x,y:m.y}};this.setNewMoveInHistory=function(a,b,e,d){l.push({id:a,row:b,col:e,piece:d})};this.setHistory=function(a){l=[];for(var b=0;b<a.length;b++)l[b]=a[b]};this.getHistory=function(){return l};
this.setActive=function(a){a?m.gotoAndStop("lit"):m.gotoAndStop("idle")};this.move=function(b){var c=b.getPos();e===KNIGHT?(a.addChild(m),(new createjs.Tween.get(m)).to({scaleX:1.3,scaleY:1.3},.4*TIME_MOVE,createjs.Ease.cubicOut).to({scaleX:1,scaleY:1},600)):e===PAWN&&s_oBoardStateController.resetStall();(new createjs.Tween.get(m)).to({x:c.x,y:c.y},TIME_MOVE,createjs.Ease.cubicOut).call(function(){s_oBoardStateController.increaseStallCount();e===KNIGHT&&d.addChild(m);b.setPiece(k);s_oGame.onFinishMove();
k.setNewMoveInHistory(s_oGame.getNewHistoryID(),b.getLogicPos().row,b.getLogicPos().col,e)})};this.shift=function(a){var b=a.getPos();(new createjs.Tween.get(m)).to({x:b.x,y:b.y},1E3,createjs.Ease.cubicOut).call(function(){a.setPiece(k);k.setNewMoveInHistory(s_oGame.getNewHistoryID(),a.getLogicPos().row,a.getLogicPos().col,e)})};this.disappear=function(){(new createjs.Tween.get(m)).to({alpha:0},1E3).call(function(){s_oBoardStateController.resetStall();k.unload()})};var k=this;this._init(c,h,f,g,d,
a)}var DIR_TOPRIGHT="DIR_TOPRIGHT",DIR_RIGHT="DIR_RIGHT",DIR_BOTRIGHT="DIR_BOTRIGHT",DIR_TOPLEFT="DIR_TOPLEFT",DIR_LEFT="DIR_LEFT",DIR_BOTLEFT="DIR_BOTLEFT",DIR_TOP="DIR_TOP",DIR_BOT="DIR_BOT";
function CMovesController(c){var h,f,g,d;this._init=function(a){h=a.length;f=a[0].length;d=[];g=[];for(a=0;a<h;a++){g[a]=[];for(var b=0;b<f;b++)g[a][b]=[]}this._buildMap()};this._buildMap=function(){for(var a=0;a<h;a++)for(var b=0;b<f;b++)g[a][b][DIR_TOPRIGHT]=this._setNeighbor(a,b,DIR_TOPRIGHT),g[a][b][DIR_RIGHT]=this._setNeighbor(a,b,DIR_RIGHT),g[a][b][DIR_BOTRIGHT]=this._setNeighbor(a,b,DIR_BOTRIGHT),g[a][b][DIR_TOPLEFT]=this._setNeighbor(a,b,DIR_TOPLEFT),g[a][b][DIR_LEFT]=this._setNeighbor(a,
b,DIR_LEFT),g[a][b][DIR_BOTLEFT]=this._setNeighbor(a,b,DIR_BOTLEFT),g[a][b][DIR_TOP]=this._setNeighbor(a,b,DIR_TOP),g[a][b][DIR_BOT]=this._setNeighbor(a,b,DIR_BOT)};this._setNeighbor=function(a,b,e){var d=null;switch(e){case DIR_TOPRIGHT:0<a&&b<f-1&&(d={row:a-1,col:b+1});break;case DIR_RIGHT:b<f-1&&(d={row:a,col:b+1});break;case DIR_BOTRIGHT:a<h-1&&b<f-1&&(d={row:a+1,col:b+1});break;case DIR_TOPLEFT:0<a&&0<b&&(d={row:a-1,col:b-1});break;case DIR_LEFT:0<b&&(d={row:a,col:b-1});break;case DIR_BOTLEFT:a<
h-1&&0<b&&(d={row:a+1,col:b-1});break;case DIR_TOP:0<a&&(d={row:a-1,col:b});break;case DIR_BOT:a<h-1&&(d={row:a+1,col:b})}return d};this._getNeighborByDir=function(a,b,e){return g[a][b][e]};this._getAllNeighbor=function(a,b){var e=[],d;for(d in g[a][b])null!==g[a][b][d]&&e.push(g[a][b][d]);return e};this._getMainDiagonal=function(a,b,e){var d=[],c=e[a][b].getColor();this._findInDirection(a,b,DIR_BOTRIGHT,d,99,c,e);this._findInDirection(a,b,DIR_TOPLEFT,d,99,c,e);return d};this._getSecondDiagonal=function(a,
b,e){var d=[],c=e[a][b].getColor();this._findInDirection(a,b,DIR_BOTLEFT,d,99,c,e);this._findInDirection(a,b,DIR_TOPRIGHT,d,99,c,e);return d};this._getRow=function(a,b,e){var d=[],c=e[a][b].getColor();this._findInDirection(a,b,DIR_LEFT,d,99,c,e);this._findInDirection(a,b,DIR_RIGHT,d,99,c,e);return d};this._getCol=function(a,b,e){var d=[],c=e[a][b].getColor();this._findInDirection(a,b,DIR_TOP,d,99,c,e);this._findInDirection(a,b,DIR_BOT,d,99,c,e);return d};this._getStraightByDirAndRadius=function(a,
b,e,c,f){var l=[];d=[];d.push({radius:c,direction:null});var g=f[a][b].getColor();this._findInDirection(a,b,e,l,c,g,f);return l};this._getStraightRowByRadius=function(a,b,e){var c=[];d=[];d.push({radius:e,direction:null});this._findInDirection(a,b,DIR_LEFT,c,e);this._findInDirection(a,b,DIR_RIGHT,c,e);return c};this._getStraightColByRadius=function(a,b,e){var c=[];d=[];d.push({radius:e,direction:null});this._findInDirection(a,b,DIR_TOP,c,e);this._findInDirection(a,b,DIR_BOT,c,e);return c};this._findInDirection=
function(a,b,e,c,f,k,h){--f;if(null!==g[a][b][e]&&0<=f){var l=g[a][b][e].row;a=g[a][b][e].col;k?(b=h[l][a].getColor(),b!==k&&(null===b?(c.push({row:l,col:a}),d.push({radius:f,direction:e}),this._findInDirection(l,a,e,c,f,k,h)):(c.push({row:l,col:a}),d.push({radius:f,direction:e})))):(c.push({row:l,col:a}),d.push({radius:f,direction:e}),this._findInDirection(l,a,e,c,f,k,h))}};this._findTPos=function(a,b,e){var d=[];a=g[a][b][e];null!==a&&(a=g[a.row][a.col][e],null!==a&&(d=e===DIR_TOP||e===DIR_BOT?
this._getStraightRowByRadius(a.row,a.col,1):this._getStraightColByRadius(a.row,a.col,1)));return d};this.getMovesList=function(a,b,e){var d=[];switch(e[a][b].getType()){case PAWN:d=this.getPawnMove(a,b,e);break;case ROOK:d=this.getRookMove(a,b,e);break;case KNIGHT:d=this.getKnightMove(a,b,e);break;case BISHOP:d=this.getBishopMove(a,b,e);break;case QUEEN:d=this.getQueenMove(a,b,e);break;case KING:d=this.getKingMove(a,b,e)}return d};this.getPawnMove=function(a,b,e){var d=e[a][b].getColor(),c=[];if(d===
WHITE){var f=6===a?this._getStraightByDirAndRadius(a,b,DIR_TOP,2,e):this._getStraightByDirAndRadius(a,b,DIR_TOP,1,e);var g=this._getNeighborByDir(a,b,DIR_TOPRIGHT);null!==g&&e[g.row][g.col].getColor()===BLACK&&c.push(g);g=this._getNeighborByDir(a,b,DIR_TOPLEFT);null!==g&&e[g.row][g.col].getColor()===BLACK&&c.push(g);if(3===a)for(a=this._getEnPassant(WHITE,a,b,e),b=0;b<a.length;b++)c.push(a[b])}else if(f=1===a?this._getStraightByDirAndRadius(a,b,DIR_BOT,2,e):this._getStraightByDirAndRadius(a,b,DIR_BOT,
1,e),g=this._getNeighborByDir(a,b,DIR_BOTRIGHT),null!==g&&e[g.row][g.col].getColor()===WHITE&&c.push(g),g=this._getNeighborByDir(a,b,DIR_BOTLEFT),null!==g&&e[g.row][g.col].getColor()===WHITE&&c.push(g),4===a)for(a=this._getEnPassant(BLACK,a,b,e),b=0;b<a.length;b++)c.push(a[b]);for(b=f.length-1;0<=b;b--)null!==e[f[b].row][f[b].col].getColor()&&e[f[b].row][f[b].col].getColor()!==d&&f.splice(b,1);for(b=0;b<c.length;b++)f.push(c[b]);return f};this.getRookMove=function(a,b,e){var d=this._getRow(a,b,e);
a=this._getCol(a,b,e);b=[];for(e=0;e<d.length;e++)b.push(d[e]);for(e=0;e<a.length;e++)b.push(a[e]);return b};this.getKnightMove=function(a,b,e){var d=[];d.push(this._findTPos(a,b,DIR_TOP));d.push(this._findTPos(a,b,DIR_RIGHT));d.push(this._findTPos(a,b,DIR_BOT));d.push(this._findTPos(a,b,DIR_LEFT));for(var c=[],f=0;f<d.length;f++)for(var g=0;g<d[f].length;g++)c.push(d[f][g]);a=e[a][b].getColor();for(f=c.length-1;0<=f;f--)e[c[f].row][c[f].col].getColor()===a&&c.splice(f,1);return c};this.getBishopMove=
function(a,b,e){var d=this._getMainDiagonal(a,b,e);a=this._getSecondDiagonal(a,b,e);b=[];for(e=0;e<d.length;e++)b.push(d[e]);for(e=0;e<a.length;e++)b.push(a[e]);return b};this.getQueenMove=function(a,b,e){var d=this.getRookMove(a,b,e);a=this.getBishopMove(a,b,e);b=[];for(e=0;e<d.length;e++)b.push(d[e]);for(e=0;e<a.length;e++)b.push(a[e]);return b};this.getKingMove=function(a,b,e){var d=this._getAllNeighbor(a,b);if(1===e[a][b].getPieceHistory().length&&!s_oGame.isCheck()){var c=!0;1===e[a][7].getPieceHistory().length?
(null!==e[a][6].getColor()&&(c=!1),null!==e[a][5].getColor()&&(c=!1)):c=!1;c&&d.push({row:a,col:6});c=!0;1===e[a][0].getPieceHistory().length?(null!==e[a][1].getColor()&&(c=!1),null!==e[a][2].getColor()&&(c=!1),null!==e[a][3].getColor()&&(c=!1)):c=!1;c&&d.push({row:a,col:2})}a=e[a][b].getColor();for(b=d.length-1;0<=b;b--)e[d[b].row][d[b].col].getColor()===a&&d.splice(b,1);return d};this._getEnPassant=function(a,b,e,d){var c=[],f=s_oBoardStateController.getOtherOpponent(a),l=this._getNeighborByDir(b,
e,DIR_RIGHT);if(null!==l&&(l=d[l.row][l.col],l.getColor()===f&&l.getType()===PAWN)){l=l.getPieceHistory();var g=d[b][e].getPieceHistory();2===l.length&&g[g.length-1].id<l[1].id&&(a===WHITE?c.push(this._getNeighborByDir(b,e,DIR_TOPRIGHT)):c.push(this._getNeighborByDir(b,e,DIR_BOTRIGHT)))}l=this._getNeighborByDir(b,e,DIR_LEFT);null!==l&&(l=d[l.row][l.col],l.getColor()===f&&l.getType()===PAWN&&(l=l.getPieceHistory(),g=d[b][e].getPieceHistory(),2===l.length&&g[g.length-1].id<l[1].id&&(a===WHITE?c.push(this._getNeighborByDir(b,
e,DIR_TOPLEFT)):c.push(this._getNeighborByDir(b,e,DIR_BOTLEFT)))));return c};this._init(c);s_oMovesController=this}var s_oMovesController;
function CBoardStateController(){var c;this._init=function(){c=0};this.getOtherOpponent=function(c){return c===WHITE?BLACK:WHITE};this.moveCopiedPiece=function(c,f,g,d,a){var b=c[f][g];c[d][a].setCell(b.getColor(),b.getType(),d,a,b.getPieceHistory());b.setCell(null,null,f,g,[])};this.copyBoard=function(c){for(var f=[],g=0;g<c.length;g++){f[g]=[];for(var d=0;d<c[g].length;d++)f[g][d]=new CCopiedCell(c[g][d])}return f};this.getState=function(c,f){if(0!==this.findAllChecks(c,f).length)return this.findCheckMate(c,
f)?BOARD_STATE_CHECKMATE:BOARD_STATE_CHECK;if(this.findStaleMate(c,f))return BOARD_STATE_STALEMATE};this.findCheckMate=function(c,f){for(var g=[],d=0;d<f.length;d++)for(var a=0;a<f[d].length;a++)f[d][a].getColor()===c&&g.push(f[d][a]);for(d=0;d<g.length;d++){var b=s_oMovesController.getMovesList(g[d].getLogicPos().row,g[d].getLogicPos().col,f);for(a=0;a<b.length;a++){var e=this.copyBoard(f);this.moveCopiedPiece(e,g[d].getLogicPos().row,g[d].getLogicPos().col,b[a].row,b[a].col);if(0===this.findAllChecks(c,
e).length)return!1}}return!0};this.findAllChecks=function(c,f){for(var g=this.getOtherOpponent(c),d=[],a=0;a<f.length;a++)for(var b=0;b<f[a].length;b++)f[a][b].getColor()===g&&d.push(f[a][b]);g=[];for(a=0;a<d.length;a++){var e=d[a].getLogicPos();g[a]={list:s_oMovesController.getMovesList(e.row,e.col,f),piece:d[a]}}d=[];for(a=0;a<g.length;a++)for(b=0;b<g[a].list.length;b++)e=g[a].list[b],f[e.row][e.col].getColor()===c&&f[e.row][e.col].getType()===KING&&d.push(g[a].piece);return d};this.findStaleMate=
function(h,f){var g=this.findCheckMate(h,f);if(!g){for(var d=[],a=[],b=0;b<f.length;b++)for(var e=0;e<f[b].length;e++)f[b][e].getColor()===WHITE&&a.push(f[b][e].getType()),f[b][e].getColor()===BLACK&&d.push(f[b][e].getType());if(1===d.length&&1===a.length)return!0;if(1===d.length&&2===a.length||2===d.length&&1===a.length)if(b=a.indexOf(BISHOP)&&d.indexOf(BISHOP),e=a.indexOf(KNIGHT)&&d.indexOf(KNIGHT),0<=b||0<=e)return!0;if(2===d.length&&2===a.length&&(b=a.indexOf(BISHOP)||d.indexOf(BISHOP),0<=b)){d=
[];for(b=0;b<f.length;b++)for(e=0;e<f[b].length;e++)f[b][e].getType()===BISHOP&&d.push((b+e)%2);if(d[0]===d[1])return!0}}c===DRAW_COUNTER&&(g=!0);return g};this.increaseStallCount=function(){c++};this.resetStall=function(){c=0};this.checkPromotion=function(c){for(var f=null,g=0;g<c.length;g++)c[0][g].getType()===PAWN?f={row:0,col:g}:c[7][g].getType()===PAWN&&(f={row:7,col:g});return f};this.getSpecialMoves=function(c,f,g,d,a){c=a[c][f].getType();if(c===KING){f-=d;if(-2===f)return BOARD_SPECIAL_CASTLING_RIGHT;
if(2===f)return BOARD_SPECIAL_CASTLING_LEFT}else if(c===PAWN&&f!==d&&null===a[g][d].getType())return BOARD_SPECIAL_ENPASSANT};this._init();s_oBoardStateController=this}var s_oBoardStateController;
function CCopiedCell(c){var h,f,g,d,a;this._init=function(b){h=b.getColor();f=b.getType();d=b.getLogicPos().row;a=b.getLogicPos().col;b=b.getPieceHistory();g=[];for(var e=0;e<b.length;e++)g[e]=b[e]};this.setCell=function(b,e,c,m,k){h=b;f=e;d=c;a=m;for(b=0;b<k.length;b++)g[b]=k[b]};this.setColor=function(a){h=a};this.setType=function(a){f=a};this.getColor=function(){return h};this.getType=function(){return f};this.getLogicPos=function(){return{row:d,col:a}};this.getPieceHistory=function(){return g};
this._init(c)}
function CPromoPanel(c,h){var f,g,d,a,b,e,l;this._init=function(c,h){a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=0;s_oStage.addChild(a);(new createjs.Tween.get(a)).to({alpha:.7},500);var k=s_oSpriteLibrary.getSprite("msg_box");e=new createjs.Container;e.y=CANVAS_HEIGHT+k.height/2;s_oStage.addChild(e);g=createBitmap(k);g.regX=k.width/2;g.regY=k.height/2;g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT/2;e.addChild(g);b=new createjs.Shape;b.graphics.beginFill("#0f0f0f").drawRect(0,0,
CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.01;l=b.on("click",function(){});e.addChild(b);d=new createjs.Text(TEXT_PROMOTION,"40px "+PRIMARY_FONT,"#402604");d.textAlign="center";d.textBaseline="alphabetic";d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2-300;d.lineWidth=700;e.addChild(d);k=new createjs.Container;k.x=CANVAS_WIDTH/2;k.y=CANVAS_HEIGHT/2;e.addChild(k);var m=[];m[0]=BISHOP;m[1]=ROOK;m[2]=KNIGHT;m[3]=QUEEN;f=[];for(var p=0;p<m.length;p++){var r=s_oSpriteLibrary.getSprite(c+"_"+m[p]);f[p]=new CToggle(-200+
400/(m.length-1)*p,0,r,!0,k);f[p].addEventListenerWithParams(ON_MOUSE_UP,this._onPieceSelected,this,m[p])}(new createjs.Tween.get(e)).to({y:0},750,createjs.Ease.cubicOut)};this.unload=function(){b.off("click",l);s_oStage.removeChild(a);s_oStage.removeChild(e)};this._onPieceSelected=function(b){s_oGame.changePiece(b,h);b=s_oSpriteLibrary.getSprite("msg_box");b=CANVAS_HEIGHT+b.height/2;(new createjs.Tween.get(a)).to({alpha:0},500);(new createjs.Tween.get(e)).to({y:b},500,createjs.Ease.backIn).call(function(){m.unload();
s_oGame.onExitPromoPanel()})};this._init(c,h);var m=this}
function CAI(){var c,h,f,g,d;this._init=function(){};this.getMove=function(){var a=this._buildTree();a=d.getNode(a,1);return this._getBestNode(a)};this._getBestNode=function(a){if(0<a.length){for(var b=0;b<a.length;b++){var e=a[b].model.moves;this._makeMove(e);var d=s_oMovesControllerFaster.getState(WHITE,f);d===BOARD_STATE_CHECKMATE?a[b].model.rating+=.5:d===BOARD_STATE_STALEMATE&&(a[b].model.rating-=.5);this._unMakeMove(e)}e=a[0].model.rating;for(b=1;b<a.length;b++)a[b].model.rating>e&&(e=a[b].model.rating);
d=[];for(b=0;b<a.length;b++)a[b].model.rating===e&&d.push(a[b]);a=d[Math.floor(Math.random()*d.length)].model.moves}else a=null;return a};this._buildTree=function(){c=0;d=new CTreeDecision({rating:0,moves:[],depth:0});f=this._copyBoard(s_oGame.getCells());(new Date).getTime();h=this._maxi(0);(new Date).getTime();return h};this._alphaBetaMax=function(a,b,e){c++;if(e===SEARCH_DEPTH)return this._evaluateBoard();var l=this._findAllMoves(BLACK),g=l.moves;l=l.opponentlist;for(var k=g.length-1;0<=k;k--)if(this._makeMove(g[k]),
s_oMovesControllerFaster.isInCheck(BLACK,f,l))this._unMakeMove(g[k]),g.splice(k,1);else{var h=e+1;d.initNewNode(h);h=this._alphaBetaMin(a,b,h);d.addNode(e,h,g[k]);this._unMakeMove(g[k]);if(h>=b)return b;h>a&&(a=h)}return a};this._alphaBetaMin=function(a,b,e){c++;if(e===SEARCH_DEPTH)return this._evaluateBoard();var l=this._findAllMoves(WHITE),g=l.moves;l=l.opponentlist;for(var k=g.length-1;0<=k;k--)if(this._makeMove(g[k]),s_oMovesControllerFaster.isInCheck(WHITE,f,l))this._unMakeMove(g[k]),g.splice(k,
1);else{var h=e+1;d.initNewNode(h);h=this._alphaBetaMax(a,b,h);d.addNode(e,h,g[k]);this._unMakeMove(g[k]);if(h<=a)return a;h<b&&(b=h)}return b};this._evaluateBoard=function(){return 200*(g[BLACK][KING]-g[WHITE][KING])+9*(g[BLACK][QUEEN]-g[WHITE][QUEEN])+5*(g[BLACK][ROOK]-g[WHITE][ROOK])+3*(g[BLACK][BISHOP]-g[WHITE][BISHOP]+g[BLACK][KNIGHT]-g[WHITE][KNIGHT])+(g[BLACK][PAWN]-g[WHITE][PAWN])};this._findAllMoves=function(a){for(var b=[],e=[],d=0;d<NUM_CELL;d++)for(var c=0;c<NUM_CELL;c++)if(null!==f[d][c].type)if(f[d][c].color===
a)for(var g=s_oMovesControllerFaster.getMovesList(d,c,f),h=0;h<g.length;h++){var q=g[h].row,w=g[h].col;b.push({sourcerow:d,sourcecol:c,destrow:q,destcol:w,sourcetype:f[d][c].type,sourcecolor:f[d][c].color,sourcehistory:f[d][c].history,desttype:f[q][w].type,destcolor:f[q][w].color,desthistory:f[q][w].history})}else e.push({row:d,col:c});return{moves:b,opponentlist:e}};this._makeMove=function(a){null!==a.destcolor&&g[a.destcolor][a.desttype]--;f[a.destrow][a.destcol]={color:a.sourcecolor,type:a.sourcetype,
history:a.sourcehistory};f[a.sourcerow][a.sourcecol]={color:null,type:null,history:[]};0!==a.destrow&&7!==a.destrow||a.sourcetype!==PAWN||(f[a.destrow][a.destcol]={color:a.sourcecolor,type:QUEEN,history:a.sourcehistory},g[a.sourcecolor][PAWN]--,g[a.sourcecolor][QUEEN]++)};this._unMakeMove=function(a){null!==a.destcolor&&g[a.destcolor][a.desttype]++;f[a.sourcerow][a.sourcecol]={color:a.sourcecolor,type:a.sourcetype,history:a.sourcehistory};f[a.destrow][a.destcol]={color:a.destcolor,type:a.desttype,
history:a.desthistory};0!==a.destrow&&7!==a.destrow||a.sourcetype!==PAWN||(g[a.sourcecolor][PAWN]++,g[a.sourcecolor][QUEEN]--)};this.debugBoard=function(a){for(var b=[],d=0;d<NUM_CELL;d++){b[d]=[];for(var c=0;c<NUM_CELL;c++)b[d][c]=a[d][c].getType()+"_"+a[d][c].getColor()}};this._copyBoard=function(a){g=[BLACK,WHITE];g[BLACK]=[];g[WHITE]=[];g[BLACK][KING]=0;g[BLACK][QUEEN]=0;g[BLACK][ROOK]=0;g[BLACK][BISHOP]=0;g[BLACK][KNIGHT]=0;g[BLACK][PAWN]=0;g[WHITE][KING]=0;g[WHITE][QUEEN]=0;g[WHITE][ROOK]=0;
g[WHITE][BISHOP]=0;g[WHITE][KNIGHT]=0;g[WHITE][PAWN]=0;for(var b=[],d=0;d<NUM_CELL;d++){b[d]=[];for(var c=0;c<NUM_CELL;c++)b[d][c]={color:a[d][c].getColor(),type:a[d][c].getType(),history:a[d][c].getPieceHistory()},null!==a[d][c].getColor()&&g[b[d][c].color][b[d][c].type]++}return b};this._maxi=function(a){if(a===SEARCH_DEPTH)return this._evaluateBoard();var b=-INFINITE,e=this._findAllMoves(BLACK),c=e.moves;e=e.opponentlist;for(var g=a+1,k=c.length-1;0<=k;k--)if(this._makeMove(c[k]),s_oMovesControllerFaster.isInCheck(BLACK,
f,e))this._unMakeMove(c[k]),c.splice(k,1);else{d.initNewNode(g);var h=this._mini(g);d.addNode(a,h,c[k]);this._unMakeMove(c[k]);h>b&&(b=h)}return b};this._mini=function(a){if(a===SEARCH_DEPTH)return this._evaluateBoard();var b=INFINITE,e=this._findAllMoves(WHITE),c=e.moves;e=e.opponentlist;for(var g=a+1,k=c.length-1;0<=k;k--)if(this._makeMove(c[k]),s_oMovesControllerFaster.isInCheck(WHITE,f,e))this._unMakeMove(c[k]),c.splice(k,1);else{d.initNewNode(g);var h=this._maxi(g);d.addNode(a,h,c[k]);this._unMakeMove(c[k]);
h<b&&(b=h)}return b};this._init()}DIR_TOPRIGHT="DIR_TOPRIGHT";DIR_RIGHT="DIR_RIGHT";DIR_BOTRIGHT="DIR_BOTRIGHT";DIR_TOPLEFT="DIR_TOPLEFT";DIR_LEFT="DIR_LEFT";DIR_BOTLEFT="DIR_BOTLEFT";DIR_TOP="DIR_TOP";DIR_BOT="DIR_BOT";
function CMovesControllerFaster(c){var h,f,g;this._init=function(d){h=d.length;f=d[0].length;g=[];for(d=0;d<h;d++){g[d]=[];for(var a=0;a<f;a++)g[d][a]=[]}this._buildMap()};this._buildMap=function(){for(var d=0;d<h;d++)for(var a=0;a<f;a++)g[d][a][DIR_TOPRIGHT]=this._setNeighbor(d,a,DIR_TOPRIGHT),g[d][a][DIR_RIGHT]=this._setNeighbor(d,a,DIR_RIGHT),g[d][a][DIR_BOTRIGHT]=this._setNeighbor(d,a,DIR_BOTRIGHT),g[d][a][DIR_TOPLEFT]=this._setNeighbor(d,a,DIR_TOPLEFT),g[d][a][DIR_LEFT]=this._setNeighbor(d,a,
DIR_LEFT),g[d][a][DIR_BOTLEFT]=this._setNeighbor(d,a,DIR_BOTLEFT),g[d][a][DIR_TOP]=this._setNeighbor(d,a,DIR_TOP),g[d][a][DIR_BOT]=this._setNeighbor(d,a,DIR_BOT)};this._setNeighbor=function(d,a,b){var e=null;switch(b){case DIR_TOPRIGHT:0<d&&a<f-1&&(e={row:d-1,col:a+1});break;case DIR_RIGHT:a<f-1&&(e={row:d,col:a+1});break;case DIR_BOTRIGHT:d<h-1&&a<f-1&&(e={row:d+1,col:a+1});break;case DIR_TOPLEFT:0<d&&0<a&&(e={row:d-1,col:a-1});break;case DIR_LEFT:0<a&&(e={row:d,col:a-1});break;case DIR_BOTLEFT:d<
h-1&&0<a&&(e={row:d+1,col:a-1});break;case DIR_TOP:0<d&&(e={row:d-1,col:a});break;case DIR_BOT:d<h-1&&(e={row:d+1,col:a})}return e};this._getNeighborByDir=function(d,a,b){return g[d][a][b]};this._getAllNeighbor=function(d,a){var b=[],e;for(e in g[d][a])null!==g[d][a][e]&&b.push(g[d][a][e]);return b};this._getMainDiagonal=function(d,a,b){var e=[],c=b[d][a].color;this._findInDirection(d,a,DIR_BOTRIGHT,e,99,c,b);this._findInDirection(d,a,DIR_TOPLEFT,e,99,c,b);return e};this._getSecondDiagonal=function(d,
a,b){var e=[],c=b[d][a].color;this._findInDirection(d,a,DIR_BOTLEFT,e,99,c,b);this._findInDirection(d,a,DIR_TOPRIGHT,e,99,c,b);return e};this._getRow=function(d,a,b){var e=[],c=b[d][a].color;this._findInDirection(d,a,DIR_LEFT,e,99,c,b);this._findInDirection(d,a,DIR_RIGHT,e,99,c,b);return e};this._getCol=function(d,a,b){var e=[],c=b[d][a].color;this._findInDirection(d,a,DIR_TOP,e,99,c,b);this._findInDirection(d,a,DIR_BOT,e,99,c,b);return e};this._getStraightByDirAndRadius=function(d,a,b,e,c){var f=
[];this._findInDirection(d,a,b,f,e,c[d][a].color,c);return f};this._getStraightRowByRadius=function(d,a,b){var e=[];this._findInDirection(d,a,DIR_LEFT,e,b);this._findInDirection(d,a,DIR_RIGHT,e,b);return e};this._getStraightColByRadius=function(d,a,b){var e=[];this._findInDirection(d,a,DIR_TOP,e,b);this._findInDirection(d,a,DIR_BOT,e,b);return e};this._findInDirection=function(d,a,b,e,c,f,k){--c;if(null!==g[d][a][b]&&0<=c){var l=g[d][a][b].row;d=g[d][a][b].col;f?(a=k[l][d].color,a!==f&&(null===a?
(e.push({row:l,col:d}),this._findInDirection(l,d,b,e,c,f,k)):e.push({row:l,col:d}))):(e.push({row:l,col:d}),this._findInDirection(l,d,b,e,c,f,k))}};this._findTPos=function(d,a,b){var c=[];d=g[d][a][b];null!==d&&(d=g[d.row][d.col][b],null!==d&&(c=b===DIR_TOP||b===DIR_BOT?this._getStraightRowByRadius(d.row,d.col,1):this._getStraightColByRadius(d.row,d.col,1)));return c};this.getMovesList=function(d,a,b){var c=[];switch(b[d][a].type){case PAWN:c=this.getPawnMove(d,a,b);break;case ROOK:c=this.getRookMove(d,
a,b);break;case KNIGHT:c=this.getKnightMove(d,a,b);break;case BISHOP:c=this.getBishopMove(d,a,b);break;case QUEEN:c=this.getQueenMove(d,a,b);break;case KING:c=this.getKingMove(d,a,b)}return c};this.getPawnMove=function(d,a,b){var c=b[d][a].color,f=[];if(c===WHITE){var g=6===d?this._getStraightByDirAndRadius(d,a,DIR_TOP,2,b):this._getStraightByDirAndRadius(d,a,DIR_TOP,1,b);var k=this._getNeighborByDir(d,a,DIR_TOPRIGHT);null!==k&&b[k.row][k.col].color===BLACK&&f.push(k);k=this._getNeighborByDir(d,a,
DIR_TOPLEFT);null!==k&&b[k.row][k.col].color===BLACK&&f.push(k);if(3===d)for(d=this._getEnPassant(WHITE,d,a,b),a=0;a<d.length;a++)f.push(d[a])}else if(g=1===d?this._getStraightByDirAndRadius(d,a,DIR_BOT,2,b):this._getStraightByDirAndRadius(d,a,DIR_BOT,1,b),k=this._getNeighborByDir(d,a,DIR_BOTRIGHT),null!==k&&b[k.row][k.col].color===WHITE&&f.push(k),k=this._getNeighborByDir(d,a,DIR_BOTLEFT),null!==k&&b[k.row][k.col].color===WHITE&&f.push(k),4===d)for(d=this._getEnPassant(BLACK,d,a,b),a=0;a<d.length;a++)f.push(d[a]);
for(a=g.length-1;0<=a;a--)null!==b[g[a].row][g[a].col].color&&b[g[a].row][g[a].col].color!==c&&g.splice(a,1);for(a=0;a<f.length;a++)g.push(f[a]);return g};this.getRookMove=function(d,a,b){var c=this._getRow(d,a,b);d=this._getCol(d,a,b);a=[];for(b=0;b<c.length;b++)a.push(c[b]);for(b=0;b<d.length;b++)a.push(d[b]);return a};this.getKnightMove=function(d,a,b){var c=[];c.push(this._findTPos(d,a,DIR_TOP));c.push(this._findTPos(d,a,DIR_RIGHT));c.push(this._findTPos(d,a,DIR_BOT));c.push(this._findTPos(d,
a,DIR_LEFT));for(var f=[],g=0;g<c.length;g++)for(var k=0;k<c[g].length;k++)f.push(c[g][k]);d=b[d][a].color;for(g=f.length-1;0<=g;g--)b[f[g].row][f[g].col].color===d&&f.splice(g,1);return f};this.getBishopMove=function(d,a,b){var c=this._getMainDiagonal(d,a,b);d=this._getSecondDiagonal(d,a,b);a=[];for(b=0;b<c.length;b++)a.push(c[b]);for(b=0;b<d.length;b++)a.push(d[b]);return a};this.getQueenMove=function(d,a,b){var c=this.getRookMove(d,a,b);d=this.getBishopMove(d,a,b);a=[];for(b=0;b<c.length;b++)a.push(c[b]);
for(b=0;b<d.length;b++)a.push(d[b]);return a};this.getKingMove=function(d,a,b){var c=this._getAllNeighbor(d,a);if(1===b[d][a].history.length&&!s_oGame.isCheck()){var f=!0;1===b[d][7].history.length?(null!==b[d][6].color&&(f=!1),null!==b[d][5].color&&(f=!1)):f=!1;f&&c.push({row:d,col:6});f=!0;1===b[d][0].history.length?(null!==b[d][1].color&&(f=!1),null!==b[d][2].color&&(f=!1),null!==b[d][3].color&&(f=!1)):f=!1;f&&c.push({row:d,col:2})}d=b[d][a].color;for(a=c.length-1;0<=a;a--)b[c[a].row][c[a].col].color===
d&&c.splice(a,1);return c};this._getEnPassant=function(c,a,b,e){var d=[],f=s_oBoardStateController.getOtherOpponent(c),g=this._getNeighborByDir(a,b,DIR_RIGHT);null!==g&&(g=e[g.row][g.col],g.color===f&&g.type===PAWN&&(g=g.history,2===g.length&&(c===WHITE?d.push(this._getNeighborByDir(a,b,DIR_TOPRIGHT)):d.push(this._getNeighborByDir(a,b,DIR_BOTRIGHT)))));g=this._getNeighborByDir(a,b,DIR_LEFT);null!==g&&(g=e[g.row][g.col],g.color===f&&g.type===PAWN&&(g=g.history,2===g.length&&(c===WHITE?d.push(this._getNeighborByDir(a,
b,DIR_TOPLEFT)):d.push(this._getNeighborByDir(a,b,DIR_BOTLEFT)))));return d};this.getState=function(c,a){if(0!==this.findAllChecks(c,a).length)return this.findCheckMate(c,a)?BOARD_STATE_CHECKMATE:BOARD_STATE_CHECK;if(this.findStaleMate(c,a))return BOARD_STATE_STALEMATE};this.findCheckMate=function(c,a){for(var b=[],d=0;d<a.length;d++)for(var f=0;f<a[d].length;f++)a[d][f].color===c&&b.push({row:d,col:f});for(d=0;d<b.length;d++){var g=b[d].row,h=b[d].col,p=s_oMovesControllerFaster.getMovesList(g,h,
a);for(f=0;f<p.length;f++){var q=p[f].row,w=p[f].col;q={sourcerow:g,sourcecol:h,destrow:q,destcol:w,sourcetype:a[g][h].type,sourcecolor:a[g][h].color,sourcehistory:a[g][h].history,desttype:a[q][w].type,destcolor:a[q][w].color,desthistory:a[q][w].history};this._makeMove(a,q);if(0===this.findAllChecks(c,a).length)return!1;this._unMakeMove(a,q)}}return!0};this._makeMove=function(c,a){c[a.destrow][a.destcol]={color:a.sourcecolor,type:a.sourcetype,history:a.sourcehistory};c[a.sourcerow][a.sourcecol]={color:null,
type:null,history:[]};0!==a.destrow&&7!==a.destrow||a.sourcetype!==PAWN||(c[a.destrow][a.destcol]={color:a.sourcecolor,type:QUEEN,history:a.sourcehistory})};this._unMakeMove=function(c,a){c[a.sourcerow][a.sourcecol]={color:a.sourcecolor,type:a.sourcetype,history:a.sourcehistory};c[a.destrow][a.destcol]={color:a.destcolor,type:a.desttype,history:a.desthistory}};this.findStaleMate=function(c,a){var b=this.findCheckMate(c,a);if(!b){for(var d=[],f=[],g=0;g<a.length;g++)for(var h=0;h<a[g].length;h++)a[g][h].color===
WHITE&&f.push(a[g][h].type),a[g][h].color===BLACK&&d.push(a[g][h].type);if(1===d.length&&1===f.length)return!0;if(1===d.length&&2===f.length||2===d.length&&1===f.length)if(g=f.indexOf(BISHOP)&&d.indexOf(BISHOP),h=f.indexOf(KNIGHT)&&d.indexOf(KNIGHT),0<=g||0<=h)return!0;if(2===d.length&&2===f.length&&(g=f.indexOf(BISHOP)||d.indexOf(BISHOP),0<=g)){d=[];for(g=0;g<a.length;g++)for(h=0;h<a[g].length;h++)a[g][h].type===BISHOP&&d.push((g+h)%2);if(d[0]===d[1])return!0}}return b};this.isInCheck=function(c,
a,b){for(var d,f=0;f<b.length;f++){d=s_oMovesControllerFaster.getMovesList(b[f].row,b[f].col,a);for(var g=0;g<d.length;g++){var h=d[g];if(a[h.row][h.col].color===c&&a[h.row][h.col].type===KING)return!0}}return!1};this.findAllChecks=function(c,a){for(var b=s_oBoardStateController.getOtherOpponent(c),d=[],f=0;f<a.length;f++)for(var g=0;g<a[f].length;g++)a[f][g].color===b&&d.push({row:f,col:g});b=[];for(f=0;f<d.length;f++){var h=d[f];b[f]={list:s_oMovesControllerFaster.getMovesList(h.row,h.col,a),piece:d[f]}}d=
[];for(f=0;f<b.length;f++)for(g=0;g<b[f].list.length;g++)h=b[f].list[g],a[h.row][h.col].color===c&&a[h.row][h.col].type===KING&&d.push(b[f].piece);return d};this._init(c);s_oMovesControllerFaster=this}var s_oMovesControllerFaster;function extractHostname(c){c=-1<c.indexOf("://")?c.split("/")[2]:c.split("/")[0];c=c.split(":")[0];return c=c.split("?")[0]}function extractRootDomain(c){c=extractHostname(c);var h=c.split("."),f=h.length;2<f&&(c=h[f-2]+"."+h[f-1]);return c}
var getClosestTop=function(){var c=window,h=!1;try{for(;c.parent.document!==c.document;)if(c.parent.document)c=c.parent;else{h=!0;break}}catch(f){h=!0}return{topFrame:c,err:h}},getBestPageUrl=function(c){var h=c.topFrame,f="";if(c.err)try{try{f=window.top.location.href}catch(d){var g=window.location.ancestorOrigins;f=g[g.length-1]}}catch(d){f=h.document.referrer}else f=h.location.href;return f},TOPFRAMEOBJ=getClosestTop(),PAGE_URL=getBestPageUrl(TOPFRAMEOBJ);
function seekAndDestroy(){for(var c=extractRootDomain(PAGE_URL),h=[String.fromCharCode(99,111,100,101,116,104,105,115,108,97,98,46,99,111,109),String.fromCharCode(101,110,118,97,116,111,46,99,111,109),String.fromCharCode(99,111,100,101,99,97,110,121,111,110,46,99,111,109),String.fromCharCode(99,111,100,101,99,97,110,121,111,110,46,110,101,116)],f=0;f<h.length;f++)if(h[f]===c)return!0;return!1};