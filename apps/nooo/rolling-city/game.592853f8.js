!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="../../Users/mofier/site-home/vx-to-h5/dist/public",i(i.s=6)}([function(t,e,i){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){n=window}t.exports=n},function(t,e,i){"use strict";t.exports=new Proxy({},{get:function(t,e){var i=t[e];return void 0!==i&&null!==i?i:(i=window.PlatformAPI&&window.PlatformAPI[e],"[object Function]"===Object.prototype.toString.call(i)&&(i=i.bind(window.PlatformAPI)),i)},set:function(t,e,i){return t[e]=i,!0}})},function(t,e,i){(function(e,i,n,r){t.exports=function(){var t,a,s;return function t(e,i,n){function r(s,o){if(!i[s]){if(!e[s]){var l="function"==typeof _dereq_&&_dereq_;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return r(i||t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var a="function"==typeof _dereq_&&_dereq_,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,i){"use strict";e.exports=function(t){var e=t._SomePromiseArray;function i(t){var i=new e(t),n=i.promise();return i.setHowMany(1),i.setUnwrap(),i.init(),n}t.any=function(t){return i(t)},t.prototype.any=function(){return i(this)}}},{}],2:[function(t,i,n){"use strict";var r;try{throw new Error}catch(t){r=t}var a=t("schedule"),s=t("queue"),o=t("util");function l(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new s(16),this._normalQueue=new s(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=a}function h(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()}function c(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()}function u(t){this._normalQueue._pushOne(t),this._queueTick()}function _(t){for(;t.length()>0;)d(t)}function d(t){var e=t.shift();if("function"!=typeof e)e._settlePromises();else{var i=t.shift(),n=t.shift();e.call(i,n)}}l.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},l.prototype.hasCustomScheduler=function(){return this._customScheduler},l.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},l.prototype.disableTrampolineIfNecessary=function(){o.hasDevTools&&(this._trampolineEnabled=!1)},l.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},l.prototype.fatalError=function(t,i){i?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},l.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},o.hasDevTools?(l.prototype.invokeLater=function(t,e,i){this._trampolineEnabled?h.call(this,t,e,i):this._schedule(function(){setTimeout(function(){t.call(e,i)},100)})},l.prototype.invoke=function(t,e,i){this._trampolineEnabled?c.call(this,t,e,i):this._schedule(function(){t.call(e,i)})},l.prototype.settlePromises=function(t){this._trampolineEnabled?u.call(this,t):this._schedule(function(){t._settlePromises()})}):(l.prototype.invokeLater=h,l.prototype.invoke=c,l.prototype.settlePromises=u),l.prototype._drainQueues=function(){_(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,_(this._lateQueue)},l.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},l.prototype._reset=function(){this._isTickUsed=!1},i.exports=l,i.exports.firstLineError=r},{"queue":26,"schedule":29,"util":36}],3:[function(t,e,i){"use strict";e.exports=function(t,e,i,n){var r=!1,a=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(a,a,null,this,t)},o=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},l=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(a){r||(r=!0,t.prototype._propagateFrom=n.propagateFromFunction(),t.prototype._boundValue=n.boundValueFunction());var h=i(a),c=new t(e);c._propagateFrom(this,1);var u=this._target();if(c._setBoundTo(h),h instanceof t){var _={promiseRejectionQueued:!1,promise:c,target:u,bindingPromise:h};u._then(e,s,void 0,c,_),h._then(o,l,void 0,c,_),c._setOnCancel(h)}else c._resolveCallback(u);return c},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,i){return t.resolve(i).bind(e)}}},{}],4:[function(t,e,n){"use strict";var r;void 0!==i&&(r=i);var a=t("promise")();a.noConflict=function(){try{i===a&&(i=r)}catch(t){}return a},e.exports=a},{"promise":22}],5:[function(t,e,i){"use strict";var n=Object.create;if(n){var r=n(null),a=n(null);r[" size"]=a[" size"]=0}e.exports=function(e){var i=t("util"),n=i.canEvaluate;function r(t,n){var r;if(null!=t&&(r=t[n]),"function"!=typeof r){var a="Object "+i.classString(t)+" has no method '"+i.toString(n)+"'";throw new e.TypeError(a)}return r}function a(t){var e=this.pop(),i=r(t,e);return i.apply(t,this)}function s(t){return t[this]}function o(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}i.isIdentifier,e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(a,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e,i="number"==typeof t;if(i)e=o;else if(n){var r=(void 0)(t);e=null!==r?r:s}else e=s;return this._then(e,void 0,void 0,t,void 0)}}},{"util":36}],6:[function(t,e,i){"use strict";e.exports=function(e,i,n,r){var a=t("util"),s=a.tryCatch,o=a.errorObj,l=e._async;e.prototype.break=e.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var i=t._cancellationParent;if(null==i||!i._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=i}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(t,e){if(a.isArray(t))for(var i=0;i<t.length;++i)this._doInvokeOnCancel(t[i],e);else if(void 0!==t)if("function"==typeof t){if(!e){var n=s(t).call(this._boundValue());n===o&&(this._attachExtraTrace(n.e),l.throwLater(n.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"util":36}],7:[function(t,e,i){"use strict";e.exports=function(e){var i=t("util"),n=t("es5").keys,r=i.tryCatch,a=i.errorObj;return function(t,s,o){return function(l){var h=o._boundValue();t:for(var c=0;c<t.length;++c){var u=t[c];if(u===Error||null!=u&&u.prototype instanceof Error){if(l instanceof u)return r(s).call(h,l)}else if("function"==typeof u){var _=r(u).call(h,l);if(_===a)return _;if(_)return r(s).call(h,l)}else if(i.isObject(l)){for(var d=n(u),f=0;f<d.length;++f){var p=d[f];if(u[p]!=l[p])continue t}return r(s).call(h,l)}}return e}}}},{"es5":13,"util":36}],8:[function(t,e,i){"use strict";e.exports=function(t){var e=!1,i=[];function n(){this._trace=new n.CapturedTrace(r())}function r(){var t=i.length-1;if(t>=0)return i[t]}return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},n.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},n.prototype._popContext=function(){if(void 0!==this._trace){var t=i.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},n.CapturedTrace=null,n.create=function(){if(e)return new n},n.deactivateLongStackTraces=function(){},n.activateLongStackTraces=function(){var i=t.prototype._pushContext,a=t.prototype._popContext,s=t._peekContext,o=t.prototype._peekContext,l=t.prototype._promiseCreated;n.deactivateLongStackTraces=function(){t.prototype._pushContext=i,t.prototype._popContext=a,t._peekContext=s,t.prototype._peekContext=o,t.prototype._promiseCreated=l,e=!1},e=!0,t.prototype._pushContext=n.prototype._pushContext,t.prototype._popContext=n.prototype._popContext,t._peekContext=t.prototype._peekContext=r,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},n}},{}],9:[function(t,i,n){"use strict";i.exports=function(i,n){var r,a,s,o=i._getDomain,l=i._async,h=t("errors").Warning,c=t("util"),u=t("es5"),_=c.canAttachTrace,d=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,f=/\((?:timers\.js):\d+:\d+\)/,p=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,m=null,g=null,y=!1,v=!(0==c.env("BLUEBIRD_DEBUG")),S=!(0==c.env("BLUEBIRD_WARNINGS")||!v&&!c.env("BLUEBIRD_WARNINGS")),x=!(0==c.env("BLUEBIRD_LONG_STACK_TRACES")||!v&&!c.env("BLUEBIRD_LONG_STACK_TRACES")),E=0!=c.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(S||!!c.env("BLUEBIRD_W_FORGOTTEN_RETURN"));i.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},i.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout(function(){t._notifyUnhandledRejection()},1)}},i.prototype._notifyUnhandledRejectionIsHandled=function(){Y("rejectionHandled",r,void 0,this)},i.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},i.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},i.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),Y("unhandledRejection",a,t,this)}},i.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},i.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},i.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},i.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},i.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},i.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},i.prototype._warn=function(t,e,i){return H(t,e,i||this)},i.onPossiblyUnhandledRejection=function(t){var e=o();a="function"==typeof t?null===e?t:c.domainBind(e,t):void 0},i.onUnhandledRejectionHandled=function(t){var e=o();r="function"==typeof t?null===e?t:c.domainBind(e,t):void 0};var T=function(){};i.longStackTraces=function(){if(l.haveItemsQueued()&&!J.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!J.longStackTraces&&j()){var t=i.prototype._captureStackTrace,e=i.prototype._attachExtraTrace,r=i.prototype._dereferenceTrace;J.longStackTraces=!0,T=function(){if(l.haveItemsQueued()&&!J.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");i.prototype._captureStackTrace=t,i.prototype._attachExtraTrace=e,i.prototype._dereferenceTrace=r,n.deactivateLongStackTraces(),l.enableTrampoline(),J.longStackTraces=!1},i.prototype._captureStackTrace=F,i.prototype._attachExtraTrace=B,i.prototype._dereferenceTrace=U,n.activateLongStackTraces(),l.disableTrampolineIfNecessary()}},i.hasLongStackTraces=function(){return J.longStackTraces&&j()};var w=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return c.global.dispatchEvent(t),function(t,e){var i={detail:e,cancelable:!0};u.defineProperty(i,"promise",{value:e.promise}),u.defineProperty(i,"reason",{value:e.reason});var n=new CustomEvent(t.toLowerCase(),i);return!c.global.dispatchEvent(n)}}if("function"==typeof Event){var t=new Event("CustomEvent");return c.global.dispatchEvent(t),function(t,e){var i=new Event(t.toLowerCase(),{cancelable:!0});return i.detail=e,u.defineProperty(i,"promise",{value:e.promise}),u.defineProperty(i,"reason",{value:e.reason}),!c.global.dispatchEvent(i)}}var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),c.global.dispatchEvent(t),function(t,e){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t.toLowerCase(),!1,!0,e),!c.global.dispatchEvent(i)}}catch(t){}return function(){return!1}}(),C=c.isNode?function(){return e.emit.apply(e,arguments)}:c.global?function(t){var e="on"+t.toLowerCase(),i=c.global[e];return!!i&&(i.apply(c.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function b(t,e){return{promise:e}}var M={promiseCreated:b,promiseFulfilled:b,promiseRejected:b,promiseResolved:b,promiseCancelled:b,promiseChained:function(t,e,i){return{promise:e,child:i}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,i){return{reason:e,promise:i}},rejectionHandled:b},I=function(t){var e=!1;try{e=C.apply(null,arguments)}catch(t){l.throwLater(t),e=!0}var i=!1;try{i=w(t,M[t].apply(null,arguments))}catch(t){l.throwLater(t),i=!0}return i||e};function D(){return!1}function A(t,e,i){var n=this;try{t(e,i,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+c.toString(t));n._attachCancellationCallback(t)})}catch(t){return t}}function R(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?c.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function L(){return this._onCancelField}function P(t){this._onCancelField=t}function N(){this._cancellationParent=void 0,this._onCancelField=void 0}function O(t,e){if(0!=(1&e)){this._cancellationParent=t;var i=t._branchesRemainingToCancel;void 0===i&&(i=0),t._branchesRemainingToCancel=i+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}i.config=function(t){if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?i.longStackTraces():!t.longStackTraces&&i.hasLongStackTraces()&&T()),"warnings"in t){var e=t.warnings;J.warnings=!!e,E=J.warnings,c.isObject(e)&&"wForgottenReturn"in e&&(E=!!e.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!J.cancellation){if(l.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");i.prototype._clearCancellationData=N,i.prototype._propagateFrom=O,i.prototype._onCancel=L,i.prototype._setOnCancel=P,i.prototype._attachCancellationCallback=R,i.prototype._execute=A,V=O,J.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!J.monitoring?(J.monitoring=!0,i.prototype._fireEvent=I):!t.monitoring&&J.monitoring&&(J.monitoring=!1,i.prototype._fireEvent=D)),i},i.prototype._fireEvent=D,i.prototype._execute=function(t,e,i){try{t(e,i)}catch(t){return t}},i.prototype._onCancel=function(){},i.prototype._setOnCancel=function(t){},i.prototype._attachCancellationCallback=function(t){},i.prototype._captureStackTrace=function(){},i.prototype._attachExtraTrace=function(){},i.prototype._dereferenceTrace=function(){},i.prototype._clearCancellationData=function(){},i.prototype._propagateFrom=function(t,e){};var V=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function k(){var t=this._boundTo;return void 0!==t&&t instanceof i?t.isFulfilled()?t.value():void 0:t}function F(){this._trace=new Q(this._peekContext())}function B(t,e){if(_(t)){var i=this._trace;if(void 0!==i&&e&&(i=i._parent),void 0!==i)i.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=W(t);c.notEnumerableProp(t,"stack",n.message+"\n"+n.stack.join("\n")),c.notEnumerableProp(t,"__stackCleaned__",!0)}}}function U(){this._trace=void 0}function H(t,e,n){if(J.warnings){var r,a=new h(t);if(e)n._attachExtraTrace(a);else if(J.longStackTraces&&(r=i._peekContext()))r.attachExtraTrace(a);else{var s=W(a);a.stack=s.message+"\n"+s.stack.join("\n")}I("warning",a)||z(a,"",!0)}}function G(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],r="    (No stack trace)"===n||m.test(n),a=r&&K(n);r&&!a&&(y&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function W(t){var e=t.stack,i=t.toString();return e="string"==typeof e&&e.length>0?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var n=e[i];if("    (No stack trace)"===n||m.test(n))break}return i>0&&"SyntaxError"!=t.name&&(e=e.slice(i)),e}(t):["    (No stack trace)"],{message:i,stack:"SyntaxError"==t.name?e:G(e)}}function z(t,e,i){if("undefined"!=typeof console){var n;if(c.isObject(t)){var r=t.stack;n=e+g(r,t)}else n=e+String(t);"function"==typeof s?s(n,i):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function Y(t,e,i,n){var r=!1;try{"function"==typeof e&&(r=!0,"rejectionHandled"===t?e(n):e(i,n))}catch(t){l.throwLater(t)}"unhandledRejection"===t?I(t,i,n)||r||z(i,"Unhandled rejection "):I(t,n)}function X(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{if(e=t&&"function"==typeof t.toString?t.toString():c.toString(t),/\[object [a-zA-Z0-9$_]+\]/.test(e))try{var i=JSON.stringify(t);e=i}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){return t.length<41?t:t.substr(0,38)+"..."}(e)+">, no stack trace)"}function j(){return"function"==typeof $}var K=function(){return!1},q=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function Z(t){var e=t.match(q);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function Q(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);$(this,Q),e>32&&this.uncycle()}c.inherits(Q,Error),n.CapturedTrace=Q,Q.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},n=0,r=this;void 0!==r;++n)e.push(r),r=r._parent;for(var n=(t=this._length=n)-1;n>=0;--n){var a=e[n].stack;void 0===i[a]&&(i[a]=n)}for(var n=0;n<t;++n){var s=e[n].stack,o=i[s];if(void 0!==o&&o!==n){o>0&&(e[o-1]._parent=void 0,e[o-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var l=n>0?e[n-1]:this;o<t-1?(l._parent=e[o+1],l._parent.uncycle(),l._length=l._parent._length+1):(l._parent=void 0,l._length=1);for(var h=l._length+1,c=n-2;c>=0;--c)e[c]._length=h,h++;return}}}},Q.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=W(t),i=e.message,n=[e.stack],r=this;void 0!==r;)n.push(G(r.stack.split("\n"))),r=r._parent;!function(t){for(var e=t[0],i=1;i<t.length;++i){for(var n=t[i],r=e.length-1,a=e[r],s=-1,o=n.length-1;o>=0;--o)if(n[o]===a){s=o;break}for(var o=s;o>=0;--o){var l=n[o];if(e[r]!==l)break;e.pop(),r--}e=n}}(n),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(n),c.notEnumerableProp(t,"stack",function(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}(i,n)),c.notEnumerableProp(t,"__stackCleaned__",!0)}};var $=function t(){var e=/^\s*at\s*/,i=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():X(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,m=e,g=i;var n=Error.captureStackTrace;return K=function(t){return d.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r,a=new Error;if("string"==typeof a.stack&&a.stack.split("\n")[0].indexOf("stackDetection@")>=0)return m=/@/,g=i,y=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){r="stack"in t}return"stack"in a||!r||"number"!=typeof Error.stackTraceLimit?(g=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?X(e):e.toString()},null):(m=e,g=i,function t(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(s=function(t){console.warn(t)},c.isNode&&e.stderr.isTTY?s=function(t,e){var i=e?"[33m":"[31m";console.warn(i+t+"[0m\n")}:c.isNode||"string"!=typeof(new Error).stack||(s=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var J={warnings:S,longStackTraces:!1,cancellation:!1,monitoring:!1};return x&&i.longStackTraces(),{longStackTraces:function(){return J.longStackTraces},warnings:function(){return J.warnings},cancellation:function(){return J.cancellation},monitoring:function(){return J.monitoring},propagateFromFunction:function(){return V},boundValueFunction:function(){return k},checkForgottenReturns:function(t,e,i,n,r){if(void 0===t&&null!==e&&E){if(void 0!==r&&r._returnedNonUndefined())return;if(0==(65535&n._bitField))return;i&&(i+=" ");var a="",s="";if(e._trace){for(var o=e._trace.stack.split("\n"),l=G(o),h=l.length-1;h>=0;--h){var c=l[h];if(!f.test(c)){var u=c.match(p);u&&(a="at "+u[1]+":"+u[2]+":"+u[3]+" ");break}}if(l.length>0)for(var _=l[0],h=0;h<o.length;++h)if(o[h]===_){h>0&&(s="\n"+o[h-1]);break}}var d="a promise was created in a "+i+"handler "+a+"but was not returned from it, see http://goo.gl/rRqMUw"+s;n._warn(d,!0,e)}},setBounds:function(t,e){if(j()){for(var i,n,r=t.stack.split("\n"),a=e.stack.split("\n"),s=-1,o=-1,l=0;l<r.length;++l){var h=Z(r[l]);if(h){i=h.fileName,s=h.line;break}}for(var l=0;l<a.length;++l){var h=Z(a[l]);if(h){n=h.fileName,o=h.line;break}}s<0||o<0||!i||!n||i!==n||s>=o||(K=function(t){if(d.test(t))return!0;var e=Z(t);return!!(e&&e.fileName===i&&s<=e.line&&e.line<=o)})}},warn:H,deprecated:function(t,e){var i=t+" is deprecated and will be removed in a future version.";return e&&(i+=" Use "+e+" instead."),H(i)},CapturedTrace:Q,fireDomEvent:w,fireGlobalEvent:C}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(t,e,i){"use strict";e.exports=function(t){function e(){return this.value}function i(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(i){return i instanceof t&&i.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:i},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(i,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},t.prototype.catchReturn=function(i){if(arguments.length<=1)return i instanceof t&&i.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:i},void 0);var n=arguments[1];return n instanceof t&&n.suppressUnhandledRejections(),this.caught(i,function(){return n})}}},{}],11:[function(t,e,i){"use strict";e.exports=function(t,e){var i=t.reduce,n=t.all;function r(){return n(this)}t.prototype.each=function(t){return i(this,t,e,0)._then(r,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return i(this,t,e,e)},t.each=function(t,n){return i(t,n,e,0)._then(r,void 0,void 0,t,void 0)},t.mapSeries=function(t,n){return i(t,n,e,e)}}},{}],12:[function(t,e,i){"use strict";var n,r,a=t("./es5"),s=a.freeze,o=t("./util"),l=o.inherits,h=o.notEnumerableProp;function c(t,e){function i(n){if(!(this instanceof i))return new i(n);h(this,"message","string"==typeof n?n:e),h(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(i,Error),i}var u=c("Warning","warning"),_=c("CancellationError","cancellation error"),d=c("TimeoutError","timeout error"),f=c("AggregateError","aggregate error");try{n=TypeError,r=RangeError}catch(t){n=c("TypeError","type error"),r=c("RangeError","range error")}for(var p="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<p.length;++m)"function"==typeof Array.prototype[p[m]]&&(f.prototype[p[m]]=Array.prototype[p[m]]);a.defineProperty(f.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),f.prototype.isOperational=!0;var g=0;function y(t){if(!(this instanceof y))return new y(t);h(this,"name","OperationalError"),h(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(h(this,"message",t.message),h(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}f.prototype.toString=function(){var t=Array(4*g+1).join(" "),e="\n"+t+"AggregateError of:\n";g++,t=Array(4*g+1).join(" ");for(var i=0;i<this.length;++i){for(var n=this[i]===this?"[Circular AggregateError]":this[i]+"",r=n.split("\n"),a=0;a<r.length;++a)r[a]=t+r[a];n=r.join("\n"),e+=n+"\n"}return g--,e},l(y,Error);var v=Error.__BluebirdErrorTypes__;v||(v=s({CancellationError:_,TimeoutError:d,OperationalError:y,RejectionError:y,AggregateError:f}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:v,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:n,RangeError:r,CancellationError:v.CancellationError,OperationalError:v.OperationalError,TimeoutError:v.TimeoutError,AggregateError:v.AggregateError,Warning:u}},{"es5":13,"util":36}],13:[function(t,e,i){var n=function(){"use strict";return void 0===this}();if(n)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(i&&!i.writable&&!i.set)}};else{var r={}.hasOwnProperty,a={}.toString,s={}.constructor.prototype,o=function(t){var e=[];for(var i in t)r.call(t,i)&&e.push(i);return e};e.exports={isArray:function(t){try{return"[object Array]"===a.call(t)}catch(t){return!1}},keys:o,names:o,defineProperty:function(t,e,i){return t[e]=i.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return s}},isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,i){"use strict";e.exports=function(t,e){var i=t.map;t.prototype.filter=function(t,n){return i(this,t,n,e)},t.filter=function(t,n,r){return i(t,n,r,e)}}},{}],15:[function(t,e,i){"use strict";e.exports=function(e,i,n){var r=t("util"),a=e.CancellationError,s=r.errorObj,o=t("catch_filter")(n);function l(t,e,i){this.promise=t,this.type=e,this.handler=i,this.called=!1,this.cancelPromise=null}function h(t){this.finallyHandler=t}function c(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function u(){return d.call(this,this.promise._target()._settledValue())}function _(t){if(!c(this,t))return s.e=t,s}function d(t){var r=this.promise,o=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?o.call(r._boundValue()):o.call(r._boundValue(),t);if(l===n)return l;if(void 0!==l){r._setReturnedNonUndefined();var d=i(l,r);if(d instanceof e){if(null!=this.cancelPromise){if(d._isCancelled()){var f=new a("late cancellation observer");return r._attachExtraTrace(f),s.e=f,s}d.isPending()&&d._attachCancellationCallback(new h(this))}return d._then(u,_,void 0,this,void 0)}}}return r.isRejected()?(c(this),s.e=t,s):(c(this),t)}return l.prototype.isFinallyHandler=function(){return 0===this.type},h.prototype._resultCancelled=function(){c(this.finallyHandler)},e.prototype._passThrough=function(t,e,i,n){return"function"!=typeof t?this.then():this._then(i,n,void 0,new l(this,e,t),void 0)},e.prototype.lastly=e.prototype.finally=function(t){return this._passThrough(t,0,d,d)},e.prototype.tap=function(t){return this._passThrough(t,1,d)},e.prototype.tapCatch=function(t){var i=arguments.length;if(1===i)return this._passThrough(t,1,void 0,d);var n,a=new Array(i-1),s=0;for(n=0;n<i-1;++n){var l=arguments[n];if(!r.isObject(l))return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+r.classString(l)));a[s++]=l}a.length=s;var h=arguments[n];return this._passThrough(o(a,h,this),1,void 0,d)},l}},{"catch_filter":7,"util":36}],16:[function(t,e,i){"use strict";e.exports=function(e,i,n,r,a,s){var o=t("errors"),l=o.TypeError,h=t("util"),c=h.errorObj,u=h.tryCatch,_=[];function d(t,i,r,a){if(s.cancellation()){var o=new e(n),l=this._finallyPromise=new e(n);this._promise=o.lastly(function(){return l}),o._captureStackTrace(),o._setOnCancel(this)}else{var h=this._promise=new e(n);h._captureStackTrace()}this._stack=a,this._generatorFunction=t,this._receiver=i,this._generator=void 0,this._yieldHandlers="function"==typeof r?[r].concat(_):_,this._yieldedPromise=null,this._cancellationPhase=!1}h.inherits(d,a),d.prototype._isResolved=function(){return null===this._promise},d.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},d.prototype._promiseCancelled=function(){if(!this._isResolved()){var t,i=void 0!==this._generator.return;if(i)this._promise._pushContext(),t=u(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),t=u(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(t)}},d.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=u(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=u(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},d.prototype.promise=function(){return this._promise},d.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},d.prototype._continue=function(t){var i=this._promise;if(t===c)return this._cleanup(),this._cancellationPhase?i.cancel():i._rejectCallback(t.e,!1);var n=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?i.cancel():i._resolveCallback(n);var a=r(n,this._promise);if(a instanceof e||null!==(a=function(t,i,n){for(var a=0;a<i.length;++a){n._pushContext();var s=u(i[a])(t);if(n._popContext(),s===c){n._pushContext();var o=e.reject(c.e);return n._popContext(),o}var l=r(s,n);if(l instanceof e)return l}return null}(a,this._yieldHandlers,this._promise))){var s=(a=a._target())._bitField;0==(50397184&s)?(this._yieldedPromise=a,a._proxy(this,null)):0!=(33554432&s)?e._async.invoke(this._promiseFulfilled,this,a._value()):0!=(16777216&s)?e._async.invoke(this._promiseRejected,this,a._reason()):this._promiseCancelled()}else this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},e.coroutine=function(t,e){if("function"!=typeof t)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,n=d,r=(new Error).stack;return function(){var e=t.apply(this,arguments),a=new n(void 0,void 0,i,r),s=a.promise();return a._generator=e,a._promiseFulfilled(void 0),s}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new l("expecting a function but got "+h.classString(t));_.push(t)},e.spawn=function(t){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return i("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new d(t,this),r=n.promise();return n._run(e.spawn),r}}},{"./errors":12,"./util":36}],17:[function(t,e,i){"use strict";e.exports=function(e,i,n,r,a,s){var o=t("./util");o.canEvaluate,o.tryCatch,o.errorObj,e.join=function(){var t,e=arguments.length-1;e>0&&"function"==typeof arguments[e]&&(t=arguments[e]);var n=[].slice.call(arguments);t&&n.pop();var r=new i(n).promise();return void 0!==t?r.spread(t):r}}},{"./util":36}],18:[function(t,e,i){"use strict";e.exports=function(e,i,n,r,a,s){var o=e._getDomain,l=t("./util"),h=l.tryCatch,c=l.errorObj,u=e._async;function _(t,e,i,n){this.constructor$(t),this._promise._captureStackTrace();var r=o();this._callback=null===r?e:l.domainBind(r,e),this._preservedValues=n===a?new Array(this.length()):null,this._limit=i,this._inFlight=0,this._queue=[],u.invoke(this._asyncInit,this,void 0)}function d(t,i,r,a){if("function"!=typeof i)return n("expecting a function but got "+l.classString(i));var s=0;if(void 0!==r){if("object"!=typeof r||null===r)return e.reject(new TypeError("options argument must be an object but it is "+l.classString(r)));if("number"!=typeof r.concurrency)return e.reject(new TypeError("'concurrency' must be a number but it is "+l.classString(r.concurrency)));s=r.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new _(t,i,s,a).promise()}l.inherits(_,i),_.prototype._asyncInit=function(){this._init$(void 0,-2)},_.prototype._init=function(){},_.prototype._promiseFulfilled=function(t,i){var n=this._values,a=this.length(),o=this._preservedValues,l=this._limit;if(i<0){if(n[i=-1*i-1]=t,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return n[i]=t,this._queue.push(i),!1;null!==o&&(o[i]=t);var u=this._promise,_=this._callback,d=u._boundValue();u._pushContext();var f=h(_).call(d,t,i,a),p=u._popContext();if(s.checkForgottenReturns(f,p,null!==o?"Promise.filter":"Promise.map",u),f===c)return this._reject(f.e),!0;var m=r(f,this._promise);if(m instanceof e){var g=(m=m._target())._bitField;if(0==(50397184&g))return l>=1&&this._inFlight++,n[i]=m,m._proxy(this,-1*(i+1)),!1;if(0==(33554432&g))return 0!=(16777216&g)?(this._reject(m._reason()),!0):(this._cancel(),!0);f=m._value()}n[i]=f}var y=++this._totalResolved;return y>=a&&(null!==o?this._filter(n,o):this._resolve(n),!0)},_.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(i[n],n)}},_.prototype._filter=function(t,e){for(var i=e.length,n=new Array(i),r=0,a=0;a<i;++a)t[a]&&(n[r++]=e[a]);n.length=r,this._resolve(n)},_.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return d(this,t,e,null)},e.map=function(t,e,i,n){return d(t,e,i,n)}}},{"./util":36}],19:[function(t,e,i){"use strict";e.exports=function(e,i,n,r,a){var s=t("./util"),o=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var n=new e(i);n._captureStackTrace(),n._pushContext();var r=o(t).apply(this,arguments),s=n._popContext();return a.checkForgottenReturns(r,s,"Promise.method",n),n._resolveFromSyncValue(r),n}},e.attempt=e.try=function(t){if("function"!=typeof t)return r("expecting a function but got "+s.classString(t));var n,l=new e(i);if(l._captureStackTrace(),l._pushContext(),arguments.length>1){a.deprecated("calling Promise.try with more than 1 argument");var h=arguments[1],c=arguments[2];n=s.isArray(h)?o(t).apply(c,h):o(t).call(c,h)}else n=o(t)();var u=l._popContext();return a.checkForgottenReturns(n,u,"Promise.try",l),l._resolveFromSyncValue(n),l},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,i){"use strict";var n=t("./util"),r=n.maybeWrapAsError,a=t("./errors"),s=a.OperationalError,o=t("./es5"),l=/^(?:name|message|stack|cause)$/;function h(t){var e;if(function(t){return t instanceof Error&&o.getPrototypeOf(t)===Error.prototype}(t)){(e=new s(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var i=o.keys(t),r=0;r<i.length;++r){var a=i[r];l.test(a)||(e[a]=t[a])}return e}return n.markAsOriginatingFromRejection(t),t}e.exports=function(t,e){return function(i,n){if(null!==t){if(i){var a=h(r(i));t._attachExtraTrace(a),t._reject(a)}else if(e){var s=[].slice.call(arguments,1);t._fulfill(s)}else t._fulfill(n);t=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,i){"use strict";e.exports=function(e){var i=t("./util"),n=e._async,r=i.tryCatch,a=i.errorObj;function s(t,e){if(!i.isArray(t))return o.call(this,t,e);var s=r(e).apply(this._boundValue(),[null].concat(t));s===a&&n.throwLater(s.e)}function o(t,e){var i=this._boundValue(),s=void 0===t?r(e).call(i,null):r(e).call(i,null,t);s===a&&n.throwLater(s.e)}function l(t,e){if(!t){var i=new Error(t+"");i.cause=t,t=i}var s=r(e).call(this._boundValue(),t);s===a&&n.throwLater(s.e)}e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var i=o;void 0!==e&&Object(e).spread&&(i=s),this._then(i,l,void 0,this,t)}return this}}},{"./util":36}],22:[function(t,i,n){"use strict";i.exports=function(){var n=function(){return new f("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},r=function(){return new D.PromiseInspection(this._target())},a=function(t){return D.reject(new f(t))};function s(){}var o,l={},h=t("./util");o=h.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},h.notEnumerableProp(D,"_getDomain",o);var c=t("./es5"),u=t("./async"),_=new u;c.defineProperty(D,"_async",{value:_});var d=t("./errors"),f=D.TypeError=d.TypeError;D.RangeError=d.RangeError;var p=D.CancellationError=d.CancellationError;D.TimeoutError=d.TimeoutError,D.OperationalError=d.OperationalError,D.RejectionError=d.OperationalError,D.AggregateError=d.AggregateError;var m=function(){},g={},y={},v=t("./thenables")(D,m),S=t("./promise_array")(D,m,v,a,s),x=t("./context")(D),E=x.create,T=t("./debuggability")(D,x),w=(T.CapturedTrace,t("./finally")(D,v,y)),C=t("./catch_filter")(y),b=t("./nodeback"),M=h.errorObj,I=h.tryCatch;function D(t){t!==m&&function(t,e){if(null==t||t.constructor!==D)throw new f("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new f("expecting a function but got "+h.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function A(t){this.promise._resolveCallback(t)}function R(t){this.promise._rejectCallback(t,!1)}function L(t){var e=new D(m);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return D.prototype.toString=function(){return"[object Promise]"},D.prototype.caught=D.prototype.catch=function(t){var e=arguments.length;if(e>1){var i,n=new Array(e-1),r=0;for(i=0;i<e-1;++i){var s=arguments[i];if(!h.isObject(s))return a("Catch statement predicate: expecting an object but got "+h.classString(s));n[r++]=s}return n.length=r,t=arguments[i],this.then(void 0,C(n,t,this))}return this.then(void 0,t)},D.prototype.reflect=function(){return this._then(r,r,void 0,this,void 0)},D.prototype.then=function(t,e){if(T.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var i=".then() only accepts functions but was passed: "+h.classString(t);arguments.length>1&&(i+=", "+h.classString(e)),this._warn(i)}return this._then(t,e,void 0,void 0,void 0)},D.prototype.done=function(t,e){var i=this._then(t,e,void 0,void 0,void 0);i._setIsFinal()},D.prototype.spread=function(t){return"function"!=typeof t?a("expecting a function but got "+h.classString(t)):this.all()._then(t,void 0,void 0,g,void 0)},D.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},D.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new S(this).promise()},D.prototype.error=function(t){return this.caught(h.originatesFromRejection,t)},D.getNewLibraryCopy=i.exports,D.is=function(t){return t instanceof D},D.fromNode=D.fromCallback=function(t){var e=new D(m);e._captureStackTrace();var i=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=I(t)(b(e,i));return n===M&&e._rejectCallback(n.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},D.all=function(t){return new S(t).promise()},D.cast=function(t){var e=v(t);return e instanceof D||((e=new D(m))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},D.resolve=D.fulfilled=D.cast,D.reject=D.rejected=function(t){var e=new D(m);return e._captureStackTrace(),e._rejectCallback(t,!0),e},D.setScheduler=function(t){if("function"!=typeof t)throw new f("expecting a function but got "+h.classString(t));return _.setScheduler(t)},D.prototype._then=function(t,e,i,n,r){var a=void 0!==r,s=a?r:new D(m),l=this._target(),c=l._bitField;a||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&c)?this._boundValue():l===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var u=o();if(0!=(50397184&c)){var d,f,g=l._settlePromiseCtx;0!=(33554432&c)?(f=l._rejectionHandler0,d=t):0!=(16777216&c)?(f=l._fulfillmentHandler0,d=e,l._unsetRejectionIsUnhandled()):(g=l._settlePromiseLateCancellationObserver,f=new p("late cancellation observer"),l._attachExtraTrace(f),d=e),_.invoke(g,l,{handler:null===u?d:"function"==typeof d&&h.domainBind(u,d),promise:s,receiver:n,value:f})}else l._addCallbacks(t,e,s,n,u);return s},D.prototype._length=function(){return 65535&this._bitField},D.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},D.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},D.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},D.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},D.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},D.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},D.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},D.prototype._isFinal=function(){return(4194304&this._bitField)>0},D.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},D.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},D.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},D.prototype._setAsyncGuaranteed=function(){_.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},D.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==l)return void 0===e&&this._isBound()?this._boundValue():e},D.prototype._promiseAt=function(t){return this[4*t-4+2]},D.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},D.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},D.prototype._boundValue=function(){},D.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,i=t._rejectionHandler0,n=t._promise0,r=t._receiverAt(0);void 0===r&&(r=l),this._addCallbacks(e,i,n,r,null)},D.prototype._migrateCallbackAt=function(t,e){var i=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),r=t._promiseAt(e),a=t._receiverAt(e);void 0===a&&(a=l),this._addCallbacks(i,n,r,a,null)},D.prototype._addCallbacks=function(t,e,i,n,r){var a=this._length();if(a>=65531&&(a=0,this._setLength(0)),0===a)this._promise0=i,this._receiver0=n,"function"==typeof t&&(this._fulfillmentHandler0=null===r?t:h.domainBind(r,t)),"function"==typeof e&&(this._rejectionHandler0=null===r?e:h.domainBind(r,e));else{var s=4*a-4;this[s+2]=i,this[s+3]=n,"function"==typeof t&&(this[s+0]=null===r?t:h.domainBind(r,t)),"function"==typeof e&&(this[s+1]=null===r?e:h.domainBind(r,e))}return this._setLength(a+1),a},D.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},D.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(n(),!1);var i=v(t,this);if(!(i instanceof D))return this._fulfill(t);e&&this._propagateFrom(i,2);var r=i._target();if(r!==this){var a=r._bitField;if(0==(50397184&a)){var s=this._length();s>0&&r._migrateCallback0(this);for(var o=1;o<s;++o)r._migrateCallbackAt(this,o);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&a))this._fulfill(r._value());else if(0!=(16777216&a))this._reject(r._reason());else{var l=new p("late cancellation observer");r._attachExtraTrace(l),this._reject(l)}}else this._reject(n())}},D.prototype._rejectCallback=function(t,e,i){var n=h.ensureErrorObject(t),r=n===t;if(!r&&!i&&T.warnings()){var a="a promise was rejected with a non-error: "+h.classString(t);this._warn(a,!0)}this._attachExtraTrace(n,!!e&&r),this._reject(t)},D.prototype._resolveFromExecutor=function(t){if(t!==m){var e=this;this._captureStackTrace(),this._pushContext();var i=!0,n=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,i)});i=!1,this._popContext(),void 0!==n&&e._rejectCallback(n,!0)}},D.prototype._settlePromiseFromHandler=function(t,e,i,n){var r=n._bitField;if(0==(65536&r)){var a;n._pushContext(),e===g?i&&"number"==typeof i.length?a=I(t).apply(this._boundValue(),i):(a=M).e=new f("cannot .spread() a non-array: "+h.classString(i)):a=I(t).call(e,i);var s=n._popContext();0==(65536&(r=n._bitField))&&(a===y?n._reject(i):a===M?n._rejectCallback(a.e,!1):(T.checkForgottenReturns(a,s,"",n,this),n._resolveCallback(a)))}},D.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},D.prototype._followee=function(){return this._rejectionHandler0},D.prototype._setFollowee=function(t){this._rejectionHandler0=t},D.prototype._settlePromise=function(t,e,i,n){var a=t instanceof D,o=this._bitField,l=0!=(134217728&o);0!=(65536&o)?(a&&t._invokeInternalOnCancel(),i instanceof w&&i.isFinallyHandler()?(i.cancelPromise=t,I(e).call(i,n)===M&&t._reject(M.e)):e===r?t._fulfill(r.call(i)):i instanceof s?i._promiseCancelled(t):a||t instanceof S?t._cancel():i.cancel()):"function"==typeof e?a?(l&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,i,n,t)):e.call(i,n,t):i instanceof s?i._isResolved()||(0!=(33554432&o)?i._promiseFulfilled(n,t):i._promiseRejected(n,t)):a&&(l&&t._setAsyncGuaranteed(),0!=(33554432&o)?t._fulfill(n):t._reject(n))},D.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,i=t.promise,n=t.receiver,r=t.value;"function"==typeof e?i instanceof D?this._settlePromiseFromHandler(e,n,r,i):e.call(n,r,i):i instanceof D&&i._reject(r)},D.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},D.prototype._settlePromise0=function(t,e,i){var n=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,t,r,e)},D.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},D.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var i=n();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():_.settlePromises(this),this._dereferenceTrace())}},D.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return _.fatalError(t,h.isNode);(65535&e)>0?_.settlePromises(this):this._ensurePossibleRejectionHandled()}},D.prototype._fulfillPromises=function(t,e){for(var i=1;i<t;i++){var n=this._fulfillmentHandlerAt(i),r=this._promiseAt(i),a=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,a,e)}},D.prototype._rejectPromises=function(t,e){for(var i=1;i<t;i++){var n=this._rejectionHandlerAt(i),r=this._promiseAt(i),a=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,a,e)}},D.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var i=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,i,t),this._rejectPromises(e,i)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,t),this._fulfillPromises(e,n)}this._setLength(0)}this._clearCancellationData()},D.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},D.defer=D.pending=function(){T.deprecated("Promise.defer","new Promise");var t=new D(m);return{promise:t,resolve:A,reject:R}},h.notEnumerableProp(D,"_makeSelfResolutionError",n),t("./method")(D,m,v,a,T),t("./bind")(D,m,v,T),t("./cancel")(D,S,a,T),t("./direct_resolve")(D),t("./synchronous_inspection")(D),t("./join")(D,S,v,m,_,o),D.Promise=D,D.version="3.5.3",t("./map.js")(D,S,a,v,m,T),t("./call_get.js")(D),t("./using.js")(D,a,v,E,m,T),t("./timers.js")(D,m,T),t("./generators.js")(D,a,m,v,s,T),t("./nodeify.js")(D),t("./promisify.js")(D,m),t("./props.js")(D,S,v,a),t("./race.js")(D,m,v,a),t("./reduce.js")(D,S,a,v,m,T),t("./settle.js")(D,S,T),t("./some.js")(D,S,a),t("./filter.js")(D,m),t("./each.js")(D,m),t("./any.js")(D),h.toFastProperties(D),h.toFastProperties(D.prototype),L({a:1}),L({b:2}),L({c:3}),L(1),L(function(){}),L(void 0),L(!1),L(new D(m)),T.setBounds(u.firstLineError,h.lastLineError),D}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(t,e,i){"use strict";e.exports=function(e,i,n,r,a){var s=t("./util");function o(t){var n=this._promise=new e(i);t instanceof e&&n._propagateFrom(t,3),n._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return s.isArray,s.inherits(o,a),o.prototype.length=function(){return this._length},o.prototype.promise=function(){return this._promise},o.prototype._init=function t(i,a){var o=n(this._values,this._promise);if(o instanceof e){var l=(o=o._target())._bitField;if(this._values=o,0==(50397184&l))return this._promise._setAsyncGuaranteed(),o._then(t,this._reject,void 0,this,a);if(0==(33554432&l))return 0!=(16777216&l)?this._reject(o._reason()):this._cancel();o=o._value()}if(null!==(o=s.asArray(o)))0!==o.length?this._iterate(o):-5===a?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(a));else{var h=r("expecting an array or an iterable object but got "+s.classString(o)).reason();this._promise._rejectCallback(h,!1)}},o.prototype._iterate=function(t){var i=this.getActualLength(t.length);this._length=i,this._values=this.shouldCopyValues()?new Array(i):this._values;for(var r=this._promise,a=!1,s=null,o=0;o<i;++o){var l=n(t[o],r);l instanceof e?(l=l._target(),s=l._bitField):s=null,a?null!==s&&l.suppressUnhandledRejections():null!==s?0==(50397184&s)?(l._proxy(this,o),this._values[o]=l):a=0!=(33554432&s)?this._promiseFulfilled(l._value(),o):0!=(16777216&s)?this._promiseRejected(l._reason(),o):this._promiseCancelled(o):a=this._promiseFulfilled(l,o)}a||r._setAsyncGuaranteed()},o.prototype._isResolved=function(){return null===this._values},o.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},o.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},o.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},o.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var i=++this._totalResolved;return i>=this._length&&(this._resolve(this._values),!0)},o.prototype._promiseCancelled=function(){return this._cancel(),!0},o.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},o.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var i=0;i<t.length;++i)t[i]instanceof e&&t[i].cancel()}},o.prototype.shouldCopyValues=function(){return!0},o.prototype.getActualLength=function(t){return t},o}},{"./util":36}],24:[function(t,e,i){"use strict";e.exports=function(e,i){var n={},r=t("./util"),a=t("./nodeback"),s=r.withAppended,o=r.maybeWrapAsError,l=r.canEvaluate,h=t("./errors").TypeError,c={__isPromisified__:!0},u=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),_=function(t){return r.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function d(t){return!u.test(t)}function f(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function p(t,e,i){var n=r.getDataPropertyOrDefault(t,e+i,c);return!!n&&f(n)}function m(t,e,i){for(var n=0;n<t.length;n+=2){var r=t[n];if(i.test(r))for(var a=r.replace(i,""),s=0;s<t.length;s+=2)if(t[s]===a)throw new h("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}function g(t,e,i,n){for(var a=r.inheritedDataKeys(t),s=[],o=0;o<a.length;++o){var l=a[o],h=t[l],c=n===_||_(l,h,t);"function"!=typeof h||f(h)||p(t,l,e)||!n(l,h,t,c)||s.push(l,h)}return m(s,e,i),s}var y=function(t){return t.replace(/([$])/,"\\$")},v=l?void 0:function(t,l,h,c,u,_){var d=function(){return this}(),f=t;function p(){var r=l;l===n&&(r=this);var h=new e(i);h._captureStackTrace();var c="string"==typeof f&&this!==d?this[f]:t,u=a(h,_);try{c.apply(r,s(arguments,u))}catch(t){h._rejectCallback(o(t),!0,!0)}return h._isFateSealed()||h._setAsyncGuaranteed(),h}return"string"==typeof f&&(t=c),r.notEnumerableProp(p,"__isPromisified__",!0),p};function S(t,e,i,a,s){for(var o=new RegExp(y(e)+"$"),l=g(t,e,o,i),h=0,c=l.length;h<c;h+=2){var u=l[h],_=l[h+1],d=u+e;if(a===v)t[d]=v(u,n,u,_,e,s);else{var f=a(_,function(){return v(u,n,u,_,e,s)});r.notEnumerableProp(f,"__isPromisified__",!0),t[d]=f}}return r.toFastProperties(t),t}e.promisify=function(t,e){if("function"!=typeof t)throw new h("expecting a function but got "+r.classString(t));if(f(t))return t;var i=void 0===(e=Object(e)).context?n:e.context,a=!!e.multiArgs,s=function(t,e,i){return v(t,e,void 0,t,null,i)}(t,i,a);return r.copyDescriptors(t,s,d),s},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new h("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var i=!!(e=Object(e)).multiArgs,n=e.suffix;"string"!=typeof n&&(n="Async");var a=e.filter;"function"!=typeof a&&(a=_);var s=e.promisifier;if("function"!=typeof s&&(s=v),!r.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var o=r.inheritedDataKeys(t),l=0;l<o.length;++l){var c=t[o[l]];"constructor"!==o[l]&&r.isClass(c)&&(S(c.prototype,n,a,s,i),S(c,n,a,s,i))}return S(t,n,a,s,i)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(t,e,i){"use strict";e.exports=function(e,i,n,r){var a,s=t("./util"),o=s.isObject,l=t("./es5");"function"==typeof Map&&(a=Map);var h=function(){var t=0,e=0;function i(i,n){this[t]=i,this[t+e]=n,t++}return function(n){e=n.size,t=0;var r=new Array(2*n.size);return n.forEach(i,r),r}}();function c(t){var e,i=!1;if(void 0!==a&&t instanceof a)e=h(t),i=!0;else{var n=l.keys(t),r=n.length;e=new Array(2*r);for(var s=0;s<r;++s){var o=n[s];e[s]=t[o],e[s+r]=o}}this.constructor$(e),this._isMap=i,this._init$(void 0,i?-6:-3)}function u(t){var i,a=n(t);return o(a)?(i=a instanceof e?a._then(e.props,void 0,void 0,void 0,void 0):new c(a).promise(),a instanceof e&&i._propagateFrom(a,2),i):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}s.inherits(c,i),c.prototype._init=function(){},c.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var i=++this._totalResolved;if(i>=this._length){var n;if(this._isMap)n=function(t){for(var e=new a,i=t.length/2|0,n=0;n<i;++n){var r=t[i+n],s=t[n];e.set(r,s)}return e}(this._values);else{n={};for(var r=this.length(),s=0,o=this.length();s<o;++s)n[this._values[s+r]]=this._values[s]}return this._resolve(n),!0}return!1},c.prototype.shouldCopyValues=function(){return!1},c.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return u(this)},e.props=function(t){return u(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,i){"use strict";function n(t){this._capacity=t,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(t){return this._capacity<t},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var i=this._front+e&this._capacity-1;this[i]=t,this._length=e+1},n.prototype.push=function(t,e,i){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var r=this._front+n-3;this._checkCapacity(n);var a=this._capacity-1;this[r+0&a]=t,this[r+1&a]=e,this[r+2&a]=i,this._length=n},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var i=this._front,n=this._length,r=i+n&e-1;!function(t,e,i,n,r){for(var a=0;a<r;++a)i[a+n]=t[a+e],t[a+e]=void 0}(this,0,this,e,r)},e.exports=n},{}],27:[function(t,e,i){"use strict";e.exports=function(e,i,n,r){var a=t("./util"),s=function(t){return t.then(function(e){return o(e,t)})};function o(t,o){var l=n(t);if(l instanceof e)return s(l);if(null===(t=a.asArray(t)))return r("expecting an array or an iterable object but got "+a.classString(t));var h=new e(i);void 0!==o&&h._propagateFrom(o,3);for(var c=h._fulfill,u=h._reject,_=0,d=t.length;_<d;++_){var f=t[_];(void 0!==f||_ in t)&&e.cast(f)._then(c,u,void 0,h,null)}return h}e.race=function(t){return o(t,void 0)},e.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(t,e,i){"use strict";e.exports=function(e,i,n,r,a,s){var o=e._getDomain,l=t("./util"),h=l.tryCatch;function c(t,i,n,r){this.constructor$(t);var s=o();this._fn=null===s?i:l.domainBind(s,i),void 0!==n&&(n=e.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=r===a?Array(this._length):0===r?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function _(t,e,i,r){if("function"!=typeof e)return n("expecting a function but got "+l.classString(e));var a=new c(t,e,i,r);return a.promise()}function d(t){this.accum=t,this.array._gotAccum(t);var i=r(this.value,this.array._promise);return i instanceof e?(this.array._currentCancellable=i,i._then(f,void 0,void 0,this,void 0)):f.call(this,i)}function f(t){var i,n=this.array,r=n._promise,a=h(n._fn);r._pushContext(),(i=void 0!==n._eachValues?a.call(r._boundValue(),t,this.index,this.length):a.call(r._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(n._currentCancellable=i);var o=r._popContext();return s.checkForgottenReturns(i,o,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),i}l.inherits(c,i),c.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==a&&this._eachValues.push(t)},c.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},c.prototype._init=function(){},c.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},c.prototype.shouldCopyValues=function(){return!1},c.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},c.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel())},c.prototype._iterate=function(t){var i,n;this._values=t;var r=t.length;if(void 0!==this._initialValue?(i=this._initialValue,n=0):(i=e.resolve(t[0]),n=1),this._currentCancellable=i,!i.isRejected())for(;n<r;++n){var a={accum:null,value:t[n],index:n,length:r,array:this};i=i._then(d,void 0,void 0,a,void 0)}void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0)),i._then(u,u,void 0,i,this)},e.prototype.reduce=function(t,e){return _(this,t,e,null)},e.reduce=function(t,e,i,n){return _(t,e,i,n)}}},{"./util":36}],29:[function(t,i,a){"use strict";var s,o=t("./util"),l=o.getNativePromise();if(o.isNode&&"undefined"==typeof MutationObserver){var h=n.setImmediate,c=e.nextTick;s=o.isRecentNode?function(t){h.call(n,t)}:function(t){c.call(e,t)}}else if("function"==typeof l&&"function"==typeof l.resolve){var u=l.resolve();s=function(t){u.then(t)}}else s="undefined"==typeof MutationObserver||window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==r?function(t){r(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var t=document.createElement("div"),e={attributes:!0},i=!1,n=document.createElement("div"),r=new MutationObserver(function(){t.classList.toggle("foo"),i=!1});r.observe(n,e);var a=function(){i||(i=!0,n.classList.toggle("foo"))};return function(i){var n=new MutationObserver(function(){n.disconnect(),i()});n.observe(t,e),a()}}();i.exports=s},{"./util":36}],30:[function(t,e,i){"use strict";e.exports=function(e,i,n){var r=e.PromiseInspection,a=t("./util");function s(t){this.constructor$(t)}a.inherits(s,i),s.prototype._promiseResolved=function(t,e){this._values[t]=e;var i=++this._totalResolved;return i>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseFulfilled=function(t,e){var i=new r;return i._bitField=33554432,i._settledValueField=t,this._promiseResolved(e,i)},s.prototype._promiseRejected=function(t,e){var i=new r;return i._bitField=16777216,i._settledValueField=t,this._promiseResolved(e,i)},e.settle=function(t){return n.deprecated(".settle()",".reflect()"),new s(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(t,e,i){"use strict";e.exports=function(e,i,n){var r=t("./util"),a=t("./errors").RangeError,s=t("./errors").AggregateError,o=r.isArray,l={};function h(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function c(t,e){if((0|e)!==e||e<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new h(t),r=i.promise();return i.setHowMany(e),i.init(),r}r.inherits(h,i),h.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var t=o(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},h.prototype.init=function(){this._initialized=!0,this._init()},h.prototype.setUnwrap=function(){this._unwrap=!0},h.prototype.howMany=function(){return this._howMany},h.prototype.setHowMany=function(t){this._howMany=t},h.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},h.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},h.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},h.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new s,e=this.length();e<this._values.length;++e)this._values[e]!==l&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},h.prototype._fulfilled=function(){return this._totalResolved},h.prototype._rejected=function(){return this._values.length-this.length()},h.prototype._addRejected=function(t){this._values.push(t)},h.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},h.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},h.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},h.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return c(t,e)},e.prototype.some=function(t){return c(this,t)},e._SomePromiseArray=h}},{"./errors":12,"./util":36}],32:[function(t,e,i){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var i=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},a=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},o=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return a.call(this._target())},t.prototype.isFulfilled=function(){return r.call(this._target())},t.prototype.isResolved=function(){return o.call(this._target())},t.prototype.value=function(){return i.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,i){"use strict";e.exports=function(e,i){var n=t("./util"),r=n.errorObj,a=n.isObject;var s={}.hasOwnProperty;function o(t,a,s){var o=new e(i),l=o;s&&s._pushContext(),o._captureStackTrace(),s&&s._popContext();var h=!0,c=n.tryCatch(a).call(t,function(t){o&&(o._resolveCallback(t),o=null)},function(t){o&&(o._rejectCallback(t,h,!0),o=null)});return h=!1,o&&c===r&&(o._rejectCallback(c.e,!0,!0),o=null),l}return function(t,n){if(a(t)){if(t instanceof e)return t;var l=function(t){try{return function(t){return t.then}(t)}catch(t){return r.e=t,r}}(t);if(l===r){n&&n._pushContext();var h=e.reject(l.e);return n&&n._popContext(),h}if("function"==typeof l){if(function(t){try{return s.call(t,"_promise0")}catch(t){return!1}}(t)){var h=new e(i);return t._then(h._fulfill,h._reject,void 0,h,null),h}return o(t,l,n)}}return t}}},{"./util":36}],34:[function(t,e,i){"use strict";e.exports=function(e,i,n){var r=t("./util"),a=e.TimeoutError;function s(t){this.handle=t}s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var o=function(t){return l(+this).thenReturn(t)},l=e.delay=function(t,r){var a,l;return void 0!==r?(a=e.resolve(r)._then(o,null,null,t,void 0),n.cancellation()&&r instanceof e&&a._setOnCancel(r)):(a=new e(i),l=setTimeout(function(){a._fulfill()},+t),n.cancellation()&&a._setOnCancel(new s(l)),a._captureStackTrace()),a._setAsyncGuaranteed(),a};e.prototype.delay=function(t){return l(t,this)};var h=function(t,e,i){var n;n="string"!=typeof e?e instanceof Error?e:new a("operation timed out"):new a(e),r.markAsOriginatingFromRejection(n),t._attachExtraTrace(n),t._reject(n),null!=i&&i.cancel()};function c(t){return clearTimeout(this.handle),t}function u(t){throw clearTimeout(this.handle),t}e.prototype.timeout=function(t,e){var i,r;t=+t;var a=new s(setTimeout(function(){i.isPending()&&h(i,e,r)},t));return n.cancellation()?(r=this.then(),(i=r._then(c,u,void 0,a,void 0))._setOnCancel(a)):i=this._then(c,u,void 0,a,void 0),i}}},{"./util":36}],35:[function(t,e,i){"use strict";e.exports=function(e,i,n,r,a,s){var o=t("./util"),l=t("./errors").TypeError,h=t("./util").inherits,c=o.errorObj,u=o.tryCatch,_={};function d(t){setTimeout(function(){throw t},0)}function f(t,i){var r=0,s=t.length,o=new e(a);return function a(){if(r>=s)return o._fulfill();var l=function(t){var e=n(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(t[r++]);if(l instanceof e&&l._isDisposable()){try{l=n(l._getDisposer().tryDispose(i),t.promise)}catch(t){return d(t)}if(l instanceof e)return l._then(a,d,null,null,null)}a()}(),o}function p(t,e,i){this._data=t,this._promise=e,this._context=i}function m(t,e,i){this.constructor$(t,e,i)}function g(t){return p.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function y(t){this.length=t,this.promise=null,this[t-1]=null}p.prototype.data=function(){return this._data},p.prototype.promise=function(){return this._promise},p.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():_},p.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();var n=e!==_?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,n},p.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},h(m,p),m.prototype.doDispose=function(t,e){var i=this.data();return i.call(t,t,e)},y.prototype._resultCancelled=function(){for(var t=this.length,i=0;i<t;++i){var n=this[i];n instanceof e&&n.cancel()}},e.using=function(){var t=arguments.length;if(t<2)return i("you must pass at least 2 arguments to Promise.using");var r,a=arguments[t-1];if("function"!=typeof a)return i("expecting a function but got "+o.classString(a));var l=!0;2===t&&Array.isArray(arguments[0])?(r=arguments[0],t=r.length,l=!1):(r=arguments,t--);for(var h=new y(t),_=0;_<t;++_){var d=r[_];if(p.isDisposer(d)){var m=d;(d=d.promise())._setDisposable(m)}else{var v=n(d);v instanceof e&&(d=v._then(g,null,null,{resources:h,index:_},void 0))}h[_]=d}for(var S=new Array(h.length),_=0;_<S.length;++_)S[_]=e.resolve(h[_]).reflect();var x=e.all(S).then(function(t){for(var e=0;e<t.length;++e){var i=t[e];if(i.isRejected())return c.e=i.error(),c;if(!i.isFulfilled())return void x.cancel();t[e]=i.value()}E._pushContext(),a=u(a);var n=l?a.apply(void 0,t):a(t),r=E._popContext();return s.checkForgottenReturns(n,r,"Promise.using",E),n}),E=x.lastly(function(){var t=new e.PromiseInspection(x);return f(h,t)});return h.promise=E,E._setOnCancel(h),E},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new m(t,this,r());throw new l}}},{"./errors":12,"./util":36}],36:[function(t,n,r){"use strict";var a=t("./es5"),s="undefined"==typeof navigator,o={e:{}},l,h="undefined"!=typeof self?self:window;function c(){try{var t=l;return l=null,t.apply(this,arguments)}catch(t){return o.e=t,o}}function u(t){return l=t,c}var _=function(t,e){var i={}.hasOwnProperty;function n(){for(var n in this.constructor=t,this.constructor$=e,e.prototype)i.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}return n.prototype=e.prototype,t.prototype=new n,t.prototype};function d(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function f(t){return"function"==typeof t||"object"==typeof t&&null!==t}function p(t){return d(t)?new Error(M(t)):t}function m(t,e){var i,n=t.length,r=new Array(n+1);for(i=0;i<n;++i)r[i]=t[i];return r[i]=e,r}function g(t,e,i){if(!a.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var n=Object.getOwnPropertyDescriptor(t,e);return null!=n?null==n.get&&null==n.set?n.value:i:void 0}function y(t,e,i){if(d(t))return t;var n={value:i,configurable:!0,enumerable:!1,writable:!0};return a.defineProperty(t,e,n),t}function v(t){throw t}var S=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1};if(a.isES5){var i=Object.getOwnPropertyNames;return function(t){for(var n=[],r=Object.create(null);null!=t&&!e(t);){var s;try{s=i(t)}catch(t){return n}for(var o=0;o<s.length;++o){var l=s[o];if(!r[l]){r[l]=!0;var h=Object.getOwnPropertyDescriptor(t,l);null!=h&&null==h.get&&null==h.set&&n.push(l)}}t=a.getPrototypeOf(t)}return n}}var n={}.hasOwnProperty;return function(i){if(e(i))return[];var r=[];t:for(var a in i)if(n.call(i,a))r.push(a);else{for(var s=0;s<t.length;++s)if(n.call(t[s],a))continue t;r.push(a)}return r}}(),x=/this\s*\.\s*\S+\s*=/;function E(t){try{if("function"==typeof t){var e=a.names(t.prototype),i=a.isES5&&e.length>1,n=e.length>0&&!(1===e.length&&"constructor"===e[0]),r=x.test(t+"")&&a.names(t).length>0;if(i||n||r)return!0}return!1}catch(t){return!1}}function T(t){function e(){}e.prototype=t;var i=new e;function n(){return typeof i.foo}return n(),n(),t}var w=/^[a-z$_][a-z$_0-9]*$/i;function C(t){return w.test(t)}function b(t,e,i){for(var n=new Array(t),r=0;r<t;++r)n[r]=e+r+i;return n}function M(t){try{return t+""}catch(t){return"[no string representation]"}}function I(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function D(t){try{y(t,"isOperational",!0)}catch(t){}}function A(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function R(t){return I(t)&&a.propertyIsWritable(t,"stack")}var L="stack"in new Error?function(t){return R(t)?t:new Error(M(t))}:function(t){if(R(t))return t;try{throw new Error(M(t))}catch(t){return t}};function P(t){return{}.toString.call(t)}function N(t,e,i){for(var n=a.names(t),r=0;r<n.length;++r){var s=n[r];if(i(s))try{a.defineProperty(e,s,a.getDescriptor(t,s))}catch(t){}}}var O=function(t){return a.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var V="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,i=[],n=t[Symbol.iterator]();!(e=n.next()).done;)i.push(e.value);return i};O=function(t){return a.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?V(t):null}}var k=void 0!==e&&"[object process]"===P(e).toLowerCase(),F=void 0!==e&&void 0!==e.env;function B(t){return F?e.env[t]:void 0}function U(){if("function"==typeof i)try{var t=new i(function(){});if("[object Promise]"==={}.toString.call(t))return i}catch(t){}}function H(t,e){return t.bind(e)}var G={isClass:E,isIdentifier:C,inheritedDataKeys:S,getDataPropertyOrDefault:g,thrower:v,isArray:a.isArray,asArray:O,notEnumerableProp:y,isPrimitive:d,isObject:f,isError:I,canEvaluate:s,errorObj:o,tryCatch:u,inherits:_,withAppended:m,maybeWrapAsError:p,toFastProperties:T,filledRange:b,toString:M,canAttachTrace:R,ensureErrorObject:L,originatesFromRejection:A,markAsOriginatingFromRejection:D,classString:P,copyDescriptors:N,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:k,hasEnvVariables:F,env:B,global:h,getNativePromise:U,domainBind:H},W;G.isRecentNode=G.isNode&&(W=e.versions.node.split(".").map(Number),0===W[0]&&W[1]>10||W[0]>0),G.isNode&&G.toFastProperties(e);try{throw new Error}catch(W){G.lastLineError=W}n.exports=G},{"./es5":13}]},{},[4])(4)}(),null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,i(3),i(2),i(0),i(8).setImmediate)},function(t,e){var i,n,r=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(i===setTimeout)return setTimeout(t,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(t){i=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var l,h=[],c=!1,u=-1;function _(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&d())}function d(){if(!c){var t=o(_);c=!0;for(var e=h.length;e;){for(l=h,h=[];++u<e;)l&&l[u].run();u=-1,e=h.length}l=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new f(t,e)),1!==h.length||c||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&t.__esModule?t:{default:t}}},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(e){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?t.exports=n=function(t){return i(t)}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)},n(e)}t.exports=n},function(t,e,i){"use strict";i(7),i(11)},function(t,e,i){},function(t,e,i){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function a(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new a(r.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new a(r.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(9),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(0))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var n,r=1,a={},s=!1,o=t.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(t);l=l&&l.setTimeout?l:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick(function(){c(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?function(){var e="setImmediate$"+Math.random()+"$",i=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(e)&&c(+i.data.slice(e.length))};t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),n=function(i){t.postMessage(e+i,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){c(t.data)},n=function(e){t.port2.postMessage(e)}}():o&&"onreadystatechange"in o.createElement("script")?function(){var t=o.documentElement;n=function(e){var i=o.createElement("script");i.onreadystatechange=function(){c(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}():n=function(t){setTimeout(c,0,t)},l.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var s={callback:t,args:e};return a[r]=s,n(r),r++},l.clearImmediate=h}function h(t){delete a[t]}function c(t){if(s)setTimeout(c,0,t);else{var e=a[t];if(e){s=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}(e)}finally{h(t),s=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(0),i(3))},function(t,e,i){"use strict";e.app_key="6c9e85667e436e7f3f846becad2de8f1",e.getLocation=!1},function(module,exports,__webpack_require__){"use strict";(function(wx){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,_interopRequireDefault=__webpack_require__(4),_typeof2=_interopRequireDefault(__webpack_require__(5));function createCmdType(t){var e=new CmdType(t);return CmdMap.addCmd(e),e}function traceLog(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Configs.isPrint&&console.log(t)}function traceError(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Configs.isPrint&&console.error(t)}function Utf8ArrayToStr(t){var e,i,n,r,a,s;for(e="",n=t.length,i=0;i<n;)switch((r=t[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(r);break;case 12:case 13:a=t[i++],e+=String.fromCharCode((31&r)<<6|63&a);break;case 14:a=t[i++],s=t[i++],e+=String.fromCharCode((15&r)<<12|(63&a)<<6|(63&s)<<0)}return e}function EnableDebug(t){return void 0===t&&(t=!0),t?(DebugView.Instance.show(),"开启调试成功"):DebugView.isConstruct?(DebugView.Instance.release(),"关闭调试成功"):void 0}var Laya=window.Laya=(t=window,document,i={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,e){return 1==arguments.length?i.__presubstr.call(this,t):i.__presubstr.call(this,t,e>0?e:this.length+e)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var n=0;n<t;n++)i[n]=e;return i},__extend:function(t,e){function n(){i.un(this,"constructor",t)}for(var r in e)if(e.hasOwnProperty(r)){var a=Object.getOwnPropertyDescriptor(e,r),s=a.get,o=a.set;s||o?s&&o?Object.defineProperty(t,r,a):(s&&Object.defineProperty(t,r,s),o&&Object.defineProperty(t,r,o)):t[r]=e[r]}n.prototype=e.prototype,t.prototype=new n,i.un(t.prototype,"__imps",i.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;for(var i in t=t||{},e)t[i]=e[i];return t},__package:function(e,n){if(!i.__packages[e]){i.__packages[e]=!0;var r=t,a=e.split(".");if(a.length>1)for(var s=0,o=a.length-1;s<o;s++){r=r[a[s]]||(r[a[s]]={})}r[a[a.length-1]]||(r[a[a.length-1]]=n||{})}},__hasOwnProperty:function(t,e){return e=e||this,Object.hasOwnProperty.call(e,t)||function t(e,i){if(Object.hasOwnProperty.call(i.prototype,e))return!0;var n=i.prototype.__super;return null==n?null:t(e,n)}(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e===String)return"string"==typeof t;if(e===Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},__int:function(t){return t?parseInt(t):0},interface:function(e,n){i.__package(e,{});var r=i.__internals,a=r[e]=r[e]||{self:e};if(n){var s=n.split(",");for(a.extend=[],c=0;c<s.length;c++){var o=s[c];r[o]=r[o]||{self:o},a.extend.push(r[o])}}for(var l=t,h=e.split("."),c=0;c<h.length-1;c++)l=l[h[c]];l[h[h.length-1]]={__interface__:e}},class:function(e,n,r,a){if(r&&i.__extend(e,r),n)if(i.__package(n,e),i.__classmap[n]=e,n.indexOf(".")>0){if(0==n.indexOf("laya.")){var s=n.split(".");a=a||s[s.length-1],i[a]&&console.log("Warning!,this class["+a+"] already exist:",i[a]),i[a]=e}}else"Main"==n?t.Main=e:(i[n]&&console.log("Error!,this class["+n+"] already exist:",i[n]),i[n]=e);var o=i.un,l=e.prototype;o(l,"hasOwnProperty",i.__hasOwnProperty),o(l,"__class",e),o(l,"__super",r),o(l,"__className",n),o(e,"__super",r),o(e,"__className",n),o(e,"__isclass",!0),o(e,"super",function(t){this.__super.call(t)})},imps:function(t,e){function n(t){var e,a;if((e=i.__internals[t])&&(r[t]=!0,a=e.extend))for(var s=0;s<a.length;s++)n(a[s].self)}if(!e)return null;var r=t.__imps||i.un(t,"__imps",{});for(var a in e)n(a)},superSet:function(t,e,i,n){var r=t.prototype["_$set_"+i];r&&r.call(e,n)},superGet:function(t,e,i){var n=t.prototype["_$get_"+i];return n?n.call(e):null},getset:function(t,e,n,r,a){t?(r&&(e["_$GET_"+n]=r),a&&(e["_$SET_"+n]=a)):(r&&i.un(e,"_$get_"+n,r),a&&i.un(e,"_$set_"+n,a)),r&&a?Object.defineProperty(e,n,{get:r,set:a,enumerable:!1,configurable:!0}):(r&&Object.defineProperty(e,n,{get:r,enumerable:!1,configurable:!0}),a&&Object.defineProperty(e,n,{set:a,enumerable:!1,configurable:!0}))},static:function(t,e){for(var i=0,n=e.length;i<n;i+=2)"length"==e[i]?t.length=e[i+1].call(t):function(){var n=e[i],r=e[i+1];Object.defineProperty(t,n,{get:function(){return delete this[n],this[n]=r.call(this)},set:function(t){delete this[n],this[n]=t},enumerable:!0,configurable:!0})}()},un:function(t,e,n){return n||(n=t[e]),i.__propun.value=n,Object.defineProperty(t,e,i.__propun),n},uns:function(t,e){e.forEach(function(e){i.un(t,e)})}},t.console=t.console||{log:function(){}},t.trace=t.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),i),t,i;!function(t,e,i){i.un,i.uns,i.static,i.class,i.getset,i.__newvec}(window,document,Laya),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,a=i.getset;i.__newvec,i.interface("laya.runtime.IMarket"),i.interface("laya.filters.IFilter"),i.interface("laya.display.ILayout"),i.interface("laya.resource.IDispose"),i.interface("laya.runtime.IPlatform"),i.interface("laya.resource.IDestroy"),i.interface("laya.runtime.IConchNode"),i.interface("laya.filters.IFilterAction"),i.interface("laya.runtime.ICPlatformClass"),i.interface("laya.resource.ICreateResource"),i.interface("laya.runtime.IConchRenderObject"),i.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var s=function(){function e(){}return r(e,"laya.utils.RunDriver"),e.FILTER_ACTIONS=[],e.pixelRatio=-1,e._charSizeTestDiv=null,e.now=function(){return Date.now()},e.getWindow=function(){return t},e.getPixelRatio=function(){if(e.pixelRatio<0){var t=k.context,i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;(e.pixelRatio=(k.window.devicePixelRatio||1)/i)<1&&(e.pixelRatio=1)}return e.pixelRatio},e.getIncludeStr=function(t){return null},e.createShaderCondition=function(t){var e="(function() {return "+t+";})";return i._runScript(e)},e.fontMap=[],e.measureText=function(t,i){var n=e.hanzi.test(t);if(n&&e.fontMap[i])return e.fontMap[i];var r=k.context;r.font=i;var a=r.measureText(t);return n&&(e.fontMap[i]=a),a},e.getWebGLContext=function(t){},e.beginFlush=function(){},e.endFinish=function(){},e.addToAtlas=null,e.flashFlushImage=function(t){},e.drawToCanvas=function(t,e,i,n,r,a){var s=vt.create("2D"),o=new P(i,n,s);return N.renders[e]._fun(t,o,r,a),s},e.createParticleTemplate2D=null,e.createGLTextur=null,e.createWebGLContext2D=null,e.changeWebGLSize=function(t,e){},e.createRenderSprite=function(t,e){return new N(t,e)},e.createFilterAction=function(t){return new x},e.createGraphics=function(){return new f},e.clear=function(t){L._context.ctx.clear()},e.cancelLoadByUrl=function(t){},e.clearAtlas=function(t){},e.isAtlas=function(t){return!1},e.addTextureToAtlas=function(t){},e.getTexturePixels=function(t,e,i,n,r){return null},e.skinAniSprite=function(){return null},e.update3DLoop=function(){},n(e,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),e}(),o=(a(1,i,"alertGlobalError",null,function(t){var e=0;k.window.onerror=t?function(t,i,n,r,a){e++<5&&a&&alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+a.stack||!1)}:null}),i.init=function(t,e,n){for(var r=[],a=2,s=arguments.length;a<s;a++)r.push(arguments[a]);if(!i._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=i._arrayBufferSlice),i._isinit=!0,k.__init__(),O.__init__(),f.__init__(),i.timer=new j,i.scaleTimer=new j,i.loader=new ot,Q.__init__();a=0;for(var o=r.length;a<o;a++)r[a].enable&&r[a].enable();return _.__init__(),u.__init__(),V.__init__(),B.beginCheck(),i._currentStage=i.stage=new gt,i.stage.conchModel&&i.stage.conchModel.setRootNode(),i.getUrlPath(),i.render=new L(0,0),i.stage.size(t,e),N.__init__(),g.__init__(),y.instance.__init__(i.stage,L.canvas),xt.__init__(),I.autoStopMusic=!0,D.__init__(),L.canvas}},i.getUrlPath=function(){var t=k.window.location,e=t.pathname;e=":"==e.charAt(2)?e.substring(1):e,R.rootPath=R.basePath=R.getPath("file:"==t.protocol?e:t.protocol+"//"+t.host+t.pathname)},i._arrayBufferSlice=function(t,e){var i=new Uint8Array(this,t,e-t),n=new Uint8Array(i.length);return n.set(i),n.buffer},i._runScript=function(t){return k.window["e"+String.fromCharCode(118)+"al"](t)},i.stage=null,i.timer=null,i.scaleTimer=null,i.loader=null,i.version="1.7.19.1beta",i.render=null,i._currentStage=null,i._isinit=!1,i.MiniAdpter={init:function(){t.navigator&&t.navigator.userAgent&&t.navigator.userAgent.indexOf("MiniGame")>-1&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https:../../../https@ldc.layabox.com/doc/@nav=zh-ts-5-0-0")}},n(i,["conchMarket",function(){return this.conchMarket=t.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=t.PlatformClass}]),function(){function t(){}return r(t,"Config"),t.WebGLTextCacheCount=500,t.atlasEnable=!1,t.showCanvasMark=!1,t.animationInterval=50,t.isAntialias=!1,t.isAlpha=!1,t.premultipliedAlpha=!0,t.isStencil=!0,t.preserveDrawingBuffer=!1,t}()),l=function(){function t(){this._events=null}var e;r(t,"laya.events.EventDispatcher");var i=t.prototype;return i.hasListener=function(t){return!(!this._events||!this._events[t])},i.event=function(t,e){if(!this._events||!this._events[t])return!1;var i=this._events[t];if(i.run)i.once&&delete this._events[t],null!=e?i.runWith(e):i.run();else{for(var n=0,r=i.length;n<r;n++){var a=i[n];a&&(null!=e?a.runWith(e):a.run()),a&&!a.once||(i.splice(n,1),n--,r--)}0===i.length&&this._events&&delete this._events[t]}return!0},i.on=function(t,e,i,n){return this._createListener(t,e,i,n,!1)},i.once=function(t,e,i,n){return this._createListener(t,e,i,n,!0)},i._createListener=function(t,i,n,r,a,s){void 0===s&&(s=!0),s&&this.off(t,i,n,a);var o=e.create(i||this,n,r,a);this._events||(this._events={});var l=this._events;return l[t]?l[t].run?l[t]=[l[t],o]:l[t].push(o):l[t]=o,this},i.off=function(t,e,i,n){if(void 0===n&&(n=!1),!this._events||!this._events[t])return this;var r=this._events[t];if(null!=i)if(r.run)e&&r.caller!==e||r.method!==i||n&&!r.once||(delete this._events[t],r.recover());else{for(var a=0,s=0,o=r.length;s<o;s++){var l=r[s];l?!l||e&&l.caller!==e||l.method!==i||n&&!l.once||(a++,r[s]=null,l.recover()):a++}a===o&&delete this._events[t]}return this},i.offAll=function(t){var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this},i._recoverHandlers=function(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;e>-1;e--)t[e]&&(t[e].recover(),t[e]=null)},i.isMouseEvent=function(e){return t.MOUSE_EVENTS[e]},t.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},t.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0}),e=function(t){function e(t,i,n,r){e.__super.call(this,t,i,n,r)}return r(e,"",h),e.prototype.recover=function(){this._id>0&&(this._id=0,e._pool.push(this.clear()))},e.create=function(t,i,n,r){return void 0===r&&(r=!0),e._pool.length?e._pool.pop().setTo(t,i,n,r):new e(t,i,n,r)},e._pool=[],e}()},t}(),h=function(){function t(t,e,i,n){this.once=!1,this._id=0,void 0===n&&(n=!1),this.setTo(t,e,i,n)}r(t,"laya.utils.Handler");var e=t.prototype;return e.setTo=function(e,i,n,r){return this._id=t._gid++,this.caller=e,this.method=i,this.args=n,this.once=r,this},e.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},e.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},e.clear=function(){return this.caller=null,this.method=null,this.args=null,this},e.recover=function(){this._id>0&&(this._id=0,t._pool.push(this.clear()))},t.create=function(e,i,n,r){return void 0===r&&(r=!0),t._pool.length?t._pool.pop().setTo(e,i,n,r):new t(e,i,n,r)},t._pool=[],t._gid=1,t}(),c=function(){function t(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}r(t,"laya.display.BitmapFont");var e=t.prototype;return e.loadFont=function(t,e){this._path=t,this._complete=e,i.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],h.create(this,this.onLoaded))},e.onLoaded=function(){this.parseFont(st.getRes(this._path),st.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},e.parseFont=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");if(!i[0].getAttributeNode)return this.parseFont2(t,e);this.fontSize=parseInt(i[0].getAttributeNode("size").nodeValue);var n,r=i[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n=t.getElementsByTagName("char");var a=0;for(a=0;a<n.length;a++){var s=n[a],o=parseInt(s.getAttributeNode("id").nodeValue),l=parseInt(s.getAttributeNode("xoffset").nodeValue)/1,h=parseInt(s.getAttributeNode("yoffset").nodeValue)/1,c=parseInt(s.getAttributeNode("xadvance").nodeValue)/1,u=new M;u.x=parseInt(s.getAttributeNode("x").nodeValue),u.y=parseInt(s.getAttributeNode("y").nodeValue),u.width=parseInt(s.getAttributeNode("width").nodeValue),u.height=parseInt(s.getAttributeNode("height").nodeValue);var _=ht.create(e,u.x,u.y,u.width,u.height,l,h);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing),this._fontCharDic[o]=_,this._fontWidthMap[o]=c}}},e.parseFont2=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");this.fontSize=parseInt(i[0].attributes.size.nodeValue);var n=i[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];var r=t.getElementsByTagName("char"),a=0;for(a=0;a<r.length;a++){var s=r[a].attributes,o=parseInt(s.id.nodeValue),l=parseInt(s.xoffset.nodeValue)/1,h=parseInt(s.yoffset.nodeValue)/1,c=parseInt(s.xadvance.nodeValue)/1,u=new M;u.x=parseInt(s.x.nodeValue),u.y=parseInt(s.y.nodeValue),u.width=parseInt(s.width.nodeValue),u.height=parseInt(s.height.nodeValue);var _=ht.create(e,u.x,u.y,u.width,u.height,l,h);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing),this._fontCharDic[o]=_,this._fontWidthMap[o]=c}}},e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]},e.destroy=function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},e.setSpaceWidth=function(t){this._spaceWidth=t},e.getCharWidth=function(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "==t?this._spaceWidth+this.letterSpacing:0},e.getTextWidth=function(t){for(var e=0,i=0,n=t.length;i<n;i++)e+=this.getCharWidth(t.charAt(i));return e},e.getMaxWidth=function(){return this._maxWidth},e.getMaxHeight=function(){return this.fontSize},e.drawText=function(t,e,i,n,r,a){var s,o=this.getTextWidth(t),l=0;"center"===r&&(l=(a-o)/2),"right"===r&&(l=a-o);for(var h=0,c=0,u=t.length;c<u;c++)(s=this.getCharTexture(t.charAt(c)))&&(e.graphics.drawTexture(s,i+h+l,n),h+=this.getCharWidth(t.charAt(c)))},t}(),u=function(){function t(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=t._TF_EMPTY}r(t,"laya.display.css.Style");var e=t.prototype;return e.getTransform=function(){return this._tf},e.setTransform=function(e){this._tf="none"!==e&&e?e:t._TF_EMPTY},e.setTranslateX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new d),this._tf.translateX=e},e.setTranslateY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new d),this._tf.translateY=e},e.setScaleX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new d),this._tf.scaleX=e},e.setScale=function(e,i){this._tf===t._TF_EMPTY&&(this._tf=new d),this._tf.scaleX=e,this._tf.scaleY=i},e.setScaleY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new d),this._tf.scaleY=e},e.setRotate=function(e){this._tf===t._TF_EMPTY&&(this._tf=new d),this._tf.rotate=e},e.setSkewX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new d),this._tf.skewX=e},e.setSkewY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new d),this._tf.skewY=e},e.destroy=function(){this.scrollRect=null},e.render=function(t,e,i,n){},e.getCSSStyle=function(){return tt.EMPTY},e._enableLayout=function(){return!1},a(0,e,"scaleX",function(){return this._tf.scaleX},function(t){this.setScaleX(t)}),a(0,e,"transform",function(){return this.getTransform()},function(t){this.setTransform(t)}),a(0,e,"translateX",function(){return this._tf.translateX},function(t){this.setTranslateX(t)}),a(0,e,"translateY",function(){return this._tf.translateY},function(t){this.setTranslateY(t)}),a(0,e,"scaleY",function(){return this._tf.scaleY},function(t){this.setScaleY(t)}),a(0,e,"block",function(){return 0!=(1&this._type)}),a(0,e,"skewY",function(){return this._tf.skewY},function(t){this.setSkewY(t)}),a(0,e,"rotate",function(){return this._tf.rotate},function(t){this.setRotate(t)}),a(0,e,"skewX",function(){return this._tf.skewX},function(t){this.setSkewX(t)}),a(0,e,"paddingLeft",function(){return 0}),a(0,e,"paddingTop",function(){return 0}),a(0,e,"absolute",function(){return!0}),t.__init__=function(){t._TF_EMPTY=new d,t.EMPTY=new t},t.EMPTY=null,t._TF_EMPTY=null,t}(),_=function(){function t(e){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=H.create(t.defaultColor),this.family=t.defaultFamily,this.stroke=t._STROKE,this.size=t.defaultSize,e&&e!==t.EMPTY&&e.copyTo(this)}r(t,"laya.display.css.Font");var e=t.prototype;return e.set=function(t){this._text=null;for(var e=t.split(" "),i=0,n=e.length;i<n;i++){var r=e[i];switch(r){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}r.indexOf("px")>0&&(this.size=parseInt(r),this.family=e[i+1],i++)}},e.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},e.copyTo=function(e){e._type=this._type,e._text=this._text,e._weight=this._weight,e._color=this._color,e.family=this.family,e.stroke=this.stroke!=t._STROKE?this.stroke.slice():t._STROKE,e.indent=this.indent,e.size=this.size},a(0,e,"password",function(){return 0!=(1024&this._type)},function(t){t?this._type|=1024:this._type&=-1025}),a(0,e,"color",function(){return this._color.strColor},function(t){this._color=H.create(t)}),a(0,e,"italic",function(){return 0!=(512&this._type)},function(t){t?this._type|=512:this._type&=-513}),a(0,e,"bold",function(){return 0!=(2048&this._type)},function(t){t?this._type|=2048:this._type&=-2049}),a(0,e,"weight",function(){return""+this._weight},function(t){var e=0;switch(t){case"normal":break;case"bold":this.bold=!0,e=700;break;case"bolder":e=800;break;case"lighter":e=100;break;default:e=parseInt(t)}this._weight=e,this._text=null}),a(0,e,"decoration",function(){return this._decoration?this._decoration.value:"none"},function(t){var e=t.split(" ");switch(this._decoration||(this._decoration={}),e[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=e[0]}e[1]&&(this._decoration.color=H.create(e)),this._decoration.value=t}),t.__init__=function(){t.EMPTY=new t(null)},t.EMPTY=null,t.defaultColor="#000000",t.defaultSize=12,t.defaultFamily="Arial",t.defaultFont="12px Arial",t._STROKE=[0,"#000000"],t._ITALIC=512,t._PASSWORD=1024,t._BOLD=2048,t}(),d=function(){function t(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return r(t,"laya.display.css.TransformInfo"),t}(),f=function(){function e(){this._one=null,this._cmds=null,this._render=this._renderEmpty,L.isConchNode&&(this._nativeObj=new t._conchGraphics,this.id=this._nativeObj.conchID)}r(e,"laya.display.Graphics");var n=e.prototype;return n.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},n.clear=function(t){void 0===t&&(t=!1);var i=0,n=0;if(t){var r=this._one;if(this._cmds){for(n=this._cmds.length,i=0;i<n;i++)!(r=this._cmds[i])||r.callee!==L._context._drawTexture&&r.callee!==L._context._drawTextureWithTransform||(r[0]=null,e._cache.push(r));this._cmds.length=0}else r&&(!r||r.callee!==L._context._drawTexture&&r.callee!==L._context._drawTextureWithTransform||(r[0]=null,e._cache.push(r)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(i=0,n=this._vectorgraphArray.length;i<n;i++)Z.getInstance().deleteShape(this._vectorgraphArray[i]);this._vectorgraphArray.length=0}},n._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},n._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new p,this._graphicBounds._graphics=this)},n._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},n._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},n.getBounds=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(t)},n.getBoundPoints=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(t)},n._addCmd=function(t){this._cmds=this._cmds||[],t.callee=t.shift(),this._cmds.push(t)},n.setFilters=function(t){this._saveToCmd(L._context._setFilters,t)},n.drawTexture=function(t,i,n,r,a,s,o){if(void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),!t||o<.01)return null;r||(r=t.sourceWidth),a||(a=t.sourceHeight),o=o<0?0:o>1?1:o;var l,h=!L.isWebGL&&(k.onFirefox||k.onEdge||k.onIE||k.onSafari)?.5:0,c=r/t.sourceWidth,u=a/t.sourceHeight;return r=t.width*c,a=t.height*u,t.loaded&&(r<=0||a<=0)?null:(i+=t.offsetX*c,n+=t.offsetY*u,this._sp&&(this._sp._renderType|=512),i-=h,n-=h,r+=2*h,a+=2*h,e._cache.length?((l=e._cache.pop())[0]=t,l[1]=i,l[2]=n,l[3]=r,l[4]=a,l[5]=s,l[6]=o):l=[t,i,n,r,a,s,o],l.callee=s||1!=o?L._context._drawTextureWithTransform:L._context._drawTexture,null!=this._one||s||1!=o?this._saveToCmd(l.callee,l):(this._one=l,this._render=this._renderOneImg),t.loaded||t.once("loaded",this,this._textureLoaded,[t,l]),this._repaint(),l)},n.cleanByTexture=function(t,e,i,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),!t)return this.clear();if(this._one&&this._render===this._renderOneImg){n||(n=t.sourceWidth),r||(r=t.sourceHeight);var a=n/t.sourceWidth,s=r/t.sourceHeight;n=t.width*a,r=t.height*s,e+=t.offsetX*a,i+=t.offsetY*s,this._one[0]=t,this._one[1]=e,this._one[2]=i,this._one[3]=n,this._one[4]=r,this._repaint()}else this.clear(),t&&this.drawTexture(t,e,i,n,r)},n.drawTextures=function(t,e){t&&this._saveToCmd(L._context._drawTextures,[t,e])},n.fillTexture=function(t,e,i,n,r,a,s){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a="repeat"),t){var o=[t,e,i,n,r,a,s||b.EMPTY,{}];t.loaded||t.once("loaded",this,this._textureLoaded,[t,o]),this._saveToCmd(L._context._fillTexture,o)}},n._textureLoaded=function(t,e){e[3]=e[3]||t.width,e[4]=e[4]||t.height,this._repaint()},n.fillCircle=function(t,e,i,n,r,a,s){i.bitmap.enableMerageInAtlas=!1;var o=new Float32Array(2*(s+1)),l=new Float32Array(2*(s+1)),h=new Uint16Array(3*s),c=2*Math.PI/s,u=0;o[0]=n,o[1]=r,l[0]=n/i.width,l[1]=r/i.height;for(var _=2,d=0;d<s;d++){var f=a*Math.cos(u)+n,p=a*Math.sin(u)+r;o[_]=f,o[_+1]=p,l[_]=f/i.width,l[_+1]=p/i.height,u+=c,_+=2}for(_=0,d=0;d<s;d++)h[_++]=0,h[_++]=d+1,h[_++]=d+2>=s+1?1:d+2;this.drawTriangles(i,t,e,o,l,h)},n.drawTriangles=function(t,e,i,n,r,a,s,o,l,h){void 0===o&&(o=1),this._saveToCmd(L._context.drawTriangles,[t,e,i,n,r,a,s,o,l,h])},n._saveToCmd=function(t,e){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=e,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),e.callee=t,this._repaint(),e},n.clipRect=function(t,e,i,n){this._saveToCmd(L._context._clipRect,[t,e,i,n])},n.fillText=function(t,e,i,n,r,a,s){void 0===s&&(s=0),this._saveToCmd(L._context._fillText,[t,e,i,n||_.defaultFont,r,a])},n.fillBorderText=function(t,e,i,n,r,a,s,o){this._saveToCmd(L._context._fillBorderText,[t,e,i,n||_.defaultFont,r,a,s,o])},n.strokeText=function(t,e,i,n,r,a,s){this._saveToCmd(L._context._strokeText,[t,e,i,n||_.defaultFont,r,a,s])},n.alpha=function(t){t=t<0?0:t>1?1:t,this._saveToCmd(L._context._alpha,[t])},n.setAlpha=function(t){t=t<0?0:t>1?1:t,this._saveToCmd(L._context._setAlpha,[t])},n.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(L._context._transform,[t,e,i])},n.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(L._context._rotate,[t,e,i])},n.scale=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._saveToCmd(L._context._scale,[t,e,i,n])},n.translate=function(t,e){this._saveToCmd(L._context._translate,[t,e])},n.save=function(){this._saveToCmd(L._context._save,[])},n.restore=function(){this._saveToCmd(L._context._restore,[])},n.replaceText=function(t){this._repaint();var e=this._cmds;if(e){for(var i=e.length-1;i>-1;i--)if(this._isTextCmd(e[i].callee))return e[i][0].toUpperCase?e[i][0]=t:e[i][0].setText(t),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=t:this._one[0].setText(t),!0;return!1},n._isTextCmd=function(t){return t===L._context._fillText||t===L._context._fillBorderText||t===L._context._strokeText},n.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(e)for(var i=e.length-1;i>-1;i--)this._isTextCmd(e[i].callee)&&(e[i][4]=t,e[i][0].toUpperCase||(e[i][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=t,this._one[0].toUpperCase||(this._one[0].changed=!0))},n.loadImage=function(t,e,n,r,a,s){function o(t){t&&(l.drawTexture(t,e,n,r,a),null!=s&&s.call(l._sp,t))}var l=this;void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0);var c=st.getRes(t);c?o(c):i.loader.load(t,h.create(null,o),null,"image")},n._renderEmpty=function(t,e,i,n){},n._renderAll=function(t,e,i,n){for(var r,a=this._cmds,s=0,o=a.length;s<o;s++)(r=a[s]).callee.call(e,i,n,r)},n._renderOne=function(t,e,i,n){this._one.callee.call(e,i,n,this._one)},n._renderOneImg=function(t,e,i,n){this._one.callee.call(e,i,n,this._one),2305!==t._renderType&&(t._renderType|=1)},n.drawLine=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=0;L.isWebGL&&(s=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s));var o=a%2==0?0:.5,l=[t+o,e+o,i+o,n+o,r,a,s];this._saveToCmd(L._context._drawLine,l)},n.drawLines=function(t,e,i,n,r){void 0===r&&(r=1);var a=0;if(i&&!(i.length<4)){L.isWebGL&&(a=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(a));var s=r%2==0?0:.5,o=[t+s,e+s,i,n,r,a];this._saveToCmd(L._context._drawLines,o)}},n.drawCurves=function(t,e,i,n,r){void 0===r&&(r=1);var a=[t,e,i,n,r];this._saveToCmd(L._context._drawCurves,a)},n.drawRect=function(t,e,i,n,r,a,s){void 0===s&&(s=1);var o=a?s/2:0,l=a?s:0,h=[t+o,e+o,i-l,n-l,r,a,s];this._saveToCmd(L._context._drawRect,h)},n.drawCircle=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=r?a/2:0,o=0;L.isWebGL&&(o=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(o));var l=[t,e,i-s,n,r,a,o];this._saveToCmd(L._context._drawCircle,l)},n.drawPie=function(t,e,i,n,r,a,s,o){void 0===o&&(o=1);var l=s?o/2:0,h=s?o:0,c=0;L.isWebGL&&(c=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(c));var u=[t+l,e+l,i-h,n,r,a,s,o,c];u[3]=q.toRadian(n),u[4]=q.toRadian(r),this._saveToCmd(L._context._drawPie,u)},n.drawPoly=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=0,o=!1;L.isWebGL&&(s=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s),o=!(i.length>6));var l=r?a%2==0?0:.5:0,h=[t+l,e+l,i,n,r,a,s,o];this._saveToCmd(L._context._drawPoly,h)},n.drawPath=function(t,e,i,n,r){var a=[t,e,i,n,r];this._saveToCmd(L._context._drawPath,a)},a(0,n,"cmds",function(){return this._cmds},function(t){this._sp&&(this._sp._renderType|=512),this._cmds=t,this._render=this._renderAll,this._repaint()}),e.__init__=function(){if(L.isConchNode){for(var t=laya.display.Graphics.prototype,e=k.window.ConchGraphics.prototype,i=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],n=0,r=i.length;n<=r;n++){var a=i[n];t[a]=e[a]}t._saveToCmd=null,e.drawImageS&&(t.drawTextures=function(t,e){if(t&&t.loaded&&t.bitmap&&t.source){var i=t.uv,n=t.bitmap.width,r=t.bitmap.height;this.drawImageS(t.bitmap.source,i[0]*n,i[1]*r,(i[2]-i[0])*n,(i[5]-i[3])*r,t.offsetX,t.offsetY,t.width,t.height,e)}}),t.drawTexture=function(t,e,i,n,r,a,s){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),t)if(t.loaded){if(t.loaded&&t.bitmap&&t.source&&(n||(n=t.sourceWidth),r||(r=t.sourceHeight),s=s<0?0:s>1?1:s,n=n-t.sourceWidth+t.width,r=r-t.sourceHeight+t.height,!(n<=0||r<=0))){e+=t.offsetX,i+=t.offsetY;var o=t.uv,l=t.bitmap.width,h=t.bitmap.height;this.drawImageM(t.bitmap.source,o[0]*l,o[1]*h,(o[2]-o[0])*l,(o[5]-o[3])*h,e,i,n,r,a,s),this._repaint()}}else t.once("loaded",this,function(){this.drawTexture(t,e,i,n,r,a)})},t.fillTexture=function(t,e,i,n,r,a,s){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a="repeat"),t&&t.loaded){var o,l=L._context.ctx,h=t.bitmap.width,c=t.bitmap.height,u=t.uv;o=t.uv!=ht.DEF_UV?l.createPattern(t.bitmap.source,a,u[0]*h,u[1]*c,(u[2]-u[0])*h,(u[5]-u[3])*c):l.createPattern(t.bitmap.source,a);var _=0,d=0;s&&(e+=s.x%t.width,i+=s.y%t.height,_-=s.x%t.width,d-=s.y%t.height),this._fillImage(o,e,i,_,d,n,r)}}}},e._cache=[],e}(),p=function(){function t(){this._cacheBoundsType=!1}r(t,"laya.display.GraphicsBounds");var e=t.prototype;return e.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},e.reset=function(){this._temp&&(this._temp.length=0)},e.getBounds=function(t){return void 0===t&&(t=!1),(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=M._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds},e.getBoundPoints=function(t){return void 0===t&&(t=!1),(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=q.copyArray(this._rstBoundPoints,this._temp)},e._getCmdPoints=function(e){void 0===e&&(e=!1);var i,n,r=L._context,a=this._graphics.cmds;if((i=this._temp||(this._temp=[])).length=0,a||null==this._graphics._one||(t._tempCmds.length=0,t._tempCmds.push(this._graphics._one),a=t._tempCmds),!a)return i;(n=t._tempMatrixArrays).length=0;var s=t._initMatrix;s.identity();for(var o,l,h=t._tempMatrix,c=NaN,u=NaN,_=NaN,d=NaN,f=NaN,p=NaN,m=0,g=a.length;m<g;m++)if((o=a[m]).callee)switch(o.callee){case r._save:case 7:n.push(s),s=s.clone();break;case r._restore:case 8:s=n.pop();break;case r._scale:case 5:h.identity(),h.translate(-o[2],-o[3]),h.scale(o[0],o[1]),h.translate(o[2],o[3]),this._switchMatrix(s,h);break;case r._rotate:case 3:h.identity(),h.translate(-o[1],-o[2]),h.rotate(o[0]),h.translate(o[1],o[2]),this._switchMatrix(s,h);break;case r._translate:case 6:h.identity(),h.translate(o[0],o[1]),this._switchMatrix(s,h);break;case r._transform:case 4:h.identity(),h.translate(-o[1],-o[2]),h.concat(o[0]),h.translate(o[1],o[2]),this._switchMatrix(s,h);break;case 16:case 24:t._addPointArrToRst(i,M._getBoundPointS(o[0],o[1],o[2],o[3]),s);break;case 17:s.copyTo(h),h.concat(o[4]),t._addPointArrToRst(i,M._getBoundPointS(o[0],o[1],o[2],o[3]),h);break;case r._drawTexture:l=o[0],e?o[3]&&o[4]?t._addPointArrToRst(i,M._getBoundPointS(o[1],o[2],o[3],o[4]),s):(l=o[0],t._addPointArrToRst(i,M._getBoundPointS(o[1],o[2],l.width,l.height),s)):(c=(o[3]||l.sourceWidth)/l.width,u=(o[4]||l.sourceHeight)/l.height,_=c*l.sourceWidth,d=u*l.sourceHeight,f=l.offsetX>0?l.offsetX:0,p=l.offsetY>0?l.offsetY:0,f*=c,p*=u,t._addPointArrToRst(i,M._getBoundPointS(o[1]-f,o[2]-p,_,d),s));break;case r._fillTexture:o[3]&&o[4]?t._addPointArrToRst(i,M._getBoundPointS(o[1],o[2],o[3],o[4]),s):(l=o[0],t._addPointArrToRst(i,M._getBoundPointS(o[1],o[2],l.width,l.height),s));break;case r._drawTextureWithTransform:var y;o[5]?(s.copyTo(h),h.concat(o[5]),y=h):y=s,e?o[3]&&o[4]?t._addPointArrToRst(i,M._getBoundPointS(o[1],o[2],o[3],o[4]),y):(l=o[0],t._addPointArrToRst(i,M._getBoundPointS(o[1],o[2],l.width,l.height),y)):(l=o[0],c=(o[3]||l.sourceWidth)/l.width,u=(o[4]||l.sourceHeight)/l.height,_=c*l.sourceWidth,d=u*l.sourceHeight,f=l.offsetX>0?l.offsetX:0,p=l.offsetY>0?l.offsetY:0,f*=c,p*=u,t._addPointArrToRst(i,M._getBoundPointS(o[1]-f,o[2]-p,_,d),y));break;case r._drawRect:case 13:t._addPointArrToRst(i,M._getBoundPointS(o[0],o[1],o[2],o[3]),s);break;case r._drawCircle:case r._fillCircle:case 14:t._addPointArrToRst(i,M._getBoundPointS(o[0]-o[2],o[1]-o[2],o[2]+o[2],o[2]+o[2]),s);break;case r._drawLine:case 20:t._tempPoints.length=0;var v;v=.5*o[5],o[0]==o[2]?t._tempPoints.push(o[0]+v,o[1],o[2]+v,o[3],o[0]-v,o[1],o[2]-v,o[3]):o[1]==o[3]?t._tempPoints.push(o[0],o[1]+v,o[2],o[3]+v,o[0],o[1]-v,o[2],o[3]-v):t._tempPoints.push(o[0],o[1],o[2],o[3]),t._addPointArrToRst(i,t._tempPoints,s);break;case r._drawCurves:case 22:t._addPointArrToRst(i,E.I.getBezierPoints(o[2]),s,o[0],o[1]);break;case r._drawPoly:case r._drawLines:case 18:t._addPointArrToRst(i,o[2],s,o[0],o[1]);break;case r._drawPath:case 19:t._addPointArrToRst(i,this._getPathPoints(o[2]),s,o[0],o[1]);break;case r._drawPie:case 15:t._addPointArrToRst(i,this._getPiePoints(o[0],o[1],o[2],o[3],o[4]),s)}return i.length>200?i=q.copyArray(i,M._getWrapRec(i)._getBoundPoints()):i.length>8&&(i=T.scanPList(i)),i},e._switchMatrix=function(t,e){e.concat(t),e.copyTo(t)},e._getPiePoints=function(e,i,n,r,a){var s=t._tempPoints;t._tempPoints.length=0,s.push(e,i);var o=(a-r)%(2*Math.PI)/10,l=NaN,h=r;for(l=0;l<=10;l++)s.push(e+n*Math.cos(h),i+n*Math.sin(h)),h+=o;return s},e._getPathPoints=function(e){var i,n,r=0,a=t._tempPoints;for(a.length=0,i=e.length,r=0;r<i;r++)(n=e[r]).length>1&&(a.push(n[1],n[2]),n.length>3&&a.push(n[3],n[4]));return a},t._addPointArrToRst=function(e,i,n,r,a){void 0===r&&(r=0),void 0===a&&(a=0);var s,o=0;for(s=i.length,o=0;o<s;o+=2)t._addPointToRst(e,i[o]+r,i[o+1]+a,n)},t._addPointToRst=function(t,e,i,n){var r=b.TEMP;r.setTo(e||0,i||0),n.transformPoint(r),t.push(r.x,r.y)},t._tempPoints=[],t._tempMatrixArrays=[],t._tempCmds=[],n(t,["_tempMatrix",function(){return this._tempMatrix=new C},"_initMatrix",function(){return this._initMatrix=new C}]),t}(),m=function(){function t(){}r(t,"laya.events.Event");var e=t.prototype;return e.setTo=function(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this},e.stopPropagation=function(){this._stoped=!0},a(0,e,"stageY",function(){return i.stage.mouseY}),a(0,e,"charCode",function(){return this.nativeEvent.charCode}),a(0,e,"touches",function(){var t=this.nativeEvent.touches;if(t)for(var e=i.stage,n=0,r=t.length;n<r;n++){var a=t[n],s=b.TEMP;s.setTo(a.clientX,a.clientY),e._canvasTransform.invertTransformPoint(s),e.transform.invertTransformPoint(s),a.stageX=s.x,a.stageY=s.y}return t}),a(0,e,"keyLocation",function(){return this.nativeEvent.keyLocation}),a(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),a(0,e,"altKey",function(){return this.nativeEvent.altKey}),a(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey}),a(0,e,"stageX",function(){return i.stage.mouseX}),t.EMPTY=new t,t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.CLICK="click",t.RIGHT_MOUSE_DOWN="rightmousedown",t.RIGHT_MOUSE_UP="rightmouseup",t.RIGHT_CLICK="rightclick",t.MOUSE_MOVE="mousemove",t.MOUSE_OVER="mouseover",t.MOUSE_OUT="mouseout",t.MOUSE_WHEEL="mousewheel",t.ROLL_OVER="mouseover",t.ROLL_OUT="mouseout",t.DOUBLE_CLICK="doubleclick",t.CHANGE="change",t.CHANGED="changed",t.RESIZE="resize",t.ADDED="added",t.REMOVED="removed",t.DISPLAY="display",t.UNDISPLAY="undisplay",t.ERROR="error",t.COMPLETE="complete",t.LOADED="loaded",t.PROGRESS="progress",t.INPUT="input",t.RENDER="render",t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.KEY_DOWN="keydown",t.KEY_PRESS="keypress",t.KEY_UP="keyup",t.FRAME="enterframe",t.DRAG_START="dragstart",t.DRAG_MOVE="dragmove",t.DRAG_END="dragend",t.ENTER="enter",t.SELECT="select",t.BLUR="blur",t.FOCUS="focus",t.VISIBILITY_CHANGE="visibilitychange",t.FOCUS_CHANGE="focuschange",t.PLAYED="played",t.PAUSED="paused",t.STOPPED="stopped",t.START="start",t.END="end",t.ENABLE_CHANGED="enablechanged",t.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",t.COMPONENT_ADDED="componentadded",t.COMPONENT_REMOVED="componentremoved",t.LAYER_CHANGED="layerchanged",t.HIERARCHY_LOADED="hierarchyloaded",t.RECOVERED="recovered",t.RELEASED="released",t.LINK="link",t.LABEL="label",t.FULL_SCREEN_CHANGE="fullscreenchange",t.DEVICE_LOST="devicelost",t.MESH_CHANGED="meshchanged",t.MATERIAL_CHANGED="materialchanged",t.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",t.ANIMATION_CHANGED="animationchanged",t.TRIGGER_ENTER="triggerenter",t.TRIGGER_STAY="triggerstay",t.TRIGGER_EXIT="triggerexit",t.TRAIL_FILTER_CHANGE="trailfilterchange",t.DOMINO_FILTER_CHANGE="dominofilterchange",t}(),g=(function(){function t(){}r(t,"laya.events.Keyboard"),t.NUMBER_0=48,t.NUMBER_1=49,t.NUMBER_2=50,t.NUMBER_3=51,t.NUMBER_4=52,t.NUMBER_5=53,t.NUMBER_6=54,t.NUMBER_7=55,t.NUMBER_8=56,t.NUMBER_9=57,t.A=65,t.B=66,t.C=67,t.D=68,t.E=69,t.F=70,t.G=71,t.H=72,t.I=73,t.J=74,t.K=75,t.L=76,t.M=77,t.N=78,t.O=79,t.P=80,t.Q=81,t.R=82,t.S=83,t.T=84,t.U=85,t.V=86,t.W=87,t.X=88,t.Y=89,t.Z=90,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t.F13=124,t.F14=125,t.F15=126,t.NUMPAD=21,t.NUMPAD_0=96,t.NUMPAD_1=97,t.NUMPAD_2=98,t.NUMPAD_3=99,t.NUMPAD_4=100,t.NUMPAD_5=101,t.NUMPAD_6=102,t.NUMPAD_7=103,t.NUMPAD_8=104,t.NUMPAD_9=105,t.NUMPAD_ADD=107,t.NUMPAD_DECIMAL=110,t.NUMPAD_DIVIDE=111,t.NUMPAD_ENTER=108,t.NUMPAD_MULTIPLY=106,t.NUMPAD_SUBTRACT=109,t.SEMICOLON=186,t.EQUAL=187,t.COMMA=188,t.MINUS=189,t.PERIOD=190,t.SLASH=191,t.BACKQUOTE=192,t.LEFTBRACKET=219,t.BACKSLASH=220,t.RIGHTBRACKET=221,t.QUOTE=222,t.ALTERNATE=18,t.BACKSPACE=8,t.CAPS_LOCK=20,t.COMMAND=15,t.CONTROL=17,t.DELETE=46,t.ENTER=13,t.ESCAPE=27,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.SHIFT=16,t.SPACE=32,t.TAB=9,t.INSERT=45}(),function(){function t(){}return r(t,"laya.events.KeyBoardManager"),t.__init__=function(){t._addEvent("keydown"),t._addEvent("keypress"),t._addEvent("keyup")},t._addEvent=function(t){k.document.addEventListener(t,function(e){laya.events.KeyBoardManager._dispatch(e,t)},!0)},t._dispatch=function(e,n){if(t.enabled){t._event._stoped=!1,t._event.nativeEvent=e,t._event.keyCode=e.keyCode||e.which||e.charCode,"keydown"===n?t._pressKeys[t._event.keyCode]=!0:"keyup"===n&&(t._pressKeys[t._event.keyCode]=null);for(var r=i.stage.focus&&null!=i.stage.focus.event&&i.stage.focus.displayedInStage?i.stage.focus:i.stage,a=r;a;)a.event(n,t._event.setTo(n,a,r)),a=a.parent}},t.hasKeyDown=function(e){return t._pressKeys[e]},t._pressKeys={},t.enabled=!0,n(t,["_event",function(){return this._event=new m}]),t}()),y=(function(){function t(){}r(t,"laya.events.KeyLocation"),t.STANDARD=0,t.LEFT=1,t.RIGHT=2,t.NUM_PAD=3}(),function(){function t(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new m,this._matrix=new C,this._point=new b,this._rect=new M,this._prePoint=new b,this._curTouchID=NaN}r(t,"laya.events.MouseManager");var e=t.prototype;return e.__init__=function(e,i){var n=this;this._stage=e;var r=this,a=this._eventList;i.oncontextmenu=function(e){if(t.enabled)return!1},i.addEventListener("mousedown",function(e){t.enabled&&(k.onIE||e.preventDefault(),a.push(e),r.mouseDownTime=k.now())}),i.addEventListener("mouseup",function(e){t.enabled&&(e.preventDefault(),a.push(e),r.mouseDownTime=-k.now())},!0),i.addEventListener("mousemove",function(e){if(t.enabled){e.preventDefault();var i=k.now();if(i-r._lastMoveTimer<10)return;r._lastMoveTimer=i,a.push(e)}},!0),i.addEventListener("mouseout",function(e){t.enabled&&a.push(e)}),i.addEventListener("mouseover",function(e){t.enabled&&a.push(e)}),i.addEventListener("touchstart",function(e){t.enabled&&(a.push(e),t._isFirstTouch||xt.isInputting||e.preventDefault(),r.mouseDownTime=k.now())}),i.addEventListener("touchend",function(e){t.enabled?(t._isFirstTouch||xt.isInputting||e.preventDefault(),t._isFirstTouch=!1,a.push(e),r.mouseDownTime=-k.now()):n._curTouchID=NaN},!0),i.addEventListener("touchmove",function(e){t.enabled&&(e.preventDefault(),a.push(e))},!0),i.addEventListener("touchcancel",function(e){t.enabled?(e.preventDefault(),a.push(e)):n._curTouchID=NaN},!0),i.addEventListener("mousewheel",function(e){t.enabled&&a.push(e)}),i.addEventListener("DOMMouseScroll",function(e){t.enabled&&a.push(e)})},e.initEvent=function(t,e){var i;this._event._stoped=!1,this._event.nativeEvent=e||t,this._target=null,this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=t.identifier||0,this._tTouchID=this._event.touchId,(i=v.I._event)._stoped=!1,i.nativeEvent=this._event.nativeEvent,i.touchId=this._event.touchId},e.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=v.I.getLastOvers(),i=0,n=e.length;i<n;i++){var r=e[i];r.event("mousewheel",this._event.setTo("mousewheel",r,this._target))}},e.onMouseMove=function(t){v.I.onMouseMove(t,this._tTouchID)},e.onMouseDown=function(t){if(xt.isInputting&&i.stage.focus&&i.stage.focus.focus&&!i.stage.focus.contains(this._target)){var e=i.stage.focus._tf||i.stage.focus,n=t._tf||t;n instanceof laya.display.Input&&n.multiline==e.multiline?e._focusOut():e.focus=!1}v.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)},e.onMouseUp=function(t){v.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)},e.check=function(t,e,i,n){this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y;var r=t.scrollRect;if(r&&(this._rect.setTo(r.x,r.y,r.width,r.height),!this._rect.contains(e,i)))return!1;if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i))return!1;for(var a=t._childs.length-1;a>-1;a--){var s=t._childs[a];if(!s.destroyed&&s.mouseEnabled&&s.visible&&this.check(s,e,i,n))return!0}}var o=!(!t.hitTestPrior||t.mouseThrough||this.disableMouseEvent)||this.hitTest(t,e,i);return o?(this._target=t,n.call(this,t)):n===this.onMouseUp&&t===this._stage&&(this._target=this._stage,n.call(this,this._target)),o},e.hitTest=function(t,e,i){var n=!1;if(t.scrollRect&&(e-=t.scrollRect.x,i-=t.scrollRect.y),t.hitArea instanceof laya.utils.HitArea)return t.hitArea.isHit(e,i);if(t.width>0&&t.height>0||t.mouseThrough||t.hitArea)if(t.mouseThrough)n=t.getGraphicBounds().contains(e,i);else{var r=this._rect;t.hitArea?r=t.hitArea:r.setTo(0,0,t.width,t.height),n=r.contains(e,i)}return n},e.runEvent=function(){var e=this._eventList.length;if(e){for(var i,n=0,r=0,a=0;n<e;){var s=this._eventList[n];switch("mousemove"!==s.type&&(this._prePoint.x=this._prePoint.y=-1e6),s.type){case"mousedown":this._touchIDs[0]=this._id++,t._isTouchRespond?t._isTouchRespond=!1:(this._isLeftMouse=0===s.button,this.initEvent(s),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseDown));break;case"mouseup":this._isLeftMouse=0===s.button,this.initEvent(s),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-s.clientX)+Math.abs(this._prePoint.y-s.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=s.clientX,this._prePoint.y=s.clientY,this.initEvent(s),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseMove));break;case"touchstart":t._isTouchRespond=!0,this._isLeftMouse=!0;var o=s.changedTouches;for(r=0,a=o.length;r<a;r++)i=o[r],(t.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=i.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[i.identifier]=this._id++,this.initEvent(i,s),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseDown));break;case"touchend":case"touchcancel":t._isTouchRespond=!0,this._isLeftMouse=!0;var l=s.changedTouches;for(r=0,a=l.length;r<a;r++)i=l[r],(t.multiTouchEnabled||i.identifier==this._curTouchID)&&(this._curTouchID=NaN,this.initEvent(i,s),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseUp)||this.onMouseUp(null));break;case"touchmove":var h=s.changedTouches;for(r=0,a=h.length;r<a;r++)i=h[r],(t.multiTouchEnabled||i.identifier==this._curTouchID)&&(this.initEvent(i,s),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(s);break;case"mouseout":v.I.stageMouseOut();break;case"mouseover":this._stage.event("mouseover",this._event.setTo("mouseover",this._stage,this._stage))}n++}this._eventList.length=0}},t.enabled=!0,t.multiTouchEnabled=!0,t._isTouchRespond=!1,t._isFirstTouch=!0,n(t,["instance",function(){return this.instance=new t}]),t}()),v=function(){function t(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new m}r(t,"laya.events.TouchManager");var e=t.prototype;return e._clearTempArrs=function(){t._oldArr.length=0,t._newArr.length=0,t._tEleArr.length=0},e.getTouchFromArr=function(t,e){var i,n,r=0;for(i=e.length,r=0;r<i;r++)if((n=e[r]).id==t)return n;return null},e.removeTouchFromArr=function(t,e){var i=0;for(i=e.length-1;i>=0;i--)e[i].id==t&&e.splice(i,1)},e.createTouchO=function(t,e){var i;return(i=Y.getItem("TouchData")||{}).id=e,i.tar=t,i},e.onMouseDown=function(e,i,n){var r,a,s,o;(void 0===n&&(n=!1),this.enable)&&(r=this.getTouchFromArr(i,this.preOvers),s=this.getEles(e,null,t._tEleArr),r?r.tar=e:(a=this.createTouchO(e,i),this.preOvers.push(a)),k.onMobile&&this.sendEvents(s,"mouseover",i),o=n?this.preDowns:this.preRightDowns,(r=this.getTouchFromArr(i,o))?r.tar=e:(a=this.createTouchO(e,i),o.push(a)),this.sendEvents(s,n?"mousedown":"rightmousedown",i),this._clearTempArrs())},e.sendEvents=function(t,e,i){void 0===i&&(i=0);var n,r,a,s=0;for(n=t.length,this._event._stoped=!1,r=t[0],s=0;s<n;s++){if((a=t[s]).destroyed)return;if(a.event(e,this._event.setTo(e,a,r)),this._event._stoped)break}},e.getEles=function(t,e,i){for(i?i.length=0:i=[];t&&t!=e;)i.push(t),t=t.parent;return i},e.checkMouseOutAndOverOfMove=function(e,i,n){if(void 0===n&&(n=0),i!=e){var r,a,s=0,o=0;if(i.contains(e))a=this.getEles(e,i,t._tEleArr),this.sendEvents(a,"mouseover",n);else if(e.contains(i))a=this.getEles(i,e,t._tEleArr),this.sendEvents(a,"mouseout",n);else{var l,h;(a=t._tEleArr).length=0,l=this.getEles(i,null,t._oldArr),h=this.getEles(e,null,t._newArr),o=l.length;var c=0;for(s=0;s<o;s++){if(r=l[s],(c=h.indexOf(r))>=0){h.splice(c,h.length-c);break}a.push(r)}a.length>0&&this.sendEvents(a,"mouseout",n),h.length>0&&this.sendEvents(h,"mouseover",n)}}},e.onMouseMove=function(e,i){var n,r;this.enable&&((n=this.getTouchFromArr(i,this.preOvers))?(this.checkMouseOutAndOverOfMove(e,n.tar),n.tar=e,r=this.getEles(e,null,t._tEleArr)):(r=this.getEles(e,null,t._tEleArr),this.sendEvents(r,"mouseover",i),this.preOvers.push(this.createTouchO(e,i))),this.sendEvents(r,"mousemove",i),this._clearTempArrs())},e.getLastOvers=function(){return t._tEleArr.length=0,this.preOvers.length>0&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,t._tEleArr):(t._tEleArr.push(i.stage),t._tEleArr)},e.stageMouseOut=function(){var t;t=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(t,"mouseout",0)},e.onMouseUp=function(e,i,n){if(void 0===n&&(n=!1),this.enable){var r,a,s,o,l,h,c=0,u=0,_=k.onMobile;if(a=this.getEles(e,null,t._tEleArr),this.sendEvents(a,n?"mouseup":"rightmouseup",i),h=n?this.preDowns:this.preRightDowns,r=this.getTouchFromArr(i,h)){var d,f=k.now();if(d=f-this._lastClickTime<300,this._lastClickTime=f,e==r.tar)l=a;else for(s=this.getEles(r.tar,null,t._oldArr),(l=t._newArr).length=0,u=s.length,c=0;c<u;c++)o=s[c],a.indexOf(o)>=0&&l.push(o);l.length>0&&this.sendEvents(l,n?"click":"rightclick",i),n&&d&&this.sendEvents(l,"doubleclick",i),this.removeTouchFromArr(i,h),r.tar=null,Y.recover("TouchData",r)}(r=this.getTouchFromArr(i,this.preOvers))&&_&&((l=this.getEles(r.tar,null,l))&&l.length>0&&this.sendEvents(l,"mouseout",i),this.removeTouchFromArr(i,this.preOvers),r.tar=null,Y.recover("TouchData",r)),this._clearTempArrs()}},t._oldArr=[],t._newArr=[],t._tEleArr=[],n(t,["I",function(){return this.I=new t}]),t}(),S=function(){function t(){this._action=null}r(t,"laya.filters.Filter");var e=t.prototype;return i.imps(e,{"laya.filters.IFilter":!0}),e.callNative=function(t){},a(0,e,"type",function(){return-1}),a(0,e,"action",function(){return this._action}),t.BLUR=16,t.COLOR=32,t.GLOW=8,t._filterStart=null,t._filterEnd=null,t._EndTarget=null,t._recycleScope=null,t._filter=null,t._useSrc=null,t._endSrc=null,t._useOut=null,t._endOut=null,t}(),x=function(){function t(){this.data=null}r(t,"laya.filters.ColorFilterAction");var e=t.prototype;return i.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){var e=t.ctx.ctx,i=t.ctx.ctx.canvas;if(0==i.width||0==i.height)return i;for(var n,r=e.getImageData(0,0,i.width,i.height),a=r.data,s=0,o=a.length;s<o;s+=4)n=this.getColor(a[s],a[s+1],a[s+2],a[s+3]),0!=a[s+3]&&(a[s]=n[0],a[s+1]=n[1],a[s+2]=n[2],a[s+3]=n[3]);return e.putImageData(r,0,0),t},e.getColor=function(t,e,i,n){var r=[];if(this.data._mat&&this.data._alpha){var a=this.data._mat,s=this.data._alpha;r[0]=a[0]*t+a[1]*e+a[2]*i+a[3]*n+s[0],r[1]=a[4]*t+a[5]*e+a[6]*i+a[7]*n+s[1],r[2]=a[8]*t+a[9]*e+a[10]*i+a[11]*n+s[2],r[3]=a[12]*t+a[13]*e+a[14]*i+a[15]*n+s[3]}return r},t}(),E=(function(){function t(){}r(t,"laya.maths.Arith"),t.formatR=function(t){return t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI),t},t.isPOT=function(t,e){return t>0&&0==(t&t-1)&&e>0&&0==(e&e-1)},t.setMatToArray=function(t,e){t.a,t.b,t.c,t.d,t.tx,t.ty,e[0]=t.a,e[1]=t.b,e[4]=t.c,e[5]=t.d,e[12]=t.tx,e[13]=t.ty}}(),function(){function t(){this._controlPoints=[new b,new b,new b],this._calFun=this.getPoint2}r(t,"laya.maths.Bezier");var e=t.prototype;return e._switchPoint=function(t,e){var i=this._controlPoints.shift();i.setTo(t,e),this._controlPoints.push(i)},e.getPoint2=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],a=Math.pow(1-t,2)*i.x+2*t*(1-t)*n.x+Math.pow(t,2)*r.x,s=Math.pow(1-t,2)*i.y+2*t*(1-t)*n.y+Math.pow(t,2)*r.y;e.push(a,s)},e.getPoint3=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],a=this._controlPoints[3],s=Math.pow(1-t,3)*i.x+3*n.x*t*(1-t)*(1-t)+3*r.x*t*t*(1-t)+a.x*Math.pow(t,3),o=Math.pow(1-t,3)*i.y+3*n.y*t*(1-t)*(1-t)+3*r.y*t*t*(1-t)+a.y*Math.pow(t,3);e.push(s,o)},e.insertPoints=function(t,e){var i,n=NaN;for(i=1/(t=t>0?t:5),n=0;n<=1;n+=i)this._calFun(n,e)},e.getBezierPoints=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=2);var n,r,a=0;if((n=t.length)<2*(i+1))return[];switch(r=[],i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(new b);for(a=0;a<2*i;a+=2)this._switchPoint(t[a],t[a+1]);for(a=2*i;a<n;a+=2)this._switchPoint(t[a],t[a+1]),a/2%i==0&&this.insertPoints(e,r);return r},n(t,["I",function(){return this.I=new t}]),t}()),T=function(){function t(){}return r(t,"laya.maths.GrahamScan"),t.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)},t.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},t._getPoints=function(e,i,n){for(void 0===i&&(i=!1),t._mPointList||(t._mPointList=[]);t._mPointList.length<e;)t._mPointList.push(new b);return n||(n=[]),n.length=0,i?t.getFrom(n,t._mPointList,e):t.getFromR(n,t._mPointList,e),n},t.getFrom=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e[n]);return t},t.getFromR=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e.pop());return t},t.pListToPointList=function(e,i){void 0===i&&(i=!1);var n=0,r=e.length/2,a=t._getPoints(r,i,t._tempPointList);for(n=0;n<r;n++)a[n].setTo(e[n+n],e[n+n+1]);return a},t.pointListToPlist=function(e){var i,n=0,r=e.length,a=t._temPList;for(a.length=0,n=0;n<r;n++)i=e[n],a.push(i.x,i.y);return a},t.scanPList=function(e){return q.copyArray(e,t.pointListToPlist(t.scan(t.pListToPointList(e,!0))))},t.scan=function(e){var i,n,r,a=0,s=0,o=0,l=e.length,h={};for((n=t._temArr).length=0,a=e.length-1;a>=0;a--)r=(i=e[a]).x+"_"+i.y,h.hasOwnProperty(r)||(h[r]=!0,n.push(i));for(l=n.length,q.copyArray(e,n),a=1;a<l;a++)(e[a].y<e[o].y||e[a].y==e[o].y&&e[a].x<e[o].x)&&(o=a);for(i=e[0],e[0]=e[o],e[o]=i,a=1;a<l-1;a++){for(o=a,s=a+1;s<l;s++)(t.multiply(e[s],e[o],e[0])>0||0==t.multiply(e[s],e[o],e[0])&&t.dis(e[0],e[s])<t.dis(e[0],e[o]))&&(o=s);i=e[a],e[a]=e[o],e[o]=i}if((n=t._temArr).length=0,e.length<3)return q.copyArray(n,e);for(n.push(e[0],e[1],e[2]),a=3;a<l;a++){for(;n.length>=2&&t.multiply(e[a],n[n.length-1],n[n.length-2])>=0;)n.pop();e[a]&&n.push(e[a])}return n},t._mPointList=null,t._tempPointList=[],t._temPList=[],t._temArr=[],t}(),w=function(){function t(){}return r(t,"laya.maths.MathUtil"),t.subtractVector3=function(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]},t.lerp=function(t,e,i){return t*(1-i)+e*i},t.scaleVector3=function(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e},t.lerpVector3=function(t,e,i,n){var r=t[0],a=t[1],s=t[2];n[0]=r+i*(e[0]-r),n[1]=a+i*(e[1]-a),n[2]=s+i*(e[2]-s)},t.lerpVector4=function(t,e,i,n){var r=t[0],a=t[1],s=t[2],o=t[3];n[0]=r+i*(e[0]-r),n[1]=a+i*(e[1]-a),n[2]=s+i*(e[2]-s),n[3]=o+i*(e[3]-o)},t.slerpQuaternionArray=function(t,e,i,n,r,a,s){var o,l,h,c,u,_=t[e+0],d=t[e+1],f=t[e+2],p=t[e+3],m=i[n+0],g=i[n+1],y=i[n+2],v=i[n+3];return(l=_*m+d*g+f*y+p*v)<0&&(l=-l,m=-m,g=-g,y=-y,v=-v),1-l>1e-6?(o=Math.acos(l),h=Math.sin(o),c=Math.sin((1-r)*o)/h,u=Math.sin(r*o)/h):(c=1-r,u=r),a[s+0]=c*_+u*m,a[s+1]=c*d+u*g,a[s+2]=c*f+u*y,a[s+3]=c*p+u*v,a},t.getRotation=function(t,e,i,n){return Math.atan2(n-e,i-t)/Math.PI*180},t.sortBigFirst=function(t,e){return t==e?0:e>t?1:-1},t.sortSmallFirst=function(t,e){return t==e?0:e>t?-1:1},t.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},t.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},t.sortByKey=function(e,i,n){var r;return void 0===i&&(i=!1),void 0===n&&(n=!0),r=i?n?t.sortNumBigFirst:t.sortBigFirst:n?t.sortNumSmallFirst:t.sortSmallFirst,function(t,i){return r(t[e],i[e])}},t}(),C=function(){function t(t,e,i,n,r,a){this.inPool=!1,this.bTransform=!1,void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a,this._checkTransform()}r(t,"laya.maths.Matrix");var e=t.prototype;return e.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},e._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},e.setTranslate=function(t,e){return this.tx=t,this.ty=e,this},e.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.scale=function(t,e){this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this.bTransform=!0},e.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,a=this.tx;this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this.bTransform=!0},e.skew=function(t,e){var i=Math.tan(t),n=Math.tan(e),r=this.a,a=this.b;return this.a+=n*this.c,this.b+=n*this.d,this.c+=i*r,this.d+=i*a,this},e.invertTransformPoint=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,a=this.tx,s=e*r-i*n,o=r/s,l=-i/s,h=-n/s,c=e/s,u=(n*this.ty-r*a)/s,_=-(e*this.ty-i*a)/s;return t.setTo(o*t.x+h*t.y+u,l*t.x+c*t.y+_)},e.transformPoint=function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)},e.transformPointN=function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)},e.transformPointArray=function(t,e){for(var i=t.length,n=0;n<i;n+=2){var r=t[n],a=t[n+1];e[n]=this.a*r+this.c*a+this.tx,e[n+1]=this.b*r+this.d*a+this.ty}return e},e.transformPointArrayScale=function(t,e){for(var i=t.length,n=0;n<i;n+=2){var r=t[n],a=t[n+1];e[n]=this.a*r+this.c*a,e[n+1]=this.b*r+this.d*a}return e},e.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},e.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},e.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,a=t*n-e*i;return this.a=n/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-n*r)/a,this.ty=-(t*this.ty-e*r)/a,this},e.setTo=function(t,e,i,n,r,a){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a,this},e.concat=function(t){var e=this.a,i=this.c,n=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=n*t.a+this.ty*t.c+t.tx,this.ty=n*t.b+this.ty*t.d+t.ty,this},e.scaleEx=function(t,e){var i=this.a,n=this.b,r=this.c,a=this.d;0!==n||0!==r?(this.a=t*i,this.b=t*n,this.c=e*r,this.d=e*a):(this.a=t*i,this.b=0*a,this.c=0*i,this.d=e*a),this.bTransform=!0},e.rotateEx=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.b,a=this.c,s=this.d;0!==r||0!==a?(this.a=e*n+i*a,this.b=e*r+i*s,this.c=-i*n+e*a,this.d=-i*r+e*s):(this.a=e*n,this.b=i*s,this.c=-i*n,this.d=e*s),this.bTransform=!0},e.clone=function(){var e=t.create();return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e.bTransform=this.bTransform,e},e.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t.bTransform=this.bTransform,t},e.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},e.destroy=function(){if(!this.inPool){var e=t._cache;this.inPool=!0,e._length||(e._length=0),e[e._length++]=this,this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},t.mul=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=t.tx,l=t.ty,h=e.a,c=e.b,u=e.c,_=e.d,d=e.tx,f=e.ty;return 0!==c||0!==u?(i.a=n*h+r*u,i.b=n*c+r*_,i.c=a*h+s*u,i.d=a*c+s*_,i.tx=h*o+u*l+d,i.ty=c*o+_*l+f):(i.a=n*h,i.b=r*_,i.c=a*h,i.d=s*_,i.tx=h*o+d,i.ty=_*l+f),i},t.mul16=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=t.tx,l=t.ty,h=e.a,c=e.b,u=e.c,_=e.d,d=e.tx,f=e.ty;return 0!==c||0!==u?(i[0]=n*h+r*u,i[1]=n*c+r*_,i[4]=a*h+s*u,i[5]=a*c+s*_,i[12]=h*o+u*l+d,i[13]=c*o+_*l+f):(i[0]=n*h,i[1]=r*_,i[4]=a*h,i[5]=s*_,i[12]=h*o+d,i[13]=_*l+f),i},t.mulPre=function(t,e,i,n,r,a,s,o){var l=t.a,h=t.b,c=t.c,u=t.d,_=t.tx,d=t.ty;return 0!==i||0!==n?(o.a=l*e+h*n,o.b=l*i+h*r,o.c=c*e+u*n,o.d=c*i+u*r,o.tx=e*_+n*d+a,o.ty=i*_+r*d+s):(o.a=l*e,o.b=h*r,o.c=c*e,o.d=u*r,o.tx=e*_+a,o.ty=r*d+s),o},t.mulPos=function(t,e,i,n,r,a,s,o){var l=t.a,h=t.b,c=t.c,u=t.d,_=t.tx,d=t.ty;return 0!==h||0!==c?(o.a=e*l+i*c,o.b=e*h+i*u,o.c=n*l+r*c,o.d=n*h+r*u,o.tx=l*a+c*s+_,o.ty=h*a+u*s+d):(o.a=e*l,o.b=i*u,o.c=n*l,o.d=r*u,o.tx=l*a+_,o.ty=u*s+d),o},t.preMul=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=e.a,l=e.b,h=e.c,c=e.d,u=e.tx,_=e.ty;return i.a=o*n,i.b=i.c=0,i.d=c*s,i.tx=u*n+t.tx,i.ty=_*s+t.ty,0===l&&0===h&&0===r&&0===a||(i.a+=l*a,i.d+=h*r,i.b+=o*r+l*s,i.c+=h*n+c*a,i.tx+=_*a,i.ty+=u*r),i},t.preMulXY=function(t,e,i,n){var r=t.a,a=t.b,s=t.c,o=t.d;return n.a=r,n.b=a,n.c=s,n.d=o,n.tx=e*r+t.tx+i*s,n.ty=i*o+t.ty+e*a,n},t.create=function(){var e=t._cache,i=e._length?e[--e._length]:new t;return i.inPool=!1,i},t.EMPTY=new t,t.TEMP=new t,t._cache=[],t}(),b=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}r(t,"laya.maths.Point");var e=t.prototype;return e.setTo=function(t,e){return this.x=t,this.y=e,this},e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))},e.toString=function(){return this.x+","+this.y},e.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t>0){var e=1/t;this.x*=e,this.y*=e}},t.TEMP=new t,t.EMPTY=new t,t}(),M=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}r(t,"laya.maths.Rectangle");var e=t.prototype;return e.setTo=function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom},e.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)},e.intersection=function(e,i){return this.intersects(e)?(i||(i=new t),i.x=Math.max(this.x,e.x),i.y=Math.max(this.y,e.y),i.width=Math.min(this.right,e.right)-i.x,i.height=Math.min(this.bottom,e.bottom)-i.y,i):null},e.union=function(e,i){return i||(i=new t),this.clone(i),e.width<=0||e.height<=0?i:(i.addPoint(e.x,e.y),i.addPoint(e.right,e.bottom),this)},e.clone=function(e){return e||(e=new t),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},e.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},e.equals=function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)},e.addPoint=function(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this},e._getBoundPoints=function(){var e=t._temB;return e.length=0,0==this.width||0==this.height?e:(e.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),e)},e.isEmpty=function(){return this.width<=0||this.height<=0},a(0,e,"right",function(){return this.x+this.width}),a(0,e,"bottom",function(){return this.y+this.height}),t._getBoundPointS=function(e,i,n,r){var a=t._temA;return a.length=0,0==n||0==r?a:(a.push(e,i,e+n,i,e,i+r,e+n,i+r),a)},t._getWrapRec=function(e,i){if(!e||e.length<1)return i?i.setTo(0,0,0,0):t.TEMP.setTo(0,0,0,0);i=i||new t;var n,r,a,s,o,l=e.length,h=b.TEMP;for(a=o=-(r=s=99999),n=0;n<l;n+=2)h.x=e[n],h.y=e[n+1],r=r<h.x?r:h.x,s=s<h.y?s:h.y,a=a>h.x?a:h.x,o=o>h.y?o:h.y;return i.setTo(r,s,a-r,o-s)},t.EMPTY=new t,t.TEMP=new t,t._temB=[],t._temA=[],t}(),I=function(){function t(){}return r(t,"laya.media.SoundManager"),a(1,t,"useAudioMusic",function(){return t._useAudioMusic},function(e){t._useAudioMusic=e,t._musicClass=e?et:null}),a(1,t,"autoStopMusic",function(){return t._autoStopMusic},function(e){i.stage.off("blur",null,t._stageOnBlur),i.stage.off("focus",null,t._stageOnFocus),i.stage.off("visibilitychange",null,t._visibilityChange),t._autoStopMusic=e,e&&(i.stage.on("blur",null,t._stageOnBlur),i.stage.on("focus",null,t._stageOnFocus),i.stage.on("visibilitychange",null,t._visibilityChange))}),a(1,t,"muted",function(){return t._muted},function(e){e!=t._muted&&(e&&t.stopAllSound(),t.musicMuted=e,t._muted=e)}),a(1,t,"musicMuted",function(){return t._musicMuted},function(e){e!=t._musicMuted&&(e?(t._tMusic&&t._musicChannel&&!t._musicChannel.isStopped?t._musicChannel.pause():t._musicChannel=null,t._musicMuted=e):(t._musicMuted=e,t._tMusic&&t._musicChannel&&t._musicChannel.resume()))}),a(1,t,"soundMuted",function(){return t._soundMuted},function(e){t._soundMuted=e}),t.addChannel=function(e){t._channels.indexOf(e)>=0||t._channels.push(e)},t.removeChannel=function(e){var i=0;for(i=t._channels.length-1;i>=0;i--)t._channels[i]==e&&t._channels.splice(i,1)},t.disposeSoundIfNotUsed=function(e){var i=0;for(i=t._channels.length-1;i>=0;i--)if(t._channels[i].url==e)return;t.destroySound(e)},t._visibilityChange=function(){i.stage.isVisibility?t._stageOnFocus():t._stageOnBlur()},t._stageOnBlur=function(){t._isActive=!1,t._musicChannel&&(t._musicChannel.isStopped||(t._blurPaused=!0,t._musicChannel.pause())),t.stopAllSound(),i.stage.once("mousedown",null,t._stageOnFocus)},t._recoverWebAudio=function(){rt.ctx&&"running"!=rt.ctx.state&&rt.ctx.resume&&rt.ctx.resume()},t._stageOnFocus=function(){t._isActive=!0,t._recoverWebAudio(),i.stage.off("mousedown",null,t._stageOnFocus),t._blurPaused&&t._musicChannel&&t._musicChannel.isStopped&&(t._blurPaused=!1,t._musicChannel.resume())},t.playSound=function(e,n,r,a,s){if(void 0===n&&(n=1),void 0===s&&(s=0),!t._isActive||!e)return null;if(t._muted)return null;if(t._recoverWebAudio(),(e=R.formatURL(e))==t._tMusic){if(t._musicMuted)return null}else{if(L.isConchApp){var o=q.getFileExtension(e);if("wav"!=o&&"ogg"!=o)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(t._soundMuted)return null}var l,h;return l=i.loader.getRes(e),a||(a=t._soundClass),l||((l=new a).load(e),st.cacheRes(e,l)),(h=l.play(s,n))?(h.url=e,h.volume=e==t._tMusic?t.musicVolume:t.soundVolume,h.completeHandler=r,h):null},t.destroySound=function(t){var e=i.loader.getRes(t);e&&(st.clearRes(t),e.dispose())},t.playMusic=function(e,i,n,r){return void 0===i&&(i=0),void 0===r&&(r=0),e=R.formatURL(e),t._tMusic=e,t._musicChannel&&t._musicChannel.stop(),t._musicChannel=t.playSound(e,i,n,t._soundClass,r)},t.stopSound=function(e){e=R.formatURL(e);var i,n=0;for(n=t._channels.length-1;n>=0;n--)(i=t._channels[n]).url==e&&i.stop()},t.stopAll=function(){t._tMusic=null;var e=0;for(e=t._channels.length-1;e>=0;e--)t._channels[e].stop()},t.stopAllSound=function(){var e,i=0;for(i=t._channels.length-1;i>=0;i--)(e=t._channels[i]).url!=t._tMusic&&e.stop()},t.stopMusic=function(){t._musicChannel&&t._musicChannel.stop(),t._tMusic=null},t.setSoundVolume=function(e,i){if(i)i=R.formatURL(i),t._setVolume(i,e);else{t.soundVolume=e;var n,r=0;for(r=t._channels.length-1;r>=0;r--)(n=t._channels[r]).url!=t._tMusic&&(n.volume=e)}},t.setMusicVolume=function(e){t.musicVolume=e,t._setVolume(t._tMusic,e)},t._setVolume=function(e,i){e=R.formatURL(e);var n,r=0;for(r=t._channels.length-1;r>=0;r--)(n=t._channels[r]).url==e&&(n.volume=i)},t.musicVolume=1,t.soundVolume=1,t.playbackRate=1,t._useAudioMusic=!0,t._muted=!1,t._soundMuted=!1,t._musicMuted=!1,t._tMusic=null,t._musicChannel=null,t._channels=[],t._autoStopMusic=!1,t._blurPaused=!1,t._isActive=!0,t._soundClass=null,t._musicClass=null,t.autoReleaseSound=!0,t}(),D=function(){function e(){}var i;return r(e,"laya.net.LocalStorage"),e.__init__=function(){e._baseClass||(e._baseClass=i,i.init()),e.items=e._baseClass.items,e.support=e._baseClass.support},e.setItem=function(t,i){e._baseClass.setItem(t,i)},e.getItem=function(t){return e._baseClass.getItem(t)},e.setJSON=function(t,i){e._baseClass.setJSON(t,i)},e.getJSON=function(t){return e._baseClass.getJSON(t)},e.removeItem=function(t){e._baseClass.removeItem(t)},e.clear=function(){e._baseClass.clear()},e._baseClass=null,e.items=null,e.support=!1,e.__init$=function(){i=function(){function e(){}return r(e,""),e.init=function(){try{e.items=t.localStorage,e.setItem("laya","1"),e.removeItem("laya"),e.support=!0}catch(t){}e.support||console.log("LocalStorage is not supprot or browser is private mode.")},e.setItem=function(t,i){try{e.support&&e.items.setItem(t,i)}catch(t){console.warn("set localStorage failed",t)}},e.getItem=function(t){return e.support?e.items.getItem(t):null},e.setJSON=function(t,i){try{e.support&&e.items.setItem(t,JSON.stringify(i))}catch(t){console.warn("set localStorage failed",t)}},e.getJSON=function(t){return JSON.parse(e.support?e.items.getItem(t):null)},e.removeItem=function(t){e.support&&e.items.removeItem(t)},e.clear=function(){e.support&&e.items.clear()},e.items=null,e.support=!1,e}()},e}(),A=(function(){function t(){}r(t,"laya.net.ResourceVersion"),t.enable=function(e,n,r){void 0===r&&(r=2),laya.net.ResourceVersion.type=r,i.loader.load(e,h.create(null,t.onManifestLoaded,[n]),null,"json"),R.customFormat=t.addVersionPrefix},t.onManifestLoaded=function(e,i){t.manifest=i,e.run(),i||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},t.addVersionPrefix=function(e){return t.manifest&&t.manifest[e]?2==t.type?t.manifest[e]:t.manifest[e]+"/"+e:e},t.FOLDER_VERSION=1,t.FILENAME_VERSION=2,t.manifest=null,t.type=1}(),function(){function t(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}r(t,"laya.net.TTFLoader");var e=t.prototype;return e.load=function(t){this._url=t;var e=t.split(".ttf")[0].split("/");this.fontName=e[e.length-1],k.window.conch?this._loadConch():k.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},e._loadConch=function(){this._http=new at,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},e._onHttpLoaded=function(t){k.window.conch.setFontFaceFromBuffer(this.fontName,t),this._clearHttp(),this._complete()},e._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},e._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},e._complete=function(){i.timer.clear(this,this._complete),i.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},e._checkComplete=function(){s.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},e._loadWithFontFace=function(){var t=new k.window.FontFace(this.fontName,"url('"+this._url+"')");k.window.document.fonts.add(t);var e=this;t.loaded.then(function(){e._complete()}),t.load()},e._createDiv=function(){this._div=k.createElement("div"),this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName,t.position="absolute",t.left="-100px",t.top="-100px",k.document.body.appendChild(this._div)},e._loadWithCSS=function(){var t=this,e=k.createElement("style");e.type="text/css",k.document.body.appendChild(e),e.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=s.measureText("LayaTTFFont",this._fontTxt).width;var n=this;e.onload=function(){i.timer.once(1e4,n,t._complete)},i.timer.loop(20,this,this._checkComplete),this._createDiv()},t._testString="LayaTTFFont",t}()),R=function(){function t(e){this._url=null,this._path=null,this._url=t.formatURL(e),this._path=t.getPath(e)}r(t,"laya.net.URL");var e=t.prototype;return a(0,e,"path",function(){return this._path}),a(0,e,"url",function(){return this._url}),t.formatURL=function(e,i){if(!e)return"null path";if(e.indexOf(":")>0)return e;null!=t.customFormat&&(e=t.customFormat(e,i));var n=e.charAt(0);if("."===n)return t.formatRelativePath((i||t.basePath)+e);if("~"===n)return t.rootPath+e.substring(1);if("d"===n){if(0===e.indexOf("data:image"))return e}else if("/"===n)return e;return(i||t.basePath)+e},t.formatRelativePath=function(t){for(var e=t.split("/"),i=0,n=e.length;i<n;i++)".."==e[i]&&(e.splice(i-1,2),i-=2);return e.join("/")},t.isAbsolute=function(t){return t.indexOf(":")>0||"/"==t.charAt(0)},t.getPath=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(0,e+1):""},t.getFileName=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(e+1):t},t.version={},t.basePath="",t.rootPath="",t.customFormat=function(e){var i=t.version[e];return!L.isConchApp&&i&&(e+="?v="+i),e},t}(),L=function(){function e(t,n){this._timeId=0;var r=e._mainCanvas.source.style;r.position="absolute",r.top=r.left="0px",r.background="#000000",e._mainCanvas.source.id="layaCanvas";var a=laya.renders.Render.isWebGL;e._mainCanvas.source.width=t,e._mainCanvas.source.height=n,a&&e.WebGL.init(e._mainCanvas,t,n),k.container.appendChild(e._mainCanvas.source),(e._context=new P(t,n,a?null:e._mainCanvas)).ctx.setIsMainContext(),k.window.requestAnimationFrame(function t(){i.stage._loop(),k.window.requestAnimationFrame(t)}),i.stage.on("visibilitychange",this,this._onVisibilitychange)}r(e,"laya.renders.Render");var n=e.prototype;return n._onVisibilitychange=function(){i.stage.isVisibility?0!=this._timeId&&k.window.clearInterval(this._timeId):this._timeId=k.window.setInterval(this._enterFrame,1e3)},n._enterFrame=function(t){i.stage._loop()},a(1,e,"context",function(){return e._context}),a(1,e,"canvas",function(){return e._mainCanvas.source}),e._context=null,e._mainCanvas=null,e.WebGL=null,e.isConchNode=!1,e.isConchApp=!1,e.isConchWebGL=!1,e.isWebGL=!1,e.is3DMode=!1,e.optimizeTextureMemory=function(t,e){return!0},e.__init$=function(){t.ConchRenderType=t.ConchRenderType||1,t.ConchRenderType|=t.conch?4:0,e.isConchNode=5==(5&t.ConchRenderType),e.isConchApp=4==(4&t.ConchRenderType),e.isConchWebGL=6==t.ConchRenderType},e}(),P=function(){function t(e,i,n){this.x=0,this.y=0,this._drawTexture=function(t,e,i){i[0].loaded&&this.ctx.drawTexture(i[0],i[1],i[2],i[3],i[4],t,e)},this._fillTexture=function(t,e,i){i[0].loaded&&this.ctx.fillTexture(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._drawTextureWithTransform=function(t,e,i){i[0].loaded&&this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],t,e,i[6])},this._fillQuadrangle=function(t,e,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])},this._drawRect=function(t,e,i){var n=this.ctx;null!=i[4]&&(n.fillStyle=i[4],n.fillRect(t+i[0],e+i[1],i[2],i[3],null)),null!=i[5]&&(n.strokeStyle=i[5],n.lineWidth=i[6],n.strokeRect(t+i[0],e+i[1],i[2],i[3],i[6]))},this._drawPie=function(t,e,i){var n=this.ctx;L.isWebGL&&n.setPathId(i[8]),n.beginPath(),L.isWebGL?(n.movePath(i[0]+t,i[1]+e),n.moveTo(0,0)):n.moveTo(t+i[0],e+i[1]),n.arc(t+i[0],e+i[1],i[2],i[3],i[4]),n.closePath(),this._fillAndStroke(i[5],i[6],i[7],!0)},this._clipRect=function(t,e,i){this.ctx.clipRect(t+i[0],e+i[1],i[2],i[3])},this._fillRect=function(t,e,i){this.ctx.fillRect(t+i[0],e+i[1],i[2],i[3],i[4])},this._drawCircle=function(e,i,n){var r=this.ctx;L.isWebGL&&r.setPathId(n[6]),X.drawCall++,r.beginPath(),L.isWebGL&&r.movePath(n[0]+e,n[1]+i),r.arc(n[0]+e,n[1]+i,n[2],0,t.PI2),r.closePath(),this._fillAndStroke(n[3],n[4],n[5],!0)},this._fillCircle=function(e,i,n){X.drawCall++;var r=this.ctx;r.beginPath(),r.fillStyle=n[3],r.arc(n[0]+e,n[1]+i,n[2],0,t.PI2),r.fill()},this._setShader=function(t,e,i){this.ctx.setShader(i[0])},this._drawLine=function(t,e,i){var n=this.ctx;L.isWebGL&&n.setPathId(i[6]),n.beginPath(),n.strokeStyle=i[4],n.lineWidth=i[5],L.isWebGL?(n.movePath(t,e),n.moveTo(i[0],i[1]),n.lineTo(i[2],i[3])):(n.moveTo(t+i[0],e+i[1]),n.lineTo(t+i[2],e+i[3])),n.stroke()},this._drawLines=function(t,e,i){var n=this.ctx;L.isWebGL&&n.setPathId(i[5]),n.beginPath(),t+=i[0],e+=i[1],L.isWebGL&&n.movePath(t,e),n.strokeStyle=i[3],n.lineWidth=i[4];var r=i[2],a=2,s=r.length;if(L.isWebGL)for(n.moveTo(r[0],r[1]);a<s;)n.lineTo(r[a++],r[a++]);else for(n.moveTo(t+r[0],e+r[1]);a<s;)n.lineTo(t+r[a++],e+r[a++]);n.stroke()},this._drawLinesWebGL=function(t,e,i){this.ctx.drawLines(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])},this._drawCurves=function(t,e,i){this.ctx.drawCurves(t,e,i)},this._draw=function(t,e,i){i[0].call(null,this,t,e)},this._transformByMatrix=function(t,e,i){this.ctx.transformByMatrix(i[0])},this._setTransform=function(t,e,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},this._setTransformByMatrix=function(t,e,i){this.ctx.setTransformByMatrix(i[0])},this._save=function(t,e,i){this.ctx.save()},this._restore=function(t,e,i){this.ctx.restore()},this._translate=function(t,e,i){this.ctx.translate(i[0],i[1])},this._transform=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);var n=i[0];this.ctx.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.ctx.translate(-t-i[1],-e-i[2])},this._rotate=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e),this.ctx.rotate(i[0]),this.ctx.translate(-t-i[1],-e-i[2])},this._scale=function(t,e,i){this.ctx.translate(i[2]+t,i[3]+e),this.ctx.scale(i[0],i[1]),this.ctx.translate(-t-i[2],-e-i[3])},this._alpha=function(t,e,i){this.ctx.globalAlpha*=i[0]},this._setAlpha=function(t,e,i){this.ctx.globalAlpha=i[0]},this._fillText=function(t,e,i){this.ctx.fillText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5])},this._strokeText=function(t,e,i){this.ctx.strokeText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])},this._fillBorderText=function(t,e,i){this.ctx.fillBorderText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._blendMode=function(t,e,i){this.ctx.globalCompositeOperation=i[0]},this._beginClip=function(t,e,i){this.ctx.beginClip&&this.ctx.beginClip(t+i[0],e+i[1],i[2],i[3])},this._setIBVB=function(t,e,i){this.ctx.setIBVB(i[0]+t,i[1]+e,i[2],i[3],i[4],i[5],i[6],i[7])},this._fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1]+t,i[2]+e,i[3],i[4])},this._drawPath=function(t,e,i){var n=this.ctx;L.isWebGL&&n.setPathId(-1),n.beginPath(),t+=i[0],e+=i[1],L.isWebGL&&n.movePath(t,e);for(var r=i[2],a=0,s=r.length;a<s;a++){var o=r[a];switch(o[0]){case"moveTo":L.isWebGL?n.moveTo(o[1],o[2]):n.moveTo(t+o[1],e+o[2]);break;case"lineTo":L.isWebGL?n.lineTo(o[1],o[2]):n.lineTo(t+o[1],e+o[2]);break;case"arcTo":L.isWebGL?n.arcTo(o[1],o[2],o[3],o[4],o[5]):n.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":n.closePath()}}var l=i[3];null!=l&&(n.fillStyle=l.fillStyle,n.fill());var h=i[4];null!=h&&(n.strokeStyle=h.strokeStyle,n.lineWidth=h.lineWidth||1,n.lineJoin=h.lineJoin,n.lineCap=h.lineCap,n.miterLimit=h.miterLimit,n.stroke())},this.drawPoly=function(t,e,i){this.ctx.drawPoly(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._drawPoly=function(t,e,i){var n=this.ctx,r=i[2],a=2,s=r.length;if(L.isWebGL)for(n.setPathId(i[6]),n.beginPath(),t+=i[0],e+=i[1],n.movePath(t,e),n.moveTo(r[0],r[1]);a<s;)n.lineTo(r[a++],r[a++]);else for(n.beginPath(),t+=i[0],e+=i[1],n.moveTo(t+r[0],e+r[1]);a<s;)n.lineTo(t+r[a++],e+r[a++]);n.closePath(),this._fillAndStroke(i[3],i[4],i[5],i[7])},this._drawSkin=function(t,e,i){var n=i[0];if(n){var r=this.ctx;n.render(r,t,e)}},this._drawParticle=function(t,e,i){this.ctx.drawParticle(t+this.x,e+this.y,i[0])},this._setFilters=function(t,e,i){this.ctx.setFilters(i)},n?this.ctx=n.getContext("2d"):(n=vt.create("3D"),this.ctx=s.createWebGLContext2D(n),n._setContext(this.ctx)),n.size(e,i),this.canvas=n}r(t,"laya.renders.RenderContext");var e=t.prototype;return e.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},e.drawTexture=function(t,e,i,n,r){t.loaded&&this.ctx.drawTexture(t,e,i,n,r,this.x,this.y)},e._drawTextures=function(t,e,i){i[0].loaded&&this.ctx.drawTextures(i[0],i[1],t+this.x,e+this.y)},e.drawTextureWithTransform=function(t,e,i,n,r,a,s){t.loaded&&this.ctx.drawTextureWithTransform(t,e,i,n,r,a,this.x,this.y,s)},e.fillQuadrangle=function(t,e,i,n,r){this.ctx.fillQuadrangle(t,e,i,n,r)},e.drawCanvas=function(t,e,i,n,r){this.ctx.drawCanvas(t,e+this.x,i+this.y,n,r)},e.drawRect=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=this.ctx;s.strokeStyle=r,s.lineWidth=a,s.strokeRect(t+this.x,e+this.y,i,n,a)},e._fillAndStroke=function(t,e,i,n){void 0===n&&(n=!1);var r=this.ctx;null!=t&&(r.fillStyle=t,L.isWebGL?r.fill(n):r.fill()),null!=e&&i>0&&(r.strokeStyle=e,r.lineWidth=i,r.stroke())},e.clipRect=function(t,e,i,n){this.ctx.clipRect(t+this.x,e+this.y,i,n)},e.fillRect=function(t,e,i,n,r){this.ctx.fillRect(t+this.x,e+this.y,i,n,r)},e.drawCircle=function(e,i,n,r,a){void 0===a&&(a=1),X.drawCall++;var s=this.ctx;s.beginPath(),s.strokeStyle=r,s.lineWidth=a,s.arc(e+this.x,i+this.y,n,0,t.PI2),s.stroke()},e.drawTriangles=function(t,e,i){if(L.isWebGL)this.ctx.drawTriangles(i[0],t+i[1],e+i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9]);else{var n=i[5],r=0,a=n.length,s=this.ctx;for(r=0;r<a;r+=3){var o=2*n[r],l=2*n[r+1],h=2*n[r+2];s.drawTriangle(i[0],i[3],i[4],o,l,h,i[6],!0)}}},e.fillCircle=function(e,i,n,r){X.drawCall++;var a=this.ctx;a.beginPath(),a.fillStyle=r,a.arc(e+this.x,i+this.y,n,0,t.PI2),a.fill()},e.setShader=function(t){this.ctx.setShader(t)},e.drawLine=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=this.ctx;s.beginPath(),s.strokeStyle=r,s.lineWidth=a,s.moveTo(this.x+t,this.y+e),s.lineTo(this.x+i,this.y+n),s.stroke()},e.clear=function(){this.ctx.clear()},e.transformByMatrix=function(t){this.ctx.transformByMatrix(t)},e.setTransform=function(t,e,i,n,r,a){this.ctx.setTransform(t,e,i,n,r,a)},e.setTransformByMatrix=function(t){this.ctx.setTransformByMatrix(t)},e.save=function(){this.ctx.save()},e.restore=function(){this.ctx.restore()},e.translate=function(t,e){this.ctx.translate(t,e)},e.transform=function(t,e,i,n,r,a){this.ctx.transform(t,e,i,n,r,a)},e.rotate=function(t){this.ctx.rotate(t)},e.scale=function(t,e){this.ctx.scale(t,e)},e.alpha=function(t){this.ctx.globalAlpha*=t},e.setAlpha=function(t){this.ctx.globalAlpha=t},e.fillWords=function(t,e,i,n,r,a){void 0===a&&(a=0),this.ctx.fillWords(t,e,i,n,r,a)},e.fillBorderWords=function(t,e,i,n,r,a,s){this.ctx.fillBorderWords(t,e,i,n,r,a,s)},e.fillText=function(t,e,i,n,r,a){this.ctx.fillText(t,e+this.x,i+this.y,n,r,a)},e.strokeText=function(t,e,i,n,r,a,s){this.ctx.strokeText(t,e+this.x,i+this.y,n,r,a,s)},e.blendMode=function(t){this.ctx.globalCompositeOperation=t},e.flush=function(){this.ctx.flush&&this.ctx.flush()},e.addRenderObject=function(t){this.ctx.addRenderObject(t)},e.beginClip=function(t,e,i,n){this.ctx.beginClip&&this.ctx.beginClip(t,e,i,n)},e.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},e.fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],i.length>4?i[4]:null)},t.PI2=2*Math.PI,t}(),N=function(){function t(e,i){switch(this._next=i||t.NORENDER,e){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=S._filter);case 69905:return void(this._fun=t._initRenderFun)}this.onCreate(e)}r(t,"laya.renders.RenderSprite");var e=t.prototype;return e.onCreate=function(t){},e._style=function(t,e,i,n){t._style.render(t,e,i,n);var r=this._next;r._fun.call(r,t,e,i,n)},e._no=function(t,e,i,n){},e._custom=function(t,e,i,n){t.customRender(e,i,n);var r=t._style._tf;this._next._fun.call(this._next,t,e,i-r.translateX,n-r.translateY)},e._clip=function(e,i,n,r){var a=this._next;if(a!=t.NORENDER){var s=e._style.scrollRect;i.ctx.save(),i.ctx.clipRect(n,r,s.width,s.height),a._fun.call(a,e,i,n-s.x,r-s.y),i.ctx.restore()}},e._blend=function(t,e,i,n){var r=t._style;r.blendMode&&(e.ctx.globalCompositeOperation=r.blendMode);var a=this._next;a._fun.call(a,t,e,i,n),e.ctx.globalCompositeOperation="source-over"},e._mask=function(t,e,i,n){var r=this._next;r._fun.call(r,t,e,i,n);var a=t.mask;a&&(e.ctx.globalCompositeOperation="destination-in",(a.numChildren>0||!a.graphics._isOnlyOne())&&(a.cacheAsBitmap=!0),a.render(e,i-t.pivotX,n-t.pivotY)),e.ctx.globalCompositeOperation="source-over"},e._graphics=function(t,e,i,n){var r=t._style._tf;t._graphics&&t._graphics._render(t,e,i-r.translateX,n-r.translateY);var a=this._next;a._fun.call(a,t,e,i,n)},e._image=function(t,e,i,n){var r=t._style;e.ctx.drawTexture2(i,n,r._tf.translateX,r._tf.translateY,t.transform,r.alpha,r.blendMode,t._graphics._one)},e._image2=function(t,e,i,n){var r=t._style._tf;e.ctx.drawTexture2(i,n,r.translateX,r.translateY,t.transform,1,null,t._graphics._one)},e._alpha=function(t,e,i,n){var r;if((r=t._style.alpha)>.01||t._needRepaint()){var a=e.ctx.globalAlpha;e.ctx.globalAlpha*=r;var s=this._next;s._fun.call(s,t,e,i,n),e.ctx.globalAlpha=a}},e._transform=function(e,i,n,r){var a=e.transform,s=this._next;a&&s!=t.NORENDER?(i.save(),i.transform(a.a,a.b,a.c,a.d,a.tx+n,a.ty+r),s._fun.call(s,e,i,0,0),i.restore()):s._fun.call(s,e,i,n,r)},e._childs=function(t,e,i,n){var r=t._style,a=r._tf;if(i=i-a.translateX+r.paddingLeft,n=n-a.translateY+r.paddingTop,r._calculation){var s=t._getWords();if(s){var o=r;o&&(o.stroke?e.fillBorderWords(s,i,n,o.font,o.color,o.strokeColor,o.stroke):e.fillWords(s,i,n,o.font,o.color,"none"!=o.textDecoration&&o.underLine?1:0))}}var l,h=t._childs,c=h.length;if(t.viewport||t.optimizeScrollRect&&t._style.scrollRect){var u=t.viewport||t._style.scrollRect,_=u.x,d=u.y,f=u.right,p=u.bottom,m=NaN,g=NaN;for(y=0;y<c;++y)(l=h[y]).visible&&(m=l._x)<f&&m+l.width>_&&(g=l._y)<p&&g+l.height>d&&l.render(e,i,n)}else for(var y=0;y<c;++y)(l=h[y])._style.visible&&l.render(e,i,n)},e._canvas=function(t,e,i,n){var r=t._$P.cacheCanvas;if(r){"bitmap"===r.type?X.canvasBitmap++:X.canvasNormal++;var a=r.ctx;if(t._needRepaint()||!a)this._canvas_repaint(t,e,i,n);else{var s=r._cacheRec;e.drawCanvas(a.canvas,i+s.x,n+s.y,s.width,s.height)}}else this._next._fun.call(this._next,t,e,i,n)},e._canvas_repaint=function(t,e,n,r){var a=t._$P.cacheCanvas,s=this._next;if(a){var o,l,h,c,u=a.ctx,_=t._needRepaint()||!u,d=a.type;if("bitmap"===d?X.canvasBitmap++:X.canvasNormal++,_){var f,p;a._cacheRec||(a._cacheRec=new M),L.isWebGL&&"bitmap"!==d?a._cacheRec.setTo(-t.pivotX,-t.pivotY,1,1):((c=t.getSelfBounds()).x=c.x-t.pivotX,c.y=c.y-t.pivotY,c.x=c.x-16,c.y=c.y-16,c.width=c.width+32,c.height=c.height+32,c.x=Math.floor(c.x+n)-n,c.y=Math.floor(c.y+r)-r,c.width=Math.floor(c.width),c.height=Math.floor(c.height),a._cacheRec.copyFrom(c)),c=a._cacheRec;var m,g=L.isWebGL?1:k.pixelRatio*i.stage.clientScaleX,y=L.isWebGL?1:k.pixelRatio*i.stage.clientScaleY;if(!L.isWebGL){var v,S=1,x=1;for(v=t;v&&v!=i.stage;)S*=v.scaleX,x*=v.scaleY,v=v.parent;L.isWebGL?(S<1&&(g*=S),x<1&&(y*=x)):(S>1&&(g*=S),x>1&&(y*=x))}if(t.scrollRect){var E=t.scrollRect;c.x-=E.x,c.y-=E.y}if(f=c.width*g,p=c.height*y,l=c.x,h=c.y,L.isWebGL&&"bitmap"===d&&(f>2048||p>2048))return console.warn("cache bitmap size larger than 2048,cache ignored"),a.ctx&&(Y.recover("RenderContext",a.ctx),a.ctx.canvas.size(0,0),a.ctx=null),void s._fun.call(s,t,e,n,r);if(u||(u=a.ctx=Y.getItem("RenderContext")||new P(f,p,vt.create("AUTO"))),u.ctx.sprite=t,(o=u.canvas).clear(),(o.width!=f||o.height!=p)&&o.size(f,p),"bitmap"===d?o.context.asBitmap=!0:"normal"===d&&(o.context.asBitmap=!1),1!=g||1!=y){var T=u.ctx;T.save(),T.scale(g,y),!L.isConchWebGL&&L.isConchApp&&(m=t._$P.cf)&&T.setFilterMatrix&&T.setFilterMatrix(m._mat,m._alpha),s._fun.call(s,t,u,-l,-h),T.restore(),L.isConchApp&&!L.isConchWebGL||t._applyFilters()}else T=u.ctx,!L.isConchWebGL&&L.isConchApp&&(m=t._$P.cf)&&T.setFilterMatrix&&T.setFilterMatrix(m._mat,m._alpha),s._fun.call(s,t,u,-l,-h),L.isConchApp&&!L.isConchWebGL||t._applyFilters();t._$P.staticCache&&(a.reCache=!1),X.canvasReCache++}else l=(c=a._cacheRec).x,h=c.y,o=u.canvas;e.drawCanvas(o,n+l,r+h,c.width,c.height)}else s._fun.call(s,t,u,n,r)},t.__init__=function(){var e,i,n=0;for(e=s.createRenderSprite(69905,null),i=t.renders.length=4096,n=0;n<i;n++)t.renders[n]=e;t.renders[0]=s.createRenderSprite(0,null),function(e,i){for(var n=0,r=0;r<e.length;r++)n|=e[r],t.renders[n]=i}([1,512,4,2],new t(1,null)),t.renders[513]=s.createRenderSprite(513,null),t.renders[517]=new t(517,null)},t._initRenderFun=function(e,i,n,r){var a=e._renderType;(t.renders[a]=t._getTypeRender(a))._fun(e,i,n,r)},t._getTypeRender=function(t){for(var e=null,i=2048;i>1;)i&t&&(e=s.createRenderSprite(i,e)),i>>=1;return e},t.IMAGE=1,t.ALPHA=2,t.TRANSFORM=4,t.BLEND=8,t.CANVAS=16,t.FILTERS=32,t.MASK=64,t.CLIP=128,t.STYLE=256,t.GRAPHICS=512,t.CUSTOM=1024,t.CHILDS=2048,t.INIT=69905,t.renders=[],t.NORENDER=new t(0,null),t}(),O=function(){function t(){this._repaint=!1}r(t,"laya.resource.Context");var e=t.prototype;return e.replaceReset=function(){var e,i,n=0;for(e=t.replaceKeys.length,n=0;n<e;n++)i=t.replaceKeys[n],this[t.newKeys[n]]=this[i]},e.replaceResotre=function(){this.__restore(),this.__reset()},e.setIsMainContext=function(){},e.drawTextures=function(t,e,i,n){X.drawCall+=e.length/2;for(var r=t.width,a=t.height,s=0,o=e.length;s<o;s+=2)this.drawTexture(t,e[s],e[s+1],r,a,i,n)},e.drawCanvas=function(t,e,i,n,r){X.drawCall++,this.drawImage(t.source,e,i,n,r)},e.fillRect=function(t,e,i,n,r){X.drawCall++,r&&(this.fillStyle=r),this.__fillRect(t,e,i,n)},e.fillText=function(t,e,i,n,r,a){X.drawCall++,arguments.length>3&&null!=n&&(this.font=n,this.fillStyle=r,this.textAlign=a,this.textBaseline="top"),this.__fillText(t,e,i)},e.fillBorderText=function(t,e,i,n,r,a,s,o){X.drawCall++,this.font=n,this.fillStyle=r,this.textBaseline="top",this.strokeStyle=a,this.lineWidth=s,this.textAlign=o,this.__strokeText(t,e,i),this.__fillText(t,e,i)},e.strokeText=function(t,e,i,n,r,a,s){X.drawCall++,arguments.length>3&&null!=n&&(this.font=n,this.strokeStyle=r,this.lineWidth=a,this.textAlign=s,this.textBaseline="top"),this.__strokeText(t,e,i)},e.transformByMatrix=function(t){this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.setTransformByMatrix=function(t){this.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.clipRect=function(t,e,i,n){X.drawCall++,this.beginPath(),this.rect(t,e,i,n),this.clip()},e.drawTexture=function(t,e,i,n,r,a,s){X.drawCall++;var o=t.uv,l=t.bitmap.width,h=t.bitmap.height;this.drawImage(t.source,o[0]*l,o[1]*h,(o[2]-o[0])*l,(o[5]-o[3])*h,e+a,i+s,n,r)},e.drawTextureWithTransform=function(t,e,i,n,r,a,s,o,l){X.drawCall++;var h=t.uv,c=t.bitmap.width,u=t.bitmap.height;this.save(),1!=l&&(this.globalAlpha*=l),a?(this.transform(a.a,a.b,a.c,a.d,a.tx+s,a.ty+o),this.drawImage(t.source,h[0]*c,h[1]*u,(h[2]-h[0])*c,(h[5]-h[3])*u,e,i,n,r)):this.drawImage(t.source,h[0]*c,h[1]*u,(h[2]-h[0])*c,(h[5]-h[3])*u,e+s,i+o,n,r),this.restore()},e.drawTexture2=function(t,e,i,n,r,a,s,o){var l=o[0];if(l.loaded&&l.bitmap&&l.source){X.drawCall++;var h=1!==a;if(h){var c=this.globalAlpha;this.globalAlpha*=a}var u=l.uv,_=l.bitmap.width,d=l.bitmap.height;r?(this.save(),this.transform(r.a,r.b,r.c,r.d,r.tx+t,r.ty+e),this.drawImage(l.source,u[0]*_,u[1]*d,(u[2]-u[0])*_,(u[5]-u[3])*d,o[1]-i,o[2]-n,o[3],o[4]),this.restore()):this.drawImage(l.source,u[0]*_,u[1]*d,(u[2]-u[0])*_,(u[5]-u[3])*d,o[1]-i+t,o[2]-n+e,o[3],o[4]),h&&(this.globalAlpha=c)}},e.fillTexture=function(t,e,i,n,r,a,s,o){if(!o.pat){if(t.uv!=ht.DEF_UV){var l=new vt("2D");l.getContext("2d"),l.size(t.width,t.height),l.context.drawTexture(t,0,0,t.width,t.height,0,0),t=new ht(l)}o.pat=this.createPattern(t.bitmap.source,a)}var h=e,c=i,u=0,_=0;s&&(h+=s.x%t.width,c+=s.y%t.height,u-=s.x%t.width,_-=s.y%t.height),this.translate(h,c),this.fillRect(u,_,n,r,o.pat),this.translate(-h,-c)},e.drawTriangle=function(t,e,i,n,r,a,s,o){var l=t.bitmap,h=l.source,c=t.width,u=t.height,_=l.width,d=l.height,f=i[n]*_,p=i[r]*_,m=i[a]*_,g=i[n+1]*d,y=i[r+1]*d,v=i[a+1]*d,S=e[n],x=e[r],E=e[a],T=e[n+1],w=e[r+1],C=e[a+1];if(o){var b=(S+x+E)/3,M=(T+w+C)/3,I=S-b,D=T-M,A=Math.sqrt(I*I+D*D);S=b+I/A*(A+1),T=M+D/A*(A+1),D=w-M,x=b+(I=x-b)/(A=Math.sqrt(I*I+D*D))*(A+1),w=M+D/A*(A+1),D=C-M,E=b+(I=E-b)/(A=Math.sqrt(I*I+D*D))*(A+1),C=M+D/A*(A+1)}this.save(),s&&this.transform(s.a,s.b,s.c,s.d,s.tx,s.ty),this.beginPath(),this.moveTo(S,T),this.lineTo(x,w),this.lineTo(E,C),this.closePath(),this.clip();var R=1/(f*y+g*m+p*v-y*m-g*p-f*v),L=S*y+g*E+x*v-y*E-g*x-S*v,P=f*x+S*m+p*E-x*m-S*p-f*E,N=f*y*E+g*x*m+S*p*v-S*y*m-g*p*E-f*x*v,O=T*y+g*C+w*v-y*C-g*w-T*v,V=f*w+T*m+p*C-w*m-T*p-f*C,k=f*y*C+g*w*m+T*p*v-T*y*m-g*p*C-f*w*v;this.transform(L*R,O*R,P*R,V*R,N*R,k*R),this.drawImage(h,t.uv[0]*_,t.uv[1]*d,c,u,t.uv[0]*_,t.uv[1]*d,c,u),this.restore()},e.flush=function(){return 0},e.fillWords=function(t,e,i,n,r,a){n&&(this.font=n),r&&(this.fillStyle=r),this.textBaseline="top",this.textAlign="left";for(var s=0,o=t.length;s<o;s++){var l=t[s];if(this.__fillText(l.char,l.x+e,l.y+i),1===a){var h=l.height,c=.5*l.style.letterSpacing;c||(c=0),this.beginPath(),this.strokeStyle=r,this.lineWidth=1,this.moveTo(e+l.x-c+.5,i+l.y+h+.5),this.lineTo(e+l.x+l.width+c+.5,i+l.y+h+.5),this.stroke()}}},e.fillBorderWords=function(t,e,i,n,r,a,s){n&&(this.font=n),r&&(this.fillStyle=r),this.textBaseline="top",this.lineWidth=s,this.textAlign="left",this.strokeStyle=a;for(var o=0,l=t.length;o<l;o++){var h=t[o];this.__strokeText(h.char,h.x+e,h.y+i),this.__fillText(h.char,h.x+e,h.y+i)}},e.destroy=function(){this.canvas.width=this.canvas.height=0},e.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},e.drawCurves=function(t,e,i){this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],this.moveTo(t+n[0],e+n[1]);for(var r=2,a=n.length;r<a;)this.quadraticCurveTo(t+n[r++],e+n[r++],t+n[r++],e+n[r++]);this.stroke()},t.__init__=function(t){var e=laya.resource.Context.prototype;(t=t||CanvasRenderingContext2D.prototype).inited||(t.inited=!0,t.__fillText=t.fillText,t.__fillRect=t.fillRect,t.__strokeText=t.strokeText,["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(i){t[i]=e[i]}))},t.replaceCanvasGetSet=function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i.configurable)return!1;var n,r={};for(n in i)"set"!=n&&(r[n]=i[n]);var a=i.set;return r.set=function(t){a.call(this,t);var e=this.getContext("2d");e&&"__reset"in e&&e.__reset()},Object.defineProperty(t,e,r),!0},t.replaceGetSet=function(e,i){var n=Object.getOwnPropertyDescriptor(e,i);if(!n||!n.configurable)return!1;var r,a={};for(r in n)"set"!=r&&(a[r]=n[r]);var s=n.set,o="___"+i+"__";return t.newKeys.push(o),a.set=function(t){t!=this[o]&&(this[o]=t,s.call(this,t))},Object.defineProperty(e,i,a),!0},t._default=new t,t.newKeys=[],n(t,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),t}(),V=function(){function t(e){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++t._uniqueIDCounter,this._name=e||"Content Manager",t._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,t._resourceManagers.push(this),this._resources=[]}r(t,"laya.resource.ResourceManager");var e=t.prototype;return i.imps(e,{"laya.resource.IDispose":!0}),e.getResourceByIndex=function(t){return this._resources[t]},e.getResourcesLength=function(){return this._resources.length},e.addResource=function(t){return t.resourceManager&&t.resourceManager.removeResource(t),-1===this._resources.indexOf(t)&&(t._resourceManager=this,this._resources.push(t),this.addSize(t.memorySize),!0)},e.removeResource=function(t){var e=this._resources.indexOf(t);return-1!==e&&(this._resources.splice(e,1),t._resourceManager=null,this._memorySize-=t.memorySize,!0)},e.unload=function(){for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++)t[e].destroy();t.length=0},e.dispose=function(){if(this===t._systemResourceManager)throw new Error("systemResourceManager不能被释放！");t._resourceManagers.splice(t._resourceManagers.indexOf(this),1),t._isResourceManagersSorted=!1;for(var e=this._resources.slice(0,this._resources.length),i=0;i<e.length;i++){var n=e[i];n.resourceManager.removeResource(n),n.destroy()}e.length=0},e.addSize=function(t){t&&(this.autoRelease&&t>0&&this._memorySize+t>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=t)},e.garbageCollection=function(t){var e=this._resources;(e=e.slice()).sort(function(t,e){if(!t||!e)throw new Error("a或b不能为空！");return t.released&&e.released?0:t.released?1:e.released?-1:t._lastUseFrameCount-e._lastUseFrameCount});for(var i=X.loopCount,n=0,r=e.length;n<r;n++){var a=e[n];if(!(i-a._lastUseFrameCount>1))return void(this._memorySize>=t&&(this._isOverflow=!0));if(a.releaseResource(),this._memorySize<t)return void(this._isOverflow=!1)}},a(0,e,"id",function(){return this._id}),a(0,e,"name",function(){return this._name},function(e){!e&&""===e||this._name===e||(this._name=e,t._isResourceManagersSorted=!1)}),a(0,e,"memorySize",function(){return this._memorySize}),a(1,t,"systemResourceManager",function(){return t._systemResourceManager}),t.__init__=function(){t.currentResourceManager=t.systemResourceManager},t.getLoadedResourceManagerByIndex=function(e){return t._resourceManagers[e]},t.getLoadedResourceManagersCount=function(){return t._resourceManagers.length},t.recreateContentManagers=function(e){void 0===e&&(e=!1);for(var i=t.currentResourceManager,n=0;n<t._resourceManagers.length;n++){t.currentResourceManager=t._resourceManagers[n];for(var r=0;r<t.currentResourceManager._resources.length;r++)t.currentResourceManager._resources[r].releaseResource(e),t.currentResourceManager._resources[r].activeResource(e)}t.currentResourceManager=i},t.releaseContentManagers=function(e){void 0===e&&(e=!1);for(var i=t.currentResourceManager,n=0;n<t._resourceManagers.length;n++){t.currentResourceManager=t._resourceManagers[n];for(var r=0;r<t.currentResourceManager._resources.length;r++){var a=t.currentResourceManager._resources[r];!a.released&&a.releaseResource(e)}}t.currentResourceManager=i},t._uniqueIDCounter=0,t._isResourceManagersSorted=!1,t._resourceManagers=[],n(t,["_systemResourceManager",function(){return this._systemResourceManager=new t("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=t._systemResourceManager}]),t}(),k=(function(){function t(){}r(t,"laya.system.System"),t.changeDefinition=function(t,e){i[t]=e;var n=t+"=classObj";i._runScript(n)},t.__init__=function(){L.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function n(){}return r(n,"laya.utils.Browser"),a(1,n,"pixelRatio",function(){return n.__init__(),n.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1?2:s.getPixelRatio()}),a(1,n,"height",function(){return n.__init__(),(i.stage&&i.stage.canvasRotation?n.clientWidth:n.clientHeight)*n.pixelRatio}),a(1,n,"clientWidth",function(){return n.__init__(),n.window.innerWidth||n.document.body.clientWidth}),a(1,n,"window",function(){return n.__init__(),n._window}),a(1,n,"clientHeight",function(){return n.__init__(),n.window.innerHeight||n.document.body.clientHeight||n.document.documentElement.clientHeight}),a(1,n,"width",function(){return n.__init__(),(i.stage&&i.stage.canvasRotation?n.clientHeight:n.clientWidth)*n.pixelRatio}),a(1,n,"container",function(){return n.__init__(),n._container||((n._container=n.createElement("div")).id="layaContainer",n.document.body.appendChild(n._container)),n._container},function(t){n._container=t}),a(1,n,"document",function(){return n.__init__(),n._document}),n.__init__=function(){if(!n._window){n._window=s.getWindow(),n._document=n.window.document,n._window.addEventListener("message",function(t){laya.utils.Browser._onMessage(t)},!1),n.document.__createElement=n.document.createElement,t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)};var i=t.document.body.style;i["-webkit-user-select"]="none",i["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",n.userAgent=n.window.navigator.userAgent,n.onIOS=!!(n.u=n.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),n.onMobile=n.u.indexOf("Mobile")>-1,n.onIPhone=n.u.indexOf("iPhone")>-1,n.onMac=n.u.indexOf("Mac OS X")>-1,n.onIPad=n.u.indexOf("iPad")>-1,n.onAndroid=n.u.indexOf("Android")>-1||n.u.indexOf("Adr")>-1,n.onWP=n.u.indexOf("Windows Phone")>-1,n.onQQBrowser=n.u.indexOf("QQBrowser")>-1,n.onMQQBrowser=n.u.indexOf("MQQBrowser")>-1||n.u.indexOf("Mobile")>-1&&n.u.indexOf("QQ")>-1,n.onIE=!!n.window.ActiveXObject||"ActiveXObject"in n.window,n.onWeiXin=1,n.onPC=!n.onMobile,n.onSafari=n.u.indexOf("Safari")>-1,n.onFirefox=n.u.indexOf("Firefox")>-1,n.onEdge=n.u.indexOf("Edge")>-1,n.onMiniGame=n.u.indexOf("MiniGame")>-1,n.onLimixiu=n.u.indexOf("limixiu")>-1,n.httpProtocol="http:"==n.window.location.protocol,n.onMiniGame&&null==n.window.focus&&console.error("请先初始化小游戏适配库，详细教程https:../../../https@ldc.layabox.com/doc/@nav=zh-ts-5-0-0"),n.webAudioEnabled=!!(n.window.AudioContext||n.window.webkitAudioContext||n.window.mozAudioContext),n.soundType=n.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",nt=n.webAudioEnabled?rt:et,n.webAudioEnabled&&rt.initWebAudio(),et._initMusicAudio(),n.enableTouch="ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch,t.focus(),I._soundClass=nt,I._musicClass=et,L._mainCanvas=L._mainCanvas||vt.create("2D"),n.canvas||(n.canvas=vt.create("2D"),n.context=n.canvas.getContext("2d"))}},n._onMessage=function(t){if(t.data&&"size"==t.data.name){if(n.window.innerWidth=t.data.width,n.window.innerHeight=t.data.height,n.window.__innerHeight=t.data.clientHeight,!n.document.createEvent)return void console.warn("no document.createEvent");var e=n.document.createEvent("HTMLEvents");return e.initEvent("resize",!1,!1),void n.window.dispatchEvent(e)}},n.createElement=function(t){return n.__init__(),n.document.__createElement(t)},n.getElementById=function(t){return n.__init__(),n.document.getElementById(t)},n.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},n.now=function(){return s.now()},n._window=null,n._document=null,n._container=null,n.userAgent=null,n.u=null,n.onIOS=!1,n.onMac=!1,n.onMobile=!1,n.onIPhone=!1,n.onIPad=!1,n.onAndroid=!1,n.onWP=!1,n.onQQBrowser=!1,n.onMQQBrowser=!1,n.onSafari=!1,n.onFirefox=!1,n.onEdge=!1,n.onIE=!1,n.onWeiXin=1,n.onMiniGame=!1,n.onLimixiu=!1,n.onPC=!1,n.httpProtocol=!1,n.webAudioEnabled=!1,n.soundType=null,n.enableTouch=!1,n.canvas=null,n.context=null,n.__init$=function(){},n}()),F=function(){function t(t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}r(t,"laya.utils.Byte");var e=t.prototype;return e.___resizeBuffer=function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(e){throw"___resizeBuffer err:"+t}},e.getString=function(){return this.rUTF(this.getUint16())},e.getFloat32Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Float32Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getUint8Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Uint8Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getInt16Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Int16Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},e.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t},e.writeFloat32=function(t){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},e.writeFloat64=function(t){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8},e.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},e.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},e.writeInt32=function(t){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},e.writeUint32=function(t){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},e.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},e.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},e.writeUint16=function(t){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},e.writeInt16=function(t){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},e.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},e.writeUint8=function(t){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++},e._getUInt8=function(t){return this._d_.getUint8(t)},e._getUint16=function(t){return this._d_.getUint16(t,this._xd_)},e._getMatrix=function(){return new C(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},e.rUTF=function(t){for(var e="",i=this._pos_+t,n=0,r=String.fromCharCode,a=this._u8d_;this._pos_<i;)(n=a[this._pos_++])<128?0!=n&&(e+=r(n)):e+=r(n<224?(63&n)<<6|127&a[this._pos_++]:n<240?(31&n)<<12|(127&a[this._pos_++])<<6|127&a[this._pos_++]:(15&n)<<18|(127&a[this._pos_++])<<12|a[this._pos_++]<<6&127|127&a[this._pos_++]);return e},e.getCustomString=function(t){for(var e="",i=0,n=0,r=String.fromCharCode,a=this._u8d_;t>0;)if((n=a[this._pos_])<128)e+=r(n),this._pos_++,t--;else for(i=n-128,this._pos_++,t-=i;i>0;)n=a[this._pos_++],e+=r(a[this._pos_++]<<8|n),i--;return e},e.clear=function(){this._pos_=0,this.length=0},e.__getBuffer=function(){return this._d_.buffer},e.writeUTFBytes=function(t){for(var e=0,i=(t+="").length;e<i;e++){var n=t.charCodeAt(e);n<=127?this.writeByte(n):n<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|n>>6,128|63&n],this._pos_),this._pos_+=2):n<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|n>>12,128|n>>6&63,128|63&n],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n],this._pos_),this._pos_+=4)}},e.writeUTFString=function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;if(i>=65536)throw"writeUTFString byte len more than 65536";this._d_.setUint16(e,i,this._xd_)},e.readUTFString=function(){return this.readUTFBytes(this.getUint16())},e.getUTFString=function(){return this.readUTFString()},e.readUTFBytes=function(t){if(void 0===t&&(t=-1),0==t)return"";var e=this.bytesAvailable;if(t>e)throw"readUTFBytes error - Out of bounds";return t=t>0?t:e,this.rUTF(t)},e.getUTFBytes=function(t){return void 0===t&&(t=-1),this.readUTFBytes(t)},e.writeByte=function(t){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},e.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},e.getByte=function(){return this.readByte()},e.ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)},e.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this.ensureWrite(this._pos_+i);var n=new Uint8Array(t);this._u8d_.set(n.subarray(e,e+i),this._pos_),this._pos_+=i},a(0,e,"buffer",function(){var t=this._d_.buffer;return t.byteLength==this.length?t:t.slice(0,this.length)}),a(0,e,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_="littleEndian"==t}),a(0,e,"length",function(){return this._length},function(t){this._allocated_<t?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this.___resizeBuffer(this._allocated_=t),this._length=t}),a(0,e,"pos",function(){return this._pos_},function(t){this._pos_=t}),a(0,e,"bytesAvailable",function(){return this._length-this._pos_}),t.getSystemEndian=function(){if(!t._sysEndian){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,!0),t._sysEndian=256===new Int16Array(e)[0]?"littleEndian":"bigEndian"}return t._sysEndian},t.BIG_ENDIAN="bigEndian",t.LITTLE_ENDIAN="littleEndian",t._sysEndian=null,t}(),B=function(){function t(){}return r(t,"laya.utils.CacheManager"),t.regCacheByFunction=function(e,i){var n;t.unRegCacheByFunction(e,i),n={tryDispose:e,getCacheList:i},t._cacheList.push(n)},t.unRegCacheByFunction=function(e,i){var n,r=0;for(n=t._cacheList.length,r=0;r<n;r++)if(t._cacheList[r].tryDispose==e&&t._cacheList[r].getCacheList==i)return void t._cacheList.splice(r,1)},t.forceDispose=function(){var e=0,i=t._cacheList.length;for(e=0;e<i;e++)t._cacheList[e].tryDispose(!0)},t.beginCheck=function(e){void 0===e&&(e=15e3),i.timer.loop(e,null,t._checkLoop)},t.stopCheck=function(){i.timer.clear(null,t._checkLoop)},t._checkLoop=function(){var e=t._cacheList;if(!(e.length<1)){var i,n=k.now(),r=0;for(i=r=e.length;r>0&&(t._index++,t._index=t._index%i,e[t._index].tryDispose(!1),!(k.now()-n>t.loopTimeLimit));)r--}},t.loopTimeLimit=2,t._cacheList=[],t._index=0,t}(),U=function(){function t(){}return r(t,"laya.utils.ClassUtils"),t.regClass=function(e,i){t._classMap[e]=i},t.getRegClass=function(e){return t._classMap[e]},t.getInstance=function(e){var i=t.getClass(e);return i?new i:(console.warn("[error] Undefined class:",e),null)},t.createByJson=function(e,i,n,r,a){"string"==typeof e&&(e=JSON.parse(e));var s=e.props;if(!i&&!(i=a?a.runWith(e):t.getInstance(s.runtime||e.type)))return null;var o=e.child;if(o)for(var l=0,h=o.length;l<h;l++){var c=o[l];if("render"!==c.props.name&&"render"!==c.props.renderType||!i._$set_itemRender)if("Graphic"==c.type)t.addGraphicsToSprite(c,i);else if(t.isDrawType(c.type))t.addGraphicToSprite(c,i,!0);else{var u=t.createByJson(c,null,n,r,a);"Script"==c.type?u.hasOwnProperty("owner")?u.owner=i:u.hasOwnProperty("target")&&(u.target=i):"mask"==c.props.renderType?i.mask=u:i.addChild(u)}else i.itemRender=c}if(s)for(var _ in s){var d=s[_];"var"===_&&n?n[d]=i:d instanceof Array&&"function"==typeof i[_]?i[_].apply(i,d):i[_]=d}return r&&e.customProps&&r.runWith([i,e]),i.created&&i.created(),i},t.addGraphicsToSprite=function(e,i){var n;if((n=e.child)&&!(n.length<1)){var r;r=t._getGraphicsFromSprite(e,i);var a=0,s=0;e.props&&(a=t._getObjVar(e.props,"x",0),s=t._getObjVar(e.props,"y",0)),0!=a&&0!=s&&r.translate(a,s);var o,l=0;for(o=n.length,l=0;l<o;l++)t._addGraphicToGraphics(n[l],r);0!=a&&0!=s&&r.translate(-a,-s)}},t.addGraphicToSprite=function(e,i,n){var r;void 0===n&&(n=!1),r=n?t._getGraphicsFromSprite(e,i):i.graphics,t._addGraphicToGraphics(e,r)},t._getGraphicsFromSprite=function(t,e){var i,n;if(!t||!t.props)return e.graphics;switch(n=t.props.renderType){case"hit":case"unHit":var r;e.hitArea||(e.hitArea=new z),(r=e.hitArea)[n]||(r[n]=new f),i=r[n]}return i||(i=e.graphics),i},t._getTransformData=function(e){var i;(e.hasOwnProperty("pivotX")||e.hasOwnProperty("pivotY"))&&(i=i||new C).translate(-t._getObjVar(e,"pivotX",0),-t._getObjVar(e,"pivotY",0));var n=t._getObjVar(e,"scaleX",1),r=t._getObjVar(e,"scaleY",1),a=t._getObjVar(e,"rotation",0);return t._getObjVar(e,"skewX",0),t._getObjVar(e,"skewY",0),1==n&&1==r&&0==a||((i=i||new C).scale(n,r),i.rotate(.0174532922222222*a)),i},t._addGraphicToGraphics=function(e,i){var n,r;if((n=e.props)&&(r=t.DrawTypeDic[e.type])){var a;a=i;var s,o=t._getParams(n,r[1],r[2],r[3]);((s=t._tM)||1!=t._alpha)&&(a.save(),s&&a.transform(s),1!=t._alpha&&a.alpha(t._alpha)),a[r[0]].apply(a,o),(s||1!=t._alpha)&&a.restore()}},t._adptLineData=function(t){return t[2]=parseFloat(t[0])+parseFloat(t[2]),t[3]=parseFloat(t[1])+parseFloat(t[3]),t},t._adptTextureData=function(t){return t[0]=st.getRes(t[0]),t},t._adptLinesData=function(e){return e[2]=t._getPointListByStr(e[2]),e},t.isDrawType=function(e){return"Image"!=e&&t.DrawTypeDic.hasOwnProperty(e)},t._getParams=function(e,i,n,r){var a;void 0===n&&(n=0),(a=t._temParam).length=i.length;var s,o,l=0;for(s=i.length,l=0;l<s;l++)a[l]=t._getObjVar(e,i[l][0],i[l][1]);return t._alpha=t._getObjVar(e,"alpha",1),(o=t._getTransformData(e))?(n||(n=0),o.translate(a[n],a[n+1]),a[n]=a[n+1]=0,t._tM=o):t._tM=null,r&&t[r]&&(a=t[r](a)),a},t._getPointListByStr=function(t){var e,i,n=0;for(i=(e=t.split(",")).length,n=0;n<i;n++)e[n]=parseFloat(e[n]);return e},t._getObjVar=function(t,e,i){return t.hasOwnProperty(e)?t[e]:i},t._temParam=[],t._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},t.getClass=function(e){var n=t._classMap[e]||e;return"string"==typeof n?i.__classmap[n]:n},t._tM=null,t._alpha=NaN,n(t,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),t}(),H=function(){function t(e){if(this._color=[],"string"==typeof e){this.strColor=e,null===e&&(e="#000000"),"#"==e.charAt(0)&&(e=e.substr(1));var i=e.length;if(3==i||4==i){for(var n="",r=0;r<i;r++)n+=e[r]+e[r];e=n}var a=this.numColor=parseInt(e,16);if(8==e.length)return void(this._color=[parseInt(e.substr(0,2),16)/255,((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255])}else a=this.numColor=e,this.strColor=q.toHexColor(a);this._color=[((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255,1],this._color.__id=++t._COLODID}return r(t,"laya.utils.Color"),t._initDefault=function(){for(var e in t._DEFAULT={},t._COLOR_MAP)t._SAVE[e]=t._DEFAULT[e]=new t(t._COLOR_MAP[e]);return t._DEFAULT},t._initSaveMap=function(){for(var e in t._SAVE_SIZE=0,t._SAVE={},t._DEFAULT)t._SAVE[e]=t._DEFAULT[e]},t.create=function(e){var i=t._SAVE[e+""];return null!=i?i:(t._SAVE_SIZE<1e3||t._initSaveMap(),t._SAVE[e+""]=new t(e))},t._SAVE={},t._SAVE_SIZE=0,t._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},t._DEFAULT=t._initDefault(),t._COLODID=1,t}(),G=(function(){function t(){this._values=[],this._keys=[]}r(t,"laya.utils.Dictionary");var e=t.prototype;e.set=function(t,e){var i=this.indexOf(t);i>=0?this._values[i]=e:(this._keys.push(t),this._values.push(e))},e.indexOf=function(t){var e=this._keys.indexOf(t);return e>=0?e:(t="string"==typeof t?Number(t):"number"==typeof t?t.toString():t,this._keys.indexOf(t))},e.get=function(t){var e=this.indexOf(t);return e<0?null:this._values[e]},e.remove=function(t){var e=this.indexOf(t);return e>=0&&(this._keys.splice(e,1),this._values.splice(e,1),!0)},e.clear=function(){this._values.length=0,this._keys.length=0},a(0,e,"values",function(){return this._values}),a(0,e,"keys",function(){return this._keys})}(),function(){function t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}r(t,"laya.utils.Dragging");var e=t.prototype;return e.start=function(t,e,n,r,a,s,o,l){void 0===l&&(l=.92),this.clearTimer(),this.target=t,this.area=e,this.hasInertia=n,this.elasticDistance=e?r:0,this.elasticBackTime=a,this.data=s,this._disableMouseEvent=o,this.ratio=l,1!=t.globalScaleX||1!=t.globalScaleY?this._parent=t.parent:this._parent=i.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,i.stage.on("mouseup",this,this.onStageMouseUp),i.stage.on("mouseout",this,this.onStageMouseUp),i.timer.frameLoop(1,this,this.loop)},e.clearTimer=function(){i.timer.clear(this,this.loop),i.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},e.stop=function(){this._dragging&&(y.instance.disableMouseEvent=!1,i.stage.off("mouseup",this,this.onStageMouseUp),i.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},e.loop=function(){var t=this._parent.getMousePoint(),e=t.x,n=t.y,r=e-this._lastX,a=n-this._lastY;if(this._clickOnly){if(!(Math.abs(r*i.stage._canvasTransform.getScaleX())>1||Math.abs(a*i.stage._canvasTransform.getScaleY())>1))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),y.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(r,a);0===r&&0===a||(this._lastX=e,this._lastY=n,this.target.x+=r*this._elasticRateX,this.target.y+=a*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},e.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var t=this.area.x-this.target.x;else t=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target.y<this.area.y)var e=this.area.y-this.target.y;else e=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}},e.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},e.onStageMouseUp=function(t){if(y.instance.disableMouseEvent=!1,i.stage.off("mouseup",this,this.onStageMouseUp),i.stage.off("mouseout",this,this.onStageMouseUp),i.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,n=Math.min(e,6),r=this._offsets.length-n,a=e-1;a>r;a--)this._offsetY+=this._offsets[a--],this._offsetX+=this._offsets[a];this._offsetX=this._offsetX/n*2,this._offsetY=this._offsetY/n*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset),i.timer.frameLoop(1,this,this.tweenMove)}else this.elasticDistance>0?this.checkElastic():this.clear()},e.checkElastic=function(){var t=NaN,e=NaN;if(this.target.x<this.area.x?t=this.area.x:this.target.x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target.y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=K.to(this.target,i,this.elasticBackTime,W.sineOut,h.create(this,this.clear),0,!1,!1)}},e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(i.timer.clear(this,this.tweenMove),this.elasticDistance>0?this.checkElastic():this.clear())},e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event("dragend",this.data)}},t}()),W=function(){function t(){}return r(t,"laya.utils.Ease"),t.linearNone=function(t,e,i,n){return i*t/n+e},t.linearIn=function(t,e,i,n){return i*t/n+e},t.linearInOut=function(t,e,i,n){return i*t/n+e},t.linearOut=function(t,e,i,n){return i*t/n+e},t.bounceIn=function(e,i,n,r){return n-t.bounceOut(r-e,0,n,r)+i},t.bounceInOut=function(e,i,n,r){return e<.5*r?.5*t.bounceIn(2*e,0,n,r)+i:.5*t.bounceOut(2*e-r,0,n,r)+.5*n+i},t.bounceOut=function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},t.backIn=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},t.backInOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=.5*n)<1?.5*i*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},t.backOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},t.elasticIn=function(e,i,n,r,a,s){var o;return void 0===a&&(a=0),void 0===s&&(s=0),0==e?i:1==(e/=r)?i+n:(s||(s=.3*r),!a||n>0&&a<n||n<0&&a<-n?(a=n,o=s/4):o=s/t.PI2*Math.asin(n/a),-a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*t.PI2/s)+i)},t.elasticInOut=function(e,i,n,r,a,s){var o;return void 0===a&&(a=0),void 0===s&&(s=0),0==e?i:2==(e/=.5*r)?i+n:(s||(s=r*(.3*1.5)),!a||n>0&&a<n||n<0&&a<-n?(a=n,o=s/4):o=s/t.PI2*Math.asin(n/a),e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*t.PI2/s)*-.5+i:a*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*t.PI2/s)*.5+n+i)},t.elasticOut=function(e,i,n,r,a,s){var o;return void 0===a&&(a=0),void 0===s&&(s=0),0==e?i:1==(e/=r)?i+n:(s||(s=.3*r),!a||n>0&&a<n||n<0&&a<-n?(a=n,o=s/4):o=s/t.PI2*Math.asin(n/a),a*Math.pow(2,-10*e)*Math.sin((e*r-o)*t.PI2/s)+n+i)},t.strongIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},t.strongInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},t.strongOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},t.sineInOut=function(t,e,i,n){return.5*-i*(Math.cos(Math.PI*t/n)-1)+e},t.sineIn=function(e,i,n,r){return-n*Math.cos(e/r*t.HALF_PI)+n+i},t.sineOut=function(e,i,n,r){return n*Math.sin(e/r*t.HALF_PI)+i},t.quintIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},t.quintInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},t.quintOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},t.quartIn=function(t,e,i,n){return i*(t/=n)*t*t*t+e},t.quartInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e},t.quartOut=function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},t.cubicIn=function(t,e,i,n){return i*(t/=n)*t*t+e},t.cubicInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e},t.cubicOut=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},t.quadIn=function(t,e,i,n){return i*(t/=n)*t+e},t.quadInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e},t.quadOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},t.expoIn=function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},t.expoInOut=function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=.5*n)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(2-Math.pow(2,-10*--t))+e},t.expoOut=function(t,e,i,n){return t==n?e+i:i*(1-Math.pow(2,-10*t/n))+e},t.circIn=function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},t.circInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e},t.circOut=function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},t.HALF_PI=.5*Math.PI,t.PI2=2*Math.PI,t}(),z=function(){function t(){this._hit=null,this._unHit=null}r(t,"laya.utils.HitArea");var e=t.prototype;return e.isHit=function(e,i){return!!t.isHitGraphic(e,i,this.hit)&&!t.isHitGraphic(e,i,this.unHit)},e.contains=function(t,e){return this.isHit(t,e)},a(0,e,"hit",function(){return this._hit||(this._hit=new f),this._hit},function(t){this._hit=t}),a(0,e,"unHit",function(){return this._unHit||(this._unHit=new f),this._unHit},function(t){this._unHit=t}),t.isHitGraphic=function(e,i,n){if(!n)return!1;var r;if(!(r=n.cmds)&&n._one&&((r=t._cmds).length=1,r[0]=n._one),!r)return!1;var a,s,o=0;for(a=r.length,o=0;o<a;o++)if(s=r[o]){var l=L._context;switch(s.callee){case l._translate:case 6:e-=s[0],i-=s[1]}if(t.isHitCmd(e,i,s))return!0}return!1},t.isHitCmd=function(e,i,n){if(!n)return!1;var r=L._context,a=!1;switch(n.callee){case r._drawRect:case 13:t._rec.setTo(n[0],n[1],n[2],n[3]),a=t._rec.contains(e,i);break;case r._drawCircle:case r._fillCircle:case 14:a=(e-=n[0])*e+(i-=n[1])*i<n[2]*n[2];break;case r._drawPoly:case 18:e-=n[0],i-=n[1],a=t.ptInPolygon(e,i,n[2])}return a},t.ptInPolygon=function(e,i,n){var r;(r=t._ptPoint).setTo(e,i);var a,s=0,o=NaN,l=NaN,h=NaN,c=NaN;a=n.length;for(var u=0;u<a;u+=2)o=n[u],l=n[u+1],h=n[(u+2)%a],l==(c=n[(u+3)%a])||r.y<Math.min(l,c)||r.y>=Math.max(l,c)||(r.y-l)*(h-o)/(c-l)+o>r.x&&s++;return s%2==1},t._cmds=[],n(t,["_rec",function(){return this._rec=new M},"_ptPoint",function(){return this._ptPoint=new b}]),t}(),Y=(function(){function t(e,i,n,r){this.char=e,this.charNum=e.charCodeAt(0),this._x=this._y=0,this.width=i,this.height=n,this.style=r,this.isWord=!t._isWordRegExp.test(e)}r(t,"laya.utils.HTMLChar");var e=t.prototype;i.imps(e,{"laya.display.ILayout":!0}),e.setSprite=function(t){this._sprite=t},e.getSprite=function(){return this._sprite},e._isChar=function(){return!0},e._getCSSStyle=function(){return this.style},a(0,e,"width",function(){return this._w},function(t){this._w=t}),a(0,e,"x",function(){return this._x},function(t){this._sprite&&(this._sprite.x=t),this._x=t}),a(0,e,"y",function(){return this._y},function(t){this._sprite&&(this._sprite.y=t),this._y=t}),a(0,e,"height",function(){return this._h},function(t){this._h=t}),t._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function t(){}r(t,"laya.utils.Log"),t.enable=function(){t._logdiv||(t._logdiv=k.window.document.createElement("div"),k.window.document.body.appendChild(t._logdiv),t._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},t.toggle=function(){var e=t._logdiv.style;"1px"==e.width?e.width=e.height="50%":e.width=e.height="1px"},t.print=function(e){t._logdiv&&(t._count>=t.maxCount&&t.clear(),t._count++,t._logdiv.innerText+=e+"\n",t._logdiv.scrollTop=t._logdiv.scrollHeight)},t.clear=function(){t._logdiv.innerText="",t._count=0},t._logdiv=null,t._count=0,t.maxCount=20}(),function(){function t(){}r(t,"laya.utils.Mouse"),a(1,t,"cursor",function(){return t._style.cursor},function(e){t._style.cursor=e}),t.hide=function(){"none"!=t.cursor&&(t._preCursor=t.cursor,t.cursor="none")},t.show=function(){"none"==t.cursor&&(t.cursor=t._preCursor?t._preCursor:"auto")},t._preCursor=null,n(t,["_style",function(){return this._style=k.document.body.style}])}(),function(){function t(){}return r(t,"laya.utils.Pool"),t.getPoolBySign=function(e){return t._poolDic[e]||(t._poolDic[e]=[])},t.clearBySign=function(e){t._poolDic[e]&&(t._poolDic[e].length=0)},t.recover=function(e,i){i.__InPool||(i.__InPool=!0,t.getPoolBySign(e).push(i))},t.getItemByClass=function(e,i){var n=t.getPoolBySign(e),r=n.length?n.pop():new i;return r.__InPool=!1,r},t.getItemByCreateFun=function(e,i){var n=t.getPoolBySign(e),r=n.length?n.pop():i();return r.__InPool=!1,r},t.getItem=function(e){var i=t.getPoolBySign(e),n=i.length?i.pop():null;return n&&(n.__InPool=!1),n},t._poolDic={},t.InPoolSign="__InPool",t}()),X=(function(){function t(){this.sign=null,this.maxCount=1e3}r(t,"laya.utils.PoolCache");var e=t.prototype;e.getCacheList=function(){return Y.getPoolBySign(this.sign)},e.tryDispose=function(t){var e;(e=Y.getPoolBySign(this.sign)).length>this.maxCount&&e.splice(this.maxCount,e.length-this.maxCount)},t.addPoolCacheManager=function(e,i){var n;void 0===i&&(i=100),(n=new t).sign=e,n.maxCount=i,B.regCacheByFunction(q.bind(n.tryDispose,n),q.bind(n.getCacheList,n))}}(),function(){function t(){}return r(t,"laya.utils.Stat"),a(1,t,"onclick",null,function(e){t._sp&&t._sp.on("click",t._sp,e),t._canvas&&(t._canvas.source.onclick=e,t._canvas.source.style.pointerEvents="")}),t.show=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0),!L.isConchApp||L.isConchWebGL?(L.isConchWebGL||k.onMiniGame||k.onLimixiu||(t._useCanvas=!0),t._show=!0,t._fpsData.length=60,t._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},t._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},t._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"},t._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},L.isWebGL?(t._view[4]={title:"Shader",value:"shaderCall",color:"white",units:"int"},L.is3DMode?(t._view[0].title="FPS(3D)",t._view[5]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},t._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},t._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"}):(t._view[0].title="FPS(WebGL)",t._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"})):t._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},t._useCanvas?t.createUIPre(e,i):t.createUI(e,i),t.enable()):k.window.conch.showFPS&&k.window.conch.showFPS(e,i)},t.createUIPre=function(e,i){var n=k.pixelRatio;t._width=130*n,t._vx=75*n,t._height=n*(12*t._view.length+3*n)+4,t._fontSize=12*n;for(var r=0;r<t._view.length;r++)t._view[r].x=4,t._view[r].y=r*t._fontSize+2*n;t._canvas||((t._canvas=new vt("2D")).size(t._width,t._height),(t._ctx=t._canvas.getContext("2d")).textBaseline="top",t._ctx.font=t._fontSize+"px Sans-serif",t._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+e+"px;top:"+i+"px;width:"+t._width/n+"px;height:"+t._height/n+"px;"),t._first=!0,t.loop(),t._first=!1,k.container.appendChild(t._canvas.source)},t.createUI=function(e,i){var n=t._sp,r=k.pixelRatio;n||(n=new ut,(t._leftText=new mt).pos(5,5),t._leftText.color="#ffffff",n.addChild(t._leftText),(t._txt=new mt).pos(80*r,5),t._txt.color="#ffffff",n.addChild(t._txt),t._sp=n),n.pos(e,i);for(var a="",s=0;s<t._view.length;s++)a+=t._view[s].title+"\n";t._leftText.text=a;var o=138*r,l=r*(12*t._view.length+3*r)+4;t._txt.fontSize=t._fontSize*r,t._leftText.fontSize=t._fontSize*r,n.size(o,l),n.graphics.clear(),n.graphics.setAlpha(.5),n.graphics.drawRect(0,0,o,l,"#999999"),n.graphics.setAlpha(1),t.loop()},t.enable=function(){i.timer.frameLoop(1,t,t.loop)},t.hide=function(){t._show=!1,i.timer.clear(t,t.loop),t._canvas&&k.removeElement(t._canvas.source)},t.clear=function(){t.trianglesFaces=t.drawCall=t.shaderCall=t.spriteCount=t.spriteRenderUseCacheCount=t.treeNodeCollision=t.treeSpriteCollision=t.canvasNormal=t.canvasBitmap=t.canvasReCache=0},t.loop=function(){t._count++;var e=k.now();if(!(e-t._timer<1e3)){var i=t._count;if(t.FPS=Math.round(1e3*i/(e-t._timer)),t._show){t.trianglesFaces=Math.round(t.trianglesFaces/i),t._useCanvas?(t.drawCall=Math.round(t.drawCall/i)-2,t.shaderCall=Math.round(t.shaderCall/i),t.spriteCount=Math.round(t.spriteCount/i)-1):(t.drawCall=Math.round(t.drawCall/i)-2,t.shaderCall=Math.round(t.shaderCall/i)-4,t.spriteCount=Math.round(t.spriteCount/i)-4),t.spriteRenderUseCacheCount=Math.round(t.spriteRenderUseCacheCount/i),t.canvasNormal=Math.round(t.canvasNormal/i),t.canvasBitmap=Math.round(t.canvasBitmap/i),t.canvasReCache=Math.ceil(t.canvasReCache/i),t.treeNodeCollision=Math.round(t.treeNodeCollision/i),t.treeSpriteCollision=Math.round(t.treeSpriteCollision/i);var n=t.FPS>0?Math.floor(1e3/t.FPS).toString():" ";t._fpsStr=t.FPS+(t.renderSlow?" slow":"")+" "+n,t._spriteStr=t.spriteCount+(t.spriteRenderUseCacheCount?"/"+t.spriteRenderUseCacheCount:""),t._canvasStr=t.canvasReCache+"/"+t.canvasNormal+"/"+t.canvasBitmap,t.currentMemorySize=V.systemResourceManager.memorySize,t._useCanvas?t.renderInfoPre():t.renderInfo(),t.clear()}t._count=0,t._timer=e}},t.renderInfoPre=function(){if(t._canvas){var e=t._ctx;e.clearRect(t._first?0:t._vx,0,t._width,t._height);for(var i=0;i<t._view.length;i++){var n=t._view[i];t._first&&(e.fillStyle="white",e.fillText(n.title,n.x,n.y,null,null,null)),e.fillStyle=n.color;var r=t[n.value];"M"==n.units&&(r=Math.floor(r/1048576*100)/100+" M"),e.fillText(r+"",n.x+t._vx,n.y,null,null,null)}}},t.renderInfo=function(){for(var e="",i=0;i<t._view.length;i++){var n=t._view[i],r=t[n.value];"M"==n.units&&(r=Math.floor(r/1048576*100)/100+" M"),"K"==n.units&&(r=Math.floor(r/1024*100)/100+" K"),e+=r+"\n"}t._txt.text=e},t.FPS=0,t.loopCount=0,t.shaderCall=0,t.drawCall=0,t.trianglesFaces=0,t.spriteCount=0,t.spriteRenderUseCacheCount=0,t.treeNodeCollision=0,t.treeSpriteCollision=0,t.canvasNormal=0,t.canvasBitmap=0,t.canvasReCache=0,t.renderSlow=!1,t.currentMemorySize=0,t._fpsStr=null,t._canvasStr=null,t._spriteStr=null,t._fpsData=[],t._timer=0,t._count=0,t._view=[],t._fontSize=12,t._txt=null,t._leftText=null,t._sp=null,t._show=!1,t._useCanvas=!1,t._canvas=null,t._ctx=null,t._first=!1,t._vx=NaN,t._width=0,t._height=100,t}()),j=(function(){function t(){this._strsToID={},this._idToStrs=[],this._length=0}r(t,"laya.utils.StringKey");var e=t.prototype;e.add=function(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)},e.getID=function(t){var e=this._strsToID[t];return null==e?-1:e},e.getName=function(t){var e=this._idToStrs[t];return null==e?void 0:e}}(),function(){function t(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map=[],this._laters=[],this._handlers=[],this._temp=[],this._count=0,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}var e;r(t,"laya.utils.Timer");var n=t.prototype;return n._init=function(){i.timer&&i.timer.frameLoop(1,this,this._update)},n._now=function(){return Date.now()},n._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var t=this.currFrame=this.currFrame+this.scale,e=this._now();this._delta=(e-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;var n=this._handlers;for(this._count=0,s=0,o=n.length;s<o;s++)if(null!==(l=n[s]).method){var r=l.userFrame?t:i;if(r>=l.exeTime)if(l.repeat)if(l.jumpFrame)for(;r>=l.exeTime;)l.exeTime+=l.delay,l.run(!1);else l.exeTime+=l.delay,l.run(!1),r>l.exeTime&&(l.exeTime+=Math.ceil((r-l.exeTime)/l.delay)*l.delay);else l.run(!0)}else this._count++;(this._count>30||t%200==0)&&this._clearHandlers();for(var a=this._laters,s=0,o=a.length-1;s<=o;s++){var l=a[s];null!==l.method&&(this._map[l.key]=null,l.run(!1)),this._recoverHandler(l),s===o&&(o=a.length-1)}a.length=0}},n._clearHandlers=function(){for(var t=this._handlers,e=0,i=t.length;e<i;e++){var n=t[e];null!==n.method?this._temp.push(n):this._recoverHandler(n)}this._handlers=this._temp,this._temp=t,this._temp.length=0},n._recoverHandler=function(e){this._map[e.key]==e&&(this._map[e.key]=null),e.clear(),t._pool.push(e)},n._create=function(i,n,r,a,s,o,l){if(!r)return s.apply(a,o),null;if(l){var h=this._getHandler(a,s);if(h)return h.repeat=n,h.userFrame=i,h.delay=r,h.caller=a,h.method=s,h.args=o,h.exeTime=r+(i?this.currFrame:this.currTimer+this._now()-this._lastTimer),h}return(h=t._pool.length>0?t._pool.pop():new e).repeat=n,h.userFrame=i,h.delay=r,h.caller=a,h.method=s,h.args=o,h.exeTime=r+(i?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(h),this._handlers.push(h),h},n._indexHandler=function(t){var e=t.caller,i=t.method,n=e?e.$_GID||(e.$_GID=q.getGID()):0,r=i.$_TID||(i.$_TID=1e5*this._mid++);t.key=n+r,this._map[t.key]=t},n.once=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!1,!1,t,e,i,n,r)},n.loop=function(t,e,i,n,r,a){void 0===r&&(r=!0),void 0===a&&(a=!1);var s=this._create(!1,!0,t,e,i,n,r);s&&(s.jumpFrame=a)},n.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!1,t,e,i,n,r)},n.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!0,t,e,i,n,r)},n.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+t._pool.length},n.clear=function(t,e){var i=this._getHandler(t,e);i&&(this._map[i.key]=null,i.key=0,i.clear())},n.clearAll=function(t){if(t)for(var e=0,i=this._handlers.length;e<i;e++){var n=this._handlers[e];n.caller===t&&(this._map[n.key]=null,n.key=0,n.clear())}},n._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=q.getGID()):0,n=e.$_TID||(e.$_TID=1e5*this._mid++);return this._map[i+n]},n.callLater=function(i,n,r){if(null==this._getHandler(i,n)){if(t._pool.length)var a=t._pool.pop();else a=new e;a.caller=i,a.method=n,a.args=r,this._indexHandler(a),this._laters.push(a)}},n.runCallLater=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))},n.runTimer=function(t,e){this.runCallLater(t,e)},a(0,n,"delta",function(){return this._delta}),t._pool=[],t.__init$=function(){e=function(){function t(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}r(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null},e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,n=this.args;t&&this.clear(),null!=i&&(n?i.apply(e,n):i.call(e))},t}()},t}()),K=function(){function t(){this.gid=0}r(t,"laya.utils.Tween");var e=t.prototype;return e.to=function(t,e,i,n,r,a,s){return void 0===a&&(a=0),void 0===s&&(s=!1),this._create(t,e,i,n,r,a,s,!0,!1,!0)},e.from=function(t,e,i,n,r,a,s){return void 0===a&&(a=0),void 0===s&&(s=!1),this._create(t,e,i,n,r,a,s,!1,!1,!0)},e._create=function(e,n,r,a,s,o,l,h,c,u){if(!e)throw new Error("Tween:target is null");this._target=e,this._duration=r,this._ease=a||n.ease||t.easeNone,this._complete=s||n.complete,this._delay=o,this._props=[],this._usedTimer=0,this._startTimer=k.now(),this._usedPool=c,this._delayParam=null,this.update=n.update;var _=e.$_GID||(e.$_GID=q.getGID());return t.tweenMap[_]?(l&&t.clearTween(e),t.tweenMap[_].push(this)):t.tweenMap[_]=[this],u?o<=0?this.firstStart(e,n,h):(this._delayParam=[e,n,h],i.scaleTimer.once(o,this,this.firstStart,this._delayParam)):this._initProps(e,n,h),this},e.firstStart=function(t,e,i){this._delayParam=null,t.destroyed?this.clear():(this._initProps(t,e,i),this._beginLoop())},e._initProps=function(t,e,i){for(var n in e)if("number"==typeof t[n]){var r=i?t[n]:e[n],a=i?e[n]:t[n];this._props.push([n,r,a-r]),i||(t[n]=r)}},e._beginLoop=function(){i.scaleTimer.frameLoop(1,this,this._doEase)},e._doEase=function(){this._updateEase(k.now())},e._updateEase=function(e){var i=this._target;if(i){if(i.destroyed)return t.clearTween(i);var n=this._usedTimer=e-this._startTimer-this._delay;if(!(n<0)){if(n>=this._duration)return this.complete();for(var r=n>0?this._ease(n,0,1,this._duration):0,a=this._props,s=0,o=a.length;s<o;s++){var l=a[s];i[l[0]]=l[1]+r*l[2]}this.update&&this.update.run()}}},e.complete=function(){if(this._target){i.scaleTimer.runTimer(this,this.firstStart);for(var t=this._target,e=this._props,n=this._complete,r=0,a=e.length;r<a;r++){var s=e[r];t[s[0]]=s[1]+s[2]}this.update&&this.update.run(),this.clear(),n&&n.run()}},e.pause=function(){i.scaleTimer.clear(this,this._beginLoop),i.scaleTimer.clear(this,this._doEase),i.scaleTimer.clear(this,this.firstStart);var t;(t=k.now()-this._startTimer-this._delay)<0&&(this._usedTimer=t)},e.setStartTime=function(t){this._startTimer=t},e.clear=function(){this._target&&(this._remove(),this._clear())},e._clear=function(){this.pause(),i.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,Y.recover("tween",this))},e.recover=function(){this._usedPool=!0,this._clear()},e._remove=function(){var e=t.tweenMap[this._target.$_GID];if(e)for(var i=0,n=e.length;i<n;i++)if(e[i]===this){e.splice(i,1);break}},e.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=k.now(),this._delayParam)i.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var t=this._props,e=0,n=t.length;e<n;e++){var r=t[e];this._target[r[0]]=r[1]}i.scaleTimer.once(this._delay,this,this._beginLoop)}},e.resume=function(){this._usedTimer>=this._duration||(this._startTimer=k.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?i.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},a(0,e,"progress",null,function(t){var e=t*this._duration;this._startTimer=k.now()-this._delay-e}),t.to=function(e,i,n,r,a,s,o,l){return void 0===s&&(s=0),void 0===o&&(o=!1),void 0===l&&(l=!0),Y.getItemByClass("tween",t)._create(e,i,n,r,a,s,o,!0,l,!0)},t.from=function(e,i,n,r,a,s,o,l){return void 0===s&&(s=0),void 0===o&&(o=!1),void 0===l&&(l=!0),Y.getItemByClass("tween",t)._create(e,i,n,r,a,s,o,!1,l,!0)},t.clearAll=function(e){if(e&&e.$_GID){var i=t.tweenMap[e.$_GID];if(i){for(var n=0,r=i.length;n<r;n++)i[n]._clear();i.length=0}}},t.clear=function(t){t.clear()},t.clearTween=function(e){t.clearAll(e)},t.easeNone=function(t,e,i,n){return i*t/n+e},t.tweenMap={},t}(),q=function(){function t(){}return r(t,"laya.utils.Utils"),t.toRadian=function(e){return e*t._pi2},t.toAngle=function(e){return e*t._pi},t.toHexColor=function(t){if(t<0||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e},t.getGID=function(){return t._gid++},t.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,n=e.length;for(i=0;i<n;i++)t.push(e[i]);return t},t.clearArray=function(t){return t?(t.length=0,t):t},t.copyArray=function(t,e){if(t||(t=[]),!e)return t;t.length=e.length;var i=0,n=e.length;for(i=0;i<n;i++)t[i]=e[i];return t},t.getGlobalRecByPoints=function(t,e,i,n,r){var a,s;return a=new b(e,i),a=t.localToGlobal(a),s=new b(n,r),s=t.localToGlobal(s),M._getWrapRec([a.x,a.y,s.x,s.y])},t.getGlobalPosAndScale=function(e){return t.getGlobalRecByPoints(e,0,0,1,1)},t.bind=function(t,e){return t.bind(e)},t.measureText=function(t,e){return s.measureText(t,e)},t.updateOrder=function(t){if(!t||t.length<2)return!1;for(var e,i=1,n=0,r=t.length,a=NaN;i<r;){for(e=t[n=i],a=t[n]._zOrder;--n>-1&&t[n]._zOrder>a;)t[n+1]=t[n];t[n+1]=e,i++}var s=e.parent.conchModel;if(s)if(null!=s.updateZOrder)s.updateZOrder();else{for(i=0;i<r;i++)s.removeChild(t[i].conchModel);for(i=0;i<r;i++)s.addChildAt(t[i].conchModel,i)}return!0},t.transPointList=function(t,e,i){var n=0,r=t.length;for(n=0;n<r;n+=2)t[n]+=e,t[n+1]+=i},t.parseInt=function(t,e){void 0===e&&(e=0);var i=k.window.parseInt(t,e);return isNaN(i)?0:i},t.getFileExtension=function(e){t._extReg.lastIndex=e.lastIndexOf(".");var i=t._extReg.exec(e);return i&&i.length>1?i[1].toLowerCase():null},t.getTransformRelativeToWindow=function(t,e,n){var r=i.stage,a=laya.utils.Utils.getGlobalPosAndScale(t),s=r._canvasTransform.clone(),o=s.tx,l=s.ty;s.rotate(-Math.PI/180*i.stage.canvasDegree),s.scale(i.stage.clientScaleX,i.stage.clientScaleY);var h=i.stage.canvasDegree%180!=0,c=NaN,u=NaN;h?(c=n+a.y,u=e+a.x,c*=s.d,u*=s.a,90==i.stage.canvasDegree?(c=o-c,u+=l):(c+=o,u=l-u)):(c=e+a.x,u=n+a.y,c*=s.a,u*=s.d,c+=o,u+=l);var _=NaN,d=NaN;return h?(_=s.d*a.height,d=s.a*a.width):(_=s.a*a.width,d=s.d*a.height),{x:c,y:u,scaleX:_,scaleY:d}},t.fitDOMElementInArea=function(e,n,r,a,s,o){e._fitLayaAirInitialized||(e._fitLayaAirInitialized=!0,e.style.transformOrigin=e.style.webKittransformOrigin="left top",e.style.position="absolute");var l=t.getTransformRelativeToWindow(n,r,a);e.style.transform=e.style.webkitTransform="scale("+l.scaleX+","+l.scaleY+") rotate("+i.stage.canvasDegree+"deg)",e.style.width=s+"px",e.style.height=o+"px",e.style.left=l.x+"px",e.style.top=l.y+"px"},t.isOkTextureList=function(t){if(!t)return!1;var e,i=0,n=t.length;for(i=0;i<n;i++)if(!(e=t[i])||!e.source)return!1;return!0},t.isOKCmdList=function(t){if(!t)return!1;var e,i,n=0,r=t.length,a=L._context;for(n=0;n<r;n++)switch((e=t[n]).callee){case a._drawTexture:case a._fillTexture:case a._drawTextureWithTransform:if(!(i=e[0])||!i.source)return!1}return!0},t._gid=1,t._pi=180/Math.PI,t._pi2=Math.PI/180,t._extReg=/\.(\w+)\??/g,t.parseXMLFromString=function(t){var e;if(t=t.replace(/>\s+</g,"><"),(e=(new DOMParser).parseFromString(t,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors")>-1)throw new Error(e.firstChild.firstChild.textContent);return e},t}(),Z=function(){function t(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],L.isWebGL&&B.regCacheByFunction(q.bind(this.startDispose,this),q.bind(this.getCacheList,this))}r(t,"laya.utils.VectorGraphManager");var e=t.prototype;return e.getId=function(){return this._id++},e.addShape=function(t,e){this.shapeDic[t]=e,this.useDic[t]||(this.useDic[t]=!0)},e.addLine=function(t,e){this.shapeLineDic[t]=e,this.shapeLineDic[t]||(this.shapeLineDic[t]=!0)},e.getShape=function(t){this._checkKey&&null!=this.useDic[t]&&(this.useDic[t]=!0)},e.deleteShape=function(t){this.shapeDic[t]&&(this.shapeDic[t]=null,delete this.shapeDic[t]),this.shapeLineDic[t]&&(this.shapeLineDic[t]=null,delete this.shapeLineDic[t]),null!=this.useDic[t]&&delete this.useDic[t]},e.getCacheList=function(){var t,e=[];for(t in this.shapeDic)e.push(this.shapeDic[t]);for(t in this.shapeLineDic)e.push(this.shapeLineDic[t]);return e},e.startDispose=function(t){var e;for(e in this.useDic)this.useDic[e]=!1;this._checkKey=!0},e.endDispose=function(){if(this._checkKey){var t;for(t in this.useDic)this.useDic[t]||this.deleteShape(t);this._checkKey=!1}},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),Q=function(){function t(){this._obj=null,this._obj=t.supportWeakMap?new k.window.WeakMap:{},t.supportWeakMap||t._maps.push(this)}r(t,"laya.utils.WeakObject");var e=t.prototype;return e.set=function(e,i){if(null!=e)if(t.supportWeakMap){var n=e;"string"!=typeof e&&"number"!=typeof e||(n=t._keys[e])||(n=t._keys[e]={k:e}),this._obj.set(n,i)}else"string"==typeof e||"number"==typeof e?this._obj[e]=i:(e.$_GID||(e.$_GID=q.getGID()),this._obj[e.$_GID]=i)},e.get=function(e){if(null==e)return null;if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;return i?this._obj.get(i):null}return"string"==typeof e||"number"==typeof e?this._obj[e]:this._obj[e.$_GID]},e.del=function(e){if(null!=e)if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;if(!i)return;this._obj.delete(i)}else"string"==typeof e||"number"==typeof e?delete this._obj[e]:delete this._obj[this._obj.$_GID]},e.has=function(e){if(null==e)return!1;if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;return this._obj.has(i)}return"string"==typeof e||"number"==typeof e?null!=this._obj[e]:null!=this._obj[this._obj.$_GID]},t.__init__=function(){(t.supportWeakMap=null!=k.window.WeakMap)||i.timer.loop(t.delInterval,null,t.clearCache)},t.clearCache=function(){for(var e=0,i=t._maps.length;e<i;e++)t._maps[e]._obj={}},t.supportWeakMap=!1,t.delInterval=3e5,t._keys={},t._maps=[],n(t,["I",function(){return this.I=new t}]),t}(),$=function(){function t(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}r(t,"laya.utils.WordText");var e=t.prototype;return e.setText=function(t){t=window.__replace_string?window.__replace_string(t,this):t,this.changed=!0,this._text=t},e.toString=function(){return this._text},e.charCodeAt=function(t){return this._text?this._text.charCodeAt(t):NaN},e.charAt=function(t){return this._text?this._text.charAt(t):null},a(0,e,"length",function(){return this._text?this._text.length:0}),t}(),J=function(t){function e(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,e.__super.call(this),this._childs=e.ARRAY_EMPTY,this._$P=e.PROP_EMPTY,this.timer=i.scaleTimer,this.conchModel=L.isConchNode?this.createConchModel():null}r(e,"laya.display.Node",l);var n=e.prototype;return n._setBit=function(t,e){1==t&&this._getBit(t)!=e&&this._updateDisplayedInstage(),e?this._bits|=t:this._bits&=~t},n._getBit=function(t){return 0!=(this._bits&t)},n._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},n._setUpNoticeType=function(t){var e=this;for(e._setBit(t,!0),e=e.parent;e;){if(e._getBit(t))return;e._setBit(t,!0),e=e.parent}},n.on=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,n,!1)},n.once=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,n,!0)},n.createConchModel=function(){return null},n.destroy=function(t){void 0===t&&(t=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(t?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},n.destroyChildren=function(){if(this._childs)for(var t=this._childs.length-1;t>-1;t--)this._childs[t].destroy(!0)},n.addChild=function(t){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var i=this.getChildIndex(t);i!==this._childs.length-1&&(this._childs.splice(i,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===e.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),t.parent=this,this._childChanged();return t},n.addChildren=function(t){for(var e=arguments,i=0,n=e.length;i<n;)this.addChild(e[i++])},n.addChildAt=function(t,i){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),i>=0&&i<=this._childs.length){if(t._parent===this){var n=this.getChildIndex(t);this._childs.splice(n,1),this._childs.splice(i,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,i)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===e.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(i,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,i),t.parent=this;return t}throw new Error("appendChildAt:The index is out of bounds")},n.getChildIndex=function(t){return this._childs.indexOf(t)},n.getChildByName=function(t){var e=this._childs;if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.name===t)return r}return null},n._get$P=function(t){return this._$P[t]},n._set$P=function(t,i){return this.destroyed||(this._$P===e.PROP_EMPTY&&(this._$P={}),this._$P[t]=i),i},n.getChildAt=function(t){return this._childs[t]},n.setChildIndex=function(t,e){var i=this._childs;if(e<0||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var n=this.getChildIndex(t);if(n<0)throw new Error("setChildIndex:node is must child of this object.");return i.splice(n,1),i.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged(),t},n._childChanged=function(t){},n.removeChild=function(t){if(!this._childs)return t;var e=this._childs.indexOf(t);return this.removeChildAt(e)},n.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},n.removeChildByName=function(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e},n.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},n.removeChildren=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=2147483647),this._childs&&this._childs.length>0){var n=this._childs;if(0===t&&i>=s){var r=n;this._childs=e.ARRAY_EMPTY}else r=n.splice(t,i-t);for(var a=0,s=r.length;a<s;a++)r[a].parent=null,this.conchModel&&this.conchModel.removeChild(r[a].conchModel)}return this},n.replaceChild=function(t,e){var i=this._childs.indexOf(e);return i>-1?(this._childs.splice(i,1,t),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(t.conchModel,i)),e.parent=null,t.parent=this,t):null},n._updateDisplayedInstage=function(){var t;t=this;var e=i.stage;for(this._displayedInStage=!1;t;){if(t._getBit(1)){this._displayedInStage=t._displayedInStage;break}if(t==e||t._displayedInStage){this._displayedInStage=!0;break}t=t.parent}},n._setDisplay=function(t){this._displayedInStage!==t&&(this._displayedInStage=t,t?this.event("display"):this.event("undisplay"))},n._displayChild=function(t,e){var i=t._childs;if(i)for(var n=0,r=i.length;n<r;n++){var a=i[n];a._getBit(1)&&(a._childs.length>0?this._displayChild(a,e):a._setDisplay(e))}t._setDisplay(e)},n.contains=function(t){if(t===this)return!0;for(;t;){if(t.parent===this)return!0;t=t.parent}return!1},n.timerLoop=function(t,e,i,n,r,a){void 0===r&&(r=!0),void 0===a&&(a=!1),this.timer.loop(t,e,i,n,r,a)},n.timerOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!1,!1,t,e,i,n,r)},n.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!0,!0,t,e,i,n,r)},n.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!0,!1,t,e,i,n,r)},n.clearTimer=function(t,e){this.timer.clear(t,e)},a(0,n,"numChildren",function(){return this._childs.length}),a(0,n,"destroyed",function(){return this._destroyed}),a(0,n,"parent",function(){return this._parent},function(t){this._parent!==t&&(t?(this._parent=t,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),t.displayedInStage&&this._displayChild(this,!0)),t._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=t))}),a(0,n,"displayedInStage",function(){return this._getBit(1)?this._displayedInStage:(this._setUpNoticeType(1),this._displayedInStage)}),e.ARRAY_EMPTY=[],e.PROP_EMPTY={},e.NOTICE_DISPLAY=1,e.MOUSEENABLE=2,e}(),tt=function(t){function e(t){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,e.__super.call(this),this._padding=e._PADDING,this._spacing=e._SPACING,this._aligns=e._ALIGNS,this._font=_.EMPTY,this._ower=t}r(e,"laya.display.css.CSSStyle",t);var i=e.prototype;return i.destroy=function(){this._ower=null,this._font=null,this._rect=null},i.inherit=function(t){this._font=t._font,this._spacing=t._spacing===e._SPACING?e._SPACING:t._spacing.slice(),this.lineHeight=t.lineHeight},i._widthAuto=function(){return 0!=(262144&this._type)},i.widthed=function(t){return 0!=(8&this._type)},i._calculation=function(t,e){function i(t,e,i){return t*i[0]+e*i[1]+i[2]}function n(t){var e=a.width,n=r.width;s.width&&(r.width=i(e,n,s.width)),s.height&&(r.height=i(e,n,s.height)),s.left&&(r.x=i(e,n,s.left)),s.top&&(r.y=i(e,n,s.top))}if(e.indexOf("%")<0)return!1;var r=this._ower,a=r.parent,s=this._rect;null===s&&(a._getCSSStyle()._type|=524288,a.on("resize",this,n),this._rect=s={input:{}});var o=e.split(" ");return o[0]=parseFloat(o[0])/100,1==o.length?o[1]=o[2]=0:(o[1]=parseFloat(o[1])/100,o[2]=parseFloat(o[2])),s[t]=o,s.input[t]=e,n(),!0},i.heighted=function(t){return 0!=(8192&this._type)},i.size=function(t,e){var i=this._ower,n=!1;-1!==t&&t!=this._ower.width&&(this._type|=8,this._ower.width=t,n=!0),-1!==e&&e!=this._ower.height&&(this._type|=8192,this._ower.height=e,n=!0),n&&(i._layoutLater(),524288&this._type&&i.event("resize",this))},i._getAlign=function(){return this._aligns[0]},i._getValign=function(){return this._aligns[1]},i._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},i._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new _(this._font))},i.render=function(t,e,i,n){var r=t.width,a=t.height;i-=t.pivotX,n-=t.pivotY,this._bgground&&null!=this._bgground.color&&e.ctx.fillRect(i,n,r,a,this._bgground.color),this._border&&this._border.color&&e.drawRect(i,n,r,a,this._border.color.strColor,this._border.size)},i.getCSSStyle=function(){return this},i.cssText=function(t){this.attrs(e.parseOneCSS(t,";"))},i.attrs=function(t){if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];this[n[0]]=n[1]}},i.setTransform=function(t){"none"===t?this._tf=u._TF_EMPTY:this.attrs(e.parseOneCSS(t,","))},i.translate=function(t,e){this._tf===u._TF_EMPTY&&(this._tf=new d),this._tf.translateX=t,this._tf.translateY=e},i.scale=function(t,e){this._tf===u._TF_EMPTY&&(this._tf=new d),this._tf.scaleX=t,this._tf.scaleY=e},i._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},a(0,i,"block",t.prototype._$get_block,function(t){t?this._type|=1:this._type&=-2}),a(0,i,"valign",function(){return e._valigndef[this._aligns[1]]},function(t){this._aligns===e._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=e._valigndef[t]}),a(0,i,"height",null,function(t){if(this._type|=8192,"string"==typeof t){if(this._calculation("height",t))return;t=parseInt(t)}this.size(-1,t)}),a(0,i,"width",null,function(t){if(this._type|=8,"string"==typeof t){var e=t.indexOf("auto");if(e>=0&&(this._type|=262144,t=t.substr(0,e)),this._calculation("width",t))return;t=parseInt(t)}this.size(t,-1)}),a(0,i,"fontWeight",function(){return this._font.weight},function(t){this._createFont().weight=t}),a(0,i,"left",null,function(t){var e=this._ower;if("string"==typeof t){if("center"===t?t="50% -50% 0":"right"===t&&(t="100% -100% 0"),this._calculation("left",t))return;t=parseInt(t)}e.x=t}),a(0,i,"_translate",null,function(t){this.translate(t[0],t[1])}),a(0,i,"absolute",function(){return 0!=(4&this._type)}),a(0,i,"top",null,function(t){var e=this._ower;if("string"==typeof t){if("middle"===t?t="50% -50% 0":"bottom"===t&&(t="100% -100% 0"),this._calculation("top",t))return;t=parseInt(t)}e.y=t}),a(0,i,"align",function(){return e._aligndef[this._aligns[0]]},function(t){this._aligns===e._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=e._aligndef[t]}),a(0,i,"bold",function(){return this._font.bold},function(t){this._createFont().bold=t}),a(0,i,"padding",function(){return this._padding},function(t){this._padding=t}),a(0,i,"leading",function(){return this._spacing[1]},function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===e._SPACING&&(this._spacing=[0,0]),this._spacing[1]=t}),a(0,i,"lineElement",function(){return 0!=(65536&this._type)},function(t){t?this._type|=65536:this._type&=-65537}),a(0,i,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(t){this.lineElement=!1,"right"===t?this._type|=32768:this._type&=-32769}),a(0,i,"textDecoration",function(){return this._font.decoration},function(t){this._createFont().decoration=t}),a(0,i,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(t){"nowrap"===t&&(this._type|=131072),"none"===t&&(this._type&=-131073)}),a(0,i,"background",null,function(t){t?(this._bgground||(this._bgground={}),this._bgground.color=t,this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),a(0,i,"wordWrap",function(){return 0==(131072&this._type)},function(t){t?this._type&=-131073:this._type|=131072}),a(0,i,"color",function(){return this._font.color},function(t){this._createFont().color=t}),a(0,i,"password",function(){return this._font.password},function(t){this._createFont().password=t}),a(0,i,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(t){"none"===t?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=t),this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._ower._renderType|=256}),a(0,i,"font",function(){return this._font.toString()},function(t){this._createFont().set(t)}),a(0,i,"weight",null,function(t){this._createFont().weight=t}),a(0,i,"letterSpacing",function(){return this._spacing[0]},function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===e._SPACING&&(this._spacing=[0,0]),this._spacing[0]=t}),a(0,i,"fontSize",function(){return this._font.size},function(t){this._createFont().size=t}),a(0,i,"italic",function(){return this._font.italic},function(t){this._createFont().italic=t}),a(0,i,"fontFamily",function(){return this._font.family},function(t){this._createFont().family=t}),a(0,i,"stroke",function(){return this._font.stroke[0]},function(t){this._createFont().stroke===_._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=t}),a(0,i,"strokeColor",function(){return this._font.stroke[1]},function(t){this._createFont().stroke===_._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=t}),a(0,i,"border",function(){return this._border?this._border.value:""},function(t){if("none"!=t){this._border||(this._border={}),this._border.value=t;var e=t.split(" ");if(this._border.color=H.create(e[e.length-1]),1==e.length)return this._border.size=1,void(this._border.type="solid");var i=0;e[0].indexOf("px")>0?(this._border.size=parseInt(e[0]),i++):this._border.size=1,this._border.type=e[i],this._ower._renderType|=256}else this._border=null}),a(0,i,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(t){t?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==t?null:H.create(t),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),a(0,i,"position",function(){return 4&this._type?"absolute":""},function(t){"absolute"==t?this._type|=4:this._type&=-5}),a(0,i,"display",null,function(t){switch(t){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),a(0,i,"paddingLeft",function(){return this.padding[3]}),a(0,i,"paddingTop",function(){return this.padding[0]}),a(0,i,"_scale",null,function(t){this._ower.scale(t[0],t[1])}),a(0,i,"_rotate",null,function(t){this._ower.rotation=t}),e.parseOneCSS=function(t,i){for(var n,r=[],a=t.split(i),s=0,o=a.length;s<o;s++){var l=a[s],h=l.indexOf(":"),c=l.substr(0,h).replace(/^\s+|\s+$/g,"");if(0!=c.length){var u=l.substr(h+1).replace(/^\s+|\s+$/g,""),_=[c,u];switch(c){case"italic":case"bold":_[1]="true"==u;break;case"line-height":_[0]="lineHeight",_[1]=parseInt(u);break;case"font-size":_[0]="fontSize",_[1]=parseInt(u);break;case"padding":(n=u.split(" ")).length>1||(n[1]=n[2]=n[3]=n[0]),_[1]=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];break;case"rotate":_[0]="_rotate",_[1]=parseFloat(u);break;case"scale":n=u.split(" "),_[0]="_scale",_[1]=[parseFloat(n[0]),parseFloat(n[1])];break;case"translate":n=u.split(" "),_[0]="_translate",_[1]=[parseInt(n[0]),parseInt(n[1])];break;default:(_[0]=e._CSSTOVALUE[c])||(_[0]=c)}r.push(_)}}return r},e.parseCSS=function(t,i){for(var n;null!=(n=e._parseCSSRegExp.exec(t));)e.styleSheets[n[1]]=e.parseOneCSS(n[2],";")},e.EMPTY=new e(null),e._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},e._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),e._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},e._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},e.styleSheets={},e.ALIGN_CENTER=1,e.ALIGN_RIGHT=2,e.VALIGN_MIDDLE=1,e.VALIGN_BOTTOM=2,e._CSS_BLOCK=1,e._DISPLAY_NONE=2,e._ABSOLUTE=4,e._WIDTH_SET=8,e._PADDING=[0,0,0,0],e._RECT=[-1,-1,-1,-1],e._SPACING=[0,0],e._ALIGNS=[0,0,0],e.ADDLAYOUTED=512,e._NEWFONT=4096,e._HEIGHT_SET=8192,e._BACKGROUND_SET=16384,e._FLOAT_RIGHT=32768,e._LINE_ELEMENT=65536,e._NOWARP=131072,e._WIDTHAUTO=262144,e._LISTERRESZIE=524288,e}(u),et=function(t){function e(){this.url=null,this.audio=null,this.loaded=!1,e.__super.call(this)}r(e,"laya.media.h5audio.AudioSound",l);var i=e.prototype;return i.dispose=function(){var t=e._audioCache[this.url];t&&(t.src="",delete e._audioCache[this.url])},i.load=function(t){function i(){r(),s.loaded=!0,s.event("complete")}function n(){a.load=null,r(),s.event("error")}function r(){a.removeEventListener("canplaythrough",i),a.removeEventListener("error",n)}var a;if(t=R.formatURL(t),this.url=t,t==I._tMusic?(e._initMusicAudio(),(a=e._musicAudio).src!=t&&(e._audioCache[a.src]=null,a=null)):a=e._audioCache[t],a&&a.readyState>=2)this.event("complete");else{a||(t==I._tMusic?(e._initMusicAudio(),a=e._musicAudio):a=k.createElement("audio"),e._audioCache[t]=a,a.src=t),a.addEventListener("canplaythrough",i),a.addEventListener("error",n);var s=this;this.audio=a,a.load?a.load():n()}},i.play=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),!this.url)return null;var n,r;if(!(n=this.url==I._tMusic?e._musicAudio:e._audioCache[this.url]))return null;r=Y.getItem("audio:"+this.url),L.isConchApp?r||((r=k.createElement("audio")).src=this.url):this.url==I._tMusic?(e._initMusicAudio(),(r=e._musicAudio).src=this.url):r=r||n.cloneNode(!0);var a=new _t(r);return a.url=this.url,a.loops=i,a.startTime=t,a.play(),I.addChannel(a),a},a(0,i,"duration",function(){var t;return(t=e._audioCache[this.url])?t.duration:0}),e._initMusicAudio=function(){e._musicAudio||(e._musicAudio||(e._musicAudio=k.createElement("audio")),L.isConchApp||k.document.addEventListener("mousedown",e._makeMusicOK))},e._makeMusicOK=function(){k.document.removeEventListener("mousedown",e._makeMusicOK),e._musicAudio.src?e._musicAudio.play():(e._musicAudio.src="",e._musicAudio.load())},e._audioCache={},e._musicAudio=null,e}(),it=function(t){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}r(e,"laya.media.SoundChannel",l);var i=e.prototype;return i.play=function(){},i.stop=function(){},i.pause=function(){},i.resume=function(){},i.__runComplete=function(t){t&&t.run()},a(0,i,"volume",function(){return 1},function(t){}),a(0,i,"position",function(){return 0}),a(0,i,"duration",function(){return 0}),e}(),nt=function(t){function e(){e.__super.call(this)}r(e,"laya.media.Sound",l);var i=e.prototype;return i.load=function(t){},i.play=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),null},i.dispose=function(){},a(0,i,"duration",function(){return 0}),e}(),rt=function(t){function e(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,e.__super.call(this)}r(e,"laya.media.webaudio.WebAudioSound",l);var i=e.prototype;return i.load=function(t){var i=this;if(t=R.formatURL(t),this.url=t,this.audioBuffer=e._dataCache[t],this.audioBuffer)this._loaded(this.audioBuffer);else if(e.e.on("loaded:"+t,this,this._loaded),e.e.on("err:"+t,this,this._err),!e.__loadingSound[t]){e.__loadingSound[t]=!0;var n=new k.window.XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){i._disposed?i._removeLoadEvents():(i.data=n.response,e.buffs.push({buffer:i.data,url:i.url}),e.decode())},n.onerror=function(t){i._err()},n.send()}},i._err=function(){this._removeLoadEvents(),e.__loadingSound[this.url]=!1,this.event("error")},i._loaded=function(t){this._removeLoadEvents(),this._disposed||(this.audioBuffer=t,e._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete"))},i._removeLoadEvents=function(){e.e.off("loaded:"+this.url,this,this._loaded),e.e.off("err:"+this.url,this,this._err)},i.__playAfterLoaded=function(){if(this.__toPlays){var t,e,i,n=0;for(e=(t=this.__toPlays).length,n=0;n<e;n++)(i=t[n])[2]&&!i[2].isStopped&&this.play(i[0],i[1],i[2]);this.__toPlays.length=0}},i.play=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),i=i||new dt,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=e,i.audioBuffer=this.audioBuffer,i.startTime=t,i.play(),I.addChannel(i),i},i.dispose=function(){this._disposed=!0,delete e._dataCache[this.url],delete e.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},a(0,i,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),e.decode=function(){e.buffs.length<=0||e.isDecoding||(e.isDecoding=!0,e.tInfo=e.buffs.shift(),e.ctx.decodeAudioData(e.tInfo.buffer,e._done,e._fail))},e._done=function(t){e.e.event("loaded:"+e.tInfo.url,t),e.isDecoding=!1,e.decode()},e._fail=function(){e.e.event("err:"+e.tInfo.url,null),e.isDecoding=!1,e.decode()},e._playEmptySound=function(){if(null!=e.ctx){var t=e.ctx.createBufferSource();t.buffer=e._miniBuffer,t.connect(e.ctx.destination),t.start(0,0,0)}},e._unlock=function(){e._unlocked||(e._playEmptySound(),"running"==e.ctx.state&&(k.document.removeEventListener("mousedown",e._unlock,!0),k.document.removeEventListener("touchend",e._unlock,!0),e._unlocked=!0))},e.initWebAudio=function(){"running"!=e.ctx.state&&(e._unlock(),k.document.addEventListener("mousedown",e._unlock,!0),k.document.addEventListener("touchend",e._unlock,!0))},e._dataCache={},e.buffs=[],e.isDecoding=!1,e._unlocked=!1,e.tInfo=null,e.__loadingSound={},n(e,["window",function(){return this.window=k.window},"webAudioEnabled",function(){return this.webAudioEnabled=e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext},"ctx",function(){return this.ctx=e.webAudioEnabled?new(e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=e.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new l}]),e}(),at=function(t){function e(){this._responseType=null,this._data=null,e.__super.call(this),this._http=new k.window.XMLHttpRequest}r(e,"laya.net.HttpRequest",l);var i=e.prototype;return i.send=function(t,e,i,n,r){void 0===i&&(i="get"),void 0===n&&(n="text"),this._responseType=n,this._data=null;var a=this,s=this._http;if(s.open(i,t,!0),r)for(var o=0;o<r.length;o++)s.setRequestHeader(r[o++],r[o]);else L.isConchApp||(e&&"string"!=typeof e?s.setRequestHeader("Content-Type","application/json"):s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));s.responseType="arraybuffer"!==n?"text":"arraybuffer",s.onerror=function(t){a._onError(t)},s.onabort=function(t){a._onAbort(t)},s.onprogress=function(t){a._onProgress(t)},s.onload=function(t){a._onLoad(t)},s.send(e)},i._onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)},i._onAbort=function(t){this.error("Request was aborted by user")},i._onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},i._onLoad=function(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)},i.error=function(t){this.clear(),this.event("error",t)},i.complete=function(){this.clear();var t=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=q.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(e){t=!1,this.error(e.message)}t&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null},a(0,i,"url",function(){return this._http.responseURL}),a(0,i,"http",function(){return this._http}),a(0,i,"data",function(){return this._data}),e}(),st=function(t){function e(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,e.__super.call(this)}r(e,"laya.net.Loader",l);var n=e.prototype;return n.load=function(t,i,n,r,a){if(void 0===n&&(n=!0),void 0===a&&(a=!1),this._url=t,0===t.indexOf("data:image")?this._type=i="image":(this._type=i||(i=this.getTypeFromUrl(t)),t=R.formatURL(t)),this._cache=n,this._data=null,!a&&e.loadedMap[t])return this._data=e.loadedMap[t],this.event("progress",1),void this.event("complete",this._data);if(r&&e.setGroup(t,r),null!=e.parserMap[i])return this._customParse=!0,void(e.parserMap[i]instanceof laya.utils.Handler?e.parserMap[i].runWith(this):e.parserMap[i].call(null,this));if("image"===i||"htmlimage"===i||"nativeimage"===i)return this._loadImage(t);if("sound"===i)return this._loadSound(t);if("ttf"===i)return this._loadTTF(t);var s;switch(i){case"atlas":case"plf":s="json";break;case"font":s="xml";break;case"pkm":s="arraybuffer";break;default:s=i}e.preLoadedMap[t]?this.onLoaded(e.preLoadedMap[t]):(this._http||(this._http=new at,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),this._http.send(t,null,"get",s))},n.getTypeFromUrl=function(t){var i=q.getFileExtension(t);return i?e.typeMap[i]:(console.warn("Not recognize the resources suffix",t),"text")},n._loadTTF=function(t){t=R.formatURL(t);var e=new A;e.complete=h.create(this,this.onLoaded),e.load(t)},n._loadImage=function(t){function i(){n.onload=null,n.onerror=null,delete e.imgCache[t]}t=R.formatURL(t);var n,r=this,a=function(){i(),r.onLoaded(n)},s=function(){i(),r.event("error","Load image failed")};"nativeimage"===this._type?((n=new k.window.Image).crossOrigin="",n.onload=a,n.onerror=s,n.src=t,e.imgCache[t]=n):new Et.create(t,{onload:a,onerror:s,onCreate:function(i){n=i,e.imgCache[t]=i}})},n._loadSound=function(t){function e(){i.offAll()}var i=new I._soundClass,n=this;i.on("complete",this,function(){e(),n.onLoaded(i)}),i.on("error",this,function(){e(),i.dispose(),n.event("error","Load sound failed")}),i.load(t)},n.onProgress=function(t){"atlas"===this._type?this.event("progress",.3*t):this.event("progress",t)},n.onError=function(t){this.event("error",t)},n.onLoaded=function(t){var i=this._type;if("plf"==i)this.parsePLFData(t),this.complete(t);else if("image"===i){var n=new ht(t);n.url=this._url,this.complete(n)}else if("sound"===i||"htmlimage"===i||"nativeimage"===i)this.complete(t);else if("atlas"===i){if(!t.src&&!t._setContext){if(!this._data){if(this._data=t,t.meta&&t.meta.image)for(var r=t.meta.image.split(","),a=this._url.indexOf("/")>=0?"/":"\\",s=this._url.lastIndexOf(a),o=s>=0?this._url.substr(0,s+1):"",l=0,h=r.length;l<h;l++)r[l]=o+r[l];else r=[this._url.replace(".json",".png")];r.reverse(),t.toLoads=r,t.pics=[]}return this.event("progress",.3+1/r.length*.6),this._loadImage(r.pop())}if(this._data.pics.push(t),this._data.toLoads.length>0)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var u=this._data.frames,_=this._url.split("?")[0],d=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:_.substring(0,_.lastIndexOf("."))+"/",f=this._data.pics,p=R.formatURL(this._url),m=e.atlasMap[p]||(e.atlasMap[p]=[]);m.dir=d;var g=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var y in g=parseFloat(this._data.meta.scale),u){var v=u[y],S=f[v.frame.idx?v.frame.idx:0],x=R.formatURL(d+y);S.scaleRate=g,e.cacheRes(x,ht.create(S,v.frame.x,v.frame.y,v.frame.w,v.frame.h,v.spriteSourceSize.x,v.spriteSourceSize.y,v.sourceSize.w,v.sourceSize.h)),e.loadedMap[x].url=x,m.push(x)}else for(y in u)S=f[(v=u[y]).frame.idx?v.frame.idx:0],x=R.formatURL(d+y),e.cacheRes(x,ht.create(S,v.frame.x,v.frame.y,v.frame.w,v.frame.h,v.spriteSourceSize.x,v.spriteSourceSize.y,v.sourceSize.w,v.sourceSize.h)),e.loadedMap[x].url=x,m.push(x);delete this._data.pics,this.complete(this._data)}else if("font"==i){if(!t.src)return this._data=t,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var E=new c;E.parseFont(this._data,t);var T=this._url.split(".fnt")[0].split("/"),w=T[T.length-1];mt.registerBitmapFont(w,E),this._data=E,this.complete(this._data)}else if("pkm"==i){var C=Et.create(t,this._url),b=new ht(C);b.url=this._url,this.complete(b)}else this.complete(t)},n.parsePLFData=function(t){var i,n,r;for(i in t)switch(r=t[i],i){case"json":case"text":for(n in r)e.preLoadedMap[R.formatURL(n)]=r[n];break;default:for(n in r)e.preLoadedMap[R.formatURL(n)]=r[n]}},n.complete=function(t){this._data=t,this._customParse?this.event("loaded",t instanceof Array?[t]:t):(e._loaders.push(this),e._isWorking||e.checkNext())},n.endLoad=function(t){t&&(this._data=t),this._cache&&e.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},a(0,n,"url",function(){return this._url}),a(0,n,"data",function(){return this._data}),a(0,n,"cache",function(){return this._cache}),a(0,n,"type",function(){return this._type}),e.checkNext=function(){e._isWorking=!0;for(var t=k.now();e._startIndex<e._loaders.length;)if(k.now(),e._loaders[e._startIndex].endLoad(),e._startIndex++,k.now()-t>e.maxTimeOut)return console.warn("loader callback cost a long time:"+(k.now()-t)+" url="+e._loaders[e._startIndex-1].url),void i.timer.frameOnce(1,null,e.checkNext);e._loaders.length=0,e._startIndex=0,e._isWorking=!1},e.clearRes=function(t,i){void 0===i&&(i=!1),t=R.formatURL(t);var n=e.getAtlas(t);if(n){for(var r=0,a=n.length;r<a;r++){var s=n[r],o=e.getRes(s);delete e.loadedMap[s],o&&o.destroy(i)}n.length=0,delete e.atlasMap[t],delete e.loadedMap[t]}else{var l=e.loadedMap[t];l&&(delete e.loadedMap[t],l instanceof laya.resource.Texture&&l.bitmap&&l.destroy(i))}},e.clearTextureRes=function(t){t=R.formatURL(t);var e=laya.net.Loader.getAtlas(t),i=e&&e.length>0?laya.net.Loader.getRes(e[0]):laya.net.Loader.getRes(t);i&&i.bitmap&&(L.isConchApp?i.bitmap.source.releaseTexture&&i.bitmap.source.releaseTexture():null==i.bitmap._atlaser&&i.bitmap.releaseResource(!0))},e.getRes=function(t){return e.loadedMap[R.formatURL(t)]},e.getAtlas=function(t){return e.atlasMap[R.formatURL(t)]},e.cacheRes=function(t,i){t=R.formatURL(t),null!=e.loadedMap[t]?console.warn("Resources already exist,is repeated loading:",t):e.loadedMap[t]=i},e.setGroup=function(t,i){e.groupMap[i]||(e.groupMap[i]=[]),e.groupMap[i].push(t)},e.clearResByGroup=function(t){if(e.groupMap[t]){var i=e.groupMap[t],n=0,r=i.length;for(n=0;n<r;n++)e.clearRes(i[n]);i.length=0}},e.TEXT="text",e.JSON="json",e.XML="xml",e.BUFFER="arraybuffer",e.IMAGE="image",e.SOUND="sound",e.ATLAS="atlas",e.FONT="font",e.TTF="ttf",e.PLF="plf",e.PKM="pkm",e.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},e.parserMap={},e.groupMap={},e.maxTimeOut=100,e.loadedMap={},e.preLoadedMap={},e.atlasMap={},e._loaders=[],e._isWorking=!1,e._startIndex=0,e.imgCache={},e}(),ot=function(t){function e(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},e.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}var a;r(e,"laya.net.LoaderManager",l);var s=e.prototype;return s.create=function(t,e,i,n,r,a,s,o){if(void 0===a&&(a=1),void 0===s&&(s=!0),t instanceof Array){var l=t,c=l.length,u=0;if(i)var _=h.create(i.caller,i.method,i.args,!1);for(var d=0;d<c;d++){var f=l[d];"string"==typeof f&&(f=l[d]={url:f}),f.progress=0}for(d=0;d<c;d++){f=l[d];var p=i?h.create(null,function(t,e){t.progress=e;for(var i=0,n=0;n<c;n++)i+=l[n].progress;var r=i/c;_.runWith(r)},[f],!1):null,m=i||e?h.create(null,function(t,i){u++,t.progress=1,u===c&&e&&e.run()},[f]):null;this._create(f.url,m,p,f.clas||n,f.params||r,f.priority||a,s,f.group||o)}return!0}return this._create(t,e,i,n,r,a,s,o)},s._create=function(t,n,r,a,s,o,l,c){void 0===o&&(o=1),void 0===l&&(l=!0);var u=R.formatURL(t),_=this.getRes(u);if(_)!_.hasOwnProperty("loaded")||_.loaded?(r&&r.runWith(1),n&&n.run()):n&&i.loader._createListener(t,n.caller,n.method,n.args,!0,!1);else{var d=q.getFileExtension(t),f=e.createMap[d];if(!f)throw new Error("LoaderManager:unknown file("+t+") extension with: "+d+".");a||(a=f[0]);var p=f[1];"atlas"==d?this.load(t,n,r,p,o,l):(a===ht&&(p="htmlimage"),(_=a?new a:null).hasOwnProperty("_loaded")&&(_._loaded=!1),_._setUrl(t),c&&_._setGroup(c),this._createLoad(_,t,h.create(null,function(e){_&&!_.destroyed&&e&&_.onAsynLoaded.call(_,t,e,s),n&&n.run(),i.loader.event(t)}),r,p,o,!1,c,!0),l&&this.cacheRes(u,_))}return _},s.load=function(t,n,r,s,o,l,h,c){var u=this;if(void 0===o&&(o=1),void 0===l&&(l=!0),void 0===c&&(c=!1),t instanceof Array)return this._loadAssets(t,n,r,s,o,l,h);var _=st.getRes(t);if(null!=_)i.timer.frameOnce(1,null,function(){r&&r.runWith(1),n&&n.runWith(_),u._loaderCount||u.event("complete")});else{var d=e._resMap[t];d?(n&&d._createListener("complete",n.caller,n.method,n.args,!1,!1),r&&d._createListener("progress",r.caller,r.method,r.args,!1,!1)):((d=this._infoPool.length?this._infoPool.pop():new a).url=t,d.type=s,d.cache=l,d.group=h,d.ignoreCache=c,n&&d.on("complete",n.caller,n.method,n.args),r&&d.on("progress",r.caller,r.method,r.args),e._resMap[t]=d,o=o<this._maxPriority?o:this._maxPriority-1,this._resInfos[o].push(d),this._next())}return this},s._createLoad=function(t,n,r,s,o,l,h,c,u){var _=this;if(void 0===l&&(l=1),void 0===h&&(h=!0),void 0===u&&(u=!1),n instanceof Array)return this._loadAssets(n,r,s,o,l,h,c);var d=st.getRes(n);if(null!=d)i.timer.frameOnce(1,null,function(){s&&s.runWith(1),r&&r.runWith(d),_._loaderCount||_.event("complete")});else{var f=e._resMap[n];f?(r&&f._createListener("complete",r.caller,r.method,r.args,!1,!1),s&&f._createListener("progress",s.caller,s.method,s.args,!1,!1)):((f=this._infoPool.length?this._infoPool.pop():new a).url=n,f.clas=t,f.type=o,f.cache=h,f.group=c,f.ignoreCache=u,r&&f.on("complete",r.caller,r.method,r.args),s&&f.on("progress",s.caller,s.method,s.args),e._resMap[n]=f,l=l<this._maxPriority?l:this._maxPriority-1,this._resInfos[l].push(f),this._next())}return this},s._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++)for(var e=this._resInfos[t];e.length>0;){var i=e.shift();if(i)return this._doLoad(i)}this._loaderCount||this.event("complete")}},s._doLoad=function(t){function e(e){i.offAll(),i._data=null,i._customParse=!1,n._loaders.push(i),n._endLoad(t,e instanceof Array?[e]:e),n._loaderCount--,n._next()}this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new st;i.on("complete",null,e),i.on("progress",null,function(e){t.event("progress",e)}),i.on("error",null,function(t){e(null)});var n=this;i._class=t.clas,i.load(t.url,t.type,t.cache,t.group,t.ignoreCache)},s._endLoad=function(t,n){var r=t.url;if(null==n){var a=this._failRes[r]||0;if(a<this.retryNum)return console.warn("[warn]Retry to load:",r),this._failRes[r]=a+1,void i.timer.once(this.retryDelay,this,this._addReTry,[t],!1);console.warn("[error]Failed to load:",r),this.event("error",r)}this._failRes[r]&&(this._failRes[r]=0),delete e._resMap[r],t.event("complete",n),t.offAll(),this._infoPool.push(t)},s._addReTry=function(t){this._resInfos[this._maxPriority-1].push(t),this._next()},s.clearRes=function(t,e){void 0===e&&(e=!1),st.clearRes(t,e)},s.getRes=function(t){return st.getRes(t)},s.cacheRes=function(t,e){st.cacheRes(t,e)},s.clearTextureRes=function(t){st.clearTextureRes(t)},s.setGroup=function(t,e){st.setGroup(t,e)},s.clearResByGroup=function(t){st.clearResByGroup(t)},s.clearUnLoaded=function(){for(var t=0;t<this._maxPriority;t++){for(var i=this._resInfos[t],n=i.length-1;n>-1;n--){var r=i[n];r&&(r.offAll(),this._infoPool.push(r))}i.length=0}this._loaderCount=0,e._resMap={}},s.cancelLoadByUrls=function(t){if(t)for(var e=0,i=t.length;e<i;e++)this.cancelLoadByUrl(t[e])},s.cancelLoadByUrl=function(t){for(var i=0;i<this._maxPriority;i++)for(var n=this._resInfos[i],r=n.length-1;r>-1;r--){var a=n[r];a&&a.url===t&&(n[r]=null,a.offAll(),this._infoPool.push(a))}e._resMap[t]&&delete e._resMap[t]},s._loadAssets=function(t,e,i,n,r,a,s){void 0===r&&(r=1),void 0===a&&(a=!0);for(var o=t.length,l=0,c=0,u=[],_=!0,d=0;d<o;d++){var f=t[d];"string"==typeof f&&(f={url:f,type:n,size:1,priority:r}),f.size||(f.size=1),f.progress=0,c+=f.size,u.push(f);var p=i?h.create(null,function(t,e){if(null!=i){t.progress=e;for(var n=0,r=0;r<u.length;r++){var a=u[r];n+=a.size*a.progress}var s=n/c;i.runWith(s)}},[f],!1):null,m=e||i?h.create(null,function(t,i){l++,t.progress=1,i||(_=!1),l===o&&e&&e.runWith(_)},[f]):null;this.load(f.url,m,p,f.type,f.priority||1,a,f.group||s)}return this},e.cacheRes=function(t,e){st.cacheRes(t,e)},e._resMap={},n(e,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),e.__init$=function(){a=function(t){function e(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,e.__super.call(this)}return r(e,"",l),e}()},e}(),lt=(function(t){function e(t){e.__super.call(this),t||(t=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var i=0,n=0,r=0;r<20;r++)r%5!=4?this._mat[i++]=t[r]:this._alpha[n++]=t[r];this._action=s.createFilterAction(32),this._action.data=this}r(e,"laya.filters.ColorFilter",S);var n=e.prototype;i.imps(n,{"laya.filters.IFilter":!0}),n.callNative=function(t){t._$P.cf=this,t.conchModel&&t.conchModel.setFilterMatrix&&t.conchModel.setFilterMatrix(this._mat,this._alpha)},a(0,n,"type",function(){return 32}),a(0,n,"action",function(){return this._action})}(),function(t){function e(t,i,n){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===i&&(i=0),e.__super.call(this),this._byteClass=n||F,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,t&&i>0&&i<65535&&this.connect(t,i)}r(e,"laya.net.Socket",l);var i=e.prototype;i.connect=function(t,e){var i;i="https:"==k.window.location.protocol?"wss://"+t+":"+e:"ws://"+t+":"+e,this.connectByUrl(i)},i.connectByUrl=function(t){var e=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new k.window.WebSocket(t,this.protocols):this._socket=new k.window.WebSocket(t),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(t){e._onOpen(t)},this._socket.onmessage=function(t){e._onMessage(t)},this._socket.onclose=function(t){e._onClose(t)},this._socket.onerror=function(t){e._onError(t)}},i.cleanSocket=function(){try{this._socket.close()}catch(t){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},i.close=function(){if(null!=this._socket)try{this._socket.close()}catch(t){}},i._onOpen=function(t){this._connected=!0,this.event("open",t)},i._onMessage=function(t){if(t&&t.data){var e=t.data;if(this.disableInput&&e)this.event("message",e);else{this._input.length>0&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var i=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,e&&("string"==typeof e?this._input.writeUTFBytes(e):this._input.writeArrayBuffer(e),this._addInputPosition=this._input.pos,this._input.pos=i),this.event("message",e)}}},i._onClose=function(t){this._connected=!1,this.event("close",t)},i._onError=function(t){this.event("error",t)},i.send=function(t){this._socket.send(t)},i.flush=function(){if(this._output&&this._output.length>0){var t;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(e){t=e}this._output.endian=this.endian,this._output.clear(),t&&this.event("error",t)}},a(0,i,"input",function(){return this._input}),a(0,i,"output",function(){return this._output}),a(0,i,"connected",function(){return this._connected}),a(0,i,"endian",function(){return this._endian},function(t){this._endian=t,null!=this._input&&(this._input.endian=t),null!=this._output&&(this._output.endian=t)}),e.LITTLE_ENDIAN="littleEndian",e.BIG_ENDIAN="bigEndian"}(),function(t){function e(){this.worker=null,e.__super.call(this);var t=this;this.worker=new k.window.Worker(e.workerPath),this.worker.onmessage=function(e){t.workerMessage(e.data)}}r(e,"laya.net.WorkerLoader",l);var i=e.prototype;i.workerMessage=function(t){if(t)switch(t.type){case"Image":this.imageLoaded(t);break;case"Msg":this.event("image_msg",t.msg)}},i.imageLoaded=function(t){if(t&&t.buffer&&t.buffer.length<10)return e._enable=!1,this._myTrace("buffer lost when postmessage ,disable workerloader"),this.event(t.url,null),void this.event("image_err",t.url+"\n"+t.msg);if(!t.dataType)return this.event(t.url,null),void this.event("image_err",t.url+"\n"+t.msg);var i,n,r;switch(t.dataType){case"buffer":(r=(n=(i=new vt("2D")).source.getContext("2d")).createImageData(t.width,t.height)).data.set(t.buffer),i.size(r.width,r.height),n.putImageData(r,0,0),i.memorySize=0;break;case"imagedata":n=(i=new vt("2D")).source.getContext("2d"),r=t.imagedata,i.size(r.width,r.height),n.putImageData(r,0,0),r=t.imagedata,i.memorySize=0;break;case"imageBitmap":r=t.imageBitmap,L.isWebGL?i=r:(n=(i=new vt("2D")).source.getContext("2d"),i.size(r.width,r.height),n.drawImage(r,0,0),i.src=t.url)}L.isWebGL&&(i=new laya.webgl.resource.WebGLImage(i,t.url)),this.event(t.url,i)},i._myTrace=function(t){var e=arguments,i=[],n=0,r=e.length;for(n=0;n<r;n++)i.push(e[n]);this.event("image_msg",i.join(" "))},i.loadImage=function(t){var e;(e={}).type="load",e.url=t,this.worker.postMessage(e)},i._loadImage=function(t){var i=this;if(!e._enable||t.toLowerCase().indexOf(".png")<0)e._preLoadFun.call(i,t);else{t=R.formatURL(t);laya.net.WorkerLoader.I.on(t,i,function n(r){laya.net.WorkerLoader.I.off(t,i,n),r?i.onLoaded(r):e._preLoadFun.call(i,t)}),laya.net.WorkerLoader.I.loadImage(t)}},a(1,e,"enable",function(){return e._enable},function(t){e.disableJSDecode&&!k.window.createImageBitmap||(e._enable=t)&&null==e._preLoadFun&&(e._enable=e.__init__())}),e.__init__=function(){return null==e._preLoadFun&&!!k.window.Worker&&(e._preLoadFun=st.prototype._loadImage,st.prototype._loadImage=e.prototype._loadImage,e.I||(e.I=new e),!0)},e.workerSupported=function(){return!!k.window.Worker},e.IMAGE_LOADED="image_loaded",e.IMAGE_ERR="image_err",e.IMAGE_MSG="image_msg",e.I=null,e._preLoadFun=null,e._enable=!1,e.workerPath="libs/worker.js",e.disableJSDecode=!0}(),function(t){function e(){e.__super.call(this),this._$1__id=++e._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,e._idResourcesMap[this.id]=this,this._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,V.currentResourceManager&&V.currentResourceManager.addResource(this)}r(e,"laya.resource.Resource",l);var n=e.prototype;return i.imps(n,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),n._setUrl=function(t){var i;this._url!==t&&(this._url&&((i=e._urlResourcesMap[this._url]).splice(i.indexOf(this),1),0===i.length&&delete e._urlResourcesMap[this._url]),t&&((i=e._urlResourcesMap[t])||(e._urlResourcesMap[t]=i=[]),i.push(this)),this._url=t)},n._getGroup=function(){return this._group},n._setGroup=function(t){var i;this._group!==t&&(this._group&&((i=e._groupResourcesMap[this._group]).splice(i.indexOf(this),1),0===i.length&&delete e._groupResourcesMap[this._group]),t&&((i=e._groupResourcesMap[t])||(e._groupResourcesMap[t]=i=[]),i.push(this)),this._group=t)},n._addReference=function(){this._referenceCount++},n._removeReference=function(){this._referenceCount--},n._clearReference=function(){this._referenceCount=0},n._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},n.recreateResource=function(){this.completeCreate()},n.disposeResource=function(){},n.activeResource=function(t){void 0===t&&(t=!1),this._lastUseFrameCount=X.loopCount,!this._destroyed&&this.__loaded&&(this._released||t)&&this.recreateResource()},n.releaseResource=function(t){return void 0===t&&(t=!1),!(!t&&this.lock||this._released&&!t||(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),0))},n.onAsynLoaded=function(t,e,i){throw new Error("Resource: must override this function!")},n.destroy=function(){var t;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete e._idResourcesMap[this.id],this._url&&((t=e._urlResourcesMap[this._url])&&(t.splice(t.indexOf(this),1),0===t.length&&delete e._urlResourcesMap[this.url]),st.clearRes(this._url),this.__loaded||s.cancelLoadByUrl(this._url)),this._group&&((t=e._groupResourcesMap[this._group]).splice(t.indexOf(this),1),0===t.length&&delete e._groupResourcesMap[this.url]))},n.completeCreate=function(){this._released=!1,this.event("recovered",this)},n.dispose=function(){this.destroy()},a(0,n,"memorySize",function(){return this._memorySize},function(t){var e=t-this._memorySize;this._memorySize=t,this.resourceManager&&this.resourceManager.addSize(e)}),a(0,n,"_loaded",null,function(t){this.__loaded=t}),a(0,n,"loaded",function(){return this.__loaded}),a(0,n,"id",function(){return this._$1__id}),a(0,n,"destroyed",function(){return this._destroyed}),a(0,n,"group",function(){return this._getGroup()},function(t){this._setGroup(t)}),a(0,n,"resourceManager",function(){return this._resourceManager}),a(0,n,"url",function(){return this._url}),a(0,n,"released",function(){return this._released}),a(0,n,"referenceCount",function(){return this._referenceCount}),e.getResourceByID=function(t){return e._idResourcesMap[t]},e.getResourceByURL=function(t,i){return void 0===i&&(i=0),e._urlResourcesMap[t][i]},e.getResourceCountByURL=function(t){return e._urlResourcesMap[t].length},e.destroyUnusedResources=function(t){var i;if(t){var n=e._groupResourcesMap[t];if(n)for(var r=n.slice(),a=0,s=r.length;a<s;a++)(i=r[a]).lock||0!==i._referenceCount||i.destroy()}else for(var o in e._idResourcesMap)(i=e._idResourcesMap[o]).lock||0!==i._referenceCount||i.destroy()},e._uniqueIDCounter=0,e._idResourcesMap={},e._urlResourcesMap={},e._groupResourcesMap={},e}()),ht=function(e){function n(t,e){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,n.__super.call(this),t&&null!=t._addReference&&t._addReference(),this.setTo(t,e)}r(n,"laya.resource.Texture",l);var o=n.prototype;return o._setUrl=function(t){this.url=t},o.setTo=function(e,i){if(e instanceof t.HTMLElement){var r=vt.create("2D",e);this.bitmap=r}else this.bitmap=e;if(this.uv=i||n.DEF_UV,e){this._w=e.width,this._h=e.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=this._w>0;var a=this;if(this._loaded)s.addToAtlas&&s.addToAtlas(a);else{var o=e;o instanceof laya.resource.HTMLImage&&o.image&&o.image.addEventListener("load",function(t){s.addToAtlas&&s.addToAtlas(a)},!1)}}},o.active=function(){this.bitmap&&this.bitmap.activeResource()},o.destroy=function(t){if(void 0===t&&(t=!1),this.bitmap&&this.bitmap.referenceCount>0){var e=this.bitmap;t?(L.isConchApp&&e.source&&e.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,e.dispose(),e._clearReference()):(e._removeReference(),0==e.referenceCount&&(L.isConchApp&&e.source&&e.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,e.dispose())),this.url&&this===i.loader.getRes(this.url)&&i.loader.clearRes(this.url,t),this._loaded=!1}},o.load=function(t){var e=this;this._loaded=!1,t=R.customFormat(t);var i=this.bitmap||(this.bitmap=Et.create(t));i&&i._addReference();var n=this;i.onload=function(){i.onload=null,n._loaded=!0,e.sourceWidth=e._w=i.width,e.sourceHeight=e._h=i.height,n.event("loaded",this),s.addToAtlas&&s.addToAtlas(n)}},o.addTextureToAtlas=function(t){s.addTextureToAtlas(this)},o.getPixels=function(t,e,i,n){if(L.isConchApp){var r=this.bitmap;if(r.source&&r.source.getImageData){var a=r.source.getImageData(t,e,i,n),o=new Uint8Array(a);return Array.from(o)}return null}return L.isWebGL?s.getTexturePixels(this,t,e,i,n):(k.canvas.size(i,n),k.canvas.clear(),k.context.drawTexture(this,-t,-e,this.width,this.height,0,0),k.context.getImageData(0,0,i,n).data)},o.onAsynLoaded=function(t,e){e&&e._addReference(),this.setTo(e,this.uv)},a(0,o,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),a(0,o,"loaded",function(){return this._loaded}),a(0,o,"released",function(){return!this.bitmap||this.bitmap.released}),a(0,o,"width",function(){return this._w?this._w:this.uv&&this.uv!==n.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}),a(0,o,"repeat",function(){return!L.isWebGL||!this.bitmap||this.bitmap.repeat},function(t){t&&L.isWebGL&&this.bitmap&&(this.bitmap.repeat=t,t&&(this.bitmap.enableMerageInAtlas=!1))}),a(0,o,"height",function(){return this._h?this._h:this.uv&&this.uv!==n.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}),a(0,o,"isLinearSampling",function(){return!L.isWebGL||9728!=this.bitmap.minFifter},function(t){!t&&L.isWebGL&&(t||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),n.moveUV=function(t,e,i){for(var n=0;n<8;n+=2)i[n]+=t,i[n+1]+=e;return i},n.create=function(t,e,i,r,a,o,l,h,c){void 0===o&&(o=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===c&&(c=0);var u=t instanceof laya.resource.Texture,_=u?t.uv:n.DEF_UV,d=u?t.bitmap:t,f=s.isAtlas(d);if(f){var p=d._atlaser,m=t._atlasID;if(-1==m)throw new Error("create texture error");d=p._inAtlasTextureBitmapValue[m],_=p._inAtlasTextureOriUVValue[m]}var g=new n(d,null);d.width&&e+r>d.width&&(r=d.width-e),d.height&&i+a>d.height&&(a=d.height-i),g.width=r,g.height=a,g.offsetX=o,g.offsetY=l,g.sourceWidth=h||r,g.sourceHeight=c||a;var y=1/d.width,v=1/d.height;e*=y,i*=v,r*=y,a*=v;var S=g.uv[0],x=g.uv[1],E=g.uv[4],T=g.uv[5],w=E-S,C=T-x,b=n.moveUV(_[0],_[1],[e,i,e+r,i,e+r,i+a,e,i+a]);g.uv=[S+b[0]*w,x+b[1]*C,E-(1-b[2])*w,x+b[3]*C,E-(1-b[4])*w,T-(1-b[5])*C,S+b[6]*w,T-(1-b[7])*C],f&&g.addTextureToAtlas();var M=d.scaleRate;return M&&1!=M?(g.sourceWidth/=M,g.sourceHeight/=M,g.width/=M,g.height/=M,g.scaleRate=M,g.offsetX/=M,g.offsetY/=M):g.scaleRate=1,g},n.createFromTexture=function(t,e,i,r,a){var s=t.scaleRate;1!=s&&(e*=s,i*=s,r*=s,a*=s);var o=M.TEMP.setTo(e-t.offsetX,i-t.offsetY,r,a),l=o.intersection(n._rect1.setTo(0,0,t.width,t.height),n._rect2);if(!l)return null;var h=n.create(t,l.x,l.y,l.width,l.height,l.x-o.x,l.y-o.y,r,a);return h.bitmap._removeReference(),h},n.DEF_UV=[0,0,1,0,1,1,0,1],n.INV_UV=[0,1,1,1,1,0,0,0],n._rect1=new M,n._rect2=new M,n}(),ct=function(t){function e(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,e.__super.call(this)}var n;r(e,"laya.utils.TimeLine",l);var s=e.prototype;return s.to=function(t,e,i,n,r){return void 0===r&&(r=0),this._create(t,e,i,n,r,!0)},s.from=function(t,e,i,n,r){return void 0===r&&(r=0),this._create(t,e,i,n,r,!1)},s._create=function(t,e,i,r,a,s){var o=Y.getItemByClass("tweenData",n);return o.isTo=s,o.type=0,o.target=t,o.duration=i,o.data=e,o.startTime=this._startTime+a,o.endTime=o.startTime+o.duration,o.ease=r,this._startTime=Math.max(o.endTime,this._startTime),this._tweenDataList.push(o),this._startTimeSort=!0,this._endTimeSort=!0,this},s.addLabel=function(t,e){var i=Y.getItemByClass("tweenData",n);return i.type=1,i.data=t,i.endTime=i.startTime=this._startTime+e,this._labelDic||(this._labelDic={}),this._labelDic[t]=i,this._tweenDataList.push(i),this},s.removeLabel=function(t){if(this._labelDic&&this._labelDic[t]){var e=this._labelDic[t];if(e){var i=this._tweenDataList.indexOf(e);i>-1&&this._tweenDataList.splice(i,1)}delete this._labelDic[t]}},s.gotoTime=function(t){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var e,i,n;for(var r in this._firstTweenDic)if(i=this._firstTweenDic[r])for(var a in i)i.diyTarget.hasOwnProperty(a)&&(i.diyTarget[a]=i[a]);for(r in this._tweenDic)(e=this._tweenDic[r]).clear(),delete this._tweenDic[r];this._index=0,this._gidIndex=0,this._currTime=t,this._lastTime=k.now(),null==this._endTweenDataList||this._endTimeSort?(this._endTimeSort=!1,this._endTweenDataList=n=this._tweenDataList.concat(),n.sort(function(t,e){return t.endTime>e.endTime?1:t.endTime<e.endTime?-1:0})):n=this._endTweenDataList;for(var s,o=0,l=n.length;o<l;o++)if(0==(s=n[o]).type){if(!(t>=s.endTime))break;this._index=Math.max(this._index,o+1);var c=s.data;if(s.isTo)for(var u in c)s.target[u]=c[u]}for(o=0,l=this._tweenDataList.length;o<l;o++)0==(s=this._tweenDataList[o]).type&&t>=s.startTime&&t<s.endTime&&(this._index=Math.max(this._index,o+1),this._gidIndex++,(e=Y.getItemByClass("tween",K))._create(s.target,s.data,s.duration,s.ease,h.create(this,this._animComplete,[this._gidIndex]),0,!1,s.isTo,!0,!1),e.setStartTime(this._currTime-(t-s.startTime)),e._updateEase(this._currTime),e.gid=this._gidIndex,this._tweenDic[this._gidIndex]=e)}},s.gotoLabel=function(t){if(null!=this._labelDic){var e=this._labelDic[t];e&&this.gotoTime(e.startTime)}},s.pause=function(){i.timer.clear(this,this._update)},s.resume=function(){this.play(this._currTime,this._loopKey)},s.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(t,e){return t.startTime>e.startTime?1:t.startTime<e.startTime?-1:0});for(var n=0,r=this._tweenDataList.length;n<r;n++){var a=this._tweenDataList[n];if(null!=a&&0==a.type){var s=a.target,o=s.$_GID||(s.$_GID=q.getGID()),l=null;for(var h in null==this._firstTweenDic[o]?((l={}).diyTarget=s,this._firstTweenDic[o]=l):l=this._firstTweenDic[o],a.data)null==l[h]&&(l[h]=s[h])}}}"string"==typeof t?this.gotoLabel(t):this.gotoTime(t),this._loopKey=e,this._lastTime=k.now(),i.timer.frameLoop(1,this,this._update)}},s._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var t in this._tweenDic)(e=this._tweenDic[t]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var e,i=k.now(),n=i-this._lastTime,r=this._currTime+=n*this.scale;for(t in this._lastTime=i,this._tweenDic)(e=this._tweenDic[t])._updateEase(r);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var a=this._tweenDataList[this._index];r>=a.startTime&&(this._index++,0==a.type?(this._gidIndex++,(e=Y.getItemByClass("tween",K))._create(a.target,a.data,a.duration,a.ease,h.create(this,this._animComplete,[this._gidIndex]),0,!1,a.isTo,!0,!1),e.setStartTime(r),e.gid=this._gidIndex,this._tweenDic[this._gidIndex]=e,e._updateEase(r)):this.event("label",a.data))}},s._animComplete=function(t){this._tweenDic[t]&&delete this._tweenDic[t]},s._complete=function(){this.event("complete")},s.reset=function(){var t;if(this._labelDic)for(t in this._labelDic)delete this._labelDic[t];for(t in this._tweenDic)this._tweenDic[t].clear(),delete this._tweenDic[t];for(t in this._firstTweenDic)delete this._firstTweenDic[t];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var e,n=0;for(e=this._tweenDataList.length,n=0;n<e;n++)this._tweenDataList[n]&&this._tweenDataList[n].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,i.timer.clear(this,this._update)},s.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},a(0,s,"index",function(){return this._frameIndex},function(t){this._frameIndex=t,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),a(0,s,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),e.to=function(t,i,n,r,a){return void 0===a&&(a=0),(new e).to(t,i,n,r,a)},e.from=function(t,i,n,r,a){return void 0===a&&(a=0),(new e).from(t,i,n,r,a)},e.__init$=function(){n=function(){function t(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return r(t,""),t.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,Y.recover("tweenData",this)},t}()},e}(),ut=function(e){function o(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,o.__super.call(this),this._style=u.EMPTY}r(o,"laya.display.Sprite",e);var l=o.prototype;return i.imps(l,{"laya.display.ILayout":!0}),l.createConchModel=function(){return new ConchNode},l.destroy=function(t){void 0===t&&(t=!0),this._releaseMem(),e.prototype.destroy.call(this,t),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},l.updateZOrder=function(){q.updateOrder(this._childs)&&this.repaint()},l.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},l.setBounds=function(t){this._set$P("uBounds",t)},l.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new M),M._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},l.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new M),M._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},l._boundPointsToParent=function(t){void 0===t&&(t=!1);var e=0,i=0;this._style&&(e=this._style._tf.translateX,i=this._style._tf.translateY,t=t||0!==this._style._tf.rotate,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var n=this._getBoundPointsM(t);if(!n||n.length<1)return n;if(8!=n.length&&(n=t?T.scanPList(n):M._getWrapRec(n,M.TEMP)._getBoundPoints()),!this.transform)return q.transPointList(n,this._x-e,this._y-i),n;var r=b.TEMP,a=0,s=n.length;for(a=0;a<s;a+=2)r.x=n[a],r.y=n[a+1],this.toParentPoint(r),n[a]=r.x,n[a+1]=r.y;return n},l.getGraphicBounds=function(t){return void 0===t&&(t=!1),this._graphics?this._graphics.getBounds(t):M.TEMP.setTo(0,0,0,0)},l._getBoundPointsM=function(t){if(void 0===t&&(t=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var e=q.clearArray(this._$P.temBM),i=M.TEMP;return i.copyFrom(this.scrollRect),q.concatArray(e,i._getBoundPoints()),e}for(var n,r,a,s=this._graphics?this._graphics.getBoundPoints():q.clearArray(this._$P.temBM),o=0,l=(a=this._childs).length;o<l;o++)(n=a[o])instanceof laya.display.Sprite&&1==n.visible&&(r=n._boundPointsToParent(t))&&(s=s?q.concatArray(s,r):r);return s},l.getStyle=function(){return this._style===u.EMPTY&&(this._style=new u),this._style},l.setStyle=function(t){this._style=t},l._adjustTransform=function(){this._tfChanged=!1;var t,e=this._style._tf,i=e.scaleX,n=e.scaleY;if(e.rotate||1!==i||1!==n||e.skewX||e.skewY){(t=this._transform||(this._transform=C.create())).bTransform=!0;var r=.0174532922222222*(e.rotate-e.skewX),a=.0174532922222222*(e.rotate+e.skewY),s=Math.cos(a),o=Math.sin(a),l=Math.sin(r),h=Math.cos(r);return t.a=i*s,t.b=i*o,t.c=-n*l,t.d=n*h,t.tx=t.ty=0,t}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,t},l.pos=function(t,e,i){if(void 0===i&&(i=!1),this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._x=t,this._y=e,this.conchModel&&this.conchModel.pos(this._x,this._y);var n=this._parent;n&&0===n._repaint&&(n._repaint=1,n.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=t,this.y=e}return this},l.pivot=function(t,e){return this.pivotX=t,this.pivotY=e,this},l.size=function(t,e){return this.width=t,this.height=e,this},l.scale=function(t,e,i){void 0===i&&(i=!1);var n=this.getStyle(),r=n._tf;if(r.scaleX!=t||r.scaleY!=e){if(this.destroyed)return this;if(i){n.setScale(t,e),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e),this._renderType|=4;var a=this._parent;a&&0===a._repaint&&(a._repaint=1,a.parentRepaint())}else this.scaleX=t,this.scaleY=e}return this},l.skew=function(t,e){return this.skewX=t,this.skewY=e,this},l.render=function(t,e,i){X.spriteCount++,N.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},l.drawToCanvas=function(t,e,i,n){if(L.isConchNode){var r=vt.create("2D");return new P(t,e,r).ctx.setCanvasType(1),this.conchModel.drawToCanvas(r.source,i,n),r}return s.drawToCanvas(this,this._renderType,t,e,i,n)},l.customRender=function(t,e,i){this._renderType|=1024},l._applyFilters=function(){var t;if(!L.isWebGL&&((t=this._$P.filters)&&!(t.length<1)))for(var e=0,i=t.length;e<i;e++)t[e].action.apply(this._$P.cacheCanvas)},l._isHaveGlowFilter=function(){var t,e=0;if(this.filters)for(e=0;e<this.filters.length;e++)if(8==this.filters[e].type)return!0;for(e=0,t=this._childs.length;e<t;e++)if(this._childs[e]._isHaveGlowFilter())return!0;return!1},l.localToGlobal=function(t,e){void 0===e&&(e=!1),!0===e&&(t=new b(t.x,t.y));for(var n=this;n&&n!=i.stage;)t=n.toParentPoint(t),n=n.parent;return t},l.globalToLocal=function(t,e){void 0===e&&(e=!1),e&&(t=new b(t.x,t.y));for(var n=this,r=[];n&&n!=i.stage;)r.push(n),n=n.parent;for(var a=r.length-1;a>=0;)t=(n=r[a]).fromParentPoint(t),a--;return t},l.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t},l.fromParentPoint=function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t},l.on=function(t,i,n,r){return 1!==this._mouseEnableState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,i,n,r,!1)):e.prototype.on.call(this,t,i,n,r)},l.once=function(t,i,n,r){return 1!==this._mouseEnableState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,i,n,r,!0)):e.prototype.once.call(this,t,i,n,r)},l._$2__onDisplay=function(){if(1!==this._mouseEnableState){var t=this;for(t=t.parent;t&&1!==t._mouseEnableState&&!t._getBit(2);)t.mouseEnabled=!0,t._setBit(2,!0),t=t.parent}},l.loadImage=function(t,e,i,n,r,a){var s=this;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.graphics.loadImage(t,e,i,n,r,function(t){s.destroyed||(s.size(e+(n||t.width),i+(r||t.height)),s.repaint(),a&&a.runWith(t))}),this},l.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},l._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},l._childChanged=function(t){this._childs.length?this._renderType|=2048:this._renderType&=-2049,t&&this._get$P("hasZorder")&&i.timer.callLater(this,this.updateZOrder),this.repaint()},l.parentRepaint=function(){var t=this._parent;t&&0===t._repaint&&(t._repaint=1,t.parentRepaint())},l.startDrag=function(t,e,i,n,r,a,s){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=300),void 0===a&&(a=!1),void 0===s&&(s=.92),this._$P.dragging||this._set$P("dragging",new G),this._$P.dragging.start(this,t,e,i,n,r,a,s)},l.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},l._releaseMem=function(){if(this._$P){var t=this._$P.cacheCanvas;t&&t.ctx&&(Y.recover("RenderContext",t.ctx),t.ctx.canvas.size(0,0),t.ctx=null);var e=this._$P._filterCache;e&&(e.destroy(),e.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},l._setDisplay=function(t){t||this._releaseMem(),e.prototype._setDisplay.call(this,t)},l.hitTestPoint=function(t,e){var i=this.globalToLocal(b.TEMP.setTo(t,e));return t=i.x,e=i.y,(this._$P.hitArea?this._$P.hitArea:this._width>0&&this._height>0?M.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(t,e)},l.getMousePoint=function(){return this.globalToLocal(b.TEMP.setTo(i.stage.mouseX,i.stage.mouseY))},l._getWords=function(){return null},l._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;if(e)for(var i=0,n=e.length;i<n;i++)t.push(e[i]);return this._childs.forEach(function(e,i,n){e._style._enableLayout()&&e._addToLayout(t)}),!0},l._addToLayout=function(t){this._style.absolute||(this._style.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))},l._isChar=function(){return!1},l._getCSSStyle=function(){return this._style.getCSSStyle()},l._setAttributes=function(t,e){switch(t){case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}},l._layoutLater=function(){this.parent&&this.parent._layoutLater()},a(0,l,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(t){this._optimizeScrollRect!=t&&(this._optimizeScrollRect=t,this.conchModel&&this.conchModel.optimizeScrollRect(t))}),a(0,l,"customRenderEnable",null,function(t){if(t&&(this._renderType|=1024,L.isConchNode)){o.CustomList.push(this);var e=new vt("2d");e._setContext(new CanvasRenderingContext2D),this.customContext=new P(0,0,e),e.context.setCanvasType&&e.context.setCanvasType(2),this.conchModel.custom(e.context)}}),a(0,l,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(t){this.cacheAs=t?this._$P.hasFilter?"none":"normal":"none"}),a(0,l,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(t){var e=this._$P.cacheCanvas;if(t!==(e?e.type:"none")){if("none"!==t)this._getBit(1)||this._setUpNoticeType(1),e||(e=this._set$P("cacheCanvas",Y.getItemByClass("cacheCanvas",Object))),e.type=t,e.reCache=!0,this._renderType|=16,"bitmap"==t&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(e){var i=e;i&&i.ctx&&(Y.recover("RenderContext",i.ctx),i.ctx.canvas.size(0,0),i.ctx=null),Y.recover("cacheCanvas",e)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),a(0,l,"zOrder",function(){return this._zOrder},function(t){this._zOrder!=t&&(this._zOrder=t,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(t),this._parent&&(t&&this._parent._set$P("hasZorder",!0),i.timer.callLater(this._parent,this.updateZOrder)))}),a(0,l,"rotation",function(){return this._style._tf.rotate},function(t){var e=this.getStyle();if(e._tf.rotate!==t){e.setRotate(t),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),a(0,l,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(t){this._width!==t&&(this._width=t,this.conchModel&&this.conchModel.size(t,this._height),this.repaint())}),a(0,l,"x",function(){return this._x},function(t){if(this._x!==t){if(this.destroyed)return;this._x=t,this.conchModel&&this.conchModel.pos(t,this._y);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),a(0,l,"globalScaleY",function(){for(var t=1,e=this;e&&e!==i.stage;)t*=e.scaleY,e=e.parent;return t}),a(0,l,"hitArea",function(){return this._$P.hitArea},function(t){this._set$P("hitArea",t)}),a(0,l,"staticCache",function(){return this._$P.staticCache},function(t){this._set$P("staticCache",t),t||this.reCache()}),a(0,l,"texture",function(){return this._texture},function(t){this._texture!=t&&(this._texture=t,this.graphics.cleanByTexture(t,0,0))}),a(0,l,"y",function(){return this._y},function(t){if(this._y!==t){if(this.destroyed)return;this._y=t,this.conchModel&&this.conchModel.pos(this._x,t);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),a(0,l,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(t){this._height!==t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,t),this.repaint())}),a(0,l,"blendMode",function(){return this._style.blendMode},function(t){this.getStyle().blendMode=t,this.conchModel&&this.conchModel.blendMode(t),t&&"source-over"!=t?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),a(0,l,"scaleX",function(){return this._style._tf.scaleX},function(t){var e=this.getStyle();if(e._tf.scaleX!==t){e.setScaleX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e._tf.scaleY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),a(0,l,"scaleY",function(){return this._style._tf.scaleY},function(t){var e=this.getStyle();if(e._tf.scaleY!==t){e.setScaleY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(e._tf.scaleX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),a(0,l,"stage",function(){return i.stage}),a(0,l,"skewX",function(){return this._style._tf.skewX},function(t){var e=this.getStyle();if(e._tf.skewX!==t){e.setSkewX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(t,e._tf.skewY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),a(0,l,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t,this.repaint(),t?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(t.x,t.y,t.width,t.height)):(this._renderType&=-129,this.conchModel&&(o.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),a(0,l,"skewY",function(){return this._style._tf.skewY},function(t){var e=this.getStyle();if(e._tf.skewY!==t){e.setSkewY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(e._tf.skewX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),a(0,l,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=!1,this._transform=t,t&&(this._x=t.tx,this._y=t.ty,t.tx=t.ty=0,this.conchModel&&this.conchModel.transform(t.a,t.b,t.c,t.d,this._x,this._y)),t?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),a(0,l,"pivotX",function(){return this._style._tf.translateX},function(t){this.getStyle().setTranslateX(t),this.conchModel&&this.conchModel.pivot(t,this._style._tf.translateY),this.repaint()}),a(0,l,"pivotY",function(){return this._style._tf.translateY},function(t){this.getStyle().setTranslateY(t),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,t),this.repaint()}),a(0,l,"alpha",function(){return this._style.alpha},function(t){this._style&&this._style.alpha!==t&&(t=t<0?0:t>1?1:t,this.getStyle().alpha=t,this.conchModel&&this.conchModel.alpha(t),1!==t?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),a(0,l,"visible",function(){return this._style.visible},function(t){this._style&&this._style.visible!==t&&(this.getStyle().visible=t,this.conchModel&&this.conchModel.visible(t),this.parentRepaint())}),a(0,l,"graphics",function(){return this._graphics||(this.graphics=s.createGraphics())},function(t){this._graphics&&(this._graphics._sp=null),this._graphics=t,t?(this._renderType&=-2,this._renderType|=512,t._sp=this,this.conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(o.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),a(0,l,"filters",function(){return this._$P.filters},function(t){t&&0===t.length&&(t=null),this._$P.filters!=t&&(this._set$P("filters",t?t.slice():null),L.isConchApp&&(this.conchModel&&(o.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),L.isWebGL&&(t&&t.length?this._renderType|=32:this._renderType&=-33),t&&t.length>0?(this._getBit(1)||this._setUpNoticeType(1),L.isWebGL&&1==t.length&&t[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(L.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),a(0,l,"parent",e.prototype._$get_parent,function(t){i.superSet(J,this,"parent",t),t&&this._getBit(2)&&this._$2__onDisplay()}),a(0,l,"mask",function(){return this._$P._mask},function(t){t&&this.mask&&this.mask._$P.maskParent||(t?(this.cacheAs="bitmap",this._set$P("_mask",t),t._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",t),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(t?t.conchModel:null),this._renderType|=64,this.parentRepaint())}),a(0,l,"mouseEnabled",function(){return this._mouseEnableState>1},function(t){this._mouseEnableState=t?2:1}),a(0,l,"globalScaleX",function(){for(var t=1,e=this;e&&e!==i.stage;)t*=e.scaleX,e=e.parent;return t}),a(0,l,"mouseX",function(){return this.getMousePoint().x}),a(0,l,"mouseY",function(){return this.getMousePoint().y}),o.fromImage=function(t){return(new o).loadImage(t)},o.CustomList=[],n(o,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=t.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),o}(J),_t=function(t){function e(t){this._audio=null,this._onEnd=null,this._resumePlay=null,e.__super.call(this),this._onEnd=q.bind(this.__onEnd,this),this._resumePlay=q.bind(this.__resumePlay,this),t.addEventListener("ended",this._onEnd),this._audio=t}r(e,"laya.media.h5audio.AudioSoundChannel",it);var n=e.prototype;return n.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(i.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},n.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,k.container.appendChild(this._audio),this._audio.play()}catch(t){this.event("error")}},n.play=function(){this.isStopped=!1;try{this._audio.playbackRate=I.playbackRate,this._audio.currentTime=this.startTime}catch(t){return void this._audio.addEventListener("canplay",this._resumePlay)}I.addChannel(this),k.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()},n.stop=function(){this.isStopped=!0,I.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&L.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),k.onIE||this._audio!=et._musicAudio&&Y.recover("audio:"+this.url,this._audio),k.removeElement(this._audio),this._audio=null)},n.pause=function(){this.isStopped=!0,I.removeChannel(this),"pause"in this._audio&&this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,I.addChannel(this),"play"in this._audio&&this._audio.play())},a(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,n,"duration",function(){return this._audio?this._audio.duration:0}),a(0,n,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),e}(),dt=function(t){function e(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=rt.ctx,e.__super.call(this),this._onPlayEnd=q.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}r(e,"laya.media.webaudio.WebAudioSoundChannel",it);var n=e.prototype;return n.play=function(){if(I.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var t=this.context,e=this.gain,i=t.createBufferSource();this.bufferSource=i,i.buffer=this.audioBuffer,i.connect(e),e&&e.disconnect(),e.connect(t.destination),i.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=k.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.playbackRate.setTargetAtTime?i.playbackRate.setTargetAtTime(I.playbackRate,this.context.currentTime,.1):i.playbackRate.value=I.playbackRate,i.start(0,this.startTime),this._currentTime=0}},n.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(i.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},n._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null,e._tryCleanFailed||this._tryClearBuffer(t),this.bufferSource=null}},n._tryClearBuffer=function(t){if(k.onMac)try{t.buffer=rt._miniBuffer}catch(t){e._tryCleanFailed=!0}else try{t.buffer=null}catch(t){e._tryCleanFailed=!0}},n.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,I.removeChannel(this),this.completeHandler=null,I.autoReleaseSound&&i.timer.once(5e3,null,I.disposeSoundIfNotUsed,[this.url],!1)},n.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,I.removeChannel(this),I.autoReleaseSound&&i.timer.once(5e3,null,I.disposeSoundIfNotUsed,[this.url],!1)},n.resume=function(){this.startTime=this._pauseTime,this.play()},a(0,n,"position",function(){return this.bufferSource?(k.now()-this._startTime)/1e3+this.startTime:0}),a(0,n,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),a(0,n,"volume",function(){return this._volume},function(t){this.isStopped||(this._volume=t,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(t,this.context.currentTime,.1):this.gain.gain.value=t)}),e._tryCleanFailed=!1,e}(),ft=function(t){function e(){e.__super.call(this),this._w=0,this._h=0}r(e,"laya.resource.Bitmap",lt);var i=e.prototype;return a(0,i,"width",function(){return this._w}),a(0,i,"height",function(){return this._h}),a(0,i,"source",function(){return this._source}),e}(),pt=function(t){function e(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,e.__super.call(this),this._interval=o.animationInterval,this._setUpNoticeType(1)}r(e,"laya.display.AnimationPlayerBase",t);var i=e.prototype;return i.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,this.interval>0&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},i._getFrameByLabel=function(t){var e=0;for(e=0;e<this._count;e++)if(this._labels[e]&&this._labels[e].indexOf(t)>=0)return e;return 0},i._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=this._count>0?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=this._count-2>=0?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},i._setControlNode=function(t){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),this._controlNode=t,t&&t!=this&&(t.on("display",this,this._checkResumePlaying),t.on("undisplay",this,this._checkResumePlaying))},i._setDisplay=function(e){t.prototype._setDisplay.call(this,e),this._checkResumePlaying()},i._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},i.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},i.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]||(this._labels[e]=[]),this._labels[e].push(t)},i.removeLabel=function(t){if(t){if(this._labels)for(var e in this._labels)this._removeLabelFromLabelList(this._labels[e],t)}else this._labels=null},i._removeLabelFromLabelList=function(t,e){if(t)for(var i=t.length-1;i>=0;i--)t[i]==e&&t.splice(i,1)},i.gotoAndStop=function(t){this.index="string"==typeof t?this._getFrameByLabel(t):t,this.stop()},i._displayToIndex=function(t){},i.clear=function(){this.stop(),this._labels=null},a(0,i,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._frameRateChanged=!0,this._interval=t,this._isPlaying&&t>0&&this.timerLoop(t,this,this._frameLoop,null,!0,!0))}),a(0,i,"isPlaying",function(){return this._isPlaying}),a(0,i,"index",function(){return this._index},function(t){if(this._index=t,this._displayToIndex(t),this._labels&&this._labels[t])for(var e=this._labels[t],i=0,n=e.length;i<n;i++)this.event("label",e[i])}),a(0,i,"count",function(){return this._count}),e.WRAP_POSITIVE=0,e.WRAP_REVERSE=1,e.WRAP_PINGPONG=2,e}(ut),mt=function(t){function e(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,e.__super.call(this),this.overflow=e.VISIBLE,this._style=new tt(this),this._style.wordWrap=!1}r(e,"laya.display.Text",t);var s=e.prototype;return s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._lines=null,this._words&&(this._words.length=0,this._words=null)},s._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=M.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()},s.getGraphicBounds=function(t){void 0===t&&(t=!1);var e=M.TEMP;return e.setTo(0,0,this.width,this.height),e},s._getCSSStyle=function(){return this._style},s.lang=function(t,i,n,r,a,s,o,l,h,c,u){if(t=e.langPacks&&e.langPacks[t]?e.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var _=0,d=arguments.length;_<d;_++)t=t.replace("{"+_+"}",arguments[_+1]);this._text=t}},s._isPassWordMode=function(){var t=this._style.password;return"prompt"in this&&this.prompt==this._text&&(t=!1),t},s._getPassWordTxt=function(t){var e;e="";for(var i=t.length;i>0;i--)e+="●";return e},s.renderText=function(t,e){var i=this.graphics;i.clear(!0);var n=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(k.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);k.context.font=n;var r=this.padding,a=r[3],s="left",o=this._lines,l=this.leading+this._charSize.height,h=this._currBitmapFont;h&&(l=this.leading+h.getMaxHeight());var c=r[0];if(!h&&this._width>0&&this._textWidth<=this._width&&("right"==this.align?(s="right",a=this._width-r[1]):"center"==this.align&&(s="center",a=.5*this._width+r[3]-r[1])),this._height>0){var u=this._textHeight>this._height?"top":this.valign;"middle"===u?c=.5*(this._height-e*l)+r[0]-r[2]:"bottom"===u&&(c=this._height-e*l-r[2])}var _=this._style;if(h&&h.autoScaleSize)var d=h.fontSize/this.fontSize;if(this._clipPoint)if(i.save(),h&&h.autoScaleSize){var f=0,p=0;f=this._width?this._width-r[3]-r[1]:this._textWidth,p=this._height?this._height-r[0]-r[2]:this._textHeight,f*=d,p*=d,i.clipRect(r[3],r[0],f,p)}else i.clipRect(r[3],r[0],this._width?this._width-r[3]-r[1]:this._textWidth,this._height?this._height-r[0]-r[2]:this._textHeight);var m=_.password;"prompt"in this&&this.prompt==this._text&&(m=!1);for(var g=0,y=0,v=Math.min(this._lines.length,e+t)||1,S=t;S<v;S++){var x,E=o[S];if(m){var T=E.length;E="";for(var w=T;w>0;w--)E+="●"}if(g=a-(this._clipPoint?this._clipPoint.x:0),y=c+l*S-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(s,g,y,S),h){var C=this.width;h.autoScaleSize&&(C=this.width*d),h.drawText(E,this,g,y,this.align,C)}else L.isWebGL?(this._words||(this._words=[]),(x=this._words.length>S-t?this._words[S-t]:new $).setText(E)):x=E,_.stroke?i.fillBorderText(x,g,y,n,this.color,_.strokeColor,_.stroke,s):i.fillText(x,g,y,n,this.color,s)}if(h&&h.autoScaleSize){var b=1/d;this.scale(b,b)}this._clipPoint&&i.restore(),this._startX=a,this._startY=c},s.drawUnderline=function(t,e,i,n){var r=this._lineWidths[n];switch(t){case"center":e-=r/2;break;case"right":e-=r}i+=this._charSize.height,this._graphics.drawLine(e,i,e+r,i,this.underlineColor||this.color,1)},s.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);k.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new b(0,0)):this._clipPoint=null;var t=this._lines.length;if(this.overflow!=e.VISIBLE){var i=this.overflow==e.HIDDEN?Math.floor:Math.ceil;t=Math.min(t,i((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var n=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(n,t),this.repaint()},s.evalTextSize=function(){var t,e;t=Math.max.apply(this,this._lineWidths),e=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],t==this._textWidth&&e==this._textHeight||(this._textWidth=t,this._textHeight=e,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},s.checkEnabledViewportOrNot=function(){return this.overflow==e.SCROLL&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)},s.changeText=function(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},s.parseLines=function(t){var i=this.wordWrap||this.overflow==e.HIDDEN;if(i)var n=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var r=k.context.measureText(e._testWord);this._charSize.width=r.width,this._charSize.height=r.height||this.fontSize}for(var a=t.replace(/\r\n/g,"\n").split("\n"),s=0,o=a.length;s<o;s++){var l=a[s];i?this.parseLine(l,n):(this._lineWidths.push(this.getTextWidth(l)),this._lines.push(l))}},s.parseLine=function(t,i){k.context;var n,r=this._lines,a=0,s=NaN,o=NaN,l=0;if((s=this.getTextWidth(t))<=i)return r.push(t),void this._lineWidths.push(s);s=this._charSize.width,0==(a=Math.floor(i/s))&&(a=1),o=s=this.getTextWidth(t.substring(0,a));for(var h=a,c=t.length;h<c;h++)if((o+=s=this.getTextWidth(t.charAt(h)))>i)if(this.wordWrap){var u=t.substring(l,h);if(u.charCodeAt(u.length-1)<255?(n=/(?:\w|-)+$/.exec(u))&&(h=n.index+l,0==n.index?h+=u.length:u=t.substring(l,h)):e.RightToLeft&&(n=/([\u0600-\u06FF])+$/.exec(u))&&(h=n.index+l,0==n.index?h+=u.length:u=t.substring(l,h)),r.push(u),this._lineWidths.push(o-s),l=h,!(h+a<c)){r.push(t.substring(l,c)),this._lineWidths.push(this.getTextWidth(r[r.length-1])),l=-1;break}h+=a,o=s=this.getTextWidth(t.substring(l,h)),h--}else if(this.overflow==e.HIDDEN)return r.push(t.substring(0,h)),void this._lineWidths.push(this.getTextWidth(r[r.length-1]));this.wordWrap&&-1!=l&&(r.push(t.substring(l,c)),this._lineWidths.push(this.getTextWidth(r[r.length-1])))},s.getTextWidth=function(t){return this._currBitmapFont?this._currBitmapFont.getTextWidth(t):k.context.measureText(t).width},s.getWordWrapWidth=function(){var t=this.padding,e=NaN;return(e=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(e=this.wordWrap?100:k.width),e<=0&&(e=100),e-t[3]-t[1]},s.getCharPoint=function(t,e){this._isChanged&&i.timer.runCallLater(this,this.typeset);for(var n=0,r=this._lines,a=0,s=0,o=r.length;s<o;s++){if(t<(n+=r[s].length)){var l=s;break}a=n}var h=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;k.context.font=h;var c=this.getTextWidth(this._text.substring(a,t));return(e||new b).setTo(this._startX+c-(this._clipPoint?this._clipPoint.x:0),this._startY+l*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},a(0,s,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(t){t!=this._width&&(i.superSet(ut,this,"width",t),this.isChanged=!0)}),a(0,s,"textWidth",function(){return this._isChanged&&i.timer.runCallLater(this,this.typeset),this._textWidth}),a(0,s,"height",function(){return this._height?this._height:this.textHeight+this.padding[0]+this.padding[2]},function(t){t!=this._height&&(i.superSet(ut,this,"height",t),this.isChanged=!0)}),a(0,s,"textHeight",function(){return this._isChanged&&i.timer.runCallLater(this,this.typeset),this._textHeight}),a(0,s,"padding",function(){return this._getCSSStyle().padding},function(t){this._getCSSStyle().padding=t,this.isChanged=!0}),a(0,s,"bold",function(){return this._getCSSStyle().bold},function(t){this._getCSSStyle().bold=t,this.isChanged=!0}),a(0,s,"text",function(){return this._text||""},function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event("change"))}),a(0,s,"color",function(){return this._getCSSStyle().color},function(t){this._getCSSStyle().color!=t&&(this._getCSSStyle().color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),a(0,s,"font",function(){return this._getCSSStyle().fontFamily},function(t){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),e._bitmapFonts&&e._bitmapFonts[t]&&(this._currBitmapFont=e._bitmapFonts[t]),this._getCSSStyle().fontFamily=t,this.isChanged=!0}),a(0,s,"fontSize",function(){return this._getCSSStyle().fontSize},function(t){this._getCSSStyle().fontSize=t,this.isChanged=!0}),a(0,s,"italic",function(){return this._getCSSStyle().italic},function(t){this._getCSSStyle().italic=t,this.isChanged=!0}),a(0,s,"align",function(){return this._getCSSStyle().align},function(t){this._getCSSStyle().align=t,this.isChanged=!0}),a(0,s,"valign",function(){return this._getCSSStyle().valign},function(t){this._getCSSStyle().valign=t,this.isChanged=!0}),a(0,s,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(t){this._getCSSStyle().wordWrap=t,this.isChanged=!0}),a(0,s,"leading",function(){return this._getCSSStyle().leading},function(t){this._getCSSStyle().leading=t,this.isChanged=!0}),a(0,s,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(t){this._getCSSStyle().backgroundColor=t,this.isChanged=!0}),a(0,s,"borderColor",function(){return this._getCSSStyle().borderColor},function(t){this._getCSSStyle().borderColor=t,this.isChanged=!0}),a(0,s,"stroke",function(){return this._getCSSStyle().stroke},function(t){this._getCSSStyle().stroke=t,this.isChanged=!0}),a(0,s,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(t){this._getCSSStyle().strokeColor=t,this.isChanged=!0}),a(0,s,"isChanged",null,function(t){this._isChanged!==t&&(this._isChanged=t,t&&i.timer.callLater(this,this.typeset))}),a(0,s,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(t){if(!(this.overflow!=e.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var i=this._textWidth-this._width;t=t>i?i:t;var n=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=t,this.renderText(this._lastVisibleLineIndex,n)}}),a(0,s,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(t){if(!(this.overflow!=e.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var i=this._textHeight-this._height,n=(t=t>i?i:t)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=n;var r=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=t,this.renderText(n,r)}}),a(0,s,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),a(0,s,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),a(0,s,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),a(0,s,"underlineColor",function(){return this._underlineColor},function(t){this._underlineColor=t,this._isChanged=!0,this.typeset()}),e.registerBitmapFont=function(t,i){e._bitmapFonts||(e._bitmapFonts={}),e._bitmapFonts[t]=i},e.unregisterBitmapFont=function(t,i){if(void 0===i&&(i=!0),e._bitmapFonts&&e._bitmapFonts[t]){var n=e._bitmapFonts[t];i&&n.destroy(),delete e._bitmapFonts[t]}},e.setTextRightToLeft=function(){var t;(t=k.canvas.source.style).display="none",t.position="absolute",t.direction="rtl",L._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,k.document.body.appendChild(k.canvas.source)},e.supportFont=function(t){k.context.font="10px sans-serif";var e=k.context.measureText("abcji").width;k.context.font="10px "+t;var i=k.context.measureText("abcji").width;return console.log(e,i),e!==i},e._testWord="游",e.langPacks=null,e.VISIBLE="visible",e.SCROLL="scroll",e.HIDDEN="hidden",e.CharacterCache=!0,e.RightToLeft=!1,e._bitmapFonts=null,n(e,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),e}(ut),gt=function(t){function e(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",e.__super.call(this),this.offset=new b,this._canvasTransform=new C,this._previousOrientation=k.window.orientation;var t=this;this.transform=C.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var i=k.window,n=this;i.addEventListener("focus",function(){t._isFocused=!0,n.event("focus"),n.event("focuschange")}),i.addEventListener("blur",function(){t._isFocused=!1,n.event("blur"),n.event("focuschange"),n._isInputting()&&(xt.inputElement.target.focus=!1)});var r="visibilityState",a="visibilitychange",s=i.document;void 0!==s.hidden?(a="visibilitychange",r="visibilityState"):void 0!==s.mozHidden?(a="mozvisibilitychange",r="mozVisibilityState"):void 0!==s.msHidden?(a="msvisibilitychange",r="msVisibilityState"):void 0!==s.webkitHidden&&(a="webkitvisibilitychange",r="webkitVisibilityState"),i.document.addEventListener(a,function(){"hidden"==k.document[r]?n._setStageVisible(!1):n._setStageVisible(!0)}),i.document.addEventListener("qbrowserVisibilityChange",function(t){n._setStageVisible(!t.hidden)}),i.addEventListener("resize",function(){var e=k.window.orientation;null!=e&&e!=t._previousOrientation&&n._isInputting()&&(xt.inputElement.target.focus=!1),t._previousOrientation=e,n._isInputting()||n._resetCanvas()}),i.addEventListener("orientationchange",function(t){n._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),k.onMobile&&this.on("mousedown",this,this._onmouseMove)}r(e,"laya.display.Stage",t);var o=e.prototype;return o._setStageVisible=function(t){this._isVisibility!=t&&(this._isVisibility=t,this._isVisibility||this._isInputting()&&(xt.inputElement.target.focus=!1),this.event("visibilitychange"))},o._isInputting=function(){return k.onMobile&&xt.isInputting},o._changeCanvasSize=function(){this.setScreenSize(k.clientWidth*k.pixelRatio,k.clientHeight*k.pixelRatio)},o._resetCanvas=function(){if(this.screenAdaptationEnabled){var t=L._mainCanvas;t.source.style,t.size(1,1),i.timer.once(100,this,this._changeCanvasSize)}},o.setScreenSize=function(t,e){var i=!1;if("none"!==this._screenMode&&(i=(t/e<1?"vertical":"horizontal")!==this._screenMode)){var n=e;e=t,t=n}this.canvasRotation=i;var r=L._mainCanvas,a=r.source.style,o=this._canvasTransform.identity(),l=this._scaleMode,h=t/this.designWidth,c=e/this.designHeight,u=this.designWidth,_=this.designHeight,d=t,f=e,p=k.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,l){case"noscale":h=c=1,d=this.designWidth,f=this.designHeight;break;case"showall":h=c=Math.min(h,c),u=d=Math.round(this.designWidth*h),_=f=Math.round(this.designHeight*c);break;case"noborder":h=c=Math.max(h,c),d=Math.round(this.designWidth*h),f=Math.round(this.designHeight*c);break;case"full":h=c=1,this._width=u=t,this._height=_=e;break;case"fixedwidth":c=h,this._height=_=Math.round(e/h);break;case"fixedheight":h=c,this._width=u=Math.round(t/c);break;case"fixedauto":t/e<this.designWidth/this.designHeight?(c=h,this._height=_=Math.round(e/h)):(h=c,this._width=u=Math.round(t/c))}this.conchModel&&this.conchModel.size(this._width,this._height),h*=this.scaleX,c*=this.scaleY,1===h&&1===c?this.transform.identity():(this.transform.a=this._formatData(h/(d/u)),this.transform.d=this._formatData(c/(f/_)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),r.size(u,_),s.changeWebGLSize(u,_),o.scale(d/u/p,f/_/p),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(t-d)/p:this.offset.x=.5*(t-d)/p,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(e-f)/p:this.offset.y=.5*(e-f)/p,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),o.translate(this.offset.x,this.offset.y),this.canvasDegree=0,i&&("horizontal"===this._screenMode?(o.rotate(Math.PI/2),o.translate(e/p,0),this.canvasDegree=90):(o.rotate(-Math.PI/2),o.translate(0,t/p),this.canvasDegree=-90)),o.a=this._formatData(o.a),o.d=this._formatData(o.d),o.tx=this._formatData(o.tx),o.ty=this._formatData(o.ty),a.transformOrigin=a.webkitTransformOrigin=a.msTransformOrigin=a.mozTransformOrigin=a.oTransformOrigin="0px 0px 0px",a.transform=a.webkitTransform=a.msTransform=a.mozTransform=a.oTransform="matrix("+o.toString()+")",o.translate(parseInt(a.left)||0,parseInt(a.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},o._formatData=function(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?t>0?1:-1:t},o.getMousePoint=function(){return b.TEMP.setTo(this.mouseX,this.mouseY)},o.repaint=function(){this._repaint=1},o.parentRepaint=function(){},o._loop=function(){return this.render(L.context,0,0),!0},o._onmouseMove=function(t){this._mouseMoveTime=k.now()},o.getTimeFromFrameStart=function(){return k.now()-this._frameStartTime},o.render=function(e,n,r){if("sleep"===this._frameRate&&!L.isConchApp){var a=k.now();if(!(a-this._frameStartTime>=1e3))return;this._frameStartTime=a}if(this._renderCount++,L.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=k.now();var o="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),l=this._renderCount%2==0;if(X.renderSlow=!o,o||l||L.isConchApp){X.loopCount++,y.instance.runEvent(),i.timer._update(),s.update3DLoop();var h,c=0,u=0;if(L.isConchNode)for(c=0,u=this._scenes.length;c<u;c++)(h=this._scenes[c])&&h._updateSceneConch();else for(c=0,u=this._scenes.length;c<u;c++)(h=this._scenes[c])&&h._updateScene();if(L.isConchNode){var _=ut.CustomList;for(c=0,u=_.length;c<u;c++){var d=_[c];d.customRender(d.customContext,0,0)}return}}L.isConchNode||!this.renderingEnabled||!o&&l||(L.isWebGL?(e.clear(),t.prototype.render.call(this,e,n,r),X._show&&X._sp&&X._sp.render(e,n,r),s.clear(this._bgColor),s.beginFlush(),e.flush(),s.endFinish(),Z.instance&&Z.getInstance().endDispose()):(s.clear(this._bgColor),t.prototype.render.call(this,e,n,r),X._show&&X._sp&&X._sp.render(e,n,r)))}else this._renderCount%5==0&&(X.loopCount++,y.instance.runEvent(),i.timer._update())},o._requestFullscreen=function(){var t=k.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},o._fullScreenChanged=function(){i.stage.event("fullscreenchange")},o.exitFullscreen=function(){var t=k.document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},a(0,o,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),a(0,o,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),a(0,o,"frameRate",function(){return this._frameRate},function(t){if(this._frameRate=t,L.isConchApp)switch(this._frameRate){case"slow":k.window.conch&&k.window.conchConfig.setSlowFrame&&k.window.conchConfig.setSlowFrame(!0);break;case"fast":k.window.conch&&k.window.conchConfig.setSlowFrame&&k.window.conchConfig.setSlowFrame(!1);break;case"mouse":k.window.conch&&k.window.conchConfig.setMouseFrame&&k.window.conchConfig.setMouseFrame(2e3);break;case"sleep":k.window.conch&&k.window.conchConfig.setLimitFPS&&k.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),a(0,o,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),a(0,o,"width",t.prototype._$get_width,function(t){this.designWidth=t,i.superSet(ut,this,"width",t),i.timer.callLater(this,this._changeCanvasSize)}),a(0,o,"alignH",function(){return this._alignH},function(t){this._alignH=t,i.timer.callLater(this,this._changeCanvasSize)}),a(0,o,"isFocused",function(){return this._isFocused}),a(0,o,"height",t.prototype._$get_height,function(t){this.designHeight=t,i.superSet(ut,this,"height",t),i.timer.callLater(this,this._changeCanvasSize)}),a(0,o,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||C.create()},t.prototype._$set_transform),a(0,o,"isVisibility",function(){return this._isVisibility}),a(0,o,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),a(0,o,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t,i.timer.callLater(this,this._changeCanvasSize)}),a(0,o,"alignV",function(){return this._alignV},function(t){this._alignV=t,i.timer.callLater(this,this._changeCanvasSize)}),a(0,o,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this.conchModel&&this.conchModel.bgColor(t),L.isWebGL&&(t?e._wgColor=H.create(t)._color:k.onMiniGame||(e._wgColor=null)),k.onLimixiu?e._wgColor=H.create(t)._color:L.canvas.style.background=t||"none"}),a(0,o,"mouseX",function(){return Math.round(y.instance.mouseX/this.clientScaleX)}),a(0,o,"mouseY",function(){return Math.round(y.instance.mouseY/this.clientScaleY)}),a(0,o,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t}),a(0,o,"visible",t.prototype._$get_visible,function(t){this.visible!==t&&(i.superSet(ut,this,"visible",t),L._mainCanvas.source.style.visibility=t?"visible":"hidden")}),a(0,o,"fullScreenEnabled",null,function(t){var e=k.document,i=L.canvas;t?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),e.addEventListener("fullscreenchange",this._fullScreenChanged),e.addEventListener("mozfullscreenchange",this._fullScreenChanged),e.addEventListener("webkitfullscreenchange",this._fullScreenChanged),e.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),e.removeEventListener("fullscreenchange",this._fullScreenChanged),e.removeEventListener("mozfullscreenchange",this._fullScreenChanged),e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),e.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),e.SCALE_NOSCALE="noscale",e.SCALE_EXACTFIT="exactfit",e.SCALE_SHOWALL="showall",e.SCALE_NOBORDER="noborder",e.SCALE_FULL="full",e.SCALE_FIXED_WIDTH="fixedwidth",e.SCALE_FIXED_HEIGHT="fixedheight",e.SCALE_FIXED_AUTO="fixedauto",e.ALIGN_LEFT="left",e.ALIGN_RIGHT="right",e.ALIGN_CENTER="center",e.ALIGN_TOP="top",e.ALIGN_MIDDLE="middle",e.ALIGN_BOTTOM="bottom",e.SCREEN_NONE="none",e.SCREEN_HORIZONTAL="horizontal",e.SCREEN_VERTICAL="vertical",e.FRAME_FAST="fast",e.FRAME_SLOW="slow",e.FRAME_MOUSE="mouse",e.FRAME_SLEEP="sleep",e.FRAME_MOUSE_THREDHOLD=2e3,n(e,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),e}(ut),yt=(function(t){function e(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,e.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}r(e,"laya.media.SoundNode",ut);var i=e.prototype;i._onParentChange=function(){this.target=this.parent},i.play=function(t,e){void 0===t&&(t=1),isNaN(t)&&(t=1),this.url&&(this.stop(),this._channel=I.playSound(this.url,t,e))},i.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},i._setPlayAction=function(t,e,i,n){void 0===n&&(n=!0),this[i]&&t&&(n?t.on(e,this,this[i]):t.off(e,this,this[i]))},i._setPlayActions=function(t,e,i,n){if(void 0===n&&(n=!0),t&&e){var r,a=e.split(","),s=0;for(r=a.length,s=0;s<r;s++)this._setPlayAction(t,a[s],i,n)}},a(0,i,"playEvent",null,function(t){this._playEvents=t,t&&this._tar&&this._setPlayActions(this._tar,t,"play")}),a(0,i,"target",null,function(t){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=t,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),a(0,i,"stopEvent",null,function(t){this._stopEvents=t,t&&this._tar&&this._setPlayActions(this._tar,t,"stop")})}(),function(t){function e(){this._src=null,this._onload=null,this._onerror=null,e.__super.call(this)}r(e,"laya.resource.FileBitmap",ft);var i=e.prototype;return a(0,i,"src",function(){return this._src},function(t){this._src=t}),a(0,i,"onload",null,function(t){}),a(0,i,"onerror",null,function(t){}),e}()),vt=function(t){function e(t,i){this._is2D=!1,e.__super.call(this);var n=this;if(this._source=this,"2D"===t||"AUTO"===t&&!L.isWebGL){this._is2D=!0,this._source=i||k.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var r=this;r.getContext=function(t,e){if(n._ctx)return n._ctx;var i=n._ctx=n._source.getContext(t,e);return i&&(i._canvas=r,L.isFlash||k.onLimixiu||(i.size=function(t,e){})),i}}this.lock=!0}r(e,"laya.resource.HTMLCanvas",ft);var i=e.prototype;return i.clear=function(){this._ctx&&this._ctx.clear()},i.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},i.release=function(){},i._setContext=function(t){this._ctx=t},i.getContext=function(t,i){return this._ctx?this._ctx:this._ctx=e._createContext(this)},i.getMemSize=function(){return 0},i.size=function(t,e){(this._w!=t||this._h!=e||this._source&&(this._source.width!=t||this._source.height!=e))&&(this._w=t,this._h=e,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t))},i.getCanvas=function(){return this._source},i.toBase64=function(t,e,i){if(this._source)if(L.isConchApp&&this._source.toBase64)this._source.toBase64(t,e,i);else{var n=this._source.toDataURL(t,e);i.call(this,n)}},a(0,i,"context",function(){return this._ctx}),a(0,i,"asBitmap",null,function(t){}),e.create=function(t,i){return new e(t,i)},e.TYPE2D="2D",e.TYPE3D="3D",e.TYPEAUTO="AUTO",e._createContext=null,e}(),St=(function(t){function e(t,i,n,r,a,s,o,l){throw e.__super.call(this),new Error("不允许new！")}r(e,"laya.resource.HTMLSubImage",ft),e.create=function(t,i,n,r,a,s,o,l){return void 0===l&&(l=!1),new e(t,i,n,r,a,s,o,l)}}(),function(t){function e(){this._frames=null,this._url=null,e.__super.call(this),this._setControlNode(this)}r(e,"laya.display.Animation",t);var n=e.prototype;n.destroy=function(t){void 0===t&&(t=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,t),this._frames=null,this._labels=null},n.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),i&&this._setFramesFromCache(i,n),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,this._frames&&this.interval>0&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},n._setFramesFromCache=function(t,i){var n;return void 0===i&&(i=!1),this._url&&(t=this._url+"#"+t),t&&e.framesMap[t]?((n=e.framesMap[t])instanceof Array?(this._frames=e.framesMap[t],this._count=this._frames.length):(n.nodeRoot&&(e.framesMap[t]=this._parseGraphicAnimationByData(n),n=e.framesMap[t]),this._frames=n.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=n.interval),this._labels=this._copyLabels(n.labels)),!0):(i&&console.log("ani not found:",t),!1)},n._copyLabels=function(t){if(!t)return null;var e,i;for(i in e={},t)e[i]=q.copyArray([],t[i]);return e},n._frameLoop=function(){this._style.visible&&this._style.alpha>.01&&t.prototype._frameLoop.call(this)},n._displayToIndex=function(t){this._frames&&(this.graphics=this._frames[t])},n.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},n.loadImages=function(t,i){return void 0===i&&(i=""),this._url="",this._setFramesFromCache(i)||(this.frames=e.framesMap[i]?e.framesMap[i]:e.createFrames(t,i)),this},n.loadAtlas=function(t,n,r){function a(i){t===i&&(s.frames=e.framesMap[r]?e.framesMap[r]:e.createFrames(t,r),n&&n.run())}void 0===r&&(r=""),this._url="";var s=this;return s._setFramesFromCache(r)||(st.getAtlas(t)?a(t):i.loader.load(t,h.create(null,a,[t]),null,"atlas")),this},n.loadAnimation=function(t,e,n){return this._url=t,this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,e&&e.run()):!n||st.getAtlas(n)?this._loadAnimationData(t,e,n):i.loader.load(n,h.create(this,this._loadAnimationData,[t,e,n]),null,"atlas"),this},n._loadAnimationData=function(t,n,r){function a(i){if(st.getRes(i)&&t===i){var r;if(e.framesMap[t+"#"])o._setFramesFromCache(s._actionName,!0),s.index=0,s._checkResumePlaying();else{var a=o._parseGraphicAnimation(st.getRes(t));if(!a)return;var l,h=a.animationList,c=0,u=h.length;for(c=0;c<u;c++)r=h[c],e.framesMap[t+"#"+r.name]=r,l||(l=r);l&&(e.framesMap[t+"#"]=l,o._setFramesFromCache(s._actionName,!0),s.index=0),s._checkResumePlaying()}n&&n.run()}}var s=this;if(!r||st.getAtlas(r)){var o=this;st.getRes(t)?a(t):i.loader.load(t,h.create(null,a,[t]),null,"json"),st.clearRes(t)}else console.warn("atlas load fail:"+r)},n._parseGraphicAnimation=function(t){return Tt.parseAnimationData(t)},n._parseGraphicAnimationByData=function(t){return Tt.parseAnimationByData(t)},a(0,n,"frames",function(){return this._frames},function(t){this._frames=t,t&&(this._count=t.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),a(0,n,"autoPlay",null,function(t){t?this.play():this.stop()}),a(0,n,"source",null,function(t){t.indexOf(".ani")>-1?this.loadAnimation(t):t.indexOf(".json")>-1||t.indexOf("als")>-1||t.indexOf("atlas")>-1?this.loadAtlas(t):this.loadImages(t.split(","))}),a(0,n,"autoAnimation",null,function(t){this.play(0,!0,t,!1)}),e.createFrames=function(t,i){var n,r,a=0,o=0;if("string"==typeof t){var l=st.getAtlas(t);if(l&&l.length)for(n=[],a=0,o=l.length;a<o;a++)(r=new s.createGraphics).drawTexture(st.getRes(l[a]),0,0),n.push(r)}else if(t instanceof Array)for(n=[],a=0,o=t.length;a<o;a++)(r=new s.createGraphics).loadImage(t[a],0,0),n.push(r);return i&&(e.framesMap[i]=n),n},e.clearCache=function(t){var i,n=e.framesMap,r=t+"#";for(i in n)i!==t&&0!=i.indexOf(r)||delete e.framesMap[i]},e.framesMap={}}(pt),function(t){function e(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,e.__super.call(this),null==e._sortIndexFun&&(e._sortIndexFun=w.sortByKey("index",!1,!0))}r(e,"laya.display.FrameAnimation",t);var i=e.prototype;return i._setUp=function(t,e){this._labels=null,this._animationNewFrames=null,this._targetDic=t,this._animationData=e,this.interval=1e3/e.frameRate,e.parsed?(this._count=e.count,this._labels=e.labels,this._animationNewFrames=e.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),e.parsed=!0,e.labels=this._labels,e.count=this._count,e.animationNewFrames=this._animationNewFrames},i.clear=function(){t.prototype.clear.call(this),this._targetDic=null,this._animationData=null},i._displayToIndex=function(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(i=0;i<n;i++)this._displayNodeToFrame(e[i],t)}},i._displayNodeToFrame=function(t,e,i){i||(i=this._targetDic);var n=i[t.target];if(n){var r,a,s,o=t.frames,l=t.keys,h=0,c=l.length;for(h=0;h<c;h++)s=(a=o[r=l[h]]).length>e?a[e]:a[a.length-1],n[r]=s}},i._calculateDatas=function(){if(this._animationData){var t,e=this._animationData.nodes,i=0,n=e.length;for(this._count=0,i=0;i<n;i++)t=e[i],this._calculateNodeKeyFrames(t);this._count+=1}},i._calculateNodeKeyFrames=function(t){var i,n,r=t.keyframes,a=t.target;for(i in t.frames||(t.frames={}),t.keys?t.keys.length=0:t.keys=[],t.initValues||(t.initValues={}),r)n=r[i],t.frames[i]||(t.frames[i]=[]),this._targetDic&&this._targetDic[a]&&(t.initValues[i]=this._targetDic[a][i]),n.sort(e._sortIndexFun),t.keys.push(i),this._calculateNodePropFrames(n,t.frames[i],i,a)},i.resetToInitState=function(){if(this._targetDic&&this._animationData){var t,e,i=this._animationData.nodes,n=0,r=i.length;for(n=0;n<r;n++)if(e=(t=i[n]).initValues){var a,s=this._targetDic[t.target];if(s)for(a in e)s[a]=e[a]}}},i._calculateNodePropFrames=function(t,e,i,n){var r=0,a=t.length-1;for(e.length=t[a].index+1,r=0;r<a;r++)this._dealKeyFrame(t[r]),this._calculateFrameValues(t[r],t[r+1],e);0==a&&(e[0]=t[0].value,this._animationNewFrames&&(this._animationNewFrames[t[0].index]=!0)),this._dealKeyFrame(t[r])},i._dealKeyFrame=function(t){t.label&&""!=t.label&&this.addLabel(t.label,t.index)},i._calculateFrameValues=function(t,e,i){var n,r=0,a=t.index,s=e.index,o=t.value,l=e.value-t.value,h=s-a;if(s>this._count&&(this._count=s),t.tween)for(null==(n=W[t.tweenMethod])&&(n=W.linearNone),r=a;r<s;r++)i[r]=n(r-a,o,l,h),this._animationNewFrames&&(this._animationNewFrames[r]=!0);else for(r=a;r<s;r++)i[r]=o;this._animationNewFrames&&(this._animationNewFrames[t.index]=!0,this._animationNewFrames[e.index]=!0),i[e.index]=e.value},e._sortIndexFun=null,e}(pt)),xt=function(t){function e(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",e.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=mt.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}r(e,"laya.display.Input",t);var s=e.prototype;return s.setSelection=function(t,e){this.focus=!0,laya.display.Input.inputElement.selectionStart=t,laya.display.Input.inputElement.selectionEnd=e},s._onUnDisplay=function(t){this.focus=!1},s._onMouseDown=function(t){this.focus=!0},s._syncInputTransform=function(){var t=this.nativeInput,n=q.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),r=this._width-this.padding[1]-this.padding[3],a=this._height-this.padding[0]-this.padding[2];L.isConchApp?(t.setScale(n.scaleX,n.scaleY),t.setSize(r,a),t.setPos(n.x,n.y)):(e.inputContainer.style.transform=e.inputContainer.style.webkitTransform="scale("+n.scaleX+","+n.scaleY+") rotate("+i.stage.canvasDegree+"deg)",t.style.width=r+"px",t.style.height=a+"px",e.inputContainer.style.left=n.x+"px",e.inputContainer.style.top=n.y+"px")},s.select=function(){this.nativeInput.select()},s._setInputMethod=function(){e.input.parentElement&&e.inputContainer.removeChild(e.input),e.area.parentElement&&e.inputContainer.removeChild(e.area),e.inputElement=this._multiline?e.area:e.input,e.inputContainer.appendChild(e.inputElement),mt.RightToLeft&&(e.inputElement.style.direction="rtl")},s._focusIn=function(){laya.display.Input.isInputting=!0;var t=this.nativeInput;this._focus=!0;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),t.readOnly=!this._editable,L.isConchApp&&(t.setType(this._type),t.setForbidEdit(!this._editable)),t.maxLength=this._maxChars,this.padding,t.type=this._type,t.value=this._content,t.placeholder=this._prompt,i.stage.off("keydown",this,this._onKeyDown),i.stage.on("keydown",this,this._onKeyDown),i.stage.focus=this,this.event("focus"),k.onPC&&t.focus(),k.onMiniGame||(this._text,this._text=null),this.typeset(),t.setColor(this._originColor),t.setFontSize(this.fontSize),t.setFontFace(k.onIPhone&&mt._fontFamilyMap[this.font]||this.font),L.isConchApp&&t.setMultiAble&&t.setMultiAble(this._multiline),e.lineHeight=this.leading+this.fontSize+"px",e.fontStyle=this.italic?"italic":"normal",e.fontWeight=this.bold?"bold":"normal",e.textAlign=this.align,e.padding="0 0",this._syncInputTransform(),!L.isConchApp&&k.onPC&&i.timer.frameLoop(1,this,this._syncInputTransform)},s._setPromptColor=function(){(e.promptStyleDOM=k.getElementById("promptStyle"))||((e.promptStyleDOM=k.createElement("style")).setAttribute("id","promptStyle"),k.document.head.appendChild(e.promptStyleDOM)),e.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},s._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(i.superSet(mt,this,"text",this._content),i.superSet(mt,this,"color",this._originColor)):(i.superSet(mt,this,"text",this._prompt),i.superSet(mt,this,"color",this._promptColor)),i.stage.off("keydown",this,this._onKeyDown),i.stage.focus=null,this.event("blur"),L.isConchApp&&this.nativeInput.blur(),k.onPC&&i.timer.clear(this,this._syncInputTransform)},s._onKeyDown=function(t){13===t.keyCode&&(k.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},s.changeText=function(e){this._content=e,this._focus?(this.nativeInput.value=e||"",this.event("change")):t.prototype.changeText.call(this,e)},a(0,s,"color",t.prototype._$get_color,function(t){this._focus&&this.nativeInput.setColor(t),i.superSet(mt,this,"color",this._content?t:this._promptColor),this._originColor=t}),a(0,s,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),a(0,s,"multiline",function(){return this._multiline},function(t){this._multiline=t,this.valign=t?"top":"middle"}),a(0,s,"maxChars",function(){return this._maxChars},function(t){t<=0&&(t=1e5),this._maxChars=t}),a(0,s,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(t){i.superSet(mt,this,"color",this._originColor),t+="",this._focus?(this.nativeInput.value=t||"",this.event("change")):(this._multiline||(t=t.replace(/\r?\n/g,"")),this._content=t,t?i.superSet(mt,this,"text",t):(i.superSet(mt,this,"text",this._prompt),i.superSet(mt,this,"color",this.promptColor)))}),a(0,s,"nativeInput",function(){return this._multiline?e.area:e.input}),a(0,s,"prompt",function(){return this._prompt},function(t){!this._text&&t&&i.superSet(mt,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?i.superSet(mt,this,"text",this._text==this._prompt?t:this._text):i.superSet(mt,this,"text",t),this._prompt=mt.langPacks&&mt.langPacks[t]?mt.langPacks[t]:t}),a(0,s,"focus",function(){return this._focus},function(t){var i=this.nativeInput;this._focus!==t&&(t?(i.target?i.target._focusOut():this._setInputMethod(),i.target=this,this._focusIn()):(i.target=null,this._focusOut(),k.document.body.scrollTop=0,i.blur(),L.isConchApp?i.setPos(-1e4,-1e4):e.inputContainer.contains(i)&&e.inputContainer.removeChild(i)))}),a(0,s,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(t){t?((t="[^"+t+"]").indexOf("^^")>-1&&(t=t.replace("^^","")),this._restrictPattern=new RegExp(t,"g")):this._restrictPattern=null}),a(0,s,"editable",function(){return this._editable},function(t){this._editable=t,L.isConchApp&&e.input.setForbidEdit(!t)}),a(0,s,"promptColor",function(){return this._promptColor},function(t){this._promptColor=t,this._content||i.superSet(mt,this,"color",t)}),a(0,s,"type",function(){return this._type},function(t){this._getCSSStyle().password="password"==t,this._type=t,L.isConchApp&&this.nativeInput.setType(t)}),a(0,s,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),a(0,s,"asPassword",function(){return this._getCSSStyle().password},function(t){this._getCSSStyle().password=t,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),e.__init__=function(){e._createInputElement(),k.onMobile&&L.canvas.addEventListener(e.IOS_IFRAME?k.onMiniGame?"touchend":"click":"touchend",e._popupInputMethod)},e._popupInputMethod=function(t){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},e._createInputElement=function(){e._initInput(e.area=k.createElement("textarea")),e._initInput(e.input=k.createElement("input")),(e.inputContainer=k.createElement("div")).style.position="absolute",e.inputContainer.style.zIndex=1e5,k.container.appendChild(e.inputContainer),e.inputContainer.setPos=function(t,i){e.inputContainer.style.left=t+"px",e.inputContainer.style.top=i+"px"}},e._initInput=function(t){var i=t.style;i.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",i.resize="none",i.backgroundColor="transparent",i.border="none",i.outline="none",i.zIndex=1,t.addEventListener("input",e._processInputting),t.addEventListener("mousemove",e._stopEvent),t.addEventListener("mousedown",e._stopEvent),t.addEventListener("touchmove",e._stopEvent),t.setFontFace=function(e){t.style.fontFamily=e},L.isConchApp||(t.setColor=function(e){t.style.color=e},t.setFontSize=function(e){t.style.fontSize=e+"px"})},e._processInputting=function(t){var e=laya.display.Input.inputElement.target;if(e){var i=laya.display.Input.inputElement.value;e._restrictPattern&&(i=i.replace(/\u2006|\x27/g,""),e._restrictPattern.test(i)&&(i=i.replace(e._restrictPattern,""),laya.display.Input.inputElement.value=i)),e._text=i,e.event("input")}},e._stopEvent=function(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},e.TYPE_TEXT="text",e.TYPE_PASSWORD="password",e.TYPE_EMAIL="email",e.TYPE_URL="url",e.TYPE_NUMBER="number",e.TYPE_RANGE="range",e.TYPE_DATE="date",e.TYPE_MONTH="month",e.TYPE_WEEK="week",e.TYPE_TIME="time",e.TYPE_DATE_TIME="datetime",e.TYPE_DATE_TIME_LOCAL="datetime-local",e.TYPE_SEARCH="search",e.input=null,e.area=null,e.inputElement=null,e.inputContainer=null,e.confirmButton=null,e.promptStyleDOM=null,e.inputHeight=45,e.isInputting=!1,e.stageMatrix=null,n(e,["IOS_IFRAME",function(){return this.IOS_IFRAME=k.onIOS&&k.window.top!=k.window.self}]),e}(mt),Et=function(t){function e(t,i){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,e.__super.call(this),this._init_(t,i)}r(e,"laya.resource.HTMLImage",yt);var i=e.prototype;return i._init_=function(t,e){this._src=t,this._source=new k.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),0!=t.indexOf("data:image")&&(this._source.crossOrigin=""),t&&(this._source.src=t)},i.recreateResource=function(){var t=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var e=this;this._source=new k.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._source.onload=null,void(e._source=null);e._source.onload=null,e.memorySize=t._w*t._h*4,e._recreateLock=!1,e.completeCreate()},this._source.src=this._src}},i.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},i.onresize=function(){this._w=this._source.width,this._h=this._source.height},a(0,i,"onload",null,function(t){var e=this;this._onload=t,this._source&&(this._source.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),a(0,i,"onerror",null,function(t){var e=this;this._onerror=t,this._source&&(this._source.onerror=null!=this._onerror?function(){e._onerror()}:null)}),a(0,i,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t,L.isConchApp&&this._source&&(this._source.enableMerageInAtlas=t)}),e.create=function(t,i){return new e(t,i)},e}(),Tt=(function(t){function e(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,e.__super.call(this)}r(e,"laya.display.EffectAnimation",t);var i=e.prototype;i._onOtherBegin=function(t){t!=this&&this.stop()},i.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},i._onPlayAction=function(){this.play(0,!1)},i.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,t,e,i,n))},i._recordInitData=function(){if(this._aniKeys){var t,e,i=0;for(t=this._aniKeys.length,i=0;i<t;i++)e=this._aniKeys[i],this._initData[e]=this._target[e]}},i._displayToIndex=function(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(n=n>1?1:n,i=0;i<n;i++)this._displayNodeToFrame(e[i],t)}},i._displayNodeToFrame=function(t,e,i){if(this._target){var n;n=this._target;var r,a,s,o,l=t.frames,h=t.keys,c=0,u=h.length;o=t.secondFrames;var _,d,f,p,m=0;for(c=0;c<u;c++)a=l[r=h[c]],-1==(m=o[r])?s=this._initData[r]:e<m?(f=(d=t.keyframes[r])[0]).tween?(null==(_=W[f.tweenMethod])&&(_=W.linearNone),p=d[1],s=_(e,this._initData[r],p.value-this._initData[r],p.index)):s=this._initData[r]:s=a.length>e?a[e]:a[a.length-1],n[r]=s}},i._calculateNodeKeyFrames=function(e){t.prototype._calculateNodeKeyFrames.call(this,e);var i,n,r,a=e.keyframes;for(i in e.target,r={},e.secondFrames=r,a)(n=a[i]).length<=1?r[i]=-1:r[i]=n[1].index},a(0,i,"target",function(){return this._target},function(t){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=t,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),a(0,i,"playEvent",null,function(t){this._playEvents=t,t&&this.addEvent()}),a(0,i,"effectData",null,function(t){var e;t&&((e=t.animations)&&e[0]&&(this._setUp({},e[0]),e[0].nodes&&e[0].nodes[0]&&(this._aniKeys=e[0].nodes[0].keys)))}),a(0,i,"effectClass",null,function(t){var e,i;(this._effectClass=U.getClass(t),this._effectClass)&&((e=this._effectClass.uiView)&&(i=e.animations)&&i[0]&&(this._setUp({},i[0]),i[0].nodes&&i[0].nodes[0]&&(this._aniKeys=i[0].nodes[0].keys)))}),e.EffectAnimationBegin="effectanimationbegin"}(St),function(t){function e(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,e.__super.call(this)}var i;r(e,"laya.utils.GraphicAnimation",t);var a=e.prototype;return a._parseNodeList=function(t){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[t.compId]=t.props,t.compId&&this._nodeList.push(t.compId);var e=t.child;if(e){var i=0,n=e.length;for(i=0;i<n;i++)this._parseNodeList(e[i])}},a._calGraphicData=function(t){var e;if(this._setUp(null,t),this._createGraphicData(),this._nodeIDAniDic)for(e in this._nodeIDAniDic)this._nodeIDAniDic[e]=null},a._createGraphicData=function(){var t,e=[],i=0,n=this.count,r=this._animationNewFrames;for(r||(r=[]),i=0;i<n;i++)!r[i]&&t||(t=this._createFrameGraphic(i)),e.push(t);this._gList=e},a._createFrameGraphic=function(t){var i=s.createGraphics();return e._rootMatrix||(e._rootMatrix=new C),this._updateNodeGraphic(this._rootNode,t,e._rootMatrix,i),i},a._updateNodeGraphic=function(t,e,i,n,r){void 0===r&&(r=1);var a,s,o,l,h=(a=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId])).alpha*r;if(!(h<.01)&&(a.resultTransform||(a.resultTransform=C.create()),s=a.resultTransform,C.mul(a.transform,i,s),a.skin&&(o=this._getTextureByUrl(a.skin))&&(s._checkTransform()?(n.drawTexture(o,0,0,a.width,a.height,s,h),a.resultTransform=null):n.drawTexture(o,s.tx,s.ty,a.width,a.height,null,h)),l=t.child)){var c,u=0;for(c=l.length,u=0;u<c;u++)this._updateNodeGraphic(l[u],e,s,n,h)}},a._updateNoChilds=function(t,e){if(t.skin){var i=this._getTextureByUrl(t.skin);if(i){var n=t.transform;n._checkTransform(),n.bTransform?e.drawTexture(i,0,0,t.width,t.height,n.clone(),t.alpha):e.drawTexture(i,n.tx,n.ty,t.width,t.height,null,t.alpha)}}},a._updateNodeGraphic2=function(t,e,i){var n;if(n=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]),t.child){var r=n.transform;r._checkTransform();var a,s;s=(a=!r.bTransform)&&(0!=r.tx||0!=r.ty);var o,l,h;if((o=r.bTransform||1!=n.alpha)&&i.save(),1!=n.alpha&&i.alpha(n.alpha),a?s&&i.translate(r.tx,r.ty):i.transform(r.clone()),l=t.child,n.skin&&(h=this._getTextureByUrl(n.skin))&&i.drawTexture(h,0,0,n.width,n.height),l){var c,u=0;for(c=l.length,u=0;u<c;u++)this._updateNodeGraphic2(l[u],e,i)}o?i.restore():a?s&&i.translate(-r.tx,-r.ty):i.transform(r.clone().invert())}else this._updateNoChilds(n,i)},a._calculateNodeKeyFrames=function(e){t.prototype._calculateNodeKeyFrames.call(this,e),this._nodeIDAniDic[e.target]=e},a.getNodeDataByID=function(t){return this._nodeIDAniDic[t]},a._getParams=function(t,i,n,r){var a=e._temParam;a.length=i.length;var s=0,o=i.length;for(s=0;s<o;s++)a[s]=this._getObjVar(t,i[s][0],n,i[s][1],r);return a},a._getObjVar=function(t,e,i,n,r){if(t.hasOwnProperty(e)){var a=t[e];return i>=a.length&&(i=a.length-1),t[e][i]}return r.hasOwnProperty(e)?r[e]:n},a._getNodeGraphicData=function(t,n,r){r||(r=i.create()),r.transform?r.transform.identity():r.transform=C.create();var a=this.getNodeDataByID(t);if(!a)return r;var s,o,l=a.frames,h=this._getParams(l,e._drawTextureCmd,n,this._nodeDefaultProps[t]),c=h[0],u=NaN,_=NaN,d=h[5],f=h[6],p=h[13],m=h[14],g=h[7],y=h[8],v=h[9],S=h[11],x=h[12];u=h[3],_=h[4],0!=u&&0!=_||(c=null),-1==u&&(u=0),-1==_&&(_=0),r.skin=c,r.width=u,r.height=_,c&&((s=this._getTextureByUrl(c))?(u||(u=s.sourceWidth),_||(_=s.sourceHeight)):console.warn("lost skin:",c,",you may load pics first")),r.alpha=h[10],o=r.transform,0!=p&&(d=p*u),0!=m&&(f=m*_),0==d&&0==f||o.translate(-d,-f);var E=null;if(v||1!==g||1!==y||S||x){(E=e._tempMt).identity(),E.bTransform=!0;var T=.0174532922222222*(v-S),w=.0174532922222222*(v+x),b=Math.cos(w),M=Math.sin(w),I=Math.sin(T),D=Math.cos(T);E.a=g*b,E.b=g*M,E.c=-y*I,E.d=y*D,E.tx=E.ty=0}return E&&(o=C.mul(o,E,o)),o.translate(h[1],h[2]),r},a._getTextureByUrl=function(t){return st.getRes(t)},a.setAniData=function(t,i){if(t.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=t,this._parseNodeList(t);var n,r={},a=[],s=t.animations,o=0,l=s.length;for(o=0;o<l;o++)if(n=s[o],this._labels=null,(!i||i==n.name)&&n){try{this._calGraphicData(n)}catch(t){console.warn("parse animation fail:"+n.name+",empty animation created"),this._gList=[]}var h={};h.interval=1e3/n.frameRate,h.frames=this._gList,h.labels=this._labels,h.name=n.name,a.push(h),r[n.name]=h}this.animationList=a,this.animationDic=r}e._temParam.length=0},a.parseByData=function(t){var e,i;e=t.nodeRoot,i=t.aniO,delete t.nodeRoot,delete t.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=e,this._parseNodeList(e),this._labels=null;try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var n=t;return n.interval=1e3/i.frameRate,n.frames=this._gList,n.labels=this._labels,n.name=i.name,n},a.setUpAniData=function(t){if(t.animations){var e,i={},n=[],r=t.animations,a=0,s=r.length;for(a=0;a<s;a++)if(e=r[a]){var o={};o.name=e.name,o.aniO=e,o.nodeRoot=t,n.push(o),i[e.name]=o}this.animationList=n,this.animationDic=i}},a._clear=function(){var t,e;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(t in this._nodeGDic)(e=this._nodeGDic[t])&&e.recover();this._nodeGDic=null},e.parseAnimationByData=function(t){var i;return e._I||(e._I=new e),i=e._I.parseByData(t),e._I._clear(),i},e.parseAnimationData=function(t){var i;return e._I||(e._I=new e),e._I.setUpAniData(t),(i={}).animationList=e._I.animationList,i.animationDic=e._I.animationDic,e._I._clear(),i},e._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],e._temParam=[],e._I=null,e._rootMatrix=null,n(e,["_tempMt",function(){return this._tempMt=new C}]),e.__init$=function(){i=function(){function t(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return r(t,""),t.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),Y.recover("GraphicNode",this)},t.create=function(){return Y.getItemByClass("GraphicNode",t)},t}()},e}(St));i.__init([l,ot,L,k,j,D,ct,Tt])}(window,document,Laya),function(t,e,i){i.un,i.uns,i.static;var n=i.class;i.getset,i.__newvec,new(function(){function t(){}return n(t,"LayaMain"),t}())}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,a=i.getset,s=(i.__newvec,laya.utils.Browser),o=(laya.events.Event,laya.events.EventDispatcher),l=laya.resource.HTMLImage,h=laya.utils.Handler,c=laya.display.Input,u=laya.net.Loader,_=laya.net.LocalStorage,d=(laya.maths.Matrix,laya.renders.Render),f=laya.utils.RunDriver,p=laya.media.SoundChannel,m=laya.media.SoundManager,g=laya.net.URL,y=laya.utils.Utils,v=function(){function e(){}return r(e,"laya.wx.mini.MiniAdpter"),e.getJson=function(t){return JSON.parse(t)},e.init=function(n,r){if(void 0===n&&(n=!1),void 0===r&&(r=!1),!(e._inited||(e._inited=!0,(e.window=t).navigator.userAgent.indexOf("MiniGame")<0))){e.isZiYu=r,e.isPosMsgYu=n,e.EnvConfig={};try{laya.webgl.resource.WebGLCanvas.premulAlpha=!0}catch(t){}e.isZiYu||(S.setNativeFileDir("/layaairGame"),S.existDir(S.fileNativeDir,h.create(e,e.onMkdirCallBack))),e.systemInfo=wx.getSystemInfoSync(),e.window.focus=function(){},i.getUrlPath=function(){},e.window.logtime=function(t){},e.window.alertTimeLog=function(t){},e.window.resetShareInfo=function(){},e.window.CanvasRenderingContext2D=function(){},e.window.CanvasRenderingContext2D.prototype=e.window.wx.createCanvas().getContext("2d").__proto__,e.window.document.body.appendChild=function(){},e.EnvConfig.pixelRatioInt=0,f.getPixelRatio=e.pixelRatio,e._preCreateElement=s.createElement,s.createElement=e.createElement,f.createShaderCondition=e.createShaderCondition,y.parseXMLFromString=e.parseXMLFromString,c._createInputElement=E._createInputElement,e.EnvConfig.load=u.prototype.load,u.prototype.load=w.prototype.load,u.prototype._loadImage=x.prototype._loadImage,T.__init__(),_._baseClass=T}},e.getUrlEncode=function(t,e){return-1!=t.indexOf(".fnt")?"utf8":"arraybuffer"==e?"":"utf8"},e.downLoadFile=function(t,e,i,n){void 0===e&&(e=""),void 0===n&&(n="ascii"),S.getFileInfo(t)?null!=i&&i.runWith([0]):S.downLoadFile(t,e,i,n)},e.remove=function(t,e){S.deleteFile("",t,e,"",0)},e.removeAll=function(){S.deleteAll()},e.hasNativeFile=function(t){return S.isLocalNativeFile(t)},e.getFileInfo=function(t){return S.getFileInfo(t)},e.getFileList=function(){return S.filesListObj},e.exitMiniProgram=function(){e.window.wx.exitMiniProgram()},e.onMkdirCallBack=function(t,e){t||(S.filesListObj=JSON.parse(e.data))},e.pixelRatio=function(){if(!e.EnvConfig.pixelRatioInt)try{return e.EnvConfig.pixelRatioInt=e.systemInfo.pixelRatio,e.systemInfo.pixelRatio}catch(t){}return e.EnvConfig.pixelRatioInt},e.createElement=function(i){var n;if("canvas"==i)return 1==e.idx?e.isZiYu?(n=sharedCanvas).style={}:n=t.canvas:n=t.wx.createCanvas(),e.idx++,n;if("textarea"==i||"input"==i)return e.onCreateInput(i);if("div"==i){var r=e._preCreateElement(i);return r.contains=function(t){return null},r.removeChild=function(t){},r}return e._preCreateElement(i)},e.onCreateInput=function(t){var i=e._preCreateElement(t);return i.focus=E.wxinputFocus,i.blur=E.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(t){},i.setType=function(t){},i.setFontFace=function(t){},i.addEventListener=function(t){},i.contains=function(t){return null},i.removeChild=function(t){},i},e.createShaderCondition=function(t){var e=this;return function(){return e[t.replace("this.","")]}},e.EnvConfig=null,e.window=null,e._preCreateElement=null,e._inited=!1,e.systemInfo=null,e.isZiYu=!1,e.isPosMsgYu=!1,e.autoCacheFile=!0,e.minClearSize=5242880,e.parseXMLFromString=function(e){var i;e=e.replace(/>\s+</g,"><");try{i=(new t.Parser.DOMParser).parseFromString(e,"text/xml")}catch(t){throw"需要引入xml解析库文件"}return i},e.idx=1,n(e,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),e}(),S=function(){function t(){}return r(t,"laya.wx.mini.MiniFileMgr"),t.isLocalNativeFile=function(t){for(var e=0,i=v.nativefiles.length;e<i;e++)if(-1!=t.indexOf(v.nativefiles[e]))return!0;return!1},t.getFileInfo=function(e){var i=e.split("?")[0],n=t.filesListObj[i];return null==n?null:n},t.read=function(e,i,n,r,a,s){var o;void 0===i&&(i="ascill"),void 0===r&&(r=""),void 0===a&&(a=!1),void 0===s&&(s=""),o=""==r||-1==r.indexOf("http://")&&-1==r.indexOf("../../../https@")?e:t.getFileNativePath(e),t.fs.readFile({filePath:o,encoding:i,success:function(t){null!=n&&n.runWith([0,t])},fail:function(e){e&&""!=r?t.downFiles(r,i,n,r,a,s):null!=n&&n.runWith([1])}})},t.downFiles=function(e,i,n,r,a,s){void 0===i&&(i="ascii"),void 0===r&&(r=""),void 0===a&&(a=!1),void 0===s&&(s=""),t.wxdown({url:e,success:function(e){200===e.statusCode&&t.readFile(e.tempFilePath,i,n,r,a,s)},fail:function(t){null!=n&&n.runWith([1,t])}}).onProgressUpdate(function(t){null!=n&&n.runWith([2,t.progress])})},t.readFile=function(e,i,n,r,a,s){void 0===i&&(i="ascill"),void 0===r&&(r=""),void 0===a&&(a=!1),void 0===s&&(s=""),t.fs.readFile({filePath:e,encoding:i,success:function(s){-1!=e.indexOf("http://")||-1!=e.indexOf("../../../https@")?(v.autoCacheFile||a)&&t.copyFile(e,r,n,i):null!=n&&n.runWith([0,s])},fail:function(t){t&&null!=n&&n.runWith([1,t])}})},t.downOtherFiles=function(e,i,n,r){void 0===n&&(n=""),void 0===r&&(r=!1),t.wxdown({url:e,success:function(e){200===e.statusCode&&((v.autoCacheFile||r)&&-1==n.indexOf("wx.qlogo.cn")?t.copyFile(e.tempFilePath,n,i):null!=i&&i.runWith([0,e.tempFilePath]))},fail:function(t){null!=i&&i.runWith([1,t])}})},t.downLoadFile=function(e,i,n,r){void 0===i&&(i=""),void 0===r&&(r="ascii"),"image"==i||"sound"==i?t.downOtherFiles(e,n,e,!0):t.downFiles(e,r,n,e,!0,i)},t.copyFile=function(e,i,n,r){void 0===r&&(r="");var a=e.split("/"),s=a[a.length-1],o=(i.split("?")[0],t.getFileInfo(i)),l=t.getFileNativePath(s),h=t.getCacheUseSize();o?o.readyUrl!=i?t.fs.getFileInfo({filePath:e,success:function(e){h+4194304+e.size>=52428800&&(e.size>v.minClearSize&&(v.minClearSize=e.size),t.onClearCacheRes()),t.deleteFile(s,i,n,r,e.size)},fail:function(t){null!=n&&n.runWith([1,t])}}):null!=n&&n.runWith([0]):t.fs.getFileInfo({filePath:e,success:function(a){h+4194304+a.size>=52428800&&(a.size>v.minClearSize&&(v.minClearSize=a.size),t.onClearCacheRes()),t.fs.copyFile({srcPath:e,destPath:l,success:function(e){t.onSaveFile(i,s,!0,r,n,a.size)},fail:function(t){null!=n&&n.runWith([1,t])}})},fail:function(t){null!=n&&n.runWith([1,t])}})},t.onClearCacheRes=function(){var e=v.minClearSize,i=[];for(var n in t.filesListObj)i.push(t.filesListObj[n]);t.sortOn(i,"time",16);for(var r=0,a=1,s=i.length;a<s;a++){var o=i[a];if(r>=e)break;r+=o.size,t.deleteFile("",o.readyUrl)}},t.sortOn=function(t,e,i){return void 0===i&&(i=0),16==i?t.sort(function(t,i){return t[e]-i[e]}):18==i?t.sort(function(t,i){return i[e]-t[e]}):t.sort(function(t,i){return t[e]-i[e]})},t.getFileNativePath=function(t){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+t},t.deleteFile=function(e,i,n,r,a){void 0===i&&(i=""),void 0===r&&(r=""),void 0===a&&(a=0);var s=t.getFileInfo(i),o=t.getFileNativePath(s.md5);t.fs.unlink({filePath:o,success:function(s){var o=""!=e;if(""!=e){var l=t.getFileNativePath(e);t.fs.copyFile({srcPath:e,destPath:l,success:function(a){t.onSaveFile(i,e,o,r,n,a.size)},fail:function(t){null!=n&&n.runWith([1,t])}})}else t.onSaveFile(i,e,o,r,n,a)},fail:function(t){}})},t.deleteAll=function(){var e=[];for(var i in t.filesListObj)e.push(t.filesListObj[i]);for(var n=1,r=e.length;n<r;n++){var a=e[n];t.deleteFile("",a.readyUrl)}},t.onSaveFile=function(e,i,n,r,a,o){void 0===n&&(n=!0),void 0===r&&(r=""),void 0===o&&(o=0);var l=e.split("?")[0];if(null==t.filesListObj.fileUsedSize&&(t.filesListObj.fileUsedSize=0),n)t.getFileNativePath(i),t.filesListObj[l]={md5:i,readyUrl:e,size:o,times:s.now(),encoding:r},t.filesListObj.fileUsedSize=parseInt(t.filesListObj.fileUsedSize)+o,t.writeFilesList(l,JSON.stringify(t.filesListObj),!0),null!=a&&a.runWith([0]);else if(t.filesListObj[l]){var h=parseInt(t.filesListObj[l].size);t.filesListObj.fileUsedSize=parseInt(t.filesListObj.fileUsedSize)-h,delete t.filesListObj[l],t.writeFilesList(l,JSON.stringify(t.filesListObj),!1),null!=a&&a.runWith([0])}},t.writeFilesList=function(e,i,n){var r=t.fileNativeDir+"/"+t.fileListName;t.fs.writeFile({filePath:r,encoding:"utf8",data:i,success:function(t){},fail:function(t){}}),!v.isZiYu&&v.isPosMsgYu&&wx.postMessage({url:e,data:t.filesListObj[e],isLoad:"filenative",isAdd:n})},t.getCacheUseSize=function(){return t.filesListObj&&t.filesListObj.fileUsedSize?t.filesListObj.fileUsedSize:0},t.existDir=function(e,i){t.fs.mkdir({dirPath:e,success:function(t){null!=i&&i.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?t.readSync(t.fileListName,"utf8",i):null!=i&&i.runWith([1,e])}})},t.readSync=function(e,i,n,r){void 0===i&&(i="ascill"),void 0===r&&(r="");var a,s=t.getFileNativePath(e);try{a=t.fs.readFileSync(s,i),null!=n&&n.runWith([0,{data:a}])}catch(t){null!=n&&n.runWith([1])}},t.setNativeFileDir=function(e){t.fileNativeDir=wx.env.USER_DATA_PATH+e},t.filesListObj={},t.fileNativeDir=null,t.fileListName="layaairfiles.txt",t.ziyuFileData={},t.loadPath="",t.DESCENDING=2,t.NUMERIC=16,n(t,["fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),t}(),x=function(){function t(){}return r(t,"laya.wx.mini.MiniImage"),t.prototype._loadImage=function(e){if(v.isZiYu)t.onCreateImage(e,this,!0);else{var i=!1;if(S.isLocalNativeFile(e)){if(-1!=e.indexOf("http://")||-1!=e.indexOf("../../../https@"))if(""!=S.loadPath)e=e.split(S.loadPath)[1];else{var n=""!=g.rootPath?g.rootPath:g.basePath;""!=n&&(e=e.split(n)[1])}}else i=!0,e=g.formatURL(e);S.getFileInfo(e)?t.onCreateImage(e,this,!i):-1!=e.indexOf("http://")||-1!=e.indexOf("../../../https@")?v.isZiYu?t.onCreateImage(e,this,!0):S.downOtherFiles(e,new h(t,t.onDownImgCallBack,[e,this]),e):t.onCreateImage(e,this,!0)}},t.onDownImgCallBack=function(e,i,n,r){void 0===r&&(r=""),n?i.onError(null):t.onCreateImage(e,i,!1,r)},t.onCreateImage=function(t,e,i,n){function r(){h.onload=null,h.onerror=null,delete e.imgCache[t]}var a;if(void 0===i&&(i=!1),void 0===n&&(n=""),v.autoCacheFile)if(i)a=t;else if(""!=n)a=n;else{var o=S.getFileInfo(t).md5;a=S.getFileNativePath(o)}else a=i?t:n;null==e.imgCache&&(e.imgCache={});var h,c=function(){r(),e._url=g.formatURL(e._url),e.onLoaded(h)},u=function(){r(),e.event("error","Load image failed")};"nativeimage"==e._type?((h=new s.window.Image).crossOrigin="",h.onload=c,h.onerror=u,h.src=a,e.imgCache[t]=h):new l.create(a,{onload:c,onerror:u,onCreate:function(i){h=i,e.imgCache[t]=i}})},t}(),E=function(){function e(){}return r(e,"laya.wx.mini.MiniInput"),e._createInputElement=function(){c._initInput(c.area=s.createElement("textarea")),c._initInput(c.input=s.createElement("input")),c.inputContainer=s.createElement("div"),c.inputContainer.style.position="absolute",c.inputContainer.style.zIndex=1e5,s.container.appendChild(c.inputContainer),c.inputContainer.setPos=function(t,e){c.inputContainer.style.left=t+"px",c.inputContainer.style.top=e+"px"},i.stage.on("resize",null,e._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(e){t.dispatchEvent&&t.dispatchEvent("resize")}),m._soundClass=C,m._musicClass=C;var n=v.systemInfo.model,r=v.systemInfo.system;-1!=n.indexOf("iPhone")&&(s.onIPhone=!0,s.onIOS=!0,s.onIPad=!0,s.onAndroid=!1),-1==r.indexOf("Android")&&-1==r.indexOf("Adr")||(s.onAndroid=!0,s.onIPhone=!1,s.onIOS=!1,s.onIPad=!1)},e._onStageResize=function(){i.stage._canvasTransform.identity().scale(s.width/d.canvas.width/f.getPixelRatio(),s.height/d.canvas.height/f.getPixelRatio())},e.wxinputFocus=function(t){var e=c.inputElement.target;e&&!e.editable||(v.window.wx.offKeyboardConfirm(),v.window.wx.offKeyboardInput(),v.window.wx.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:"done",success:function(t){},fail:function(t){}}),v.window.wx.onKeyboardConfirm(function(t){var i=t?t.value:"";e.text=i,e.event("input"),laya.wx.mini.MiniInput.inputEnter()}),v.window.wx.onKeyboardInput(function(t){var i=t?t.value:"";e.multiline||-1==i.indexOf("\n")?(e.text=i,e.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},e.inputEnter=function(){c.inputElement.target.focus=!1},e.wxinputblur=function(){e.hideKeyboard()},e.hideKeyboard=function(){v.window.wx.offKeyboardConfirm(),v.window.wx.offKeyboardInput(),v.window.wx.hideKeyboard({success:function(t){console.log("隐藏键盘")},fail:function(t){console.log("隐藏键盘出错:"+(t?t.errMsg:""))}})},e}(),T=function(){function t(){}return r(t,"laya.wx.mini.MiniLocalStorage"),t.__init__=function(){t.items=t},t.setItem=function(t,e){wx.setStorageSync(t,e)},t.getItem=function(t){return wx.getStorageSync(t)},t.setJSON=function(e,i){t.setItem(e,i)},t.getJSON=function(e){return t.getItem(e)},t.removeItem=function(t){wx.removeStorageSync(t)},t.clear=function(){wx.clearStorageSync()},t.getStorageInfoSync=function(){try{var t=wx.getStorageInfoSync();return console.log(t.keys),console.log(t.currentSize),console.log(t.limitSize),t}catch(t){}return null},t.support=!0,t.items=null,t}(),w=(function(){function t(){}r(t,"laya.wx.mini.MiniLocation"),t.__init__=function(){v.window.navigator.geolocation.getCurrentPosition=t.getCurrentPosition,v.window.navigator.geolocation.watchPosition=t.watchPosition,v.window.navigator.geolocation.clearWatch=t.clearWatch},t.getCurrentPosition=function(t,e,i){var n;(n={}).success=function(e){null!=t&&t(e)},n.fail=e,v.window.wx.getLocation(n)},t.watchPosition=function(e,n,r){var a;return t._curID++,(a={}).success=e,a.error=n,t._watchDic[t._curID]=a,i.timer.loop(1e3,null,t._myLoop),t._curID},t.clearWatch=function(e){delete t._watchDic[e],t._hasWatch()||i.timer.clear(null,t._myLoop)},t._hasWatch=function(){var e;for(e in t._watchDic)if(t._watchDic[e])return!0;return!1},t._myLoop=function(){t.getCurrentPosition(t._mySuccess,t._myError)},t._mySuccess=function(e){var i,n={};for(i in n.coords=e,n.timestamp=s.now(),t._watchDic)t._watchDic[i].success&&t._watchDic[i].success(n)},t._myError=function(e){var i;for(i in t._watchDic)t._watchDic[i].error&&t._watchDic[i].error(e)},t._watchDic={},t._curID=0}(),function(t){function e(){e.__super.call(this)}r(e,"laya.wx.mini.MiniAccelerator",t);var i=e.prototype;i.on=function(i,n,r,a){return t.prototype.on.call(this,i,n,r,a),e.startListen(this.onDeviceOrientationChange),this},i.off=function(i,n,r,a){return void 0===a&&(a=!1),this.hasListener(i)||e.stopListen(),t.prototype.off.call(this,i,n,r,a)},e.__init__=function(){try{var t;if(!(t=laya.device.motion.Accelerator))return;t.prototype.on=e.prototype.on,t.prototype.off=e.prototype.off}catch(t){}},e.startListen=function(t){if(e._callBack=t,!e._isListening){e._isListening=!0;try{wx.onAccelerometerChange(e.onAccelerometerChange)}catch(t){}}},e.stopListen=function(){e._isListening=!1;try{wx.stopAccelerometer({})}catch(t){}},e.onAccelerometerChange=function(t){var i;(i={}).acceleration=t,i.accelerationIncludingGravity=t,i.rotationRate={},null!=e._callBack&&e._callBack(i)},e._isListening=!1,e._callBack=null}(o),function(t){function e(){e.__super.call(this)}return r(e,"laya.wx.mini.MiniLoader",o),e.prototype.load=function(t,i,n,r,a){if(void 0===n&&(n=!0),void 0===a&&(a=!1),this._url=t,0===t.indexOf("data:image")?this._type=i="image":this._type=i||(i=this.getTypeFromUrl(t)),this._cache=n,this._data=null,!a&&u.loadedMap[g.formatURL(t)])return this._data=u.loadedMap[g.formatURL(t)],this.event("progress",1),void this.event("complete",this._data);if(null!=u.parserMap[i])return this._customParse=!0,void(u.parserMap[i]instanceof laya.utils.Handler?u.parserMap[i].runWith(this):u.parserMap[i].call(null,this));var s=v.getUrlEncode(t,i),o=y.getFileExtension(t);if(-1!=e._fileTypeArr.indexOf(o))v.EnvConfig.load.call(this,t,i,n,r,a);else{if(v.isZiYu&&S.ziyuFileData[t]){var l=S.ziyuFileData[t];return void this.onLoaded(l)}if(S.getFileInfo(t)){var c=S.getFileInfo(t);c.encoding=null==c.encoding?"ascii":c.encoding,S.readFile(t,c.encoding,new h(e,e.onReadNativeCallBack,[s,t,i,n,r,a,this]),t)}else{if(S.isLocalNativeFile(t))return void S.read(t,s,new h(e,e.onReadNativeCallBack,[s,t,i,n,r,a,this]));var _=t;-1!=(t=g.formatURL(t)).indexOf("http://")||-1!=t.indexOf("../../../https@")?v.EnvConfig.load.call(this,_,i,n,r,a):S.readFile(t,s,new h(e,e.onReadNativeCallBack,[s,t,i,n,r,a,this]),t)}}},e.onReadNativeCallBack=function(t,e,i,n,r,a,s,o,l){var h;(void 0===n&&(n=!0),void 0===a&&(a=!1),void 0===o&&(o=0),o)?1==o&&v.EnvConfig.load.call(s,e,i,n,r,a):(h="json"==i||"atlas"==i?v.getJson(l.data):"xml"==i?y.parseXMLFromString(l.data):l.data,!v.isZiYu&&v.isPosMsgYu&&"arraybuffer"!=i&&wx.postMessage({url:e,data:h,isLoad:"filedata"}),s.onLoaded(h))},n(e,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),e}()),C=function(t){function e(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,e.__super.call(this)}r(e,"laya.wx.mini.MiniSound",o);var i=e.prototype;return i.load=function(t){t=g.formatURL(t),this.url=t,this.readyUrl=t,e._audioCache[this.readyUrl]?this.event("complete"):v.autoCacheFile&&S.getFileInfo(t)?this.onDownLoadCallBack(t,0):v.autoCacheFile?S.downOtherFiles(t,h.create(this,this.onDownLoadCallBack,[t]),t):this.onDownLoadCallBack(t,0)},i.onDownLoadCallBack=function(t,i){if(i)this.event("error");else{var n;if(v.autoCacheFile){var r=S.getFileInfo(t).md5;n=S.getFileNativePath(r),this._sound=e._createSound(),this._sound.src=this.url=n}else this._sound=e._createSound(),this._sound.src=t;this._sound.onCanplay(e.bindToThis(this.onCanPlay,this)),this._sound.onError(e.bindToThis(this.onError,this))}},i.onError=function(t){try{console.log("-----1---------------minisound-----id:"+e._id),console.log(t)}catch(t){console.log("-----2---------------minisound-----id:"+e._id),console.log(t)}this.event("error"),this._sound.offError(null)},i.onCanPlay=function(){this.loaded=!0,this.event("complete"),e._audioCache[this.readyUrl]=this,this._sound.offCanplay(null)},i.play=function(t,i){var n;if(void 0===t&&(t=0),void 0===i&&(i=0),this.url==m._tMusic?(e._musicAudio||(e._musicAudio=e._createSound()),n=e._musicAudio):n=e._audioCache[this.readyUrl]?e._audioCache[this.readyUrl]._sound:e._createSound(),v.autoCacheFile&&S.getFileInfo(this.url)){var r=S.getFileInfo(this.url).md5;n.src=this.url=S.getFileNativePath(r)}else n.src=this.url;var a=new b(n,this);return a.url=this.url,a.loops=i,a.loop=0===i,a.startTime=t,a.play(),m.addChannel(a),a},i.dispose=function(){var t=e._audioCache[this.readyUrl];t&&(t.src="",t._sound&&(t._sound.destroy(),t._sound=null,t=null),delete e._audioCache[this.readyUrl])},a(0,i,"duration",function(){return this._sound.duration}),e._createSound=function(){return e._id++,v.window.wx.createInnerAudioContext()},e.bindToThis=function(t,e){return t.bind(e)},e._musicAudio=null,e._id=0,e._audioCache={},e}(),b=function(t){function e(t,i){this._audio=null,this._onEnd=null,this._miniSound=null,e.__super.call(this),this._audio=t,this._miniSound=i,this._onEnd=e.bindToThis(this.__onEnd,this),t.onEnded(this._onEnd)}r(e,"laya.wx.mini.MiniSoundChannel",p);var n=e.prototype;return n.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(i.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},n.play=function(){this.isStopped=!1,m.addChannel(this),this._audio.play()},n.stop=function(){this.isStopped=!0,m.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.pause(),this._audio.offEnded(null),this._audio=null,this._miniSound=null,this._onEnd=null)},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,m.addChannel(this),this._audio.play())},a(0,n,"autoplay",function(){return this._audio.autoplay},function(t){this._audio.autoplay=t}),a(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,n,"duration",function(){return this._audio?this._audio.duration:0}),a(0,n,"loop",function(){return this._audio.loop},function(t){this._audio.loop=t}),a(0,n,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),e.bindToThis=function(t,e){return t.bind(e)},e}()}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,a=i.getset,s=i.__newvec,o=laya.maths.Arith,l=laya.maths.Bezier,h=laya.resource.Bitmap,c=laya.utils.Browser,u=laya.utils.Byte,_=laya.utils.Color,d=(laya.filters.ColorFilter,i.Config),f=laya.resource.Context,p=(laya.events.Event,laya.filters.Filter),m=laya.display.Graphics,g=laya.resource.HTMLCanvas,y=(laya.utils.HTMLChar,laya.resource.HTMLImage),v=laya.resource.HTMLSubImage,S=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),x=laya.maths.Point,E=laya.maths.Rectangle,T=laya.renders.Render,w=(laya.renders.RenderContext,laya.renders.RenderSprite),C=laya.resource.Resource,b=laya.resource.ResourceManager,M=laya.utils.RunDriver,I=laya.display.Sprite,D=laya.display.Stage,A=laya.utils.Stat,R=laya.utils.StringKey,L=(laya.display.css.Style,laya.system.System),P=laya.display.Text,N=laya.resource.Texture,O=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),V=laya.utils.VectorGraphManager;laya.utils.WordText,i.interface("laya.webgl.shapes.IShape"),i.interface("laya.webgl.submit.ISubmit"),i.interface("laya.webgl.text.ICharSegment"),i.interface("laya.webgl.canvas.save.ISaveData"),i.interface("laya.webgl.resource.IMergeAtlasBitmap"),i.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var k=function(){function t(){}r(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;return i.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=function(t){},e.setValueMix=function(t){},e.apply3d=function(t,e,i,n,r){return null},e.apply=function(t){return null},a(0,e,"typeMix",function(){return 0}),t}(),F=function(){function t(){}return r(t,"laya.webgl.shader.ShaderValue"),t}(),B=function(){function t(t,e,n){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new i,void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this._cells=null,this._rowInfo=null,this._init(t,e),this._atlasID=n}var e,i;r(t,"laya.webgl.atlas.AtlasGrid");var n=t.prototype;return n.getAltasID=function(){return this._atlasID},n.setAltasID=function(t){t>=0&&(this._atlasID=t)},n.addTex=function(t,e,i){var n=this._get(e,i);return 0==n.ret?n:(this._fill(n.x,n.y,e,i,t),this._texCount++,n)},n._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},n._init=function(t,i){if(this._width=t,this._height=i,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=s(this._height);for(var n=0;n<this._height;n++)this._rowInfo[n]=new e;return this._clear(),!0},n._get=function(t,e){var i=new H;if(t>=this._failSize.width&&e>=this._failSize.height)return i;for(var n=-1,r=-1,a=this._width,s=this._height,o=this._cells,l=0;l<s;l++)if(!(this._rowInfo[l].spaceCount<t))for(var h=0;h<a;){var c=3*(l*a+h);if(0!=o[c]||o[c+1]<t||o[c+2]<e)h+=o[c+1];else{n=h,r=l;for(var u=0;u<t;u++)if(o[3*u+c+2]<e){n=-1;break}if(!(n<0))return i.ret=!0,i.x=n,i.y=r,i;h+=o[c+1]}}return i},n._fill=function(t,e,i,n,r){var a=this._width,s=this._height;this._check(t+i<=a&&e+n<=s);for(var o=e;o<n+e;++o){this._check(this._rowInfo[o].spaceCount>=i),this._rowInfo[o].spaceCount-=i;for(var l=0;l<i;l++){var h=3*(t+o*a+l);this._check(0==this._cells[h]),this._cells[h]=r,this._cells[h+1]=i,this._cells[h+2]=n}}if(t>0)for(o=0;o<n;++o){var c=0;for(l=t-1;l>=0&&0==this._cells[3*((e+o)*a+l)];--l,++c);for(l=c;l>0;--l)this._cells[3*((e+o)*a+t-l)+1]=l,this._check(l>0)}if(e>0)for(l=t;l<t+i;++l){for(c=0,o=e-1;o>=0&&0==this._cells[3*(l+o*a)];--o,c++);for(o=c;o>0;--o)this._cells[3*(l+(e-o)*a)+2]=o,this._check(o>0)}},n._check=function(t){0==t&&console.log("xtexMerger 错误啦")},n._clear=function(){this._texCount=0;for(var t=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var n=3*(e*this._width+i);this._cells[n]=0,this._cells[n+1]=this._width-i,this._cells[n+2]=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},t.__init$=function(){e=function(){function t(){this.spaceCount=0}return r(t,""),t}(),i=function(){function t(){this.width=0,this.height=0}return r(t,""),t}()},t}(),U=function(){function t(t,e,i,n){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=n,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}r(t,"laya.webgl.atlas.AtlasResourceManager");var e=t.prototype;return e.setAtlasParam=function(e,i,n,r){if(1==this._setAtlasParam)return t._sid_=0,this._width=e,this._height=i,this._gridSize=n,this._maxAtlaserCount=r,this._gridNumX=e/n,this._gridNumY=i/n,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},e.pushData=function(e){var i,n=e.bitmap,r=-1,a=null,s=0,o=0;for(s=0,i=this._atlaserArray.length;s<i&&(o=(this._curAtlasIndex+s)%i,-1==(r=(a=this._atlaserArray[o]).findBitmapIsExist(n)));s++);if(-1!=r){var l=a.InAtlasWebGLImagesOffsetValue[r];return p=l[0],m=l[1],a.addToAtlas(e,p,m),!0}this._setAtlasParam=!1;for(var h=Math.ceil((e.bitmap.width+2)/this._gridSize),c=Math.ceil((e.bitmap.height+2)/this._gridSize),u=!1,_=0;_<2;_++){var d=this._maxAtlaserCount;for(s=0;s<d;s++){o=(this._curAtlasIndex+s)%d,this._atlaserArray.length-1>=o||this._atlaserArray.push(new Mt(this._gridNumX,this._gridNumY,this._width,this._height,t._sid_++));var f=this._atlaserArray[o],p=0,m=0,g=f.addTex(1,h,c);if(g.ret){p=g.x*this._gridSize+1,m=g.y*this._gridSize+1,n.lock=!0,f.addToAtlasTexture(n,p,m),f.addToAtlas(e,p,m),u=!0,this._curAtlasIndex=o;break}}if(u)break;this._atlaserArray.push(new Mt(this._gridNumX,this._gridNumY,this._width,this._height,t._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return u||console.log(">>>AtlasManager pushData error"),u},e.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},e.garbageCollection=function(){if(!0===this._needGC){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;e<t;e++)this._atlaserArray[e].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+t),this._atlaserArray.splice(0,t),this._needGC=!1}return!0},e.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},e.getAtlaserCount=function(){return this._atlaserArray.length},e.getAtlaserByIndex=function(t){return this._atlaserArray[t]},a(1,t,"instance",function(){return t._Instance||(t._Instance=new t(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),t._Instance}),a(1,t,"enabled",function(){return d.atlasEnable}),a(1,t,"atlasLimitWidth",function(){return t._atlasLimitWidth},function(e){t._atlasLimitWidth=e}),a(1,t,"atlasLimitHeight",function(){return t._atlasLimitHeight},function(e){t._atlasLimitHeight=e}),t._enable=function(){d.atlasEnable=!0},t._disable=function(){d.atlasEnable=!1},t.__init__=function(){t.atlasTextureWidth=2048,t.atlasTextureHeight=2048,t.maxTextureCount=6,t.atlasLimitWidth=512,t.atlasLimitHeight=512},t._atlasLimitWidth=0,t._atlasLimitHeight=0,t.gridSize=16,t.atlasTextureWidth=0,t.atlasTextureHeight=0,t.maxTextureCount=0,t._atlasRestore=0,t.BOARDER_TYPE_NO=0,t.BOARDER_TYPE_RIGHT=1,t.BOARDER_TYPE_LEFT=2,t.BOARDER_TYPE_BOTTOM=4,t.BOARDER_TYPE_TOP=8,t.BOARDER_TYPE_ALL=15,t._sid_=0,t._Instance=null,t}(),H=function(){function t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return r(t,"laya.webgl.atlas.MergeFillInfo"),t}(),G=function(){function t(){}return r(t,"laya.webgl.canvas.BlendMode"),t._init_=function(e){t.fns=[t.BlendNormal,t.BlendAdd,t.BlendMultiply,t.BlendScreen,t.BlendOverlay,t.BlendLight,t.BlendMask,t.BlendDestinationOut],t.targetFns=[t.BlendNormalTarget,t.BlendAddTarget,t.BlendMultiplyTarget,t.BlendScreenTarget,t.BlendOverlayTarget,t.BlendLightTarget,t.BlendMask,t.BlendDestinationOut]},t.BlendNormal=function(t){t.blendFunc(1,771)},t.BlendAdd=function(t){t.blendFunc(1,772)},t.BlendMultiply=function(t){t.blendFunc(774,771)},t.BlendScreen=function(t){t.blendFunc(1,1)},t.BlendOverlay=function(t){t.blendFunc(1,769)},t.BlendLight=function(t){t.blendFunc(1,1)},t.BlendNormalTarget=function(t){t.blendFunc(1,771)},t.BlendAddTarget=function(t){t.blendFunc(1,772)},t.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},t.BlendScreenTarget=function(t){t.blendFunc(1,1)},t.BlendOverlayTarget=function(t){t.blendFunc(1,769)},t.BlendLightTarget=function(t){t.blendFunc(1,1)},t.BlendMask=function(t){t.blendFunc(0,770)},t.BlendDestinationOut=function(t){t.blendFunc(0,0)},t.activeBlendFunction=null,t.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],t.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},t.NORMAL="normal",t.ADD="add",t.MULTIPLY="multiply",t.SCREEN="screen",t.LIGHT="light",t.OVERLAY="overlay",t.DESTINATIONOUT="destination-out",t.fns=[],t.targetFns=[],t}(),W=function(){function t(t){this._color=_.create("black"),this.setValue(t)}r(t,"laya.webgl.canvas.DrawStyle");var e=t.prototype;return e.setValue=function(t){if(t){if("string"==typeof t)return void(this._color=_.create(t));if(t instanceof laya.utils.Color)return void(this._color=t)}},e.reset=function(){this._color=_.create("black")},e.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.Color&&this._color.numColor===t.numColor},e.toColorStr=function(){return this._color.strColor},t.create=function(e){var i;if(e&&("string"==typeof e?i=_.create(e):e instanceof laya.utils.Color&&(i=e),i))return i._drawStyle||(i._drawStyle=new t(e));return laya.webgl.canvas.DrawStyle.DEFAULT},n(t,["DEFAULT",function(){return this.DEFAULT=new t("#000000")}]),t}(),z=function(){function t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[],St.mainContext,this.ib=$t.create(35048),this.vb=Jt.create(5)}r(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.addPoint=function(t,e){this.tempArray.push(t,e)},e.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},e.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},e.polygon=function(t,e,i,n,r,a){var s;return this.geomatrys.push(this._curGeomatry=s=new Rt(t,e,i,n,r,a)),n||(s.fill=!1),void 0==a&&(s.borderWidth=0),s},e.setGeomtry=function(t){this.geomatrys.push(this._curGeomatry=t)},e.drawLine=function(t,e,i,n,r){var a;return this.closePath?this.geomatrys.push(this._curGeomatry=a=new At(t,e,i,n,r)):this.geomatrys.push(this._curGeomatry=a=new Dt(t,e,i,n,r)),a.fill=!1,a},e.update=function(){var t=this.ib._byteLength,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;i<e;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=e,this.count=(this.ib._byteLength-t)/pt.BYTES_PIDX},e.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},e.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},t}(),Y=function(){function t(){}r(t,"laya.webgl.canvas.save.SaveBase");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._dataObj[this._valueName]=this._value,t._cache[t._cache._length++]=this,this._newSubmit&&(e._curSubmit=at.RENDERBASE,e._renderKey=0)},t._createArray=function(){var t=[];return t._length=0,t},t._init=function(){var e=t._namemap={};return e[1]="ALPHA",e[2]="fillStyle",e[8]="font",e[256]="lineWidth",e[512]="strokeStyle",e[8192]="_mergeID",e[1024]=e[2048]=e[4096]=[],e[16384]="textBaseline",e[32768]="textAlign",e[65536]="_nBlendType",e[1048576]="shader",e[2097152]="filters",e},t.save=function(e,i,n,r){if((e._saveMark._saveuse&i)!==i){e._saveMark._saveuse|=i;var a=t._cache,s=a._length>0?a[--a._length]:new t;s._value=n[s._valueName=t._namemap[i]],s._dataObj=n,s._newSubmit=r;var o=e._save;o[o._length++]=s}},t._cache=laya.webgl.canvas.save.SaveBase._createArray(),t._namemap=t._init(),t}(),X=function(){function t(){this._clipRect=new E}r(t,"laya.webgl.canvas.save.SaveClipRect");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._clipRect=this._clipSaveRect,t._cache[t._cache._length++]=this,this._submitScissor.submitLength=e._submits._length-this._submitScissor.submitIndex,e._curSubmit=at.RENDERBASE,e._renderKey=0},t.save=function(e,i){if(131072!=(131072&e._saveMark._saveuse)){e._saveMark._saveuse|=131072;var n=t._cache,r=n._length>0?n[--n._length]:new t;r._clipSaveRect=e._clipRect,e._clipRect=r._clipRect.copyFrom(e._clipRect),r._submitScissor=i;var a=e._save;a[a._length++]=r}},n(t,["_cache",function(){return this._cache=Y._createArray()}]),t}(),j=function(){function t(){this._contextX=0,this._contextY=0,this._clipRect=new E,this._rect=new E,this._matrix=new S}r(t,"laya.webgl.canvas.save.SaveClipRectStencil");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){ct.restore(e,this._rect,this._saveMatrix,this._contextX,this._contextY),e._clipRect=this._clipSaveRect,e._curMat=this._saveMatrix,e._x=this._contextX,e._y=this._contextY,t._cache[t._cache._length++]=this,e._curSubmit=at.RENDERBASE},t.save=function(e,i,n,r,a,s,o,l,h,c){if(262144!=(262144&e._saveMark._saveuse)){e._saveMark._saveuse|=262144;var u=t._cache,_=u._length>0?u[--u._length]:new t;_._clipSaveRect=e._clipRect,_._clipRect.setTo(o,l,h,c),e._clipRect=_._clipRect,_._rect.x=n,_._rect.y=r,_._rect.width=a,_._rect.height=s,_._contextX=e._x,_._contextY=e._y,_._saveMatrix=e._curMat,e._curMat.copyTo(_._matrix),e._curMat=_._matrix,_._submitStencil=i;var d=e._save;d[d._length++]=_}},n(t,["_cache",function(){return this._cache=Y._createArray()}]),t}(),K=function(){function t(){this._saveuse=0}r(t,"laya.webgl.canvas.save.SaveMark");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!0},e.restore=function(e){e._saveMark=this._preSaveMark,t._no[t._no._length++]=this},t.Create=function(e){var i=t._no,n=i._length>0?i[--i._length]:new t;return n._saveuse=0,n._preSaveMark=e._saveMark,e._saveMark=n,n},n(t,["_no",function(){return this._no=Y._createArray()}]),t}(),q=function(){function t(){this._matrix=new S}r(t,"laya.webgl.canvas.save.SaveTransform");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat=this._savematrix,t._no[t._no._length++]=this},t.save=function(e){var i=e._saveMark;if(2048!=(2048&i._saveuse)){i._saveuse|=2048;var n=t._no,r=n._length>0?n[--n._length]:new t;r._savematrix=e._curMat,e._curMat=e._curMat.copyTo(r._matrix);var a=e._save;a[a._length++]=r}},n(t,["_no",function(){return this._no=Y._createArray()}]),t}(),Z=function(){function t(){}r(t,"laya.webgl.canvas.save.SaveTranslate");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat,e._x=this._x,e._y=this._y,t._no[t._no._length++]=this},t.save=function(e){var i=t._no,n=i._length>0?i[--i._length]:new t;n._x=e._x,n._y=e._y;var r=e._save;r[r._length++]=n},n(t,["_no",function(){return this._no=Y._createArray()}]),t}(),Q=function(){function t(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new E}r(t,"laya.webgl.resource.RenderTargetMAX");var e=t.prototype;return e.setSP=function(t){this._sp=t},e.size=function(t,e){var n=this;this._width!==t||this._height!==e?(this.repaint=!0,this._width=t,this._height=e,this.target?this.target.size(t,e):this.target=Vt.create(t,e),this.target.hasListener("recovered")||this.target.on("recovered",this,function(t){i.timer.callLater(n._sp,n._sp.repaint)})):this.target.size(t,e)},e._flushToTarget=function(t,e){if(!e._destroy){var i=yt.worldScissorTest,n=yt.worldClipRect;yt.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,yt.worldScissorTest=!1,St.mainContext.disable(3089);var r=yt.worldAlpha,a=yt.worldMatrix4,s=yt.worldMatrix,o=yt.worldFilters,l=yt.worldShaderDefines;if(yt.worldMatrix=S.EMPTY,yt.restoreTempArray(),yt.worldMatrix4=yt.TEMPMAT4_ARRAY,yt.worldAlpha=1,yt.worldFilters=null,yt.worldShaderDefines=null,Ot.activeShader=null,e.start(),d.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),Ot.activeShader=null,yt.worldAlpha=r,yt.worldMatrix4=a,yt.worldMatrix=s,yt.worldFilters=o,yt.worldShaderDefines=l,yt.worldScissorTest=i,i){var h=yt.height-n.y-n.height;St.mainContext.scissor(n.x,h,n.width,n.height),St.mainContext.enable(3089)}yt.worldClipRect=n}},e.flush=function(t){this.repaint&&(this._flushToTarget(t,this.target),this.repaint=!1)},e.drawTo=function(t,e,i,n,r){t.drawTexture(this.target.getTexture(),e,i,n,r,0,0)},e.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},t}(),$=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new It}return r(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},t.__init__=function(){var t,e;Kt.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),Kt.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),Kt.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Kt.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),Kt.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),Kt.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Kt.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),Kt.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Kt.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",e='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',Kt.preCompile2D(0,2,t,e,null),t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",Kt.preCompile2D(0,4,t,e,null),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Kt.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Kt.preCompile2D(0,512,t,e,null)},t}(),J=function(){function t(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}r(t,"laya.webgl.shader.ShaderDefines");var e=t.prototype;return e.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},e.addInt=function(t){return this._value|=t,this._value},e.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},e.isDefine=function(t){return(this._value&t)===t},e.getValue=function(){return this._value},e.setValue=function(t){this._value=t},e.toNameDic=function(){return this._int2nameMap[this._value]||t._toText(this._value,this._int2name,this._int2nameMap)},t._reg=function(t,e,i,n){i[t]=e,n[e]=t},t._toText=function(t,e,i){var n=i[t];if(n)return n;for(var r={},a=1,s=0;s<32&&!((a=1<<s)>t);s++)if(t&a){var o=e[a];o&&(r[o]="")}return i[t]=r,r},t._toInt=function(t,e){for(var i=t.split("."),n=0,r=0,a=i.length;r<a;r++){var s=e[i[r]];if(!s)throw new Error("Defines to int err:"+t+"/"+i[r]);n|=s}return n},t}(),tt=function(){function t(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new S}r(t,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var e=t.prototype;return e.init=function(e,i,n){if(i)this._vs=i;else{this._vs=[];var r=e.width,a=e.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(r,0,1,0,1,1,1,1),this._vs.push(r,a,1,1,1,1,1,1),this._vs.push(0,a,0,1,1,1,1,1)}n?this._ps=n:(t._defaultPS||(t._defaultPS=[]).push(0,1,3,3,1,2),this._ps=t._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=e},e.init2=function(t,e,i,n,r){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=n,this._uvs=r,this.mEleNum=this._ps.length,this.mTexture=t,(T.isConchNode||T.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},e._initMyData=function(){var e=0,i=0,n=4*this._verticles.length;this._vs=t._tempVS;var r=!1;if(T.isConchNode||T.isConchApp?(this._vs.length=n,r=!0):this._vs.length<n&&(this._vs.length=n,r=!0),t._tVSLen=n,r)for(;e<n;)this._vs[e]=this._verticles[i],this._vs[e+1]=this._verticles[i+1],this._vs[e+2]=this._uvs[i],this._vs[e+3]=this._uvs[i+1],this._vs[e+4]=1,this._vs[e+5]=1,this._vs[e+6]=1,this._vs[e+7]=1,e+=8,i+=2;else for(;e<n;)this._vs[e]=this._verticles[i],this._vs[e+1]=this._verticles[i+1],this._vs[e+2]=this._uvs[i],this._vs[e+3]=this._uvs[i+1],e+=8,i+=2},e.getData2=function(e,i,n){var r;this.mVBBuffer=e,this.mIBBuffer=i,this._initMyData(),e.appendEx2(this._vs,Float32Array,t._tVSLen,4),this._indexStart=i._byteLength,(r=t._tempIB).length<this._ps.length&&(r.length=this._ps.length);for(var a=0,s=this._ps.length;a<s;a++)r[a]=this._ps[a]+n;i.appendEx2(r,Uint16Array,this._ps.length,2)},e.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e._byteLength,this.mIBData.start!=i){for(var n=0,r=this._ps.length;n<r;n++)this.mIBData[n]=this._ps[n]+i;this.mIBData.start=i}e.append(this.mIBData)},e.render=function(t,e,i){if(T.isWebGL&&this.mTexture){t._renderKey=0,t._shader2D.glTexture=null,et.getInstance().addSkinMesh(this);var n=at.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,wt.create(512,0));this.transform||(this.transform=S.EMPTY),this.transform.translate(e,i),S.mul(this.transform,t._curMat,this._tempMatrix),this.transform.translate(-e,-i);var r=n.shaderValue,a=r.u_mmat2||yt.getMatrArray();yt.mat2MatArray(this._tempMatrix,a),r.textureHost=this.mTexture,r.offsetX=0,r.offsetY=0,r.u_mmat2=a,r.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=n}else T.isConchApp&&this.mTexture&&(this.transform||(this.transform=S.EMPTY),t.setSkinMesh&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},t._tempVS=[],t._tempIB=[],t._defaultPS=null,t._tVSLen=0,t}(),et=function(){function t(){this.ib=null,this.vb=null,St.mainContext,this.ib=$t.create(35048),this.vb=Jt.create(8)}r(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),it=function(){function t(t,e,i,n,r,a,s,o,l){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===l&&(l=0),this.x=t,this.y=e,this.width=i,this.height=n,this.edges=r,this.color=a,this.borderWidth=s,this.borderColor=o}r(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;return i.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.rebuild=function(t){},e.setMatrix=function(t){},e.needUpdate=function(t){return!0},e.sector=function(t,e,i){var n=this.x,r=this.y,a=this.edges,s=(this.r1-this.r0)/a,o=this.width,l=this.height,h=this.color,c=(h>>16&255)/255,u=(h>>8&255)/255,_=(255&h)/255;t.push(n,r,c,u,_);for(var d=0;d<a+1;d++)t.push(n+Math.sin(s*d+this.r0)*o,r+Math.cos(s*d+this.r0)*l),t.push(c,u,_);for(d=0;d<a;d++)e.push(i,i+d+1,i+d+2)},e.createLine2=function(t,e,i,n,r,a){var s,o,l,h,c,u,_,d,f,p,m,g,y,v,S,x,E,T,w,C,b=t.concat(),M=r,I=this.borderColor,D=(I>>16&255)/255,A=(I>>8&255)/255,R=(255&I)/255,L=b.length/2,P=n,N=i/2;l=b[0],h=b[1],p=l-(c=b[2]),f=(f=-(h-(u=b[3])))/(C=Math.sqrt(f*f+p*p))*N,p=p/C*N,M.push(l-f+this.x,h-p+this.y,D,A,R,l+f+this.x,h+p+this.y,D,A,R);for(var O=1;O<L-1;O++)l=b[2*(O-1)],h=b[2*(O-1)+1],c=b[2*O],u=b[2*O+1],_=b[2*(O+1)],d=b[2*(O+1)+1],p=l-c,g=c-_,S=(-(f=(f=-(h-u))/(C=Math.sqrt(f*f+p*p))*N)+l)*(-(p=p/C*N)+u)-(-f+c)*(-p+h),T=(-(m=(m=-(u-d))/(C=Math.sqrt(m*m+g*g))*N)+_)*(-(g=g/C*N)+u)-(-m+c)*(-g+d),w=(y=-p+h-(-p+u))*(E=-m+c-(-m+_))-(x=-g+d-(-g+u))*(v=-f+c-(-f+l)),Math.abs(w)<.1?(w+=10.1,M.push(c-f+this.x,u-p+this.y,D,A,R,c+f+this.x,u+p+this.y,D,A,R)):(s=(v*T-E*S)/w,o=(x*S-y*T)/w,M.push(s+this.x,o+this.y,D,A,R,c-(s-c)+this.x,u-(o-u)+this.y,D,A,R));l=b[b.length-4],h=b[b.length-3],p=l-(c=b[b.length-2]),f=(f=-(h-(u=b[b.length-1])))/(C=Math.sqrt(f*f+p*p))*N,p=p/C*N,M.push(c-f+this.x,u-p+this.y,D,A,R,c+f+this.x,u+p+this.y,D,A,R);var V=a;for(O=1;O<V;O++)e.push(P+2*(O-1),P+2*(O-1)+1,P+2*O+1,P+2*O+1,P+2*O,P+2*(O-1));return M},e.createLine=function(t,e,i,n){var r=t.concat(),a=t,s=this.borderColor,o=(s>>16&255)/255,l=(s>>8&255)/255,h=(255&s)/255;r.splice(0,5);var c,u,_,d,f,p,m,g,y,v,S,x,E,T,w,C,b,M,I,D,A=r.length/5,R=n,L=i/2;_=r[0],d=r[1],v=_-(f=r[5]),y=(y=-(d-(p=r[6])))/(D=Math.sqrt(y*y+v*v))*L,v=v/D*L,a.push(_-y,d-v,o,l,h,_+y,d+v,o,l,h);for(var P=1;P<A-1;P++)_=r[5*(P-1)],d=r[5*(P-1)+1],f=r[5*P],p=r[5*P+1],m=r[5*(P+1)],g=r[5*(P+1)+1],v=_-f,x=f-m,w=(-(y=(y=-(d-p))/(D=Math.sqrt(y*y+v*v))*L)+_)*(-(v=v/D*L)+p)-(-y+f)*(-v+d),M=(-(S=(S=-(p-g))/(D=Math.sqrt(S*S+x*x))*L)+m)*(-(x=x/D*L)+p)-(-S+f)*(-x+g),I=(E=-v+d-(-v+p))*(b=-S+f-(-S+m))-(C=-x+g-(-x+p))*(T=-y+f-(-y+_)),Math.abs(I)<.1?(I+=10.1,a.push(f-y,p-v,o,l,h,f+y,p+v,o,l,h)):(c=(T*M-b*w)/I,u=(C*w-E*M)/I,a.push(c,u,o,l,h,f-(c-f),p-(u-p),o,l,h));_=r[r.length-10],d=r[r.length-9],v=_-(f=r[r.length-5]),y=(y=-(d-(p=r[r.length-4])))/(D=Math.sqrt(y*y+v*v))*L,v=v/D*L,a.push(f-y,p-v,o,l,h,f+y,p+v,o,l,h);var N=this.edges+1;for(P=1;P<N;P++)e.push(R+2*(P-1),R+2*(P-1)+1,R+2*P+1,R+2*P+1,R+2*P,R+2*(P-1));return a},e.createLoopLine=function(t,e,i,n,r,a){var s=t.concat(),o=r||t,l=this.borderColor,h=(l>>16&255)/255,c=(l>>8&255)/255,u=(255&l)/255;s.splice(0,5);var _=[s[0],s[1]],d=[s[s.length-5],s[s.length-4]],f=d[0]+.5*(_[0]-d[0]),p=d[1]+.5*(_[1]-d[1]);s.unshift(f,p,0,0,0),s.push(f,p,0,0,0);var m,g,y,v,S,x,E,T,w,C,b,M,I,D,A,R,L,P,N,O,V=s.length/5,k=n,F=i/2;y=s[0],v=s[1],C=y-(S=s[5]),w=(w=-(v-(x=s[6])))/(O=Math.sqrt(w*w+C*C))*F,C=C/O*F,o.push(y-w,v-C,h,c,u,y+w,v+C,h,c,u);for(var B=1;B<V-1;B++)y=s[5*(B-1)],v=s[5*(B-1)+1],S=s[5*B],x=s[5*B+1],E=s[5*(B+1)],T=s[5*(B+1)+1],C=y-S,M=S-E,A=(-(w=(w=-(v-x))/(O=Math.sqrt(w*w+C*C))*F)+y)*(-(C=C/O*F)+x)-(-w+S)*(-C+v),P=(-(b=(b=-(x-T))/(O=Math.sqrt(b*b+M*M))*F)+E)*(-(M=M/O*F)+x)-(-b+S)*(-M+T),N=(I=-C+v-(-C+x))*(L=-b+S-(-b+E))-(R=-M+T-(-M+x))*(D=-w+S-(-w+y)),Math.abs(N)<.1?(N+=10.1,o.push(S-w,x-C,h,c,u,S+w,x+C,h,c,u)):(m=(D*P-L*A)/N,g=(R*A-I*P)/N,o.push(m,g,h,c,u,S-(m-S),x-(g-x),h,c,u));a&&(e=a);var U=this.edges+1;for(B=1;B<U;B++)e.push(k+2*(B-1),k+2*(B-1)+1,k+2*B+1,k+2*B+1,k+2*B,k+2*(B-1));return e.push(k+2*(B-1),k+2*(B-1)+1,k+1,k+1,k,k+2*(B-1)),o},t}(),nt=function(){function t(){}return r(t,"laya.webgl.shapes.Earcut"),t.earcut=function(e,i,n){n=n||2;var r,a,s,o,l,h,c,u=i&&i.length,_=u?i[0]*n:e.length,d=t.linkedList(e,0,_,n,!0),f=[];if(!d)return f;if(u&&(d=t.eliminateHoles(e,i,d,n)),e.length>80*n){r=s=e[0],a=o=e[1];for(var p=n;p<_;p+=n)l=e[p],h=e[p+1],l<r&&(r=l),h<a&&(a=h),l>s&&(s=l),h>o&&(o=h);c=0!==(c=Math.max(s-r,o-a))?1/c:0}return t.earcutLinked(d,f,n,r,a,c),f},t.linkedList=function(e,i,n,r,a){var s,o;if(a===t.signedArea(e,i,n,r)>0)for(s=i;s<n;s+=r)o=t.insertNode(s,e[s],e[s+1],o);else for(s=n-r;s>=i;s-=r)o=t.insertNode(s,e[s],e[s+1],o);return o&&t.equals(o,o.next)&&(t.removeNode(o),o=o.next),o},t.filterPoints=function(e,i){if(!e)return e;i||(i=e);var n,r=e;do{if(n=!1,r.steiner||!t.equals(r,r.next)&&0!==t.area(r.prev,r,r.next))r=r.next;else{if(t.removeNode(r),(r=i=r.prev)===r.next)break;n=!0}}while(n||r!==i);return i},t.earcutLinked=function(e,i,n,r,a,s,o){if(e){!o&&s&&t.indexCurve(e,r,a,s);for(var l,h,c=e;e.prev!==e.next;)if(l=e.prev,h=e.next,s?t.isEarHashed(e,r,a,s):t.isEar(e))i.push(l.i/n),i.push(e.i/n),i.push(h.i/n),t.removeNode(e),e=h.next,c=h.next;else if((e=h)===c){o?1===o?(e=t.cureLocalIntersections(e,i,n),t.earcutLinked(e,i,n,r,a,s,2)):2===o&&t.splitEarcut(e,i,n,r,a,s):t.earcutLinked(t.filterPoints(e,null),i,n,r,a,s,1);break}}},t.isEar=function(e){var i=e.prev,n=e,r=e.next;if(t.area(i,n,r)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(t.pointInTriangle(i.x,i.y,n.x,n.y,r.x,r.y,a.x,a.y)&&t.area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0},t.isEarHashed=function(e,i,n,r){var a=e.prev,s=e,o=e.next;if(t.area(a,s,o)>=0)return!1;for(var l=a.x<s.x?a.x<o.x?a.x:o.x:s.x<o.x?s.x:o.x,h=a.y<s.y?a.y<o.y?a.y:o.y:s.y<o.y?s.y:o.y,c=a.x>s.x?a.x>o.x?a.x:o.x:s.x>o.x?s.x:o.x,u=a.y>s.y?a.y>o.y?a.y:o.y:s.y>o.y?s.y:o.y,_=t.zOrder(l,h,i,n,r),d=t.zOrder(c,u,i,n,r),f=e.nextZ;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&t.pointInTriangle(a.x,a.y,s.x,s.y,o.x,o.y,f.x,f.y)&&t.area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=e.prevZ;f&&f.z>=_;){if(f!==e.prev&&f!==e.next&&t.pointInTriangle(a.x,a.y,s.x,s.y,o.x,o.y,f.x,f.y)&&t.area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0},t.cureLocalIntersections=function(e,i,n){var r=e;do{var a=r.prev,s=r.next.next;!t.equals(a,s)&&t.intersects(a,r,r.next,s)&&t.locallyInside(a,s)&&t.locallyInside(s,a)&&(i.push(a.i/n),i.push(r.i/n),i.push(s.i/n),t.removeNode(r),t.removeNode(r.next),r=e=s),r=r.next}while(r!==e);return r},t.splitEarcut=function(e,i,n,r,a,s){var o=e;do{for(var l=o.next.next;l!==o.prev;){if(o.i!==l.i&&t.isValidDiagonal(o,l)){var h=t.splitPolygon(o,l);return o=t.filterPoints(o,o.next),h=t.filterPoints(h,h.next),t.earcutLinked(o,i,n,r,a,s),void t.earcutLinked(h,i,n,r,a,s)}l=l.next}o=o.next}while(o!==e)},t.eliminateHoles=function(e,i,n,r){var a,s,o,l,h,c=[];for(a=0,s=i.length;a<s;a++)o=i[a]*r,l=a<s-1?i[a+1]*r:e.length,(h=t.linkedList(e,o,l,r,!1))===h.next&&(h.steiner=!0),c.push(t.getLeftmost(h));for(c.sort(t.compareX),a=0;a<c.length;a++)t.eliminateHole(c[a],n),n=t.filterPoints(n,n.next);return n},t.compareX=function(t,e){return t.x-e.x},t.eliminateHole=function(e,i){if(i=t.findHoleBridge(e,i)){var n=t.splitPolygon(i,e);t.filterPoints(n,n.next)}},t.findHoleBridge=function(e,i){var n,r=i,a=e.x,s=e.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var l=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(l<=a&&l>o){if(o=l,l===a){if(s===r.y)return r;if(s===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==i);if(!n)return null;if(a===o)return n.prev;var h,c=n,u=n.x,_=n.y,d=1/0;for(r=n.next;r!==c;)a>=r.x&&r.x>=u&&a!==r.x&&t.pointInTriangle(s<_?a:o,s,u,_,s<_?o:a,s,r.x,r.y)&&((h=Math.abs(s-r.y)/(a-r.x))<d||h===d&&r.x>n.x)&&t.locallyInside(r,e)&&(n=r,d=h),r=r.next;return n},t.indexCurve=function(e,i,n,r){var a=e;do{null===a.z&&(a.z=t.zOrder(a.x,a.y,i,n,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,t.sortLinked(a)},t.sortLinked=function(t){var e,i,n,r,a,s,o,l,h=1;do{for(i=t,t=null,a=null,s=0;i;){for(s++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ);e++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,h*=2}while(s>1);return t},t.zOrder=function(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},t.getLeftmost=function(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i},t.pointInTriangle=function(t,e,i,n,r,a,s,o){return(r-s)*(e-o)-(t-s)*(a-o)>=0&&(t-s)*(n-o)-(i-s)*(e-o)>=0&&(i-s)*(a-o)-(r-s)*(n-o)>=0},t.isValidDiagonal=function(e,i){return e.next.i!==i.i&&e.prev.i!==i.i&&!t.intersectsPolygon(e,i)&&t.locallyInside(e,i)&&t.locallyInside(i,e)&&t.middleInside(e,i)},t.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},t.equals=function(t,e){return t.x===e.x&&t.y===e.y},t.intersects=function(e,i,n,r){return!!(t.equals(e,i)&&t.equals(n,r)||t.equals(e,r)&&t.equals(n,i))||t.area(e,i,n)>0!=t.area(e,i,r)>0&&t.area(n,r,e)>0!=t.area(n,r,i)>0},t.intersectsPolygon=function(e,i){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==i.i&&n.next.i!==i.i&&t.intersects(n,n.next,e,i))return!0;n=n.next}while(n!==e);return!1},t.locallyInside=function(e,i){return t.area(e.prev,e,e.next)<0?t.area(e,i,e.next)>=0&&t.area(e,e.prev,i)>=0:t.area(e,i,e.prev)<0||t.area(e,e.next,i)<0},t.middleInside=function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n},t.splitPolygon=function(t,e){var i=new rt(t.i,t.x,t.y),n=new rt(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n},t.insertNode=function(t,e,i,n){var r=new rt(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r},t.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},t.signedArea=function(t,e,i,n){for(var r=0,a=e,s=i-n;a<i;a+=n)r+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return r},t}(),rt=function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return r(t,"laya.webgl.shapes.EarcutNode"),t}(),at=(function(){function t(t,e,i,n,r,a,s){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=n,this.fillAlpha=r,this.shape=s,this.fill=a}r(t,"laya.webgl.shapes.GeometryData");var e=t.prototype;e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.getIndexData=function(){return null},e.getVertexData=function(){return null},e.destroy=function(){this.shape=null}}(),function(){function t(t){t instanceof Float32Array?this.points=t:t instanceof Array&&(t.length,this.points=new Float32Array(t))}r(t,"laya.webgl.shapes.Vertex");var e=t.prototype;i.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.needUpdate=function(t){return!1},e.rebuild=function(t){},e.setMatrix=function(t){}}(),function(){function t(t){void 0===t&&(t=1e4),this._renderType=t}r(t,"laya.webgl.submit.Submit");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){var e=t._cache;e[e._length++]=this,this.shaderValue.release(),this._vb=null},e.getRenderType=function(){return this._renderType},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=St.mainContext;return this.shaderValue.upload(),G.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),G.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this._startIdx),1},t.__init__=function(){var e=t.RENDERBASE=new t(-1);e.shaderValue=new wt(0,0),e.shaderValue.ALPHA=-1234},t.createSubmit=function(e,i,n,r,a){var s=t._cache._length?t._cache[--t._cache._length]:new t;null==n&&((n=s._selfVb||(s._selfVb=Jt.create(-1))).clear(),r=0),s._ib=i,s._vb=n,s._startIdx=r*pt.BYTES_PIDX,s._numEle=0;var o=e._nBlendType;s._blendFn=e._targets?G.targetFns[o]:G.fns[o],s.shaderValue=a,s.shaderValue.setValue(e._shader2D);var l=e._shader2D.filters;return l&&s.shaderValue.setFilters(l),s},t.createShape=function(e,i,n,r,a,s){var o=t._cache._length?t._cache[--t._cache._length]:new t;o._ib=i,o._vb=n,o._numEle=r,o._startIdx=a,o.shaderValue=s,o.shaderValue.setValue(e._shader2D);var l=e._nBlendType;return o._blendFn=e._targets?G.targetFns[l]:G.fns[l],o},t.TYPE_2D=1e4,t.TYPE_CANVAS=10003,t.TYPE_CMDSETRT=10004,t.TYPE_CUSTOM=10005,t.TYPE_BLURRT=10006,t.TYPE_CMDDESTORYPRERT=10007,t.TYPE_DISABLESTENCIL=10008,t.TYPE_OTHERIBVB=10009,t.TYPE_PRIMITIVE=10010,t.TYPE_RT=10011,t.TYPE_BLUR_RT=10012,t.TYPE_TARGET=10013,t.TYPE_CHANGE_VALUE=10014,t.TYPE_SHAPE=10015,t.TYPE_TEXTURE=10016,t.TYPE_FILLTEXTURE=10017,t.RENDERBASE=null,t._cache=(t._cache=[],t._cache._length=0,t._cache),t}()),st=function(){function t(){this.fun=null,this.args=null}r(t,"laya.webgl.submit.SubmitCMD");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){return this.fun.apply(null,this.args),1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this},t.create=function(e,i){var n=t._cache._length?t._cache[--t._cache._length]:new t;return n.fun=i,n.args=e,n},t._cache=(t._cache=[],t._cache._length=0,t._cache),t}(),ot=function(){function t(){this.variables={}}r(t,"laya.webgl.submit.SubmitCMDScope");var e=t.prototype;return e.getValue=function(t){return this.variables[t]},e.addValue=function(t,e){return this.variables[t]=e},e.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},e.clear=function(){for(var t in this.variables)delete this.variables[t]},e.recycle=function(){this.clear(),t.POOL.push(this)},t.create=function(){var e=t.POOL.pop();return e||(e=new t),e},t.POOL=[],t}(),lt=function(){function t(){this.offset=0,this.startIndex=0,this._mat=S.create()}r(t,"laya.webgl.submit.SubmitOtherIBVB");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){var e=t._cache;e[e._length++]=this},e.getRenderType=function(){return 10009},e.renderSubmit=function(){var e=this._shaderValue.textureHost;if(e){var i=e.source;if(!e.bitmap||!i)return 1;this._shaderValue.texture=i}this._vb.bind_upload(this._ib);var n=yt.worldMatrix4,r=S.TEMP;S.mulPre(this._mat,n[0],n[1],n[4],n[5],n[12],n[13],r);var a=yt.worldMatrix4=t.tempMatrix4;a[0]=r.a,a[1]=r.b,a[4]=r.c,a[5]=r.d,a[12]=r.tx,a[13]=r.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var s=St.mainContext;return G.activeBlendFunction!==this._blendFn&&(s.enable(3042),this._blendFn(s),G.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,s.drawElements(4,this._numEle,5123,this.startIndex),yt.worldMatrix4=n,Ot.activeShader=null,1},t.create=function(e,i,n,r,a,s,o,l,h){void 0===h&&(h=0);var c=t._cache._length?t._cache[--t._cache._length]:new t;c._ib=n,c._vb=i,c._numEle=r,c._shader=a,c._shaderValue=s;var u=e._nBlendType;switch(c._blendFn=e._targets?G.targetFns[u]:G.fns[u],h){case 0:c.offset=0,c.startIndex=l/(pt.BYTES_PE*i.vertexStride)*1.5,c.startIndex*=pt.BYTES_PIDX;break;case 1:c.startIndex=o,c.offset=l}return c},t._cache=(t._cache=[],t._cache._length=0,t._cache),t.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t}(),ht=function(){function t(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new E,this.screenRect=new E}r(t,"laya.webgl.submit.SubmitScissor");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e._scissor=function(t,e,i,n){var r=yt.worldMatrix4,a=r[0],s=r[5];if(t=t*a+r[12],e=e*s+r[13],n*=s,(i*=a)<1||n<1)return!1;var o=t+i,l=e+n;t<0&&(i=o-(t=0)),e<0&&(n=l-(e=0));var h=yt.worldClipRect;if(t=Math.max(t,h.x),e=Math.max(e,h.y),i=Math.min(o,h.right)-t,n=Math.min(l,h.bottom)-e,i<1||n<1)return!1;var c=yt.worldScissorTest;return this.screenRect.copyFrom(h),h.x=t,h.y=e,h.width=i,h.height=n,yt.worldScissorTest=!0,e=yt.height-e-n,St.mainContext.scissor(t,e,i,n),St.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),c?(e=yt.height-this.screenRect.y-this.screenRect.height,St.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),St.mainContext.enable(3089)):(St.mainContext.disable(3089),yt.worldScissorTest=!1),h.copyFrom(this.screenRect),!0},e._scissorWithTagart=function(t,e,i,n){if(i<1||n<1)return!1;var r=t+i,a=e+n;t<0&&(i=r-(t=0)),e<0&&(n=a-(e=0));var s=yt.worldClipRect;if(t=Math.max(t,s.x),e=Math.max(e,s.y),i=Math.min(r,s.right)-t,n=Math.min(a,s.bottom)-e,i<1||n<1)return!1;var o=yt.worldScissorTest;return this.screenRect.copyFrom(s),yt.worldScissorTest=!0,s.x=t,s.y=e,s.width=i,s.height=n,e=yt.height-e-n,St.mainContext.scissor(t,e,i,n),St.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),o?(e=yt.height-this.screenRect.y-this.screenRect.height,St.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),St.mainContext.enable(3089)):(St.mainContext.disable(3089),yt.worldScissorTest=!1),s.copyFrom(this.screenRect),!0},e.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1?this.submitLength+1:(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height),this.submitLength+1)},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this,this.context=null},t.create=function(e){var i=t._cache._length?t._cache[--t._cache._length]:new t;return i.context=e,i},t._cache=(t._cache=[],t._cache._length=0,t._cache),t}(),ct=function(){function t(){this.step=0,this.blendMode=null,this.level=0}r(t,"laya.webgl.submit.SubmitStencil");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this},e.do1=function(){var t=St.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},e.do2=function(){var t=St.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},e.do3=function(){var t=St.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},e.do4=function(){var t=St.mainContext;0==this.level&&(t.enable(2960),t.clear(1024)),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,0,255),t.stencilOp(7680,7680,7682)},e.do5=function(){var t=St.mainContext;t.stencilFunc(514,this.level,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},e.do6=function(){var t=St.mainContext;G.targetFns[G.TOINT[this.blendMode]](t)},e.do7=function(){var t=St.mainContext;t.colorMask(!1,!1,!1,!1),t.stencilOp(7680,7680,7683)},e.do8=function(){var t=St.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7680)},t.restore=function(e,i,n,r,a){var s;if(e._renderKey=0,t._mask>0&&t._mask--,0==t._mask)s=laya.webgl.submit.SubmitStencil.create(3),e.addRenderObject(s),e._curSubmit=at.RENDERBASE;else{s=laya.webgl.submit.SubmitStencil.create(7),e.addRenderObject(s);var o=e._vb;if(o._byteLength,mt.fillRectImgVb(o,null,i.x,i.y,i.width,i.height,N.DEF_UV,n,r,a,0,0)){e._shader2D.glTexture=null;var l=e._curSubmit=at.createSubmit(e,e._ib,o,(o._byteLength-64)/32*3,wt.create(2,0));l.shaderValue.ALPHA=1,e._submits[e._submits._length++]=l,e._curSubmit._numEle+=6,e._curSubmit=at.RENDERBASE}else alert("clipRect calc stencil rect error");s=laya.webgl.submit.SubmitStencil.create(8),e.addRenderObject(s)}},t.restore2=function(e,i){var n;e._renderKey=0,t._mask>0&&t._mask--,0==t._mask?(n=laya.webgl.submit.SubmitStencil.create(3),e.addRenderObject(n),e._curSubmit=at.RENDERBASE):(n=laya.webgl.submit.SubmitStencil.create(7),e.addRenderObject(n),e._submits[e._submits._length++]=i,n=laya.webgl.submit.SubmitStencil.create(8),e.addRenderObject(n))},t.create=function(e){var i=t._cache._length?t._cache[--t._cache._length]:new t;return i.step=e,5==e&&++t._mask,i.level=t._mask,i},t._cache=(t._cache=[],t._cache._length=0,t._cache),t._mask=0,t}(),ut=function(){function t(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}r(t,"laya.webgl.submit.SubmitTarget");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return t&&(this.shaderValue.texture=t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[t.width,t.height]),this.shaderValue.upload(),this.blend(),A.drawCall++,A.trianglesFaces+=this._numEle/3,St.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},e.blend=function(){if(G.activeBlendFunction!==G.fns[this.blendType]){var t=St.mainContext;t.enable(3042),G.fns[this.blendType](t),G.activeBlendFunction=G.fns[this.blendType]}},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this},t.create=function(e,i,n,r,a,s){var o=t._cache._length?t._cache[--t._cache._length]:new t;return o._ib=i,o._vb=n,o.proName=s,o._startIdx=r*pt.BYTES_PIDX,o._numEle=0,o.blendType=e._nBlendType,o.shaderValue=a,o.shaderValue.setValue(e._shader2D),o},t._cache=(t._cache=[],t._cache._length=0,t._cache),t}(),_t=function(){function t(){this._sourceStr=null}r(t,"laya.webgl.text.CharSegment");var e=t.prototype;return i.imps(e,{"laya.webgl.text.ICharSegment":!0}),e.textToSpit=function(t){this._sourceStr=t},e.getChar=function(t){return this._sourceStr.charAt(t)},e.getCharCode=function(t){return this._sourceStr.charCodeAt(t)},e.length=function(){return this._sourceStr.length},t}(),dt=function(){function t(){}var e;return r(t,"laya.webgl.text.DrawText"),t.__init__=function(){t._charsTemp=new Array,t._drawValue=new e,t._charSeg=new _t},t.customCharSeg=function(e){t._charSeg=e},t.getChar=function(e,i,n){var r=Yt.createOneChar(e,n);return-1!=i&&(t._charsCache[i]=r),r},t._drawSlow=function(e,i,n,r,a,s,o,l,h,c,u,_,d,f,p){var m,g,y=t._drawValue.value(s,l,h,c,d,f,p),v=0,S=0,x=t._charsTemp,E=0,T=NaN;if(r)for(x.length=r.length,v=0,S=r.length;v<S;v++)T=(g=r[v]).charNum+y.txtID,x[v]=m=t._charsCache[T]||t.getChar(g.char,T,y),m.active();else{var w=n instanceof laya.utils.WordText?n.toString():n;if(P.CharacterCache){t._charSeg.textToSpit(w);var C=t._charSeg.length();for(x.length=C,v=0,S=C;v<S;v++)T=t._charSeg.getCharCode(v)+y.txtID,x[v]=m=t._charsCache[T]||t.getChar(t._charSeg.getChar(v),T,y),m.active(),E+=m.cw}else x.length=0,(m=t.getChar(w,-1,y)).active(),E+=m.cw,x[0]=m}var b=0;null!==o&&"left"!==o&&(b=-("center"==o?E/2:E));var M,I,D=NaN,A=0;if(r)for(v=0,S=x.length;v<S;v++)(m=x[v]).isSpace||(g=r[v],D=m.borderSize,M=m.texture,i._drawText(M,u+b+g.x*d-D,_+g.y*f-D,M.width,M.height,a,0,0,0,0));else{for(v=0,S=x.length;v<S;v++)(m=x[v]).isSpace||(D=m.borderSize,M=m.texture,i._drawText(M,u+b-D,_-D,M.width,M.height,a,0,0,0,0),e&&((I=e[A++])||(I=e[A-1]=[]),I[0]=M,I[1]=b-D,I[2]=-D)),b+=m.cw;e&&(e.length=A)}},t._drawFast=function(t,e,i,n,r){for(var a,s,o=0,l=t.length;o<l;o++)(a=(s=t[o])[0]).active(),e._drawText(a,n+s[1],r+s[2],a.width,a.height,i,0,0,0,0)},t.drawText=function(e,n,r,a,s,o,l,h,c,u,_,f){if(void 0===f&&(f=0),!(n&&0===n.length||r&&0===r.length)){var p=a.a,m=a.d;(0!==a.b||0!==a.c)&&(p=m=1);var g=1!==p||1!==m;if(g&&i.stage.transform){var y=i.stage.transform;g=y.a===p&&y.d===m}else g=!1;if(g){var v=(a=a.copyTo(Tt._tmpMatrix)).tx,S=a.ty;a.scale(1/p,1/m),a._checkTransform(),u*=p,_*=m,u+=v-a.tx,_+=S-a.ty}else p=m=1;if(r)t._drawSlow(null,e,n,r,a,s,o,l,h,c,u,_,p,m,f);else{if(null===n.toUpperCase){var x=p+1e5*m,E=n;return void(E.changed||E.id!==x?(E.id=x,E.changed=!1,t._drawSlow(E.save,e,n,r,a,s,o,l,h,c,u,_,p,m,f)):t._drawFast(E.save,e,a,u,_))}var T=n+s.toString()+l+h+c+p+m+o,w=t._textsCache[T];P.CharacterCache?w?t._drawFast(w,e,a,u,_):(t._textsCache.__length||(t._textsCache.__length=0),t._textsCache.__length>d.WebGLTextCacheCount&&((t._textsCache={}).__length=0,t._curPoolIndex=0),t._textCachesPool[t._curPoolIndex]?(w=t._textsCache[T]=t._textCachesPool[t._curPoolIndex]).length=0:t._textCachesPool[t._curPoolIndex]=w=t._textsCache[T]=[],t._textsCache.__length++,t._curPoolIndex++,t._drawSlow(w,e,n,r,a,s,o,l,h,c,u,_,p,m,f)):t._drawSlow(w,e,n,r,a,s,o,l,h,c,u,_,p,m,f)}}},t._charsTemp=null,t._textCachesPool=[],t._curPoolIndex=0,t._charsCache={},t._textsCache={},t._drawValue=null,t.d=[],t._charSeg=null,t.__init$=function(){e=function(){function t(){}return r(t,""),t.prototype.value=function(e,i,n,r,a,s,o){this.font=e,this.fillColor=i,this.borderColor=n,this.lineWidth=r,this.scaleX=a,this.scaleY=s,this.underLine=o;var l=e.toString()+a+s+r+i+n+o;return this.txtID=t._keymap[l],this.txtID||(this.txtID=1e-7*++t._keymapCount,t._keymap[l]=this.txtID),this},t.clear=function(){t._keymap={},t._keymapCount=1},t._keymap={},t._keymapCount=1,t}()},t}(),ft=function(){function t(e){this._index=0,this._size=14,this._italic=-2,t._cache2=t._cache2||[],this.setFont(e||"14px Arial")}r(t,"laya.webgl.text.FontInContext");var e=t.prototype;return e.setFont=function(e){var i=t._cache2[e];if(i)this._words=i[0],this._size=i[1];else{this._words=e.split(" ");for(var n=0,r=this._words.length;n<r;n++)if(this._words[n].indexOf("px")>0){this._index=n;break}this._size=parseInt(this._words[this._index]),t._cache2[e]=[this._words,this._size]}this._text=null,this._italic=-2},e.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},e.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t)return e;return-1},e.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},e.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},e.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},a(0,e,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),t.create=function(e){var i=t._cache[e];return i||(t._cache[e]=new t(e))},t.EMPTY=new t,t._cache={},t._cache2=null,t}(),pt=function(){function t(){}return r(t,"laya.webgl.utils.CONST3D2D"),t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,n(t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),t}(),mt=function(){function t(){}return r(t,"laya.webgl.utils.GlUtils"),t.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},t.fillIBQuadrangle=function(t,e){if(e>65535/4)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),n=0,r=0;r<e;r++)i[n++]=4*r,i[n++]=4*r+2,i[n++]=4*r+1,i[n++]=4*r,i[n++]=4*r+3,i[n++]=4*r+2;return t.setNeedUpload(),!0},t.expandIBQuadrangle=function(e,i){e.bufferLength>=6*i*2||t.fillIBQuadrangle(e,i)},t.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},t.fillQuadrangleImgVb=function(t,e,i,n,r,a,s,o){var l=16+(t._byteLength>>2);t.byteLength=l<<2;var h=t.getFloat32Array();h[2+(l-=16)]=r[0],h[l+3]=r[1],h[l+6]=r[2],h[l+7]=r[3],h[l+10]=r[4],h[l+11]=r[5],h[l+14]=r[6],h[l+15]=r[7];var c=a.a,u=a.b,_=a.c,d=a.d;if(1!==c||0!==u||0!==_||1!==d){a.bTransform=!0;var f=a.tx+s,p=a.ty+o;h[l]=(n[0]+e)*c+(n[1]+i)*_+f,h[l+1]=(n[0]+e)*u+(n[1]+i)*d+p,h[l+4]=(n[2]+e)*c+(n[3]+i)*_+f,h[l+5]=(n[2]+e)*u+(n[3]+i)*d+p,h[l+8]=(n[4]+e)*c+(n[5]+i)*_+f,h[l+9]=(n[4]+e)*u+(n[5]+i)*d+p,h[l+12]=(n[6]+e)*c+(n[7]+i)*_+f,h[l+13]=(n[6]+e)*u+(n[7]+i)*d+p}else a.bTransform=!1,e+=a.tx+s,i+=a.ty+o,h[l]=e+n[0],h[l+1]=i+n[1],h[l+4]=e+n[2],h[l+5]=i+n[3],h[l+8]=e+n[4],h[l+9]=i+n[5],h[l+12]=e+n[6],h[l+13]=i+n[7];return t._upload=!0,!0},t.fillTranglesVB=function(t,e,i,n,r,a,s){var o=(t._byteLength>>2)+n.length;t.byteLength=o<<2;var l=t.getFloat32Array();o-=n.length;for(var h=n.length,c=r.a,u=r.b,_=r.c,d=r.d,f=0;f<h;f+=4)if(l[o+f+2]=n[f+2],l[o+f+3]=n[f+3],1!==c||0!==u||0!==_||1!==d){r.bTransform=!0;var p=r.tx+a,m=r.ty+s;l[o+f]=(n[f]+e)*c+(n[f+1]+i)*_+p,l[o+f+1]=(n[f]+e)*u+(n[f+1]+i)*d+m}else r.bTransform=!1,e+=r.tx+a,i+=r.ty+s,l[o+f]=e+n[f],l[o+f+1]=i+n[f+1];return t._upload=!0,!0},t.copyPreImgVb=function(t,e,i){var n=t._byteLength>>2;t.byteLength=n+16<<2;for(var r=t.getFloat32Array(),a=0,s=n-16;a<4;a++)r[n]=r[s]+e,++s,r[++n]=r[s]+i,++s,r[++n]=r[s],++s,r[++n]=r[s],++n,++s;t._upload=!0},t.fillRectImgVb=function(t,e,i,n,r,a,s,o,l,h,c,u,_){void 0===_&&(_=!1);var d,f,p,m,g,y,v,S,x,E,T,w,C,b,M,I,D=1,A=o.a,R=o.b,L=o.c,P=o.d,N=e&&e.width<99999999;if(1!==A||0!==R||0!==L||1!==P?(o.bTransform=!0,0===R&&0===L&&(D=23,x=r+i,E=a+n,d=A*i+(T=o.tx+l),p=A*x+T,f=P*n+(w=o.ty+h),m=P*E+w)):(D=23,o.bTransform=!1,p=(d=i+o.tx+l)+r,m=(f=n+o.ty+h)+a),N&&(g=e.x,y=e.y,v=e.width+g,S=e.height+y),1!==D){if(Math.min(d,p)>=v)return!1;if(Math.min(f,m)>=S)return!1;if(Math.max(p,d)<=g)return!1;if(Math.max(m,f)<=y)return!1}var O=t._byteLength>>2;t.byteLength=O+16<<2;var V=t.getFloat32Array();switch(V[O+2]=s[0],V[O+3]=s[1],V[O+6]=s[2],V[O+7]=s[3],V[O+10]=s[4],V[O+11]=s[5],V[O+14]=s[6],V[O+15]=s[7],D){case 1:T=o.tx+l,w=o.ty+h;var k=A*i,F=L*n,B=P*n,U=R*i,H=A*(x=r+i),G=L*(E=a+n),W=P*E,z=R*x;_?(C=k+F+T,M=Math.round(C)-C,b=B+U+w,I=Math.round(b)-b,V[O]=C+M,V[O+1]=b+I,V[O+4]=H+F+T+M,V[O+5]=B+z+w+I,V[O+8]=H+G+T+M,V[O+9]=W+z+w+I,V[O+12]=k+G+T+M,V[O+13]=W+U+w+I):(V[O]=k+F+T,V[O+1]=B+U+w,V[O+4]=H+F+T,V[O+5]=B+z+w,V[O+8]=H+G+T,V[O+9]=W+z+w,V[O+12]=k+G+T,V[O+13]=W+U+w);break;case 23:_?(C=d+c,M=Math.round(C)-C,b=f,I=Math.round(b)-b,V[O]=C+M,V[O+1]=b+I,V[O+4]=p+c+M,V[O+5]=f+I,V[O+8]=p+M,V[O+9]=m+I,V[O+12]=d+M,V[O+13]=m+I):(V[O]=d+c,V[O+1]=f,V[O+4]=p+c,V[O+5]=f,V[O+8]=p,V[O+9]=m,V[O+12]=d,V[O+13]=m)}return t._upload=!0,!0},t.fillLineVb=function(e,i,n,r,a,s,o,l){var h=.5*o,c=t._fillLineArray,u=-(r-s),_=n-a,d=Math.sqrt(u*u+_*_);u/=d,_/=d,u*=h,_*=h,c[0]=n-u,c[1]=r-_,c[4]=n+u,c[5]=r+_,c[8]=a+u,c[9]=s+_,c[12]=a-u,c[13]=s-_,l&&l.transformPointArray(c,c);var f=16+(e._byteLength>>2);return e.byteLength=f<<2,e.insertData(c,f-16),!0},t._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t}(),gt=(function(){function t(){}r(t,"laya.webgl.utils.MatirxArray"),t.ArrayMul=function(e,i,n){if(e)if(i)for(var r=NaN,a=NaN,s=NaN,o=NaN,l=0;l<4;l++)r=e[l],a=e[l+4],s=e[l+8],o=e[l+12],n[l]=r*i[0]+a*i[1]+s*i[2]+o*i[3],n[l+4]=r*i[4]+a*i[5]+s*i[6]+o*i[7],n[l+8]=r*i[8]+a*i[9]+s*i[10]+o*i[11],n[l+12]=r*i[12]+a*i[13]+s*i[14]+o*i[15];else t.copyArray(e,n);else t.copyArray(i,n)},t.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function t(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new Jt(t,35048),e&&this._vb._resizeBuffer(e,!1),this._ib=new $t,i&&this._ib._resizeBuffer(i,!1)}r(t,"laya.webgl.utils.Mesh2D");var e=t.prototype;return e.cloneWithNewVB=function(){var e=new t(this._stride,0,0);return e._ib=this._ib,e._quadNum=this._quadNum,e._attribInfo=this._attribInfo,e},e.cloneWithNewVBIB=function(){var e=new t(this._stride,0,0);return e._attribInfo=this._attribInfo,e},e.getVBW=function(){return this._vb.setNeedUpload(),this._vb},e.getVBR=function(){return this._vb},e.getIBR=function(){return this._ib},e.getIBW=function(){return this._ib.setNeedUpload(),this._ib},e.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,n=0,r=0;r<t;r++)e[i++]=n,e[i++]=n+2,e[i++]=n+1,e[i++]=n,e[i++]=n+3,e[i++]=n+2,n+=4;this._ib.setNeedUpload()},e.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},e.getEleNum=function(){return this._ib.getBuffer().byteLength/2},e.releaseMesh=function(){},e.destroy=function(){},e.clearVB=function(){this._vb.clear()},t._gvaoid=0,t}()),yt=function(){function t(){}return r(t,"laya.webgl.utils.RenderState2D"),t.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.mat2MatArray=function(e,i){var n=e,r=i;return r[0]=n.a,r[1]=n.b,r[2]=t.EMPTYMAT4_ARRAY[2],r[3]=t.EMPTYMAT4_ARRAY[3],r[4]=n.c,r[5]=n.d,r[6]=t.EMPTYMAT4_ARRAY[6],r[7]=t.EMPTYMAT4_ARRAY[7],r[8]=t.EMPTYMAT4_ARRAY[8],r[9]=t.EMPTYMAT4_ARRAY[9],r[10]=t.EMPTYMAT4_ARRAY[10],r[11]=t.EMPTYMAT4_ARRAY[11],r[12]=n.tx,r[13]=n.ty,r[14]=t.EMPTYMAT4_ARRAY[14],r[15]=t.EMPTYMAT4_ARRAY[15],i},t.restoreTempArray=function(){t.TEMPMAT4_ARRAY[0]=1,t.TEMPMAT4_ARRAY[1]=0,t.TEMPMAT4_ARRAY[4]=0,t.TEMPMAT4_ARRAY[5]=1,t.TEMPMAT4_ARRAY[12]=0,t.TEMPMAT4_ARRAY[13]=0},t.clear=function(){t.worldScissorTest=!1,t.worldShaderDefines=null,t.worldFilters=null,t.worldAlpha=1,t.worldClipRect.x=t.worldClipRect.y=0,t.worldClipRect.width=t.width,t.worldClipRect.height=t.height,t.curRenderTarget=null},t._MAXSIZE=99999999,t.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.worldMatrix4=t.TEMPMAT4_ARRAY,t.worldAlpha=1,t.worldScissorTest=!1,t.worldFilters=null,t.worldShaderDefines=null,t.curRenderTarget=null,t.width=0,t.height=0,n(t,["worldMatrix",function(){return this.worldMatrix=new S},"worldClipRect",function(){return this.worldClipRect=new E(0,0,99999999,99999999)}]),t}(),vt=function(){function t(t,i,n,r,a){function s(t){var i=[],n=new e(i);return o._compileToTree(n,t.split("\n"),0,i,a),n}var o=this,l=c.now();this._VS=s(i),this._PS=s(n),this._nameMap=r,c.now()-l>2&&console.log("ShaderCompile use time:"+(c.now()-l)+"  size:"+i.length+"/"+n.length)}var e,i;r(t,"laya.webgl.utils.ShaderCompile");var a=t.prototype;return a._compileToTree=function(i,n,r,a,s){var o,l,h,c,u,_,d,f=0,p=0,m=0,g=0;for(p=r;p<n.length;p++)if(!((h=n[p]).length<1)&&0!==(f=h.indexOf("//"))){if(f>=0&&(h=h.substr(0,f)),o=d||new e(a),d=null,o.text=h,o.noCompile=!0,(f=h.indexOf("#"))>=0){for(c="#",g=f+1,m=h.length;g<m;g++){var y=h.charAt(g);if(" "===y||"\t"===y||"?"===y)break;c+=y}switch(o.name=c,c){case"#ifdef":case"#ifndef":if(o.src=h,o.noCompile=null!=h.match(/[!&|()=<>]/),o.noCompile?console.log("function():Boolean{return "+h.substr(f+o.name.length)+"}"):(_=h.replace(/^\s*/,"").split(/\s+/),o.setCondition(_[1],"#ifdef"===c?1:2),o.text="//"+o.text),o.setParent(i),i=o,s)for(_=h.substr(g).split(t._splitToWordExps3),g=0;g<_.length;g++)(h=_[g]).length&&(s[h]=!0);continue;case"#if":if(o.src=h,o.noCompile=!0,o.setParent(i),i=o,s)for(_=h.substr(g).split(t._splitToWordExps3),g=0;g<_.length;g++)(h=_[g]).length&&"defined"!=h&&(s[h]=!0);continue;case"#else":o.src=h,l=(i=i.parent).childs[i.childs.length-1],o.noCompile=l.noCompile,o.noCompile||(o.condition=l.condition,o.conditionType=1==l.conditionType?2:1,o.text="//"+o.text+" "+l.text+" "+o.conditionType),o.setParent(i),i=o;continue;case"#endif":l=(i=i.parent).childs[i.childs.length-1],o.noCompile=l.noCompile,o.noCompile||(o.text="//"+o.text),o.setParent(i);continue;case"#include":_=t.splitToWords(h,null);var v=t.includes[_[1]];if(!v)throw"ShaderCompile error no this include file:"+_[1];if((f=_[0].indexOf("?"))<0){o.setParent(i),h=v.getWith("with"==_[2]?_[3]:null),this._compileToTree(o,h.split("\n"),0,a,s),o.text="";continue}o.setCondition(_[0].substr(f+1),1),o.text=v.getWith("with"==_[2]?_[3]:null);break;case"#import":u=(_=t.splitToWords(h,null))[1],a.push({node:o,file:t.includes[u],ofs:o.text.length});continue}}else{if((l=i.childs[i.childs.length-1])&&!l.name){a.length>0&&t.splitToWords(h,l),d=o,l.text+="\n"+h;continue}a.length>0&&t.splitToWords(h,o)}o.setParent(i)}},a.createShader=function(t,e,i){var n={},r="";if(t)for(var a in t)r+="#define "+a+"\n",n[a]=!0;var s=this._VS.toscript(n,[]),o=this._PS.toscript(n,[]);return(i||Kt.create)(r+s.join("\n"),r+o.join("\n"),e,this._nameMap)},t._parseOne=function(e,i,n,r,a,s){var o={type:t.shaderParamsMap[n[r+1]],name:n[r+2],size:isNaN(parseInt(n[r+3]))?1:parseInt(n[r+3])};return s&&("attribute"==a?e.push(o):i.push(o)),":"==n[r+3]&&(o.type=n[r+4],r+=2),r+2},t.addInclude=function(e,n){if(!n||0===n.length)throw new Error("add shader include file err:"+e);if(t.includes[e])throw new Error("add shader include file err, has add:"+e);t.includes[e]=new i(n)},t.preGetParams=function(e,i){var n=[e,i],r={},a=[],s=[],o={},l=[];r.attributes=a,r.uniforms=s,r.defines=o;for(var h=0,c=0,u=0;u<2;u++){n[u]=n[u].replace(t._removeAnnotation,"");var _,d=n[u].match(t._reg);for(h=0,c=d.length;h<c;h++){var f=d[h];if("attribute"==f||"uniform"==f)h=t._parseOne(a,s,d,h,f,!0);else{if("#define"==f){l[f=d[++h]]=1;continue}if("#ifdef"==f)for(o[_=d[++h]]=o[_]||[],h++;h<c;h++)if("attribute"==(f=d[h])||"uniform"==f)h=t._parseOne(a,s,d,h,f,l[_]);else if("#else"==f)for(h++;h<c;h++)if("attribute"==(f=d[h])||"uniform"==f)h=t._parseOne(a,s,d,h,f,!l[_]);else if("#endif"==f)break}}}return r},t.splitToWords=function(t,e){for(var i,n,r=[],a=-1,s=0,o=t.length;s<o;s++)if(i=t.charAt(s)," \t=+-*/&%!<>()'\",;".indexOf(i)>=0){if(a>=0&&s-a>1&&(n=t.substr(a,s-a),r.push(n)),'"'==i||"'"==i){var l=t.indexOf(i,s+1);if(l<0)throw"Sharder err:"+t;r.push(t.substr(s+1,l-s-1)),s=l,a=-1;continue}"("==i&&e&&r.length>0&&(n=r[r.length-1]+";","vec4;main;".indexOf(n)<0&&(e.useFuns+=n)),a=-1}else a<0&&(a=s);return a<o&&o-a>1&&(n=t.substr(a,o-a),r.push(n)),r},t.IFDEF_NO=0,t.IFDEF_YES=1,t.IFDEF_ELSE=2,t.IFDEF_PARENT=3,t._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),t._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),t._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),t.includes={},n(t,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),t.__init$=function(){e=function(){function t(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}r(t,"");var e=t.prototype;return e.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},e.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},e.toscript=function(e,i){return this._toscript(e,i,++t.__id)},e._toscript=function(t,e,i){if(this.childs.length<1&&!this.text)return e;if(e.length,this.condition){var n=!!this.condition.call(t);if(2===this.conditionType&&(n=!n),!n)return e}if(this.text&&e.push(this.text),this.childs.length>0&&this.childs.forEach(function(n,r,a){n._toscript(t,e,i)}),this.includefiles.length>0&&this.useFuns.length>0)for(var r,a=0,s=this.includefiles.length;a<s;a++)this.includefiles[a].curUseID!=i&&(r=this.includefiles[a].file.getFunsScript(this.useFuns)).length>0&&(this.includefiles[a].curUseID=i,e[0]=r+e[0]);return e},t.__id=1,t}(),i=function(){function e(e){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=e;for(var i=0,n=0,r=0;!((i=e.indexOf("#begin",i))<0);){for(r=i+5;!((r=e.indexOf("#end",r))<0)&&"i"===e.charAt(r+4);)r+=5;if(r<0)throw"add include err,no #end:"+e;n=e.indexOf("\n",i);var a=t.splitToWords(e.substr(i,n-i),null);"code"==a[1]?this.codes[a[2]]=e.substr(n+1,r-n-1):"function"==a[1]&&(n=e.indexOf("function",i),n+="function".length,this.funs[a[3]]=e.substr(n+1,r-n-1),this.funnames+=a[3]+";"),i=r+1}}r(e,"");var i=e.prototype;return i.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},i.getFunsScript=function(t){var e="";for(var i in this.funs)t.indexOf(i+";")>=0&&(e+=this.funs[i]);return e},e}()},t}(),St=function(){function t(){}return r(t,"laya.webgl.WebGL"),t._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},t._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},t._uint16ArraySlice=function(t){var e,i=arguments,n=0,r=0;if(0===i.length)for(n=this.length,e=new Uint16Array(n),r=0;r<n;r++)e[r]=this[r];else if(2===i.length){var a=i[0],s=i[1];if(s>a)for(n=s-a,e=new Uint16Array(n),r=a;r<s;r++)e[r-a]=this[r];else e=new Uint16Array(0)}return e},t.expandContext=function(){var t=f.prototype,e=CanvasRenderingContext2D.prototype;e.fillTrangles=t.fillTrangles,qt.__int__(null),e.setIBVB=function(t,e,i,n,r,a,s,o,l,h){void 0===l&&(l=0),void 0===h&&(h=0),null===i&&(this._ib=this._ib||$t.QuadrangleIB,i=this._ib,mt.expandIBQuadrangle(i,n._byteLength/64+8)),this._setIBVB(t,e,i,n,r,a,s,o,l,h)},e.fillTrangles=function(t,e,i,n,r){this._curMat=this._curMat||S.create(),this._vb=this._vb||Jt.create(),this._ib||(this._ib=$t.create(),mt.fillIBQuadrangle(this._ib,s/4));var a=this._vb,s=n.length>>4;mt.fillTranglesVB(a,e,i,n,r||this._curMat,0,0),mt.expandIBQuadrangle(this._ib,a._byteLength/64+8);var o=new wt(1,0);o.textureHost=t;var l=new Qt("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");a._vertType=3,this._setIBVB(e,i,this._ib,a,6*s,r,l,o,0,0)}},t.enable=function(){if(c.__init__(),T.isConchApp&&!T.isConchWebGL)return M.skinAniSprite=function(){return new tt},t.expandContext(),!1;if(M.getWebGLContext=function(t){for(var e,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<i.length;n++){try{e=t.getContext(i[n],{stencil:d.isStencil,alpha:d.isAlpha,antialias:d.isAntialias,premultipliedAlpha:d.premultipliedAlpha,preserveDrawingBuffer:d.preserveDrawingBuffer})}catch(t){}if(e)return e}return null},null==(t.mainContext=M.getWebGLContext(T._mainCanvas)))return!1;if(T.isWebGL)return!0;y.create=function(t,e){return new te(t,e)},v.create=function(t,e,i,n,r,a,s){return new jt(t,e,i,n,r,a,s)},T.WebGL=t,T.isWebGL=!0,dt.__init__(),M.createRenderSprite=function(t,e){return new Ct(t,e)},M.createWebGLContext2D=function(t){return new Tt(t)},M.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},M.createGraphics=function(){return new Et};var e=M.createFilterAction;return M.createFilterAction=e||function(t){return new bt},M.clear=function(t){yt.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=T.context.ctx,i=0==e._submits._length||d.preserveDrawingBuffer?_.create(t)._color:D._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),yt.clear()},M.addToAtlas=function(t,e){void 0===e&&(e=!1);var n=t.bitmap;T.optimizeTextureMemory(t.url,t)?i.__typeof(n,"laya.webgl.resource.IMergeAtlasBitmap")&&n.allowMerageInAtlas&&n.on("recovered",t,t.addTextureToAtlas):n.enableMerageInAtlas=!1},M.isAtlas=function(t){return t instanceof laya.webgl.atlas.AtlasWebGLCanvas},U._enable(),M.beginFlush=function(){for(var t=U.instance,e=t.getAtlaserCount(),i=0;i<e;i++){var n=t.getAtlaserByIndex(i).texture;n._flashCacheImageNeedFlush&&M.flashFlushImage(n)}},M.drawToCanvas=function(t,e,i,n,r,a){(i<=0||n<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),r-=t.x,a-=t.y,i|=1,n|=1,r|=1,a|=1;var s=Vt.create(i,n,6408,5121,0,!1);s.start(),s.clear(0,0,0,0),T.context.clear(),w.renders[e]._fun(t,T.context,r,yt.height-n+a),T.context.flush(),s.end();var o=s.getData(0,0,i,n);if(s.recycle(),o.byteLength==i*n*4){var l=new zt;l._canvas=c.createElement("canvas"),l.size(i,n);var h=l._canvas.getContext("2d");c.canvas.size(i,n);var u=c.context,_=u.createImageData(i,n);return _.data.set(new Uint8ClampedArray(o.buffer)),l._imgData=_,u.putImageData(_,0,0),h.save(),h.translate(0,n),h.scale(1,-1),h.drawImage(c.canvas.source,0,0),h.restore(),l}console.log("drawToCanvas error: w:"+i+",h:"+n+",datalen:"+o.byteLength)},M.createFilterAction=function(t){var e;switch(t){case 32:e=new bt}return e},M.addTextureToAtlas=function(t){t._uvID++,U._atlasRestore++,t.bitmap.enableMerageInAtlas&&U.instance.addToAtlas(t)},M.getTexturePixels=function(t,e,i,n,r){T.context.ctx.clear();var a=new I;a.graphics.drawTexture(t,-e,-i);var s=Vt.create(n,r);s.start(),s.clear(0,0,0,0),a.render(T.context,0,0),T.context.ctx.flush(),s.end();for(var o=s.getData(0,0,n,r),l=[],h=0,c=r-1;c>=0;c--)for(var u=0;u<n;u++)h=4*(c*n+u),l.push(o[h]),l.push(o[h+1]),l.push(o[h+2]),l.push(o[h+3]);return l},M.skinAniSprite=function(){return new tt},g.create=function(t,e){var i=new zt;return i._imgData=e,i.flipY=!1,i},p._filterStart=function(t,e,i,n,r){var a=t.getValue("bounds"),s=Vt.create(a.width,a.height);if(s.start(),s.clear(0,0,0,0),t.addValue("src",s),t.addValue("ScissorTest",yt.worldScissorTest),yt.worldScissorTest){var o=new E;o.copyFrom(i.ctx._clipRect),t.addValue("clipRect",o),yt.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},p._filterEnd=function(t,e,i,n,r){var a=t.getValue("bounds");t.getValue("src").end();var s=Vt.create(a.width,a.height);s.start(),s.clear(0,0,0,0),t.addValue("out",s),e._set$P("_filterCache",s),e._set$P("_isHaveGlowFilter",t.getValue("_isHaveGlowFilter"))},p._EndTarget=function(t,e){if(t.getValue("src").recycle(),t.getValue("out").end(),t.getValue("ScissorTest")){yt.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save();var i=t.getValue("clipRect");e.ctx.clipRect(i.x,i.y,i.width,i.height)}},p._useSrc=function(t){var e=t.getValue("out");e.end(),(e=t.getValue("src")).start(),e.clear(0,0,0,0)},p._endSrc=function(t){t.getValue("src").end()},p._useOut=function(t){var e=t.getValue("src");e.end(),(e=t.getValue("out")).start(),e.clear(0,0,0,0)},p._endOut=function(t){t.getValue("out").end()},p._recycleScope=function(t){t.recycle()},p._filter=function(t,e,i,n){var r=this._next;if(r){var a=t.filters,s=a.length;if(1==s&&32==a[0].type)return e.ctx.save(),e.ctx.setFilters([a[0]]),r._fun.call(r,t,e,i,n),void e.ctx.restore();var o,l,h=ot.create(),c=x.TEMP,u=e.ctx._getTransformMatrix(),_=S.create();u.copyTo(_);var d=0,f=0,m=!1,g=t._$P._filterCache?t._$P._filterCache:null;if(!g||t._repaint){m=t._isHaveGlowFilter(),h.addValue("_isHaveGlowFilter",m),m&&(d=50,f=25),(l=new E).copyFrom(t.getSelfBounds()),l.x+=t.x,l.y+=t.y,l.x-=t.pivotX+4,l.y-=t.pivotY+4;var y=l.x,v=l.y;if(l.width+=d+8,l.height+=d+8,c.x=l.x*_.a+l.y*_.c,c.y=l.y*_.d+l.x*_.b,l.x=c.x,l.y=c.y,c.x=l.width*_.a+l.height*_.c,c.y=l.height*_.d+l.width*_.b,l.width=c.x,l.height=c.y,l.width<=0||l.height<=0)return;g&&g.recycle(),h.addValue("bounds",l);var T=st.create([h,t,e,0,0],p._filterStart);e.addRenderObject(T),e.ctx._renderKey=0,e.ctx._shader2D.glTexture=null;var w=t.x-y+f,C=t.y-v+f;r._fun.call(r,t,e,w,C),T=st.create([h,t,e,0,0],p._filterEnd),e.addRenderObject(T);for(var b=0;b<s;b++)0!=b&&(T=st.create([h],p._useSrc),e.addRenderObject(T),o=wt.create(1,0),S.TEMP.identity(),e.ctx.drawTarget(h,0,0,l.width,l.height,S.TEMP,"out",o,null,G.TOINT.overlay),T=st.create([h],p._useOut),e.addRenderObject(T)),a[b].action.apply3d(h,t,e,0,0);T=st.create([h,e],p._EndTarget),e.addRenderObject(T)}else{if((m=!!t._$P._isHaveGlowFilter&&t._$P._isHaveGlowFilter)&&(d=50,f=25),(l=t.getBounds()).width<=0||l.height<=0)return;l.width+=d,l.height+=d,c.x=l.x*_.a+l.y*_.c,c.y=l.y*_.d+l.x*_.b,l.x=c.x,l.y=c.y,c.x=l.width*_.a+l.height*_.c,c.y=l.height*_.d+l.width*_.b,l.width=c.x,l.height=c.y,h.addValue("out",g)}i=i-f-t.x,n=n-f-t.y,c.setTo(i,n),_.transformPoint(c),i=c.x+l.x,n=c.y+l.y,o=wt.create(1,0),S.TEMP.identity(),e.ctx.drawTarget(h,i,n,l.width,l.height,S.TEMP,"out",o,null,G.TOINT.overlay),T=st.create([h],p._recycleScope),e.addRenderObject(T),_.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=t._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=t._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=t._uint8ArraySlice),!0},t.onStageResize=function(e,i){null!=t.mainContext&&(t.mainContext.viewport(0,0,e,i),yt.width=e,yt.height=i)},t.onInvalidGLRes=function(){U.instance.freeAll(),b.releaseContentManagers(!0),t.doNodeRepaint(i.stage),t.mainContext.viewport(0,0,yt.width,yt.height),i.stage.event("devicelost")},t.doNodeRepaint=function(e){0==e.numChildren&&e.repaint();for(var i=0;i<e.numChildren;i++)t.doNodeRepaint(e.getChildAt(i))},t.init=function(e,i,n){t.mainCanvas=e,g._createContext=function(t){return new Tt(t)},zt._createContext=function(t){return new Tt(t)};var r=laya.webgl.WebGL.mainContext;if(null!=r.getShaderPrecisionFormat){var a=r.getShaderPrecisionFormat(35633,36338),s=r.getShaderPrecisionFormat(35632,36338);t.shaderHighPrecision=!(!a.precision||!s.precision)}else t.shaderHighPrecision=!1;if(t.compressAstc=r.getExtension("WEBGL_compressed_texture_astc"),t.compressAtc=r.getExtension("WEBGL_compressed_texture_atc"),t.compressEtc=r.getExtension("WEBGL_compressed_texture_etc"),t.compressEtc1=r.getExtension("WEBGL_compressed_texture_etc1"),t.compressPvrtc=r.getExtension("WEBGL_compressed_texture_pvrtc"),t.compressS3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),t.compressS3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),r.deleteTexture1=r.deleteTexture,r.deleteTexture=function(t){t==xt.curBindTexValue&&(xt.curBindTexValue=null),r.deleteTexture1(t)},t.onStageResize(i,n),null==t.mainContext)throw new Error("webGL getContext err!");L.__init__(),U.__init__(),It.__init__(),at.__init__(),Tt.__init__(),wt.__init__(),$.__init__(),qt.__int__(r),G._init_(r),T.isConchApp&&conch.setOnInvalidGLRes(t.onInvalidGLRes)},t.compressAstc=null,t.compressAtc=null,t.compressEtc=null,t.compressEtc1=null,t.compressPvrtc=null,t.compressS3tc=null,t.compressS3tc_srgb=null,t.mainCanvas=null,t.mainContext=null,t.antialias=!0,t.shaderHighPrecision=!1,t._bg_null=[0,0,0,0],t}(),xt=function(){function t(){}return r(t,"laya.webgl.WebGLContext"),t.UseProgram=function(e){return t._useProgram!==e&&(St.mainContext.useProgram(e),t._useProgram=e,!0)},t.setDepthTest=function(e,i){i!==t._depthTest&&(t._depthTest=i,i?e.enable(2929):e.disable(2929))},t.setDepthMask=function(e,i){i!==t._depthMask&&(t._depthMask=i,e.depthMask(i))},t.setDepthFunc=function(e,i){i!==t._depthFunc&&(t._depthFunc=i,e.depthFunc(i))},t.setBlend=function(e,i){i!==t._blend&&(t._blend=i,i?e.enable(3042):e.disable(3042))},t.setBlendFunc=function(e,i,n){(i!==t._sFactor||n!==t._dFactor)&&(t._sFactor=i,t._dFactor=n,e.blendFunc(i,n))},t.setCullFace=function(e,i){i!==t._cullFace&&(t._cullFace=i,i?e.enable(2884):e.disable(2884))},t.setFrontFace=function(e,i){i!==t._frontFace&&(t._frontFace=i,e.frontFace(i))},t.bindTexture=function(e,i,n){e.bindTexture(i,n),t.curBindTexTarget=i,t.curBindTexValue=n},t.DEPTH_BUFFER_BIT=256,t.STENCIL_BUFFER_BIT=1024,t.COLOR_BUFFER_BIT=16384,t.POINTS=0,t.LINES=1,t.LINE_LOOP=2,t.LINE_STRIP=3,t.TRIANGLES=4,t.TRIANGLE_STRIP=5,t.TRIANGLE_FAN=6,t.ZERO=0,t.ONE=1,t.SRC_COLOR=768,t.ONE_MINUS_SRC_COLOR=769,t.SRC_ALPHA=770,t.ONE_MINUS_SRC_ALPHA=771,t.DST_ALPHA=772,t.ONE_MINUS_DST_ALPHA=773,t.DST_COLOR=774,t.ONE_MINUS_DST_COLOR=775,t.SRC_ALPHA_SATURATE=776,t.FUNC_ADD=32774,t.BLEND_EQUATION=32777,t.BLEND_EQUATION_RGB=32777,t.BLEND_EQUATION_ALPHA=34877,t.FUNC_SUBTRACT=32778,t.FUNC_REVERSE_SUBTRACT=32779,t.BLEND_DST_RGB=32968,t.BLEND_SRC_RGB=32969,t.BLEND_DST_ALPHA=32970,t.BLEND_SRC_ALPHA=32971,t.CONSTANT_COLOR=32769,t.ONE_MINUS_CONSTANT_COLOR=32770,t.CONSTANT_ALPHA=32771,t.ONE_MINUS_CONSTANT_ALPHA=32772,t.BLEND_COLOR=32773,t.ARRAY_BUFFER=34962,t.ELEMENT_ARRAY_BUFFER=34963,t.ARRAY_BUFFER_BINDING=34964,t.ELEMENT_ARRAY_BUFFER_BINDING=34965,t.STREAM_DRAW=35040,t.STATIC_DRAW=35044,t.DYNAMIC_DRAW=35048,t.BUFFER_SIZE=34660,t.BUFFER_USAGE=34661,t.CURRENT_VERTEX_ATTRIB=34342,t.FRONT=1028,t.BACK=1029,t.CULL_FACE=2884,t.FRONT_AND_BACK=1032,t.BLEND=3042,t.DITHER=3024,t.STENCIL_TEST=2960,t.DEPTH_TEST=2929,t.SCISSOR_TEST=3089,t.POLYGON_OFFSET_FILL=32823,t.SAMPLE_ALPHA_TO_COVERAGE=32926,t.SAMPLE_COVERAGE=32928,t.NO_ERROR=0,t.INVALID_ENUM=1280,t.INVALID_VALUE=1281,t.INVALID_OPERATION=1282,t.OUT_OF_MEMORY=1285,t.CW=2304,t.CCW=2305,t.LINE_WIDTH=2849,t.ALIASED_POINT_SIZE_RANGE=33901,t.ALIASED_LINE_WIDTH_RANGE=33902,t.CULL_FACE_MODE=2885,t.FRONT_FACE=2886,t.DEPTH_RANGE=2928,t.DEPTH_WRITEMASK=2930,t.DEPTH_CLEAR_VALUE=2931,t.DEPTH_FUNC=2932,t.STENCIL_CLEAR_VALUE=2961,t.STENCIL_FUNC=2962,t.STENCIL_FAIL=2964,t.STENCIL_PASS_DEPTH_FAIL=2965,t.STENCIL_PASS_DEPTH_PASS=2966,t.STENCIL_REF=2967,t.STENCIL_VALUE_MASK=2963,t.STENCIL_WRITEMASK=2968,t.STENCIL_BACK_FUNC=34816,t.STENCIL_BACK_FAIL=34817,t.STENCIL_BACK_PASS_DEPTH_FAIL=34818,t.STENCIL_BACK_PASS_DEPTH_PASS=34819,t.STENCIL_BACK_REF=36003,t.STENCIL_BACK_VALUE_MASK=36004,t.STENCIL_BACK_WRITEMASK=36005,t.VIEWPORT=2978,t.SCISSOR_BOX=3088,t.COLOR_CLEAR_VALUE=3106,t.COLOR_WRITEMASK=3107,t.UNPACK_ALIGNMENT=3317,t.PACK_ALIGNMENT=3333,t.MAX_TEXTURE_SIZE=3379,t.MAX_VIEWPORT_DIMS=3386,t.SUBPIXEL_BITS=3408,t.RED_BITS=3410,t.GREEN_BITS=3411,t.BLUE_BITS=3412,t.ALPHA_BITS=3413,t.DEPTH_BITS=3414,t.STENCIL_BITS=3415,t.POLYGON_OFFSET_UNITS=10752,t.POLYGON_OFFSET_FACTOR=32824,t.TEXTURE_BINDING_2D=32873,t.SAMPLE_BUFFERS=32936,t.SAMPLES=32937,t.SAMPLE_COVERAGE_VALUE=32938,t.SAMPLE_COVERAGE_INVERT=32939,t.NUM_COMPRESSED_TEXTURE_FORMATS=34466,t.COMPRESSED_TEXTURE_FORMATS=34467,t.DONT_CARE=4352,t.FASTEST=4353,t.NICEST=4354,t.GENERATE_MIPMAP_HINT=33170,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.DEPTH_COMPONENT=6402,t.ALPHA=6406,t.RGB=6407,t.RGBA=6408,t.LUMINANCE=6409,t.LUMINANCE_ALPHA=6410,t.UNSIGNED_SHORT_4_4_4_4=32819,t.UNSIGNED_SHORT_5_5_5_1=32820,t.UNSIGNED_SHORT_5_6_5=33635,t.FRAGMENT_SHADER=35632,t.VERTEX_SHADER=35633,t.MAX_VERTEX_ATTRIBS=34921,t.MAX_VERTEX_UNIFORM_VECTORS=36347,t.MAX_VARYING_VECTORS=36348,t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,t.MAX_TEXTURE_IMAGE_UNITS=34930,t.MAX_FRAGMENT_UNIFORM_VECTORS=36349,t.SHADER_TYPE=35663,t.DELETE_STATUS=35712,t.LINK_STATUS=35714,t.VALIDATE_STATUS=35715,t.ATTACHED_SHADERS=35717,t.ACTIVE_UNIFORMS=35718,t.ACTIVE_ATTRIBUTES=35721,t.SHADING_LANGUAGE_VERSION=35724,t.CURRENT_PROGRAM=35725,t.NEVER=512,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.NOTEQUAL=517,t.GEQUAL=518,t.ALWAYS=519,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.VENDOR=7936,t.RENDERER=7937,t.VERSION=7938,t.NEAREST=9728,t.LINEAR=9729,t.NEAREST_MIPMAP_NEAREST=9984,t.LINEAR_MIPMAP_NEAREST=9985,t.NEAREST_MIPMAP_LINEAR=9986,t.LINEAR_MIPMAP_LINEAR=9987,t.TEXTURE_MAG_FILTER=10240,t.TEXTURE_MIN_FILTER=10241,t.TEXTURE_WRAP_S=10242,t.TEXTURE_WRAP_T=10243,t.TEXTURE_2D=3553,t.TEXTURE=5890,t.TEXTURE_CUBE_MAP=34067,t.TEXTURE_BINDING_CUBE_MAP=34068,t.TEXTURE_CUBE_MAP_POSITIVE_X=34069,t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,t.MAX_CUBE_MAP_TEXTURE_SIZE=34076,t.TEXTURE0=33984,t.TEXTURE1=33985,t.TEXTURE2=33986,t.TEXTURE3=33987,t.TEXTURE4=33988,t.TEXTURE5=33989,t.TEXTURE6=33990,t.TEXTURE7=33991,t.TEXTURE8=33992,t.TEXTURE9=33993,t.TEXTURE10=33994,t.TEXTURE11=33995,t.TEXTURE12=33996,t.TEXTURE13=33997,t.TEXTURE14=33998,t.TEXTURE15=33999,t.TEXTURE16=34e3,t.TEXTURE17=34001,t.TEXTURE18=34002,t.TEXTURE19=34003,t.TEXTURE20=34004,t.TEXTURE21=34005,t.TEXTURE22=34006,t.TEXTURE23=34007,t.TEXTURE24=34008,t.TEXTURE25=34009,t.TEXTURE26=34010,t.TEXTURE27=34011,t.TEXTURE28=34012,t.TEXTURE29=34013,t.TEXTURE30=34014,t.TEXTURE31=34015,t.ACTIVE_TEXTURE=34016,t.REPEAT=10497,t.CLAMP_TO_EDGE=33071,t.MIRRORED_REPEAT=33648,t.FLOAT_VEC2=35664,t.FLOAT_VEC3=35665,t.FLOAT_VEC4=35666,t.INT_VEC2=35667,t.INT_VEC3=35668,t.INT_VEC4=35669,t.BOOL=35670,t.BOOL_VEC2=35671,t.BOOL_VEC3=35672,t.BOOL_VEC4=35673,t.FLOAT_MAT2=35674,t.FLOAT_MAT3=35675,t.FLOAT_MAT4=35676,t.SAMPLER_2D=35678,t.SAMPLER_CUBE=35680,t.VERTEX_ATTRIB_ARRAY_ENABLED=34338,t.VERTEX_ATTRIB_ARRAY_SIZE=34339,t.VERTEX_ATTRIB_ARRAY_STRIDE=34340,t.VERTEX_ATTRIB_ARRAY_TYPE=34341,t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,t.VERTEX_ATTRIB_ARRAY_POINTER=34373,t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,t.COMPILE_STATUS=35713,t.LOW_FLOAT=36336,t.MEDIUM_FLOAT=36337,t.HIGH_FLOAT=36338,t.LOW_INT=36339,t.MEDIUM_INT=36340,t.HIGH_INT=36341,t.FRAMEBUFFER=36160,t.RENDERBUFFER=36161,t.RGBA4=32854,t.RGB5_A1=32855,t.RGB565=36194,t.DEPTH_COMPONENT16=33189,t.STENCIL_INDEX=6401,t.STENCIL_INDEX8=36168,t.DEPTH_STENCIL=34041,t.RENDERBUFFER_WIDTH=36162,t.RENDERBUFFER_HEIGHT=36163,t.RENDERBUFFER_INTERNAL_FORMAT=36164,t.RENDERBUFFER_RED_SIZE=36176,t.RENDERBUFFER_GREEN_SIZE=36177,t.RENDERBUFFER_BLUE_SIZE=36178,t.RENDERBUFFER_ALPHA_SIZE=36179,t.RENDERBUFFER_DEPTH_SIZE=36180,t.RENDERBUFFER_STENCIL_SIZE=36181,t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,t.COLOR_ATTACHMENT0=36064,t.DEPTH_ATTACHMENT=36096,t.STENCIL_ATTACHMENT=36128,t.DEPTH_STENCIL_ATTACHMENT=33306,t.NONE=0,t.FRAMEBUFFER_COMPLETE=36053,t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,t.FRAMEBUFFER_UNSUPPORTED=36061,t.FRAMEBUFFER_BINDING=36006,t.RENDERBUFFER_BINDING=36007,t.MAX_RENDERBUFFER_SIZE=34024,t.INVALID_FRAMEBUFFER_OPERATION=1286,t.UNPACK_FLIP_Y_WEBGL=37440,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,t.CONTEXT_LOST_WEBGL=37442,t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,t.BROWSER_DEFAULT_WEBGL=37444,t._useProgram=null,t._depthTest=!0,t._depthMask=!0,t._blend=!1,t._cullFace=!1,t.curBindTexTarget=null,t.curBindTexValue=null,n(t,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),t}(),Et=function(t){function e(){e.__super.call(this)}r(e,"laya.webgl.display.GraphicsGL",m);var i=e.prototype;return i.setShader=function(t){this._saveToCmd(T.context._setShader,[t])},i.setIBVB=function(t,e,i,n,r,a){this._saveToCmd(T.context._setIBVB,[t,e,i,n,r,a])},i.drawParticle=function(t,e,i){var n=M.createParticleTemplate2D(i);n.x=t,n.y=e,this._saveToCmd(T.context._drawParticle,[n])},e}(),Tt=function(t){function e(t){this._x=0,this._y=0,this._id=++e._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,e.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=e.MAXCLIPRECT,this.mOutPoint,this._canvas=t,e._contextcount++,T.isFlash?(this._ib=$t.create(35044),mt.fillIBQuadrangle(this._ib,16)):this._ib=$t.QuadrangleIB,this.clear()}var s;r(e,"laya.webgl.canvas.WebGLContext2D",f);var o=e.prototype;return o.setIsMainContext=function(){this._isMain=!0},o.clearBG=function(t,e,i,n){var r=St.mainContext;r.clearColor(t,e,i,n),r.clear(16384)},o._getSubmits=function(){return this._submits},o._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},o.destroy=function(){--e._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas=null,this._ib&&this._ib!=$t.QuadrangleIB&&this._ib.releaseResource()},o.clear=function(){this._submits||(this._other=s.DEFAULT,this._curMat=S.create(),this._vb=Jt.create(-1),this._submits=[],this._save=[K.Create(this)],this._save.length=10,this._shader2D=new $,this._triangleMesh=Nt.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=s.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=e.MAXCLIPRECT,this._curSubmit=at.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=W.DEFAULT;for(var t=0,i=this._submits._length;t<i;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},o.size=function(t,e){if(this._width!=t||this._height!=e)if(0==t||0==e){0!=this._vb._byteLength&&(this._width=t,this._height=e,this._vb.clear(),this._vb.upload());for(var i=0,n=this._submits._length;i<n;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas.memorySize-=this._canvas.memorySize;0===t&&0===e&&this._releaseMem()},o._getTransformMatrix=function(){return this._curMat},o.translate=function(t,e){0===t&&0===e||(Z.save(this),this._curMat.bTransform&&(q.save(this),this._curMat.transformPointN(x.TEMP.setTo(t,e)),t=x.TEMP.x,e=x.TEMP.y),this._x+=t,this._y+=e)},o.save=function(){this._save[this._save._length++]=K.Create(this)},o.restore=function(){var t=this._save._length;if(!(t<1))for(var e=t-1;e>=0;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},o._fillText=function(t,e,i,n,r,a,s,o,l,h){void 0===h&&(h=0);var c=this._shader2D,u=this._curSubmit.shaderValue,d=r?ft.create(r):this._other.font;if(U.enabled)c.ALPHA!==u.ALPHA&&(c.glTexture=null),dt.drawText(this,t,e,this._curMat,d,l||this._other.textAlign,a,s,o,i,n,h);else{this._shader2D.defines.getValue();var f=a?_.create(a)._color:c.colorAdd;c.ALPHA===u.ALPHA&&f===c.colorAdd&&u.colorAdd===c.colorAdd||(c.glTexture=null,c.colorAdd=f),dt.drawText(this,t,e,this._curMat,d,l||this._other.textAlign,a,s,o,i,n,h)}},o.fillWords=function(t,e,i,n,r,a){this._fillText(null,t,e,i,n,r,null,-1,null,a)},o.fillBorderWords=function(t,e,i,n,r,a,s){this._fillBorderText(null,t,e,i,n,r,a,s,null)},o.fillText=function(t,e,i,n,r,a){this._fillText(t,null,e,i,n,r,null,-1,a)},o.strokeText=function(t,e,i,n,r,a,s){this._fillText(t,null,e,i,n,null,r,a||1,s)},o.fillBorderText=function(t,e,i,n,r,a,s,o){this._fillBorderText(t,null,e,i,n,r,a,s,o)},o._fillBorderText=function(t,i,n,r,a,s,o,l,h){if(!U.enabled)return this._fillText(t,i,n,r,a,null,o,l||1,h),void this._fillText(t,i,n,r,a,s,null,-1,h);var c=this._shader2D,u=this._curSubmit.shaderValue;c.ALPHA!==u.ALPHA&&(c.glTexture=null);var _=a?(e._fontTemp.setFont(a),e._fontTemp):this._other.font;dt.drawText(this,t,i,this._curMat,_,h||this._other.textAlign,s,o,l||1,n,r,0)},o.fillRect=function(t,e,i,n,r){var a=this._vb;if(mt.fillRectImgVb(a,this._clipRect,t,e,i,n,N.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var s=this._shader2D.fillStyle;r&&(this._shader2D.fillStyle=W.create(r));var o=this._shader2D,l=this._curSubmit.shaderValue;if(o.fillStyle!==l.fillStyle||o.ALPHA!==l.ALPHA){o.glTexture=null;var h=this._curSubmit=at.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,wt.create(2,0));h.shaderValue.color=o.fillStyle._color._color,h.shaderValue.ALPHA=o.ALPHA,this._submits[this._submits._length++]=h}this._curSubmit._numEle+=6,this._shader2D.fillStyle=s}},o.fillTexture=function(t,e,n,r,a,s,o,l){if(t.loaded&&t.bitmap&&t.source){var h=this._vb,c=t.bitmap.width,u=t.bitmap.height,_=t.uv,d=o.x%t.width,f=o.y%t.height;if(c!=l.w||u!=l.h){if(!l.w&&!l.h)switch(l.oy=l.ox=0,s){case"repeat":l.width=r,l.height=a;break;case"repeat-x":l.width=r,f<0?t.height+f>a?l.height=a:l.height=t.height+f:(l.oy=f,t.height+f>a?l.height=a-f:l.height=t.height);break;case"repeat-y":d<0?t.width+d>r?l.width=r:l.width=t.width+d:(l.ox=d,t.width+d>r?l.width=r-d:l.width=t.width),l.height=a;break;default:l.width=r,l.height=a}l.w=c,l.h=u,l.uv=[0,0,l.width/c,0,l.width/c,l.height/u,0,l.height/u]}if(e+=l.ox,n+=l.oy,d-=l.ox,f-=l.oy,mt.fillRectImgVb(h,this._clipRect,e,n,l.width,l.height,l.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var p=Pt.create(this,this._ib,h,(h._byteLength-64)/32*3,wt.create(256,0));this._submits[this._submits._length++]=p;var m=p.shaderValue;m.textureHost=t;var g=_[0]*c,y=_[1]*u,v=(_[2]-_[0])*c,S=(_[5]-_[3])*u,x=-d/c,E=-f/u;m.u_TexRange[0]=g/c,m.u_TexRange[1]=v/c,m.u_TexRange[2]=y/u,m.u_TexRange[3]=S/u,m.u_offset[0]=x,m.u_offset[1]=E,U.enabled&&!this._isMain&&p.addTexture(t,(h._byteLength>>2)-16),this._curSubmit=p,p._renderType=10017,p._numEle+=6}}else this.sprite&&i.timer.callLater(this,this._repaintSprite)},o.setShader=function(t){Y.save(this,1048576,this._shader2D,!0),this._shader2D.shader=t},o.setFilters=function(t){Y.save(this,2097152,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=at.RENDERBASE,this._renderKey=0,this._drawCount++},o.drawTexture=function(t,e,i,n,r,a,s){this._drawTextureM(t,e,i,n,r,a,s,null,1)},o.addTextureVb=function(t,e,i){var n=this._curSubmit._vb||this._vb,r=n._byteLength>>2;n.byteLength=r+16<<2;for(var a=n.getFloat32Array(),s=0;s<16;s+=4)a[r++]=t[s]+e,a[r++]=t[s+1]+i,a[r++]=t[s+2],a[r++]=t[s+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),n._upload=!0},o.willDrawTexture=function(t,e){if(!(t.loaded&&t.bitmap&&t.source))return this.sprite&&i.timer.callLater(this,this._repaintSprite),0;var n=t.bitmap,r=n.id+this._shader2D.ALPHA*e+10016;if(r==this._renderKey)return r;var a=this._shader2D,s=a.ALPHA,o=this._curSubmit.shaderValue;a.ALPHA*=e,this._renderKey=r,this._drawCount++,a.glTexture=n;var l=this._vb,h=null,c=l._byteLength/32*3;return h=Pt.create(this,this._ib,l,c,wt.create(1,0)),this._submits[this._submits._length++]=h,h.shaderValue.textureHost=t,h._renderType=10016,h._preIsSameTextureShader=10016===this._curSubmit._renderType&&a.ALPHA===o.ALPHA,this._curSubmit=h,a.ALPHA=s,r},o.drawTextures=function(t,n,r,a){if(t.loaded&&t.bitmap&&t.source){var s=this._clipRect;if(this._clipRect=e.MAXCLIPRECT,this._drawTextureM(t,n[0],n[1],t.width,t.height,r,a,null,1)){if(this._clipRect=s,A.drawCall++,!(n.length<4)){for(var o=this._curSubmit._vb||this._vb,l=this._curMat.a,h=this._curMat.d,c=2,u=n.length;c<u;c+=2)mt.copyPreImgVb(o,(n[c]-n[c-2])*l,(n[c+1]-n[c-1])*h),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&i.timer.callLater(this,this._repaintSprite)},o._drawTextureM=function(t,e,n,r,a,s,o,l,h){if(!t.loaded||!t.source)return this.sprite&&i.timer.callLater(this,this._repaintSprite),!1;var c=this._curSubmit._vb||this._vb,u=t.bitmap;e+=s,n+=o,this._drawCount++;var _=u.id+this._shader2D.ALPHA*h+10016;if(_!=this._renderKey){this._renderKey=_;var d=this._curSubmit.shaderValue,f=this._shader2D,p=f.ALPHA;f.ALPHA*=h,f.glTexture=u;var m=this._vb,g=null,y=m._byteLength/32*3;g=Pt.create(this,this._ib,m,y,wt.create(1,0)),this._submits[this._submits._length++]=g,g.shaderValue.textureHost=t,g._renderType=10016,g._preIsSameTextureShader=10016===this._curSubmit._renderType&&f.ALPHA===d.ALPHA,this._curSubmit=g,c=this._curSubmit._vb||this._vb,f.ALPHA=p}return!!mt.fillRectImgVb(c,this._clipRect,e,n,r||t.width,a||t.height,t.uv,l||this._curMat,this._x,this._y,0,0)&&(U.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(c._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},o._repaintSprite=function(){this.sprite&&this.sprite.repaint()},o._drawText=function(t,e,i,n,r,a,s,o,l,h){var c=t.bitmap;this._drawCount++;var u=c.id+this._shader2D.ALPHA+10016;if(u!=this._renderKey){this._renderKey=u;var _=this._curSubmit.shaderValue,d=this._shader2D;d.glTexture=c;var f=this._vb,p=null,m=f._byteLength/32*3;(p=U.enabled?Pt.create(this,this._ib,f,m,wt.create(1,0)):Pt.create(this,this._ib,f,m,Zt.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&d.ALPHA===_.ALPHA,this._submits[this._submits._length++]=p,p.shaderValue.textureHost=t,p._renderType=10016,this._curSubmit=p}t.active();var g=this._curSubmit._vb||this._vb;mt.fillRectImgVb(g,this._clipRect,e+s,i+o,n||t.width,r||t.height,t.uv,a||this._curMat,this._x,this._y,l,h,!0)&&(U.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(g._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},o.drawTextureWithTransform=function(t,i,n,r,a,s,o,l,h){if(s){var c=this._curMat,u=this._x,_=this._y;(0!==o||0!==l)&&(this._x=o*c.a+l*c.c,this._y=l*c.d+o*c.b),s&&c.bTransform?(S.mul(s,c,e._tmpMatrix),(s=e._tmpMatrix)._checkTransform()):(this._x+=c.tx,this._y+=c.ty),this._drawTextureM(t,i,n,r,a,0,0,s,h),this._x=u,this._y=_}else this._drawTextureM(t,i,n,r,a,o,l,null,h)},o.fillQuadrangle=function(t,e,i,n,r){var a=this._curSubmit,s=this._vb,o=this._shader2D,l=a.shaderValue;if(this._renderKey=0,t.bitmap){var h=t.bitmap;o.glTexture==h&&o.ALPHA===l.ALPHA||(o.glTexture=h,(a=this._curSubmit=at.createSubmit(this,this._ib,s,s._byteLength/32*3,wt.create(1,0))).shaderValue.glTexture=h,this._submits[this._submits._length++]=a),mt.fillQuadrangleImgVb(s,e,i,n,t.uv,r||this._curMat,this._x,this._y)}else a.shaderValue.fillStyle&&a.shaderValue.fillStyle.equal(t)&&o.ALPHA===l.ALPHA||(o.glTexture=null,(a=this._curSubmit=at.createSubmit(this,this._ib,s,s._byteLength/32*3,wt.create(2,0))).shaderValue.defines.add(2),a.shaderValue.fillStyle=W.create(t),this._submits[this._submits._length++]=a),mt.fillQuadrangleImgVb(s,e,i,n,N.DEF_UV,r||this._curMat,this._x,this._y);a._numEle+=6},o.drawTexture2=function(t,i,n,r,a,s,o,l){if(0!=s){var h=this._curMat;if(this._x=t*h.a+i*h.c,this._y=i*h.d+t*h.b,a&&(h.bTransform||a.bTransform?(S.mul(a,h,e._tmpMatrix),a=e._tmpMatrix):(this._x+=a.tx+h.tx,this._y+=a.ty+h.ty,a=S.EMPTY)),1!==s||o){var c=this._shader2D.ALPHA,u=this._nBlendType;this._shader2D.ALPHA=s,o&&(this._nBlendType=G.TOINT(o)),this._drawTextureM(l[0],l[1]-n,l[2]-r,l[3],l[4],0,0,a,1),this._shader2D.ALPHA=c,this._nBlendType=u}else this._drawTextureM(l[0],l[1]-n,l[2]-r,l[3],l[4],0,0,a,1);this._x=this._y=0}},o.drawCanvas=function(t,e,i,n,r){var a=t.context;if(this._renderKey=0,a._targets)this._submits[this._submits._length++]=Lt.create(a,0,null),this._curSubmit=at.RENDERBASE,a._targets.drawTo(this,e,i,n,r);else{var s=this._submits[this._submits._length++]=Lt.create(a,this._shader2D.ALPHA,this._shader2D.filters),o=n/t.width,l=r/t.height,h=s._matrix;this._curMat.copyTo(h),1!=o&&1!=l&&h.scale(o,l);var c=h.tx,u=h.ty;h.tx=h.ty=0,h.transformPoint(x.TEMP.setTo(e,i)),h.translate(x.TEMP.x+c,x.TEMP.y+u),this._curSubmit=at.RENDERBASE}d.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=a._targets?"yellow":"green",this.strokeRect(e-1,i-1,n+2,r+2,1),this.strokeRect(e,i,n,r,1),this.restore())},o.drawTarget=function(t,e,i,n,r,a,s,o,l,h){void 0===h&&(h=-1);var c=this._vb;if(mt.fillRectImgVb(c,this._clipRect,e,i,n,r,l||N.DEF_UV,a||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null,this._curSubmit.shaderValue;var u=this._curSubmit=ut.create(this,this._ib,c,(c._byteLength-64)/32*3,o,s);u.blendType=-1==h?this._nBlendType:h,u.scope=t,this._submits[this._submits._length++]=u,this._curSubmit._numEle+=6}},o.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},o._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},o.drawTriangles=function(t,n,r,a,s,o,l,h,c,u){if(!t.loaded||!t.source)return this.sprite&&i.timer.callLater(this,this._repaintSprite),!1;this._drawCount++,t.bitmap;var _=this._mixRGBandAlpha(4294967295,h),d=(a.length,o.length);this._renderKey=-1;var f=this._curSubmit=Pt.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,wt.create(1,0));return f.shaderValue.textureHost=t,f._renderType=10016,this._submits[this._submits._length++]=f,l?(e._tmpMatrix.a=l.a,e._tmpMatrix.b=l.b,e._tmpMatrix.c=l.c,e._tmpMatrix.d=l.d,e._tmpMatrix.tx=l.tx+n,e._tmpMatrix.ty=l.ty+r,S.mul(e._tmpMatrix,this._curMat,e._tmpMatrix)):(e._tmpMatrix.a=this._curMat.a,e._tmpMatrix.b=this._curMat.b,e._tmpMatrix.c=this._curMat.c,e._tmpMatrix.d=this._curMat.d,e._tmpMatrix.tx=this._curMat.tx+n,e._tmpMatrix.ty=this._curMat.ty+r),this._triangleMesh.addData(a,s,o,e._tmpMatrix,_,this),this._curSubmit._numEle+=d,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},o.transform=function(t,e,i,n,r,a){q.save(this),S.mul(S.TEMP.setTo(t,e,i,n,r,a),this._curMat,this._curMat),this._curMat._checkTransform()},o.setTransformByMatrix=function(t){t.copyTo(this._curMat)},o.transformByMatrix=function(t){q.save(this),S.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},o.rotate=function(t){q.save(this),this._curMat.rotateEx(t)},o.scale=function(t,e){q.save(this),this._curMat.scaleEx(t,e)},o.clipRect=function(t,e,i,n){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var r=ct.create(4);this.addRenderObject(r);var a=this._vb,s=a._byteLength>>2;if(mt.fillRectImgVb(a,null,t,e,i,n,N.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var o=this._curSubmit=at.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,wt.create(2,0));o.shaderValue.ALPHA=1,this._submits[this._submits._length++]=o,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var l=ct.create(5);this.addRenderObject(l);var h=a.getFloat32Array(),c=Math.min(Math.min(Math.min(h[s+0],h[s+4]),h[s+8]),h[s+12]),u=Math.max(Math.max(Math.max(h[s+0],h[s+4]),h[s+8]),h[s+12]),_=Math.min(Math.min(Math.min(h[s+1],h[s+5]),h[s+9]),h[s+13]),d=Math.max(Math.max(Math.max(h[s+1],h[s+5]),h[s+9]),h[s+13]);j.save(this,l,t,e,i,n,c,_,u-c,d-_),this._curSubmit=at.RENDERBASE}else{i*=this._curMat.a,n*=this._curMat.d;var f=x.TEMP;this._curMat.transformPoint(f.setTo(t,e)),i<0&&(f.x=f.x+i,i=-i),n<0&&(f.y=f.y+n,n=-n),this._renderKey=0;var p=this._curSubmit=ht.create(this);this._submits[this._submits._length++]=p,p.submitIndex=this._submits._length,p.submitLength=9999999,X.save(this,p);var m=this._clipRect,g=m.x,y=m.y,v=f.x+i,S=f.y+n;g<f.x&&(m.x=f.x),y<f.y&&(m.y=f.y),m.width=Math.min(v,g+m.width)-m.x,m.height=Math.min(S,y+m.height)-m.y,this._shader2D.glTexture=null,p.clipRect.copyFrom(m),this._curSubmit=at.RENDERBASE}},o.setIBVB=function(t,e,i,n,r,a,s,o,l,h,c){if(void 0===l&&(l=0),void 0===h&&(h=0),void 0===c&&(c=0),null===i){if(T.isFlash){var u=n;u._selfIB||(u._selfIB=$t.create(35044)),u._selfIB.clear(),i=u._selfIB}else i=this._ib;mt.expandIBQuadrangle(i,n._byteLength/(4*n.vertexStride*4))}if(!o||!s)throw Error("setIBVB must input:shader shaderValues");var _=lt.create(this,n,i,r,s,o,l,h,c);a||(a=S.EMPTY),a.translate(t,e),S.mul(a,this._curMat,_._mat),a.translate(-t,-e),this._submits[this._submits._length++]=_,this._curSubmit=at.RENDERBASE,this._renderKey=0},o.addRenderObject=function(t){this._submits[this._submits._length++]=t},o.fillTrangles=function(t,e,i,n,r){var a=this._curSubmit,s=this._vb,o=this._shader2D,l=a.shaderValue,h=n.length>>4,c=t.bitmap;this._renderKey=0,o.glTexture==c&&o.ALPHA===l.ALPHA||((a=this._curSubmit=at.createSubmit(this,this._ib,s,s._byteLength/32*3,wt.create(1,0))).shaderValue.textureHost=t,this._submits[this._submits._length++]=a),mt.fillTranglesVB(s,e,i,n,r||this._curMat,this._x,this._y),a._numEle+=6*h},o.submitElement=function(t,e){var i=this._submits;for(e<0&&(e=i._length);t<e;)t+=i[t].renderSubmit()},o.finish=function(){St.mainContext.finish()},o.flush=function(){var t=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(t>this._ib.bufferLength/12&&mt.expandIBQuadrangle(this._ib,t),!this._isMain&&U.enabled&&U._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=U._atlasRestore;for(var e=this._submits,i=0,n=e._length;i<n;i++){var r=e[i];10016===r.getRenderType()&&r.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),et.instance&&et.getInstance().reset();var a;for(i=0,a=this.meshlist.length;i<a;i++){var s=this.meshlist[i];s.canReuse?s.releaseMesh():s.destroy()}return this.meshlist.length=0,this._curSubmit=at.RENDERBASE,this._renderKey=0,this._triangleMesh=Nt.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},o.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=V.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},o.movePath=function(t,e){var i=t,n=e;t=this._curMat.a*i+this._curMat.c*n+this._curMat.tx,e=this._curMat.b*i+this._curMat.d*n+this._curMat.ty,this.mX+=t,this.mY+=e},o.beginPath=function(){var t=this._getPath();t.tempArray.length=0,t.closePath=!1,this.mX=0,this.mY=0},o.closePath=function(){this._path.closePath=!0},o.fill=function(t){void 0===t&&(t=!1);var e=this._getPath();this.drawPoly(0,0,e.tempArray,this.fillStyle._color.numColor,0,0,t)},o.stroke=function(){var t=this._getPath();if(this.lineWidth>0){if(-1==this.mId)t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var e=V.getInstance().shapeLineDic[this.mId];e.rebuild(t.tempArray),t.setGeomtry(e)}else V.getInstance().addLine(this.mId,t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor));t.update();var i=[this.mX,this.mY],n=at.createShape(this,t.ib,t.vb,t.count,t.offset,wt.create(4,0));n.shaderValue.ALPHA=this._shader2D.ALPHA,n.shaderValue.u_pos=i,n.shaderValue.u_mmat2=yt.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=n,this._renderKey=-1}},o.line=function(t,e,i,n,r,a){var s=this._curSubmit,o=this._vb;if(mt.fillLineVb(o,this._clipRect,t,e,i,n,r,a)){this._renderKey=0;var l=this._shader2D,h=s.shaderValue;l.strokeStyle===h.strokeStyle&&l.ALPHA===h.ALPHA||(l.glTexture=null,(s=this._curSubmit=at.createSubmit(this,this._ib,o,(o._byteLength-64)/32*3,wt.create(2,0))).shaderValue.strokeStyle=l.strokeStyle,s.shaderValue.mainID=2,s.shaderValue.ALPHA=l.ALPHA,this._submits[this._submits._length++]=s),s._numEle+=6}},o.moveTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a,e=this._curMat.b*r+this._curMat.d*a}n.addPoint(t,e)},o.lineTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a,e=this._curMat.b*r+this._curMat.d*a}n.addPoint(t,e)},o.drawCurves=function(t,e,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],this.movePath(t,e),this.moveTo(n[0],n[1]);for(var r=2,a=n.length;r<a;)this.quadraticCurveTo(n[r++],n[r++],n[r++],n[r++]);this.stroke()},o.arcTo=function(t,i,n,r,a){if(-1==this.mId||!this.mHaveKey){var s=0,o=0,l=0,h=this._getPath();this._curMat.copyTo(e._tmpMatrix),e._tmpMatrix.tx=e._tmpMatrix.ty=0,e._tempPoint.setTo(h.getEndPointX(),h.getEndPointY()),e._tmpMatrix.invertTransformPoint(e._tempPoint);var c=e._tempPoint.x-t,u=e._tempPoint.y-i,_=Math.sqrt(c*c+u*u);if(!(_<=1e-6)){var d=c/_,f=u/_,p=n-t,m=r-i,g=p*p+m*m,y=Math.sqrt(g);if(!(y<=1e-6)){var v=p/y,S=m/y,x=d+v,E=f+S,T=Math.sqrt(x*x+E*E);if(!(T<=1e-6)){var w=x/T,C=E/T,b=Math.acos(w*d+C*f),M=Math.PI/2-b,I=(_=a/Math.tan(M))*d+t,D=_*f+i,A=Math.sqrt(_*_+a*a),R=t+w*A,L=i+C*A,P=0,N=0;if(d*S-f*v>=0){var O=2*M/e.SEGNUM;P=Math.sin(O),N=Math.cos(O)}else O=2*-M/e.SEGNUM,P=Math.sin(O),N=Math.cos(O);o=this._curMat.a*I+this._curMat.c*D,l=this._curMat.b*I+this._curMat.d*D,o==this._path.getEndPointX()&&l==this._path.getEndPointY()||h.addPoint(o,l);var V=I-R,k=D-L;for(s=0;s<e.SEGNUM;s++){var F=V*N+k*P,B=-V*P+k*N;o=F+R,l=B+L,t=this._curMat.a*o+this._curMat.c*l,l=i=this._curMat.b*o+this._curMat.d*l,(o=t)==this._path.getEndPointX()&&l==this._path.getEndPointY()||h.addPoint(o,l),V=F,k=B}}}}}},o.arc=function(t,e,i,n,r,a,s){if(void 0===a&&(a=!1),void 0===s&&(s=!0),-1!=this.mId){var o=V.getInstance().shapeDic[this.mId];if(o&&this.mHaveKey&&!o.needUpdate(this._curMat))return;t=0,e=0}var l,h,c=0,u=0,_=0,d=0,f=0,p=0;if(u=r-n,a)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;u>0;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;l=u/(h=i<101?Math.max(10,u*i/5):i<201?Math.max(10,u*i/20):Math.max(10,u*i/40))/2,_=Math.abs(4/3*(1-Math.cos(l))/Math.sin(l)),a&&(_=-_);var m=this._getPath(),g=NaN,y=NaN;for(p=0;p<=h;p++)c=n+u*(p/h),d=t+Math.cos(c)*i,f=e+Math.sin(c)*i,s&&(g=d,y=f,d=this._curMat.a*g+this._curMat.c*y,f=this._curMat.b*g+this._curMat.d*y),d==this._path.getEndPointX()&&f==this._path.getEndPointY()||m.addPoint(d,f);d=t+Math.cos(r)*i,f=e+Math.sin(r)*i,s&&(g=d,y=f,d=this._curMat.a*g+this._curMat.c*y,f=this._curMat.b*g+this._curMat.d*y),d==this._path.getEndPointX()&&f==this._path.getEndPointY()||m.addPoint(d,f)},o.quadraticCurveTo=function(t,e,i,n){var r=l.I,a=i,s=n;i=this._curMat.a*a+this._curMat.c*s,n=this._curMat.b*a+this._curMat.d*s,a=t,s=e,t=this._curMat.a*a+this._curMat.c*s,e=this._curMat.b*a+this._curMat.d*s;for(var o=r.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),t,e,i,n],30,2),h=0,c=o.length/2;h<c;h++)this.lineTo(o[2*h],o[2*h+1],!1);this.lineTo(i,n,!1)},o.rect=function(t,e,i,n){this._other=this._other.make(),this._other.path||(this._other.path=new z),this._other.path.rect(t,e,i,n)},o.strokeRect=function(t,e,i,n,r){var a=.5*r;this.line(t-a,e,t+i+a,e,r,this._curMat),this.line(t+i,e,t+i,e+n,r,this._curMat),this.line(t,e,t,e+n,r,this._curMat),this.line(t-a,e+n,t+i+a,e+n,r,this._curMat)},o.clip=function(){},o.drawPoly=function(t,e,i,n,r,a,s){void 0===s&&(s=!1),this._renderKey=0,this._shader2D.glTexture=null;var o=this._getPath();if(-1==this.mId)o.polygon(t,e,i,n,r||1,a);else if(this.mHaveKey){var l=V.getInstance().shapeDic[this.mId];l.setMatrix(this._curMat),l.rebuild(o.tempArray),o.setGeomtry(l)}else{var h=o.polygon(t,e,i,n,r||1,a);V.getInstance().addShape(this.mId,h),h.setMatrix(this._curMat)}o.update();var c,u=[this.mX,this.mY];if((c=at.createShape(this,o.ib,o.vb,o.count,o.offset,wt.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_pos=u,c.shaderValue.u_mmat2=yt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c,r>0){if(this.mHaveLineKey){var _=V.getInstance().shapeLineDic[this.mId];_.rebuild(o.tempArray),o.setGeomtry(_)}else V.getInstance().addShape(this.mId,o.drawLine(t,e,i,r,a));o.update(),(c=at.createShape(this,o.ib,o.vb,o.count,o.offset,wt.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_mmat2=yt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c}},o.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},o._getPath=function(){return this._path||(this._path=new z)},a(0,o,"globalCompositeOperation",function(){return G.NAMES[this._nBlendType]},function(t){var e=G.TOINT[t];null==e||this._nBlendType===e||(Y.save(this,65536,this,!0),this._curSubmit=at.RENDERBASE,this._renderKey=0,this._nBlendType=e)}),a(0,o,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(Y.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=W.create(t))}),a(0,o,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(Y.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)}),a(0,o,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new Q),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),a(0,o,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(Y.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=W.create(t))}),a(0,o,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),Y.save(this,32768,this._other,!1),this._other.textAlign=t)}),a(0,o,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),Y.save(this,256,this._other,!1),this._other.lineWidth=t)}),a(0,o,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),Y.save(this,16384,this._other,!1),this._other.textBaseline=t)}),a(0,o,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),Y.save(this,8,this._other,!1),this._other.font===ft.EMPTY?this._other.font=new ft(t):this._other.font.setFont(t))}),e.__init__=function(){s.DEFAULT=new s},e._tempPoint=new x,e._SUBMITVBSIZE=32e3,e._MAXSIZE=99999999,e._RECTVBSIZE=16,e.MAXCLIPRECT=new E(0,0,99999999,99999999),e._COUNT=0,e._tmpMatrix=new S,e.SEGNUM=32,e._contextcount=0,n(e,["_fontTemp",function(){return this._fontTemp=new ft},"_drawStyleTemp",function(){return this._drawStyleTemp=new W(null)}]),e.__init$=function(){s=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=ft.EMPTY}r(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=ft.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},e}(),wt=function(t){function e(t,i){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,e.__super.call(this),this.defines=new It,this.position=e._POSITION,this.mainID=t,this.subID=i,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=t|i,this._inClassCache=e._cache[this._cacheID],t>0&&!this._inClassCache&&(this._inClassCache=e._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}r(e,"laya.webgl.shader.d2.value.Value2D",F);var i=e.prototype;return i.setValue=function(t){},i.refresh=function(){var t=this.size;return t[0]=yt.width,t[1]=yt.height,this.alpha=this.ALPHA*yt.worldAlpha,this.mmat=yt.worldMatrix4,this},i._ShaderWithCompile=function(){return Kt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Qt.create)},i._withWorldShaderDefines=function(){var t=yt.worldShaderDefines,e=Kt.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,n={};for(i in this.defines.toNameDic())n[i]="";for(i in t.toNameDic())n[i]="";e=Kt.withCompile2D(0,this.mainID,n,this.mainID|this.defines._value|t.getValue(),Qt.create)}var r=yt.worldFilters;if(!r)return e;for(var a,s=r.length,o=0;o<s;o++)(a=r[o])&&a.action.setValue(this);return e},i.upload=function(){var t=yt;this.alpha=this.ALPHA*t.worldAlpha,yt.worldMatrix4!==yt.TEMPMAT4_ARRAY&&this.defines.add(128),St.shaderHighPrecision&&this.defines.add(1024);var e,i=t.worldShaderDefines?this._withWorldShaderDefines():Kt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=t.width,this.size[1]=t.height,this.mmat=t.worldMatrix4,Ot.activeShader!==i?(i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick2||i._make2dQuick2(),i.upload(this,e)):(i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick1||i._make2dQuick1(),i.upload(this,e))},i.setFilters=function(t){if(this.filters=t,t)for(var e,i=t.length,n=0;n<i;n++)(e=t[n])&&(this.defines.add(e.type),e.action.setValue(this))},i.clear=function(){this.defines.setValue(this.subID)},i.release=function(){this._inClassCache[this._inClassCache._length++]=this,this.fillStyle=null,this.strokeStyle=null,this.clear()},e._initone=function(t,i){e._typeClass[t]=i,e._cache[t]=[],e._cache[t]._length=0},e.__init__=function(){e._POSITION=[2,5126,!1,4*pt.BYTES_PE,0],e._TEXCOORD=[2,5126,!1,4*pt.BYTES_PE,2*pt.BYTES_PE],e._initone(2,Bt),e._initone(4,Gt),e._initone(256,Ut),e._initone(512,Ft),e._initone(1,Ht),e._initone(65,Zt),e._initone(9,Ht)},e.create=function(t,i){var n=e._cache[t|i];return n._length?n[--n._length]:new e._typeClass[t|i](i)},e._POSITION=null,e._TEXCOORD=null,e._cache=[],e._typeClass=[],e.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e}(),Ct=function(t){function e(t,i){e.__super.call(this,t,i)}r(e,"laya.webgl.utils.RenderSprite3D",w);var i=e.prototype;return i.onCreate=function(t){switch(t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},i._mask=function(t,i,n,r){var a,s,o=this._next,l=t.mask;if(l){i.ctx.save();var h=i.ctx.globalCompositeOperation,c=new E;if(c.copyFrom(l.getBounds()),c.width=Math.round(c.width),c.height=Math.round(c.height),c.x=Math.round(c.x),c.y=Math.round(c.y),c.width>0&&c.height>0){var u=t._style._tf,_=ot.create();_.addValue("bounds",c),a=st.create([_,i],laya.webgl.utils.RenderSprite3D.tmpTarget),i.addRenderObject(a),l.render(i,-c.x,-c.y),a=st.create([_],laya.webgl.utils.RenderSprite3D.endTmpTarget),i.addRenderObject(a),i.ctx.save(),i.clipRect(n-u.translateX+c.x,r-u.translateY+c.y,c.width,c.height),o._fun.call(o,t,i,n,r),i.ctx.restore(),s=ct.create(6),h=i.ctx.globalCompositeOperation,s.blendMode="mask",i.addRenderObject(s),S.TEMP.identity();var d=wt.create(1,0),f=N.INV_UV,p=c.width,m=c.height;(c.width<32||c.height<32)&&((f=e.tempUV)[0]=0,f[1]=0,f[2]=c.width>=32?1:c.width/32,f[3]=0,f[4]=c.width>=32?1:c.width/32,f[5]=c.height>=32?1:c.height/32,f[6]=0,f[7]=c.height>=32?1:c.height/32,c.width=c.width>=32?c.width:32,c.height=c.height>=32?c.height:32,f[1]*=-1,f[3]*=-1,f[5]*=-1,f[7]*=-1,f[1]+=1,f[3]+=1,f[5]+=1,f[7]+=1),i.ctx.drawTarget(_,n+c.x-u.translateX,r+c.y-u.translateY,p,m,S.TEMP,"tmpTarget",d,f,6),a=st.create([_],laya.webgl.utils.RenderSprite3D.recycleTarget),i.addRenderObject(a),(s=ct.create(6)).blendMode=h,i.addRenderObject(s)}i.ctx.restore()}else o._fun.call(o,t,i,n,r)},i._blend=function(t,e,i,n){var r=t._style,a=this._next;r.blendMode?(e.ctx.save(),e.ctx.globalCompositeOperation=r.blendMode,a._fun.call(a,t,e,i,n),e.ctx.restore()):a._fun.call(a,t,e,i,n)},i._transform=function(t,e,i,n){var r=t.transform,a=this._next;if(r&&a!=w.NORENDER){var s=e.ctx;t._style,r.tx=i,r.ty=n;var o=s._getTransformMatrix(),l=o.clone();S.mul(r,o,o),o._checkTransform(),r.tx=r.ty=0,a._fun.call(a,t,e,0,0),l.copyTo(o),l.destroy()}else a._fun.call(a,t,e,i,n)},e.tmpTarget=function(t,e){var i=t.getValue("bounds"),n=Vt.create(i.width,i.height);n.start(),n.clear(0,0,0,0),t.addValue("tmpTarget",n)},e.endTmpTarget=function(t){t.getValue("tmpTarget").end()},e.recycleTarget=function(t){t.getValue("tmpTarget").recycle(),t.recycle()},n(e,["tempUV",function(){return this.tempUV=new Array(8)}]),e}(),bt=function(t){function e(){this.data=null,e.__super.call(this)}r(e,"laya.filters.webgl.ColorFilterActionGL",k);var n=e.prototype;return i.imps(n,{"laya.filters.IFilterActionGL":!0}),n.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},n.apply3d=function(t,e,i,n,r){var a=t.getValue("bounds"),s=wt.create(1,0);s.setFilters([this.data]);var o=S.TEMP;o.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,o,"src",s)},e}(),Mt=function(t){function e(t,i,n,r,a){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,e.__super.call(this,t,i,a),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new Wt,this._atlasCanvas._atlaser=this,this._atlasCanvas.width=n,this._atlasCanvas.height=r,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}r(e,"laya.webgl.atlas.Atlaser",B);var i=e.prototype;return i.computeUVinAtlasTexture=function(t,e,i,n){var r=U.atlasTextureWidth,a=U.atlasTextureHeight,s=i/r,o=n/a,l=(i+t.bitmap.width)/r,h=(n+t.bitmap.height)/a,c=t.bitmap.width/r,u=t.bitmap.height/a;t.uv=[s+e[0]*c,o+e[1]*u,l-(1-e[2])*c,o+e[3]*u,l-(1-e[4])*c,h-(1-e[5])*u,s+e[6]*c,h-(1-e[7])*u]},i.findBitmapIsExist=function(t){if(t instanceof laya.webgl.resource.WebGLImage){var e=t,i=e.url,n=this._InAtlasWebGLImagesKey[i||e.id];if(n)return n.offsetInfoID}return-1},i.addToAtlasTexture=function(t,e,i){if(t instanceof laya.webgl.resource.WebGLImage){var n=t,r=n.url;this._InAtlasWebGLImagesKey[r||n.id]={bitmap:t,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([e,i])}this._atlasCanvas.texSubImage2D(e,i,t.atlasSource),t.clearAtlasSource()},i.addToAtlas=function(t,e,i){t._atlasID=this._inAtlasTextureKey.length;var n=t.uv.slice(),r=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(n),this._inAtlasTextureBitmapValue.push(r),this.computeUVinAtlasTexture(t,n,e,i),t.bitmap=this._atlasCanvas},i.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t]._atlasID=-1,this._inAtlasTextureKey[t].bitmap.lock=!1,this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},i.dispose=function(){this.clear(),this._atlasCanvas.destroy()},a(0,i,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),a(0,i,"texture",function(){return this._atlasCanvas}),a(0,i,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),e}(),It=function(t){function e(){e.__super.call(this,e.__name2int,e.__int2name,e.__int2nameMap)}return r(e,"laya.webgl.shader.d2.ShaderDefines2D",J),e.__init__=function(){e.reg("TEXTURE2D",1),e.reg("COLOR2D",2),e.reg("PRIMITIVE",4),e.reg("GLOW_FILTER",8),e.reg("BLUR_FILTER",16),e.reg("COLOR_FILTER",32),e.reg("COLOR_ADD",64),e.reg("WORLDMAT",128),e.reg("FILLTEXTURE",256),e.reg("FSHIGHPRECISION",1024)},e.reg=function(t,i){J._reg(t,i,e.__name2int,e.__int2name)},e.toText=function(t,e,i){return J._toText(t,e,i)},e.toInt=function(t){return J._toInt(t,e.__name2int)},e.TEXTURE2D=1,e.COLOR2D=2,e.PRIMITIVE=4,e.FILTERGLOW=8,e.FILTERBLUR=16,e.FILTERCOLOR=32,e.COLORADD=64,e.WORLDMAT=128,e.FILLTEXTURE=256,e.SKINMESH=512,e.SHADERDEFINE_FSHIGHPRECISION=1024,e.__name2int={},e.__int2name=[],e.__int2nameMap=[],e}(),Dt=(function(t){r(function t(e,i,n,r,a,s,o){t.__super.call(this,e,i,n,r,40,a,s,o)},"laya.webgl.shapes.Ellipse",it)}(),function(t){function e(t,i,n,r,a){this._points=[],this.rebuild(n),e.__super.call(this,t,i,0,0,0,a,r,a,0)}r(e,"laya.webgl.shapes.Line",it);var i=e.prototype;return i.rebuild=function(t){var e=t.length;e!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(e/2-1)),this.mFloat32Array=new Float32Array(5*e)),this._points.length=0;for(var i=NaN,n=NaN,r=-1,a=-1,s=t.length/2,o=0;o<s;o++)i=t[2*o],n=t[2*o+1],(Math.abs(r-i)>.01||Math.abs(a-n)>.01)&&this._points.push(i,n),r=i,a=n},i.getData=function(t,e,i){var n=[],r=[];this.borderWidth>0&&this.createLine2(this._points,n,this.borderWidth,i,r,this._points.length/2),this.mUint16Array.set(n,0),this.mFloat32Array.set(r,0),t.append(this.mUint16Array),e.append(this.mFloat32Array)},e}()),At=function(t){function e(t,i,n,r,a){this._points=[];for(var s=NaN,o=NaN,l=-1,h=-1,c=n.length/2-1,u=0;u<c;u++)s=n[2*u],o=n[2*u+1],(Math.abs(l-s)>.01||Math.abs(h-o)>.01)&&this._points.push(s,o),l=s,h=o;s=n[2*c],o=n[2*c+1],l=this._points[0],h=this._points[1],(Math.abs(l-s)>.01||Math.abs(h-o)>.01)&&this._points.push(s,o),e.__super.call(this,t,i,0,0,this._points.length/2,0,r,a)}r(e,"laya.webgl.shapes.LoopLine",it);var i=e.prototype;return i.getData=function(t,e,i){if(this.borderWidth>0){for(var n=this.color,r=(n>>16&255)/255,a=(n>>8&255)/255,s=(255&n)/255,o=[],l=0,h=0,c=[],u=Math.floor(this._points.length/2),_=0;_<u;_++)l=this._points[2*_],h=this._points[2*_+1],o.push(this.x+l,this.y+h,r,a,s);this.createLoopLine(o,c,this.borderWidth,i+o.length/5),t.append(new Uint16Array(c)),e.append(new Float32Array(o))}},i.createLoopLine=function(t,e,i,n,r,a){t.length;var s=t.concat(),o=r||t,l=this.borderColor,h=(l>>16&255)/255,c=(l>>8&255)/255,u=(255&l)/255,_=[s[0],s[1]],d=[s[s.length-5],s[s.length-4]],f=d[0]+.5*(_[0]-d[0]),p=d[1]+.5*(_[1]-d[1]);s.unshift(f,p,0,0,0),s.push(f,p,0,0,0);var m,g,y,v,S,x,E,T,w,C,b,M,I,D,A,R,L,P,N,O,V=s.length/5,k=n,F=i/2;y=s[0],v=s[1],C=y-(S=s[5]),w=(w=-(v-(x=s[6])))/(O=Math.sqrt(w*w+C*C))*F,C=C/O*F,o.push(y-w,v-C,h,c,u,y+w,v+C,h,c,u);for(var B=1;B<V-1;B++)y=s[5*(B-1)],v=s[5*(B-1)+1],S=s[5*B],x=s[5*B+1],E=s[5*(B+1)],T=s[5*(B+1)+1],C=y-S,M=S-E,A=(-(w=(w=-(v-x))/(O=Math.sqrt(w*w+C*C))*F)+y)*(-(C=C/O*F)+x)-(-w+S)*(-C+v),P=(-(b=(b=-(x-T))/(O=Math.sqrt(b*b+M*M))*F)+E)*(-(M=M/O*F)+x)-(-b+S)*(-M+T),N=(I=-C+v-(-C+x))*(L=-b+S-(-b+E))-(R=-M+T-(-M+x))*(D=-w+S-(-w+y)),Math.abs(N)<.1?(N+=10.1,o.push(S-w,x-C,h,c,u,S+w,x+C,h,c,u)):(m=(D*P-L*A)/N,g=(R*A-I*P)/N,o.push(m,g,h,c,u,S-(m-S),x-(g-x),h,c,u));a&&(e=a);var U=this.edges+1;for(B=1;B<U;B++)e.push(k+2*(B-1),k+2*(B-1)+1,k+2*B+1,k+2*B+1,k+2*B,k+2*(B-1));return e.push(k+2*(B-1),k+2*(B-1)+1,k+1,k+1,k,k+2*(B-1)),o},e}(),Rt=function(t){function e(t,i,n,r,a,s){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=S.create(),this._points=n.slice(0,n.length),e.__super.call(this,t,i,0,0,this._points.length/2,r,a,s)}r(e,"laya.webgl.shapes.Polygon",it);var i=e.prototype;return i.rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},i.setMatrix=function(t){t.copyTo(this._mat)},i.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},i.getData=function(t,e,i){var n,r=0,a=this._points,s=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,n=[],s=this.earcutTriangles.length,r=0;r<s;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n)}}else{this._start=i,n=[];var o=[],l=[],h=this.color,c=(h>>16&255)/255,u=(h>>8&255)/255,_=(255&h)/255;for(s=Math.floor(a.length/2),r=0;r<s;r++)o.push(this.x+a[2*r],this.y+a[2*r+1],c,u,_),l.push(this.x+a[2*r],this.y+a[2*r+1]);for(this.earcutTriangles=nt.earcut(l,null,2),s=this.earcutTriangles.length,r=0;r<s;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n),this.mFloat32Array=new Float32Array(o)}t.append(this.mUint16Array),e.append(this.mFloat32Array)},e}(),Lt=function(t){function e(){this._matrix=new S,this._matrix4=pt.defaultMatrix4.concat(),e.__super.call(this,1e4),this.shaderValue=new wt(0,0)}r(e,"laya.webgl.submit.SubmitCanvas",at);var i=e.prototype;return i.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=yt.worldAlpha,e=yt.worldMatrix4,i=yt.worldMatrix,n=yt.worldFilters,r=yt.worldShaderDefines,a=this.shaderValue,s=this._matrix,o=this._matrix4,l=S.TEMP;return S.mul(s,i,l),o[0]=l.a,o[1]=l.b,o[4]=l.c,o[5]=l.d,o[12]=l.tx,o[13]=l.ty,yt.worldMatrix=l.clone(),yt.worldMatrix4=o,yt.worldAlpha=yt.worldAlpha*a.alpha,a.filters&&a.filters.length&&(yt.worldFilters=a.filters,yt.worldShaderDefines=a.defines),this._ctx_src.flush(),yt.worldAlpha=t,yt.worldMatrix4=e,yt.worldMatrix.destroy(),yt.worldMatrix=i,yt.worldFilters=n,yt.worldShaderDefines=r,1},i.releaseRender=function(){var t=e._cache;this._ctx_src=null,t[t._length++]=this},i.getRenderType=function(){return 10003},e.create=function(t,i,n){var r=e._cache._length?e._cache[--e._cache._length]:new e;r._ctx_src=t;var a=r.shaderValue;return a.alpha=i,a.defines.setValue(0),n&&n.length&&a.setFilters(n),r},e._cache=(e._cache=[],e._cache._length=0,e._cache),e}(),Pt=function(t){function e(t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===t&&(t=1e4),e.__super.call(this,t)}r(e,"laya.webgl.submit.SubmitTexture",at);var i=e.prototype;return i.releaseRender=function(){var t=e._cache;t[t._length++]=this,this.shaderValue.release(),this._preIsSameTextureShader=!1,this._vb=null,this._texs.length=0,this._vbPos.length=0,this._isSameTexture=!0},i.addTexture=function(t,e){this._texsID[this._texs.length]=t._uvID,this._texs.push(t),this._vbPos.push(e)},i.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var t=this.shaderValue.textureHost.bitmap;if(null!==t)for(var e=this._vb.getFloat32Array(),i=0,n=this._texs.length;i<n;i++){var r=this._texs[i];r.active();var a=r.uv;if(this._texsID[i]!==r._uvID){this._texsID[i]=r._uvID;var s=this._vbPos[i];e[s+2]=a[0],e[s+3]=a[1],e[s+6]=a[2],e[s+7]=a[3],e[s+10]=a[4],e[s+11]=a[5],e[s+14]=a[6],e[s+15]=a[7],this._vb.setNeedUpload()}r.bitmap!==t&&(this._isSameTexture=!1)}}},i.renderSubmit=function(){if(0===this._numEle)return e._shaderSet=!1,1;var t=this.shaderValue.textureHost;if(t){var i=t.source;if(!t.bitmap||!i)return e._shaderSet=!1,1;this.shaderValue.texture=i}this._vb.bind_upload(this._ib);var n=St.mainContext;if(G.activeBlendFunction!==this._blendFn&&(n.enable(3042),this._blendFn(n),G.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&Ot.activeShader&&e._shaderSet?Ot.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),e._shaderSet=!0,this._texs.length>1&&!this._isSameTexture)for(var r=t.bitmap,a=0,s=Ot.activeShader,o=0,l=this._texs.length;o<l;o++){var h=this._texs[o];h.bitmap===r&&o+1!==l||(s.uploadTexture2D(h.source),n.drawElements(4,6*(o-a+1),5123,this._startIdx+6*a*pt.BYTES_PIDX),r=h.bitmap,a=o)}else n.drawElements(4,this._numEle,5123,this._startIdx);return 1},e.create=function(t,i,n,r,a){var s=e._cache._length?e._cache[--e._cache._length]:new e;null==n&&((n=s._selfVb||(s._selfVb=Jt.create(-1))).clear(),r=0),s._ib=i,s._vb=n,s._startIdx=r*pt.BYTES_PIDX,s._numEle=0;var o=t._nBlendType;s._blendFn=t._targets?G.targetFns[o]:G.fns[o],s.shaderValue=a,s.shaderValue.setValue(t._shader2D);var l=t._shader2D.filters;return l&&s.shaderValue.setFilters(l),s},e._cache=(e._cache=[],e._cache._length=0,e._cache),e._shaderSet=!0,e}(),Nt=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}r(e,"laya.webgl.utils.MeshTexture",gt);var i=e.prototype;return i.addData=function(t,i,n,r,a,s){for(var o=t.length/2,l=this._vb.needSize(o*e.const_stride)>>2,h=this._vb.getFloat32Array(),c=0,u=0;u<o;u++){var _=t[c],d=t[c+1],f=_*r.a+d*r.c+r.tx,p=_*r.b+d*r.d+r.ty;h[l++]=f,h[l++]=p,h[l++]=i[c],h[l++]=i[c+1],c+=2}this._vb.setNeedUpload();var m=this.vertNum;if(m>0){(o=n.length)>e.tmpIdx.length&&(e.tmpIdx=new Uint16Array(o));for(var g=0;g<o;g++)e.tmpIdx[g]=n[g]+m;this._ib.appendU16Array(e.tmpIdx,n.length)}else this._ib.append(n);this._ib.setNeedUpload(),this.vertNum+=o,this.indexNum+=n.length},i.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},i.destroy=function(){this._ib.destroy(),this._vb.destroy()},e.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new e},e.const_stride=16,e._POOL=[],n(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),e}(),Ot=function(t){function e(){e.__super.call(this),this.lock=!0}return r(e,"laya.webgl.shader.BaseShader",C),e.activeShader=null,e.bindShader=null,e}(),Vt=function(t){function e(t,i,n,r,a,s,o,l,h){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===n&&(n=6408),void 0===r&&(r=5121),void 0===a&&(a=34041),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===l&&(l=-1),void 0===h&&(h=-1),this._type=1,this._w=t,this._h=i,this._surfaceFormat=n,this._surfaceType=r,this._depthStencilFormat=a,T.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=s,this._repeat=o,this._minFifter=l,this._magFifter=h,this._createWebGLRenderTarget(),this.bitmap.lock=!0,e.__super.call(this,this.bitmap,N.INV_UV)}r(e,"laya.webgl.resource.RenderTarget2D",t);var n=e.prototype;return i.imps(n,{"laya.resource.IDispose":!0}),n.getType=function(){return this._type},n.getTexture=function(){return this},n.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},n.release=function(){this.destroy()},n.recycle=function(){e.POOL.push(this)},n.start=function(){var t=St.mainContext;return this._preRenderTarget=yt.curRenderTarget,yt.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=yt.width,this._svHeight=yt.height,yt.width=this._w,yt.height=this._h,Ot.activeShader=null),this},n.clear=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1);var r=St.mainContext;r.clearColor(t,e,i,n);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}r.clear(a)},n.end=function(){var t=St.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,yt.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),yt.width=this._svWidth,yt.height=this._svHeight,Ot.activeShader=null):t.viewport(0,0,i.stage.width,i.stage.height)},n.getData=function(t,e,i,n){var r=St.mainContext;if(r.bindFramebuffer(36160,this.bitmap.frameBuffer),36053!==r.checkFramebufferStatus(36160))return r.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._w*this._h*4);return r.readPixels(t,e,i,n,this._surfaceFormat,this._surfaceType,a),r.bindFramebuffer(36160,null),a},n.destroy=function(e){void 0===e&&(e=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,t.prototype.destroy.call(this))},n.dispose=function(){},n._createWebGLRenderTarget=function(){this.bitmap=new Xt(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(t){this.event("recovered")})},a(0,n,"surfaceFormat",function(){return this._surfaceFormat}),a(0,n,"magFifter",function(){return this._magFifter}),a(0,n,"surfaceType",function(){return this._surfaceType}),a(0,n,"mipMap",function(){return this._mipMap}),a(0,n,"depthStencilFormat",function(){return this._depthStencilFormat}),a(0,n,"minFifter",function(){return this._minFifter}),a(0,n,"source",function(){return this._alreadyResolved?i.superGet(N,this,"source"):null}),e.create=function(t,i,n,r,a,s,o,l,h){void 0===n&&(n=6408),void 0===r&&(r=5121),void 0===a&&(a=34041),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===l&&(l=-1),void 0===h&&(h=-1);var c=e.POOL.pop();return c||(c=new e(t,i)),c.bitmap&&c._w==t&&c._h==i&&c._surfaceFormat==n&&c._surfaceType==r&&c._depthStencilFormat==a&&c._mipMap==s&&c._repeat==o&&c._minFifter==l&&c._magFifter==h||(c._w=t,c._h=i,c._surfaceFormat=n,c._surfaceType=r,c._depthStencilFormat=a,T.isConchWebGL&&34041===c._depthStencilFormat&&(c._depthStencilFormat=33189),c._mipMap=s,c._repeat=o,c._minFifter=l,c._magFifter=h,c.release(),c._createWebGLRenderTarget()),c},e.TYPE2D=1,e.TYPE3D=2,e.POOL=[],e}(N),kt=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),e._gl=St.mainContext}r(e,"laya.webgl.utils.Buffer",C);var i=e.prototype;return i._bind=function(){this.activeResource(),e._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(e._bindVertexBuffer=this._glBuffer),e._gl.bindBuffer(this._bufferType,e._bindActive[this._bufferType]=this._glBuffer),Ot.activeShader=null)},i.recreateResource=function(){this._glBuffer||(this._glBuffer=e._gl.createBuffer()),this.completeCreate()},i.disposeResource=function(){this._glBuffer&&(St.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},a(0,i,"bufferUsage",function(){return this._bufferUsage}),e._gl=null,e._bindActive={},e._bindVertexBuffer=null,e._enableAtributes=[],e}(),Ft=function(t){function e(t){this.texcoord=null,this.offsetX=300,this.offsetY=0,e.__super.call(this,512,0);var i=8*pt.BYTES_PE;this.position=[2,5126,!1,i,0],this.texcoord=[2,5126,!1,i,2*pt.BYTES_PE],this.color=[4,5126,!1,i,4*pt.BYTES_PE]}return r(e,"laya.webgl.shader.d2.skinAnishader.SkinSV",wt),e}(),Bt=function(t){function e(t){e.__super.call(this,2,0),this.color=[]}return r(e,"laya.webgl.shader.d2.value.Color2dSV",wt),e.prototype.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color)},e}(),Ut=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=wt._TEXCOORD,e.__super.call(this,256,0)}r(e,"laya.webgl.shader.d2.value.FillTextureSV",wt);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),Ht=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=wt._TEXCOORD,void 0===t&&(t=0),e.__super.call(this,1,t)}r(e,"laya.webgl.shader.d2.value.TextureSV",wt);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),Gt=function(t){function e(t){this.a_color=null,this.u_pos=[0,0],e.__super.call(this,4,0),this.position=[2,5126,!1,5*pt.BYTES_PE,0],this.a_color=[3,5126,!1,5*pt.BYTES_PE,2*pt.BYTES_PE]}return r(e,"laya.webgl.shader.d2.value.PrimitiveSV",wt),e}(),Wt=function(t){function e(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,e.__super.call(this)}r(e,"laya.webgl.atlas.AtlasWebGLCanvas",t);var i=e.prototype;return i.recreateResource=function(){var t=St.mainContext,e=this._source=t.createTexture(),i=xt.curBindTexTarget,n=xt.curBindTexValue;xt.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&n&&xt.bindTexture(t,i,n),this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._source&&(St.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i){if(T.isFlash){this._flashCacheImage||(this._flashCacheImage=y.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var n=i.bitmapdata;this._flashCacheImage._image.copyPixels(n,0,0,n.width,n.height,t,e),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var r=St.mainContext,a=xt.curBindTexTarget,s=xt.curBindTexValue;xt.bindTexture(r,3553,this._source),T.isConchWebGL?(t-1>=0&&r.texSubImage2DEx(!0,3553,0,t-1,e,6408,5121,i),t+1<=this._w&&r.texSubImage2DEx(!0,3553,0,t+1,e,6408,5121,i),e-1>=0&&r.texSubImage2DEx(!0,3553,0,t,e-1,6408,5121,i),e+1<=this._h&&r.texSubImage2DEx(!0,3553,0,t,e+1,6408,5121,i),r.texSubImage2DEx(!0,3553,0,t,e,6408,5121,i)):(r.pixelStorei(37441,!0),t-1>=0&&r.texSubImage2D(3553,0,t-1,e,6408,5121,i),t+1<=this._w&&r.texSubImage2D(3553,0,t+1,e,6408,5121,i),e-1>=0&&r.texSubImage2D(3553,0,t,e-1,6408,5121,i),e+1<=this._h&&r.texSubImage2D(3553,0,t,e+1,6408,5121,i),r.texSubImage2D(3553,0,t,e,6408,5121,i),r.pixelStorei(37441,!1)),a&&s&&xt.bindTexture(r,a,s)}},i.texSubImage2DPixel=function(t,e,i,n,r){var a=St.mainContext,s=xt.curBindTexTarget,o=xt.curBindTexValue;xt.bindTexture(a,3553,this._source);var l=new Uint8Array(r.data);T.isConchWebGL?a.texSubImage2DEx(!0,3553,0,t,e,i,n,6408,5121,l):(a.pixelStorei(37441,!0),a.texSubImage2D(3553,0,t,e,i,n,6408,5121,l),a.pixelStorei(37441,!1)),s&&o&&xt.bindTexture(a,s,o)},a(0,i,"width",t.prototype._$get_width,function(t){this._w=t}),a(0,i,"height",t.prototype._$get_height,function(t){this._h=t}),e}(h),zt=function(t){function e(){this.flipY=!0,this.alwaysChange=!1,e.__super.call(this)}r(e,"laya.webgl.resource.WebGLCanvas",h);var i=e.prototype;return i.getCanvas=function(){return this._canvas},i.clear=function(){this._ctx&&this._ctx.clear()},i.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},i._setContext=function(t){this._ctx=t},i.getContext=function(t,i){return this._ctx?this._ctx:this._ctx=e._createContext(this)},i.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},i.activeResource=function(t){void 0===t&&(t=!1),this._source||this.recreateResource()},i.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&!this.iscpuSource&&(St.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.createWebGlTexture=function(){var t=St.mainContext;this._canvas;var i=this._source=t.createTexture();this.iscpuSource=!1;var n=xt.curBindTexTarget,r=xt.curBindTexValue;xt.bindTexture(t,3553,i),t.pixelStorei(37440,this.flipY?1:0),T.isConchWebGL?t.texImage2DEx(e.premulAlpha,3553,0,6408,6408,5121,this._imgData):(e.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),e.premulAlpha&&t.pixelStorei(37441,!1)),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,n&&r&&xt.bindTexture(t,n,r)},i.reloadCanvasData=function(){var t=St.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var i=xt.curBindTexTarget,n=xt.curBindTexValue;xt.bindTexture(t,3553,this._source),T.isConchWebGL?t.texImage2DEx(e.premulAlpha,3553,0,6408,6408,5121,this._imgData):(e.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),e.premulAlpha&&t.pixelStorei(37441,!1)),t.pixelStorei(37440,0),i&&n&&xt.bindTexture(t,i,n)},i.texSubImage2D=function(t,e,i){var n=St.mainContext,r=xt.curBindTexTarget,a=xt.curBindTexValue;xt.bindTexture(n,3553,this._source),T.isConchWebGL?n.texSubImage2DEx(!0,3553,0,e,i,6408,5121,t._source):(n.pixelStorei(37441,!0),n.texSubImage2D(3553,0,e,i,6408,5121,t._source),n.pixelStorei(37441,!1)),r&&a&&xt.bindTexture(n,r,a)},i.toBase64=function(t,e,i){var n=null;this._canvas&&(n=this._canvas.toDataURL(t,e)),i.call(this,n)},a(0,i,"context",function(){return this._ctx}),a(0,i,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),a(0,i,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)}),e._createContext=null,e.premulAlpha=!1,e}(),Yt=function(t){function e(t,i){this.CborderSize=12,e.__super.call(this),this.char=t,this.isSpace=" "===t,this.xs=i.scaleX,this.ys=i.scaleY,this.font=i.font.toString(),this.fontSize=i.font.size,this.fillColor=i.fillColor,this.borderColor=i.borderColor,this.lineWidth=i.lineWidth,this.underLine=i.underLine;var n,r=T.isConchApp;r?((n=ConchTextCanvas)._source=ConchTextCanvas,n._source.canvas=ConchTextCanvas):n=c.canvas.source,this.canvas=n,this._enableMerageInAtlas=!0,this._ctx=r?n:this.canvas.getContext("2d",void 0);var a=O.measureText(this.char,this.font);this.cw=a.width*this.xs,this.ch=(a.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new N(this)}r(e,"laya.webgl.resource.WebGLCharImage",h);var n=e.prototype;return i.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n.active=function(){this.texture.active()},n.recreateResource=function(){var t=T.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),t){var e=this.fontSize;1==this.xs&&1==this.ys||(e=parseInt(e*(this.xs>this.ys?this.xs:this.ys)+""));var i="normal 100 "+e+"px Arial";this.borderColor&&(i+=" 1 "+this.borderColor),this._ctx.font=i,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,P.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var n=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(n,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},n.onresize=function(t,e){this._w=t,this._h=e,this._allowMerageInAtlas=!0},n.clearAtlasSource=function(){},a(0,n,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),a(0,n,"atlasSource",function(){return this.canvas}),a(0,n,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t}),e.createOneChar=function(t,i){return new e(t,i)},e}(),Xt=function(t){function e(t,i,n,r,a,s,o,l,h){void 0===n&&(n=6408),void 0===r&&(r=5121),void 0===a&&(a=34041),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===l&&(l=-1),void 0===h&&(h=1),e.__super.call(this),this._w=t,this._h=i,this._surfaceFormat=n,this._surfaceType=r,this._depthStencilFormat=a,T.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=s,this._repeat=o,this._minFifter=l,this._magFifter=h}r(e,"laya.webgl.resource.WebGLRenderTarget",h);var i=e.prototype;return i.recreateResource=function(){var t=St.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture());var e=xt.curBindTexTarget,i=xt.curBindTexValue;xt.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,r=this._magFifter,a=this._repeat?10497:33071,s=o.isPOT(this._w,this._h);if(s?(this._mipMap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this._mipMap&&t.generateMipmap(3553)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&xt.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),s&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._frameBuffer&&(St.mainContext.deleteTexture(this._source),St.mainContext.deleteFramebuffer(this._frameBuffer),St.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},a(0,i,"depthStencilBuffer",function(){return this._depthStencilBuffer}),a(0,i,"frameBuffer",function(){return this._frameBuffer}),e}(),jt=function(t){function e(t,i,n,r,a,s,o){this.offsetX=0,this.offsetY=0,e.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=s,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=r,this._h=a,this.offsetX=i,this.offsetY=n,this.src=o,this._enableMerageInAtlas=!0,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}r(e,"laya.webgl.resource.WebGLSubImage",h);var n=e.prototype;return i.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},n.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},n.createWebGlTexture=function(){var t=St.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=xt.curBindTexTarget,n=xt.curBindTexValue;xt.bindTexture(t,3553,e),T.isConchWebGL?t.texImage2DEx(!0,3553,0,6408,6408,5121,this.canvas):(t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this.canvas),t.pixelStorei(37441,!1));var r=this.minFifter,a=this.magFifter,s=this.repeat?10497:33071,l=o.isPOT(this.width,this.height);l?(this.mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10240,a),t.texParameteri(3553,10241,r),t.texParameteri(3553,10242,s),t.texParameteri(3553,10243,s),this.mipmap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&n&&xt.bindTexture(t,i,n),this.canvas=null,l&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},n.disposeResource=function(){U.enabled&&this._allowMerageInAtlas||!this._source||(St.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},n.clearAtlasSource=function(){},a(0,n,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),a(0,n,"atlasSource",function(){return this.canvas}),a(0,n,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t}),e}(),Kt=function(t){function e(t,i,n,r){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,e.__super.call(this),!t||!i)throw"Shader Error";this._id=++e._count,this._vs=t,this._ps=i,this._nameMap=r||{},null!=n&&(e.sharders[n]=this)}r(e,"laya.webgl.shader.Shader",Ot);var i=e.prototype;return i.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},i.disposeResource=function(){St.mainContext.deleteShader(this._vshader),St.mainContext.deleteShader(this._pshader),St.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},i._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t=[this._vs,this._ps],i=St.mainContext;if(this._program=i.createProgram(),this._vshader=e._createShader(i,t[0],35633),this._pshader=e._createShader(i,t[1],35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader),i.linkProgram(this._program),!T.isConchApp&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var n,r,a,s=0;for(a=T.isConchApp?i.getProgramParameterEx(this._vs,this._ps,"",35721):i.getProgramParameter(this._program,35721),s=0;s<a;s++){var o=null;n={vartype:"attribute",glfun:null,ivartype:0,attrib:o=T.isConchApp?i.getActiveAttribEx(this._vs,this._ps,"",s):i.getActiveAttrib(this._program,s),location:i.getAttribLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(n)}var l;for(l=T.isConchApp?i.getProgramParameterEx(this._vs,this._ps,"",35718):i.getProgramParameter(this._program,35718),s=0;s<l;s++){var h;h=T.isConchApp?i.getActiveUniformEx(this._vs,this._ps,"",s):i.getActiveUniform(this._program,s),(n={vartype:"uniform",glfun:null,ivartype:1,attrib:o,location:i.getUniformLocation(this._program,h.name),name:h.name,type:h.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")>0&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=i.getUniformLocation(this._program,n.name)),this._params.push(n)}for(s=0,r=this._params.length;s<r;s++)if((n=this._params[s]).indexOfParams=s,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=this._nameMap[n.codename]?this._nameMap[n.codename]:n.codename,this._paramsMap[n.name]=n,n._this=this,n.uploadedValue=[],"attribute"!==n.vartype)switch(n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.glfun=i.uniformMatrix4fv,n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else n.fun=this._attribute}},i.getUniform=function(t){return this._paramsMap[t]},i._attribute=function(t,e){var i=St.mainContext,n=kt._enableAtributes,r=t.location;return n[r]||i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e[0],e[1],e[2],e[3],e[4]+this._offset),n[r]=kt._bindVertexBuffer,1},i._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(St.mainContext.uniform1f(t.location,i[0]=e),1):0},i._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(St.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return St.mainContext.uniform1fv(t.location,e),1},i._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(St.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(St.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return St.mainContext.uniform2fv(t.location,e),1},i._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(St.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3v=function(t,e){return St.mainContext.uniform3fv(t.location,e),1},i._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(St.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4v=function(t,e){return St.mainContext.uniform4fv(t.location,e),1},i._uniformMatrix2fv=function(t,e){return St.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uniformMatrix3fv=function(t,e){return St.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniformMatrix4fv=function(t,e){return St.mainContext.uniformMatrix4fv(t.location,!1,e),1},i._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(St.mainContext.uniform1i(t.location,i[0]=e),1):0},i._uniform1iv=function(t,e){return St.mainContext.uniform1iv(t.location,e),1},i._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(St.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_ivec2v=function(t,e){return St.mainContext.uniform2iv(t.location,e),1},i._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(St.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3vi=function(t,e){return St.mainContext.uniform3iv(t.location,e),1},i._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(St.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4vi=function(t,e){return St.mainContext.uniform4iv(t.location,e),1},i._uniform_sampler2D=function(t,i){var n=St.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,n.uniform1i(t.location,this._curActTexIndex),n.activeTexture(e._TEXTURES[this._curActTexIndex]),xt.bindTexture(n,3553,i),this._curActTexIndex++,1):(n.activeTexture(e._TEXTURES[r[0]]),xt.bindTexture(n,3553,i),0)},i._uniform_samplerCube=function(t,i){var n=St.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,n.uniform1i(t.location,this._curActTexIndex),n.activeTexture(e._TEXTURES[this._curActTexIndex]),xt.bindTexture(n,34067,i),this._curActTexIndex++,1):(n.activeTexture(e._TEXTURES[r[0]]),xt.bindTexture(n,34067,i),0)},i._noSetValue=function(t){console.log("no....:"+t.name)},i.uploadOne=function(t,e){this.activeResource(),xt.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},i.uploadTexture2D=function(t){A.shaderCall++;var e=St.mainContext;e.activeTexture(33984),xt.bindTexture(e,3553,t)},i.upload=function(t,e){Ot.activeShader=Ot.bindShader=this,this._lastUseFrameCount===A.loopCount||this.activeResource(),xt.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params,St.mainContext;for(var i,n,r=e.length,a=0,s=0;s<r;s++)null!==(n=t[(i=e[s]).name])&&(a+=i.fun.call(this,i,n));A.shaderCall+=a},i.uploadArray=function(t,e,i){Ot.activeShader=this,Ot.bindShader=this,this.activeResource(),xt.UseProgram(this._program),this._params;for(var n,r,a=0,s=e-2;s>=0;s-=2)(r=this._paramsMap[t[s]])&&null!=(n=t[s+1])&&(i&&i[r.name]&&i[r.name].bind(),a+=r.fun.call(this,r,n));A.shaderCall+=a},i.getParams=function(){return this._params},e.getShader=function(t){return e.sharders[t]},e.create=function(t,i,n,r){return new e(t,i,n,r)},e.withCompile=function(t,i,n,r){if(n&&e.sharders[n])return e.sharders[n];var a=e._preCompileShader[2e-4*t];if(!a)throw new Error("withCompile shader err!"+t);return a.createShader(i,n,r)},e.withCompile2D=function(t,i,n,r,a){if(r&&e.sharders[r])return e.sharders[r];var s=e._preCompileShader[2e-4*t+i];if(!s)throw new Error("withCompile shader err!"+t+" "+i);return s.createShader(n,r,a)},e.addInclude=function(t,e){vt.addInclude(t,e)},e.preCompile=function(t,i,n,r){var a=2e-4*t;e._preCompileShader[a]=new vt(a,i,n,r)},e.preCompile2D=function(t,i,n,r,a){var s=2e-4*t+i;e._preCompileShader[s]=new vt(s,n,r,a)},e._createShader=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),n},e._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],e._count=0,e._preCompileShader={},e.SHADERNAME2ID=2e-4,e.sharders=(e.sharders=[],e.sharders.length=32,e.sharders),n(e,["nameKey",function(){return this.nameKey=new R}]),e}(),qt=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,e.__super.call(this),this.lock=!0}r(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._buffer.byteLength||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),A.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,kt._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),kt._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),A.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,kt._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i){var n=this._buffer.slice(e,i);kt._gl.bufferSubData(this._bufferType,t,n)}else kt._gl.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this.memorySize=t,e&&this._buffer&&this._buffer.byteLength>0){var i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this},i.append=function(t){this._upload=!0;var e,i;i=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+i,!0),e=new Float32Array(this._buffer,this._byteLength)),e.set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),n=0;n<e;n++)i[n]=t[n];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,n){void 0===n&&(n=1),this._upload=!0;var r,a;a=i*n,this._resizeBuffer(this._byteLength+a,!0),r=new e(this._buffer,this._byteLength);var s=0;for(s=0;s<i;s++)r[s]=t[s];this._byteLength+=a,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return kt._gl.bindBuffer(this._bufferType,null),kt._bindActive[this._bufferType]=null,Ot.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this._bind_subUpload();return kt._gl.bindBuffer(this._bufferType,null),kt._bindActive[this._bufferType]=null,Ot.activeShader=null,n},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},a(0,i,"bufferLength",function(){return this._buffer.byteLength}),a(0,i,"byteLength",null,function(t){this._byteLength!==t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._byteLength=t)}),e.__int__=function(t){$t.QuadrangleIB=$t.create(35044),mt.fillIBQuadrangle($t.QuadrangleIB,16)},e.FLOAT32=4,e.SHORT=2,e}(kt),Zt=(function(t){function e(t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,e.__super.call(this,9)}r(e,"laya.webgl.shader.d2.value.GlowSV",t);var i=e.prototype;i.setValue=function(e){t.prototype.setValue.call(this,e)},i.clear=function(){t.prototype.clear.call(this)}}(Ht),function(t){function e(t){e.__super.call(this,64),this.defines.add(64)}r(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;return i.release=function(){e.pool[e._length++]=this,this.clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(Ht)),Qt=function(t){function e(t,i,n,r){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,e.__super.call(this,t,i,n,r)}r(e,"laya.webgl.shader.d2.Shader2X",t);var i=e.prototype;return i.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},i._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)t=e[i],(T.isFlash||"size"!==t.name&&"position"!==t.name&&"texcoord"!==t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},i.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},i._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)t=e[i],(T.isFlash||"size"!==t.name)&&this._params2dQuick2.push(t)}return this._params2dQuick2},e.create=function(t,i,n,r){return new e(t,i,n,r)},e}(Kt),$t=function(t){function e(t){this._uint8Array=null,this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,T.isFlash||(this._buffer=new ArrayBuffer(8))}r(e,"laya.webgl.utils.IndexBuffer2D",qt);var i=e.prototype;return i._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},e.QuadrangleIB=null,e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),Jt=function(t){function e(t,i){this._floatArray32=null,this._vertexStride=0,e.__super.call(this),this._vertexStride=t,this._bufferUsage=i,this._bufferType=34962,T.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}r(e,"laya.webgl.utils.VertexBuffer2D",t);var i=e.prototype;return i.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},i.bind=function(t){t&&t._bind(),this._bind()},i.insertData=function(t,e){this.getFloat32Array().set(t,e),this._upload=!0},i.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},i._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},i.disposeResource=function(){t.prototype.disposeResource.call(this);var e=kt._enableAtributes;if(!T.isConchWebGL)for(var i=0;i<10;i++)St.mainContext.disableVertexAttribArray(i),e[i]=null},i.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},a(0,i,"vertexStride",function(){return this._vertexStride}),e.create=function(t,i){return void 0===i&&(i=35048),new e(t,i)},e}(qt),te=function(t){function e(t,i,n,r){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,this.magFifter=0,void 0===n&&(n=6408),void 0===r&&(r=!0),e.__super.call(this,t,i),this._format=n,this._mipmap=r,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof t)this._url=t,this._src=t,this._image=new c.window.Image,i&&(i.onload&&(this.onload=i.onload),i.onerror&&(this.onerror=i.onerror),i.onCreate&&i.onCreate(this)),this._image.crossOrigin=t&&0==t.indexOf("data:")?null:"",t&&(this._image.src=t);else if(t instanceof ArrayBuffer){this._src=i,this._url=this._src;var a=new u(t);a.readUTFBytes(4),a.readUTFBytes(2),a.getInt16(),a.endian="bigEndian",this._w=a.getInt16(),this._h=a.getInt16(),a.getInt16(),a.getInt16(),this._image=new Uint8Array(t,a.pos),this._format=St.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else this._src=i,this._url=this._src,this._image=t.source||t,this.onresize();this._$5__enableMerageInAtlas=!0}r(e,"laya.webgl.resource.WebGLImage",y);var n=e.prototype;return i.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n._init_=function(t,e){},n._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=St.mainContext,e=this._source=t.createTexture(),i=xt.curBindTexTarget,n=xt.curBindTexValue;if(xt.bindTexture(t,3553,e),T.isConchWebGL)switch(this._format){case 6408:t.texImage2DEx(!0,3553,0,this._format,6408,5121,this._image);break;case St.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}else{switch(t.pixelStorei(37441,!0),this._format){case 6408:t.texImage2D(3553,0,this._format,6408,5121,this._image);break;case St.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}t.pixelStorei(37441,!1)}var r=this.minFifter,a=this.magFifter,s=this.repeat?10497:33071,l=o.isPOT(this._w,this._h);l?(this.mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,s),t.texParameteri(3553,10243,s),this.mipmap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&n&&xt.bindTexture(t,i,n),this._image.onload=null,this._image=null,l&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},n.recreateResource=function(){var t=this;if(null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var e=this;this._image=new c.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._image.onload=null,void(e._image=null);e._allowMerageInAtlas&&e._enableMerageInAtlas?(t.memorySize=0,t._recreateLock=!1):e._createWebGlTexture(),e.completeCreate()},this._image.src=this._src}},n.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(St.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},n.onresize=function(){this._w=this._image.width,this._h=this._image.height,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},n.clearAtlasSource=function(){this._image=null},a(0,n,"format",function(){return this._format}),a(0,n,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(t){this._$5__enableMerageInAtlas=t}),a(0,n,"mipmap",function(){return this._mipmap}),a(0,n,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),a(0,n,"atlasSource",function(){return this._image}),a(0,n,"onload",null,function(t){var e=this;this._onload=t,this._image&&(this._image.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),a(0,n,"onerror",null,function(t){var e=this;this._onerror=t,this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)}),e}();i.__init([dt,B,Tt,vt])}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,a=i.getset,s=i.__newvec,o=laya.maths.Bezier,l=laya.utils.Browser,h=laya.utils.Byte,c=(laya.events.Event,laya.events.EventDispatcher),u=laya.display.Graphics,_=laya.resource.HTMLCanvas,d=laya.utils.Handler,f=laya.net.Loader,p=laya.maths.MathUtil,m=laya.maths.Matrix,g=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle),y=laya.renders.Render,v=(laya.renders.RenderContext,laya.resource.Resource),S=laya.utils.RunDriver,x=laya.display.Sprite,E=laya.utils.Stat,T=laya.resource.Texture,w=laya.net.URL,C=laya.utils.Utils,b=function(){function t(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return r(t,"laya.ani.AnimationContent"),t}(),M=function(){function t(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return r(t,"laya.ani.AnimationNodeContent"),t}(),I=function(){function t(){}return r(t,"laya.ani.AnimationParser01"),t.parse=function(t,e){var i=e.__getBuffer(),n=0,r=0,a=0,s=0,o=0,l=0,c=0,u=e.readUTFString();t._aniClassName=u;var _,d=e.readUTFString().split("\n"),f=e.getUint8(),p=e.getUint32(),m=e.getUint32();p>0&&(_=i.slice(p,m));var g=new h(_);for(m>0&&(t._publicExtData=i.slice(m,i.byteLength)),t._useParent=!!e.getUint8(),t._anis.length=f,n=0;n<f;n++){var y=t._anis[n]=new b;y.nodes=new Array;var v=y.name=d[e.getUint16()];t._aniMap[v]=n,y.bone3DMap={},y.playTime=e.getFloat32();var S=y.nodes.length=e.getUint8();for(y.totalKeyframeDatasLength=0,r=0;r<S;r++){var x=y.nodes[r]=new M;x.childs=[];var E=e.getInt16();E>=0&&(x.name=d[E],y.bone3DMap[x.name]=r),x.keyFrame=new Array,x.parentIndex=e.getInt16(),-1==x.parentIndex?x.parent=null:x.parent=y.nodes[x.parentIndex],x.lerpType=e.getUint8();var T=e.getUint32();g.pos=T;var w=x.keyframeWidth=g.getUint16();if(y.totalKeyframeDatasLength+=w,0===x.lerpType||1===x.lerpType)for(x.interpolationMethod=[],x.interpolationMethod.length=w,a=0;a<w;a++)x.interpolationMethod[a]=it.interpolation[g.getUint8()];null!=x.parent&&x.parent.childs.push(x);var C=e.getUint16();C>0&&(x.extenData=i.slice(e.pos,e.pos+C),e.pos+=C);var I=e.getUint16();x.keyFrame.length=I;var D,A=0;for(a=0,s=I;a<s;a++){if((D=x.keyFrame[a]=new Q).duration=e.getFloat32(),D.startTime=A,2===x.lerpType){D.interpolationData=[];var R,L=e.getUint8();switch(R=e.getFloat32()){case 254:for(D.interpolationData.length=w,c=0;c<w;c++)D.interpolationData[c]=0;break;case 255:for(D.interpolationData.length=w,c=0;c<w;c++)D.interpolationData[c]=5;break;default:for(D.interpolationData.push(R),l=1;l<L;l++)D.interpolationData.push(e.getFloat32())}}for(D.data=new Float32Array(w),o=0;o<w;o++)D.data[o]=e.getFloat32(),D.data[o]>-1e-8&&D.data[o]<1e-8&&(D.data[o]=0);A+=D.duration}D.startTime=y.playTime,x.playTime=y.playTime,t._calculateKeyFrame(x,I,w)}}},t}(),D=function(){function t(){}return r(t,"laya.ani.AnimationParser02"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._templet=e,t._reader=i,i.__getBuffer(),t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;n<r;n++){var a=i.getUint16(),s=t._strings[a],o=t["READ_"+s];if(null==o)throw new Error("model file err,no this function:"+a+" "+s);o.call()}},t.READ_ANIMATIONS=function(){var e=t._reader,i=e.__getBuffer(),n=0,r=0,a=0,s=0,o=e.getUint16(),l=[];for(l.length=o,n=0;n<o;n++)l[n]=it.interpolation[e.getByte()];var h=e.getUint8();for(t._templet._anis.length=h,n=0;n<h;n++){var c=t._templet._anis[n]={};c.nodes=new Array;var u=c.name=t._strings[e.getUint16()];t._templet._aniMap[u]=n,c.bone3DMap={},c.playTime=e.getFloat32();var _=c.nodes.length=e.getInt16();for(c.totalKeyframeDatasLength=0,r=0;r<_;r++){var d=c.nodes[r]={};d.keyframeWidth=o,d.childs=[];var f=e.getUint16();f>=0&&(d.name=t._strings[f],c.bone3DMap[d.name]=r),d.keyFrame=new Array,d.parentIndex=e.getInt16(),-1==d.parentIndex?d.parent=null:d.parent=c.nodes[d.parentIndex],c.totalKeyframeDatasLength+=o,d.interpolationMethod=l,null!=d.parent&&d.parent.childs.push(d);var p=e.getUint16();d.keyFrame.length=p;var m=null,g=null;for(a=0,s=p;a<s;a++){(m=d.keyFrame[a]={}).startTime=e.getFloat32(),g&&(g.duration=m.startTime-g.startTime);var y=t._DATA.offset,v=e.getUint32(),S=4*o,x=i.slice(y+v,y+v+S);m.data=new Float32Array(x),g=m}m.duration=0,d.playTime=c.playTime,t._templet._calculateKeyFrame(d,p,o)}}},t._templet=null,t._reader=null,t._strings=[],n(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),A=(function(){function t(){}r(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2}(),function(){function t(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new q,this.resultMatrix=new m,this._children=[]}r(t,"laya.ani.bone.Bone");var e=t.prototype;return e.setTempMatrix=function(t){this._tempMatrix=t;var e,i=0;for(i=0,e=this._children.length;i<e;i++)this._children[i].setTempMatrix(this._tempMatrix)},e.update=function(t){var e;if(this.rotation=this.transform.skX,t)e=this.resultTransform.getMatrix(),m.mul(e,t,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)e=this.resultTransform.getMatrix(),m.mul(e,this.parentBone.resultMatrix,this.resultMatrix);else{var i=this.parentBone,n=NaN,r=NaN,a=NaN,s=this.parentBone.resultMatrix;e=this.resultTransform.getMatrix();var o=s.a*e.tx+s.c*e.ty+s.tx,l=s.b*e.tx+s.d*e.ty+s.ty,h=new m;this.inheritRotation?(n=Math.atan2(i.resultMatrix.b,i.resultMatrix.a),r=Math.cos(n),a=Math.sin(n),h.setTo(r,a,-a,r,0,0),m.mul(this._tempMatrix,h,m.TEMP),m.TEMP.copyTo(h),e=this.resultTransform.getMatrix(),m.mul(e,h,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI),this.resultMatrix.tx=o,this.resultMatrix.ty=l):(this.inheritScale,e=this.resultTransform.getMatrix(),m.TEMP.identity(),m.TEMP.d=this.d,m.mul(e,m.TEMP,this.resultMatrix),this.resultMatrix.tx=o,this.resultMatrix.ty=l)}else(e=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var c,u=0;for(u=0,c=this._children.length;u<c;u++)this._children[u].update()},e.updateChild=function(){var t,e=0;for(e=0,t=this._children.length;e<t;e++)this._children[e].update()},e.setRotation=function(t){this._sprite&&(this._sprite.rotation=180*t/Math.PI)},e.updateDraw=function(e,n){t.ShowBones&&!t.ShowBones[this.name]||(this._sprite?(this._sprite.x=e+this.resultMatrix.tx,this._sprite.y=n+this.resultMatrix.ty):(this._sprite=new x,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),i.stage.addChild(this._sprite),this._sprite.x=e+this.resultMatrix.tx,this._sprite.y=n+this.resultMatrix.ty));var r,a=0;for(a=0,r=this._children.length;a<r;a++)this._children[a].updateDraw(e,n)},e.addChild=function(t){this._children.push(t),t.parentBone=this},e.findBone=function(t){if(this.name==t)return this;var e,i,n=0;for(n=0,i=this._children.length;n<i;n++)if(e=this._children[n].findBone(t))return e;return null},e.localToWorld=function(t){var e=t[0],i=t[1];t[0]=e*this.resultMatrix.a+i*this.resultMatrix.c+this.resultMatrix.tx,t[1]=e*this.resultMatrix.b+i*this.resultMatrix.d+this.resultMatrix.ty},t.ShowBones={},t}()),R=function(){function t(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}r(t,"laya.ani.bone.BoneSlot");var e=t.prototype;return e.showSlotData=function(t,e){void 0===e&&(e=!0),this.currSlotData=t,e&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},e.showDisplayByName=function(t){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},e.replaceDisplayByName=function(t,e){if(this.currSlotData){var i;i=this.currSlotData.getDisplayByName(t);var n;n=this.currSlotData.getDisplayByName(e),this.replaceDisplayByIndex(i,n)}},e.replaceDisplayByIndex=function(t,e){this.currSlotData&&(this._replaceDic[t]=e,this.displayIndex==t&&this.showDisplayByIndex(t))},e.showDisplayByIndex=function(t){if(null!=this._replaceDic[t]&&(t=this._replaceDic[t]),this.currSlotData&&t>-1&&t<this.currSlotData.displayArr.length){if(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData){var e=this.currDisplayData.name;this.currTexture=this.templet.getTexture(e),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!y.isConchApp||y.isConchApp&&x.RUNTIMEVERION>"0.9.15")&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},e.replaceSkin=function(t){this._diyTexture=t,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},e.setParentMatrix=function(t){this._parentMatrix=t},e.draw=function(e,i,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var a,s=this.currTexture;switch(this._diyTexture&&(s=this._diyTexture),this.currDisplayData.type){case 0:if(e){var o=this.getDisplayMatrix();if(this._parentMatrix){var l=!1;if(o){var h;if(m.mul(o,this._parentMatrix,m.TEMP),n?(null==this._resultMatrix&&(this._resultMatrix=new m),h=this._resultMatrix):h=new m,!y.isWebGL&&this.currDisplayData.uvs||y.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var c=t._tempMatrix;c.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(c.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(l=!0,c.rotate(-Math.PI/2)),m.mul(c,m.TEMP,h)}else m.TEMP.copyTo(h);l?e.drawTexture(s,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,h):e.drawTexture(s,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,h)}}}break;case 1:if(n?(null==this._skinSprite&&(this._skinSprite=t.createSkinMesh()),a=this._skinSprite):a=t.createSkinMesh(),null==a)return;var u;if(null==this.currDisplayData.bones){var _,d=this.currDisplayData.weights;this.deformData&&(d=this.deformData),this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=Z.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=Z.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),_=this._curDiyUV):_=this.currDisplayData.uvs,this._mVerticleArr=d,this.currDisplayData.triangles.length,u=this.currDisplayData.triangles,a.init2(s,null,u,this._mVerticleArr,_);var f,p=this.getDisplayMatrix();if(this._parentMatrix&&p)m.mul(p,this._parentMatrix,m.TEMP),n?(null==this._resultMatrix&&(this._resultMatrix=new m),f=this._resultMatrix):f=new m,m.TEMP.copyTo(f),a.transform=f}else this.skinMesh(i,a,r);e.drawSkin(a);break;case 2:if(n?(null==this._skinSprite&&(this._skinSprite=t.createSkinMesh()),a=this._skinSprite):a=t.createSkinMesh(),null==a)return;this.skinMesh(i,a,r),e.drawSkin(a)}}},e.skinMesh=function(t,e,i){var n,r=this.currTexture,a=this.currDisplayData.bones;this._diyTexture?(r=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=Z.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=Z.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),n=this._curDiyUV):n=this.currDisplayData.uvs;var s,o,l=this.currDisplayData.weights,h=this.currDisplayData.triangles,c=0,u=0,_=0,d=NaN,f=NaN,p=0,m=0,g=[],y=0,v=0;if(this.deformData&&this.deformData.length>0){var S=0;for(y=0,v=a.length;y<v;){for(_=a[y++]+y,c=0,u=0;y<_;y++)o=t[a[y]],d=l[p]+this.deformData[S++],f=l[p+1]+this.deformData[S++],m=l[p+2],c+=(d*o.a+f*o.c+o.tx)*m,u+=(d*o.b+f*o.d+o.ty)*m,p+=3;g.push(c,u)}}else for(y=0,v=a.length;y<v;){for(_=a[y++]+y,c=0,u=0;y<_;y++)o=t[a[y]],d=l[p],f=l[p+1],m=l[p+2],c+=(d*o.a+f*o.c+o.tx)*m,u+=(d*o.b+f*o.d+o.ty)*m,p+=3;g.push(c,u)}this._mVerticleArr=g,s=h,e.init2(r,null,s,this._mVerticleArr,n)},e.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},e.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},e.getMatrix=function(){return this._resultMatrix},e.copy=function(){var e=new t;return e.type="copy",e.name=this.name,e.attachmentName=this.attachmentName,e.srcDisplayIndex=this.srcDisplayIndex,e.parent=this.parent,e.displayIndex=this.displayIndex,e.templet=this.templet,e.currSlotData=this.currSlotData,e.currTexture=this.currTexture,e.currDisplayData=this.currDisplayData,e},t.createSkinMesh=function(){return y.isWebGL||y.isConchApp?S.skinAniSprite():y.isWebGL?null:rt.useSimpleMeshInCanvas?new nt:new et},n(t,["_tempMatrix",function(){return this._tempMatrix=new m}]),t}(),L=function(){function t(){this.mesh=null,this.transform=null,this.context=null,this.mode=0}r(t,"laya.ani.bone.canvasmesh.CanvasMeshRender");var e=t.prototype;return e.renderToContext=function(t){this.context=t.ctx||t,this.mesh&&(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh))},e._renderNoIndexes=function(t){var e=0,i=t.vertices.length/2,n=0;for(e=0;e<i-2;e++)n=2*e,this._renderDrawTriangle(t,n,n+2,n+4)},e._renderWithIndexes=function(t){var e=t.indexes,i=0,n=e.length;for(i=0;i<n;i+=3){var r=2*e[i],a=2*e[i+1],s=2*e[i+2];this._renderDrawTriangle(t,r,a,s)}},e._renderDrawTriangle=function(t,e,i,n){var r=this.context,a=t.uvs,s=t.vertices,o=t.texture,l=o.bitmap,h=l.source,c=o.width,u=o.height,_=l.width,d=l.height,f=NaN,p=NaN,m=NaN,g=NaN,y=NaN,v=NaN;if(t.useUvTransform){var S=t.uvTransform;f=(a[e]*S.a+a[e+1]*S.c+S.tx)*_,p=(a[i]*S.a+a[i+1]*S.c+S.tx)*_,m=(a[n]*S.a+a[n+1]*S.c+S.tx)*_,g=(a[e]*S.b+a[e+1]*S.d+S.ty)*d,y=(a[i]*S.b+a[i+1]*S.d+S.ty)*d,v=(a[n]*S.b+a[n+1]*S.d+S.ty)*d}else f=a[e]*_,p=a[i]*_,m=a[n]*_,g=a[e+1]*d,y=a[i+1]*d,v=a[n+1]*d;var x=s[e],E=s[i],T=s[n],w=s[e+1],C=s[i+1],b=s[n+1];if(t.canvasPadding>0){var M=t.canvasPadding,I=t.canvasPadding,D=(x+E+T)/3,A=(w+C+b)/3,R=x-D,L=w-A,P=Math.sqrt(R*R+L*L);x=D+R/P*(P+M),w=A+L/P*(P+I),L=C-A,E=D+(R=E-D)/(P=Math.sqrt(R*R+L*L))*(P+M),C=A+L/P*(P+I),L=b-A,T=D+(R=T-D)/(P=Math.sqrt(R*R+L*L))*(P+M),b=A+L/P*(P+I)}if(r.save(),this.transform){var N=this.transform;r.transform(N.a,N.b,N.c,N.d,N.tx,N.ty)}r.beginPath(),r.moveTo(x,w),r.lineTo(E,C),r.lineTo(T,b),r.closePath(),r.clip();var O=1/(f*y+g*m+p*v-y*m-g*p-f*v),V=x*y+g*T+E*v-y*T-g*E-x*v,k=f*E+x*m+p*T-E*m-x*p-f*T,F=f*y*T+g*E*m+x*p*v-x*y*m-g*p*T-f*E*v,B=w*y+g*b+C*v-y*b-g*C-w*v,U=f*C+w*m+p*b-C*m-w*p-f*b,H=f*y*b+g*C*m+w*p*v-w*y*m-g*p*b-f*C*v;r.transform(V*O,B*O,k*O,U*O,F*O,H*O),r.drawImage(h,o.uv[0]*_,o.uv[1]*d,c,u,o.uv[0]*_,o.uv[1]*d,c,u),r.restore()},t}(),P=function(){function t(){this.texture=null,this.uvs=[0,0,1,0,1,1,0,1],this.vertices=[0,0,100,0,100,100,0,100],this.indexes=[0,1,3,3,1,2],this.uvTransform=null,this.useUvTransform=!1,this.canvasPadding=1}return r(t,"laya.ani.bone.canvasmesh.MeshData"),t.prototype.getBounds=function(){return g._getWrapRec(this.vertices)},t}(),N=function(){function t(){this.skinName=null,this.deformSlotDataList=[]}return r(t,"laya.ani.bone.DeformAniData"),t}(),O=function(){function t(){this.deformSlotDisplayList=[]}return r(t,"laya.ani.bone.DeformSlotData"),t}(),V=function(){function t(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}r(t,"laya.ani.bone.DeformSlotDisplayData");var e=t.prototype;return e.binarySearch1=function(t,e){var i=0,n=t.length-2;if(0==n)return 1;for(var r=n>>>1;;){if(t[Math.floor(r+1)]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}return 0},e.apply=function(t,e,i){if(void 0===i&&(i=1),t+=.05,!(this.timeList.length<=0)){var n=0;if(!(t<this.timeList[0])){var r=this.vectices[0].length,a=[],s=this.binarySearch1(this.timeList,t);if(this.frameIndex=s,t>=this.timeList[this.timeList.length-1]){var o=this.vectices[this.vectices.length-1];if(i<1)for(n=0;n<r;n++)a[n]+=(o[n]-a[n])*i;else for(n=0;n<r;n++)a[n]=o[n];this.deformData=a}else{this.tweenKeyList[this.frameIndex];var l=this.vectices[this.frameIndex-1],h=this.vectices[this.frameIndex],c=this.timeList[this.frameIndex-1],u=this.timeList[this.frameIndex];i=this.tweenKeyList[s-1]?(t-c)/(u-c):0;var _=NaN;for(n=0;n<r;n++)_=l[n],a[n]=_+(h[n]-_)*i;this.deformData=a}}}},t}(),k=function(){function t(){this.time=NaN,this.drawOrder=[]}return r(t,"laya.ani.bone.DrawOrderData"),t}(),F=function(){function t(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return r(t,"laya.ani.bone.EventData"),t}(),B=function(){function t(t,e){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=t,this._targetBone=e[t.targetBoneIndex],this.isSpine=t.isSpine,null==this._bones&&(this._bones=[]),this._bones.length=0;for(var i=0,n=t.boneIndexs.length;i<n;i++)this._bones.push(e[t.boneIndexs[i]]);this.name=t.name,this.mix=t.mix,this.bendDirection=t.bendDirection}r(t,"laya.ani.bone.IkConstraint");var e=t.prototype;return e.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},e._applyIk1=function(e,i,n,r){var a=e.parentBone,s=1/(a.resultMatrix.a*a.resultMatrix.d-a.resultMatrix.b*a.resultMatrix.c),o=i-a.resultMatrix.tx,l=n-a.resultMatrix.ty,h=(o*a.resultMatrix.d-l*a.resultMatrix.c)*s-e.transform.x,c=(l*a.resultMatrix.a-o*a.resultMatrix.b)*s-e.transform.y,u=Math.atan2(c,h)*t.radDeg-0-e.transform.skX;e.transform.scX<0&&(u+=180),u>180?u-=360:u<-180&&(u+=360),e.transform.skX=e.transform.skY=e.transform.skX+u*r,e.update()},e.updatePos=function(t,e){this._sp&&this._sp.pos(t,e)},e._applyIk2=function(e,n,r,a,s,o){if(0!=o){var l=e.resultTransform.x,h=e.resultTransform.y,c=e.transform.scX,u=e.transform.scY,_=n.transform.scX,d=0,f=0,p=0;c<0?(c=-c,d=180,p=-1):(d=0,p=1),u<0&&(u=-u,p=-p),_<0?(_=-_,f=180):f=0;var m=n.resultTransform.x,g=NaN,y=NaN,v=NaN,S=e.resultMatrix.a,E=e.resultMatrix.c,T=e.resultMatrix.b,w=e.resultMatrix.d,C=Math.abs(c-u)<=1e-4;C?(y=S*m+E*(g=n.resultTransform.y)+e.resultMatrix.tx,v=T*m+w*g+e.resultMatrix.ty):(g=0,y=S*m+e.resultMatrix.tx,v=T*m+e.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new x,i.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(r,a,15,"#ffff00"),this._sp.graphics.drawCircle(y,v,15,"#ff00ff")),e.setRotation(Math.atan2(v-e.resultMatrix.ty,y-e.resultMatrix.tx));var b=e.parentBone;S=b.resultMatrix.a,E=b.resultMatrix.c,T=b.resultMatrix.b;var M=1/(S*(w=b.resultMatrix.d)-E*T),I=r-b.resultMatrix.tx,D=a-b.resultMatrix.ty,A=(I*w-D*E)*M-l,R=(D*S-I*T)*M-h,L=((I=y-b.resultMatrix.tx)*w-(D=v-b.resultMatrix.ty)*E)*M-l,P=(D*S-I*T)*M-h,N=Math.sqrt(L*L+P*P),O=n.length*_,V=NaN,k=NaN;if(C){var F=(A*A+R*R-N*N-(O*=c)*O)/(2*N*O);F<-1?F=-1:F>1&&(F=1),k=Math.acos(F)*s,S=N+O*F,E=O*Math.sin(k),V=Math.atan2(R*S-A*E,A*S+R*E)}else{var B=(S=c*O)*S,U=(E=u*O)*E,H=A*A+R*R,G=Math.atan2(R,A),W=-2*U*N,z=U-B;if((w=W*W-4*z*(T=U*N*N+B*H-B*U))>0){var Y=Math.sqrt(w);W<0&&(Y=-Y);var X=(Y=-(W+Y)/2)/z,j=T/Y,K=Math.abs(X)<Math.abs(j)?X:j;K*K<=H&&(D=Math.sqrt(H-K*K)*s,V=G-Math.atan2(D,K),k=Math.atan2(D/u,(K-N)/c))}var q=0,Z=Number.MAX_VALUE,Q=0,$=0,J=0,tt=0,et=0,it=0;(w=(I=N+S)*I)>tt&&(J=0,tt=w,et=I),(w=(I=N-S)*I)<Z&&(q=Math.PI,Z=w,Q=I);var nt=Math.acos(-S*N/(B-U));(w=(I=S*Math.cos(nt)+N)*I+(D=E*Math.sin(nt))*D)<Z&&(q=nt,Z=w,Q=I,$=D),w>tt&&(J=nt,tt=w,et=I,it=D),H<=(Z+tt)/2?(V=G-Math.atan2($*s,Q),k=q*s):(V=G-Math.atan2(it*s,et),k=J*s)}var rt=Math.atan2(g,m)*p,at=e.resultTransform.skX;(V=(V-rt)*t.radDeg+d-at)>180?V-=360:V<-180&&(V+=360),e.resultTransform.x=l,e.resultTransform.y=h,e.resultTransform.skX=e.resultTransform.skY=at+V*o,at=n.resultTransform.skX,(k=((k+rt)*t.radDeg-0)*p+f-(at%=360))>180?k-=360:k<-180&&(k+=360),n.resultTransform.x=m,n.resultTransform.y=g,n.resultTransform.skX=n.resultTransform.skY=n.resultTransform.skY+k*o,e.update()}},e._applyIk3=function(e,n,r,a,s,o){if(0!=o){var l,h,c=n.resultMatrix.a*n.length,u=n.resultMatrix.b*n.length,_=c*c+u*u,d=Math.sqrt(_),f=e.resultMatrix.tx,p=e.resultMatrix.ty,m=n.resultMatrix.tx,g=n.resultMatrix.ty,y=m-f,v=g-p,S=y*y+v*v,E=Math.sqrt(S),T=(y=r-e.resultMatrix.tx)*y+(v=a-e.resultMatrix.ty)*v,w=Math.sqrt(T);if(d+E<=w||w+d<=E||w+E<=d){var C;m=f+(C=d+E<=w?1:-1)*(r-f)*E/w,g=p+C*(a-p)*E/w}else{var b=(S-_+T)/(2*T),M=Math.sqrt(S-b*b*T)/w,I=f+y*b,D=p+v*b,A=-v*M,R=y*M;s>0?(m=I-A,g=D-R):(m=I+A,g=D+R)}l=m,h=g,this.isDebug&&(this._sp||(this._sp=new x,i.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(f,p,15,"#ff00ff"),this._sp.graphics.drawCircle(r,a,15,"#ffff00"),this._sp.graphics.drawCircle(l,h,15,"#ff00ff"));var L,P;L=Math.atan2(h-e.resultMatrix.ty,l-e.resultMatrix.tx),e.setRotation(L),(P=t._tempMatrix).identity(),P.rotate(L),P.scale(e.resultMatrix.getScaleX(),e.resultMatrix.getScaleY()),P.translate(e.resultMatrix.tx,e.resultMatrix.ty),P.copyTo(e.resultMatrix),e.updateChild();var N,O;N=Math.atan2(a-h,r-l),n.setRotation(N),(O=t._tempMatrix).identity(),O.rotate(N),O.scale(n.resultMatrix.getScaleX(),n.resultMatrix.getScaleY()),O.translate(l,h),P.copyTo(n.resultMatrix),n.updateChild()}},n(t,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new m}]),t}(),U=function(){function t(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return r(t,"laya.ani.bone.IkConstraintData"),t}(),H=function(){function t(){}return r(t,"laya.ani.bone.MeshTools"),t.findEdge=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0);var n,r=0,a=0;for(n=t.length,a=-1,r=0;r<n;r+=2)(a<0||i==t[a+e]<t[r+e])&&(a=r);return a},t.findBestTriangle=function(e){var i;i=t.findEdge(e,1,!0);var n;n=t.findEdge(e,1,!1);var r;r=t.findEdge(e,0,!0);var a,s;return a=t.findEdge(e,0,!1),(s=t._bestTriangle).length=0,s.push(r,a),s.indexOf(i)<0&&s.push(i),s.indexOf(n)<0&&s.push(n),s},t.solveMesh=function(e,i){var n,r;(i=i||[]).length=0,n=e.uvs,r=e.vertices;var a,s,o,l,h;return o=(s=t.findBestTriangle(n))[0],l=s[1],h=s[2],t._absArr.length=0,t.isNormalUV(e.texture.uv)&&t.adptTexture(e),a=t.solvePoints(e.texture.uv,n[o],n[o+1],n[l]-n[o],n[l+1]-n[o+1],n[h]-n[o],n[h+1]-n[o+1],t._absArr),t.transPoints(a,r[o],r[o+1],r[l]-r[o],r[l+1]-r[o+1],r[h]-r[o],r[h+1]-r[o+1],i)},t.findWrapRect=function(e){var i;i=t.findEdge(e,1,!0);var n;n=t.findEdge(e,1,!1);var r;r=t.findEdge(e,0,!0);var a;a=t.findEdge(e,0,!1);var s;s=e[r];var o;o=e[a];var l;l=e[i+1];var h;return[o,h=e[n+1],s-o,l-h]},t.adptTexture=function(e){var i;i=t.findWrapRect(e.uvs);var n,r,a=(n=e.texture).width,s=n.height;r=T.create(n,i[0]*a,i[1]*s,i[2]*a,i[3]*s),e.texture=r},t.isNormalUV=function(t){return 0==t[0]&&0==t[1]&&1==t[4]&&1==t[5]},t.solvePoints=function(e,i,n,r,a,s,o,l){l=l||[];var h,c,u=0;for(h=e.length,u=0;u<h;u+=2)c=t.solve2(e[u],e[u+1],i,n,r,a,s,o),l.push(c[0],c[1]);return l},t.transPoints=function(e,i,n,r,a,s,o,l){l=l||[];var h,c=0;for(h=e.length,c=0;c<h;c+=2)t.transPoint(e[c],e[c+1],i,n,r,a,s,o,l);return l},t.transPoint=function(t,e,i,n,r,a,s,o,l){var h,c;return h=i+r*t+s*e,c=n+a*t+o*e,(l=l||[]).push(h,c),l},t.solve2=function(e,i,n,r,a,s,o,l,h,c){void 0===h&&(h=!1),c=c||[];var u,_;if(0==a)return t.solve2(e,i,n,r,o,l,a,s,!0,c);var d;return u=((d=e-n)-(_=(i-r-d*s/a)/(l-o*s/a))*o)/a,h?c.push(_,u):c.push(u,_),c},t.solve=function(e,i,n,r){return t.solve2(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)},t._bestTriangle=[],t._absArr=[],t}(),G=function(){function t(t,e){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=t,this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.bones=[];for(var i=this.data.bones,n=0,r=i.length;n<r;n++)this.bones.push(e[i[n]])}r(t,"laya.ani.bone.PathConstraint");var e=t.prototype;return e.apply=function(t,e){if(this.target){var i=this.translateMix,n=this.translateMix,r=n>0,a=this.data.spacingMode,s="length"==a,o=this.data.rotateMode,l="tangent"==o,h="chainScale"==o,c=[],u=this.bones.length,_=l?u:u+1,d=[];this._spaces=d,d[0]=this.position;var f=this.spacing;if(h||s)for(var p=0,m=_-1;p<m;){var g=this.bones[p],y=g.length,v=y*g.resultMatrix.a,S=y*g.resultMatrix.b;y=Math.sqrt(v*v+S*S),h&&(c[p]=y),d[++p]=s?Math.max(0,y+f):f}else for(p=1;p<_;p++)d[p]=f;var x=this.computeWorldPositions(this.target,t,e,_,l,"percent"==this.data.positionMode,"percent"==a);if(this._debugKey){for(p=0;p<x.length;p++)e.drawCircle(x[p++],x[p++],5,"#00ff00");var E=[];for(p=0;p<x.length;p++)E.push(x[p++],x[p++]);e.drawLines(0,0,E,"#ff0000")}var T=x[0],w=x[1],C=this.data.offsetRotation,b="chain"==o&&0==C,M=NaN;for(p=0,M=3;p<u;p++,M+=3){(g=this.bones[p]).resultMatrix.tx+=(T-g.resultMatrix.tx)*i,g.resultMatrix.ty+=(w-g.resultMatrix.ty)*i;var I=(v=x[M])-T,D=(S=x[M+1])-w;if(h&&0!=(y=c[p])){var A=(Math.sqrt(I*I+D*D)/y-1)*n+1;g.resultMatrix.a*=A,g.resultMatrix.c*=A}if(T=v,w=S,r){var R=g.resultMatrix.a,L=g.resultMatrix.c,P=g.resultMatrix.b,N=g.resultMatrix.d,O=NaN,V=NaN,k=NaN;O=l?x[M-1]:0==d[p+1]?x[M+2]:Math.atan2(D,I),O-=Math.atan2(P,R)-C/180*Math.PI,b&&(V=Math.cos(O),k=Math.sin(O),T+=((y=g.length)*(V*R-k*P)-I)*n,w+=(y*(k*R+V*P)-D)*n),O>Math.PI?O-=2*Math.PI:O<-Math.PI&&(O+=2*Math.PI),O*=n,V=Math.cos(O),k=Math.sin(O),g.resultMatrix.a=V*R-k*P,g.resultMatrix.c=V*L-k*N,g.resultMatrix.b=k*R+V*P,g.resultMatrix.d=k*L+V*N}}}},e.computeWorldVertices2=function(e,i,n,r,a,s){var o,l,h=e.currDisplayData.bones,c=e.currDisplayData.weights,u=e.currDisplayData.triangles,_=0,d=0,f=0,p=0,m=0,g=0,y=0,v=0,S=0,x=0,E=0;if(null!=h){for(_=0;_<n;_+=2)d+=(p=h[d])+1,f+=p;var T=i;for(m=s,g=3*f;m<r;m+=2){for(y=0,v=0,p=h[d++],p+=d;d<p;d++,g+=3){o=T[h[d]].resultMatrix,S=c[g],x=c[g+1];var w=c[g+2];y+=(S*o.a+x*o.c+o.tx)*w,v+=(S*o.b+x*o.d+o.ty)*w}a[m]=y,a[m+1]=v}}else{var C,b;if(u||(u=c),e.deformData&&(u=e.deformData),C=e.parent,i)for(E=i.length,_=0;_<E;_++)if(i[_].name==C){l=i[_];break}l&&(b=l.resultMatrix),b||(b=t._tempMt);var M=b.tx,I=b.ty,D=b.a,A=b.b,R=b.c,L=b.d;for(l&&(L*=l.d),d=n,m=s;m<r;d+=2,m+=2)S=u[d],x=u[d+1],a[m]=S*D+x*A+M,a[m+1]=-(S*R+x*L+I)}},e.computeWorldPositions=function(t,e,i,n,r,a,s){t.currDisplayData.bones,t.currDisplayData.weights,t.currDisplayData.triangles;var o,l=[],h=0,c=t.currDisplayData.verLen,u=this.position,_=this._spaces,d=[],f=c/6,p=-1,m=NaN,g=0,y=0,v=NaN,S=NaN,x=NaN,E=NaN;if(f--,c-=4,this.computeWorldVertices2(t,e,2,c,l,0),this._debugKey)for(h=0;h<l.length;)i.drawCircle(l[h++],l[h++],10,"#ff0000");o=l,this._curves.length=f;var T=this._curves;m=0;var w=o[0],C=o[1],b=0,M=0,I=0,D=0,A=0,R=0,L=NaN,P=NaN,N=NaN,O=NaN,V=NaN,k=NaN,F=NaN,B=NaN,U=0;for(h=0,U=2;h<f;h++,U+=6)V=2*(L=.1875*(w-2*(b=o[U])+(I=o[U+2])))+(N=.09375*(3*(b-I)-w+(A=o[U+4]))),k=2*(P=.1875*(C-2*(M=o[U+1])+(D=o[U+3])))+(O=.09375*(3*(M-D)-C+(R=o[U+5]))),F=.75*(b-w)+L+.16666667*N,B=.75*(M-C)+P+.16666667*O,m+=Math.sqrt(F*F+B*B),F+=V,B+=k,V+=N,k+=O,m+=Math.sqrt(F*F+B*B),F+=V,B+=k,m+=Math.sqrt(F*F+B*B),F+=V+N,B+=k+O,m+=Math.sqrt(F*F+B*B),T[h]=m,w=A,C=R;if(a&&(u*=m),s)for(h=0;h<n;h++)_[h]*=m;var H=this._segments,G=0,W=0;for(h=0,g=0,y=0,W=0;h<n;h++,g+=3)if((v=u+=S=_[h])<0)this.addBeforePosition(v,o,0,d,g);else if(v>m)this.addAfterPosition(v-m,o,c-4,d,g);else{for(;;y++)if(!(v>(E=T[y]))){0==y?v/=E:v=(v-(x=T[y-1]))/(E-x);break}if(y!=p){p=y;var z=6*y;for(V=2*(L=.03*((w=o[z])-2*(b=o[z+2])+(I=o[z+4])))+(N=.006*(3*(b-I)-w+(A=o[z+6]))),k=2*(P=.03*((C=o[z+1])-2*(M=o[z+3])+(D=o[z+5])))+(O=.006*(3*(M-D)-C+(R=o[z+7]))),F=.3*(b-w)+L+.16666667*N,B=.3*(M-C)+P+.16666667*O,G=Math.sqrt(F*F+B*B),H[0]=G,z=1;z<8;z++)F+=V,B+=k,V+=N,k+=O,G+=Math.sqrt(F*F+B*B),H[z]=G;F+=V,B+=k,G+=Math.sqrt(F*F+B*B),H[8]=G,F+=V+N,B+=k+O,G+=Math.sqrt(F*F+B*B),H[9]=G,W=0}for(v*=G;;W++)if(!(v>(E=H[W]))){0==W?v/=E:v=W+(v-(x=H[W-1]))/(E-x);break}this.addCurvePosition(.1*v,w,C,b,M,I,D,A,R,d,g,r||h>0&&0==S)}return d},e.addBeforePosition=function(t,e,i,n,r){var a=e[i],s=e[i+1],o=e[i+2]-a,l=e[i+3]-s,h=Math.atan2(l,o);n[r]=a+t*Math.cos(h),n[r+1]=s+t*Math.sin(h),n[r+2]=h},e.addAfterPosition=function(t,e,i,n,r){var a=e[i+2],s=e[i+3],o=a-e[i],l=s-e[i+1],h=Math.atan2(l,o);n[r]=a+t*Math.cos(h),n[r+1]=s+t*Math.sin(h),n[r+2]=h},e.addCurvePosition=function(t,e,i,n,r,a,s,o,l,h,c,u){0==t&&(t=1e-4);var _=t*t,d=_*t,f=1-t,p=f*f,m=p*f,g=f*t,y=3*g,v=f*y,S=y*t,x=e*m+n*v+a*S+o*d,E=i*m+r*v+s*S+l*d;h[c]=x,h[c+1]=E,h[c+2]=u?Math.atan2(E-(i*p+r*g*2+s*_),x-(e*p+n*g*2+a*_)):0},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,n(t,["_tempMt",function(){return this._tempMt=new m}]),t}(),W=function(){function t(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return r(t,"laya.ani.bone.PathConstraintData"),t}(),z=function(){function t(){this.name=null,this.slotArr=[]}return r(t,"laya.ani.bone.SkinData"),t}(),Y=function(){function t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}r(t,"laya.ani.bone.SkinSlotDisplayData");var e=t.prototype;return e.createTexture=function(t){return this.texture?this.texture:(this.texture=new T(t.bitmap,this.uvs),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=t.height,this.texture.height=t.width,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceHeight,this.texture.sourceHeight=t.sourceWidth):(this.texture.width=t.width,this.texture.height=t.height,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceWidth,this.texture.sourceHeight=t.sourceHeight),y.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY),this.texture)},e.destory=function(){this.texture&&this.texture.destroy()},t}(),X=function(){function t(){this.name=null,this.displayArr=[]}return r(t,"laya.ani.bone.SlotData"),t.prototype.getDisplayByName=function(t){for(var e=0,i=this.displayArr.length;e<i;e++)if(this.displayArr[e].attachmentName==t)return e;return-1},t}(),j=function(){function t(t,e){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=s(2,0),this._data=t,null==this._bones&&(this._bones=[]),this.target=e[t.targetIndex];var i,n=0;for(n=0,i=t.boneIndexs.length;n<i;n++)this._bones.push(e[t.boneIndexs[n]]);this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix}return r(t,"laya.ani.bone.TfConstraint"),t.prototype.apply=function(){for(var t,e=this.target.resultMatrix.a,i=this.target.resultMatrix.b,n=this.target.resultMatrix.c,r=this.target.resultMatrix.d,a=0,s=this._bones.length;a<s;a++){if(t=this._bones[a],this.rotateMix>0){var o=t.resultMatrix.a,l=t.resultMatrix.b,h=t.resultMatrix.c,c=t.resultMatrix.d,u=Math.atan2(n,e)-Math.atan2(h,o)+this._data.offsetRotation*Math.PI/180;u>Math.PI?u-=2*Math.PI:u<-Math.PI&&(u+=2*Math.PI),u*=this.rotateMix;var _=Math.cos(u),d=Math.sin(u);t.resultMatrix.a=_*o-d*h,t.resultMatrix.b=_*l-d*c,t.resultMatrix.c=d*o+_*h,t.resultMatrix.d=d*l+_*c}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),t.resultMatrix.tx+=(this._temp[0]-t.resultMatrix.tx)*this.translateMix,t.resultMatrix.ty+=(this._temp[1]-t.resultMatrix.ty)*this.translateMix,t.updateChild()),this.scaleMix>0){var f=Math.sqrt(t.resultMatrix.a*t.resultMatrix.a+t.resultMatrix.c*t.resultMatrix.c),p=Math.sqrt(e*e+n*n),m=f>1e-5?(f+(p-f+this._data.offsetScaleX)*this.scaleMix)/f:0;t.resultMatrix.a*=m,t.resultMatrix.c*=m,f=Math.sqrt(t.resultMatrix.b*t.resultMatrix.b+t.resultMatrix.d*t.resultMatrix.d),p=Math.sqrt(i*i+r*r),m=f>1e-5?(f+(p-f+this._data.offsetScaleY)*this.scaleMix)/f:0,t.resultMatrix.b*=m,t.resultMatrix.d*=m}if(this.shearMix>0){l=t.resultMatrix.b,c=t.resultMatrix.d;var g=Math.atan2(c,l);(u=Math.atan2(r,i)-Math.atan2(n,e)-(g-Math.atan2(t.resultMatrix.c,t.resultMatrix.a)))>Math.PI?u-=2*Math.PI:u<-Math.PI&&(u+=2*Math.PI),u=g+(u+this._data.offsetShearY*Math.PI/180)*this.shearMix,m=Math.sqrt(l*l+c*c),t.resultMatrix.b=Math.cos(u)*m,t.resultMatrix.d=Math.sin(u)*m}}},t}(),K=function(){function t(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return r(t,"laya.ani.bone.TfConstraintData"),t}(),q=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}r(t,"laya.ani.bone.Transform");var e=t.prototype;return e.initData=function(t){void 0!=t.x&&(this.x=t.x),void 0!=t.y&&(this.y=t.y),void 0!=t.skX&&(this.skX=t.skX),void 0!=t.skY&&(this.skY=t.skY),void 0!=t.scX&&(this.scX=t.scX),void 0!=t.scY&&(this.scY=t.scY)},e.getMatrix=function(){var t;return(t=this.mMatrix?this.mMatrix:this.mMatrix=new m).identity(),t.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(t,this.skewX*Math.PI/180,this.skewY*Math.PI/180),t.rotate(this.skX*Math.PI/180),t.translate(this.x,this.y),t},e.skew=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=Math.sin(e),s=Math.cos(e);return t.setTo(t.a*s-t.b*n,t.a*a+t.b*r,t.c*s-t.d*n,t.c*a+t.d*r,t.tx*s-t.ty*n,t.tx*a+t.ty*r),t},t}(),Z=function(){function t(){}return r(t,"laya.ani.bone.UVTools"),t.getRelativeUV=function(t,e,i){var n=t[0],r=t[2]-t[0],a=t[1],s=t[5]-t[1];i||(i=[]),i.length=e.length;var o,l=0;o=i.length;var h=1/r,c=1/s;for(l=0;l<o;l+=2)i[l]=(e[l]-n)*h,i[l+1]=(e[l+1]-a)*c;return i},t.getAbsoluteUV=function(t,e,i){if(0==t[0]&&0==t[1]&&1==t[4]&&1==t[5])return i?(C.copyArray(i,e),i):e;var n=t[0],r=t[2]-t[0],a=t[1],s=t[5]-t[1];i||(i=[]),i.length=e.length;var o,l=0;for(o=i.length,l=0;l<o;l+=2)i[l]=e[l]*r+n,i[l+1]=e[l+1]*s+a;return i},t}(),Q=function(){function t(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return r(t,"laya.ani.KeyFramesContent"),t}(),$=function(){function t(){}return r(t,"laya.ani.math.BezierLerp"),t.getBezierRate=function(e,i,n,r,a){var s=t._getBezierParamKey(i,n,r,a),o=100*s+e;if(t._bezierResultCache[o])return t._bezierResultCache[o];var l,h=t._getBezierPoints(i,n,r,a,s),c=0;for(l=h.length,c=0;c<l;c+=2)if(e<=h[c])return t._bezierResultCache[o]=h[c+1],h[c+1];return t._bezierResultCache[o]=1,1},t._getBezierParamKey=function(t,e,i,n){return 100*(100*(100*(100*t+e)+i)+n)},t._getBezierPoints=function(e,i,n,r,a){return t._bezierPointsCache[a]?t._bezierPointsCache[a]:(s=[0,0,e,i,n,r,1,1],l=(new o).getBezierPoints(s,100,3),t._bezierPointsCache[a]=l,l);var s,l},t._bezierResultCache={},t._bezierPointsCache={},t}(),J=function(t){function e(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,e.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}r(e,"laya.ani.AnimationPlayer",c);var n=e.prototype;return i.imps(n,{"laya.resource.IDestroy":!0}),n._onTempletLoadedComputeFullKeyframeIndices=function(t,e,i){this._templet===i&&this._cachePlayRate===t&&this._cacheFrameRate===e&&this._computeFullKeyframeIndices()},n._computeFullKeyframeIndices=function(){for(var t=this._fullFrames=[],e=this._templet,i=this._cacheFrameRateInterval*this._cachePlayRate,n=0,r=e.getAnimationCount();n<r;n++){for(var a=[],s=0,o=e.getAnimation(n).nodes.length;s<o;s++){for(var l=e.getAnimation(n).nodes[s],h=Math.floor(l.playTime/i+.01),c=new Uint16Array(h+1),u=-1,_=0,d=l.keyFrame.length;_<d;_++){var f=l.keyFrame[_],p=f.startTime,m=p+f.duration+i;do{for(var g=Math.floor(p/i+.5),y=u+1;y<g;y++)c[y]=_;u=g,c[g]=_,p+=i}while(p<=m)}a.push(c)}t.push(a)}},n._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},n._calculatePlayDuration=function(){if(0!==this.state){var t=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=t),this._playEnd>t&&(this._playEnd=t),this._playDuration=this._playEnd-this._playStart}},n._setPlayParams=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e},n._setPlayParamsWhenStop=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(t/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e,this._currentAnimationClipIndex=-1},n._update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==E.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=n)return this._setPlayParamsWhenStop(n,e),void this.event("stopped");if(i+=this._currentTime,n>0)if(i>=n)do{if(i-=n,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,e),this._stopWhenCircleFinish=!1,void this.event("stopped");i<n&&(this._setPlayParams(i,e),this.event("complete"))}while(i>=n);else this._setPlayParams(i,e);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,e),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},n._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},n.play=function(t,e,i,n,r){if(void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===r&&(r=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(i<0||n<0||r<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==r&&n>r)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=e,this._overallDuration=i,this._playStart=n,this._playEnd=r,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=E.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},n.playByFrame=function(t,e,i,n,r,a){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=30);var s=1e3/a;this.play(t,e,i,n*s,r*s)},n.stop=function(t){void 0===t&&(t=!0),t?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},a(0,n,"playEnd",function(){return this._playEnd}),a(0,n,"templet",function(){return this._templet},function(t){0===!this.state&&this.stop(!0),this._templet!==t&&(this._templet=t,t.loaded?this._computeFullKeyframeIndices():t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),a(0,n,"playStart",function(){return this._playStart}),a(0,n,"playDuration",function(){return this._playDuration}),a(0,n,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),a(0,n,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),a(0,n,"overallDuration",function(){return this._overallDuration}),a(0,n,"currentFrameTime",function(){return this._currentFrameTime}),a(0,n,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),a(0,n,"currentPlayTime",function(){return this._currentTime+this._playStart}),a(0,n,"cachePlayRate",function(){return this._cachePlayRate},function(t){this._cachePlayRate!==t&&(this._cachePlayRate=t,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[t,this._cacheFrameRate])))}),a(0,n,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){this._cacheFrameRate!==t&&(this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,t])))}),a(0,n,"currentTime",null,function(t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=E.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e),0),this._currentFrameTime=this._currentKeyframeIndex*e}}),a(0,n,"paused",function(){return this._paused},function(t){this._paused=t,t&&this.event("paused")}),a(0,n,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),a(0,n,"destroyed",function(){return this._destroyed}),e}(),tt=function(t){function e(){e.__super.call(this),y.isConchNode&&(this.drawSkin=function(t){t.transform||(t.transform=m.EMPTY),this._addCmd([t]),this.setSkinMesh&&this.setSkinMesh(t._ps,t.mVBData,t.mEleNum,0,t.mTexture,t.transform)})}return r(e,"laya.ani.GraphicsAni",u),e.prototype.drawSkin=function(t){var e=[t];this._saveToCmd(y._context._drawSkin,e)},e.create=function(){return e._caches.pop()||new e},e.recycle=function(t){t.clear(),e._caches.push(t)},e._caches=[],e}(),et=function(t){function e(){e.__super.call(this),this.mesh=new P}r(e,"laya.ani.bone.canvasmesh.SkinMeshCanvas",L);var i=e.prototype;return i.init2=function(t,e,i,n,r){var a;this.transform&&(this.transform=null),i?a=i:(a=[]).push(0,1,3,3,1,2),this.mesh.texture=t,this.mesh.indexes=a,this.mesh.vertices=n,this.mesh.uvs=r},i.render=function(t,i,n){this.mesh.texture&&(this.transform?(this.transform.translate(i,n),this.renderToContext(t),this.transform.translate(-i,-n)):(this.transform=e._tempMatrix,this.transform.identity(),this.transform.translate(i,n),this.renderToContext(t),this.transform.translate(-i,-n),this.transform=null))},n(e,["_tempMatrix",function(){return this._tempMatrix=new m}]),e}(),it=function(t){function e(){this._aniMap={},this.unfixedLastAniIndex=-1,e.__super.call(this),this._anis=new Array}r(e,"laya.ani.AnimationTemplet",v);var n=e.prototype;return n.parse=function(t){var e=new h(t);this._aniVersion=e.readUTFString(),I.parse(this,e)},n._calculateKeyFrame=function(t,e,i){var n=t.keyFrame;n[e]=n[0];for(var r=0;r<e;r++){var a=n[r];a.nextData=0===a.duration?a.data:n[r+1].data}n.length--},n.onAsynLoaded=function(t,e,i){var n=new h(e);switch(this._aniVersion=n.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":D.parse(this,n);break;default:I.parse(this,n)}this._endLoaded()},n.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},n.getAnimationCount=function(){return this._anis.length},n.getAnimation=function(t){return this._anis[t]},n.getAniDuration=function(t){return this._anis[t].playTime},n.getNodes=function(t){return this._anis[t].nodes},n.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},n.getNodeCount=function(t){return this._anis[t].nodes.length},n.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframeDatasLength},n.getPublicExtData=function(){return this._publicExtData},n.getAnimationDataWithCache=function(t,e,i,n){var r=e[i];if(r){var a=r[t];return a?a[n]:null}return null},n.setAnimationDataWithCache=function(t,e,i,n,r){var a=e[i]||(e[i]={});(a[t]||(a[t]=[]))[n]=r},n.getOriginalData=function(t,i,n,r,a){for(var s=this._anis[t].nodes,o=0,l=0,h=s.length,c=0;l<h;l++){var u,_=s[l];u=_.keyFrame[n[l][r]],_.dataOffset=c;var d=a-u.startTime,f=_.lerpType;if(f)switch(f){case 0:case 1:for(o=0;o<_.keyframeWidth;)o+=_.interpolationMethod[o](_,o,i,c+o,u.data,d,null,u.duration,u.nextData);break;case 2:var p=u.interpolationData,m=p.length,g=0;for(o=0;o<m;){var y=p[o];switch(y){case 6:case 7:o+=e.interpolation[y](_,g,i,c+g,u.data,d,null,u.duration,u.nextData,p,o+1);break;default:o+=e.interpolation[y](_,g,i,c+g,u.data,d,null,u.duration,u.nextData)}g++}}else for(o=0;o<_.keyframeWidth;)o+=_.interpolationMethod[o](_,o,i,c+o,u.data,d,null,u.duration,u.nextData);c+=_.keyframeWidth}},n.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(i.length),this.unfixedCurrentTimes=new Float32Array(i.length),this.unfixedLastAniIndex=t);for(var n=0,r=i.length;n<r;n++){var a=i[n];for(e<this.unfixedCurrentTimes[n]&&(this.unfixedCurrentFrameIndexes[n]=0),this.unfixedCurrentTimes[n]=e;this.unfixedCurrentFrameIndexes[n]<a.keyFrame.length&&!(a.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n]);)this.unfixedCurrentFrameIndexes[n]++;this.unfixedCurrentFrameIndexes[n]--}return this.unfixedCurrentFrameIndexes},n.getOriginalDataUnfixedRate=function(t,i,n){var r=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(r.length),this.unfixedCurrentTimes=new Float32Array(r.length),this.unfixedKeyframes=s(r.length),this.unfixedLastAniIndex=t);for(var a=0,o=0,l=r.length,h=0;o<l;o++){var c=r[o];for(n<this.unfixedCurrentTimes[o]&&(this.unfixedCurrentFrameIndexes[o]=0),this.unfixedCurrentTimes[o]=n;this.unfixedCurrentFrameIndexes[o]<c.keyFrame.length&&!(c.keyFrame[this.unfixedCurrentFrameIndexes[o]].startTime>this.unfixedCurrentTimes[o]);)this.unfixedKeyframes[o]=c.keyFrame[this.unfixedCurrentFrameIndexes[o]],this.unfixedCurrentFrameIndexes[o]++;var u=this.unfixedKeyframes[o];c.dataOffset=h;var _=n-u.startTime;if(c.lerpType)switch(c.lerpType){case 0:case 1:for(a=0;a<c.keyframeWidth;)a+=c.interpolationMethod[a](c,a,i,h+a,u.data,_,null,u.duration,u.nextData);break;case 2:var d=u.interpolationData,f=d.length,p=0;for(a=0;a<f;){var m=d[a];switch(m){case 6:case 7:a+=e.interpolation[m](c,p,i,h+p,u.data,_,null,u.duration,u.nextData,d,a+1);break;default:a+=e.interpolation[m](c,p,i,h+p,u.data,_,null,u.duration,u.nextData)}p++}}else for(a=0;a<c.keyframeWidth;)a+=c.interpolationMethod[a](c,a,i,h+a,u.data,_,null,u.duration,u.nextData);h+=c.keyframeWidth}},e._LinearInterpolation_0=function(t,e,i,n,r,a,s,o,l,h){var c=0===o?0:a/o;return i[n]=(1-c)*r[e]+c*l[e],1},e._QuaternionInterpolation_1=function(t,e,i,n,r,a,s,o,l,h){var c=0===o?0:a/o;return p.slerpQuaternionArray(r,e,l,e,c,i,n),4},e._AngleInterpolation_2=function(t,e,i,n,r,a,s,o,l,h){return 0},e._RadiansInterpolation_3=function(t,e,i,n,r,a,s,o,l,h){return 0},e._Matrix4x4Interpolation_4=function(t,e,i,n,r,a,s,o,l,h){for(var c=0;c<16;c++,e++)i[n+c]=r[e]+a*s[e];return 16},e._NoInterpolation_5=function(t,e,i,n,r,a,s,o,l,h){return i[n]=r[e],1},e._BezierInterpolation_6=function(t,e,i,n,r,a,s,o,l,h,c){return void 0===c&&(c=0),i[n]=r[e]+(l[e]-r[e])*$.getBezierRate(a/o,h[c],h[c+1],h[c+2],h[c+3]),5},e._BezierInterpolation_7=function(t,e,i,n,r,a,s,o,l,h,c){return void 0===c&&(c=0),i[n]=h[c+4]+h[c+5]*$.getBezierRate((.001*a+h[c+6])/h[c+7],h[c],h[c+1],h[c+2],h[c+3]),9},e.load=function(t){return i.loader.create(t,null,null,e)},e.interpolation=[e._LinearInterpolation_0,e._QuaternionInterpolation_1,e._AngleInterpolation_2,e._RadiansInterpolation_3,e._Matrix4x4Interpolation_4,e._NoInterpolation_5,e._BezierInterpolation_6,e._BezierInterpolation_7],e}(),nt=(function(t){function e(){this.isCached=!1,this.canvas=null,this.tex=null,this.rec=null,e.__super.call(this)}r(e,"laya.ani.bone.canvasmesh.CacheAbleSkinMesh",et);var i=e.prototype;i.getCanvasPic=function(){var t,i=new _("2D"),n=i.getContext("2d");return this.rec=this.mesh.getBounds(),i.size(this.rec.width,this.rec.height),t=this.transform,this.transform=e.tempMt,this.transform.identity(),this.transform.translate(-this.rec.x,-this.rec.y),this.renderToContext(n),this.transform.translate(+this.rec.x,+this.rec.y),this.transform=t,new T(i)},i.render=function(t,e,i){this.mesh.texture&&(this.isCached||(this.isCached=!0,this.tex=this.getCanvasPic()),this.transform?(this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i)):(this.transform=et._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i),this.transform=null))},i._renderTextureToContext=function(t){var e;if(this.context=t.ctx||t,t.save(),e=this.tex,this.transform){var i=this.transform;t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}this.rec=this.mesh.getBounds(),t.translate(this.rec.x,this.rec.y),t.drawTexture(e,0,0,e.width,e.height,0,0),t.restore()},n(e,["tempMt",function(){return this.tempMt=new m}])}(),function(t){function e(){this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds=[],this.drawCmds=[],e.__super.call(this),this.tempMesh=new P}r(e,"laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas",t);var i=e.prototype;return i.init2=function(e,i,n,r,a){t.prototype.init2.call(this,e,i,n,r,a),this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds.length=6,this.drawCmds.length=9},i.renderToContext=function(t){if(this.context=t.ctx||t,this.mesh){if(this.mesh.uvs.length<=8)return void(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh));this.cacheOK||(this.tempMesh.texture=this.mesh.texture,this.tempMesh.uvs=this.mesh.texture.uv,this.tempMesh.vertices=H.solveMesh(this.mesh,this.tempMesh.vertices),this.cacheOK=!0),0==this.mode?this._renderWithIndexes(this.tempMesh):this._renderNoIndexes(this.tempMesh)}},i._renderWithIndexes=function(t){if(this.cacheCmdOK)this.renderByCache(t);else{var e=t.indexes,i=0,n=e.length;for(n>1&&(n=1),i=0;i<n;i+=3){var r=2*e[i],a=2*e[i+1],s=2*e[i+2];this._renderDrawTriangle(t,r,a,s)}this.cacheCmdOK=!0}},i._renderDrawTriangle=function(t,e,i,n){var r=this.context,a=t.uvs,s=t.vertices,o=t.texture,l=o.bitmap,h=l.source,c=o.width,u=o.height,_=l.width,d=l.height,f=NaN,p=NaN,m=NaN,g=NaN,y=NaN,v=NaN;if(t.useUvTransform){var S=t.uvTransform;f=(a[e]*S.a+a[e+1]*S.c+S.tx)*_,p=(a[i]*S.a+a[i+1]*S.c+S.tx)*_,m=(a[n]*S.a+a[n+1]*S.c+S.tx)*_,g=(a[e]*S.b+a[e+1]*S.d+S.ty)*d,y=(a[i]*S.b+a[i+1]*S.d+S.ty)*d,v=(a[n]*S.b+a[n+1]*S.d+S.ty)*d}else f=a[e]*_,p=a[i]*_,m=a[n]*_,g=a[e+1]*d,y=a[i+1]*d,v=a[n+1]*d;var x=s[e],E=s[i],T=s[n],w=s[e+1],C=s[i+1],b=s[n+1],M=1/(f*y+g*m+p*v-y*m-g*p-f*v),I=x*y+g*T+E*v-y*T-g*E-x*v,D=f*E+x*m+p*T-E*m-x*p-f*T,A=f*y*T+g*E*m+x*p*v-x*y*m-g*p*T-f*E*v,R=w*y+g*b+C*v-y*b-g*C-w*v,L=f*C+w*m+p*b-C*m-w*p-f*b,P=f*y*b+g*C*m+w*p*v-w*y*m-g*p*b-f*C*v;if(this.transformCmds[0]=I*M,this.transformCmds[1]=R*M,this.transformCmds[2]=D*M,this.transformCmds[3]=L*M,this.transformCmds[4]=A*M,this.transformCmds[5]=P*M,this.drawCmds[0]=h,this.drawCmds[1]=o.uv[0]*_,this.drawCmds[2]=o.uv[1]*d,this.drawCmds[3]=c,this.drawCmds[4]=u,this.drawCmds[5]=o.uv[0]*_,this.drawCmds[6]=o.uv[1]*d,this.drawCmds[7]=c,this.drawCmds[8]=u,r.save(),this.transform){var N=this.transform;r.transform(N.a,N.b,N.c,N.d,N.tx,N.ty)}r.transform.apply(r,this.transformCmds),r.drawImage.apply(r,this.drawCmds),r.restore()},i.renderByCache=function(t){var e=this.context;if(e.save(),this.transform){var i=this.transform;e.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}e.transform.apply(e,this.transformCmds),e.drawImage.apply(e,this.drawCmds),e.restore()},e}(et)),rt=function(t){function e(t,i){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,e.__super.call(this),void 0===i&&(i=0),t&&this.init(t,i)}r(e,"laya.ani.bone.Skeleton",t);var n=e.prototype;return n.init=function(t,e){void 0===e&&(e=0);var i,n,r,a=0,s=0;if(1==e)for(this._graphicsCache=[],a=0,s=t.getAnimationCount();a<s;a++)this._graphicsCache.push([]);if(this._yReverseMatrix=t.yReverseMatrix,this._aniMode=e,this._templet=t,this._player=new J,this._player.cacheFrameRate=t.rate,this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=t.mBoneArr,this._rootBone=t.mRootBone,this._aniSectionDic=t.aniSectionDic,t.ikArr.length>0)for(this._ikArr=[],a=0,s=t.ikArr.length;a<s;a++)this._ikArr.push(new B(t.ikArr[a],this._boneList));if(t.pathArr.length>0)for(null==this._pathDic&&(this._pathDic={}),a=0,s=t.pathArr.length;a<s;a++)i=t.pathArr[a],n=new G(i,this._boneList),(r=this._boneSlotDic[i.name])&&((n=new G(i,this._boneList)).target=r),this._pathDic[i.name]=n;if(t.tfArr.length>0)for(this._tfArr=[],a=0,s=t.tfArr.length;a<s;a++)this._tfArr.push(new j(t.tfArr[a],this._boneList));if(t.skinDataArray.length>0){var o=this._templet.skinDataArray[this._skinIndex];this._skinName=o.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},n.load=function(t,e,n){void 0===n&&(n=0),this._aniPath=t,this._complete=e,this._loadAniMode=n,i.loader.load([{url:t,type:"arraybuffer"}],d.create(this,this._onLoaded))},n._onLoaded=function(){var t,e=f.getRes(this._aniPath);null!=e&&(null==at.TEMPLET_DICTIONARY&&(at.TEMPLET_DICTIONARY={}),(t=at.TEMPLET_DICTIONARY[this._aniPath])?t.isParseFail?this._parseFail():t.isParserComplete?this._parseComplete():(t.on("complete",this,this._parseComplete),t.on("error",this,this._parseFail)):((t=new at)._setUrl(this._aniPath),at.TEMPLET_DICTIONARY[this._aniPath]=t,t.on("complete",this,this._parseComplete),t.on("error",this,this._parseFail),t.isParserComplete=!1,t.parseData(null,e)))},n._parseComplete=function(){var t=at.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},n._parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败")},n._onPlay=function(){this.event("played")},n._onStop=function(){var t,e=this._templet.eventAniArr[this._aniClipIndex];if(e&&this._eventIndex<e.length)for(;this._eventIndex<e.length;this._eventIndex++)(t=e[this._eventIndex]).time>=this._player.playStart&&t.time<=this._player.playEnd&&this.event("label",t);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},n._onPause=function(){this.event("paused")},n._parseSrcBoneMatrix=function(){var t=0,e=0;for(e=this._templet.srcBoneMatrixArr.length,t=0;t<e;t++)this._boneMatrixArray.push(new m);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var i,n,r=this._templet.boneSlotArray;for(t=0,e=r.length;t<e;t++)i=r[t],null==(n=this._bindBoneBoneSlotDic[i.parent])&&(this._bindBoneBoneSlotDic[i.parent]=n=[]),this._boneSlotDic[i.name]=i=i.copy(),n.push(i),this._boneSlotArray.push(i)}},n._emitMissedEvents=function(t,e,i){void 0===i&&(i=0);var n=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(n){var r,a,s=0;for(a=n.length,s=i;s<a;s++)(r=n[s]).time>=this._player.playStart&&r.time<=this._player.playEnd&&this.event("label",r)}},n._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var e=this.timer.currTimer,i=this._player.currentKeyframeIndex,n=e-this._lastTime;if(t?this._player._update(n):i=-1,this._lastTime=e,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||n>0&&this._clipIndex==i&&this._lastUpdateAniClipIndex==this._aniClipIndex))){this._lastUpdateAniClipIndex=this._aniClipIndex,i>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var r,a,s=this._templet.eventAniArr[this._aniClipIndex];if(s&&this._eventIndex<s.length&&((r=s[this._eventIndex]).time>=this._player.playStart&&r.time<=this._player.playEnd?this._player.currentPlayTime>=r.time&&(this.event("label",r),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(a=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=a&&(this.graphics=a));var o=0,l=0;for(l=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,l-1)&&l>0;)l--;if(l<this._clipIndex)for(o=l;o<this._clipIndex;o++)this._createGraphics(o)}else if(1==this._aniMode){if(a=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=a&&(this.graphics=a));for(l=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,l-1)&&l>0;)l--;if(l<this._clipIndex)for(o=l;o<this._clipIndex;o++)this._createGraphics(o)}this._createGraphics()}}},n._createGraphics=function(t){void 0===t&&(t=-1),-1==t&&(t=this._clipIndex);var e,i,n=t*this._player.cacheFrameRateInterval,r=this._templet.drawOrderAniArr[this._aniClipIndex];if(r&&r.length>0)for(this._drawOrderIndex=0,e=r[this._drawOrderIndex];n>=e.time&&(this._drawOrder=e.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=r.length));)e=r[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=tt.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=tt.create(),i=this.graphics;var a=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],t,n);var s,o,l,c,u=this._aniSectionDic[this._aniClipIndex],_=0,d=0,f=0,p=0,g=0,y=this._templet.srcBoneMatrixArr.length;for(d=0,g=u[0];d<y;d++)c=this._boneList[d],l=this._templet.srcBoneMatrixArr[d],c.resultTransform.scX=l.scX*this._curOriginalData[_++],c.resultTransform.skX=l.skX+this._curOriginalData[_++],c.resultTransform.skY=l.skY+this._curOriginalData[_++],c.resultTransform.scY=l.scY*this._curOriginalData[_++],c.resultTransform.x=l.x+this._curOriginalData[_++],c.resultTransform.y=l.y+this._curOriginalData[_++],8===this._templet.tMatrixDataLen&&(c.resultTransform.skewX=l.skewX+this._curOriginalData[_++],c.resultTransform.skewY=l.skewY+this._curOriginalData[_++]);var v,S={},x={};for(g+=u[1];d<g;d++)S[(v=a[d]).name]=this._curOriginalData[_++],x[v.name]=this._curOriginalData[_++],this._curOriginalData[_++],this._curOriginalData[_++],this._curOriginalData[_++],this._curOriginalData[_++];var E,T,w={},C={};for(g+=u[2];d<g;d++)w[(v=a[d]).name]=this._curOriginalData[_++],C[v.name]=this._curOriginalData[_++],this._curOriginalData[_++],this._curOriginalData[_++],this._curOriginalData[_++],this._curOriginalData[_++];if(this._pathDic)for(g+=u[3];d<g;d++)if(v=a[d],E=this._pathDic[v.name])switch(new h(v.extenData).getByte()){case 1:E.position=this._curOriginalData[_++];break;case 2:E.spacing=this._curOriginalData[_++];break;case 3:E.rotateMix=this._curOriginalData[_++],E.translateMix=this._curOriginalData[_++]}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(m.TEMP.identity()),this._ikArr)for(d=0,g=this._ikArr.length;d<g;d++)T=this._ikArr[d],w.hasOwnProperty(T.name)&&(T.bendDirection=w[T.name]),C.hasOwnProperty(T.name)&&(T.mix=C[T.name]),T.apply();if(this._pathDic)for(var b in this._pathDic)(E=this._pathDic[b]).apply(this._boneList,i);if(this._tfArr)for(d=0,p=this._tfArr.length;d<p;d++)this._tfArr[d].apply();for(d=0,p=this._boneList.length;d<p;d++)if(c=this._boneList[d],o=this._bindBoneBoneSlotDic[c.name],c.resultMatrix.copyTo(this._boneMatrixArray[d]),o)for(f=0,g=o.length;f<g;f++)(s=o[f])&&s.setParentMatrix(c.resultMatrix);var M,I,D,A,R={},L=this._templet.deformAniArr;if(L&&L.length>0){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,d=0,g=this._boneSlotArray.length;d<g;d++)(s=this._boneSlotArray[d]).deformData=null;var P,N=L[this._aniClipIndex];for(P in M=N.default,this._setDeform(M,R,this._boneSlotArray,n),N)"default"!=P&&P!=this._skinName&&(M=N[P],this._setDeform(M,R,this._boneSlotArray,n));M=N[this._skinName],this._setDeform(M,R,this._boneSlotArray,n)}if(this._drawOrder)for(d=0,g=this._drawOrder.length;d<g;d++)I=S[(s=this._boneSlotArray[this._drawOrder[d]]).name],D=x[s.name],isNaN(D)||(i.save(),i.alpha(D)),isNaN(I)||-2==I||(this._templet.attachmentNames?s.showDisplayByName(this._templet.attachmentNames[I]):s.showDisplayByIndex(I)),R[this._drawOrder[d]]?(A=R[this._drawOrder[d]],s.currDisplayData&&A[s.currDisplayData.attachmentName]?s.deformData=A[s.currDisplayData.attachmentName]:s.deformData=null):s.deformData=null,isNaN(D)?s.draw(i,this._boneMatrixArray,2==this._aniMode):s.draw(i,this._boneMatrixArray,2==this._aniMode,D),isNaN(D)||i.restore();else for(d=0,g=this._boneSlotArray.length;d<g;d++)I=S[(s=this._boneSlotArray[d]).name],D=x[s.name],isNaN(D)||(i.save(),i.alpha(D)),isNaN(I)||-2==I||(this._templet.attachmentNames?s.showDisplayByName(this._templet.attachmentNames[I]):s.showDisplayByIndex(I)),R[d]?(A=R[d],s.currDisplayData&&A[s.currDisplayData.attachmentName]?s.deformData=A[s.currDisplayData.attachmentName]:s.deformData=null):s.deformData=null,isNaN(D)?s.draw(i,this._boneMatrixArray,2==this._aniMode):s.draw(i,this._boneMatrixArray,2==this._aniMode,D),isNaN(D)||i.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,t,i):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,t,i)},n._setDeform=function(t,e,i,n){if(t){var r,a,s,o=0,l=0,h=0;if(t)for(o=0,l=t.deformSlotDataList.length;o<l;o++)for(r=t.deformSlotDataList[o],h=0;h<r.deformSlotDisplayList.length;h++)s=i[(a=r.deformSlotDisplayList[h]).slotIndex],a.apply(n,s),e[a.slotIndex]||(e[a.slotIndex]={}),e[a.slotIndex][a.attachment]=a.deformData}},n.getAnimNum=function(){return this._templet.getAnimationCount()},n.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},n.getSlotByName=function(t){return this._boneSlotDic[t]},n.showSkinByName=function(t,e){void 0===e&&(e=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(t),e)},n.showSkinByIndex=function(t,e){void 0===e&&(e=!0);for(var i=0;i<this._boneSlotArray.length;i++)this._boneSlotArray[i].showSlotData(null,e);if(this._templet.showSkinByIndex(this._boneSlotDic,t,e)){var n=this._templet.skinDataArray[t];this._skinIndex=t,this._skinName=n.name}this._clearCache()},n.showSlotSkinByIndex=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.showDisplayByIndex(e),this._clearCache()}},n.showSlotSkinByName=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.showDisplayByName(e),this._clearCache()}},n.replaceSlotSkinName=function(t,e,i){if(0!=this._aniMode){var n=this.getSlotByName(t);n&&n.replaceDisplayByName(e,i),this._clearCache()}},n.replaceSlotSkinByIndex=function(t,e,i){if(0!=this._aniMode){var n=this.getSlotByName(t);n&&n.replaceDisplayByIndex(e,i),this._clearCache()}},n.setSlotSkin=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.replaceSkin(e),this._clearCache()}},n._clearCache=function(){if(1==this._aniMode)for(var t=0,e=this._graphicsCache.length;t<e;t++){for(var i=0,n=this._graphicsCache[t].length;i<n;i++){var r=this._graphicsCache[t][i];r!=this.graphics&&tt.recycle(r)}this._graphicsCache[t].length=0}},n.play=function(t,e,i,n,r,a){void 0===i&&(i=!0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=!0),this._indexControl=!1;var s,o=-1;if(s=e?2147483647:0,"string"==typeof t)for(var h=0,c=this._templet.getAnimationCount();h<c;h++){var u=this._templet.getAnimation(h);if(u&&t==u.name){o=h;break}}else o=t;o>-1&&o<this.getAnimNum()&&(this._aniClipIndex=o,(i||this._pause||this._currAniIndex!=o)&&(this._currAniIndex=o,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(o)),this._drawOrder=null,this._eventIndex=0,this._player.play(o,this._player.playbackRate,s,n,r),a&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=l.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},n.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},n.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},n.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},n.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=l.now(),this.timer.frameLoop(1,this,this._update,null,!0))},n._getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},n._setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},a(0,n,"url",function(){return this._aniPath},function(t){this.load(t)}),a(0,n,"index",function(){return this._index},function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),a(0,n,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),a(0,n,"templet",function(){return this._templet}),a(0,n,"player",function(){return this._player}),e.useSimpleMeshInCanvas=!1,e}(x),at=(function(t){function e(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._loadedImage={},this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this._atlasPath=null,this._url=null,this._isRoot=!1,this._completeHandler=null,this._endFrame=-1,this.interval=30,this.loop=!1,e.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,this._parentMovieClip=t,t?(this._isRoot=!1,this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this._isRoot=!0,this._setUpNoticeType(1))}r(e,"laya.ani.swf.MovieClip",t);var n=e.prototype;n.destroy=function(e){void 0===e&&(e=!0),this._clear(),t.prototype.destroy.call(this,e)},n._setDisplay=function(e){t.prototype._setDisplay.call(this,e),this._isRoot&&this._$3__onDisplay(e)},n._$3__onDisplay=function(t){t?this.timer.loop(this.interval,this,this.updates,null,!0):this.timer.clear(this,this.updates)},n.updates=function(){if(!this._parentMovieClip){var t,e=0;for(t=this._movieClipList.length,e=0;e<t;e++)this._movieClipList[e]&&this._movieClipList[e]._update()}},n.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]=t},n.removeLabel=function(t){if(t){if(!this._labels)for(var e in this._labels)if(this._labels[e]===t){delete this._labels[e];break}}else this._labels=null},n._update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}if(this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex]),-1!=this._endFrame&&this._endFrame==this._playIndex){if(this._endFrame=-1,null!=this._completeHandler){var t=this._completeHandler;this._completeHandler=null,t.run()}this.stop()}}},n.stop=function(){this._playing=!1},n.gotoAndStop=function(t){this.index=t,this.stop()},n._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){this.timer.clear(this,this.updates);var t,e=0;for(t=this._movieClipList.length,e=0;e<t;e++)this._movieClipList[e]!=this&&this._movieClipList[e]._clear();this._movieClipList.length=0}var i;for(i in this._atlasPath&&f.clearRes(this._atlasPath),this._loadedImage)this._loadedImage[i]&&(f.clearRes(i),this._loadedImage[i]=!1);this.removeChildren(),this.graphics=null,this._parentMovieClip=null},n.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0),this.loop=e,this._playing=!0,this._data&&this._displayFrame(t)},n._displayFrame=function(t){void 0===t&&(t=-1),-1!=t&&(this._curIndex>t&&this._reset(),this._parse(t))},n._reset=function(t){void 0===t&&(t=!0),t&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},n._parse=function(t){var i,n,r,a=0,s=0,o=0,l=!1,h=this._idOfSprite,c=this._data;for(this._ended&&this._reset(),c.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&t<this._preIndex&&(this._reset(!0),c.pos=this._Pos);this._curIndex<=t&&!this._ended;)switch(c.getUint16()){case 12:if(a=c.getUint16(),s=this._ids[c.getUint16()],this._Pos=c.pos,c.pos=s,0==(o=c.getUint8())){var u=c.getUint16();if(!(n=h[a])){n=h[a]=new x;var _=new x;_.loadImage(this.basePath+u+".png"),this._loadedImage[this.basePath+u+".png"]=!0,n.addChild(_),_.size(c.getFloat32(),c.getFloat32());var d=c._getMatrix();_.transform=d}n.alpha=1}else 1==o&&((i=h[a])||(h[a]=i=new e(this),i.interval=this.interval,i._ids=this._ids,i.basePath=this.basePath,i._setData(c,s),i._initState(),i.play(0)),i.alpha=1);c.pos=this._Pos;break;case 3:var f=h[c.getUint16()];f&&(this.addChild(f),f.zOrder=c.getUint16(),l=!0);break;case 4:(f=h[c.getUint16()])&&f.removeSelf();break;case 5:h[c.getUint16()][e._ValueList[c.getUint16()]]=c.getFloat32();break;case 6:h[c.getUint16()].visible=c.getUint8()>0;break;case 7:var p=(n=h[c.getUint16()]).transform||m.create();p.setTo(c.getFloat32(),c.getFloat32(),c.getFloat32(),c.getFloat32(),c.getFloat32(),c.getFloat32()),n.transform=p;break;case 8:h[c.getUint16()].setPos(c.getFloat32(),c.getFloat32());break;case 9:h[c.getUint16()].setSize(c.getFloat32(),c.getFloat32());break;case 10:h[c.getUint16()].alpha=c.getFloat32();break;case 11:h[c.getUint16()].setScale(c.getFloat32(),c.getFloat32());break;case 98:r=c.getString(),this.event(r),"stop"==r&&this.stop();break;case 99:this._curIndex=c.getUint16(),l&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=c.pos},n._setData=function(t,e){this._data=t,this._start=e+3},n.load=function(t,e,n){var r;void 0===e&&(e=!1),this._url=t=w.formatURL(t),e&&(this._atlasPath=n||t.split(".swf")[0]+".json"),this.stop(),this._clear(),this._movieClipList=[this],r=[{url:t,type:"arraybuffer"}],this._atlasPath&&r.push({url:this._atlasPath,type:"atlas"}),i.loader.load(r,d.create(this,this._onLoaded))},n._onLoaded=function(){var t;(t=f.getRes(this._url))?(this.basePath=this._atlasPath?f.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"../../image/default.htm",this._initData(t)):this.event("error","file not find")},n._initState=function(){this._reset(),this._ended=!1;var t=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=t},n._initData=function(t){this._data=new h(t);var e=0,i=this._data.getUint16();for(e=0;e<i;e++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||this.timer.loop(this.interval,this,this.updates,null,!0)},n.playTo=function(t,e,i){this._completeHandler=i,this._endFrame=e,this.play(t,!1)},a(0,n,"index",function(){return this._playIndex},function(t){this._playIndex=t,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])}),a(0,n,"count",function(){return this._count}),a(0,n,"playing",function(){return this._playing}),a(0,n,"url",null,function(t){this.load(t)}),e._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"]}(x),function(t){function e(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,e.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}r(e,"laya.ani.bone.Templet",t);var n=e.prototype;return n.loadAni=function(t){this._skBufferUrl=t,i.loader.load(t,d.create(this,this.onComplete),null,"arraybuffer")},n.onComplete=function(t){if(this._isDestroyed)this.destroy();else{var e=f.getRes(this._skBufferUrl);e?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,e)):this.event("error","load failed:"+this._skBufferUrl)}},n.parseData=function(t,e,i){void 0===i&&(i=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=t,this._mainTexture&&y.isWebGL&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1),this._rate=i,this.parse(e)},n.buildArmature=function(t){return void 0===t&&(t=0),new rt(this,t)},n.parse=function(i){t.prototype.parse.call(this,i),this._endLoaded(),this._aniVersion!=e.LAYA_ANIMATION_VISION&&(console.log("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+e.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},n._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var t=0;this._loadList=[];var e,n=new h(this.getPublicExtData()),r=0,a=n.getInt32(),s=n.readUTFString(),o=s.split("\n");for(t=0;t<a;t++)e=this._path+o[2*t],s=o[2*t+1],n.getFloat32(),n.getFloat32(),n.getFloat32(),n.getFloat32(),r=n.getFloat32(),isNaN(r),r=n.getFloat32(),isNaN(r),r=n.getFloat32(),isNaN(r),r=n.getFloat32(),isNaN(r),-1==this._loadList.indexOf(e)&&this._loadList.push(e);i.loader.load(this._loadList,d.create(this,this._textureComplete))}},n._textureComplete=function(){for(var t,e,i=0,n=this._loadList.length;i<n;i++)e=this._loadList[i],t=this._textureDic[e]=f.getRes(e),y.isWebGL&&t&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},n._parsePublicExtData=function(){var t=0,e=0,i=0,n=0,r=0;for(t=0,r=this.getAnimationCount();t<r;t++)this._graphicsCache.push([]);var a;a="Dragon"!=this._aniClassName;var s,o,l=new h(this.getPublicExtData()),c=0,u=0,_=0,d=0,f=0,p=0,g=0,y=0,v=0,S=l.getInt32(),x=l.readUTFString(),E=x.split("\n");for(t=0;t<S;t++){if(s=this._mainTexture,o=this._path+E[2*t],x=E[2*t+1],null==this._mainTexture&&(s=this._textureDic[o]),!s)return this.event("error",this),void(this.isParseFail=!0);c=l.getFloat32(),u=l.getFloat32(),_=l.getFloat32(),d=l.getFloat32(),v=l.getFloat32(),f=isNaN(v)?0:v,v=l.getFloat32(),p=isNaN(v)?0:v,v=l.getFloat32(),g=isNaN(v)?_:v,v=l.getFloat32(),y=isNaN(v)?d:v,this.subTextureDic[x]=T.create(s,c,u,_,d,-f,-p,g,y)}this._mainTexture=s;var w,C=l.getUint16();for(t=0;t<C;t++)(w=[]).push(l.getUint16()),w.push(l.getUint16()),w.push(l.getUint16()),w.push(l.getUint16()),this.aniSectionDic[t]=w;var b,M,I,D,L,P=l.getInt16(),B={};for(t=0;t<P;t++)b=new A,0==t?L=b:b.root=L,b.d=a?-1:1,I=l.readUTFString(),D=l.readUTFString(),b.length=l.getFloat32(),1==l.getByte()&&(b.inheritRotation=!1),1==l.getByte()&&(b.inheritScale=!1),b.name=I,D&&((M=B[D])?M.addChild(b):this.mRootBone=b),B[I]=b,this.mBoneArr.push(b);this.tMatrixDataLen=l.getUint16();var H,G=l.getUint16(),j=Math.floor(G/this.tMatrixDataLen),Z=this.srcBoneMatrixArr;for(t=0;t<j;t++)(H=new q).scX=l.getFloat32(),H.skX=l.getFloat32(),H.skY=l.getFloat32(),H.scY=l.getFloat32(),H.x=l.getFloat32(),H.y=l.getFloat32(),8===this.tMatrixDataLen&&(H.skewX=l.getFloat32(),H.skewY=l.getFloat32()),Z.push(H),(b=this.mBoneArr[t]).transform=H;var Q,$=l.getUint16(),J=0;for(t=0;t<$;t++){for(Q=new U,J=l.getUint16(),e=0;e<J;e++)Q.boneNames.push(l.readUTFString()),Q.boneIndexs.push(l.getInt16());Q.name=l.readUTFString(),Q.targetBoneName=l.readUTFString(),Q.targetBoneIndex=l.getInt16(),Q.bendDirection=l.getFloat32(),Q.mix=l.getFloat32(),Q.isSpine=a,this.ikArr.push(Q)}var tt,et=l.getUint16(),it=0;for(t=0;t<et;t++){for(tt=new K,it=l.getUint16(),e=0;e<it;e++)tt.boneIndexs.push(l.getInt16());tt.name=l.getUTFString(),tt.targetIndex=l.getInt16(),tt.rotateMix=l.getFloat32(),tt.translateMix=l.getFloat32(),tt.scaleMix=l.getFloat32(),tt.shearMix=l.getFloat32(),tt.offsetRotation=l.getFloat32(),tt.offsetX=l.getFloat32(),tt.offsetY=l.getFloat32(),tt.offsetScaleX=l.getFloat32(),tt.offsetScaleY=l.getFloat32(),tt.offsetShearY=l.getFloat32(),this.tfArr.push(tt)}var nt,rt=l.getUint16(),at=0;for(t=0;t<rt;t++){for((nt=new W).name=l.readUTFString(),at=l.getUint16(),e=0;e<at;e++)nt.bones.push(l.getInt16());nt.target=l.readUTFString(),nt.positionMode=l.readUTFString(),nt.spacingMode=l.readUTFString(),nt.rotateMode=l.readUTFString(),nt.offsetRotation=l.getFloat32(),nt.position=l.getFloat32(),nt.spacing=l.getFloat32(),nt.rotateMix=l.getFloat32(),nt.translateMix=l.getFloat32(),this.pathArr.push(nt)}var st,ot,lt,ht,ct=0,ut=0,_t=0,dt=NaN,ft=0,pt=l.getInt16();for(t=0;t<pt;t++){var mt=l.getUint8(),gt={};this.deformAniArr.push(gt);for(var yt=0;yt<mt;yt++)for((st=new N).skinName=l.getUTFString(),gt[st.skinName]=st,ct=l.getInt16(),e=0;e<ct;e++)for(ot=new O,st.deformSlotDataList.push(ot),ut=l.getInt16(),i=0;i<ut;i++)for(lt=new V,ot.deformSlotDisplayList.push(lt),lt.slotIndex=l.getInt16(),lt.attachment=l.getUTFString(),_t=l.getInt16(),n=0;n<_t;n++)for(1==l.getByte()?lt.tweenKeyList.push(!0):lt.tweenKeyList.push(!1),dt=l.getFloat32(),lt.timeList.push(dt),ht=[],lt.vectices.push(ht),ft=l.getInt16(),r=0;r<ft;r++)ht.push(l.getFloat32())}var vt,St,xt=l.getInt16(),Et=0,Tt=0;for(t=0;t<xt;t++){for(Et=l.getInt16(),vt=[],e=0;e<Et;e++){for((St=new k).time=l.getFloat32(),Tt=l.getInt16(),i=0;i<Tt;i++)St.drawOrder.push(l.getInt16());vt.push(St)}this.drawOrderAniArr.push(vt)}var wt,Ct,bt=l.getInt16(),Mt=0;for(t=0;t<bt;t++){for(Mt=l.getInt16(),wt=[],e=0;e<Mt;e++)(Ct=new F).name=l.getUTFString(),Ct.intValue=l.getInt32(),Ct.floatValue=l.getFloat32(),Ct.stringValue=l.getUTFString(),Ct.time=l.getFloat32(),wt.push(Ct);this.eventAniArr.push(wt)}var It=l.getInt16();if(It>0)for(this.attachmentNames=[],t=0;t<It;t++)this.attachmentNames.push(l.getUTFString());var Dt,At,Rt=l.getInt16();for(t=0;t<Rt;t++)(Dt=new R).name=l.readUTFString(),Dt.parent=l.readUTFString(),Dt.attachmentName=l.readUTFString(),Dt.srcDisplayIndex=Dt.displayIndex=l.getInt16(),Dt.templet=this,this.boneSlotDic[Dt.name]=Dt,null==(At=this.bindBoneBoneSlotDic[Dt.parent])&&(this.bindBoneBoneSlotDic[Dt.parent]=At=[]),At.push(Dt),this.boneSlotArray.push(Dt);var Lt,Pt,Nt,Ot=l.readUTFString().split("\n"),Vt=0,kt=l.getUint8(),Ft=0,Bt=0,Ut=0,Ht=0,Gt=0,Wt=0,zt=0;for(t=0;t<kt;t++){for((Lt=new z).name=Ot[Vt++],Ft=l.getUint8(),e=0;e<Ft;e++){for((Pt=new X).name=Ot[Vt++],Dt=this.boneSlotDic[Pt.name],Bt=l.getUint8(),i=0;i<Bt;i++){if(Nt=new Y,this.skinSlotDisplayDataArr.push(Nt),Nt.name=Ot[Vt++],Nt.attachmentName=Ot[Vt++],Nt.transform=new q,Nt.transform.scX=l.getFloat32(),Nt.transform.skX=l.getFloat32(),Nt.transform.skY=l.getFloat32(),Nt.transform.scY=l.getFloat32(),Nt.transform.x=l.getFloat32(),Nt.transform.y=l.getFloat32(),Pt.displayArr.push(Nt),Nt.width=l.getFloat32(),Nt.height=l.getFloat32(),Nt.type=l.getUint8(),Nt.verLen=l.getUint16(),(P=l.getUint16())>0)for(Nt.bones=[],n=0;n<P;n++){var Yt=l.getUint16();Nt.bones.push(Yt)}if((Ut=l.getUint16())>0)for(Nt.uvs=[],n=0;n<Ut;n++)Nt.uvs.push(l.getFloat32());if((Ht=l.getUint16())>0)for(Nt.weights=[],n=0;n<Ht;n++)Nt.weights.push(l.getFloat32());if((Gt=l.getUint16())>0)for(Nt.triangles=[],n=0;n<Gt;n++)Nt.triangles.push(l.getUint16());if((Wt=l.getUint16())>0)for(Nt.vertices=[],n=0;n<Wt;n++)Nt.vertices.push(l.getFloat32());if((zt=l.getUint16())>0)for(Nt.lengths=[],n=0;n<zt;n++)Nt.lengths.push(l.getFloat32())}Lt.slotArr.push(Pt)}this.skinDic[Lt.name]=Lt,this.skinDataArray.push(Lt)}1==l.getUint8()?(this.yReverseMatrix=new m(1,0,0,-1,0,0),L&&L.setTempMatrix(this.yReverseMatrix)):L&&L.setTempMatrix(new m),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},n.getTexture=function(t){var e=this.subTextureDic[t];return e||(e=this.subTextureDic[t.substr(0,t.length-1)]),null==e?this._mainTexture:e},n.showSkinByIndex=function(t,e,i){if(void 0===i&&(i=!0),e<0&&e>=this.skinDataArray.length)return!1;var n,r,a=0,s=0,o=this.skinDataArray[e];if(o){for(a=0,s=o.slotArr.length;a<s;a++)(r=o.slotArr[a])&&(n=t[r.name])&&(n.showSlotData(r,i),i&&"undefined"!=n.attachmentName&&"null"!=n.attachmentName?n.showDisplayByName(n.attachmentName):n.showDisplayByIndex(n.displayIndex));return!0}return!1},n.getSkinIndexByName=function(t){for(var e=0,i=this.skinDataArray.length;e<i;e++)if(this.skinDataArray[e].name==t)return e;return-1},n.getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},n.setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},n.destroy=function(){var t;for(var i in this._isDestroyed=!0,this.subTextureDic)(t=this.subTextureDic[i])&&t.destroy();for(i in this._textureDic)(t=this._textureDic[i])&&t.destroy();for(var n=0,r=this.skinSlotDisplayDataArr.length;n<r;n++)this.skinSlotDisplayDataArr[n].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete e.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},n.getAniNameByIndex=function(t){var e=this.getAnimation(t);return e?e.name:null},a(0,n,"rate",function(){return this._rate},function(t){this._rate=t}),e.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",e.TEMPLET_DICTIONARY=null,e}(it))}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns,i.static;var n=i.class,r=i.getset,a=(i.__newvec,laya.utils.Browser,laya.utils.Color),s=laya.filters.ColorFilterAction,o=laya.filters.webgl.ColorFilterActionGL,l=laya.filters.Filter,h=laya.filters.webgl.FilterActionGL,c=laya.maths.Matrix,u=(laya.maths.Rectangle,laya.renders.Render),_=(laya.renders.RenderContext,laya.webgl.resource.RenderTarget2D),d=laya.utils.RunDriver,f=(laya.webgl.shader.d2.ShaderDefines2D,laya.display.Sprite,laya.resource.Texture,laya.webgl.shader.d2.value.Value2D),p=function(){function t(){this.data=null}n(t,"laya.filters.FilterAction");var e=t.prototype;return i.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){return null},t}(),m=function(){function t(){}return n(t,"laya.filters.WebGLFilter"),t.enable=function(){t.isInit||(t.isInit=!0,u.isWebGL&&(d.createFilterAction=function(t){var e;switch(t){case 32:e=new o;break;case 16:e=new g;break;case 8:e=new y}return e}))},t.isInit=!1,t.__init$=function(){d.createFilterAction=function(t){var e;switch(t){case 16:case 8:e=new p;break;case 32:e=new s}return e}},t}(),g=(function(t){function e(t){this.strength=NaN,this.strength_sig2_2sig2_gauss1=[],e.__super.call(this),void 0===t&&(t=4),u.isWebGL&&m.enable(),this.strength=t,this._action=d.createFilterAction(16),this._action.data=this}n(e,"laya.filters.BlurFilter",l);var i=e.prototype;i.callNative=function(t){t.conchModel&&t.conchModel.blurFilter&&t.conchModel.blurFilter(this.strength)},r(0,i,"action",function(){return this._action}),r(0,i,"type",function(){return 16})}(),function(t){function e(t,i,n,r){this._color=null,e.__super.call(this),this._elements=new Float32Array(9),void 0===i&&(i=4),void 0===n&&(n=6),void 0===r&&(r=6),u.isWebGL&&m.enable(),this._color=new a(t),this.blur=Math.min(i,20),this.offX=n,this.offY=r,this._action=d.createFilterAction(8),this._action.data=this}n(e,"laya.filters.GlowFilter",l);var i=e.prototype;i.getColor=function(){return this._color._color},i.callNative=function(t){t.conchModel&&t.conchModel.glowFilter&&t.conchModel.glowFilter(this._color.strColor,this._elements[4],this._elements[5],this._elements[6])},r(0,i,"type",function(){return 8}),r(0,i,"action",function(){return this._action}),r(0,i,"offY",function(){return this._elements[6]},function(t){this._elements[6]=t}),r(0,i,"offX",function(){return this._elements[5]},function(t){this._elements[5]=t}),r(0,i,"blur",function(){return this._elements[4]},function(t){this._elements[4]=t})}(),function(t){function e(){this.data=null,e.__super.call(this)}n(e,"laya.filters.webgl.BlurFilterActionGL",h);var i=e.prototype;return i.setValueMix=function(t){t.defines.add(this.data.type)},i.apply3d=function(t,e,i,n,r){var a=t.getValue("bounds"),s=f.create(1,0);s.setFilters([this.data]),c.EMPTY.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,c.EMPTY,"src",s),s.setFilters(null)},i.setValue=function(t){t.strength=this.data.strength;var e=this.data.strength/3,i=e*e;this.data.strength_sig2_2sig2_gauss1[0]=this.data.strength,this.data.strength_sig2_2sig2_gauss1[1]=i,this.data.strength_sig2_2sig2_gauss1[2]=2*i,this.data.strength_sig2_2sig2_gauss1[3]=1/(2*Math.PI*i),t.strength_sig2_2sig2_gauss1=this.data.strength_sig2_2sig2_gauss1},r(0,i,"typeMix",function(){return 16}),e}()),y=function(t){function e(){this.data=null,this._initKey=!1,this._textureWidth=0,this._textureHeight=0,e.__super.call(this)}n(e,"laya.filters.webgl.GlowFilterActionGL",h);var a=e.prototype;return i.imps(a,{"laya.filters.IFilterActionGL":!0}),a.setValueMix=function(t){},a.apply3d=function(t,e,i,n,r){var a=t.getValue("bounds");t.addValue("color",this.data.getColor());var s=a.width,o=a.height;this._textureWidth=s,this._textureHeight=o;var l,h=c.TEMP;return h.identity(),(l=f.create(1,0)).setFilters([this.data]),i.ctx.drawTarget(t,0,0,this._textureWidth,this._textureHeight,h,"src",l,null),l=f.create(1,0),i.ctx.drawTarget(t,0,0,this._textureWidth,this._textureHeight,h,"src",l),null},a.setSpriteWH=function(t){this._textureWidth=t.width,this._textureHeight=t.height},a.setValue=function(t){t.u_offsetX=this.data.offX,t.u_offsetY=-this.data.offY,t.u_strength=1,t.u_blurX=this.data.blur,t.u_blurY=this.data.blur,t.u_textW=this._textureWidth,t.u_textH=this._textureHeight,t.u_color=this.data.getColor()},r(0,a,"typeMix",function(){return 8}),e.tmpTarget=function(t,e,i,n,r){var a=t.getValue("bounds");t.getValue("out").end();var s=_.create(a.width,a.height);s.start();var o=t.getValue("color");o&&s.clear(o[0],o[1],o[2],0),t.addValue("tmpTarget",s)},e.startOut=function(t,e,i,n,r){t.getValue("tmpTarget").end();var a=t.getValue("out");a.start();var s=t.getValue("color");s&&a.clear(s[0],s[1],s[2],0)},e.recycleTarget=function(t,e,i,n,r){t.getValue("src"),t.getValue("tmpTarget").recycle()},e}();i.__init([m])}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,a=i.getset,s=(i.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),o=laya.utils.ClassUtils,l=(laya.events.Event,laya.utils.HTMLChar),h=laya.net.Loader,c=(laya.display.Node,laya.maths.Rectangle),u=laya.renders.Render,_=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),d=laya.utils.Stat,f=laya.display.Text,p=laya.resource.Texture,m=laya.net.URL,g=laya.utils.Utils,y=function(){function t(){}return r(t,"laya.html.utils.HTMLParse"),t.parse=function(e,i,n){i=(i="<root>"+(i=i.replace(/<br>/g,"<br/>"))+"</root>").replace(t.spacePattern,t.char255);var r=g.parseXMLFromString(i);t._parseXML(e,r.childNodes[0].childNodes,n)},t._parseXML=function(e,i,n,r){var a=0,s=0;if(i.join||i.item)for(a=0,s=i.length;a<s;++a)t._parseXML(e,i[a],n,r);else{var l,h,c;if(3==i.nodeType)return void(e instanceof laya.html.dom.HTMLDivElement?(null==i.nodeName&&(i.nodeName="#text"),h=i.nodeName.toLowerCase(),(c=i.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(l=o.getInstance(h))&&(e.addChild(l),l.innerTEXT=c.replace(t.char255AndOneSpacePattern," "))):(c=i.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(e.innerTEXT=c.replace(t.char255AndOneSpacePattern," ")));if("#comment"==(h=i.nodeName.toLowerCase()))return;if(l=o.getInstance(h)){(l=e.addChild(l)).URI=n,l.href=r;var u=i.attributes;if(u&&u.length>0)for(a=0,s=u.length;a<s;++a){var _=u[a],d=_.nodeName,f=_.value;l._setAttributes(d,f)}t._parseXML(l,i.childNodes,n,l.href)}else t._parseXML(e,i.childNodes,n,r)}},t.char255=String.fromCharCode(255),t.spacePattern=/&nbsp;|&#160;/g,t.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),t}(),v=function(){function t(){}return r(t,"laya.html.utils.Layout"),t.later=function(e){null==t._will&&(t._will=[],i.stage.frameLoop(1,null,function(){if(!(t._will.length<1)){for(var e=0;e<t._will.length;e++)laya.html.utils.Layout.layout(t._will[e]);t._will.length=0}})),t._will.push(e)},t.layout=function(e){if(!e||!e._style)return null;if(0==(512&e._style._type))return null;e.getStyle()._type&=-513;var i=t._multiLineLayout(e);return u.isConchApp&&e.layaoutCallNative&&e.layaoutCallNative(),i},t._multiLineLayout=function(e){function i(){D.y=C,C+=D.h+d,0==D.h&&(C+=p),D.mWidth=L,L=0,D=new S,I.push(D),D.h=0,w=0,P=!0,A=!1}if(f.RightToLeft)return t._multiLineLayout2(e);var n=new Array;e._addChildsToLayout(n);var r,a,s,o,l,h=0,c=n.length,u=e._getCSSStyle(),_=u.letterSpacing,d=u.leading,p=u.lineHeight,m=u._widthAuto()||!u.wordWrap,g=m?999999:e.width,y=(e.height,0),v=u.italic?u.fontSize/3:0,x=u._getAlign(),E=u._getValign(),T=0!==E||0!==x||0!=p,w=0,C=0,b=0,M=0,I=new Array,D=I[0]=new S,A=!1,R=!1;D.h=0,u.italic&&(g-=u.fontSize/3);var L=0,P=!0;for(h=0;h<c;h++)if(null!=(r=n[h]))if(P=!1,r instanceof laya.html.dom.HTMLBrElement)i(),D.y=C;else{if(r._isChar()){if((o=r).isWord)A=R||"\n"===o.char,D.wordStartIndex=D.elements.length;else{if(I.length>0&&w+b>g&&D.wordStartIndex>0){var N;N=D.elements.length-D.wordStartIndex+1,D.elements.length=D.wordStartIndex,h-=N,i();continue}A=!1,L+=o.width}b=o.width+_,M=o.height,R=!1,(A=A||w+b>g)&&i(),D.minTextHeight=Math.min(D.minTextHeight,r.height)}else l=r,s=(a=r._getCSSStyle()).padding,0===a._getCssFloat()||(T=!0),A=R||a.lineElement,b=l.width*l._style._tf.scaleX+s[1]+s[3]+_,M=l.height*l._style._tf.scaleY+s[0]+s[2],R=a.lineElement,(A=A||w+b>g&&a.wordWrap)&&i();D.elements.push(r),D.h=Math.max(D.h,M),r.x=w,r.y=C,w+=b,D.w=w-_,D.y=C,y=Math.max(w+v,y)}else P||(w+=t.DIV_ELEMENT_PADDING),D.wordStartIndex=D.elements.length;if(C=D.y+D.h,T){var O=0,V=g;for(m&&e.width>0&&(V=e.width),h=0,c=I.length;h<c;h++)I[h].updatePos(0,V,h,O,x,E,p),O+=Math.max(p,I[h].h+d);C=O}return m&&(e.width=y),C>e.height&&(e.height=C),[y,C]},t._multiLineLayout2=function(e){function i(){I.y=w,w+=I.h+d,0==I.h&&(w+=f),I.mWidth=R,R=0,I=new S,M.push(I),I.h=0,T=0,L=!0,D=!1}var n=new Array;e._addChildsToLayout(n);var r,a,s,o,l,h=0,c=n.length,u=e._getCSSStyle(),_=u.letterSpacing,d=u.leading,f=u.lineHeight,p=u._widthAuto()||!u.wordWrap,m=p?999999:e.width,g=(e.height,0),y=u.italic?u.fontSize/3:0,v=2-u._getAlign(),x=u._getValign(),E=0!==x||0!==v||0!=f,T=0,w=0,C=0,b=0,M=new Array,I=M[0]=new S,D=!1,A=!1;I.h=0,u.italic&&(m-=u.fontSize/3);var R=0,L=!0;for(h=0;h<c;h++)if(null!=(r=n[h]))if(L=!1,r instanceof laya.html.dom.HTMLBrElement)i(),I.y=w;else{if(r._isChar()){if((o=r).isWord)D=A||"\n"===o.char,I.wordStartIndex=I.elements.length;else{if(M.length>0&&T+C>m&&I.wordStartIndex>0){var P;P=I.elements.length-I.wordStartIndex+1,I.elements.length=I.wordStartIndex,h-=P,i();continue}D=!1,R+=o.width}C=o.width+_,b=o.height,A=!1,(D=D||T+C>m)&&i(),I.minTextHeight=Math.min(I.minTextHeight,r.height)}else l=r,s=(a=r._getCSSStyle()).padding,0===a._getCssFloat()||(E=!0),D=A||a.lineElement,C=l.width*l._style._tf.scaleX+s[1]+s[3]+_,b=l.height*l._style._tf.scaleY+s[0]+s[2],A=a.lineElement,(D=D||T+C>m&&a.wordWrap)&&i();I.elements.push(r),I.h=Math.max(I.h,b),r.x=T,r.y=w,T+=C,I.w=T-_,I.y=w,g=Math.max(T+y,g)}else L||(T+=t.DIV_ELEMENT_PADDING),I.wordStartIndex=I.elements.length;if(w=I.y+I.h,E){var N=0,O=m;for(h=0,c=M.length;h<c;h++)M[h].updatePos(0,O,h,N,v,x,f),N+=Math.max(f,M[h].h+d);w=N}for(p&&(e.width=g),w>e.height&&(e.height=w),h=0,c=M.length;h<c;h++)M[h].revertOrder(m);return[g,w]},t._will=null,t.DIV_ELEMENT_PADDING=0,t}(),S=function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}r(t,"laya.html.utils.LayoutLine");var e=t.prototype;return e.updatePos=function(t,e,i,n,r,a,s){var o,l=0;this.elements.length>0&&(l=(o=this.elements[this.elements.length-1]).x+o.width-this.elements[0].x);var h=0,c=NaN;1===r&&(h=(e-l)/2),2===r&&(h=e-l),0===s||0!=a||(a=1);for(var u=0,_=this.elements.length;u<_;u++){var d=(o=this.elements[u])._getCSSStyle();switch(0!==h&&(o.x+=h),d._getValign()){case 0:o.y=n;break;case 1:var f=0;99999!=this.minTextHeight&&(f=this.minTextHeight);var p=(f+s)/2;p=Math.max(p,this.h),laya.html.dom.HTMLImageElement,c=n+p-o.height,o.y=c;break;case 2:o.y=n+(s-o.height)}}},e.revertOrder=function(t){var e;if(this.elements.length>0){var i,n=0;for(i=this.elements.length,n=0;n<i;n++)(e=this.elements[n]).x=t-e.x-e.width}},t}(),x=function(t){function e(){this.URI=null,this._href=null,e.__super.call(this),this._text=e._EMPTYTEXT,this.setStyle(new s(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}r(e,"laya.html.dom.HTMLElement",t);var n=e.prototype;return n.layaoutCallNative=function(){var t=0;if(this._childs&&(t=this._childs.length)>0)for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative();var i=this._getWords();i?laya.html.dom.HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},n.appendChild=function(t){return this.addChild(t)},n._getWords2=function(){var t=this._text.text;if(!t||0===t.length)return null;var e,i,n=0,r=0;if(this._text.drawWords)i=this._text.drawWords;else{for(r=(e=t.split(" ")).length-1,i=[],n=0;n<r;n++)i.push(e[n]," ");r>=0&&i.push(e[r]),this._text.drawWords=i}var a=this._text.words;if(a&&a.length===i.length)return a;null===a&&(this._text.words=a=[]),a.length=i.length;var s,o=this.style,h=o.font;for(n=0,r=i.length;n<r;n++){s=g.measureText(i[n],h);var c=a[n]=new l(i[n],s.width,s.height||o.fontSize,o);if(c.char.length>1&&(c.charNum=c.char),this.href){var u=new _;this.addChild(u),c.setSprite(u)}}return a},n._getWords=function(){if(!f.CharacterCache)return this._getWords2();var t=this._text.text;if(!t||0===t.length)return null;var e=this._text.words;if(e&&e.length===t.length)return e;null===e&&(this._text.words=e=[]),e.length=t.length;for(var i,n=this.style,r=n.font,a=0,s=t.length;a<s;a++){i=g.measureText(t.charAt(a),r);var o=e[a]=new l(t.charAt(a),i.width,i.height||n.fontSize,n);if(this.href){var h=new _;this.addChild(h),o.setSprite(h)}}return e},n.showLinkSprite=function(){var t=this._text.words;if(t)for(var e,i,n=[],r=0;r<t.length;r++)i=t[r],(e=new _).graphics.drawRect(0,0,i.width,i.height,"#ff0000"),e.width=i.width,e.height=i.height,this.addChild(e),n.push(e)},n._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(this._childs.length>0||null!=this._getWords())&&t.block?(v.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},n._setAttributes=function(e,i){switch(e){case"style":return void this.style.cssText(i);case"class":return void(this.className=i)}t.prototype._setAttributes.call(this,e,i)},n.updateHref=function(){if(null!=this._href){var t=this._getWords();if(t)for(var e,i,n=0;n<t.length;n++)(i=(e=t[n]).getSprite())&&(i.size(e.width,e.height),i.on("click",this,this.onLinkHandler))}},n.onLinkHandler=function(t){switch(t.type){case"click":for(var e=this;e;)e.event("link",[this.href]),e=e.parent}},n.formatURL=function(t){return this.URI?m.formatURL(t,this.URI?this.URI.path:null):t},a(0,n,"href",function(){return this._href},function(t){this._href=t,null!=t&&(this._getCSSStyle().underLine=1,this.updateHref())}),a(0,n,"color",null,function(t){this.style.color=t}),a(0,n,"onClick",null,function(t){i._runScript("fn=function(event){"+t+";}"),this.on("click",this,void 0)}),a(0,n,"id",null,function(t){T.document.setElementById(t,this)}),a(0,n,"innerTEXT",function(){return this._text.text},function(t){this.text=t}),a(0,n,"style",function(){return this._style}),a(0,n,"text",function(){return this._text.text},function(t){this._text==e._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),u.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),a(0,n,"parent",t.prototype._$get_parent,function(t){if(t instanceof laya.html.dom.HTMLElement){var e=t;this.URI||(this.URI=e.URI),this.style.inherit(e.style)}i.superSet(_,this,"parent",t)}),a(0,n,"className",null,function(t){this.style.attrs(T.document.styleSheets["."+t])}),e.fillWords=function(t,e,i,n,r,a,s){t.graphics.clear();for(var o=0,l=e.length;o<l;o++){var h=e[o];t.graphics.fillText(h.char,h.x+i,h.y+n,r,a,"left",s)}},e._EMPTYTEXT={text:null,words:null},e}(_),E=(function(t){r(function t(){t.__super.call(this),this.style.lineElement=!0,this.style.block=!0},"laya.html.dom.HTMLBrElement",x)}(),function(t){function e(){this.contextHeight=NaN,this.contextWidth=NaN,e.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}r(e,"laya.html.dom.HTMLDivElement",t);var n=e.prototype;return n.appendHTML=function(t){y.parse(this,t,this.URI),this.layout()},n._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;e&&e.forEach(function(e){t.push(e)});for(var i=!0,n=0,r=this._childs.length;n<r;n++){var a=this._childs[n];i?i=!1:t.push(null),a._addToLayout(t)}return!0},n._addToLayout=function(t){this.layout()},n.layout=function(){if(this.style){this.style._type|=512;var t=v.layout(this);if(t){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new c);var e=this._$P.mHtmlBounds;e.x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1],this.setBounds(e)}}},a(0,n,"height",function(){return this._height?this._height:this.contextHeight},t.prototype._$set_height),a(0,n,"innerHTML",null,function(t){this.destroyChildren(),this.appendHTML(t)}),a(0,n,"width",function(){return this._width?this._width:this.contextWidth},function(t){var e;e=0===t?t!=this._width:t!=this.width,i.superSet(x,this,"width",t),e&&this.layout()}),e}(x)),T=function(t){function e(){this.all=new Array,this.styleSheets=s.styleSheets,e.__super.call(this)}r(e,"laya.html.dom.HTMLDocument",x);var i=e.prototype;return i.getElementById=function(t){return this.all[t]},i.setElementById=function(t,e){this.all[t]=e},n(e,["document",function(){return this.document=new e}]),e}();(function(t){function e(){this._tex=null,this._url=null,this._renderArgs=[],e.__super.call(this),this.style.block=!0}r(e,"laya.html.dom.HTMLImageElement",x);var i=e.prototype;i._addToLayout=function(t){!this._style.absolute&&t.push(this)},i.render=function(t,e,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(d.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,t.ctx.drawTexture2(e,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},i.layaoutCallNative=function(){var t=0;if(this._childs&&(t=this._childs.length)>0)for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative()},a(0,i,"src",null,function(t){function e(){var t=i._style;t.widthed(i)||i._tex.width,t.heighted(i)||i._tex.height,t.widthed(i)||i._width==i._tex.width||(i.width=i._tex.width,i.parent&&i.parent._layoutLater()),t.heighted(i)||i._height==i._tex.height||(i.height=i._tex.height,i.parent&&i.parent._layoutLater()),u.isConchApp&&(i._renderArgs[0]=i._tex,i._renderArgs[1]=i.x,i._renderArgs[2]=i.y,i._renderArgs[3]=i.width||i._tex.width,i._renderArgs[4]=i.height||i._tex.height,i.graphics.drawTexture(i._tex,0,0,i._renderArgs[3],i._renderArgs[4])),i.repaint(),i.parentRepaint()}var i=this;if(t=this.formatURL(t),this._url!=t){this._url=t;var n=this._tex=h.getRes(t);n||(this._tex=n=new p,n.load(t),h.cacheRes(t,n)),n.loaded?e():n.on("loaded",null,e)}})})(),function(t){function e(){this.type=null,e.__super.call(this),this.visible=!1}r(e,"laya.html.dom.HTMLLinkElement",t);var i=e.prototype;i._onload=function(t){switch(this.type){case"text/css":s.parseCSS(t,this.URI)}},a(0,i,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t),this.URI=new m(t);var i=new h;i.once("complete",null,function(t){e._onload(t)}),i.load(t,"text")}),e._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(x),function(t){function e(){e.__super.call(this),this.visible=!1}r(e,"laya.html.dom.HTMLStyleElement",t),a(0,e.prototype,"text",t.prototype._$get_text,function(t){s.parseCSS(t,null)})}(x),function(t){function e(){e.__super.call(this),this._getCSSStyle().valign="middle"}r(e,"laya.html.dom.HTMLIframeElement",t),a(0,e.prototype,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t);var i=new h;i.once("complete",null,function(i){var n=e.URI;e.URI=new m(t),e.innerHTML=i,!n||(e.URI=n)}),i.load(t,"text")})}(E)}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,a=i.getset,s=(i.__newvec,laya.webgl.canvas.BlendMode),o=(laya.events.Event,laya.resource.HTMLCanvas),l=laya.utils.Handler,h=laya.webgl.utils.IndexBuffer2D,c=(laya.net.Loader,laya.maths.MathUtil),u=laya.maths.Matrix,_=laya.renders.Render,d=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.shader.Shader),f=laya.display.Sprite,p=laya.utils.Stat,m=laya.resource.Texture,g=laya.utils.Utils,y=laya.webgl.shader.d2.value.Value2D,v=laya.webgl.utils.VertexBuffer2D,S=laya.webgl.WebGL,x=(laya.webgl.WebGLContext,function(){function t(){this._frameTime=0,this._emissionRate=60,this._emissionTime=0,this.minEmissionTime=1/60,this._particleTemplate=null}r(t,"laya.particle.emitter.EmitterBase");var e=t.prototype;return e.start=function(t){void 0===t&&(t=2147483647),0!=this._emissionRate&&(this._emissionTime=t)},e.stop=function(){this._emissionTime=0},e.clear=function(){this._emissionTime=0},e.emit=function(){},e.advanceTime=function(t){if(void 0===t&&(t=1),this._emissionTime-=t,!(this._emissionTime<0||(this._frameTime+=t,this._frameTime<this.minEmissionTime)))for(;this._frameTime>this.minEmissionTime;)this._frameTime-=this.minEmissionTime,this.emit()},a(0,e,"particleTemplate",null,function(t){this._particleTemplate=t}),a(0,e,"emissionRate",function(){return this._emissionRate},function(t){t<=0||(this._emissionRate=t,t>0&&(this.minEmissionTime=1/t))}),t}()),E=function(){function t(){this.position=null,this.velocity=null,this.startColor=null,this.endColor=null,this.sizeRotation=null,this.radius=null,this.radian=null,this.durationAddScale=NaN,this.time=NaN}return r(t,"laya.particle.ParticleData"),t.Create=function(e,i,n,r){var a=new t;a.position=i,c.scaleVector3(n,e.emitterVelocitySensitivity,t._tempVelocity);var s=c.lerp(e.minHorizontalVelocity,e.maxHorizontalVelocity,Math.random()),o=Math.random()*Math.PI*2;t._tempVelocity[0]+=s*Math.cos(o),t._tempVelocity[2]+=s*Math.sin(o),t._tempVelocity[1]+=c.lerp(e.minVerticalVelocity,e.maxVerticalVelocity,Math.random()),a.velocity=t._tempVelocity,a.startColor=t._tempStartColor,a.endColor=t._tempEndColor;var l=0;if(e.disableColor)for(l=0;l<4;l++)a.startColor[l]=1,a.endColor[l]=1;else if(e.colorComponentInter)for(l=0;l<4;l++)a.startColor[l]=c.lerp(e.minStartColor[l],e.maxStartColor[l],Math.random()),a.endColor[l]=c.lerp(e.minEndColor[l],e.maxEndColor[l],Math.random());else c.lerpVector4(e.minStartColor,e.maxStartColor,Math.random(),a.startColor),c.lerpVector4(e.minEndColor,e.maxEndColor,Math.random(),a.endColor);a.sizeRotation=t._tempSizeRotation;var h=Math.random();a.sizeRotation[0]=c.lerp(e.minStartSize,e.maxStartSize,h),a.sizeRotation[1]=c.lerp(e.minEndSize,e.maxEndSize,h),a.sizeRotation[2]=c.lerp(e.minRotateSpeed,e.maxRotateSpeed,Math.random()),a.radius=t._tempRadius;var u=Math.random();a.radius[0]=c.lerp(e.minStartRadius,e.maxStartRadius,u),a.radius[1]=c.lerp(e.minEndRadius,e.maxEndRadius,u),a.radian=t._tempRadian,a.radian[0]=c.lerp(e.minHorizontalStartRadian,e.maxHorizontalStartRadian,Math.random()),a.radian[1]=c.lerp(e.minVerticalStartRadian,e.maxVerticalStartRadian,Math.random());var _=e.useEndRadian;return a.radian[2]=_?c.lerp(e.minHorizontalEndRadian,e.maxHorizontalEndRadian,Math.random()):a.radian[0],a.radian[3]=_?c.lerp(e.minVerticalEndRadian,e.maxVerticalEndRadian,Math.random()):a.radian[1],a.durationAddScale=e.ageAddScale*Math.random(),a.time=r,a},n(t,["_tempVelocity",function(){return this._tempVelocity=new Float32Array(3)},"_tempStartColor",function(){return this._tempStartColor=new Float32Array(4)},"_tempEndColor",function(){return this._tempEndColor=new Float32Array(4)},"_tempSizeRotation",function(){return this._tempSizeRotation=new Float32Array(3)},"_tempRadius",function(){return this._tempRadius=new Float32Array(2)},"_tempRadian",function(){return this._tempRadian=new Float32Array(4)}]),t}(),T=(function(){function t(t,e,i){this._templet=null,this._timeBetweenParticles=NaN,this._previousPosition=null,this._timeLeftOver=0,this._tempVelocity=new Float32Array([0,0,0]),this._tempPosition=new Float32Array([0,0,0]),this._templet=t,this._timeBetweenParticles=1/e,this._previousPosition=i}r(t,"laya.particle.ParticleEmitter"),t.prototype.update=function(t,e){if((t/=1e3)>0){c.subtractVector3(e,this._previousPosition,this._tempVelocity),c.scaleVector3(this._tempVelocity,1/t,this._tempVelocity);for(var i=this._timeLeftOver+t,n=-this._timeLeftOver;i>this._timeBetweenParticles;)n+=this._timeBetweenParticles,i-=this._timeBetweenParticles,c.lerpVector3(this._previousPosition,e,n/t,this._tempPosition),this._templet.addParticleArray(this._tempPosition,this._tempVelocity);this._timeLeftOver=i}this._previousPosition[0]=e[0],this._previousPosition[1]=e[1],this._previousPosition[2]=e[2]}}(),function(){function t(){this.textureName=null,this.textureCount=1,this.maxPartices=100,this.duration=1,this.ageAddScale=0,this.emitterVelocitySensitivity=1,this.minStartSize=100,this.maxStartSize=100,this.minEndSize=100,this.maxEndSize=100,this.minHorizontalVelocity=0,this.maxHorizontalVelocity=0,this.minVerticalVelocity=0,this.maxVerticalVelocity=0,this.endVelocity=1,this.minRotateSpeed=0,this.maxRotateSpeed=0,this.minStartRadius=0,this.maxStartRadius=0,this.minEndRadius=0,this.maxEndRadius=0,this.minHorizontalStartRadian=0,this.maxHorizontalStartRadian=0,this.minVerticalStartRadian=0,this.maxVerticalStartRadian=0,this.useEndRadian=!0,this.minHorizontalEndRadian=0,this.maxHorizontalEndRadian=0,this.minVerticalEndRadian=0,this.maxVerticalEndRadian=0,this.colorComponentInter=!1,this.disableColor=!1,this.blendState=0,this.emitterType="null",this.emissionRate=0,this.sphereEmitterRadius=1,this.sphereEmitterVelocity=0,this.sphereEmitterVelocityAddVariance=0,this.ringEmitterRadius=30,this.ringEmitterVelocity=0,this.ringEmitterVelocityAddVariance=0,this.ringEmitterUp=2,this.gravity=new Float32Array([0,0,0]),this.minStartColor=new Float32Array([1,1,1,1]),this.maxStartColor=new Float32Array([1,1,1,1]),this.minEndColor=new Float32Array([1,1,1,1]),this.maxEndColor=new Float32Array([1,1,1,1]),this.pointEmitterPosition=new Float32Array([0,0,0]),this.pointEmitterPositionVariance=new Float32Array([0,0,0]),this.pointEmitterVelocity=new Float32Array([0,0,0]),this.pointEmitterVelocityAddVariance=new Float32Array([0,0,0]),this.boxEmitterCenterPosition=new Float32Array([0,0,0]),this.boxEmitterSize=new Float32Array([0,0,0]),this.boxEmitterVelocity=new Float32Array([0,0,0]),this.boxEmitterVelocityAddVariance=new Float32Array([0,0,0]),this.sphereEmitterCenterPosition=new Float32Array([0,0,0]),this.ringEmitterCenterPosition=new Float32Array([0,0,0]),this.positionVariance=new Float32Array([0,0,0])}return r(t,"laya.particle.ParticleSetting"),t.checkSetting=function(e){var i;for(i in t._defaultSetting)e.hasOwnProperty(i)||(e[i]=t._defaultSetting[i])},n(t,["_defaultSetting",function(){return this._defaultSetting=new t}]),t}()),w=function(){function t(){this.settings=null,this.texture=null}return r(t,"laya.particle.ParticleTemplateBase"),t.prototype.addParticleArray=function(t,e){},t}(),C=function(){function t(){this.u_Duration=NaN,this.u_EndVelocity=NaN,this.u_Gravity=null,this.a_Position=null,this.a_Velocity=null,this.a_StartColor=null,this.a_EndColor=null,this.a_SizeRotation=null,this.a_Radius=null,this.a_Radian=null,this.a_AgeAddScale=NaN,this.gl_Position=null,this.v_Color=null,this.oSize=NaN,this._color=new Float32Array(4),this._position=new Float32Array(3)}r(t,"laya.particle.particleUtils.CanvasShader");var e=t.prototype;return e.getLen=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},e.ComputeParticlePosition=function(t,e,i,n){this._position[0]=t[0],this._position[1]=t[1],this._position[2]=t[2];var r,a=this.getLen(e),s=a*n+(a*this.u_EndVelocity-a)*n*n/2;r=this.getLen(e);var o=0;for(o=0;o<3;o++)this._position[o]=this._position[o]+e[o]/r*s*this.u_Duration,this._position[o]+=this.u_Gravity[o]*i*n;var l=c.lerp(this.a_Radius[0],this.a_Radius[1],n),h=c.lerp(this.a_Radian[0],this.a_Radian[2],n),u=c.lerp(this.a_Radian[1],this.a_Radian[3],n),_=Math.cos(u)*l;return this._position[1]+=Math.sin(u)*l,this._position[0]+=Math.cos(h)*_,this._position[2]+=Math.sin(h)*_,new Float32Array([this._position[0],this._position[1],0,1])},e.ComputeParticleSize=function(t,e,i){return c.lerp(t,e,i)},e.ComputeParticleRotation=function(t,e){return t*e},e.ComputeParticleColor=function(t,e,i){var n=this._color;return c.lerpVector4(t,e,i,n),n[3]=n[3]*i*(1-i)*(1-i)*6.7,n},e.clamp=function(t,e,i){return t<e?e:t>i?i:t},e.getData=function(t){t*=1+this.a_AgeAddScale;var e=this.clamp(t/this.u_Duration,0,1);this.gl_Position=this.ComputeParticlePosition(this.a_Position,this.a_Velocity,t,e);var i=this.ComputeParticleSize(this.a_SizeRotation[0],this.a_SizeRotation[1],e),n=this.ComputeParticleRotation(this.a_SizeRotation[2],t);this.v_Color=this.ComputeParticleColor(this.a_StartColor,this.a_EndColor,e);var r,a=new u;r=i/this.oSize*2,a.scale(r,r),a.rotate(n),a.setTranslate(this.gl_Position[0],-this.gl_Position[1]);var s;return s=this.v_Color[3],[this.v_Color,s,a,this.v_Color[0]*s,this.v_Color[1]*s,this.v_Color[2]*s]},t}(),b=function(){function t(){this.maxIndex=0,this.cmds=null,this.id=0}return r(t,"laya.particle.particleUtils.CMDParticle"),t.prototype.setCmds=function(t){this.cmds=t,this.maxIndex=t.length-1},t}(),M=function(){function t(){}return r(t,"laya.particle.particleUtils.PicTool"),t.getCanvasPic=function(t,e){t=t.bitmap;var i=new o("2D"),n=i.getContext("2d");i.size(t.width,t.height);var r=e>>16&255,a=e>>8&255,s=255&e;if(_.isConchApp&&n.setFilter(r/255,a/255,s/255,0),n.drawImage(t.source,0,0),!_.isConchApp){for(var l=n.getImageData(0,0,i.width,i.height),h=l.data,c=0,u=h.length;c<u;c+=4)0!=h[c+3]&&(h[c]*=r/255,h[c+1]*=a/255,h[c+2]*=s/255);n.putImageData(l,0,0)}return i},t.getRGBPic=function(e){return[new m(t.getCanvasPic(e,16711680)),new m(t.getCanvasPic(e,65280)),new m(t.getCanvasPic(e,255))]},t}(),I=function(t){function e(t){this.setting=null,this._posRange=null,this._canvasTemplate=null,this._emitFun=null,e.__super.call(this),this.template=t}r(e,"laya.particle.emitter.Emitter2D",t);var i=e.prototype;return i.emit=function(){t.prototype.emit.call(this),null!=this._emitFun&&this._emitFun()},i.getRandom=function(t){return(2*Math.random()-1)*t},i.webGLEmit=function(){var t=new Float32Array(3);t[0]=this.getRandom(this._posRange[0]),t[1]=this.getRandom(this._posRange[1]),t[2]=this.getRandom(this._posRange[2]);var e=new Float32Array(3);e[0]=0,e[1]=0,e[2]=0,this._particleTemplate.addParticleArray(t,e)},i.canvasEmit=function(){var t=new Float32Array(3);t[0]=this.getRandom(this._posRange[0]),t[1]=this.getRandom(this._posRange[1]),t[2]=this.getRandom(this._posRange[2]);var e=new Float32Array(3);e[0]=0,e[1]=0,e[2]=0,this._particleTemplate.addParticleArray(t,e)},a(0,i,"template",function(){return this._particleTemplate},function(t){this._particleTemplate=t,t||(this._emitFun=null,this.setting=null,this._posRange=null),this.setting=t.settings,this._posRange=this.setting.positionVariance,this._particleTemplate instanceof laya.particle.ParticleTemplate2D?this._emitFun=this.webGLEmit:this._particleTemplate instanceof laya.particle.ParticleTemplateCanvas&&(this._canvasTemplate=t,this._emitFun=this.canvasEmit)}),e}(x),D=function(t){function e(t){this._vertices=null,this._vertexBuffer=null,this._indexBuffer=null,this._floatCountPerVertex=29,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0,e.__super.call(this),this.settings=t}r(e,"laya.particle.ParticleTemplateWebGL",w);var i=e.prototype;return i.initialize=function(){this._vertices=new Float32Array(this.settings.maxPartices*this._floatCountPerVertex*4);for(var t=0,e=0;e<this.settings.maxPartices;e++){var i=Math.random(),n=this.settings.textureCount?1/this.settings.textureCount:1,r=NaN;for(r=0;r<this.settings.textureCount&&!(i<r+n);r+=n);t=e*this._floatCountPerVertex*4,this._vertices[t+0*this._floatCountPerVertex+0]=-1,this._vertices[t+0*this._floatCountPerVertex+1]=-1,this._vertices[t+0*this._floatCountPerVertex+2]=0,this._vertices[t+0*this._floatCountPerVertex+3]=r,this._vertices[t+1*this._floatCountPerVertex+0]=1,this._vertices[t+1*this._floatCountPerVertex+1]=-1,this._vertices[t+1*this._floatCountPerVertex+2]=1,this._vertices[t+1*this._floatCountPerVertex+3]=r,this._vertices[t+2*this._floatCountPerVertex+0]=1,this._vertices[t+2*this._floatCountPerVertex+1]=1,this._vertices[t+2*this._floatCountPerVertex+2]=1,this._vertices[t+2*this._floatCountPerVertex+3]=r+n,this._vertices[t+3*this._floatCountPerVertex+0]=-1,this._vertices[t+3*this._floatCountPerVertex+1]=1,this._vertices[t+3*this._floatCountPerVertex+2]=0,this._vertices[t+3*this._floatCountPerVertex+3]=r+n}},i.loadContent=function(){},i.update=function(t){this._currentTime+=t/1e3,this.retireActiveParticles(),this.freeRetiredParticles(),this._firstActiveElement==this._firstFreeElement&&(this._currentTime=0),this._firstRetiredElement==this._firstActiveElement&&(this._drawCounter=0)},i.retireActiveParticles=function(){for(var t=this.settings.duration;this._firstActiveElement!=this._firstNewElement;){var e=this._firstActiveElement*this._floatCountPerVertex*4,i=e+28,n=this._currentTime-this._vertices[i];if(1e-4+(n*=1+this._vertices[e+27])<t)break;this._vertices[i]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this.settings.maxPartices&&(this._firstActiveElement=0)}},i.freeRetiredParticles=function(){for(;this._firstRetiredElement!=this._firstActiveElement&&!(this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*4+28]<3);)this._firstRetiredElement++,this._firstRetiredElement>=this.settings.maxPartices&&(this._firstRetiredElement=0)},i.addNewParticlesToVertexBuffer=function(){},i.addParticleArray=function(t,e){var i=this._firstFreeElement+1;if(i>=this.settings.maxPartices&&(i=0),i!==this._firstRetiredElement){for(var n=E.Create(this.settings,t,e,this._currentTime),r=this._firstFreeElement*this._floatCountPerVertex*4,a=0;a<4;a++){var s=0,o=0;for(s=0,o=4;s<3;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.position[s];for(s=0,o=7;s<3;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.velocity[s];for(s=0,o=10;s<4;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.startColor[s];for(s=0,o=14;s<4;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.endColor[s];for(s=0,o=18;s<3;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.sizeRotation[s];for(s=0,o=21;s<2;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.radius[s];for(s=0,o=23;s<4;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.radian[s];this._vertices[r+a*this._floatCountPerVertex+27]=n.durationAddScale,this._vertices[r+a*this._floatCountPerVertex+28]=n.time}this._firstFreeElement=i}},e}(),A=function(t){function e(t){this._ready=!1,this.textureList=[],this.particleList=[],this.pX=0,this.pY=0,this.activeParticles=[],this.deadParticles=[],this.iList=[],this._maxNumParticles=0,this.textureWidth=NaN,this.dTextureWidth=NaN,this.colorChange=!0,this.step=1/60,this.canvasShader=new C,e.__super.call(this),this.settings=t,this._maxNumParticles=t.maxPartices,this.texture=new m,this.texture.on("loaded",this,this._textureLoaded),this.texture.load(t.textureName)}r(e,"laya.particle.ParticleTemplateCanvas",w);var i=e.prototype;return i._textureLoaded=function(t){this.setTexture(this.texture),this._ready=!0},i.clear=function(t){void 0===t&&(t=!0),this.deadParticles.length=0,this.activeParticles.length=0,this.textureList.length=0},i.setTexture=function(t){this.texture=t,this.textureWidth=t.width,this.dTextureWidth=1/this.textureWidth,this.pX=.5*-t.width,this.pY=.5*-t.height,this.textureList=e.changeTexture(t,this.textureList),this.particleList.length=0,this.deadParticles.length=0,this.activeParticles.length=0},i._createAParticleData=function(t,e){var i;this.canvasShader.u_EndVelocity=this.settings.endVelocity,this.canvasShader.u_Gravity=this.settings.gravity,this.canvasShader.u_Duration=this.settings.duration,i=E.Create(this.settings,t,e,0),this.canvasShader.a_Position=i.position,this.canvasShader.a_Velocity=i.velocity,this.canvasShader.a_StartColor=i.startColor,this.canvasShader.a_EndColor=i.endColor,this.canvasShader.a_SizeRotation=i.sizeRotation,this.canvasShader.a_Radius=i.radius,this.canvasShader.a_Radian=i.radian,this.canvasShader.a_AgeAddScale=i.durationAddScale,this.canvasShader.oSize=this.textureWidth;var n=new b,r=0,a=this.settings.duration/(1+i.durationAddScale),s=[];for(r=0;r<a;r+=this.step)s.push(this.canvasShader.getData(r));return n.id=this.particleList.length,this.particleList.push(n),n.setCmds(s),n},i.addParticleArray=function(t,e){var i;this._ready&&(this.particleList.length<this._maxNumParticles?(i=this._createAParticleData(t,e),this.iList[i.id]=0,this.activeParticles.push(i)):this.deadParticles.length>0&&(i=this.deadParticles.pop(),this.iList[i.id]=0,this.activeParticles.push(i)))},i.advanceTime=function(t){if(void 0===t&&(t=1),this._ready){var e,i=this.activeParticles,n=this.deadParticles,r=0,a=i.length,s=0,o=this.iList;for(r=a-1;r>-1;r--)(s=o[(e=i[r]).id])>=e.maxIndex?(s=0,i.splice(r,1),n.push(e)):s+=1,o[e.id]=s}},i.render=function(t,e,i){this._ready&&(this.activeParticles.length<1||this.textureList.length<2||(this.settings.disableColor?this.noColorRender(t,e,i):this.canvasRender(t,e,i)))},i.noColorRender=function(t,e,i){var n,r,a,s=this.activeParticles,o=0,l=s.length,h=NaN,c=this.pX,u=this.pY,_=2*-c,d=2*-u,f=0,p=(this.textureList,this.iList);for(t.translate(e,i),a=t.ctx.globalAlpha,o=0;o<l;o++)f=p[(n=s[o]).id],(r=n.cmds[f])&&((h=r[1])<=.01||(t.setAlpha(a*h),t.drawTextureWithTransform(this.texture,c,u,_,d,r[2],1)));t.setAlpha(a),t.translate(-e,-i)},i.canvasRender=function(t,e,i){var n,r,a,s,o=this.activeParticles,l=0,h=o.length,c=this.pX,u=this.pY,_=2*-c,d=2*-u,f=0,p=this.textureList,m=this.iList;for(t.translate(e,i),s=t.ctx.globalAlpha,a=t.ctx.globalCompositeOperation,t.blendMode("lighter"),l=0;l<h;l++)f=m[(n=o[l]).id],(r=n.cmds[f])&&(r[1]<=.01||(t.save(),t.transformByMatrix(r[2]),r[3]>.01&&(t.setAlpha(s*r[3]),t.drawTexture(p[0],c,u,_,d)),r[4]>.01&&(t.setAlpha(s*r[4]),t.drawTexture(p[1],c,u,_,d)),r[5]>.01&&(t.setAlpha(s*r[5]),t.drawTexture(p[2],c,u,_,d)),t.restore()));t.setAlpha(s),t.translate(-e,-i),t.blendMode(a)},e.changeTexture=function(t,e,i){return e||(e=[]),e.length=0,i&&i.disableColor?e.push(t,t,t):g.copyArray(e,M.getRGBPic(t)),e},e}(),R=function(t){function e(t){this._vertexBuffer2D=null,this._indexBuffer2D=null,this.x=0,this.y=0,this._blendFn=null,this._startTime=0,this.sv=new L,e.__super.call(this,t);var n=this;i.loader.load(this.settings.textureName,l.create(null,function(t){t.bitmap.enableMerageInAtlas=!1,n.texture=t})),this.sv.u_Duration=this.settings.duration,this.sv.u_Gravity=this.settings.gravity,this.sv.u_EndVelocity=this.settings.endVelocity,this._blendFn=s.fns[t.blendState],this.initialize(),this._vertexBuffer=this._vertexBuffer2D=v.create(-1,35048),this._indexBuffer=this._indexBuffer2D=h.create(35044),this.loadContent()}r(e,"laya.particle.ParticleTemplate2D",t);var n=e.prototype;return i.imps(n,{"laya.webgl.submit.ISubmit":!0}),n.getRenderType=function(){return-111},n.releaseRender=function(){},n.addParticleArray=function(e,i){e[0]+=this.x,e[1]+=this.y,t.prototype.addParticleArray.call(this,e,i)},n.loadContent=function(){for(var t=new Uint16Array(6*this.settings.maxPartices),e=0;e<this.settings.maxPartices;e++)t[6*e+0]=4*e+0,t[6*e+1]=4*e+1,t[6*e+2]=4*e+2,t[6*e+3]=4*e+0,t[6*e+4]=4*e+2,t[6*e+5]=4*e+3;this._indexBuffer2D.clear(),this._indexBuffer2D.append(t),this._indexBuffer2D.upload()},n.addNewParticlesToVertexBuffer=function(){this._vertexBuffer2D.clear(),this._vertexBuffer2D.append(this._vertices);var t=0;this._firstNewElement<this._firstFreeElement?(t=4*this._firstNewElement*this._floatCountPerVertex*4,this._vertexBuffer2D.subUpload(t,t,t+4*(this._firstFreeElement-this._firstNewElement)*this._floatCountPerVertex*4)):(t=4*this._firstNewElement*this._floatCountPerVertex*4,this._vertexBuffer2D.subUpload(t,t,t+4*(this.settings.maxPartices-this._firstNewElement)*this._floatCountPerVertex*4),this._firstFreeElement>0&&(this._vertexBuffer2D.setNeedUpload(),this._vertexBuffer2D.subUpload(0,0,4*this._firstFreeElement*this._floatCountPerVertex*4))),this._firstNewElement=this._firstFreeElement},n.renderSubmit=function(){return this.texture&&this.texture.loaded&&(this.update(i.timer.delta),this.sv.u_CurrentTime=this._currentTime,this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this.blend(),this._firstActiveElement!=this._firstFreeElement&&(S.mainContext,this._vertexBuffer2D.bind(this._indexBuffer2D),this.sv.u_texture=this.texture.source,this.sv.upload(),this._firstActiveElement<this._firstFreeElement?S.mainContext.drawElements(4,6*(this._firstFreeElement-this._firstActiveElement),5123,6*this._firstActiveElement*2):(S.mainContext.drawElements(4,6*(this.settings.maxPartices-this._firstActiveElement),5123,6*this._firstActiveElement*2),this._firstFreeElement>0&&S.mainContext.drawElements(4,6*this._firstFreeElement,5123,0)),p.drawCall++),this._drawCounter++),1},n.blend=function(){if(s.activeBlendFunction!==this._blendFn){var t=S.mainContext;t.enable(3042),this._blendFn(t),s.activeBlendFunction=this._blendFn}},n.dispose=function(){this._vertexBuffer2D.dispose(),this._indexBuffer2D.dispose()},e.activeBlendType=-1,e}(D),L=function(t){function e(){this.a_CornerTextureCoordinate=[4,5126,!1,116,0],this.a_Position=[3,5126,!1,116,16],this.a_Velocity=[3,5126,!1,116,28],this.a_StartColor=[4,5126,!1,116,40],this.a_EndColor=[4,5126,!1,116,56],this.a_SizeRotation=[3,5126,!1,116,72],this.a_Radius=[2,5126,!1,116,84],this.a_Radian=[4,5126,!1,116,92],this.a_AgeAddScale=[1,5126,!1,116,108],this.a_Time=[1,5126,!1,116,112],this.u_CurrentTime=NaN,this.u_Duration=NaN,this.u_Gravity=null,this.u_EndVelocity=NaN,this.u_texture=null,e.__super.call(this,0,0)}return r(e,"laya.particle.shader.value.ParticleShaderValue",y),e.prototype.upload=function(){this.refresh(),e.pShader.upload(this)},n(e,["pShader",function(){return this.pShader=new P}]),e}(),P=(function(e){function n(t){this._matrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._particleTemplate=null,this._canvasTemplate=null,this._emitter=null,this.autoPlay=!0,n.__super.call(this),t&&this.setParticleSetting(t)}r(n,"laya.particle.Particle2D",e);var s=n.prototype;s.load=function(t){i.loader.load(t,l.create(this,this.setParticleSetting),null,"json")},s.setParticleSetting=function(e){var n=this;if(!e)return this.stop();if(T.checkSetting(e),t.ConchParticleTemplate2D&&!_.isWebGL||(this.customRenderEnable=!0),_.isWebGL)this._particleTemplate=new R(e),this.graphics._saveToCmd(_.context._drawParticle,[this._particleTemplate]);else{if(_.isConchApp&&t.ConchParticleTemplate2D){this._particleTemplate=new ConchParticleTemplate2D;var r=this;return i.loader.load(e.textureName,l.create(null,function(t){r._particleTemplate.texture=t,r._particleTemplate.settings=e,_.isConchNode?r.graphics.drawParticle(r._particleTemplate):r.graphics._saveToCmd(_.context._drawParticle,[n._particleTemplate])})),this._emitter={start:function(){}},this.play=this._particleTemplate.play.bind(this._particleTemplate),this.stop=this._particleTemplate.stop.bind(this._particleTemplate),void(this.autoPlay&&this.play())}this._particleTemplate=this._canvasTemplate=new A(e)}this._emitter?this._emitter.template=this._particleTemplate:this._emitter=new I(this._particleTemplate),this.autoPlay&&(this.emitter.start(),this.play())},s.play=function(){this.timer.frameLoop(1,this,this._loop)},s.stop=function(){this.timer.clear(this,this._loop)},s._loop=function(){this.advanceTime(1/60)},s.advanceTime=function(t){void 0===t&&(t=1),this._canvasTemplate&&this._canvasTemplate.advanceTime(t),this._emitter&&this._emitter.advanceTime(t)},s.customRender=function(t,e,i){_.isWebGL&&(this._matrix4[0]=t.ctx._curMat.a,this._matrix4[1]=t.ctx._curMat.b,this._matrix4[4]=t.ctx._curMat.c,this._matrix4[5]=t.ctx._curMat.d,this._matrix4[12]=t.ctx._curMat.tx,this._matrix4[13]=t.ctx._curMat.ty,this._particleTemplate.sv.u_mmat=this._matrix4),this._canvasTemplate&&this._canvasTemplate.render(t,e,i)},s.destroy=function(t){void 0===t&&(t=!0),this._particleTemplate instanceof laya.particle.ParticleTemplate2D&&this._particleTemplate.dispose(),e.prototype.destroy.call(this,t)},a(0,s,"url",null,function(t){this.load(t)}),a(0,s,"emitter",function(){return this._emitter})}(f),function(t){function e(){e.__super.call(this,e.vs,e.ps,"ParticleShader")}return r(e,"laya.particle.shader.ParticleShader",d),n(e,["vs",function(){return this.vs="attribute vec4 a_CornerTextureCoordinate;\nattribute vec3 a_Position;\nattribute vec3 a_Velocity;\nattribute vec4 a_StartColor;\nattribute vec4 a_EndColor;\nattribute vec3 a_SizeRotation;\nattribute vec2 a_Radius;\nattribute vec4 a_Radian;\nattribute float a_AgeAddScale;\nattribute float a_Time;\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\n\nuniform float u_CurrentTime;\nuniform float u_Duration;\nuniform float u_EndVelocity;\nuniform vec3 u_Gravity;\n\n#ifdef PARTICLE3D\n uniform mat4 u_WorldMat;\n uniform mat4 u_View;\n uniform mat4 u_Projection;\n uniform vec2 u_ViewportScale;\n#else\n uniform vec2 size;\n uniform mat4 mmat;\n uniform mat4 u_mmat;\n#endif\n\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\n{\n\n   float startVelocity = length(velocity);//起始标量速度\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\n\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\n   \n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\n   \n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\n   \n   float r =cos(radianVertical)* radius;\n   addPosition.y += sin(radianVertical) * radius;\n\t\n   addPosition.x += cos(radianHorizontal) *r;\n   addPosition.z += sin(radianHorizontal) *r;\n  \n   #ifdef PARTICLE3D\n   position+=addPosition;\n    return  u_Projection*u_View*u_WorldMat*(vec4(position, 1.0));\n   #else\n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\n   position+=addPosition;\n    return  vec4(position,1.0);\n   #endif\n}\n\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\n{    \n    float size = mix(startSize, endSize, normalizedAge);\n    \n\t#ifdef PARTICLE3D\n    //Project the size into screen coordinates.\n     return size * u_Projection[1][1];\n\t#else\n\t return size;\n\t#endif\n}\n\nmat2 ComputeParticleRotation(in float rot,in float age)\n{    \n    float rotation =rot * age;\n    //计算2x2旋转矩阵.\n    float c = cos(rotation);\n    float s = sin(rotation);\n    return mat2(c, -s, s, c);\n}\n\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\n{\n\tvec4 color=mix(startColor,endColor,normalizedAge);\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\n   \n    return color;\n}\n\nvoid main()\n{\n   float age = u_CurrentTime - a_Time;\n   age *= 1.0 + a_AgeAddScale;\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\n\t\n   #ifdef PARTICLE3D\n\tgl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize * u_ViewportScale;\n   #else\n    mat4 mat=u_mmat*mmat;\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\n\tgl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\n   #endif\n   \n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\n}\n\n"},"ps",function(){return this.ps="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\n\nvoid main()\n{\t\n\tgl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\tgl_FragColor.xyz *= v_Color.w;\n}"}]),e}())}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns,i.static;var n=i.class,r=i.getset,a=(i.__newvec,laya.utils.Browser),s=laya.resource.HTMLCanvas,o=(laya.utils.Handler,laya.net.Loader),l=laya.maths.Point,h=laya.maths.Rectangle,c=laya.renders.Render,u=laya.renders.RenderContext,_=laya.display.Sprite,d=laya.resource.Texture,f=function(){function t(){this._jsonData=null,this._tileTexSetArr=[],this._texArray=[],this._x=0,this._y=0,this._width=0,this._height=0,this._mapW=0,this._mapH=0,this._mapTileW=0,this._mapTileH=0,this._mapSprite=null,this._layerArray=[],this._renderLayerArray=[],this._gridArray=[],this._showGridKey=!1,this._totalGridNum=0,this._gridW=0,this._gridH=0,this._gridWidth=450,this._gridHeight=450,this._jsonLoader=null,this._loader=null,this._tileSetArray=[],this._currTileSet=null,this._completeHandler=null,this._index=0,this._animationDic={},this._properties=null,this._tileProperties={},this._tileProperties2={},this._orientation="orthogonal",this._renderOrder="right-down",this._colorArray=["FF","00","33","66"],this._scale=1,this._pivotScaleX=.5,this._pivotScaleY=.5,this._centerX=0,this._centerY=0,this._viewPortX=0,this._viewPortY=0,this._viewPortWidth=0,this._viewPortHeight=0,this._enableLinear=!0,this._resPath=null,this._pathArray=null,this._limitRange=!1,this._fastDirty=!0,this.autoCache=!0,this.autoCacheType="normal",this.enableMergeLayer=!1,this.removeCoveredTile=!1,this.showGridTextureCount=!1,this.antiCrack=!0,this.cacheAllAfterInit=!1,this._texutreStartDic={},this._rect=new h,this._paddingRect=new h,this._mapRect=new e,this._mapLogicRect=new e,this._mapLastRect=new e,this._mapSprite=new _}var e,a,l;n(t,"laya.map.TiledMap");var f=t.prototype;return f.createMap=function(t,e,i,n,r,a,s){void 0===a&&(a=!0),void 0===s&&(s=!1),this._enableLinear=a,this._limitRange=s,this._rect.x=e.x,this._rect.y=e.y,this._rect.width=e.width,this._rect.height=e.height,this._viewPortWidth=e.width/this._scale,this._viewPortHeight=e.height/this._scale,this._completeHandler=i,n?this._paddingRect.copyFrom(n):this._paddingRect.setTo(0,0,0,0),r&&(this._gridWidth=r.x,this._gridHeight=r.y);var l=t.lastIndexOf("/");l>-1?(this._resPath=t.substr(0,l),this._pathArray=this._resPath.split("/")):(this._resPath="",this._pathArray=[]),this._jsonLoader=new o,this._jsonLoader.once("complete",this,this.onJsonComplete),this._jsonLoader.load(t,"json",!1)},f.onJsonComplete=function(t){var e=this._jsonData=t;this._properties=e.properties,this._orientation=e.orientation,this._renderOrder=e.renderorder,this._mapW=e.width,this._mapH=e.height,this._mapTileW=e.tilewidth,this._mapTileH=e.tileheight,this._width=this._mapTileW*this._mapW,this._height=this._mapTileH*this._mapH,"staggered"==this._orientation&&(this._height=(.5+.5*this._mapH)*this._mapTileH),this._mapLastRect.top=this._mapLastRect.bottom=this._mapLastRect.left=this._mapLastRect.right=-1;var i,n,r=e.tilesets,s=0;for(s=0;s<r.length;s++)if(i=r[s],(n=new l).init(i),!n.properties||!n.properties.ignore){this._tileProperties[s]=n.tileproperties,this.addTileProperties(n.tileproperties),this._tileSetArray.push(n);var h=i.tiles;if(h)for(var c in h){var u=h[c].animation;if(u){var _=new a;this._animationDic[c]=_,_.image=i.image;for(var d=0;d<u.length;d++){var f=u[d];_.mAniIdArray.push(f.tileid),_.mDurationTimeArray.push(f.duration)}}}}if(this._tileTexSetArr.push(null),this._tileSetArray.length>0){n=this._currTileSet=this._tileSetArray.shift(),this._loader=new o,this._loader.once("complete",this,this.onTextureComplete);var p=this.mergePath(this._resPath,n.image);this._loader.load(p,"image",!1)}},f.mergePath=function(t,e){var i="",n=e.split("/"),r=0,a=0;for(a=n.length-1;a>=0;a--)".."==n[a]&&r++;if(0==r)return this._pathArray.length>0?t+"/"+e:e;var s=this._pathArray.length-r;for(s<0&&console.log("[error]path does not exist",this._pathArray,n,t,e),a=0;a<s;a++)0==a?i+=this._pathArray[a]:i=i+"/"+this._pathArray[a];for(a=r;a<n.length;a++)i=i+"/"+n[a];return i},f.onTextureComplete=function(t){this._jsonData;var e=t;c.isWebGL&&!this._enableLinear&&(e.bitmap.minFifter=9728,e.bitmap.magFifter=9728,e.bitmap.enableMerageInAtlas=!1),this._texArray.push(e);var i=this._currTileSet,n=i.tilewidth,r=i.tileheight,a=i.imagewidth,s=i.imageheight,o=(i.firstgid,Math.floor((a-i.margin-n)/(n+i.spacing))+1),l=Math.floor((s-i.margin-r)/(r+i.spacing))+1,h=null;this._texutreStartDic[i.image]=this._tileTexSetArr.length;for(var u=0;u<l;u++)for(var _=0;_<o;_++)(h=new p).offX=i.titleoffsetX,h.offY=i.titleoffsetY-(r-this._mapTileH),h.texture=d.createFromTexture(e,i.margin+(n+i.spacing)*_,i.margin+(r+i.spacing)*u,n,r),this.antiCrack&&this.adptTexture(h.texture),this._tileTexSetArr.push(h),h.gid=this._tileTexSetArr.length;if(this._tileSetArray.length>0){i=this._currTileSet=this._tileSetArray.shift(),this._loader.once("complete",this,this.onTextureComplete);var f=this.mergePath(this._resPath,i.image);this._loader.load(f,"image",!1)}else this._currTileSet=null,this.initMap()},f.adptTexture=function(t){if(t){var e=t.uv[0],i=t.uv[2],n=t.uv[1],r=t.uv[7],a=1/t.bitmap.width,s=1/t.bitmap.height;t.uv[0]=t.uv[6]=e+a,t.uv[2]=t.uv[4]=i-a,t.uv[1]=t.uv[3]=n+s,t.uv[5]=t.uv[7]=r-s}},f.initMap=function(){var t=0,e=0;for(var n in this._animationDic){var r,a=this._animationDic[n];r=this._texutreStartDic[a.image];var s=this.getTexture(parseInt(n)+r);if(a.mAniIdArray.length>0){for(s.textureArray=[],s.durationTimeArray=a.mDurationTimeArray,s.isAnimation=!0,s.animationTotalTime=0,t=0,e=s.durationTimeArray.length;t<e;t++)s.animationTotalTime+=s.durationTimeArray[t];for(t=0,e=a.mAniIdArray.length;t<e;t++){var o=this.getTexture(a.mAniIdArray[t]+r);s.textureArray.push(o)}}}for(this._gridWidth=Math.floor(this._gridWidth/this._mapTileW)*this._mapTileW,this._gridHeight=Math.floor(this._gridHeight/this._mapTileH)*this._mapTileH,this._gridWidth<this._mapTileW&&(this._gridWidth=this._mapTileW),this._gridHeight<this._mapTileH&&(this._gridHeight=this._mapTileH),this._gridW=Math.ceil(this._width/this._gridWidth),this._gridH=Math.ceil(this._height/this._gridHeight),this._totalGridNum=this._gridW*this._gridH,t=0;t<this._gridH;t++){var l=[];this._gridArray.push(l);for(var h=0;h<this._gridW;h++)l.push(null)}for(var c,u,_,d=this._jsonData.layers,f=!0,p=0;p<d.length;p++){var m=d[p];if(1==m.visible){var y=new g;y.init(m,this),this.enableMergeLayer?(c=y.getLayerProperties("layer"),(f=f||!_||c!=u)?(f=!1,y.tarLayer=y,_=y,this._mapSprite.addChild(y),this._renderLayerArray.push(y)):y.tarLayer=_,u=c):(this._mapSprite.addChild(y),this._renderLayerArray.push(y)),this._layerArray.push(y)}}this.removeCoveredTile&&this.adptTiledMapData(),this.cacheAllAfterInit&&this.cacheAllGrid(),this.moveViewPort(this._rect.x,this._rect.y),i.stage.addChild(this.mapSprite()),null!=this._completeHandler&&this._completeHandler.run()},f.addTileProperties=function(t){var e;for(e in t)this._tileProperties2[e]=t[e]},f.getTileUserData=function(t,e,i){return this._tileProperties2&&this._tileProperties2[t]&&e in this._tileProperties2[t]?this._tileProperties2[t][e]:i},f.adptTiledMapData=function(){var t,e=0,i={};for(e=this._layerArray.length-1;e>=0;e--)(t=this._layerArray[e]._mapData)&&(this.removeCoverd(t,i),this.collectCovers(t,i,e))},f.removeCoverd=function(t,e){var i,n=0;for(i=t.length,n=0;n<i;n++)e[n]&&(t[n]=0)},f.collectCovers=function(t,e,i){var n,r=0;n=t.length;var a=0;for(r=0;r<n;r++)(a=t[r])>0&&this.getTileUserData(a-1,"type",0)>0&&(e[r]=a)},f.getTexture=function(t){return t<this._tileTexSetArr.length?this._tileTexSetArr[t]:null},f.getMapProperties=function(t){return this._properties?this._properties[t]:null},f.getTileProperties=function(t,e,i){return this._tileProperties[t]&&this._tileProperties[t][e]?this._tileProperties[t][e][i]:null},f.getSprite=function(t,e,i){if(0<this._tileTexSetArr.length){var n=new m;n.initData(this,!0),n.size(e,i);var r=this._tileTexSetArr[t];if(null!=r&&null!=r.texture){if(r.isAnimation){var a=new y;this._index++,a.setTileTextureSet(this._index.toString(),r),n.addAniSprite(a),n.addChild(a)}else n.graphics.drawTexture(r.texture,0,0,e,i);n.drawImageNum++}return n}return null},f.setViewPortPivotByScale=function(t,e){this._pivotScaleX=t,this._pivotScaleY=e,this._fastDirty=!0},f.moveViewPort=function(t,e){if(this._x=-t,this._y=-e,this._fastDirty)this._rect.x=t,this._rect.y=e,this.updateViewPort();else{var i,n;i=t-this._rect.x,n=e-this._rect.y,this._rect.x=t,this._rect.y=e,this.updateViewPortFast(i,n)}},f.changeViewPort=function(t,e,i,n){t==this._rect.x&&e==this._rect.y&&i==this._rect.width&&n==this._rect.height||(i!=this._rect.width||n!=this._rect.height?(this._fastDirty=!0,this._x=-t,this._y=-e,this._rect.x=t,this._rect.y=e,this._rect.width=i,this._rect.height=n,this._viewPortWidth=i/this._scale,this._viewPortHeight=n/this._scale,this.updateViewPort()):this.moveViewPort(t,e))},f.changeViewPortBySize=function(t,e,i){return null==i&&(i=new h),this._centerX=this._rect.x+this._rect.width*this._pivotScaleX,this._centerY=this._rect.y+this._rect.height*this._pivotScaleY,i.x=this._centerX-t*this._pivotScaleX,i.y=this._centerY-e*this._pivotScaleY,i.width=t,i.height=e,this.changeViewPort(i.x,i.y,i.width,i.height),i},f.updateViewPortFast=function(t,e){this._centerX+=t,this._centerY+=e,this._viewPortX+=t,this._viewPortY+=e;var i=!1,n=e/this._gridHeight,r=t/this._gridWidth;this._mapLogicRect.top+=n,this._mapLogicRect.bottom+=n,this._mapLogicRect.left+=r,this._mapLogicRect.right+=r,this._mapRect.top=0|this._mapLogicRect.top,this._mapRect.bottom=0|this._mapLogicRect.bottom,this._mapRect.left=0|this._mapLogicRect.left,this._mapRect.right=0|this._mapLogicRect.right,this._mapRect.top==this._mapLastRect.top&&this._mapRect.bottom==this._mapLastRect.bottom&&this._mapRect.left==this._mapLastRect.left&&this._mapRect.right==this._mapLastRect.right||(this.clipViewPort(),this._mapLastRect.top=this._mapRect.top,this._mapLastRect.bottom=this._mapRect.bottom,this._mapLastRect.left=this._mapRect.left,this._mapLastRect.right=this._mapRect.right,i=!0),(i=i||0!=t||0!=e)&&this.updateMapLayersPos()},f.updateMapLayersPos=function(){for(var t,e=this._renderLayerArray.length,i=0;i<e;i++)(t=this._renderLayerArray[i])._gridSpriteArray.length>0&&(t.updateAloneObject(),t.pos(-this._viewPortX,-this._viewPortY))},f.updateViewPort=function(){this._fastDirty=!1;var t=this._rect.width*this._pivotScaleX,e=this._rect.height*this._pivotScaleY;this._centerX=this._rect.x+t,this._centerY=this._rect.y+e;var i=!1,n=this._viewPortX;this._viewPortX=this._centerX-t/this._scale,n!=this._viewPortX?i=!0:n=this._viewPortY,this._viewPortY=this._centerY-e/this._scale,i||n==this._viewPortY||(i=!0),this._limitRange&&(this._viewPortX+this._viewPortWidth>this._width&&(this._viewPortX=this._width-this._viewPortWidth),this._viewPortY+this._viewPortHeight>this._height&&(this._viewPortY=this._height-this._viewPortHeight),this._viewPortX<0&&(this._viewPortX=0),this._viewPortY<0&&(this._viewPortY=0));var r=this._paddingRect;this._mapLogicRect.top=(this._viewPortY-r.y)/this._gridHeight,this._mapLogicRect.bottom=(this._viewPortY+this._viewPortHeight+r.height+r.y)/this._gridHeight,this._mapLogicRect.left=(this._viewPortX-r.x)/this._gridWidth,this._mapLogicRect.right=(this._viewPortX+this._viewPortWidth+r.width+r.x)/this._gridWidth,this._mapRect.top=0|this._mapLogicRect.top,this._mapRect.bottom=0|this._mapLogicRect.bottom,this._mapRect.left=0|this._mapLogicRect.left,this._mapRect.right=0|this._mapLogicRect.right,this._mapRect.top==this._mapLastRect.top&&this._mapRect.bottom==this._mapLastRect.bottom&&this._mapRect.left==this._mapLastRect.left&&this._mapRect.right==this._mapLastRect.right||(this.clipViewPort(),this._mapLastRect.top=this._mapRect.top,this._mapLastRect.bottom=this._mapRect.bottom,this._mapLastRect.left=this._mapRect.left,this._mapLastRect.right=this._mapRect.right,i=!0),i&&this.updateMapLayersPos()},f.clipViewPort=function(){var t=0,e=0,i=0,n=0;if(this._mapRect.left>this._mapLastRect.left){if((t=this._mapRect.left-this._mapLastRect.left)>0)for(n=this._mapLastRect.left;n<this._mapLastRect.left+t;n++)for(i=this._mapLastRect.top;i<=this._mapLastRect.bottom;i++)this.hideGrid(n,i)}else if((e=Math.min(this._mapLastRect.left,this._mapRect.right+1)-this._mapRect.left)>0)for(n=this._mapRect.left;n<this._mapRect.left+e;n++)for(i=this._mapRect.top;i<=this._mapRect.bottom;i++)this.showGrid(n,i);if(this._mapRect.right>this._mapLastRect.right){if((e=this._mapRect.right-this._mapLastRect.right)>0)for(n=Math.max(this._mapLastRect.right+1,this._mapRect.left);n<=this._mapLastRect.right+e;n++)for(i=this._mapRect.top;i<=this._mapRect.bottom;i++)this.showGrid(n,i)}else if((t=this._mapLastRect.right-this._mapRect.right)>0)for(n=this._mapRect.right+1;n<=this._mapRect.right+t;n++)for(i=this._mapLastRect.top;i<=this._mapLastRect.bottom;i++)this.hideGrid(n,i);if(this._mapRect.top>this._mapLastRect.top){if((t=this._mapRect.top-this._mapLastRect.top)>0)for(i=this._mapLastRect.top;i<this._mapLastRect.top+t;i++)for(n=this._mapLastRect.left;n<=this._mapLastRect.right;n++)this.hideGrid(n,i)}else if((e=Math.min(this._mapLastRect.top,this._mapRect.bottom+1)-this._mapRect.top)>0)for(i=this._mapRect.top;i<this._mapRect.top+e;i++)for(n=this._mapRect.left;n<=this._mapRect.right;n++)this.showGrid(n,i);if(this._mapRect.bottom>this._mapLastRect.bottom){if((e=this._mapRect.bottom-this._mapLastRect.bottom)>0)for(i=Math.max(this._mapLastRect.bottom+1,this._mapRect.top);i<=this._mapLastRect.bottom+e;i++)for(n=this._mapRect.left;n<=this._mapRect.right;n++)this.showGrid(n,i)}else if((t=this._mapLastRect.bottom-this._mapRect.bottom)>0)for(i=this._mapRect.bottom+1;i<=this._mapRect.bottom+t;i++)for(n=this._mapLastRect.left;n<=this._mapLastRect.right;n++)this.hideGrid(n,i)},f.showGrid=function(t,e){if(!(t<0||t>=this._gridW||e<0||e>=this._gridH)){var i,n=0,r=this._gridArray[e][t];if(null==r)r=this.getGridArray(t,e);else for(n=0;n<r.length&&n<this._layerArray.length;n++)this._layerArray[n]&&r[n]&&0==(i=r[n]).visible&&i.drawImageNum>0&&i.show()}},f.cacheAllGrid=function(){var t,e=0,i=0;for(e=0;e<this._gridW;e++)for(i=0;i<this._gridH;i++)t=this.getGridArray(e,i),this.cacheGridsArray(t)},f.cacheGridsArray=function(e){var i;t._tempContext||(t._tempContext=new u(1,1,s.create("AUTO"))),(i=t._tempContext.canvas).context.asBitmap=!1;var n,r,a=0;for(n=e.length,a=0;a<n;a++)r=e[a],i.clear(),i.size(1,1),r.render(t._tempContext,0,0),r.hide();i.clear(),i.size(1,1)},f.getGridArray=function(t,e){var i,n=0,r=0,a=this._gridArray[e][t];if(null==a){a=this._gridArray[e][t]=[];var s=0,o=0,l=0,h=0,c=this._gridWidth,u=this._gridHeight;switch(this.orientation){case"isometric":s=Math.floor(t*c),o=Math.floor(t*c+c),l=Math.floor(e*u),h=Math.floor(e*u+u);var _=0,d=0,f=0,p=0;break;case"staggered":s=Math.floor(t*c/this._mapTileW),o=Math.floor((t*c+c)/this._mapTileW),l=Math.floor(e*u/(this._mapTileH/2)),h=Math.floor((e*u+u)/(this._mapTileH/2));break;case"orthogonal":s=Math.floor(t*c/this._mapTileW),o=Math.floor((t*c+c)/this._mapTileW),l=Math.floor(e*u/this._mapTileH),h=Math.floor((e*u+u)/this._mapTileH);break;case"hexagonal":var m=2*this._mapTileH/3;s=Math.floor(t*c/this._mapTileW),o=Math.ceil((t*c+c)/this._mapTileW),l=Math.floor(e*u/m),h=Math.ceil((e*u+u)/m)}for(var g,y,v=null,S=0;S<this._layerArray.length;S++){var x;switch(v=this._layerArray[S],this.enableMergeLayer?(v.tarLayer!=y&&(g=null,y=v.tarLayer),g||(g=y.getDrawSprite(t,e),a.push(g)),i=g):(i=v.getDrawSprite(t,e),a.push(i)),this._showGridKey&&(x="#",x+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)],x+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)],x+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)]),this.orientation){case"isometric":var E=this.tileHeight/2,T=this.tileWidth/2,w=this._width/2;f=Math.floor(l/E),p=Math.floor(h/E),_=this._mapW+Math.floor((s-w)/T),d=this._mapW+Math.floor((o-w)/T),this._mapW;var C=2*this._mapH;for(f<0&&(f=0),f>=C&&(f=C-1),p<0&&(h=0),p>=C&&(p=C-1),i.zOrder=this._totalGridNum*S+e*this._gridW+t,n=f;n<p;n++)for(r=0;r<=n;r++){var b=n-r,M=r,I=b-M+this._mapW;I>_&&I<=d&&v.drawTileTexture(i,b,M)&&i.drawImageNum++}break;case"staggered":for(i.zOrder=S*this._totalGridNum+e*this._gridW+t,n=l;n<h;n++)for(r=s;r<o;r++)v.drawTileTexture(i,r,n)&&i.drawImageNum++;break;case"orthogonal":case"hexagonal":switch(this._renderOrder){case"right-down":for(i.zOrder=S*this._totalGridNum+e*this._gridW+t,n=l;n<h;n++)for(r=s;r<o;r++)v.drawTileTexture(i,r,n)&&i.drawImageNum++;break;case"right-up":for(i.zOrder=S*this._totalGridNum+(this._gridH-1-e)*this._gridW+t,n=h-1;n>=l;n--)for(r=s;r<o;r++)v.drawTileTexture(i,r,n)&&i.drawImageNum++;break;case"left-down":for(i.zOrder=S*this._totalGridNum+e*this._gridW+(this._gridW-1-t),n=l;n<h;n++)for(r=o-1;r>=s;r--)v.drawTileTexture(i,r,n)&&i.drawImageNum++;break;case"left-up":for(i.zOrder=S*this._totalGridNum+(this._gridH-1-e)*this._gridW+(this._gridW-1-t),n=h-1;n>=l;n--)for(r=o-1;r>=s;r--)v.drawTileTexture(i,r,n)&&i.drawImageNum++}}i.isHaveAnimation||(i.autoSize=!0,this.autoCache&&(i.cacheAs=this.autoCacheType),i.autoSize=!1),this.enableMergeLayer?g&&g.drawImageNum>0&&y&&(y.addChild(g),g.visible=!1,g.show()):(i.drawImageNum>0&&(v.addChild(i),i.visible=!1,i.show()),this._showGridKey&&i.graphics.drawRect(0,0,c,u,null,x))}this.enableMergeLayer&&this.showGridTextureCount&&g&&g.graphics.fillText(g.drawImageNum+"",20,20,null,"#ff0000","left")}return a},f.hideGrid=function(t,e){if(!(t<0||t>=this._gridW||e<0||e>=this._gridH)){var i=this._gridArray[e][t];if(i)for(var n,r=0;r<i.length;r++)(n=i[r]).drawImageNum>0&&null!=n&&n.hide()}},f.getLayerObject=function(t,e){for(var i=null,n=0;n<this._layerArray.length&&(i=this._layerArray[n]).layerName!=t;n++);return i?i.getObjectByName(e):null},f.destroy=function(){this._orientation="orthogonal",this._jsonData=null;var t,e=0;for(this._gridArray=[],e=0;e<this._tileTexSetArr.length;e++)(t=this._tileTexSetArr[e])&&t.clearAll();for(this._tileTexSetArr=[],e=0;e<this._texArray.length;e++)this._texArray[e].destroy();for(this._texArray=[],this._width=0,this._height=0,this._mapW=0,this._mapH=0,this._mapTileW=0,this._mapTileH=0,this._rect.setTo(0,0,0,0),e=0;e<this._layerArray.length;e++)this._layerArray[e].clearAll();this._layerArray=[],this._renderLayerArray=[],this._mapSprite&&(this._mapSprite.destroy(),this._mapSprite=null),this._jsonLoader=null,this._loader=null;var i=this._animationDic;for(var n in i)delete i[n];for(n in this._properties=null,i=this._tileProperties)delete i[n];this._currTileSet=null,this._completeHandler=null,this._mapRect.clearAll(),this._mapLastRect.clearAll(),this._tileSetArray=[],this._gridWidth=450,this._gridHeight=450,this._gridW=0,this._gridH=0,this._x=0,this._y=0,this._index=0,this._enableLinear=!0,this._resPath=null,this._pathArray=null},f.mapSprite=function(){return this._mapSprite},f.getLayerByName=function(t){for(var e,i=0;i<this._layerArray.length;i++)if(t==(e=this._layerArray[i]).layerName)return e;return null},f.getLayerByIndex=function(t){return t<this._layerArray.length?this._layerArray[t]:null},r(0,f,"orientation",function(){return this._orientation}),r(0,f,"viewPortX",function(){return-this._viewPortX}),r(0,f,"scale",function(){return this._scale},function(t){t<=0||(this._scale=t,this._viewPortWidth=this._rect.width/t,this._viewPortHeight=this._rect.height/t,this._mapSprite.scale(this._scale,this._scale),this.updateViewPort())}),r(0,f,"tileWidth",function(){return this._mapTileW}),r(0,f,"viewPortY",function(){return-this._viewPortY}),r(0,f,"tileHeight",function(){return this._mapTileH}),r(0,f,"width",function(){return this._width}),r(0,f,"numRowsTile",function(){return this._mapH}),r(0,f,"numColumnsTile",function(){return this._mapW}),r(0,f,"height",function(){return this._height}),r(0,f,"viewPortWidth",function(){return this._viewPortWidth}),r(0,f,"viewPortHeight",function(){return this._viewPortHeight}),r(0,f,"x",function(){return this._x}),r(0,f,"y",function(){return this._y}),r(0,f,"gridWidth",function(){return this._gridWidth}),r(0,f,"gridHeight",function(){return this._gridHeight}),r(0,f,"numColumnsGrid",function(){return this._gridW}),r(0,f,"numRowsGrid",function(){return this._gridH}),r(0,f,"renderOrder",function(){return this._renderOrder}),t.ORIENTATION_ORTHOGONAL="orthogonal",t.ORIENTATION_ISOMETRIC="isometric",t.ORIENTATION_STAGGERED="staggered",t.ORIENTATION_HEXAGONAL="hexagonal",t.RENDERORDER_RIGHTDOWN="right-down",t.RENDERORDER_RIGHTUP="right-up",t.RENDERORDER_LEFTDOWN="left-down",t.RENDERORDER_LEFTUP="left-up",t._tempContext=null,t.__init$=function(){e=function(){function t(){this.left=0,this.top=0,this.right=0,this.bottom=0}return n(t,""),t.prototype.clearAll=function(){this.left=this.top=this.right=this.bottom=0},t}(),a=function(){function t(){this.mAniIdArray=[],this.mDurationTimeArray=[],this.mTileTexSetArr=[],this.image=null}return n(t,""),t}(),l=function(){function t(){this.firstgid=0,this.image="",this.imageheight=0,this.imagewidth=0,this.margin=0,this.name=0,this.properties=null,this.spacing=0,this.tileheight=0,this.tilewidth=0,this.titleoffsetX=0,this.titleoffsetY=0,this.tileproperties=null}return n(t,""),t.prototype.init=function(t){this.firstgid=t.firstgid,this.image=t.image,this.imageheight=t.imageheight,this.imagewidth=t.imagewidth,this.margin=t.margin,this.name=t.name,this.properties=t.properties,this.spacing=t.spacing,this.tileheight=t.tileheight,this.tilewidth=t.tilewidth,this.tileproperties=t.tileproperties;var e=t.tileoffset;e&&(this.titleoffsetX=e.x,this.titleoffsetY=e.y)},t}()},t}(),p=function(){function t(){this.gid=-1,this.texture=null,this.offX=0,this.offY=0,this.textureArray=null,this.durationTimeArray=null,this.animationTotalTime=0,this.isAnimation=!1,this._spriteNum=0,this._aniDic=null,this._frameIndex=0,this._time=0,this._interval=0,this._preFrameTime=0}n(t,"laya.map.TileTexSet");var e=t.prototype;return e.addAniSprite=function(t,e){if(0!=this.animationTotalTime&&(null==this._aniDic&&(this._aniDic={}),0==this._spriteNum&&(i.timer.frameLoop(3,this,this.animate),this._preFrameTime=a.now(),this._frameIndex=0,this._time=0,this._interval=0),this._spriteNum++,this._aniDic[t]=e,this.textureArray&&this._frameIndex<this.textureArray.length)){var n=this.textureArray[this._frameIndex];this.drawTexture(e,n)}},e.animate=function(){if(this.textureArray&&this.textureArray.length>0&&this.durationTimeArray&&this.durationTimeArray.length>0){var t=a.now();this._interval=t-this._preFrameTime,this._preFrameTime=t,this._interval>this.animationTotalTime&&(this._interval=this._interval%this.animationTotalTime),this._time+=this._interval;for(var e=this.durationTimeArray[this._frameIndex];this._time>e;){this._time-=e,this._frameIndex++,(this._frameIndex>=this.durationTimeArray.length||this._frameIndex>=this.textureArray.length)&&(this._frameIndex=0);var i,n=this.textureArray[this._frameIndex];for(var r in this._aniDic)i=this._aniDic[r],this.drawTexture(i,n);e=this.durationTimeArray[this._frameIndex]}}},e.drawTexture=function(t,e){t.graphics.clear(),t.graphics.drawTexture(e.texture,e.offX,e.offY)},e.removeAniSprite=function(t){this._aniDic&&this._aniDic[t]&&(delete this._aniDic[t],this._spriteNum--,0==this._spriteNum&&i.timer.clear(this,this.animate))},e.showDebugInfo=function(){var t=null;return this._spriteNum>0&&(t="TileTextureSet::gid:"+this.gid.toString()+" 动画数:"+this._spriteNum.toString()),t},e.clearAll=function(){this.gid=-1,this.texture&&(this.texture.destroy(),this.texture=null),this.offX=0,this.offY=0,this.textureArray=null,this.durationTimeArray=null,this.isAnimation=!1,this._spriteNum=0,this._aniDic=null,this._frameIndex=0,this._preFrameTime=0,this._time=0,this._interval=0},t}(),m=function(t){function e(){this.relativeX=0,this.relativeY=0,this.isAloneObject=!1,this.isHaveAnimation=!1,this.aniSpriteArray=null,this.drawImageNum=0,this._map=null,e.__super.call(this)}n(e,"laya.map.GridSprite",t);var i=e.prototype;return i.initData=function(t,e){void 0===e&&(e=!1),this._map=t,this.isAloneObject=e},i._setDisplay=function(e){if(!e){var i=this._$P.cacheCanvas;i&&i.ctx&&(i.ctx.canvas.destroy(),i.ctx=null);var n=this._$P._filterCache;n&&(n.destroy(),n.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1)}t.prototype._setDisplay.call(this,e)},i.addAniSprite=function(t){null==this.aniSpriteArray&&(this.aniSpriteArray=[]),this.aniSpriteArray.push(t)},i.show=function(){if(!this.visible){var t;if(this.visible=!0,!this.isAloneObject)(t=this.parent)&&t.showGridSprite(this);if(!c.isWebGL&&this._map.autoCache&&(this.cacheAs=this._map.autoCacheType),null==this.aniSpriteArray)return;for(var e=0;e<this.aniSpriteArray.length;e++)this.aniSpriteArray[e].show()}},i.hide=function(){if(this.visible){var t;if(this.visible=!1,!this.isAloneObject)(t=this.parent)&&t.hideGridSprite(this);if(!c.isWebGL&&this._map.autoCache&&(this.cacheAs="none"),null==this.aniSpriteArray)return;for(var e=0;e<this.aniSpriteArray.length;e++)this.aniSpriteArray[e].hide()}},i.updatePos=function(){this.isAloneObject?(this._map&&(this.x=this.relativeX,this.y=this.relativeY),this.x<0||this.x>this._map.viewPortWidth||this.y<0||this.y>this._map.viewPortHeight?this.hide():this.show()):this._map&&(this.x=this.relativeX,this.y=this.relativeY)},i.clearAll=function(){if(this._map&&(this._map=null),this.visible=!1,null!=this.aniSpriteArray)for(var t=0;t<this.aniSpriteArray.length;t++)this.aniSpriteArray[t].clearAll();this.destroy(),this.relativeX=0,this.relativeY=0,this.isHaveAnimation=!1,this.aniSpriteArray=null,this.drawImageNum=0},e}(_),g=function(t){function e(){this._map=null,this._mapData=null,this._tileWidthHalf=0,this._tileHeightHalf=0,this._mapWidthHalf=0,this._mapHeightHalf=0,this._gridSpriteArray=[],this._objDic=null,this._dataDic=null,this._properties=null,this.tarLayer=null,this.layerName=null,this._showGridList=[],this._aloneObjs=[],e.__super.call(this),this._tempMapPos=new l}n(e,"laya.map.MapLayer",t);var i=e.prototype;return i.init=function(t,e){this._map=e,this._mapData=t.data,t.height,t.width;var i=e.tileWidth,n=e.tileHeight;switch(this.layerName=t.name,this._properties=t.properties,this.alpha=t.opacity,this._tileWidthHalf=i/2,this._tileHeightHalf=n/2,this._mapWidthHalf=this._map.width/2-this._tileWidthHalf,this._mapHeightHalf=this._map.height/2,t.type){case"tilelayer":break;case"objectgroup":var r=t.objects;r.length>0&&(this._objDic={},this._dataDic={});for(var a,s=NaN,o=NaN,h=0;h<r.length;h++)if(a=r[h],this._dataDic[a.name]=a,1==a.visible){s=a.width,o=a.height;var c=e.getSprite(a.gid,s,o);if(null!=c){switch(this._map.orientation){case"isometric":this.getScreenPositionByTilePos(a.x/n,a.y/n,l.TEMP),c.pivot(s/2,o/2),c.rotation=a.rotation,c.x=c.relativeX=l.TEMP.x+this._map.viewPortX,c.y=c.relativeY=l.TEMP.y+this._map.viewPortY-o/2;break;case"staggered":case"orthogonal":c.pivot(s/2,o/2),c.rotation=a.rotation,c.x=c.relativeX=a.x+s/2,c.y=c.relativeY=a.y-o/2;break;case"hexagonal":c.x=c.relativeX=a.x,c.y=c.relativeY=a.y}this.addChild(c),this._gridSpriteArray.push(c),c.isAloneObject&&(this._showGridList.push(c),this._aloneObjs.push(c)),this._objDic[a.name]=c}}}},i.getObjectByName=function(t){return this._objDic?this._objDic[t]:null},i.getObjectDataByName=function(t){return this._dataDic?this._dataDic[t]:null},i.getLayerProperties=function(t){return this._properties?this._properties[t]:null},i.getTileData=function(t,e){if(e>=0&&e<this._map.numRowsTile&&t>=0&&t<this._map.numColumnsTile){var i=e*this._map.numColumnsTile+t,n=this._mapData;if(null!=n&&i<n.length)return n[i]}return 0},i.getScreenPositionByTilePos=function(t,e,i){if(i){switch(this._map.orientation){case"isometric":i.x=this._map.width/2-(e-t)*this._tileWidthHalf,i.y=(e+t)*this._tileHeightHalf;break;case"staggered":t=Math.floor(t),e=Math.floor(e),i.x=t*this._map.tileWidth+(1&e)*this._tileWidthHalf,i.y=e*this._tileHeightHalf;break;case"orthogonal":i.x=t*this._map.tileWidth,i.y=e*this._map.tileHeight;break;case"hexagonal":t=Math.floor(t),e=Math.floor(e);var n=2*this._map.tileHeight/3;i.x=(t*this._map.tileWidth+e%2*this._tileWidthHalf)%this._map.gridWidth,i.y=e*n%this._map.gridHeight}i.x=(i.x+this._map.viewPortX)*this._map.scale,i.y=(i.y+this._map.viewPortY)*this._map.scale}},i.getTileDataByScreenPos=function(t,e){var i=0;return this.getTilePositionByScreenPos(t,e,this._tempMapPos)&&(i=this.getTileData(Math.floor(this._tempMapPos.x),Math.floor(this._tempMapPos.y))),i},i.getTilePositionByScreenPos=function(t,e,i){t=t/this._map.scale-this._map.viewPortX,e=e/this._map.scale-this._map.viewPortY;var n=this._map.tileWidth,r=this._map.tileHeight,a=0,s=0;switch(this._map.orientation){case"isometric":var o=t-this._map.width/2;return a=-(o/n-e/r),s=o/n+e/r,i&&(i.x=s,i.y=a),!0;case"staggered":if(i){var l,h;l=(t-(Math.floor(t/n)*n+n/2))*r/2,h=(e-(Math.floor(e/r)*r+r/2))*n/2,Math.abs(l)+Math.abs(h)<=n*r/4?(s=Math.floor(t/n),a=2*Math.floor(e/r)):(t-=n/2,s=Math.floor(t/n)+1,e-=r/2,a=2*Math.floor(e/r)+1),i.x=s-(1&a),i.y=a}return!0;case"orthogonal":return s=t/n,a=e/r,i&&(i.x=s,i.y=a),!0;case"hexagonal":s=(t-(a=e/(2*r/3))%2*this._tileWidthHalf)/n,i&&(i.x=s,i.y=a)}return!1},i.getDrawSprite=function(t,e){var i=new m;return i.relativeX=t*this._map.gridWidth,i.relativeY=e*this._map.gridHeight,i.initData(this._map),i.updatePos(),this._gridSpriteArray.push(i),i},i.showGridSprite=function(t){var e,i=this._showGridList,n=0;e=i.length;var r,a=-1;for(n=0;n<e;n++){if((r=i[n])==t)return;r.isAloneObject||r.visible||(a=n)}a>=0?i[a]=t:i.push(t)},i.hideGridSprite=function(t){t.visible=!1},i.updateGridPos=function(){var t,e,i;i=(e=this._showGridList).length;for(var n=0;n<i;n++)((t=e[n])._style.visible||t.isAloneObject)&&t.drawImageNum>0&&t.updatePos()},i.updateAloneObject=function(){var t,e,i;i=(e=this._aloneObjs).length;for(var n=0;n<i;n++)(t=e[n]).drawImageNum>0&&t.updatePos()},i.render=function(e,i,n){var r=this._childs;this._childs=this._showGridList,t.prototype.render.call(this,e,i,n),this._childs=r},i.drawTileTexture=function(t,e,i){if(i>=0&&i<this._map.numRowsTile&&e>=0&&e<this._map.numColumnsTile){var n=i*this._map.numColumnsTile+e,r=this._mapData;if(null!=r&&n<r.length&&0!=r[n]){var a=this._map.getTexture(r[n]);if(a){var s=0,o=0;switch(a.texture,this._map.orientation){case"staggered":s=e*this._map.tileWidth%this._map.gridWidth+(1&i)*this._tileWidthHalf,o=i*this._tileHeightHalf%this._map.gridHeight;break;case"orthogonal":s=e*this._map.tileWidth%this._map.gridWidth,o=i*this._map.tileHeight%this._map.gridHeight;break;case"isometric":s=(this._mapWidthHalf+(e-i)*this._tileWidthHalf)%this._map.gridWidth,o=(e+i)*this._tileHeightHalf%this._map.gridHeight;break;case"hexagonal":var l=2*this._map.tileHeight/3;s=(e*this._map.tileWidth+i%2*this._tileWidthHalf)%this._map.gridWidth,o=i*l%this._map.gridHeight}if(a.isAnimation){var h=new y;h.x=s,h.y=o,h.setTileTextureSet(n.toString(),a),t.addAniSprite(h),t.addChild(h),t.isHaveAnimation=!0}else t.graphics.drawTexture(a.texture,s+a.offX,o+a.offY);return!0}}}return!1},i.clearAll=function(){this._map=null,this._mapData=null,this._tileWidthHalf=0,this._tileHeightHalf=0,this._mapWidthHalf=0,this._mapHeightHalf=0,this.layerName=null;var t=0;if(this._objDic){for(var e in this._objDic)delete this._objDic[e];this._objDic=null}if(this._dataDic){for(e in this._dataDic)delete this._dataDic[e];this._dataDic=null}for(t=0;t<this._gridSpriteArray.length;t++)this._gridSpriteArray[t].clearAll();this._properties=null,this._tempMapPos=null,this.tarLayer=null},e}(_),y=function(t){function e(){this._tileTextureSet=null,this._aniName=null,e.__super.call(this)}n(e,"laya.map.TileAniSprite",_);var i=e.prototype;return i.setTileTextureSet=function(t,e){this._aniName=t,this._tileTextureSet=e,e.addAniSprite(this._aniName,this)},i.show=function(){this._tileTextureSet.addAniSprite(this._aniName,this)},i.hide=function(){this._tileTextureSet.removeAniSprite(this._aniName)},i.clearAll=function(){this._tileTextureSet.removeAniSprite(this._aniName),this.destroy(),this._tileTextureSet=null,this._aniName=null},e}();i.__init([f])}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,a=i.getset,s=(i.__newvec,laya.display.Animation),o=(laya.utils.Browser,laya.utils.ClassUtils),l=laya.filters.ColorFilter,h=laya.utils.Ease,c=laya.events.Event,u=(laya.events.EventDispatcher,laya.display.css.Font),_=laya.display.FrameAnimation,d=laya.display.Graphics,f=laya.utils.Handler,p=laya.display.Input,m=laya.net.Loader,g=(laya.display.Node,laya.maths.Point),y=laya.maths.Rectangle,v=laya.renders.Render,S=laya.display.Sprite,x=laya.display.Text,E=laya.resource.Texture,T=laya.utils.Tween,w=laya.utils.Utils,C=laya.utils.WeakObject;i.interface("laya.ui.IItem"),i.interface("laya.ui.ISelect"),i.interface("laya.ui.IRender"),i.interface("laya.ui.IComponent"),i.interface("laya.ui.IBox","IComponent");var b=function(){function t(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return r(t,"laya.ui.LayoutStyle"),n(t,["EMPTY",function(){return this.EMPTY=new t}]),t}(),M=function(){function t(){}return r(t,"laya.ui.Styles"),t.labelColor="#000000",t.buttonStateNum=3,t.scrollBarMinNum=15,t.scrollBarDelayTime=500,n(t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),t}(),I=function(){function t(){}return r(t,"laya.ui.UIUtils"),t.fillArray=function(t,e,i){var n=t.concat();if(e)for(var r=e.split(","),a=0,s=Math.min(n.length,r.length);a<s;a++){var o=r[a];n[a]="true"==o||"false"!=o&&o,null!=i&&(n[a]=i(o))}return n},t.toColor=function(t){return w.toHexColor(t)},t.gray=function(e,i){void 0===i&&(i=!0),i?t.addFilter(e,t.grayFilter):t.clearFilter(e,l)},t.addFilter=function(t,e){var i=t.filters||[];i.push(e),t.filters=i},t.clearFilter=function(t,e){var n=t.filters;if(null!=n&&n.length>0){for(var r=n.length-1;r>-1;r--){var a=n[r];i.__typeof(a,e)&&n.splice(r,1)}t.filters=n}},t._getReplaceStr=function(e){return t.escapeSequence[e]},t.adptString=function(e){return e.replace(/\\(\w)/g,t._getReplaceStr)},t.getBindFun=function(e){var n=t._funMap.get(e);if(null==n){var r='"'+e+'"',a="(function(data){if(data==null)return;with(data){try{\nreturn "+(r=r.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";n=i._runScript(a),t._funMap.set(e,n)}return n},n(t,["grayFilter",function(){return this.grayFilter=new l([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new C}]),t}(),D=function(){function t(){}return r(t,"UIConfig"),t.touchScrollEnable=!0,t.mouseWheelEnable=!0,t.showButtons=!0,t.popupBgColor="#000000",t.popupBgAlpha=.5,t.closeDialogOnSide=!0,t}(),A=function(t){function e(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,e.__super.call(this)}r(e,"laya.ui.AutoBitmap",t);var n=e.prototype;return n.destroy=function(){t.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},n._setChanged=function(){this._isChanged||(this._isChanged=!0,i.timer.callLater(this,this.changeSource))},n.changeSource=function(){this._isChanged=!1;var t=this._source;if(t&&t.bitmap){var i=this.width,n=this.height,r=this._sizeGrid,a=t.sourceWidth,s=t.sourceHeight;if(!r||a===i&&s===n)this.cleanByTexture(t,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,i,n);else{t.$_GID||(t.$_GID=w.getGID());var o=t.$_GID+"."+i+"."+n+"."+r.join(".");if(w.isOKCmdList(C.I.get(o)))return void(this.cmds=C.I.get(o));this.clear();var l=r[0],h=r[1],c=r[2],u=r[3],_=r[4],d=!1;if(i==a&&(u=h=0),n==s&&(l=c=0),u+h>i){var f=i;d=!0,i=u+h,this.save(),this.clipRect(0,0,f,n)}u&&l&&this.drawTexture(e.getTexture(t,0,0,u,l),0,0,u,l),h&&l&&this.drawTexture(e.getTexture(t,a-h,0,h,l),i-h,0,h,l),u&&c&&this.drawTexture(e.getTexture(t,0,s-c,u,c),0,n-c,u,c),h&&c&&this.drawTexture(e.getTexture(t,a-h,s-c,h,c),i-h,n-c,h,c),l&&this.drawBitmap(_,e.getTexture(t,u,0,a-u-h,l),u,0,i-u-h,l),c&&this.drawBitmap(_,e.getTexture(t,u,s-c,a-u-h,c),u,n-c,i-u-h,c),u&&this.drawBitmap(_,e.getTexture(t,0,l,u,s-l-c),0,l,u,n-l-c),h&&this.drawBitmap(_,e.getTexture(t,a-h,l,h,s-l-c),i-h,l,h,n-l-c),this.drawBitmap(_,e.getTexture(t,u,l,a-u-h,s-l-c),u,l,i-u-h,n-l-c),d&&this.restore(),this.autoCacheCmd&&!v.isConchApp&&C.I.set(o,this.cmds)}this._repaint()}},n.drawBitmap=function(t,e,i,n,r,a){void 0===r&&(r=0),void 0===a&&(a=0),r<.1||a<.1||(!t||e.width==r&&e.height==a?this.drawTexture(e,i,n,r,a):this.fillTexture(e,i,n,r,a))},n.clear=function(e){void 0===e&&(e=!0),t.prototype.clear.call(this,!1)},a(0,n,"sizeGrid",function(){return this._sizeGrid},function(t){this._sizeGrid=t,this._setChanged()}),a(0,n,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(t){this._width!=t&&(this._width=t,this._setChanged())}),a(0,n,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(t){this._height!=t&&(this._height=t,this._setChanged())}),a(0,n,"source",function(){return this._source},function(t){t?(this._source=t,this._setChanged()):(this._source=null,this.clear())}),e.getTexture=function(t,e,i,n,r){n<=0&&(n=1),r<=0&&(r=1),t.$_GID||(t.$_GID=w.getGID());var a=t.$_GID+"."+e+"."+i+"."+n+"."+r,s=C.I.get(a);return s&&s.source||(s=E.createFromTexture(t,e,i,n,r),C.I.set(a,s)),s},e}(d),R=(function(t){function e(){e.__super.call(this)}r(e,"laya.ui.UIEvent",c),e.SHOW_TIP="showtip",e.HIDE_TIP="hidetip"}(),function(t){function e(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,e.__super.call(this),this._layout=b.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}r(e,"laya.ui.Component",t);var n=e.prototype;return i.imps(n,{"laya.ui.IComponent":!0}),n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},n.preinitialize=function(){},n.createChildren=function(){},n.initialize=function(){},n.callLater=function(t,e){i.timer.callLater(this,t,e)},n.runCallLater=function(t){i.timer.runCallLater(this,t)},n.commitMeasure=function(){},n.changeSize=function(){this.event("resize")},n.getLayout=function(){return this._layout===b.EMPTY&&(this._layout=new b),this._layout},n._setLayoutEnabled=function(t){this._layout&&this._layout.enable!=t&&(this._layout.enable=t,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},n.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},n.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},n.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},n.resetLayoutX=function(){var t=this._layout;if(isNaN(t.anchorX)||(this.pivotX=t.anchorX*this.width),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerX)?isNaN(t.left)?isNaN(t.right)||(this.x=Math.round(e.width-this.displayWidth-t.right+this.pivotX*this.scaleX)):(this.x=Math.round(t.left+this.pivotX*this.scaleX),isNaN(t.right)||(this.width=(e._width-t.left-t.right)/(this.scaleX||.01))):this.x=Math.round(.5*(e.width-this.displayWidth)+t.centerX+this.pivotX*this.scaleX))}},n.resetLayoutY=function(){var t=this._layout;if(isNaN(t.anchorY)||(this.pivotY=t.anchorY*this.height),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerY)?isNaN(t.top)?isNaN(t.bottom)||(this.y=Math.round(e.height-this.displayHeight-t.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(t.top+this.pivotY*this.scaleY),isNaN(t.bottom)||(this.height=(e._height-t.top-t.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(e.height-this.displayHeight)+t.centerY+this.pivotY*this.scaleY))}},n.onMouseOver=function(t){i.stage.event("showtip",this._toolTip)},n.onMouseOut=function(t){i.stage.event("hidetip",this._toolTip)},a(0,n,"displayWidth",function(){return this.width*this.scaleX}),a(0,n,"width",function(){return this._width?this._width:this.measureWidth},function(t){this._width!=t&&(this._width=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),a(0,n,"measureWidth",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;e>-1;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.x+i.width*i.scaleX,t))}return t}),a(0,n,"displayHeight",function(){return this.height*this.scaleY}),a(0,n,"height",function(){return this._height?this._height:this.measureHeight},function(t){this._height!=t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),a(0,n,"dataSource",function(){return this._dataSource},function(t){for(var e in this._dataSource=t,this._dataSource)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=this._dataSource[e])}),a(0,n,"scaleY",t.prototype._$get_scaleY,function(t){i.superGet(S,this,"scaleY")!=t&&(i.superSet(S,this,"scaleY",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),a(0,n,"measureHeight",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;e>-1;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.y+i.height*i.scaleY,t))}return t}),a(0,n,"scaleX",t.prototype._$get_scaleX,function(t){i.superGet(S,this,"scaleX")!=t&&(i.superSet(S,this,"scaleX",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),a(0,n,"top",function(){return this._layout.top},function(t){t!=this._layout.top&&(this.getLayout().top=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),a(0,n,"bottom",function(){return this._layout.bottom},function(t){t!=this._layout.bottom&&(this.getLayout().bottom=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),a(0,n,"left",function(){return this._layout.left},function(t){t!=this._layout.left&&(this.getLayout().left=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),a(0,n,"right",function(){return this._layout.right},function(t){t!=this._layout.right&&(this.getLayout().right=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),a(0,n,"centerX",function(){return this._layout.centerX},function(t){t!=this._layout.centerX&&(this.getLayout().centerX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),a(0,n,"centerY",function(){return this._layout.centerY},function(t){t!=this._layout.centerY&&(this.getLayout().centerY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),a(0,n,"anchorX",function(){return this._layout.anchorX},function(t){t!=this._layout.anchorX&&(this.getLayout().anchorX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),a(0,n,"anchorY",function(){return this._layout.anchorY},function(t){t!=this._layout.anchorY&&(this.getLayout().anchorY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),a(0,n,"tag",function(){return this._tag},function(t){this._tag=t}),a(0,n,"toolTip",function(){return this._toolTip},function(t){this._toolTip!=t&&(this._toolTip=t,null!=t?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),a(0,n,"comXml",function(){return this._comXml},function(t){this._comXml=t}),a(0,n,"gray",function(){return this._gray},function(t){t!==this._gray&&(this._gray=t,I.gray(this,t))}),a(0,n,"disabled",function(){return this._disabled},function(t){t!==this._disabled&&(this.gray=this._disabled=t,this.mouseEnabled=!t)}),e}(S)),L=function(t){function e(){this.lockLayer=null,this.popupEffect=function(t){t.scale(1,1),T.from(t,{x:i.stage.width/2,y:i.stage.height/2,scaleX:0,scaleY:0},300,h.backOut,f.create(this,this.doOpen,[t]))},this.closeEffect=function(t,e){T.to(t,{x:i.stage.width/2,y:i.stage.height/2,scaleX:0,scaleY:0},300,h.strongOut,f.create(this,this.doClose,[t,e]))},e.__super.call(this),this.maskLayer=new S,this.popupEffectHandler=new f(this,this.popupEffect),this.closeEffectHandler=new f(this,this.closeEffect),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,i.stage.addChild(this),i.stage.on("resize",this,this._onResize),D.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}r(e,"laya.ui.DialogManager",S);var n=e.prototype;return n._closeOnSide=function(){var t=this.getChildAt(this.numChildren-1);t instanceof laya.ui.Dialog&&t.close("side")},n.setLockView=function(t){this.lockLayer||(this.lockLayer=new P,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(i.stage.width,i.stage.height)),this.lockLayer.removeChildren(),t&&(t.centerX=t.centerY=0,this.lockLayer.addChild(t))},n._onResize=function(t){var e=this.maskLayer.width=i.stage.width,n=this.maskLayer.height=i.stage.height;this.lockLayer&&this.lockLayer.size(e,n),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,e,n,D.popupBgColor),this.maskLayer.alpha=D.popupBgAlpha;for(var r=this.numChildren-1;r>-1;r--){var a=this.getChildAt(r);a.popupCenter&&this._centerDialog(a)}},n._centerDialog=function(t){t.x=Math.round((i.stage.width-t.width>>1)+t.pivotX),t.y=Math.round((i.stage.height-t.height>>1)+t.pivotY)},n.open=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),e&&this._closeAll(),t.popupCenter&&this._centerDialog(t),this.addChild(t),(t.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),i&&null!=t.popupEffect?t.popupEffect.runWith(t):this.doOpen(t),this.event("open")},n.doOpen=function(t){t.onOpened()},n.lock=function(t){this.lockLayer&&(t?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},n.close=function(t,e,i){void 0===i&&(i=!1),i&&null!=t.closeEffect?t.closeEffect.runWith([t,e]):this.doClose(t,e),this.event("close")},n.doClose=function(t,e){t.removeSelf(),t.isModal&&this._checkMask(),t.closeHandler&&t.closeHandler.runWith(e),t.onClosed(e)},n.closeAll=function(){this._closeAll(),this.event("close")},n._closeAll=function(){for(var t=this.numChildren-1;t>-1;t--){var e=this.getChildAt(t);e&&null!=e.close&&this.doClose(e)}},n.getDialogsByGroup=function(t){for(var e=[],i=this.numChildren-1;i>-1;i--){var n=this.getChildAt(i);n&&n.group===t&&e.push(n)}return e},n.closeByGroup=function(t){for(var e=[],i=this.numChildren-1;i>-1;i--){var n=this.getChildAt(i);n&&n.group===t&&(n.close(),e.push(n))}return e},n._checkMask=function(){this.maskLayer.removeSelf();for(var t=this.numChildren-1;t>-1;t--){var e=this.getChildAt(t);if(e&&e.isModal)return void this.addChildAt(this.maskLayer,t)}},e}(),P=function(t){function e(){e.__super.call(this)}r(e,"laya.ui.Box",t);var n=e.prototype;return i.imps(n,{"laya.ui.IBox":!0}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){for(var e in this._dataSource=t,t){var i=this.getChildByName(e);i?i.dataSource=t[e]:this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=t[e])}}),e}(R),N=function(t){function e(t,i){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,e.__super.call(this),this._labelColors=M.buttonLabelColors,this._stateNum=M.buttonStateNum,void 0===i&&(i=""),this.skin=t,this.label=i}r(e,"laya.ui.Button",t);var s=e.prototype;return i.imps(s,{"laya.ui.ISelect":!0}),s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(e),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},s.createChildren=function(){this.graphics=this._bitmap=new A},s.createText=function(){this._text||(this._text=new x,this._text.overflow=x.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},s.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},s.onMouse=function(t){if(!1!==this.toggle||!this._selected)return"click"===t.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=e.stateMap[t.type]))},s.changeClips=function(){var t=m.getRes(this._skin);if(t){var e=t.sourceWidth,i=t.sourceHeight/this._stateNum;t.$_GID||(t.$_GID=w.getGID());var n=t.$_GID+"-"+this._stateNum,r=C.I.get(n);if(w.isOkTextureList(r)||(r=null),r)this._sources=r;else{if(this._sources=[],1===this._stateNum)this._sources.push(t);else for(var a=0;a<this._stateNum;a++)this._sources.push(E.createFromTexture(t,0,i*a,e,i));C.I.set(n,this._sources)}this._autoSize?(this._bitmap.width=this._width||e,this._bitmap.height=this._height||i,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=e)}else console.log("lose skin",this._skin)},s.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]),this.label&&(this._text.color=this._labelColors[t],this._strokeColors&&(this._text.strokeColor=this._strokeColors[t]))},s._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},a(0,s,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(t){this.createText(),this._text.strokeColor=t}),a(0,s,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),a(0,s,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.callLater(this.changeClips),this._setStateChanged())}),a(0,s,"state",function(){return this._state},function(t){this._state!=t&&(this._state=t,this._setStateChanged())}),a(0,s,"text",function(){return this.createText(),this._text}),a(0,s,"stateNum",function(){return this._stateNum},function(t){"string"==typeof t&&(t=parseInt(t)),this._stateNum!=t&&(this._stateNum=t<1?1:t>3?3:t,this.callLater(this.changeClips))}),a(0,s,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(t){this._strokeColors=I.fillArray(M.buttonLabelColors,t,String),this._setStateChanged()}),a(0,s,"labelColors",function(){return this._labelColors.join(",")},function(t){this._labelColors=I.fillArray(M.buttonLabelColors,t,String),this._setStateChanged()}),a(0,s,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),a(0,s,"label",function(){return this._text?this._text.text:null},function(t){(this._text||t)&&(this.createText(),this._text.text!=t&&(t&&!this._text.parent&&this.addChild(this._text),this._text.text=(t+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),a(0,s,"selected",function(){return this._selected},function(t){this._selected!=t&&(this._selected=t,this.state=this._selected?2:0,this.event("change"))}),a(0,s,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(t){this.createText(),this._text.padding=I.fillArray(M.labelPadding,t,Number)}),a(0,s,"labelSize",function(){return this.createText(),this._text.fontSize},function(t){this.createText(),this._text.fontSize=t}),a(0,s,"labelStroke",function(){return this.createText(),this._text.stroke},function(t){this.createText(),this._text.stroke=t}),a(0,s,"labelBold",function(){return this.createText(),this._text.bold},function(t){this.createText(),this._text.bold=t}),a(0,s,"labelFont",function(){return this.createText(),this._text.font},function(t){this.createText(),this._text.font=t}),a(0,s,"labelAlign",function(){return this.createText(),this._text.align},function(t){this.createText(),this._text.align=t}),a(0,s,"clickHandler",function(){return this._clickHandler},function(t){this._clickHandler=t}),a(0,s,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=I.fillArray(M.defaultSizeGrid,t,Number)}),a(0,s,"width",t.prototype._$get_width,function(t){i.superSet(R,this,"width",t),this._autoSize&&(this._bitmap.width=t,this._text&&(this._text.width=t))}),a(0,s,"height",t.prototype._$get_height,function(t){i.superSet(R,this,"height",t),this._autoSize&&(this._bitmap.height=t,this._text&&(this._text.height=t))}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t||"string"==typeof t?this.label=t+"":i.superSet(R,this,"dataSource",t)}),a(0,s,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(t){this._bitmap._offset=t?I.fillArray([1,1],t,Number):[]}),n(e,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),e}(R),O=function(t){function e(t,i,n){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,e.__super.call(this),void 0===i&&(i=1),void 0===n&&(n=1),this._clipX=i,this._clipY=n,this.skin=t}r(e,"laya.ui.Clip",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},n.dispose=function(){this.destroy(!0),i.loader.clearRes(this._skin)},n.createChildren=function(){this.graphics=this._bitmap=new A},n._onDisplay=function(t){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},n.changeClip=function(){if(this._clipChanged=!1,this._skin){var t=m.getRes(this._skin);t?this.loadComplete(this._skin,t):i.loader.load(this._skin,f.create(this,this.loadComplete,[this._skin]))}},n.loadComplete=function(t,e){if(t===this._skin&&e){var i=this._clipWidth||Math.ceil(e.sourceWidth/this._clipX),n=this._clipHeight||Math.ceil(e.sourceHeight/this._clipY),r=this._skin+i+n,a=C.I.get(r);if(w.isOkTextureList(a)||(a=null),a)this._sources=a;else{this._sources=[];for(var s=0;s<this._clipY;s++)for(var o=0;o<this._clipX;o++)this._sources.push(E.createFromTexture(e,i*o,n*s,i,n));C.I.set(r,this._sources)}this.index=this._index,this.event("loaded"),this.onCompResize()}},n.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),this._isPlaying=!0,this.index=t,this._toIndex=e,this._index++,i.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},n._loop=function(){this._style.visible&&this._sources&&(this._index++,this._toIndex>-1&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},n.stop=function(){this._isPlaying=!1,i.timer.clear(this,this._loop),this.event("complete")},n._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},a(0,n,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._interval=t,this._isPlaying&&this.play())}),a(0,n,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,t?this._setClipChanged():this._bitmap.source=null)}),a(0,n,"sources",function(){return this._sources},function(t){this._sources=t,this.index=this._index,this.event("loaded")}),a(0,n,"clipX",function(){return this._clipX},function(t){this._clipX=t||1,this._setClipChanged()}),a(0,n,"clipY",function(){return this._clipY},function(t){this._clipY=t||1,this._setClipChanged()}),a(0,n,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),a(0,n,"clipWidth",function(){return this._clipWidth},function(t){this._clipWidth=t,this._setClipChanged()}),a(0,n,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=I.fillArray(M.defaultSizeGrid,t,Number)}),a(0,n,"group",function(){return this._group},function(t){t&&this._skin&&m.setGroup(this._skin,t),this._group=t}),a(0,n,"clipHeight",function(){return this._clipHeight},function(t){this._clipHeight=t,this._setClipChanged()}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(R,this,"width",t),this._bitmap.width=t}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(R,this,"height",t),this._bitmap.height=t}),a(0,n,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),a(0,n,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),a(0,n,"index",function(){return this._index},function(t){this._index=t,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]),this.event("change")}),a(0,n,"autoPlay",function(){return this._autoPlay},function(t){this._autoPlay!=t&&(this._autoPlay=t,t?this.play():this.stop())}),a(0,n,"isPlaying",function(){return this._isPlaying},function(t){this._isPlaying=t}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t&&Math.floor(t)==t||"string"==typeof t?this.index=parseInt(t):i.superSet(R,this,"dataSource",t)}),a(0,n,"bitmap",function(){return this._bitmap}),e}(R),V=function(t){function e(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,e.__super.call(this)}r(e,"laya.ui.ColorPicker",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._colorPanel&&this._colorPanel.destroy(e),this._colorButton&&this._colorButton.destroy(e),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},n.createChildren=function(){this.addChild(this._colorButton=new N),this._colorPanel=new P,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new S),this._colorPanel.addChild(this._colorBlock=new S),this._colorPanel.addChild(this._colorInput=new p)},n.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},n.onPanelMouseDown=function(t){t.stopPropagation()},n.changePanel=function(){this._panelChanged=!1;var t=this._colorPanel.graphics;t.clear(),t.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(t=this._colorTiles.graphics).clear();for(var e=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],i=0;i<12;i++)for(var n=0;n<20;n++){var r;r=0===n?e[i]:1===n?0:51*(((3*i+n/6)%3<<0)+3*(i/6<<0))<<16|n%6*51<<8|(i<<0)%6*51;var a=I.toColor(r);this._colors.push(a);var s=n*this._gridSize,o=i*this._gridSize;t.drawRect(s,o,this._gridSize,this._gridSize,a,"#000000")}},n.onColorButtonClick=function(t){this._colorPanel.parent?this.close():this.open()},n.open=function(){var t=this.localToGlobal(new g),e=t.x+this._colorPanel.width<=i.stage.width?t.x:i.stage.width-this._colorPanel.width,n=t.y+this._colorButton.height;n=n+this._colorPanel.height<=i.stage.height?n:t.y-this._colorPanel.height,this._colorPanel.pos(e,n),this._colorPanel.zOrder=1001,i._currentStage.addChild(this._colorPanel),i.stage.on("mousedown",this,this.removeColorBox)},n.close=function(){i.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},n.removeColorBox=function(t){this.close()},n.onColorFieldKeyDown=function(t){13==t.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),t.stopPropagation())},n.onColorInputChange=function(t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},n.onColorTilesClick=function(t){this.selectedColor=this.getColorByMouse(),this.close()},n.onColorTilesMouseMove=function(t){this._colorInput.focus=!1;var e=this.getColorByMouse();this._colorInput.text=e,this.drawBlock(e)},n.getColorByMouse=function(){var t=this._colorTiles.getMousePoint(),e=Math.floor(t.x/this._gridSize),i=Math.floor(t.y/this._gridSize);return this._colors[20*i+e]},n.drawBlock=function(t){var e=this._colorBlock.graphics;e.clear();var i=t||"#ffffff";e.drawRect(0,0,50,20,i,this._borderColor),t||e.drawLine(0,0,50,20,"#ff0000")},n.changeColor=function(){var t=this.graphics;t.clear();var e=this._selectedColor||"#000000";t.drawRect(0,0,this._colorButton.width,this._colorButton.height,e)},n._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},a(0,n,"inputBgColor",function(){return this._inputBgColor},function(t){this._inputBgColor=t,this._setPanelChanged()}),a(0,n,"selectedColor",function(){return this._selectedColor},function(t){this._selectedColor!=t&&(this._selectedColor=this._colorInput.text=t,this.drawBlock(t),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",c.EMPTY.setTo("change",this,this)))}),a(0,n,"skin",function(){return this._colorButton.skin},function(t){this._colorButton.skin=t,this.changeColor()}),a(0,n,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this._setPanelChanged()}),a(0,n,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t,this._setPanelChanged()}),a(0,n,"inputColor",function(){return this._inputColor},function(t){this._inputColor=t,this._setPanelChanged()}),e}(R),k=function(t){function e(t,i){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,e.__super.call(this),this._itemColors=M.comboBoxItemColors,this.skin=t,this.labels=i}r(e,"laya.ui.ComboBox",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._button&&this._button.destroy(e),this._list&&this._list.destroy(e),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},n.createChildren=function(){this.addChild(this._button=new N),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},n._createList=function(){this._list=new j,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},n._setListEvent=function(t){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=f.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},n.onListDown=function(t){t.stopPropagation()},n.onScrollBarDown=function(t){t.stopPropagation()},n.onButtonMouseDown=function(t){this.callLater(this.switchTo,[!this._isOpen])},n.changeList=function(){this._listChanged=!1;var t=this.width-2,e=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:e}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},n.onlistItemMouse=function(t,e){var i=t.type;if("mouseover"===i||"mouseout"===i){if(this._isCustomList)return;var n=this._list.getCell(e);if(!n)return;var r=n.getChildByName("label");r&&("mouseover"===i?(r.bgColor=this._itemColors[0],r.color=this._itemColors[1]):(r.bgColor=null,r.color=this._itemColors[2]))}else"click"===i&&(this.selectedIndex=e,this.isOpen=!1)},n.switchTo=function(t){this.isOpen=t},n.changeOpen=function(){this.isOpen=!this._isOpen},n.changeItem=function(){if(this._itemChanged=!1,this._listHeight=this._labels.length>0?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var t=this._list.graphics;t.clear(),t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}var e=this._list.array||[];e.length=0;for(var i=0,n=this._labels.length;i<n;i++)e.push({label:this._labels[i]});this._list.height=this._listHeight,this._list.array=e},n.changeSelected=function(){this._button.label=this.selectedLabel},n._onStageMouseWheel=function(t){this._list&&!this._list.contains(t.target)&&this.removeList(null)},n.removeList=function(t){i.stage.off("mousedown",this,this.removeList),i.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},a(0,n,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this._labels.length>0?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[c.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),a(0,n,"measureHeight",function(){return this._button.height}),a(0,n,"skin",function(){return this._button.skin},function(t){this._button.skin!=t&&(this._button.skin=t,this._listChanged=!0)}),a(0,n,"measureWidth",function(){return this._button.width}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(R,this,"width",t),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),a(0,n,"selectedLabel",function(){return this._selectedIndex>-1&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(t){this.selectedIndex=this._labels.indexOf(t)}),a(0,n,"labels",function(){return this._labels.join(",")},function(t){this._labels.length>0&&(this.selectedIndex=-1),t?this._labels=t.split(","):this._labels.length=0,this._itemChanged=!0}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(R,this,"height",t),this._button.height=this._height}),a(0,n,"selectHandler",function(){return this._selectHandler},function(t){this._selectHandler=t}),a(0,n,"visibleNum",function(){return this._visibleNum},function(t){this._visibleNum=t,this._listChanged=!0}),a(0,n,"labelBold",function(){return this._button.text.bold},function(t){this._button.text.bold=t}),a(0,n,"itemColors",function(){return String(this._itemColors)},function(t){this._itemColors=I.fillArray(this._itemColors,t,String),this._listChanged=!0}),a(0,n,"itemSize",function(){return this._itemSize},function(t){this._itemSize=t,this._listChanged=!0}),a(0,n,"scrollBar",function(){return this.list.scrollBar}),a(0,n,"isOpen",function(){return this._isOpen},function(t){if(this._isOpen!=t)if(this._isOpen=t,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var e=this.localToGlobal(g.TEMP.setTo(0,0)),n=e.y+this._button.height;n=n+this._listHeight<=i.stage.height?n:e.y-this._listHeight,this._list.pos(e.x,n),this._list.zOrder=1001,i._currentStage.addChild(this._list),i.stage.once("mousedown",this,this.removeList),i.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),a(0,n,"scrollBarSkin",function(){return this._scrollBarSkin},function(t){this._scrollBarSkin=t}),a(0,n,"sizeGrid",function(){return this._button.sizeGrid},function(t){this._button.sizeGrid=t}),a(0,n,"button",function(){return this._button}),a(0,n,"list",function(){return this._list||this._createList(),this._list},function(t){t&&(t.removeSelf(),this._isCustomList=!0,this._list=t,this._setListEvent(t),this._itemHeight=t.getCell(0).height+t.spaceY)}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):i.superSet(R,this,"dataSource",t)}),a(0,n,"labelColors",function(){return this._button.labelColors},function(t){this._button.labelColors!=t&&(this._button.labelColors=t)}),a(0,n,"labelPadding",function(){return this._button.text.padding.join(",")},function(t){this._button.text.padding=I.fillArray(M.labelPadding,t,Number)}),a(0,n,"labelSize",function(){return this._button.text.fontSize},function(t){this._button.text.fontSize=t}),a(0,n,"labelFont",function(){return this._button.text.font},function(t){this._button.text.font=t}),a(0,n,"stateNum",function(){return this._button.stateNum},function(t){this._button.stateNum=t}),e}(R),F=function(t){function e(t){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,e.__super.call(this),this._showButtons=D.showButtons,this._touchScrollEnable=D.touchScrollEnable,this._mouseWheelEnable=D.mouseWheelEnable,this.skin=t,this.max=1}r(e,"laya.ui.ScrollBar",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),this.stopScroll(),this.target=null,t.prototype.destroy.call(this,e),this.upButton&&this.upButton.destroy(e),this.downButton&&this.downButton.destroy(e),this.slider&&this.slider.destroy(e),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},n.createChildren=function(){this.addChild(this.slider=new B),this.addChild(this.upButton=new N),this.addChild(this.downButton=new N)},n.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},n.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},n.onButtonMouseDown=function(t){var e=t.currentTarget===this.upButton;this.slide(e),i.timer.once(M.scrollBarDelayTime,this,this.startLoop,[e]),i.stage.once("mouseup",this,this.onStageMouseUp)},n.startLoop=function(t){i.timer.frameLoop(1,this,this.slide,[t])},n.slide=function(t){t?this.value-=this._scrollSize:this.value+=this._scrollSize},n.onStageMouseUp=function(t){i.timer.clear(this,this.startLoop),i.timer.clear(this,this.slide)},n.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},n.changeSize=function(){t.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},n.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},n.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},n.setScroll=function(t,e,i){this.runCallLater(this.changeSize),this.slider.setSlider(t,e,i),this.slider.bar.visible=e>0,!this._hide&&this.autoHide&&(this.visible=!1)},n.onTargetMouseWheel=function(t){this.value-=t.delta*this._scrollSize,this.target=this._target},n.onTargetMouseDown=function(t){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new g),this._lastPoint.setTo(i.stage.mouseX,i.stage.mouseY),i.timer.clear(this,this.tweenMove),T.clearTween(this),i.stage.once("mouseup",this,this.onStageMouseUp2),i.stage.once("mouseout",this,this.onStageMouseUp2),i.timer.frameLoop(1,this,this.loop)},n.loop=function(){var t=i.stage.mouseY,e=i.stage.mouseX;if(this._lastOffset=this.isVertical?t-this._lastPoint.y:e-this._lastPoint.x,this._clickOnly){if(!(Math.abs(this._lastOffset*(this.isVertical?i.stage._canvasTransform.getScaleY():i.stage._canvasTransform.getScaleX()))>1))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=e,this._lastPoint.y=t,0!==this._lastOffset&&(this._checkElastic||(this.elasticDistance>0?this._checkElastic||0==this._lastOffset||(this._lastOffset>0&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},n.onStageMouseUp2=function(t){if(i.stage.off("mouseup",this,this.onStageMouseUp2),i.stage.off("mouseout",this,this.onStageMouseUp2),i.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?T.to(this,{value:this.min},this.elasticBackTime,h.sineOut,f.create(this,this.elasticOver)):this._value>this.max&&T.to(this,{value:this.max},this.elasticBackTime,h.sineOut,f.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?i.stage.mouseY-this._lastPoint.y:i.stage.mouseX-this._lastPoint.x);for(var e=0,n=Math.min(this._offsets.length,3),r=0;r<n;r++)e+=this._offsets[this._offsets.length-1-r];if(this._lastOffset=e/n,(e=Math.abs(this._lastOffset))<2)return void this.event("end");e>60&&(this._lastOffset=this._lastOffset>0?60:-60);var a=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));i.timer.frameLoop(1,this,this.tweenMove,[a])}},n.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&T.to(this,{alpha:0},500),this.event("end")},n.tweenMove=function(t){this._lastOffset*=this.rollRatio;var e=NaN;if(t>0&&(this._lastOffset>0&&this.value<=this.min?(this._isElastic=!0,e=.5*-(this.min-t-this.value),this._lastOffset>e&&(this._lastOffset=e)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,e=.5*-(this.max+t-this.value),this._lastOffset<e&&(this._lastOffset=e))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(i.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?T.to(this,{value:this.min},this.elasticBackTime,h.sineOut,f.create(this,this.elasticOver)):this._value>this.max?T.to(this,{value:this.max},this.elasticBackTime,h.sineOut,f.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&T.to(this,{alpha:0},500)}},n.stopScroll=function(){this.onStageMouseUp2(null),i.timer.clear(this,this.tweenMove),T.clearTween(this)},a(0,n,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),a(0,n,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),a(0,n,"max",function(){return this.slider.max},function(t){this.slider.max=t}),a(0,n,"showButtons",function(){return this._showButtons},function(t){this._showButtons=t,this.callLater(this.changeScrollBar)}),a(0,n,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),a(0,n,"min",function(){return this.slider.min},function(t){this.slider.min=t}),a(0,n,"value",function(){return this._value},function(t){t!==this._value&&(this._value=t,this._isElastic||(this.slider._value!=t&&(this.slider._value=t,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),a(0,n,"isVertical",function(){return this.slider.isVertical},function(t){this.slider.isVertical=t}),a(0,n,"sizeGrid",function(){return this.slider.sizeGrid},function(t){this.slider.sizeGrid=t}),a(0,n,"scrollSize",function(){return this._scrollSize},function(t){this._scrollSize=t}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t||"string"==typeof t?this.value=Number(t):i.superSet(R,this,"dataSource",t)}),a(0,n,"thumbPercent",function(){return this._thumbPercent},function(t){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),t=t>=1?.99:t,this._thumbPercent=t,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*t,M.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*t,M.scrollBarMinNum))}),a(0,n,"target",function(){return this._target},function(t){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),this._target=t,t&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),a(0,n,"hide",function(){return this._hide},function(t){this._hide=t,this.visible=!t}),a(0,n,"touchScrollEnable",function(){return this._touchScrollEnable},function(t){this._touchScrollEnable=t,this.target=this._target}),a(0,n,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(t){this._mouseWheelEnable=t}),a(0,n,"tick",function(){return this.slider.tick},function(t){this.slider.tick=t}),e}(R),B=function(t){function e(t){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,e.__super.call(this),this.skin=t}r(e,"laya.ui.Slider",t);var s=e.prototype;return s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._progress&&this._progress.destroy(e),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},s.createChildren=function(){this.addChild(this._bg=new U),this.addChild(this._bar=new N)},s.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},s.onBarMouseDown=function(t){this._globalSacle||(this._globalSacle=new g),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=i.stage.mouseX,this._ty=i.stage.mouseY,i.stage.on("mousemove",this,this.mouseMove),i.stage.once("mouseup",this,this.mouseUp),i.stage.once("mouseout",this,this.mouseUp),this.showValueText()},s.showValueText=function(){if(this.showLabel){var t=laya.ui.Slider.label;this.addChild(t),t.textField.changeText(this._value+""),this.isVertical?(t.x=this._bar.x+20,t.y=.5*(this._bar.height-t.height)+this._bar.y):(t.y=this._bar.y-20,t.x=.5*(this._bar.width-t.width)+this._bar.x)}},s.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},s.mouseUp=function(t){i.stage.off("mousemove",this,this.mouseMove),i.stage.off("mouseup",this,this.mouseUp),i.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},s.mouseMove=function(t){var e=this._value;this.isVertical?(this._bar.y+=(i.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(i.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=i.stage.mouseX,this._ty=i.stage.mouseY;var n=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*n)/n,this._value!=e&&this.sendChangeEvent(),this.showValueText()},s.sendChangeEvent=function(t){void 0===t&&(t="change"),this.event(t),this.changeHandler&&this.changeHandler.runWith(this._value)},s.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},s.changeSize=function(){t.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},s.setSlider=function(t,e,i){this._value=-1,this._min=t,this._max=e>t?e:t,this.value=i<t?t:i>e?e:i},s.changeValue=function(){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var e=this._max-this._min;0===e&&(e=1),this.isVertical?(this._bar.y=(this._value-this._min)/e*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/e*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},s.onBgMouseDown=function(t){var e=this._bg.getMousePoint();this.isVertical?this.value=e.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=e.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},a(0,s,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),a(0,s,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var e=this._skin.replace(".png","$progress.png");m.getRes(e)&&(this._progress||(this.addChild(this._progress=new U),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=e),this.setBarPoint(),this.callLater(this.changeValue)}}),a(0,s,"allowClickBack",function(){return this._allowClickBack},function(t){this._allowClickBack!=t&&(this._allowClickBack=t,t?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),a(0,s,"max",function(){return this._max},function(t){this._max!=t&&(this._max=t,this.callLater(this.changeValue))}),a(0,s,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),a(0,s,"tick",function(){return this._tick},function(t){this._tick!=t&&(this._tick=t,this.callLater(this.changeValue))}),a(0,s,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=t,this._bar.sizeGrid=t,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),a(0,s,"min",function(){return this._min},function(t){this._min!=t&&(this._min=t,this.callLater(this.changeValue))}),a(0,s,"value",function(){return this._value},function(t){if(this._value!=t){var e=this._value;this._value=t,this.changeValue(),this._value!=e&&this.sendChangeEvent()}}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t||"string"==typeof t?this.value=Number(t):i.superSet(R,this,"dataSource",t)}),a(0,s,"bar",function(){return this._bar}),n(e,["label",function(){return this.label=new H}]),e}(R),U=function(t){function e(t){this._bitmap=null,this._skin=null,this._group=null,e.__super.call(this),this.skin=t}r(e,"laya.ui.Image",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null},n.dispose=function(){this.destroy(!0),i.loader.clearRes(this._skin)},n.createChildren=function(){this.graphics=this._bitmap=new A,this._bitmap.autoCacheCmd=!1},n.setSource=function(t,e){t===this._skin&&e&&(this.source=e,this.onCompResize())},a(0,n,"source",function(){return this._bitmap.source},function(t){this._bitmap&&(this._bitmap.source=t,this.event("loaded"),this.repaint())}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"string"==typeof t?this.skin=t:i.superSet(R,this,"dataSource",t)}),a(0,n,"measureHeight",function(){return this._bitmap.height}),a(0,n,"skin",function(){return this._skin},function(t){if(this._skin!=t)if(this._skin=t,t){var e=m.getRes(t);e?(this.source=e,this.onCompResize()):i.loader.load(this._skin,f.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),a(0,n,"group",function(){return this._group},function(t){t&&this._skin&&m.setGroup(this._skin,t),this._group=t}),a(0,n,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=I.fillArray(M.defaultSizeGrid,t,Number)}),a(0,n,"measureWidth",function(){return this._bitmap.width}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(R,this,"width",t),this._bitmap.width=0==t?1e-7:t}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(R,this,"height",t),this._bitmap.height=0==t?1e-7:t}),e}(R),H=function(t){function e(t){this._tf=null,e.__super.call(this),void 0===t&&(t=""),u.defaultColor=M.labelColor,this.text=t}r(e,"laya.ui.Label",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._tf=null},n.createChildren=function(){this.addChild(this._tf=new x)},n.changeText=function(t){this._tf.changeText(t)},a(0,n,"padding",function(){return this._tf.padding.join(",")},function(t){this._tf.padding=I.fillArray(M.labelPadding,t,Number)}),a(0,n,"bold",function(){return this._tf.bold},function(t){this._tf.bold=t}),a(0,n,"align",function(){return this._tf.align},function(t){this._tf.align=t}),a(0,n,"text",function(){return this._tf.text},function(t){this._tf.text!=t&&(t&&(t=I.adptString(t+"")),this._tf.text=t,this.event("change"),this._width&&this._height||this.onCompResize())}),a(0,n,"italic",function(){return this._tf.italic},function(t){this._tf.italic=t}),a(0,n,"wordWrap",function(){return this._tf.wordWrap},function(t){this._tf.wordWrap=t}),a(0,n,"font",function(){return this._tf.font},function(t){this._tf.font=t}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t||"string"==typeof t?this.text=t+"":i.superSet(R,this,"dataSource",t)}),a(0,n,"color",function(){return this._tf.color},function(t){this._tf.color=t}),a(0,n,"valign",function(){return this._tf.valign},function(t){this._tf.valign=t}),a(0,n,"leading",function(){return this._tf.leading},function(t){this._tf.leading=t}),a(0,n,"fontSize",function(){return this._tf.fontSize},function(t){this._tf.fontSize=t}),a(0,n,"bgColor",function(){return this._tf.bgColor},function(t){this._tf.bgColor=t}),a(0,n,"borderColor",function(){return this._tf.borderColor},function(t){this._tf.borderColor=t}),a(0,n,"stroke",function(){return this._tf.stroke},function(t){this._tf.stroke=t}),a(0,n,"strokeColor",function(){return this._tf.strokeColor},function(t){this._tf.strokeColor=t}),a(0,n,"textField",function(){return this._tf}),a(0,n,"measureWidth",function(){return this._tf.width}),a(0,n,"measureHeight",function(){return this._tf.height}),a(0,n,"width",function(){return this._width||this._tf.text?i.superGet(R,this,"width"):0},function(t){i.superSet(R,this,"width",t),this._tf.width=t}),a(0,n,"height",function(){return this._height||this._tf.text?i.superGet(R,this,"height"):0},function(t){i.superSet(R,this,"height",t),this._tf.height=t}),a(0,n,"overflow",function(){return this._tf.overflow},function(t){this._tf.overflow=t}),a(0,n,"underline",function(){return this._tf.underline},function(t){this._tf.underline=t}),a(0,n,"underlineColor",function(){return this._tf.underlineColor},function(t){this._tf.underlineColor=t}),e}(R),G=function(t){function e(t){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,e.__super.call(this),this.skin=t}r(e,"laya.ui.ProgressBar",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._bg=this._bar=null,this.changeHandler=null},n.createChildren=function(){this.addChild(this._bg=new U),this.addChild(this._bar=new U),this._bar._bitmap.autoCacheCmd=!1},n.changeValue=function(){if(this.sizeGrid){var t=this.sizeGrid.split(","),e=Number(t[3]),i=Number(t[1]),n=(this.width-e-i)*this._value;this._bar.width=e+i+n,this._bar.visible=this._bar.width>e+i}else this._bar.width=this.width*this._value},a(0,n,"measureHeight",function(){return this._bg.height}),a(0,n,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),a(0,n,"measureWidth",function(){return this._bg.width}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(R,this,"height",t),this._bg.height=this._height,this._bar.height=this._height}),a(0,n,"bar",function(){return this._bar}),a(0,n,"value",function(){return this._value},function(t){this._value!=t&&(t=t>1?1:t<0?0:t,this._value=t,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(t))}),a(0,n,"bg",function(){return this._bg}),a(0,n,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=this._bar.sizeGrid=t}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(R,this,"width",t),this._bg.width=this._width,this.callLater(this.changeValue)}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t||"string"==typeof t?this.value=Number(t):i.superSet(R,this,"dataSource",t)}),e}(R),W=(function(t){function e(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,e.__super.call(this),this._tipBox=new R,this._tipBox.addChild(this._tipText=new x),this._tipText.x=this._tipText.y=5,this._tipText.color=e.tipTextColor,this._defaultTipHandler=this._showDefaultTip,i.stage.on("showtip",this,this._onStageShowTip),i.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}r(e,"laya.ui.TipManager",R);var n=e.prototype;n._onStageHideTip=function(t){i.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},n._onStageShowTip=function(t){i.timer.once(e.tipDelay,this,this._showTip,[t],!0)},n._showTip=function(t){if("string"==typeof t){var e=String(t);Boolean(e)&&this._defaultTipHandler(e)}else t instanceof laya.utils.Handler?t.run():"function"==typeof t&&t.apply();i.stage.on("mousemove",this,this._onStageMouseMove),i.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},n._onStageMouseDown=function(t){this.closeAll()},n._onStageMouseMove=function(t){this._showToStage(this,e.offsetX,e.offsetY)},n._showToStage=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var r=t.getBounds();t.x=i.stage.mouseX+e,t.y=i.stage.mouseY+n,t.x+r.width>i.stage.width&&(t.x-=r.width+e),t.y+r.height>i.stage.height&&(t.y-=r.height+n)},n.closeAll=function(){i.timer.clear(this,this._showTip),i.stage.off("mousemove",this,this._onStageMouseMove),i.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},n.showDislayTip=function(t){this.addChild(t),this._showToStage(this),i._currentStage.addChild(this)},n._showDefaultTip=function(t){this._tipText.text=t;var n=this._tipBox.graphics;n.clear(),n.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,e.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),i._currentStage.addChild(this)},a(0,n,"defaultTipHandler",function(){return this._defaultTipHandler},function(t){this._defaultTipHandler=t}),e.offsetX=10,e.offsetY=15,e.tipTextColor="#ffffff",e.tipBackColor="#111111",e.tipDelay=200}(),function(t){function e(){this._idMap=null,this._aniList=null,this._watchMap={},e.__super.call(this)}var a;r(e,"laya.ui.View",P);var l=e.prototype;return l.createView=function(t){if(t.animations&&!this._idMap&&(this._idMap={}),e.createComp(t,this,this),t.animations){var i,n,r=[],a=t.animations,s=0,o=a.length;for(s=0;s<o;s++){switch(i=new _,n=a[s],i._setUp(this._idMap,n),this[n.name]=i,i._setControlNode(this),n.action){case 1:i.play(0,!1);break;case 2:i.play(0,!0)}r.push(i)}this._aniList=r}this._width>0&&null==t.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},l.onEvent=function(t,e){},l.loadUI=function(t){var i=e.uiMap[t];i&&this.createView(i)},l.destroy=function(t){void 0===t&&(t=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,t)},l.changeData=function(t){var e=this._watchMap[t];if(e){console.log("change",t);for(var i=0,n=e.length;i<n;i++)e[i].exe(this)}},e._regs=function(){for(var t in e.uiClassMap)o.regClass(t,e.uiClassMap[t])},e.createComp=function(t,n,r,a){if(!(n=n||e.getCompInstance(t)))return console.warn("can not create:"+t.type),null;var s=t.child;if(s)for(var l=n instanceof laya.ui.List,h=0,c=s.length;h<c;h++){var u=s[h];if(!n.hasOwnProperty("itemRender")||"render"!=u.props.name&&"render"!==u.props.renderType)if("Graphic"==u.type)o.addGraphicsToSprite(u,n);else if(o.isDrawType(u.type))o.addGraphicToSprite(u,n,!0);else{if(l){var _=[],d=e.createComp(u,null,r,_);_.length&&(d._$bindData=_)}else d=e.createComp(u,null,r,a);"Script"==u.type?"owner"in d?d.owner=n:"target"in d&&(d.target=n):"mask"==u.props.renderType||"mask"==u.props.name?n.mask=d:d instanceof laya.display.Sprite&&n.addChild(d)}else n.itemRender=u}var f=t.props;for(var p in f){var m=f[p];e.eventDic[p]?m&&r&&n.on(p,r,r.onEvent,[m]):e.setCompValue(n,p,m,r,a)}return i.__typeof(n,"laya.ui.IItem")&&n.initItems(),t.compId&&r&&r._idMap&&(r._idMap[t.compId]=n),n},e.setCompValue=function(t,n,r,s,l){if("string"==typeof r&&r.indexOf("${")>-1){if(e._sheet||(e._sheet=o.getClass("laya.data.Table")),!e._sheet)return void console.warn("Can not find class Sheet");if(l)l.push(t,n,r);else if(s){-1==r.indexOf("].")&&(r=r.replace(".","[0]."));var h=new a(t,n,r);h.exe(s);for(var c,u,_=r.replace(/\[.*?\]\./g,".");null!=(c=e._parseWatchData.exec(_));){for(var d=c[1];null!=(u=e._parseKeyWord.exec(d));){var f=u[0],p=s._watchMap[f]||(s._watchMap[f]=[]);p.push(h),e._sheet.I.notifer.on(f,s,s.changeData,[f])}(p=s._watchMap[d]||(s._watchMap[d]=[])).push(h),e._sheet.I.notifer.on(d,s,s.changeData,[d])}}}else if("var"===n&&s)s[r]=t;else if("onClick"==n){var m=i._runScript("(function(){"+r+"})");t.on("click",s,m)}else t[n]="true"===r||"false"!==r&&r},e.getCompInstance=function(t){var n,r=t.props?t.props.runtime:null;return n=r?e.viewClassMap[r]||e.uiClassMap[r]||i.__classmap[r]:e.uiClassMap[t.type],t.props&&t.props.hasOwnProperty("renderType")&&"instance"==t.props.renderType?n.instance:n?new n:null},e.regComponent=function(t,i){e.uiClassMap[t]=i,o.regClass(t,i)},e.regViewRuntime=function(t,i){e.viewClassMap[t]=i},e.uiMap={},e.viewClassMap={},e._sheet=null,n(e,["uiClassMap",function(){return this.uiClassMap={ViewStack:tt,LinkButton:N,TextArea:ht,ColorPicker:V,Box:P,Button:N,CheckBox:z,Clip:O,ComboBox:k,Component:R,HScrollBar:K,HSlider:Z,Image:U,Label:H,List:j,Panel:q,ProgressBar:G,Radio:$,RadioGroup:ot,ScrollBar:F,Slider:B,Tab:lt,TextInput:it,View:e,VScrollBar:et,VSlider:nt,Tree:J,HBox:at,VBox:st,Sprite:S,Animation:s,Text:x,FontClip:X}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),e.__init$=function(){e._regs(),a=function(){function t(t,e,i){this.comp=null,this.prop=null,this.value=null,this.comp=t,this.prop=e,this.value=i}return r(t,""),t.prototype.exe=function(t){var e=I.getBindFun(this.value);this.comp[this.prop]=e.call(this,t)},t}()},e}()),z=function(t){function e(t,i){void 0===i&&(i=""),e.__super.call(this,t,i)}r(e,"laya.ui.CheckBox",t);var n=e.prototype;return n.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},n.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"boolean"==typeof t?this.selected=t:"string"==typeof t?this.selected="true"===t:i.superSet(N,this,"dataSource",t)}),e}(N),Y=function(t){function e(){this._space=0,this._align="none",this._itemChanged=!1,e.__super.call(this)}r(e,"laya.ui.LayoutBox",P);var i=e.prototype;return i.addChild=function(t){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,t)},i.onResize=function(t){this._setItemChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,t)},i.refresh=function(){this._setItemChanged()},i.changeItems=function(){this._itemChanged=!1},i.sortItem=function(t){t&&t.sort(function(t,e){return t.y-e.y})},i._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},a(0,i,"space",function(){return this._space},function(t){this._space=t,this._setItemChanged()}),a(0,i,"align",function(){return this._align},function(t){this._align=t,this._setItemChanged()}),e}(),X=function(t){function e(t,i){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,e.__super.call(this),t&&(this.skin=t),i&&(this.sheet=i)}r(e,"laya.ui.FontClip",t);var n=e.prototype;return n.createChildren=function(){this._bitmap=new A,this.on("loaded",this,this._onClipLoaded)},n._onClipLoaded=function(){this.callLater(this.changeValue)},n.changeValue=function(){var t;if(this._sources&&this._valueArr&&(this.graphics.clear(!0),t=this._sources[0])){var e="horizontal"===this._direction;e?(this._wordsW=this._valueArr.length*(t.sourceWidth+this.spaceX),this._wordsH=t.sourceHeight):(this._wordsW=t.sourceWidth,this._wordsH=(t.sourceHeight+this.spaceY)*this._valueArr.length);var i=0;if(this._width)switch(this._align){case"center":i=.5*(this._width-this._wordsW);break;case"right":i=this._width-this._wordsW;break;default:i=0}for(var n=0,r=this._valueArr.length;n<r;n++){var a=this._indexMap[this._valueArr.charAt(n)];this.sources[a]&&(t=this.sources[a],e?this.graphics.drawTexture(t,i+n*(t.sourceWidth+this.spaceX),0,t.sourceWidth,t.sourceHeight):this.graphics.drawTexture(t,0+i,n*(t.sourceHeight+this.spaceY),t.sourceWidth,t.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},n.destroy=function(e){void 0===e&&(e=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),t.prototype.destroy.call(this,e)},a(0,n,"sheet",function(){return this._sheet},function(t){t+="",this._sheet=t;var e=t.split(" ");this._clipX=String(e[0]).length,this.clipY=e.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var n=e[i].split(""),r=0,a=n.length;r<a;r++)this._indexMap[n[r]]=i*this._clipX+r}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(O,this,"height",t),this.callLater(this.changeValue)}),a(0,n,"direction",function(){return this._direction},function(t){this._direction=t,this.callLater(this.changeValue)}),a(0,n,"value",function(){return this._valueArr?this._valueArr:""},function(t){t+="",this._valueArr=t,this.callLater(this.changeValue)}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(O,this,"width",t),this.callLater(this.changeValue)}),a(0,n,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,"horizontal"===this._direction&&this.callLater(this.changeValue)}),a(0,n,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),a(0,n,"align",function(){return this._align},function(t){this._align=t,this.callLater(this.changeValue)}),a(0,n,"measureWidth",function(){return this._wordsW}),a(0,n,"measureHeight",function(){return this._wordsH}),e}(O),j=function(t){function e(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,e.__super.call(this),this._cells=[],this._offset=new g}r(e,"laya.ui.List",t);var n=e.prototype;return i.imps(n,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),n.destroy=function(t){void 0===t&&(t=!0),this._content&&this._content.destroy(t),this._scrollBar&&this._scrollBar.destroy(t),laya.ui.Component.prototype.destroy.call(this,t),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},n.createChildren=function(){this.addChild(this._content=new P)},n.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=i.superGet(P,this,"cacheAs")),i.superSet(P,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},n.onScrollEnd=function(){i.superSet(P,this,"cacheAs",this._$P.cacheAs)},n._removePreScrollBar=function(){var t=this.removeChildByName("scrollBar");t&&t.destroy(!0)},n.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var t=this._getOneCell(),e=t.width+this._spaceX||1,i=t.height+this._spaceY||1;this._width>0&&(this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e)),this._height>0&&(this._repeatY2=this._isVertical?Math.ceil(this._height/i):Math.round(this._height/i));var n=this._width?this._width:e*this.repeatX-this._spaceX,r=this._height?this._height:i*this.repeatY-this._spaceY;this._cellSize=this._isVertical?i:e,this._cellOffset=this._isVertical?i*Math.max(this._repeatY2,this._repeatY)-r-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-n-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=r:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=n),this.setContentSize(n,r);var a=this._isVertical?this.repeatX:this.repeatY,s=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,a,s),this._createdLine=s,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},n._getOneCell=function(){if(0===this._cells.length){var t=this.createItem();if(this._offset.setTo(t.x,t.y),this.cacheContent)return t;this._cells.push(t)}return this._cells[0]},n._createItems=function(t,e,i){var n=this._content,r=this._getOneCell(),a=r.width+this._spaceX,s=r.height+this._spaceY;if(this.cacheContent){var o=new P;o.cacheAsBitmap=!0,o.pos((this._isVertical?0:t)*a,(this._isVertical?t:0)*s),this._content.addChild(o),this._content.optimizeScrollRect=!0,n=o}else{for(var l=[],h=this._cells.length-1;h>-1;h--){var c=this._cells[h];c.removeSelf(),l.push(c)}this._cells.length=0}for(var u=t;u<i;u++)for(var _=0;_<e;_++)(r=l&&l.length?l.pop():this.createItem()).x=(this._isVertical?_:u)*a-n.x,r.y=(this._isVertical?u:_)*s-n.y,r.name="item"+(u*e+_),n.addChild(r),this.addCell(r)},n.createItem=function(){var t=[];if("function"==typeof this._itemRender)var e=new this._itemRender;else e=W.createComp(this._itemRender,null,null,t);if(0==t.length&&e._watchMap){var i=e._watchMap;for(var n in i)for(var r=i[n],a=0;a<r.length;a++){var s=r[a];t.push(s.comp,s.prop,s.value)}}return t.length&&(e._$bindData=t),e},n.addCell=function(t){t.on("click",this,this.onCellMouse),t.on("rightclick",this,this.onCellMouse),t.on("mouseover",this,this.onCellMouse),t.on("mouseout",this,this.onCellMouse),t.on("mousedown",this,this.onCellMouse),t.on("mouseup",this,this.onCellMouse),this._cells.push(t)},n.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;var t=0;t=0;for(var e=0;e<1e4;e++){var i=this.getChildByName("item"+e);if(!i)break;this.addCell(i),t++}this.repeatY=t}},n.setContentSize=function(t,e){this._content.width=t,this._content.height=e,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new y),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,t,e),this._content.scrollRect=this._content.scrollRect),this.event("resize")},n.onCellMouse=function(t){"mousedown"===t.type&&(this._isMoved=!1);var e=t.currentTarget,i=this._startIndex+this._cells.indexOf(e);i<0||("click"===t.type||"rightclick"===t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=i:this.changeCellState(e,!0,0):"mouseover"!==t.type&&"mouseout"!==t.type||this._selectedIndex===i||this.changeCellState(e,"mouseover"===t.type,0),this.mouseHandler&&this.mouseHandler.runWith([t,i]))},n.changeCellState=function(t,e,i){var n=t.getChildByName("selectBox");n&&(this.selectEnable=!0,n.visible=e,n.index=i)},n.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},n.onScrollBarChange=function(t){this.runCallLater(this.changeCells);var e=this._scrollBar.value,i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.floor(e/this._cellSize);if(this.cacheContent)s=n+1,this._createdLine-r<s&&(this._createItems(this._createdLine,i,this._createdLine+s),this.renderItems(this._createdLine*i,0),this._createdLine+=s);else{var a=r*i,s=0;if(a>this._startIndex){s=a-this._startIndex;var o=!0,l=this._startIndex+i*(n+1);this._isMoved=!0}else a<this._startIndex&&(s=this._startIndex-a,o=!1,l=this._startIndex-1,this._isMoved=!0);for(var h=0;h<s;h++){if(o){var c=this._cells.shift();this._cells[this._cells.length]=c;var u=l+h}else c=this._cells.pop(),this._cells.unshift(c),u=l-h;var _=Math.floor(u/i)*this._cellSize;this._isVertical?c.y=_:c.x=_,this.renderItem(c,u)}this._startIndex=a,this.changeSelectStatus()}var d=this._content.scrollRect;this._isVertical?(d.y=e-this._offset.y,d.x=-this._offset.x):(d.y=-this._offset.y,d.x=e-this._offset.x),this._content.scrollRect=d},n.posCell=function(t,e){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY,n=(this._isVertical?this.repeatY:this.repeatX,Math.floor(e/i)*this._cellSize);this._isVertical?t.y=n:t.x=n}},n.changeSelectStatus=function(){for(var t=0,e=this._cells.length;t<e;t++)this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)},n.renderItems=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=t,n=e||this._cells.length;i<n;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus()},n.renderItem=function(t,e){this._array&&e>=0&&e<this._array.length?(t.visible=!0,t._$bindData?(t._dataSource=this._array[e],this._bindData(t,this._array[e])):t.dataSource=this._array[e],this.cacheContent||this.posCell(t,e),this.hasListener("render")&&this.event("render",[t,e]),this.renderHandler&&this.renderHandler.runWith([t,e])):(t.visible=!1,t.dataSource=null)},n._bindData=function(t,e){for(var i=t._$bindData,n=0,r=i.length;n<r;n++){var a=i[n++],s=i[n++],o=i[n],l=I.getBindFun(o);a[s]=l.call(this,e)}},n.refresh=function(){this.array=this._array},n.getItem=function(t){return t>-1&&t<this._array.length?this._array[t]:null},n.changeItem=function(t,e){t>-1&&t<this._array.length&&(this._array[t]=e,t>=this._startIndex&&t<this._startIndex+this._cells.length&&this.renderItem(this.getCell(t),t))},n.setItem=function(t,e){this.changeItem(t,e)},n.addItem=function(t){this._array.push(t),this.array=this._array},n.addItemAt=function(t,e){this._array.splice(e,0,t),this.array=this._array},n.deleteItem=function(t){this._array.splice(t,1),this.array=this._array},n.getCell=function(t){return this.runCallLater(this.changeCells),t>-1&&this._cells?this._cells[(t-this._startIndex)%this._cells.length]:null},n.scrollTo=function(t){if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/e)*this._cellSize}else this.startIndex=t},n.tweenTo=function(t,e,i){if(void 0===e&&(e=200),this._scrollBar){var n=this._isVertical?this.repeatX:this.repeatY;T.to(this._scrollBar,{value:Math.floor(t/n)*this._cellSize},e,null,i,0,!0)}else this.startIndex=t,i&&i.run()},n._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},n.commitMeasure=function(){this.runCallLater(this.changeCells)},a(0,n,"cacheAs",t.prototype._$get_cacheAs,function(t){i.superSet(P,this,"cacheAs",t),this._scrollBar&&(this._$P.cacheAs=null,"none"!==t?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),a(0,n,"content",function(){return this._content}),a(0,n,"height",t.prototype._$get_height,function(t){t!=this._height&&(i.superSet(P,this,"height",t),this._setCellChanged())}),a(0,n,"itemRender",function(){return this._itemRender},function(t){if(this._itemRender!=t){this._itemRender=t;for(var e=this._cells.length-1;e>-1;e--)this._cells[e].destroy();this._cells.length=0,this._setCellChanged()}}),a(0,n,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this._removePreScrollBar();var e=new et;e.name="scrollBar",e.right=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()}),a(0,n,"page",function(){return this._page},function(t){this._page=t,this._array&&(this._page=t>0?t:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),a(0,n,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this._removePreScrollBar();var e=new K;e.name="scrollBar",e.bottom=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()}),a(0,n,"repeatX",function(){return this._repeatX>0?this._repeatX:this._repeatX2>0?this._repeatX2:1},function(t){this._repeatX=t,this._setCellChanged()}),a(0,n,"scrollBar",function(){return this._scrollBar},function(t){this._scrollBar!=t&&(this._scrollBar=t,t&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange)))}),a(0,n,"width",t.prototype._$get_width,function(t){t!=this._width&&(i.superSet(P,this,"width",t),this._setCellChanged())}),a(0,n,"repeatY",function(){return this._repeatY>0?this._repeatY:this._repeatY2>0?this._repeatY2:1},function(t){this._repeatY=t,this._setCellChanged()}),a(0,n,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,this._setCellChanged()}),a(0,n,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,this._setCellChanged()}),a(0,n,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(t),this.startIndex=this._startIndex)}),a(0,n,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(t){this.selectedIndex=this._array.indexOf(t)}),a(0,n,"length",function(){return this._array?this._array.length:0}),a(0,n,"selection",function(){return this.getCell(this._selectedIndex)},function(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)}),a(0,n,"startIndex",function(){return this._startIndex},function(t){this._startIndex=t>0?t:0,this.callLater(this.renderItems)}),a(0,n,"array",function(){return this._array},function(t){this.runCallLater(this.changeCells),this._array=t||[];var e=this._array.length;if(this.totalPage=Math.ceil(e/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<e?this._selectedIndex:e-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.ceil(e/i);(this._cellOffset>0?this.totalPage+1:this.totalPage)>1?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=n/r,this._scrollBar.setScroll(0,(r-n)*this._cellSize+this._cellOffset,this._scrollBar.value),this._scrollBar.target=this._content):(this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content)}}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.array=t:i.superSet(P,this,"dataSource",t)}),a(0,n,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),e}(P),K=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.HScrollBar",t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.slider.isVertical=!1},e}(F),q=function(t){function e(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,e.__super.call(this),this.width=this.height=100}r(e,"laya.ui.Panel",t);var n=e.prototype;return n.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._content&&this._content.destroy(t),this._vScrollBar&&this._vScrollBar.destroy(t),this._hScrollBar&&this._hScrollBar.destroy(t),this._vScrollBar=null,this._hScrollBar=null,this._content=null},n.destroyChildren=function(){this._content.destroyChildren()},n.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new P)},n.addChild=function(t){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(t)},n.onResize=function(){this._setScrollChanged()},n.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(t,e)},n.removeChild=function(t){return t.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(t)},n.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(t)},n.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647);for(var i=this._content.numChildren-1;i>-1;i--)this._content.removeChildAt(i);return this._setScrollChanged(),this},n.getChildAt=function(t){return this._content.getChildAt(t)},n.getChildByName=function(t){return this._content.getChildByName(t)},n.getChildIndex=function(t){return this._content.getChildIndex(t)},n.changeScroll=function(){this._scrollChanged=!1;var t=this.contentWidth||1,e=this.contentHeight||1,i=this._vScrollBar,n=this._hScrollBar,r=i&&e>this._height,a=n&&t>this._width,s=r?this._width-i.width:this._width,o=a?this._height-n.height:this._height;i&&(i.x=this._width-i.width,i.y=0,i.height=this._height-(a?n.height:0),i.scrollSize=Math.max(.033*this._height,1),i.thumbPercent=o/e,i.setScroll(0,e-o,i.value)),n&&(n.x=0,n.y=this._height-n.height,n.width=this._width-(r?i.width:0),n.scrollSize=Math.max(.033*this._width,1),n.thumbPercent=s/t,n.setScroll(0,t-s,n.value))},n.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},n.setContentSize=function(t,e){var i=this._content;i.width=t,i.height=e,i.scrollRect||(i.scrollRect=new y),i.scrollRect.setTo(0,0,t,e),i.scrollRect=i.scrollRect},n.onScrollBarChange=function(t){var e=this._content.scrollRect;if(e){var i=Math.round(t.value);t.isVertical?e.y=i:e.x=i,this._content.scrollRect=e}},n.scrollTo=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.vScrollBar&&(this.vScrollBar.value=e),this.hScrollBar&&(this.hScrollBar.value=t)},n.refresh=function(){this.changeScroll()},n.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=i.superGet(P,this,"cacheAs")),i.superSet(P,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},n.onScrollEnd=function(){i.superSet(P,this,"cacheAs",this._$P.cacheAs)},n._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},a(0,n,"numChildren",function(){return this._content.numChildren}),a(0,n,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new K),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=t}),a(0,n,"contentWidth",function(){for(var t=0,e=this._content.numChildren-1;e>-1;e--){var i=this._content.getChildAt(e);t=Math.max(i.x+i.width*i.scaleX,t)}return t}),a(0,n,"contentHeight",function(){for(var t=0,e=this._content.numChildren-1;e>-1;e--){var i=this._content.getChildAt(e);t=Math.max(i.y+i.height*i.scaleY,t)}return t}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(P,this,"width",t),this._setScrollChanged()}),a(0,n,"hScrollBar",function(){return this._hScrollBar}),a(0,n,"content",function(){return this._content}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(P,this,"height",t),this._setScrollChanged()}),a(0,n,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new et),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=t}),a(0,n,"vScrollBar",function(){return this._vScrollBar}),a(0,n,"cacheAs",t.prototype._$get_cacheAs,function(t){i.superSet(P,this,"cacheAs",t),this._$P.cacheAs=null,"none"!==t?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),e}(P),Z=function(t){function e(t){e.__super.call(this,t),this.isVertical=!1}return r(e,"laya.ui.HSlider",B),e}(),Q=function(t){function e(t,i){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,e.__super.call(this),this.skin=i,this.labels=t}r(e,"laya.ui.UIGroup",t);var n=e.prototype;return i.imps(n,{"laya.ui.IItem":!0}),n.preinitialize=function(){this.mouseEnabled=!0},n.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},n.addItem=function(t,e){void 0===e&&(e=!0);var i=t,n=this._items.length;if(i.name="item"+n,this.addChild(i),this.initItems(),e&&n>0){var r=this._items[n-1];"horizontal"==this._direction?i.x=r.x+r.width+this._space:i.y=r.y+r.height+this._space}else e&&(i.x=0,i.y=0);return n},n.delItem=function(t,e){void 0===e&&(e=!0);var i=this._items.indexOf(t);if(-1!=i){var n=t;this.removeChild(n);for(var r=i+1,a=this._items.length;r<a;r++){var s=this._items[r];s.name="item"+(r-1),e&&("horizontal"==this._direction?s.x-=n.width+this._space:s.y-=n.height+this._space)}if(this.initItems(),this._selectedIndex>-1){var o;o=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=o}}},n.initItems=function(){this._items||(this._items=[]),this._items.length=0;for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.selected=t===this._selectedIndex,e.clickHandler=f.create(this,this.itemClick,[t],!1)}},n.itemClick=function(t){this.selectedIndex=t},n.setSelect=function(t,e){this._items&&t>-1&&t<this._items.length&&(this._items[t].selected=e)},n.createItem=function(t,e){return null},n.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var t=0,e=0,i=this._items.length;e<i;e++){var n=this._items[e];this._skin&&(n.skin=this._skin),this._labelColors&&(n.labelColors=this._labelColors),this._labelSize&&(n.labelSize=this._labelSize),this._labelStroke&&(n.labelStroke=this._labelStroke),this._labelStrokeColor&&(n.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(n.strokeColors=this._strokeColors),this._labelBold&&(n.labelBold=this._labelBold),this._labelPadding&&(n.labelPadding=this._labelPadding),this._labelAlign&&(n.labelAlign=this._labelAlign),this._stateNum&&(n.stateNum=this._stateNum),this._labelFont&&(n.labelFont=this._labelFont),"horizontal"===this._direction?(n.y=0,n.x=t,t+=n.width+this._space):(n.x=0,n.y=t,t+=n.height+this._space)}this.changeSize()},n.commitMeasure=function(){this.runCallLater(this.changeLabels)},n._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},a(0,n,"labelStrokeColor",function(){return this._labelStrokeColor},function(t){this._labelStrokeColor!=t&&(this._labelStrokeColor=t,this._setLabelChanged())}),a(0,n,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._setLabelChanged())}),a(0,n,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(t,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),a(0,n,"labels",function(){return this._labels},function(t){if(this._labels!=t){if(this._labels=t,this.removeChildren(),this._setLabelChanged(),this._labels)for(var e=this._labels.split(","),i=0,n=e.length;i<n;i++){var r=this.createItem(this._skin,e[i]);r.name="item"+i,this.addChild(r)}this.initItems()}}),a(0,n,"strokeColors",function(){return this._strokeColors},function(t){this._strokeColors!=t&&(this._strokeColors=t,this._setLabelChanged())}),a(0,n,"labelColors",function(){return this._labelColors},function(t){this._labelColors!=t&&(this._labelColors=t,this._setLabelChanged())}),a(0,n,"labelStroke",function(){return this._labelStroke},function(t){this._labelStroke!=t&&(this._labelStroke=t,this._setLabelChanged())}),a(0,n,"labelSize",function(){return this._labelSize},function(t){this._labelSize!=t&&(this._labelSize=t,this._setLabelChanged())}),a(0,n,"stateNum",function(){return this._stateNum},function(t){this._stateNum!=t&&(this._stateNum=t,this._setLabelChanged())}),a(0,n,"labelBold",function(){return this._labelBold},function(t){this._labelBold!=t&&(this._labelBold=t,this._setLabelChanged())}),a(0,n,"labelFont",function(){return this._labelFont},function(t){this._labelFont!=t&&(this._labelFont=t,this._setLabelChanged())}),a(0,n,"labelPadding",function(){return this._labelPadding},function(t){this._labelPadding!=t&&(this._labelPadding=t,this._setLabelChanged())}),a(0,n,"direction",function(){return this._direction},function(t){this._direction=t,this._setLabelChanged()}),a(0,n,"space",function(){return this._space},function(t){this._space=t,this._setLabelChanged()}),a(0,n,"items",function(){return this._items}),a(0,n,"selection",function(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,"number"==typeof t&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):i.superSet(P,this,"dataSource",t)}),e}(P),$=function(t){function e(t,i){this._value=null,void 0===i&&(i=""),e.__super.call(this,t,i)}r(e,"laya.ui.Radio",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._value=null},i.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},i.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},i.onClick=function(t){this.selected=!0},a(0,i,"value",function(){return null!=this._value?this._value:this.label},function(t){this._value=t}),e}(N),J=function(t){function e(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,e.__super.call(this),this.width=this.height=200}r(e,"laya.ui.Tree",t);var n=e.prototype;return i.imps(n,{"laya.ui.IRender":!0}),n.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._list&&this._list.destroy(t),this._list=null,this._source=null,this._renderHandler=null},n.createChildren=function(){this.addChild(this._list=new j),this._list.renderHandler=f.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},n.onListChange=function(t){this.event("change")},n.getArray=function(){var t,e=[];for(var i in this._source)t=this._source[i],this.getParentOpenStatus(t)&&(t.x=this._spaceLeft*this.getDepth(t),e.push(t));return e},n.getDepth=function(t,e){return void 0===e&&(e=0),null==t.nodeParent?e:this.getDepth(t.nodeParent,e+1)},n.getParentOpenStatus=function(t){var e=t.nodeParent;return null==e||!!e.isOpen&&(null==e.nodeParent||this.getParentOpenStatus(e))},n.renderItem=function(t,e){var i=t.dataSource;if(i){t.left=i.x;var n=t.getChildByName("arrow");n&&(i.hasChild?(n.visible=!0,n.index=i.isOpen?1:0,n.tag=e,n.off("click",this,this.onArrowClick),n.on("click",this,this.onArrowClick)):n.visible=!1);var r=t.getChildByName("folder");r&&(2==r.clipY?r.index=i.isDirectory?0:1:r.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([t,e])}},n.onArrowClick=function(t){var e=t.currentTarget.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen,this.event("open"),this._list.array=this.getArray()},n.setItemState=function(t,e){this._list.array[t]&&(this._list.array[t].isOpen=e,this._list.array=this.getArray())},n.fresh=function(){this._list.array=this.getArray(),this.repaint()},n.parseXml=function(t,e,i,n){var r,a=t.childNodes,s=a.length;if(!n){r={};var o,l=t.attributes;for(var h in l){var c=(o=l[h]).nodeName,u=o.nodeValue;r[c]="true"==u||"false"!=u&&u}r.nodeParent=i,s>0&&(r.isDirectory=!0),r.hasChild=s>0,e.push(r)}for(var _=0;_<s;_++){var d=a[_];this.parseXml(d,e,r,!1)}},n.parseOpenStatus=function(t,e){for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.isDirectory)for(var a=0,s=t.length;a<s;a++){var o=t[a];if(o.isDirectory&&this.isSameParent(o,r)&&r.label==o.label){r.isOpen=o.isOpen;break}}}},n.isSameParent=function(t,e){return null==t.nodeParent&&null==e.nodeParent||null!=t.nodeParent&&null!=e.nodeParent&&t.nodeParent.label==e.nodeParent.label&&this.isSameParent(t.nodeParent,e.nodeParent)},n.filter=function(t){if(Boolean(t)){var e=[];this.getFilterSource(this._source,e,t),this._list.array=e}else this._list.array=this.getArray()},n.getFilterSource=function(t,e,i){var n;for(var r in i=i.toLocaleLowerCase(),t)!(n=t[r]).isDirectory&&String(n.label).toLowerCase().indexOf(i)>-1&&(n.x=0,e.push(n)),n.child&&n.child.length>0&&this.getFilterSource(n.child,e,i)},a(0,n,"spaceBottom",function(){return this._list.spaceY},function(t){this._list.spaceY=t}),a(0,n,"keepStatus",function(){return this._keepStatus},function(t){this._keepStatus=t}),a(0,n,"itemRender",function(){return this._list.itemRender},function(t){this._list.itemRender=t}),a(0,n,"array",function(){return this._list.array},function(t){this._keepStatus&&this._list.array&&t&&this.parseOpenStatus(this._list.array,t),this._source=t,this._list.array=this.getArray()}),a(0,n,"mouseHandler",function(){return this._list.mouseHandler},function(t){this._list.mouseHandler=t}),a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,i.superSet(P,this,"dataSource",t)}),a(0,n,"source",function(){return this._source}),a(0,n,"scrollBar",function(){return this._list.scrollBar}),a(0,n,"list",function(){return this._list}),a(0,n,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(t){this._list.vScrollBarSkin=t}),a(0,n,"renderHandler",function(){return this._renderHandler},function(t){this._renderHandler=t}),a(0,n,"selectedIndex",function(){return this._list.selectedIndex},function(t){this._list.selectedIndex=t}),a(0,n,"spaceLeft",function(){return this._spaceLeft},function(t){this._spaceLeft=t}),a(0,n,"selectedItem",function(){return this._list.selectedItem},function(t){this._list.selectedItem=t}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(P,this,"width",t),this._list.width=t}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(P,this,"height",t),this._list.height=t}),a(0,n,"xml",null,function(t){var e=[];this.parseXml(t.childNodes[0],e,null,!0),this.array=e}),a(0,n,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),e}(P),tt=function(t){function e(){this._items=null,this._selectedIndex=0,e.__super.call(this),this._setIndexHandler=f.create(this,this.setIndex,null,!1)}r(e,"laya.ui.ViewStack",t);var n=e.prototype;return i.imps(n,{"laya.ui.IItem":!0}),n.setItems=function(t){this.removeChildren();for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i];r&&(r.name="item"+e,this.addChild(r),e++)}this.initItems()},n.addItem=function(t){t.name="item"+this._items.length,this.addChild(t),this.initItems()},n.initItems=function(){this._items=[];for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.visible=t==this._selectedIndex}},n.setSelect=function(t,e){this._items&&t>-1&&t<this._items.length&&(this._items[t].visible=e)},n.setIndex=function(t){this.selectedIndex=t},a(0,n,"dataSource",t.prototype._$get_dataSource,function(t){if(this._dataSource=t,"number"==typeof t&&Math.floor(t)==t||"string"==typeof t)this.selectedIndex=parseInt(t);else for(var e in this._dataSource)this.hasOwnProperty(e)&&(this[e]=this._dataSource[e])}),a(0,n,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(this._selectedIndex,!0))}),a(0,n,"selection",function(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),a(0,n,"items",function(){return this._items}),a(0,n,"setIndexHandler",function(){return this._setIndexHandler},function(t){this._setIndexHandler=t}),e}(P),et=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.VScrollBar",F),e}(),it=function(t){function e(t){this._bg=null,this._skin=null,e.__super.call(this),void 0===t&&(t=""),this.text=t,this.skin=this.skin}r(e,"laya.ui.TextInput",t);var n=e.prototype;return n.preinitialize=function(){this.mouseEnabled=!0},n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(),this._bg=null},n.createChildren=function(){this.addChild(this._tf=new p),this._tf.padding=M.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},n._onFocus=function(){this.event("focus",this)},n._onBlur=function(){this.event("blur",this)},n._onInput=function(){this.event("input",this)},n._onEnter=function(){this.event("enter",this)},n.initialize=function(){this.width=128,this.height=22},n.select=function(){this._tf.select()},n.setSelection=function(t,e){this._tf.setSelection(t,e)},a(0,n,"text",t.prototype._$get_text,function(t){this._tf.text!=t&&(t+="",this._tf.text=t,this.event("change"))}),a(0,n,"bg",function(){return this._bg},function(t){this.graphics=this._bg=t}),a(0,n,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(t){this._tf.inputElementYAdjuster=t}),a(0,n,"multiline",function(){return this._tf.multiline},function(t){this._tf.multiline=t}),a(0,n,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg||(this.graphics=this._bg=new A),this._bg.source=m.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),a(0,n,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(t){this._bg||(this.graphics=this._bg=new A),this._bg.sizeGrid=I.fillArray(M.defaultSizeGrid,t,Number)}),a(0,n,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(t){this._tf.inputElementXAdjuster=t}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(H,this,"width",t),this._bg&&(this._bg.width=t)}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(H,this,"height",t),this._bg&&(this._bg.height=t)}),a(0,n,"editable",function(){return this._tf.editable},function(t){this._tf.editable=t}),a(0,n,"restrict",function(){return this._tf.restrict},function(t){this._tf.restrict=t}),a(0,n,"prompt",function(){return this._tf.prompt},function(t){this._tf.prompt=t}),a(0,n,"promptColor",function(){return this._tf.promptColor},function(t){this._tf.promptColor=t}),a(0,n,"maxChars",function(){return this._tf.maxChars},function(t){this._tf.maxChars=t}),a(0,n,"focus",function(){return this._tf.focus},function(t){this._tf.focus=t}),a(0,n,"type",function(){return this._tf.type},function(t){this._tf.type=t}),a(0,n,"asPassword",function(){return this._tf.asPassword},function(t){this._tf.asPassword=t}),e}(H),nt=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.VSlider",B),e}(),rt=function(t){function e(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,e.__super.call(this)}r(e,"laya.ui.Dialog",t);var n=e.prototype;return n.initialize=function(){this.popupEffect=e.manager.popupEffectHandler,this.closeEffect=e.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},n._dealDragArea=function(){var t=this.getChildByName("drag");t&&(this.dragArea=t.x+","+t.y+","+t.width+","+t.height,t.removeSelf())},n._onClick=function(t){var e=t.target;if(e)switch(e.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(e.name)}},n.show=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!1,t,e)},n.popup=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!0,t,e)},n._open=function(t,i,n){e.manager.lock(!1),this.isModal=t,e.manager.open(this,i,n)},n.onOpened=function(){},n.close=function(t,i){void 0===i&&(i=!0),e.manager.close(this,t,i)},n.onClosed=function(t){},n._onMouseDown=function(t){var e=this.getMousePoint();this._dragArea.contains(e.x,e.y)?this.startDrag():this.stopDrag()},a(0,n,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(t){if(t){var e=I.fillArray([0,0,0,0],t,Number);this._dragArea=new y(e[0],e[1],e[2],e[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),a(0,n,"isPopup",function(){return null!=this.parent}),a(0,n,"zOrder",t.prototype._$get_zOrder,function(t){i.superSet(W,this,"zOrder",t),e.manager._checkMask()}),a(1,e,"manager",function(){return e._manager=e._manager||new L},function(t){e._manager=t}),e.setLockView=function(t){e.manager.setLockView(t)},e.lock=function(t){e.manager.lock(t)},e.closeAll=function(){e.manager.closeAll()},e.getDialogsByGroup=function(t){return e.manager.getDialogsByGroup(t)},e.closeByGroup=function(t){return e.manager.closeByGroup(t)},e.CLOSE="close",e.CANCEL="cancel",e.SURE="sure",e.NO="no",e.OK="ok",e.YES="yes",e._manager=null,e}(W),at=function(t){function e(){e.__super.call(this)}r(e,"laya.ui.HBox",t);var n=e.prototype;return n.sortItem=function(t){t&&t.sort(function(t,e){return t.x-e.x})},n.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&r.layoutEnabled&&(t.push(r),e=this._height?this._height:Math.max(e,r.height*r.scaleY))}this.sortItem(t);var a=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).x=a,a+=r.width*r.scaleX+this._space,"top"==this._align?r.y=0:"middle"==this._align?r.y=.5*(e-r.height*r.scaleY):"bottom"==this._align&&(r.y=e-r.height*r.scaleY);this.changeSize()},a(0,n,"height",t.prototype._$get_height,function(t){this._height!=t&&(i.superSet(Y,this,"height",t),this.callLater(this.changeItems))}),e.NONE="none",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom",e}(Y),st=function(t){function e(){e.__super.call(this)}r(e,"laya.ui.VBox",t);var n=e.prototype;return n.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&r.layoutEnabled&&(t.push(r),e=this._width?this._width:Math.max(e,r.width*r.scaleX))}this.sortItem(t);var a=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).y=a,a+=r.height*r.scaleY+this._space,"left"==this._align?r.x=0:"center"==this._align?r.x=.5*(e-r.width*r.scaleX):"right"==this._align&&(r.x=e-r.width*r.scaleX);this.changeSize()},a(0,n,"width",t.prototype._$get_width,function(t){this._width!=t&&(i.superSet(Y,this,"width",t),this.callLater(this.changeItems))}),e.NONE="none",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e}(Y),ot=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.RadioGroup",Q),e.prototype.createItem=function(t,e){return new $(t,e)},e}(),lt=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.Tab",Q),e.prototype.createItem=function(t,e){return new N(t,e)},e}(),ht=function(t){function e(t){this._vScrollBar=null,this._hScrollBar=null,void 0===t&&(t=""),e.__super.call(this,t)}r(e,"laya.ui.TextArea",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},n.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},n.onVBarChanged=function(t){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},n.onHBarChanged=function(t){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},n.changeScroll=function(){var t=this._vScrollBar&&this._tf.maxScrollY>0,e=this._hScrollBar&&this._tf.maxScrollX>0,i=t?this._width-this._vScrollBar.width:this._width,n=e?this._height-this._hScrollBar.height:this._height,r=this._tf.padding||M.labelPadding;this._tf.width=i,this._tf.height=n,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-r[2],this._vScrollBar.y=r[1],this._vScrollBar.height=this._height-(e?this._hScrollBar.height:0)-r[1]-r[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=n/Math.max(this._tf.textHeight,n),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=t),this._hScrollBar&&(this._hScrollBar.x=r[0],this._hScrollBar.y=this._height-this._hScrollBar.height-r[3],this._hScrollBar.width=this._width-(t?this._vScrollBar.width:0)-r[0]-r[2],this._hScrollBar.scrollSize=Math.max(.033*i,1),this._hScrollBar.thumbPercent=i/Math.max(this._tf.textWidth,i),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=e)},n.scrollTo=function(t){this.commitMeasure(),this._tf.scrollY=t},a(0,n,"scrollY",function(){return this._tf.scrollY}),a(0,n,"width",t.prototype._$get_width,function(t){i.superSet(it,this,"width",t),this.callLater(this.changeScroll)}),a(0,n,"hScrollBar",function(){return this._hScrollBar}),a(0,n,"height",t.prototype._$get_height,function(t){i.superSet(it,this,"height",t),this.callLater(this.changeScroll)}),a(0,n,"maxScrollX",function(){return this._tf.maxScrollX}),a(0,n,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new et),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=t}),a(0,n,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new K),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=t}),a(0,n,"vScrollBar",function(){return this._vScrollBar}),a(0,n,"maxScrollY",function(){return this._tf.maxScrollY}),a(0,n,"scrollX",function(){return this._tf.scrollX}),e}(it);!function(t){function e(){this._uiView=null,this.isCloseOther=!1,e.__super.call(this)}r(e,"laya.ui.AsynDialog",rt);var i=e.prototype;i.createView=function(t){this._uiView=t},i._open=function(t,e,i){this.isModal=t,this.isCloseOther=e,rt.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},i.onCreated=function(){this.createUI(),this.onOpen()},i.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},i.onOpen=function(){rt.manager.open(this,this.isCloseOther),rt.manager.lock(!1)},i.close=function(t,e){void 0===e&&(e=!0),rt.manager.close(this),this.onClose()},i.onClose=function(){},i.destroy=function(t){void 0===t&&(t=!0),laya.ui.View.prototype.destroy.call(this,t),this._uiView=null,this.onDestroy()},i.onDestroy=function(){}}(),i.__init([W])}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,a=i.getset,s=i.__newvec,o=(laya.ani.AnimationContent,laya.ani.AnimationPlayer),l=(laya.ani.AnimationState,laya.ani.AnimationTemplet),h=laya.maths.Arith,c=laya.webgl.atlas.AtlasResourceManager,u=laya.webgl.shader.BaseShader,_=laya.utils.Browser,d=laya.webgl.utils.Buffer,f=laya.utils.Byte,p=(laya.ani.bone.canvasmesh.CacheAbleSkinMesh,laya.utils.ClassUtils),m=i.Config,g=(laya.events.Event,laya.events.EventDispatcher),y=laya.utils.Handler,v=laya.net.Loader,S=laya.net.LoaderManager,x=laya.maths.MathUtil,E=laya.display.Node,T=laya.renders.Render,w=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),C=laya.resource.Resource,b=laya.utils.RunDriver,M=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),I=laya.display.Sprite,D=laya.utils.Stat,A=laya.utils.StringKey,R=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),L=laya.utils.Utils,P=laya.webgl.WebGL,N=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D,i.interface("laya.d3.core.IClone"),i.interface("laya.d3.graphics.IVertex"),i.interface("laya.d3.core.render.IUpdate"),i.interface("laya.d3.core.scene.ITreeNode"),i.interface("laya.d3.core.render.IRenderable");var O=function(){function t(){}return r(t,"laya.d3.animation.AnimationClipParser01"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._animationClip=e,t._reader=i,i.__getBuffer(),t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;n<r;n++){var a=i.getUint16(),s=t._strings[a],o=t["READ_"+s];if(null==o)throw new Error("model file err,no this function:"+a+" "+s);o.call()}},t.READ_ANIMATIONS=function(){var e,i=0,n=0,r=t._reader,a=r.__getBuffer(),s=[],o=r.getUint8();for(s.length=o,i=0;i<o;i++)s[i]=r.getUint16();var l=[],h=r.getUint16();for(l.length=h,i=0;i<h;i++)l[i]=r.getFloat32();var c=t._animationClip;c.name=t._strings[r.getUint16()];var u=c._duration=r.getFloat32();c.islooping=!!r.getByte(),c._frameRate=r.getInt16();var _=r.getInt16(),d=c._nodes=new Array;d.length=_,(c._publicClipDatas=[]).length=_;var f=c._nodesMap={},p=0,m=0;for(i=0;i<_;i++){e=d[i]=new U;var g=r.getUint16(),y=e.path=[];for(y.length=g,n=0;n<g;n++)y[n]=t._strings[r.getUint16()];var v=y.join("/"),S=f[v];S||(f[v]=S=[]),S.push(e);var x=r.getInt16();-1!==x&&(e.componentType=t._strings[x]);var E=F._propertyIndexDic[t._strings[r.getUint16()]];if(null==E)throw new Error("AnimationClipParser01:unknown property name.");var T=E<4,w=!T||T&&""===y[0];e._cacheProperty=w,w?p++:m++,e.propertyNameID=E;var C=s[r.getUint8()];e.keyFrameWidth=C/4;var b=e.keyFrames=[],M=b.length=r.getUint16(),I=null,D=NaN;for(n=0;n<M;n++){var A=b[n]=new B;D=A.startTime=l[r.getUint16()];var R=r.pos;A.inTangent=new Float32Array(a.slice(R,R+C)),r.pos+=C,R=r.pos,A.outTangent=new Float32Array(a.slice(R,R+C)),r.pos+=C,R=r.pos,A.data=new Float32Array(a.slice(R,R+C)),r.pos+=C,I&&(I.next=A,I.duration=D-I.startTime),I=A}A.next=null,A.duration=u-D}var L=c._nodeToCachePropertyMap=new Int32Array(_),P=c._cachePropertyMap=new Int32Array(p),N=c._unCachePropertyMap=new Int32Array(m);for(p=m=0,i=0;i<_;i++)(e=d[i])._cacheProperty?(L[i]=p,P[p++]=i):N[m++]=i},t._animationClip=null,t._reader=null,t._strings=[],n(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),V=function(){function t(){}return r(t,"laya.d3.animation.AnimationClipParser02"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._animationClip=e,t._reader=i,i.__getBuffer(),t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;n<r;n++){var a=i.getUint16(),s=t._strings[a],o=t["READ_"+s];if(null==o)throw new Error("model file err,no this function:"+a+" "+s);o.call()}},t.READ_ANIMATIONS=function(){var e,i=0,n=0,r=t._reader,a=r.__getBuffer(),s=[],o=r.getUint8();for(s.length=o,i=0;i<o;i++)s[i]=r.getUint16();var l=[],h=r.getUint16();for(l.length=h,i=0;i<h;i++)l[i]=r.getFloat32();var c=t._animationClip;c.name=t._strings[r.getUint16()];var u=c._duration=r.getFloat32();c.islooping=!!r.getByte(),c._frameRate=r.getInt16();var _=r.getInt16(),d=c._nodes=new Array;d.length=_,(c._publicClipDatas=[]).length=_;var f=c._nodesMap={},p=0,m=0;for(i=0;i<_;i++){e=d[i]=new U;var g=r.getUint16(),y=e.path=[];for(y.length=g,n=0;n<g;n++)y[n]=t._strings[r.getUint16()];var v=y.join("/"),S=f[v];S||(f[v]=S=[]),S.push(e);var x=r.getInt16();-1!==x&&(e.componentType=t._strings[x]);var E=F._propertyIndexDic[t._strings[r.getUint16()]];if(null==E)throw new Error("AnimationClipParser02:unknown property name.");var T=E<4,w=!T||T&&""===y[0];e._cacheProperty=w,w?p++:m++,e.propertyNameID=E;var C=s[r.getUint8()];e.keyFrameWidth=C/4;var b=e.keyFrames=[],M=b.length=r.getUint16(),I=null,D=NaN;for(n=0;n<M;n++){var A=b[n]=new B;D=A.startTime=l[r.getUint16()];var R=r.pos;A.inTangent=new Float32Array(a.slice(R,R+C)),r.pos+=C,R=r.pos,A.outTangent=new Float32Array(a.slice(R,R+C)),r.pos+=C,R=r.pos,A.data=new Float32Array(a.slice(R,R+C)),r.pos+=C,I&&(I.next=A,I.duration=D-I.startTime),I=A}A.next=null,A.duration=u-D}var L=r.getUint16();for(i=0;i<L;i++){var P=new k;P.time=r.getFloat32(),P.eventName=t._strings[r.getUint16()];var N,O=r.getUint16();for(O>0&&(P.params=N=[]),n=0;n<O;n++)switch(r.getByte()){case 0:N.push(!!r.getByte());break;case 1:N.push(r.getInt32());break;case 2:N.push(r.getFloat32());break;case 3:N.push(t._strings[r.getUint16()]);break;default:throw new Error("unknown type.")}c.addEvent(P)}var V=c._nodeToCachePropertyMap=new Int32Array(_),H=c._cachePropertyMap=new Int32Array(p),G=c._unCachePropertyMap=new Int32Array(m);for(p=m=0,i=0;i<_;i++)(e=d[i])._cacheProperty?(V[i]=p,H[p++]=i):G[m++]=i},t._animationClip=null,t._reader=null,t._strings=[],n(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),k=function(){function t(){this.time=NaN,this.eventName=null,this.params=null}return r(t,"laya.d3.animation.AnimationEvent"),t}(),F=function(){function t(){this._childs=[],this.transform=new $e(this)}r(t,"laya.d3.animation.AnimationNode");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.addChild=function(t){t._parent=this,t.transform.setParent(this.transform),this._childs.push(t)},e.removeChild=function(t){var e=this._childs.indexOf(t);-1!==e&&this._childs.splice(e,1)},e.getChildByName=function(t){for(var e=0,i=this._childs.length;e<i;e++){var n=this._childs[e];if(n.name===t)return n}return null},e.getChildByIndex=function(t){return this._childs[t]},e.getChildCount=function(){return this._childs.length},e.cloneTo=function(t){var e=t;e.name=this.name;for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i],a=r.clone();e.addChild(a);var s=r.transform,o=a.transform;o.setLocalPosition(s.getLocalPosition()),o.setLocalRotation(s.getLocalRotation()),o.setLocalScale(s.getLocalScale()),o._localRotationEuler=s._localRotationEuler,o._setWorldMatrixIgnoreUpdate(s.getWorldMatrix())}},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.__init__=function(){t.registerAnimationNodeProperty("localPosition",t._getLocalPosition,t._setLocalPosition),t.registerAnimationNodeProperty("localRotation",t._getLocalRotation,t._setLocalRotation),t.registerAnimationNodeProperty("localScale",t._getLocalScale,t._setLocalScale),t.registerAnimationNodeProperty("localRotationEuler",t._getLocalRotationEuler,t._setLocalRotationEuler),t.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",t._getParticleRenderSharedMaterialTintColor,t._setParticleRenderSharedMaterialTintColor),t.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",t._getMeshRenderSharedMaterialTilingOffset,t._setMeshRenderSharedMaterialTilingOffset),t.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",t._getMeshRenderSharedMaterialAlbedo,t._setMeshRenderSharedMaterialAlbedo),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",t._getSkinnedMeshRenderSharedMaterialTilingOffset,t._setSkinnedMeshRenderSharedMaterialTilingOffset),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",t._getSkinnedMeshRenderSharedMaterialAlbedo,t._setSkinnedMeshRenderSharedMaterialAlbedo),t.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",t._getMeshRenderSharedMaterialAlbedo,t._setMeshRenderSharedMaterialAlbedo),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",t._getSkinnedMeshRenderSharedMaterialAlbedo,t._setSkinnedMeshRenderSharedMaterialAlbedo),t.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",t._getMeshRenderSharedMaterialIntensity,t._setMeshRenderSharedMaterialIntensity),t.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",t._getMeshRenderSharedMaterialAlpha,t._setMeshRenderSharedMaterialAlpha),t.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",t._getMeshRenderSharedMaterialAlphaColor,t._setMeshRenderSharedMaterialAlphaColor),t.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",t._getMeshRenderSharedMaterialBaseColor,t._setMeshRenderSharedMaterialBaseColor),t.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",t._getMeshRenderSharedMaterialDissolve,t._setMeshRenderSharedMaterialDissolve),t.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",t._getMeshRenderSharedMaterialDissolveSpeed,t._setMeshRenderSharedMaterialDissolveSpeed),t.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",t._getMeshRenderSharedMaterialMMultiplier,t._setMeshRenderSharedMaterialMMultiplier),t.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",t._getMeshRenderSharedMaterialBaseScrollSpeedX,t._setMeshRenderSharedMaterialBaseScrollSpeedX),t.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",t._getMeshRenderSharedMaterialBaseScrollSpeedY,t._setMeshRenderSharedMaterialBaseScrollSpeedY),t.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",t._getMeshRenderSharedMaterialSecondScrollSpeedX,t._setMeshRenderSharedMaterialSecondScrollSpeedX),t.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",t._getMeshRenderSharedMaterialSecondScrollSpeedY,t._setMeshRenderSharedMaterialSecondScrollSpeedY),t.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",t._getMeshRenderSharedMaterialDetailTilingOffset,t._setMeshRenderSharedMaterialDetailTilingOffset),t.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",t._getMeshRenderSharedMaterialDissolveTilingOffset,t._setMeshRenderSharedMaterialDissolveTilingOffset),t.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",t._getMeshRenderSharedMaterialMaskTilingOffset,t._setMeshRenderSharedMaterialMaskTilingOffset)},t.registerAnimationNodeProperty=function(e,i,n){if(t._propertyIndexDic[e])throw new Error("AnimationNode: this propertyName has registered.");t._propertyIndexDic[e]=t._propertyIDCounter,t._propertyGetFuncs[t._propertyIDCounter]=i,t._propertySetFuncs[t._propertyIDCounter]=n,t._propertyIDCounter++},t._getLocalPosition=function(t,e){return t?t.transform.getLocalPosition():e._transform.localPosition.elements},t._setLocalPosition=function(t,e,i){if(t)t.transform.setLocalPosition(i);else{var n=e._transform,r=n.localPosition;r.elements=i,n.localPosition=r}},t._getLocalRotation=function(t,e){return t?t.transform.getLocalRotation():e._transform.localRotation.elements},t._setLocalRotation=function(t,e,i){if(t)t.transform.setLocalRotation(i);else{var n=e._transform,r=n.localRotation;r.elements=i,n.localRotation=r}},t._getLocalScale=function(t,e){return t?t.transform.getLocalScale():e._transform.localScale.elements},t._setLocalScale=function(t,e,i){if(t)t.transform.setLocalScale(i);else{var n=e._transform,r=n.localScale;r.elements=i,n.localScale=r}},t._getLocalRotationEuler=function(t,e){return t?t.transform.getLocalRotationEuler():e._transform.localRotationEuler.elements},t._setLocalRotationEuler=function(t,e,i){if(t)t.transform.setLocalRotationEuler(i);else{var n=e._transform,r=n.localRotationEuler;r.elements=i,n.localRotationEuler=r}},t._getMeshRenderSharedMaterialTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return e.meshRender.sharedMaterial.tilingOffset.elements},t._setMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).tilingOffset).elements=i,n.tilingOffset=r)}else(r=(n=e.meshRender.material).tilingOffset).elements=i,n.tilingOffset=r},t._getMeshRenderSharedMaterialAlbedo=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.albedoColor.elements:null}return e.meshRender.sharedMaterial.albedoColor.elements},t._setMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).albedoColor).elements=i,n.albedoColor=r)}else(r=(n=e.meshRender.material).albedoColor).elements=i,n.albedoColor=r},t._getSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return e.skinnedMeshRender.sharedMaterial.tilingOffset.elements},t._setSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=r)}else(r=(n=e.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=r},t._getSkinnedMeshRenderSharedMaterialAlbedo=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return e.skinnedMeshRender.sharedMaterial.albedoColor.elements},t._setSkinnedMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=r)}else(r=(n=e.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=r},t._getParticleRenderSharedMaterialTintColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.particleRender.sharedMaterial.tintColor.elements:null}return e.particleRender.sharedMaterial.tintColor.elements},t._setParticleRenderSharedMaterialTintColor=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.particleRender.material).tintColor).elements=i,n.tintColor=r)}else(r=(n=e.particleRender.material).tintColor).elements=i,n.tintColor=r},t._getMeshRenderSharedMaterialAlphaColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.alphaColor.elements:null}return e.meshRender.sharedMaterial.alphaColor.elements},t._setMeshRenderSharedMaterialAlphaColor=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).alphaColor).elements=i,n.alphaColor=r)}else(r=(n=e.meshRender.material).alphaColor).elements=i,n.alphaColor=r},t._getMeshRenderSharedMaterialBaseColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseColor.elements:null}return e.meshRender.sharedMaterial.baseColor.elements},t._setMeshRenderSharedMaterialBaseColor=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).baseColor).elements=i,n.baseColor=r)}else(r=(n=e.meshRender.material).baseColor).elements=i,n.baseColor=r},t._getMeshRenderSharedMaterialDissolve=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolve:0}return e.meshRender.sharedMaterial.dissolve},t._setMeshRenderSharedMaterialDissolve=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.dissolve=i[0])}else e.meshRender.material.dissolve=i[0]},t._getMeshRenderSharedMaterialDissolveSpeed=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolveSpeed:0}return e.meshRender.sharedMaterial.dissolveSpeed},t._setMeshRenderSharedMaterialDissolveSpeed=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.dissolveSpeed=i[0])}else e.meshRender.material.dissolveSpeed=i[0]},t._getMeshRenderSharedMaterialMMultiplier=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.mMultiplier:0}return e.meshRender.sharedMaterial.mMultiplier},t._setMeshRenderSharedMaterialMMultiplier=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.mMultiplier=i[0])}else e.meshRender.material.mMultiplier=i[0]},t._getMeshRenderSharedMaterialBaseScrollSpeedX=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return e.meshRender.sharedMaterial.baseScrollSpeedX},t._setMeshRenderSharedMaterialBaseScrollSpeedX=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.baseScrollSpeedX=i[0])}else e.meshRender.material.baseScrollSpeedX=i[0]},t._getMeshRenderSharedMaterialBaseScrollSpeedY=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return e.meshRender.sharedMaterial.baseScrollSpeedY},t._setMeshRenderSharedMaterialBaseScrollSpeedY=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.baseScrollSpeedY=i[0])}else e.meshRender.material.baseScrollSpeedY=i[0]},t._getMeshRenderSharedMaterialSecondScrollSpeedX=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return e.meshRender.sharedMaterial.secondScrollSpeedX},t._setMeshRenderSharedMaterialSecondScrollSpeedX=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.secondScrollSpeedX=i[0])}else e.meshRender.material.secondScrollSpeedX=i[0]},t._getMeshRenderSharedMaterialSecondScrollSpeedY=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return e.meshRender.sharedMaterial.secondScrollSpeedY},t._setMeshRenderSharedMaterialSecondScrollSpeedY=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.secondScrollSpeedY=i[0])}else e.meshRender.material.secondScrollSpeedY=i[0]},t._getMeshRenderSharedMaterialAlpha=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.alpha:0}return e.meshRender.sharedMaterial.alpha},t._setMeshRenderSharedMaterialAlpha=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.alpha=i[0])}else e.meshRender.material.alpha=i[0]},t._getMeshRenderSharedMaterialIntensity=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.intensity:0}return e.meshRender.sharedMaterial.intensity},t._setMeshRenderSharedMaterialIntensity=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.intensity=i[0])}else e.meshRender.material.intensity=i[0]},t._getMeshRenderSharedMaterialDetailTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return e.meshRender.sharedMaterial.detailTilingOffset.elements},t._setMeshRenderSharedMaterialDetailTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).detailTilingOffset).elements=i,n.detailTilingOffset=r)}else(r=(n=e.meshRender.material).detailTilingOffset).elements=i,n.detailTilingOffset=r},t._getMeshRenderSharedMaterialDissolveTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return e.meshRender.sharedMaterial.dissolveTilingOffset.elements},t._setMeshRenderSharedMaterialDissolveTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).dissolveTilingOffset).elements=i,n.dissolveTilingOffset=r)}else(r=(n=e.meshRender.material).dissolveTilingOffset).elements=i,n.dissolveTilingOffset=r},t._getMeshRenderSharedMaterialMaskTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return e.meshRender.sharedMaterial.maskTilingOffset.elements},t._setMeshRenderSharedMaterialMaskTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).maskTilingOffset).elements=i,n.maskTilingOffset=r)}else(r=(n=e.meshRender.material).maskTilingOffset).elements=i,n.maskTilingOffset=r},t._propertyIDCounter=0,t._propertyIndexDic={},t._propertySetFuncs=[],t._propertyGetFuncs=[],t}(),B=function(){function t(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return r(t,"laya.d3.animation.Keyframe"),t}(),U=function(){function t(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return r(t,"laya.d3.animation.KeyframeNode"),t}(),H=function(){function t(){this._tempVector30=new Pe,this._tempVector31=new Pe,this._tempVector32=new Pe,this._a=new Pe,this._b=new Pe,this._c=new Pe,this._d=new Pe}r(t,"laya.d3.core.glitter.SplineCurvePositionVelocity");var e=t.prototype;return e.Init=function(t,e,i,n){t.cloneTo(this._d),e.cloneTo(this._c),Pe.scale(t,2,this._a),Pe.scale(i,2,this._tempVector30),Pe.subtract(this._a,this._tempVector30,this._a),Pe.add(this._a,e,this._a),Pe.add(this._a,n,this._a),Pe.scale(i,3,this._b),Pe.scale(t,3,this._tempVector30),Pe.subtract(this._b,this._tempVector30,this._b),Pe.subtract(this._b,n,this._b),Pe.scale(e,2,this._tempVector30),Pe.subtract(this._b,this._tempVector30,this._b)},e.Slerp=function(t,e){Pe.scale(this._a,t*t*t,this._tempVector30),Pe.scale(this._b,t*t,this._tempVector31),Pe.scale(this._c,t,this._tempVector32),Pe.add(this._tempVector30,this._tempVector31,e),Pe.add(e,this._tempVector32,e),Pe.add(e,this._d,e)},t}(),G=function(){function t(t,e,i,n){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=t,this._h=e,this._minHeight=i,this._maxHeight=n}r(t,"laya.d3.core.HeightMap");var e=t.prototype;return e._inBounds=function(t,e){return t>=0&&t<this._h&&e>=0&&e<this._w},e.getHeight=function(t,e){return this._inBounds(t,e)?this._datas[t][e]:NaN},a(0,e,"width",function(){return this._w}),a(0,e,"height",function(){return this._h}),a(0,e,"maxHeight",function(){return this._maxHeight}),a(0,e,"minHeight",function(){return this._minHeight}),t.creatFromMesh=function(e,i,n,r){for(var a=[],s=[],o=e.getSubMeshCount(),l=0;l<o;l++){for(var h=e.getSubMesh(l),c=h._getVertexBuffer(),u=c.getData(),_=[],d=0;d<u.length;d+=c.vertexDeclaration.vertexStride/4){var f=new Pe(u[d+0],u[d+1],u[d+2]);_.push(f)}a.push(_);var p=h._getIndexBuffer();s.push(p.getData())}var m=e.boundingBox,g=m.min.x,y=m.min.z,v=m.max.x,S=m.max.z,x=m.min.y,E=m.max.y,T=v-g,w=S-y,C=r.elements[0]=T/(i-1),b=r.elements[1]=w/(n-1),M=new t(i,n,x,E),I=t._tempRay,D=I.direction.elements;D[0]=0,D[1]=-1,D[2]=0;var A=E+.1;I.origin.elements[1]=A;for(var R=0;R<n;R++){var L=y+R*b;M._datas[R]=[];for(var P=0;P<i;P++){var N=g+P*C,O=I.origin.elements;O[0]=N,O[2]=L;var V=t._getPosition(I,a,s);M._datas[R][P]=V===Number.MAX_VALUE?NaN:A-V}}return M},t.createFromImage=function(e,i,n){for(var r=e.width,a=e.height,s=new t(r,a,i,n),o=(n-i)/254,l=e.getPixels(),h=0,c=0;c<a;c++)for(var u=s._datas[c]=[],_=0;_<r;_++){var d=l[h++],f=l[h++],p=l[h++],m=l[h++];u[_]=255==d&&255==f&&255==p&&255==m?NaN:(d+f+p)/3*o+i}return s},t._getPosition=function(t,e,i){for(var n=Number.MAX_VALUE,r=0;r<e.length;r++)for(var a=e[r],s=i[r],o=0;o<s.length;o+=3){var l=a[s[o+0]],h=a[s[o+1]],c=a[s[o+2]],u=je.rayIntersectsTriangle(t,l,h,c);!isNaN(u)&&u<n&&(n=u)}return n},n(t,["_tempRay",function(){return this._tempRay=new Re(new Pe,new Pe)}]),t}(),W=function(){function t(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}r(t,"laya.d3.core.Layer");var e=t.prototype;return e._binarySearchIndex=function(){for(var e=0,i=t._collsionTestList.length-1,n=0;e<=i;){n=Math.floor((e+i)/2);var r=t._collsionTestList[n];if(r==this._number)return n;r>this._number?i=n-1:e=n+1}return e},e._addCollider=function(e){0===this._colliders.length&&t._collsionTestList.splice(this._binarySearchIndex(),0,this._number),e._isRigidbody?(this._colliders.unshift(e),this._nonRigidbodyOffset++):this._colliders.push(e)},e._removeCollider=function(e){var i=this._colliders.indexOf(e);i<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(i,1),0===this._colliders.length&&t._collsionTestList.splice(t._collsionTestList.indexOf(this._number),1)},a(0,e,"number",function(){return this._number}),a(0,e,"visible",function(){return this._visible},function(e){this._visible=e,t._visibleLayers=e?t._visibleLayers|this.mask:t._visibleLayers&~this.mask}),a(0,e,"mask",function(){return this._mask}),a(1,t,"visibleLayers",function(){return t._visibleLayers},function(e){t._visibleLayers=e;for(var i=0,n=t._layerList.length;i<n;i++){var r=t._layerList[i];r._visible=0!=(r._mask&t._visibleLayers)}}),t.__init__=function(){t._layerList.length=31;for(var e=0;e<31;e++){var i=new t;t._layerList[e]=i,0===e?(i.name="Default Layer",i.visible=!0):(i.name="Layer-"+e,i.visible=!1),i._number=e,i._mask=Math.pow(2,e)}t.currentCreationLayer=t._layerList[0]},t.getLayerByNumber=function(e){if(e<0||e>30)throw new Error("无法返回指定Layer，该number超出范围！");return t._layerList[e]},t.getLayerByName=function(e){for(var i=0;i<31;i++)if(t._layerList[i].name===e)return t._layerList[i];throw new Error("无法返回指定Layer,该name不存在")},t.isVisible=function(e){return 0!=(e&t._currentCameraCullingMask&t._visibleLayers)},t._layerList=[],t._visibleLayers=2147483647,t._collsionTestList=[],t._currentCameraCullingMask=2147483647,t.maxCount=31,t.currentCreationLayer=null,t}(),z=function(){function t(t,e,i){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=t,this._minCount=e,this._maxCount=i}r(t,"laya.d3.core.particleShuriKen.module.Burst");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._time=this._time,e._minCount=this._minCount,e._maxCount=this._maxCount},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"time",function(){return this._time}),a(0,e,"minCount",function(){return this._minCount}),a(0,e,"maxCount",function(){return this._maxCount}),t}(),Y=function(){function t(t){this._color=null,this.enbale=!1,this._color=t}r(t,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var e=t.prototype;return e.cloneTo=function(t){var e=t;this._color.cloneTo(e._color),e.enbale=this.enbale},e.clone=function(){var t;switch(this._color.type){case 0:t=q.createByConstant(this._color.constant.clone());break;case 1:t=q.createByGradient(this._color.gradient.clone());break;case 2:t=q.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:t=q.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},a(0,e,"color",function(){return this._color}),t}(),X=function(){function t(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}r(t,"laya.d3.core.particleShuriKen.module.Emission");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),e._destroy=function(){this._bursts=null,this._destroyed=!0},e.getBurstsCount=function(){return this._bursts.length},e.getBurstByIndex=function(t){return this._bursts[t]},e.addBurst=function(t){var e=this._bursts.length;if(e>0)for(var i=0;i_3Ce;i++)this._bursts[i].time>t.time&&this._bursts.splice(i,0,t);this._bursts.push(t)},e.removeBurst=function(t){var e=this._bursts.indexOf(t);-1!==e&&this._bursts.splice(e,1)},e.removeBurstByIndex=function(t){this._bursts.splice(t,1)},e.clearBurst=function(){this._bursts.length=0},e.cloneTo=function(t){var e=t,i=e._bursts;i.length=this._bursts.length;for(var n=0,r=this._bursts.length;n<r;n++){var a=i[n];a?this._bursts[n].cloneTo(a):i[n]=this._bursts[n].clone()}e._emissionRate=this._emissionRate,e.enbale=this.enbale},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"destroyed",function(){return this._destroyed}),a(0,e,"emissionRate",function(){return this._emissionRate},function(t){if(t<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=t}),t}(),j=function(){function t(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}r(t,"laya.d3.core.particleShuriKen.module.FrameOverTime");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,this._overTime.cloneTo(e._overTime),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._overTimeMin.cloneTo(e._overTimeMin),this._overTimeMax.cloneTo(e._overTimeMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"frameOverTimeData",function(){return this._overTime}),a(0,e,"constant",function(){return this._constant}),a(0,e,"type",function(){return this._type}),a(0,e,"frameOverTimeDataMin",function(){return this._overTimeMin}),a(0,e,"constantMin",function(){return this._constantMin}),a(0,e,"frameOverTimeDataMax",function(){return this._overTimeMax}),a(0,e,"constantMax",function(){return this._constantMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByOverTime=function(e){var i=new t;return i._type=1,i._overTime=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoOverTime=function(e,i){var n=new t;return n._type=3,n._overTimeMin=e,n._overTimeMax=i,n},t}(),K=function(){function t(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}r(t,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,e._constant=this._constant,this._constantSeparate.cloneTo(e._constantSeparate),this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"gradientZ",function(){return this._gradientZ}),a(0,e,"constant",function(){return this._constant}),a(0,e,"gradient",function(){return this._gradient}),a(0,e,"separateAxes",function(){return this._separateAxes}),a(0,e,"type",function(){return this._type}),a(0,e,"constantSeparate",function(){return this._constantSeparate}),a(0,e,"gradientX",function(){return this._gradientX}),a(0,e,"gradientY",function(){return this._gradientY}),a(0,e,"gradientW",function(){return this._gradientW}),a(0,e,"gradientMin",function(){return this._gradientMin}),a(0,e,"constantMin",function(){return this._constantMin}),a(0,e,"gradientMax",function(){return this._gradientMax}),a(0,e,"constantMax",function(){return this._constantMax}),a(0,e,"gradientWMin",function(){return this._gradientWMin}),a(0,e,"constantMinSeparate",function(){return this._constantMinSeparate}),a(0,e,"constantMaxSeparate",function(){return this._constantMaxSeparate}),a(0,e,"gradientXMin",function(){return this._gradientXMin}),a(0,e,"gradientXMax",function(){return this._gradientXMax}),a(0,e,"gradientWMax",function(){return this._gradientWMax}),a(0,e,"gradientYMin",function(){return this._gradientYMin}),a(0,e,"gradientYMax",function(){return this._gradientYMax}),a(0,e,"gradientZMin",function(){return this._gradientZMin}),a(0,e,"gradientZMax",function(){return this._gradientZMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._separateAxes=!1,i._constant=e,i},t.createByConstantSeparate=function(e){var i=new t;return i._type=0,i._separateAxes=!0,i._constantSeparate=e,i},t.createByGradient=function(e){var i=new t;return i._type=1,i._separateAxes=!1,i._gradient=e,i},t.createByGradientSeparate=function(e,i,n,r){var a=new t;return a._type=1,a._separateAxes=!0,a._gradientX=e,a._gradientY=i,a._gradientZ=n,a._gradientW=r,a},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._separateAxes=!1,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoConstantSeparate=function(e,i){var n=new t;return n._type=2,n._separateAxes=!0,n._constantMinSeparate=e,n._constantMaxSeparate=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=3,n._separateAxes=!1,n._gradientMin=e,n._gradientMax=i,n},t.createByRandomTwoGradientSeparate=function(e,i,n,r,a,s,o,l){var h=new t;return h._type=3,h._separateAxes=!0,h._gradientXMin=e,h._gradientXMax=i,h._gradientYMin=n,h._gradientYMax=r,h._gradientZMin=a,h._gradientZMax=s,h._gradientWMin=o,h._gradientWMax=l,h},t}(),q=function(){function t(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}r(t,"laya.d3.core.particleShuriKen.module.GradientColor");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradient.cloneTo(e._gradient),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"gradient",function(){return this._gradient}),a(0,e,"constant",function(){return this._constant}),a(0,e,"type",function(){return this._type}),a(0,e,"gradientMin",function(){return this._gradientMin}),a(0,e,"constantMin",function(){return this._constantMin}),a(0,e,"gradientMax",function(){return this._gradientMax}),a(0,e,"constantMax",function(){return this._constantMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByGradient=function(e){var i=new t;return i._type=1,i._gradient=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=3,n._gradientMin=e,n._gradientMax=i,n},t}(),Z=function(){function t(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}r(t,"laya.d3.core.particleShuriKen.module.GradientDataColor");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.addAlpha=function(t,e){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==t&&(t=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._alphaElements[this._alphaCurrentLength++]=t,this._alphaElements[this._alphaCurrentLength++]=e):console.log("GradientDataColor warning:data count must lessEqual than 4")},e.addRGB=function(t,e){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==t&&(t=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._rgbElements[this._rgbCurrentLength++]=t,this._rgbElements[this._rgbCurrentLength++]=e.x,this._rgbElements[this._rgbCurrentLength++]=e.y,this._rgbElements[this._rgbCurrentLength++]=e.z):console.log("GradientDataColor warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t,i=0,n=0;e._alphaCurrentLength=this._alphaCurrentLength;var r=e._alphaElements;for(r.length=this._alphaElements.length,i=0,n=this._alphaElements.length;i<n;i++)r[i]=this._alphaElements[i];e._rgbCurrentLength=this._rgbCurrentLength;var a=e._rgbElements;for(a.length=this._rgbElements.length,i=0,n=this._rgbElements.length;i<n;i++)a[i]=this._rgbElements[i]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),a(0,e,"rgbGradientCount",function(){return this._rgbCurrentLength/4}),t}(),Q=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}r(t,"laya.d3.core.particleShuriKen.module.GradientDataInt");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("Warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),$=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}r(t,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("GradientDataNumber warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("GradientDataNumber warning:data count must lessEqual than 4")},e.getKeyByIndex=function(t){return this._elements[2*t]},e.getValueByIndex=function(t){return this._elements[2*t+1]},e.getAverageValue=function(){for(var t=0,e=this._currentLength-2;t<e;t+=2)this._elements[t+1],this._elements[t+3],this._elements[t+2],this._elements[t];return 0},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;for(var i=e._elements,n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),J=(function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}r(t,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e.x,this._elements[this._currentLength++]=e.y):console.log("GradientDataVector2 warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"gradientCount",function(){return this._currentLength/3})}(),function(){function t(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}r(t,"laya.d3.core.particleShuriKen.module.GradientSize");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.getMaxSizeInGradient=function(){var t=0,e=0,i=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(t=0,e=this._gradientX.gradientCount;t<e;t++)i=Math.max(i,this._gradientX.getValueByIndex(t));for(t=0,e=this._gradientY.gradientCount;t<e;t++)i=Math.max(i,this._gradientY.getValueByIndex(t))}else for(t=0,e=this._gradient.gradientCount;t<e;t++)i=Math.max(i,this._gradient.getValueByIndex(t));break;case 1:this._separateAxes?(i=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),i=Math.max(i,this._constantMinSeparate.y),i=Math.max(i,this._constantMaxSeparate.y)):i=Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(t=0,e=this._gradientXMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMin.getValueByIndex(t));for(t=0,e=this._gradientXMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMax.getValueByIndex(t));for(t=0,e=this._gradientYMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientYMin.getValueByIndex(t));for(t=0,e=this._gradientZMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientZMax.getValueByIndex(t))}else{for(t=0,e=this._gradientMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientMin.getValueByIndex(t));for(t=0,e=this._gradientMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientMax.getValueByIndex(t))}}return i},e.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"gradientZ",function(){return this._gradientZ}),a(0,e,"gradient",function(){return this._gradient}),a(0,e,"separateAxes",function(){return this._separateAxes}),a(0,e,"type",function(){return this._type}),a(0,e,"gradientMin",function(){return this._gradientMin}),a(0,e,"constantMin",function(){return this._constantMin}),a(0,e,"gradientX",function(){return this._gradientX}),a(0,e,"gradientY",function(){return this._gradientY}),a(0,e,"gradientMax",function(){return this._gradientMax}),a(0,e,"constantMax",function(){return this._constantMax}),a(0,e,"constantMinSeparate",function(){return this._constantMinSeparate}),a(0,e,"constantMaxSeparate",function(){return this._constantMaxSeparate}),a(0,e,"gradientXMin",function(){return this._gradientXMin}),a(0,e,"gradientXMax",function(){return this._gradientXMax}),a(0,e,"gradientYMin",function(){return this._gradientYMin}),a(0,e,"gradientYMax",function(){return this._gradientYMax}),a(0,e,"gradientZMin",function(){return this._gradientZMin}),a(0,e,"gradientZMax",function(){return this._gradientZMax}),t.createByGradient=function(e){var i=new t;return i._type=0,i._separateAxes=!1,i._gradient=e,i},t.createByGradientSeparate=function(e,i,n){var r=new t;return r._type=0,r._separateAxes=!0,r._gradientX=e,r._gradientY=i,r._gradientZ=n,r},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=1,n._separateAxes=!1,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoConstantSeparate=function(e,i){var n=new t;return n._type=1,n._separateAxes=!0,n._constantMinSeparate=e,n._constantMaxSeparate=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=2,n._separateAxes=!1,n._gradientMin=e,n._gradientMax=i,n},t.createByRandomTwoGradientSeparate=function(e,i,n,r,a,s){var o=new t;return o._type=2,o._separateAxes=!0,o._gradientXMin=e,o._gradientXMax=i,o._gradientYMin=n,o._gradientYMax=r,o._gradientZMin=a,o._gradientZMax=s,o},t}()),tt=function(){function t(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}r(t,"laya.d3.core.particleShuriKen.module.GradientVelocity");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"gradientZ",function(){return this._gradientZ}),a(0,e,"constant",function(){return this._constant}),a(0,e,"type",function(){return this._type}),a(0,e,"gradientXMax",function(){return this._gradientXMax}),a(0,e,"constantMin",function(){return this._constantMin}),a(0,e,"gradientX",function(){return this._gradientX}),a(0,e,"gradientY",function(){return this._gradientY}),a(0,e,"gradientXMin",function(){return this._gradientXMin}),a(0,e,"constantMax",function(){return this._constantMax}),a(0,e,"gradientYMin",function(){return this._gradientYMin}),a(0,e,"gradientYMax",function(){return this._gradientYMax}),a(0,e,"gradientZMin",function(){return this._gradientZMin}),a(0,e,"gradientZMax",function(){return this._gradientZMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByGradient=function(e,i,n){var r=new t;return r._type=1,r._gradientX=e,r._gradientY=i,r._gradientZ=n,r},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoGradient=function(e,i,n,r,a,s){var o=new t;return o._type=3,o._gradientXMin=e,o._gradientXMax=i,o._gradientYMin=n,o._gradientYMax=r,o._gradientZMin=a,o._gradientZMax=s,o},t}(),et=function(){function t(t){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=t}r(t,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._angularVelocity.cloneTo(e._angularVelocity),e.enbale=this.enbale},e.clone=function(){var t;switch(this._angularVelocity.type){case 0:t=this._angularVelocity.separateAxes?K.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):K.createByConstant(this._angularVelocity.constant);break;case 1:t=this._angularVelocity.separateAxes?K.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):K.createByGradient(this._angularVelocity.gradient.clone());break;case 2:t=this._angularVelocity.separateAxes?K.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):K.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:t=this._angularVelocity.separateAxes?K.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):K.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},a(0,e,"angularVelocity",function(){return this._angularVelocity}),t}(),it=function(){function t(){this.enable=!1,this.randomDirection=!1}r(t,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e._getShapeBoundBox=function(t){throw new Error("BaseShape: must override it.")},e._getSpeedBoundBox=function(t){throw new Error("BaseShape: must override it.")},e.generatePositionAndDirection=function(t,e,i,n){throw new Error("BaseShape: must override it.")},e._calculateProceduralBounds=function(t,e,i){this._getShapeBoundBox(t);var n=t.min,r=t.max;Pe.multiply(n,e,n),Pe.multiply(r,e,r);var a=new Se(new Pe,new Pe);this.randomDirection?(a.min=new Pe(-1,-1,-1),a.max=new Pe(1,1,1)):this._getSpeedBoundBox(a);var s=new Se(new Pe,new Pe),o=s.min,l=s.max;Pe.scale(a.min,i.y,o),Pe.scale(a.max,i.y,l),Pe.add(t.min,o,o),Pe.add(t.max,l,l),Pe.min(t.min,o,t.min),Pe.max(t.max,o,t.max);var h=new Se(new Pe,new Pe),c=h.min,u=h.max;Pe.scale(a.min,i.x,c),Pe.scale(a.max,i.x,u),Pe.min(h.min,u,o),Pe.max(h.min,u,l),Pe.min(t.min,o,t.min),Pe.max(t.max,o,t.max)},e.cloneTo=function(t){t.enable=this.enable},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}(),nt=function(){function t(){}return r(t,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),t._randomPointUnitArcCircle=function(t,e,i){var n,r=e.elements;n=i?i.getFloat()*t:Math.random()*t,r[0]=Math.cos(n),r[1]=Math.sin(n)},t._randomPointInsideUnitArcCircle=function(e,i,n){var r=i.elements;t._randomPointUnitArcCircle(e,i,n);var a;a=n?Math.pow(n.getFloat(),.5):Math.pow(Math.random(),.5),r[0]=r[0]*a,r[1]=r[1]*a},t._randomPointUnitCircle=function(t,e){var i,n=t.elements;i=e?e.getFloat()*Math.PI*2:Math.random()*Math.PI*2,n[0]=Math.cos(i),n[1]=Math.sin(i)},t._randomPointInsideUnitCircle=function(e,i){var n=e.elements;t._randomPointUnitCircle(e);var r;r=i?Math.pow(i.getFloat(),.5):Math.pow(Math.random(),.5),n[0]=n[0]*r,n[1]=n[1]*r},t._randomPointUnitSphere=function(t,e){var i=t.elements,n=NaN,r=NaN;e?(n=i[2]=2*e.getFloat()-1,r=e.getFloat()*Math.PI*2):(n=i[2]=2*Math.random()-1,r=Math.random()*Math.PI*2);var a=Math.sqrt(1-n*n);i[0]=a*Math.cos(r),i[1]=a*Math.sin(r)},t._randomPointInsideUnitSphere=function(e,i){var n=e.elements;t._randomPointUnitSphere(e);var r;r=i?Math.pow(i.getFloat(),1/3):Math.pow(Math.random(),1/3),n[0]=n[0]*r,n[1]=n[1]*r,n[2]=n[2]*r},t._randomPointInsideHalfUnitBox=function(t,e){var i=t.elements;e?(i[0]=e.getFloat()-.5,i[1]=e.getFloat()-.5,i[2]=e.getFloat()-.5):(i[0]=Math.random()-.5,i[1]=Math.random()-.5,i[2]=Math.random()-.5)},t}(),rt=function(){function t(t){this._size=null,this.enbale=!1,this._size=t}r(t,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._size.cloneTo(e._size),e.enbale=this.enbale},e.clone=function(){var t;switch(this._size.type){case 0:t=this._size.separateAxes?J.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):J.createByGradient(this._size.gradient.clone());break;case 1:t=this._size.separateAxes?J.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):J.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:t=this._size.separateAxes?J.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):J.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},a(0,e,"size",function(){return this._size}),t}(),at=function(){function t(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}r(t,"laya.d3.core.particleShuriKen.module.StartFrame");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,e._constantMin=this._constantMin,e._constantMax=this._constantMax},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"constant",function(){return this._constant}),a(0,e,"type",function(){return this._type}),a(0,e,"constantMin",function(){return this._constantMin}),a(0,e,"constantMax",function(){return this._constantMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=1,n._constantMin=e,n._constantMax=i,n},t}(),st=function(){function t(t,e){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new Le(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=t,this._startFrame=e}r(t,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this.tiles.cloneTo(e.tiles),e.type=this.type,e.randomRow=this.randomRow,this._frame.cloneTo(e._frame),this._startFrame.cloneTo(e._startFrame),e.cycles=this.cycles,e.enableUVChannels=this.enableUVChannels,e.enable=this.enable},e.clone=function(){var t,e;switch(this._frame.type){case 0:t=j.createByConstant(this._frame.constant);break;case 1:t=j.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:t=j.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:t=j.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:e=at.createByConstant(this._startFrame.constant);break;case 1:e=at.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var i=new this.constructor(t,e);return this.tiles.cloneTo(i.tiles),i.type=this.type,i.randomRow=this.randomRow,i.cycles=this.cycles,i.enableUVChannels=this.enableUVChannels,i.enable=this.enable,i},a(0,e,"frame",function(){return this._frame}),a(0,e,"startFrame",function(){return this._startFrame}),t}(),ot=function(){function t(t){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=t}r(t,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._velocity.cloneTo(e._velocity),e.enbale=this.enbale,e.space=this.space},e.clone=function(){var t;switch(this._velocity.type){case 0:t=tt.createByConstant(this._velocity.constant.clone());break;case 1:t=tt.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:t=tt.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:t=tt.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e.space=this.space,e},a(0,e,"velocity",function(){return this._velocity}),t}(),lt=function(){function t(){}return r(t,"laya.d3.core.particleShuriKen.ShurikenParticleData"),t._getStartLifetimeFromGradient=function(t,e){for(var i=1,n=t.gradientCount;i<n;i++){var r=t.getKeyByIndex(i);if(r>=e){var a=t.getKeyByIndex(i-1),s=(e-a)/(r-a);return x.lerp(t.getValueByIndex(i-1),t.getValueByIndex(i),s)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")},t._randomInvertRoationArray=function(t,e,i,n,r){var a=NaN;n?(n.seed=r[6],a=n.getFloat(),r[6]=n.seed):a=Math.random(),a<i?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])},t._randomInvertRoation=function(t,e,i,n){var r=NaN;return i?(i.seed=n[6],r=i.getFloat(),n[6]=i.seed):r=Math.random(),r<e&&(t=-t),t},t.create=function(e,i,n){var r=e.autoRandomSeed,a=e._rand,s=e._randomSeeds;switch(e.startColorType){case 0:var o=e.startColorConstant.elements;t.startColor[0]=o[0],t.startColor[1]=o[1],t.startColor[2]=o[2],t.startColor[3]=o[3];break;case 2:r?x.lerpVector4(e.startColorConstantMin.elements,e.startColorConstantMax.elements,Math.random(),t.startColor):(a.seed=s[3],x.lerpVector4(e.startColorConstantMin.elements,e.startColorConstantMax.elements,a.getFloat(),t.startColor),s[3]=a.seed)}var l=e.colorOverLifetime;if(l&&l.enbale){var h=l.color;switch(h.type){case 0:t.startColor[0]=t.startColor[0]*h.constant.x,t.startColor[1]=t.startColor[1]*h.constant.y,t.startColor[2]=t.startColor[2]*h.constant.z,t.startColor[3]=t.startColor[3]*h.constant.w;break;case 2:var c=NaN;r?c=Math.random():(a.seed=s[10],c=a.getFloat(),s[10]=a.seed);var u=h.constantMin,_=h.constantMax;t.startColor[0]=t.startColor[0]*x.lerp(u.x,_.x,c),t.startColor[1]=t.startColor[1]*x.lerp(u.y,_.y,c),t.startColor[2]=t.startColor[2]*x.lerp(u.z,_.z,c),t.startColor[3]=t.startColor[3]*x.lerp(u.w,_.w,c)}}var d=t.startSize;switch(e.startSizeType){case 0:if(e.threeDStartSize){var f=e.startSizeConstantSeparate;d[0]=f.x,d[1]=f.y,d[2]=f.z}else d[0]=d[1]=d[2]=e.startSizeConstant;break;case 2:if(e.threeDStartSize){var p=e.startSizeConstantMinSeparate,m=e.startSizeConstantMaxSeparate;r?(d[0]=x.lerp(p.x,m.x,Math.random()),d[1]=x.lerp(p.y,m.y,Math.random()),d[2]=x.lerp(p.z,m.z,Math.random())):(a.seed=s[4],d[0]=x.lerp(p.x,m.x,a.getFloat()),d[1]=x.lerp(p.y,m.y,a.getFloat()),d[2]=x.lerp(p.z,m.z,a.getFloat()),s[4]=a.seed)}else r?d[0]=d[1]=d[2]=x.lerp(e.startSizeConstantMin,e.startSizeConstantMax,Math.random()):(a.seed=s[4],d[0]=d[1]=d[2]=x.lerp(e.startSizeConstantMin,e.startSizeConstantMax,a.getFloat()),s[4]=a.seed)}var g=e.sizeOverLifetime;if(g&&g.enbale&&1===g.size.type){var y=g.size;if(y.separateAxes)r?(d[0]=d[0]*x.lerp(y.constantMinSeparate.x,y.constantMaxSeparate.x,Math.random()),d[1]=d[1]*x.lerp(y.constantMinSeparate.y,y.constantMaxSeparate.y,Math.random()),d[2]=d[2]*x.lerp(y.constantMinSeparate.z,y.constantMaxSeparate.z,Math.random())):(a.seed=s[11],d[0]=d[0]*x.lerp(y.constantMinSeparate.x,y.constantMaxSeparate.x,a.getFloat()),d[1]=d[1]*x.lerp(y.constantMinSeparate.y,y.constantMaxSeparate.y,a.getFloat()),d[2]=d[2]*x.lerp(y.constantMinSeparate.z,y.constantMaxSeparate.z,a.getFloat()),s[11]=a.seed);else{var v=NaN;r?v=x.lerp(y.constantMin,y.constantMax,Math.random()):(a.seed=s[11],v=x.lerp(y.constantMin,y.constantMax,a.getFloat()),s[11]=a.seed),d[0]=d[0]*v,d[1]=d[1]*v,d[2]=d[2]*v}}var S=i.renderMode;if(1!==S)switch(e.startRotationType){case 0:if(e.threeDStartRotation){var E=e.startRotationConstantSeparate,T=t._tempVector30.elements;t._randomInvertRoationArray(E.elements,T,e.randomizeRotationDirection,r?null:a,s),t.startRotation[0]=T[0],t.startRotation[1]=T[1],t.startRotation[2]=4!==S?-T[2]:T[2]}else t.startRotation[0]=t._randomInvertRoation(e.startRotationConstant,e.randomizeRotationDirection,r?null:a,s);break;case 2:if(e.threeDStartRotation){var w=e.startRotationConstantMinSeparate,C=e.startRotationConstantMaxSeparate,b=t._tempVector30.elements;r?(b[0]=x.lerp(w.x,C.x,Math.random()),b[1]=x.lerp(w.y,C.y,Math.random()),b[2]=x.lerp(w.z,C.z,Math.random())):(a.seed=s[5],b[0]=x.lerp(w.x,C.x,a.getFloat()),b[1]=x.lerp(w.y,C.y,a.getFloat()),b[2]=x.lerp(w.z,C.z,a.getFloat()),s[5]=a.seed),t._randomInvertRoationArray(b,b,e.randomizeRotationDirection,r?null:a,s),t.startRotation[0]=b[0],t.startRotation[1]=b[1],t.startRotation[2]=4!==S?-b[2]:b[2]}else r?t.startRotation[0]=t._randomInvertRoation(x.lerp(e.startRotationConstantMin,e.startRotationConstantMax,Math.random()),e.randomizeRotationDirection,r?null:a,s):(a.seed=s[5],t.startRotation[0]=t._randomInvertRoation(x.lerp(e.startRotationConstantMin,e.startRotationConstantMax,a.getFloat()),e.randomizeRotationDirection,r?null:a,s),s[5]=a.seed)}switch(e.startLifetimeType){case 0:t.startLifeTime=e.startLifetimeConstant;break;case 1:t.startLifeTime=t._getStartLifetimeFromGradient(e.startLifeTimeGradient,e.emissionTime);break;case 2:r?t.startLifeTime=x.lerp(e.startLifetimeConstantMin,e.startLifetimeConstantMax,Math.random()):(a.seed=s[7],t.startLifeTime=x.lerp(e.startLifetimeConstantMin,e.startLifetimeConstantMax,a.getFloat()),s[7]=a.seed);break;case 3:var M=e.emissionTime;r?t.startLifeTime=x.lerp(t._getStartLifetimeFromGradient(e.startLifeTimeGradientMin,M),t._getStartLifetimeFromGradient(e.startLifeTimeGradientMax,M),Math.random()):(a.seed=s[7],t.startLifeTime=x.lerp(t._getStartLifetimeFromGradient(e.startLifeTimeGradientMin,M),t._getStartLifetimeFromGradient(e.startLifeTimeGradientMax,M),a.getFloat()),s[7]=a.seed)}switch(e.startSpeedType){case 0:t.startSpeed=e.startSpeedConstant;break;case 2:r?t.startSpeed=x.lerp(e.startSpeedConstantMin,e.startSpeedConstantMax,Math.random()):(a.seed=s[8],t.startSpeed=x.lerp(e.startSpeedConstantMin,e.startSpeedConstantMax,a.getFloat()),s[8]=a.seed)}var I=e.textureSheetAnimation;if(I&&I.enable){var D=I.tiles,A=D.x,R=D.y,L=1/A,P=1/R,N=0,O=I.startFrame;switch(O.type){case 0:N=O.constant;break;case 1:r?N=x.lerp(O.constantMin,O.constantMax,Math.random()):(a.seed=s[14],N=x.lerp(O.constantMin,O.constantMax,a.getFloat()),s[14]=a.seed)}var V=I.frame;switch(V.type){case 0:N+=V.constant;break;case 2:r?N+=x.lerp(V.constantMin,V.constantMax,Math.random()):(a.seed=s[15],N+=x.lerp(V.constantMin,V.constantMax,a.getFloat()),s[15]=a.seed)}var k=0;switch(I.type){case 0:k=Math.floor(N/A);break;case 1:I.randomRow?r?k=Math.floor(Math.random()*R):(a.seed=s[13],k=Math.floor(a.getFloat()*R),s[13]=a.seed):k=I.rowIndex}var F=Math.floor(N%A);(t.startUVInfo=t.startUVInfo)[0]=L,t.startUVInfo[1]=P,t.startUVInfo[2]=F*L,t.startUVInfo[3]=k*P}else(t.startUVInfo=t.startUVInfo)[0]=1,t.startUVInfo[1]=1,t.startUVInfo[2]=0,t.startUVInfo[3]=0;switch(e.simulationSpace){case 0:var B=n.position.elements;t.simulationWorldPostion[0]=B[0],t.simulationWorldPostion[1]=B[1],t.simulationWorldPostion[2]=B[2];var U=n.rotation.elements;t.simulationWorldRotation[0]=U[0],t.simulationWorldRotation[1]=U[1],t.simulationWorldRotation[2]=U[2],t.simulationWorldRotation[3]=U[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}},t.startLifeTime=NaN,t.startSpeed=NaN,n(t,["_tempVector30",function(){return this._tempVector30=new Pe},"_tempQuaternion",function(){return this._tempQuaternion=new De},"startColor",function(){return this.startColor=new Float32Array(4)},"startSize",function(){return this.startSize=new Float32Array(3)},"startRotation",function(){return this.startRotation=new Float32Array(3)},"startUVInfo",function(){return this.startUVInfo=new Float32Array(4)},"simulationWorldPostion",function(){return this.simulationWorldPostion=new Float32Array(3)},"simulationWorldRotation",function(){return this.simulationWorldRotation=new Float32Array(4)}]),t}(),ht=function(){function t(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new Ue,this._vb=Ki.create(t._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=ji.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=ki.nameKey.getID("LINE"),this._shaderCompile=ci._preCompileShader[this._sharderNameID]}r(t,"laya.d3.core.PhasorSpriter3D");var e=t.prototype;return e.line=function(t,e,i,n){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t.x,t.y,t.z,e.x,e.y,e.z,e.w),this.addVertex(i.x,i.y,i.z,n.x,n.y,n.z,n.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},e.circle=function(t,e,i,n,r,a){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*e,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/e,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*t,Math.cos(this._tempNumver0)*t,0,i,n,r,a),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},e.plane=function(t,e,i,n,r,a,s,o,l){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i,a,s,o,l),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i,a,s,o,l),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i,a,s,o,l),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i,a,s,o,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},e.box=function(t,e,i,n,r,a,s,o,l,h){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempNumver2=a/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,s,o,l,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},e.cone=function(t,e,i,n,r,a,s){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*i+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*i>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/i,this.addVertexIndex(0,e,0,n,r,a,s,this._tempUint0),this.addVertexIndex(0,0,0,n,r,a,s,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<i;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,a,s,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==i-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,a,s,this._tempUint0+(this._tempInt0+i)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==i-1?this.addIndexes(this._tempUint1+i+2):this.addIndexes(this._tempUint1+this._tempInt0+i+1),this.addIndexes(this._tempUint1+this._tempInt0+i),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},e.boundingBoxLine=function(t,e,i,n,r,a,s,o,l,h){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t,r,a,s,o,l,h),this.addVertex(n,r,a,s,o,l,h),this.addVertex(t,e,a,s,o,l,h),this.addVertex(n,e,a,s,o,l,h),this.addVertex(n,r,i,s,o,l,h),this.addVertex(t,r,i,s,o,l,h),this.addVertex(n,e,i,s,o,l,h),this.addVertex(t,e,i,s,o,l,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},e.addVertex=function(t,e,i,n,r,a,s){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=t,this._vbData[this._posInVBData+1]=e,this._vbData[this._posInVBData+2]=i,this._vbData[this._posInVBData+3]=n,this._vbData[this._posInVBData+4]=r,this._vbData[this._posInVBData+5]=a,this._vbData[this._posInVBData+6]=s,this._posInVBData+=this._floatSizePerVer,this},e.addVertexIndex=function(t,e,i,n,r,a,s,o){return this._hasBegun||this.addVertexIndexException(),this._vbData[o]=t,this._vbData[o+1]=e,this._vbData[o+2]=i,this._vbData[o+3]=n,this._vbData[o+4]=r,this._vbData[o+5]=a,this._vbData[o+6]=s,(o+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=o),this},e.addIndexes=function(t){var e=arguments;this._hasBegun||this.addVertexIndexException();for(var i=0;i<e.length;i++)this._ibData[this._posInIBData]=e[i],this._posInIBData++;return this},e.begin=function(t,e){return this._hasBegun&&this.beginException0(),1!==t&&4!==t&&this.beginException1(),this._primitiveType=t,this._camera=e,this._hasBegun=!0,this},e.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},e.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(t._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),D.drawCall++,P.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},e.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},e.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},e.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},e.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},e.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},e.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(28,[new Mt(0,"vector3",0),new Mt(12,"vector4",1)])}]),t}(),ct=function(){function t(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++t._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new Ue}r(t,"laya.d3.core.render.RenderElement");var e=t.prototype;return e.getDynamicBatchBakedVertexs=function(t){for(var e=this._renderObj._getVertexBuffer(t),i=e.getData().slice(),n=e.vertexDeclaration,r=n.getVertexElementByUsage(0).offset/4,a=n.getVertexElementByUsage(3).offset/4,s=this._sprite3D.transform,o=s.worldMatrix,l=s.rotation,h=n.vertexStride/4,c=0,u=i.length;c<u;c+=h){var _=c+r,d=c+a;Ze.transformVector3ArrayToVector3ArrayCoordinate(i,_,o,i,_),Ze.transformVector3ArrayByQuat(i,d,l,i,d)}return i},e.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},e._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},a(0,e,"id",function(){return this._id}),a(0,e,"renderObj",function(){return this._renderObj},function(t){this._renderObj!==t&&(this._renderObj=t)}),t._uniqueIDCounter=0,t}(),ut=function(){function t(e){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++t._uniqueIDCounter,this._needSort=!1,this._scene=e,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[]}r(t,"laya.d3.core.render.RenderQueue");var e=t.prototype;return e._sortOpaqueFunc=function(t,e){if(t._render&&e._render){var i=t._material.renderQueue-e._material.renderQueue;return console.log(t._material),console.log(e._material),console.log(i),0===i?t._render._distanceForSort-e._render._distanceForSort:i}return 0},e._sortAlphaFunc=function(t,e){if(t._render&&e._render){var i=t._material.renderQueue-e._material.renderQueue;return 0===i?e._render._distanceForSort-t._render._distanceForSort:i}return 0},e._begainRenderElement=function(t,e,i){return!!e._beforeRender(t)},e._sortAlpha=function(e){t._cameraPosition=e,this._finalElements.sort(this._sortAlphaFunc)},e._sortOpaque=function(e){t._cameraPosition=e,console.log("HERE _sortOpaque"),this._finalElements.sort(this._sortOpaqueFunc)},e._preRender=function(t){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},e._render=function(t,e){for(var i,n,r,a,s,o,l=D.loopCount,h=this._scene,c=t.camera,u=(c.id,!1),_=0,d=this._finalElements.length;_<d;_++){var f,p,m,g=this._finalElements[_];if(null!=g._onPreRenderFunction&&g._onPreRenderFunction.call(g._sprite3D,t),0===g._type){if(t.owner=m=g._sprite3D,t.renderElement=g,m._preRenderUpdateComponents(t),f=g.renderObj,p=g._material,this._begainRenderElement(t,f,p)){if(i=f._getVertexBuffers(),r=(n=f._getVertexBuffer(0)).vertexDeclaration,u=(a=t._shader=p._getShader(h._shaderDefineValue,r.shaderDefineValue,m._shaderDefineValue)).bind()||l!==a._uploadLoopCount,i){if(a._uploadVertexBuffer!==i||u){for(var y=0;y<i.length;y++){var v=i[y];a.uploadAttributesX(v.vertexDeclaration.shaderValues.data,v)}a._uploadVertexBuffer=i}}else(a._uploadVertexBuffer!==n||u)&&(a.uploadAttributes(r.shaderValues.data,null),a._uploadVertexBuffer=n);(a._uploadScene!==h||u)&&(a.uploadSceneUniforms(h._shaderValues.data),a._uploadScene=h),(c!==a._uploadCamera||a._uploadSprite3D!==m||u)&&(a.uploadSpriteUniforms(m._shaderValues.data),a._uploadSprite3D=m),(c!==a._uploadCamera||u)&&(a.uploadCameraUniforms(c._shaderValues.data),a._uploadCamera=c),(a._uploadMaterial!==p||u)&&(p._upload(),a._uploadMaterial=p),s!==p?(p._setRenderStateBlendDepth(),p._setRenderStateFrontFace(e,m.transform),s=p,o=m):o!==m&&(p._setRenderStateFrontFace(e,m.transform),o=m),f._render(t),a._uploadLoopCount=l}m._postRenderUpdateComponents(t)}else 2===g._type&&(g.renderObj,t.owner=m=g._sprite3D,t.renderElement=g,t._batchIndexStart=g._tempBatchIndexStart,t._batchIndexEnd=g._tempBatchIndexEnd,f=g.renderObj,p=g._material,this._begainRenderElement(t,f,p)&&(r=(n=f._getVertexBuffer(0)).vertexDeclaration,u=(a=t._shader=p._getShader(h._shaderDefineValue,r.shaderDefineValue,m._shaderDefineValue)).bind()||l!==a._uploadLoopCount,(a._uploadVertexBuffer!==n||u)&&(a.uploadAttributes(r.shaderValues.data,null),a._uploadVertexBuffer=n),(a._uploadScene!==h||u)&&(a.uploadSceneUniforms(h._shaderValues.data),a._uploadScene=h),(c!==a._uploadCamera||a._uploadSprite3D!==m||u)&&(a.uploadSpriteUniforms(m._shaderValues.data),a._uploadSprite3D=m),(c!==a._uploadCamera||u)&&(a.uploadCameraUniforms(c._shaderValues.data),a._uploadCamera=c),(a._uploadMaterial!==p||u)&&(p._upload(),a._uploadMaterial=p),s!==p?(p._setRenderStateBlendDepth(),p._setRenderStateFrontFace(e,m.transform),s=p,o=m):o!==m&&(p._setRenderStateFrontFace(e,m.transform),o=m),f._render(t),a._uploadLoopCount=l))}},e._renderShadow=function(t,e){for(var i,n,r,a,s,o=D.loopCount,l=this._scene,h=t.camera,c=!1,u=0,_=this._finalElements.length;u<_;u++){var d,f,p,m=this._finalElements[u];0===m._type&&(t.owner=p=m._sprite3D,e||p._projectionViewWorldUpdateCamera===h&&p._projectionViewWorldUpdateLoopCount===D.loopCount||(p._render._renderUpdate(t._projectionViewMatrix),p._projectionViewWorldUpdateLoopCount=D.loopCount,p._projectionViewWorldUpdateCamera=h),t.renderElement=m,p._preRenderUpdateComponents(t),d=m.renderObj,f=m._material,this._begainRenderElement(t,d,null)&&(n=(i=d._getVertexBuffer(0)).vertexDeclaration,c=(r=t._shader=f._getShader(l._shaderDefineValue,n.shaderDefineValue,p._shaderDefineValue)).bind()||o!==r._uploadLoopCount,(r._uploadVertexBuffer!==i||c)&&(r.uploadAttributes(n.shaderValues.data,null),r._uploadVertexBuffer=i),(h!==r._uploadCamera||r._uploadSprite3D!==p||c)&&(r.uploadSpriteUniforms(p._shaderValues.data),r._uploadSprite3D=p),(h!==r._uploadCamera||c)&&(r.uploadCameraUniforms(h._shaderValues.data),r._uploadCamera=h),(r._uploadMaterial!==f||c)&&(f._upload(),r._uploadMaterial=f),r._uploadRenderElement,a!==f?(f._setRenderStateFrontFace(!1,p.transform),a=f,s=p):s!==p&&(f._setRenderStateFrontFace(!1,p.transform),s=p),d._render(t),r._uploadLoopCount=o),p._postRenderUpdateComponents(t))}},e._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},e._addRenderElement=function(t){this._renderElements.push(t),this._needSort=!0},e._addDynamicBatchElement=function(t){this._dynamicBatchCombineRenderElements.push(t)},a(0,e,"id",function(){return this._id}),t._uniqueIDCounter=0,t._cameraPosition=null,t}(),_t=function(){function t(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return r(t,"laya.d3.core.render.RenderState"),t.clientWidth=0,t.clientHeight=0,t}(),dt=function(){function t(t,e){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new Ee(new Pe,0),this._corners=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe],this._boundingBoxCenter=new Pe,this._children=s(8),this._objects=[],this._tempBoundBoxCorners=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe],this._scene=t,this._currentDepth=e}r(t,"laya.d3.core.scene.OctreeNode");var e=t.prototype;return i.imps(e,{"laya.d3.core.scene.ITreeNode":!0}),e.init=function(t,e){var i=new Pe,n=new Pe;Pe.scale(e,-.5,i),Pe.scale(e,.5,n),Pe.add(i,t,i),Pe.add(n,t,n),this.exactBox=new Se(i,n),this.relaxBox=new Se(i,n)},e.addTreeNode=function(t){1===Te.boxContainsBox(this._relaxBox,t.boundingBox)?this.addNodeDown(t,0):this.addObject(t)},e.addChild=function(e){var i=this._children[e];if(null==i){i=new t(this._scene,this._currentDepth+1),this._children[e]=i,i._parent=this,Pe.subtract(this._exactBox.max,this._exactBox.min,t.tempSize),Pe.multiply(t.tempSize,t._octreeSplit[e],t.tempCenter),Pe.add(this._exactBox.min,t.tempCenter,t.tempCenter),Pe.scale(t.tempSize,.25,t.tempSize);var n=new Pe,r=new Pe;Pe.subtract(t.tempCenter,t.tempSize,n),Pe.add(t.tempCenter,t.tempSize,r),i.exactBox=new Se(n,r),Pe.scale(t.tempSize,t.relax,t.tempSize);var a=new Pe,s=new Pe;Pe.subtract(t.tempCenter,t.tempSize,a),Pe.add(t.tempCenter,t.tempSize,s),i.relaxBox=new Se(a,s)}return i},e.addObject=function(t){t._treeNode=this,this._objects.push(t)},e.removeObject=function(t){if(t._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var e=this._objects.indexOf(t);return-1!==e&&(this._objects.splice(e,1),!0)},e.clearObject=function(){this._objects.length=0},e.addNodeUp=function(t,e){this._parent&&1!==Te.boxContainsBox(this._exactBox,t.boundingBox)?this._parent.addNodeUp(t,e-1):this.addNodeDown(t,e)},e.addNodeDown=function(t,e){if(e<this._scene.treeLevel){var i=this.inChildIndex(t.boundingBoxCenter),n=this.addChild(i);1===Te.boxContainsBox(n._relaxBox,t.boundingBox)?n.addNodeDown(t,++e):this.addObject(t)}else this.addObject(t)},e.inChildIndex=function(t){return 4*(t.z<this._boundingBoxCenter.z?0:1)+2*(t.y<this._boundingBoxCenter.y?0:1)+(t.x<this._boundingBoxCenter.x?0:1)},e.updateObject=function(t){1===Te.boxContainsBox(this._relaxBox,t.boundingBox)?(this.removeObject(t),t._treeNode=null,this.addNodeDown(t,this._currentDepth)):this._parent&&(this.removeObject(t),t._treeNode=null,this._parent.addNodeUp(t,this._currentDepth-1))},e.cullingObjects=function(t,e,i,n,r){var a,s=0,o=0,l=0,h=this._scene._dynamicBatchManager;for(s=0,a=this._objects.length;s<a;s++){var c=this._objects[s];if(W.isVisible(c._owner.layer.mask)&&c.enable){if(e&&(D.treeSpriteCollision+=1,0===t.containsBoundSphere(c.boundingSphere)))continue;c._renderUpdate(r),c._distanceForSort=Pe.distance(c.boundingSphere.center,n)+c.sortingFudge;var u=c._renderElements;for(o=0,l=u.length;o<l;o++){var _=u[o],d=_._staticBatch;if(d&&d._material===_._material)d._addBatchRenderElement(_);else{var f=_.renderObj;f.triangleCount<10&&1===f._vertexBufferCount&&f._getIndexBuffer()&&_._material.renderQueue<2&&_._canDynamicBatch&&!c._owner.isStatic?h._addPrepareRenderElement(_):this._scene.getRenderQueue(_._material.renderQueue)._addRenderElement(_)}}}}for(s=0;s<8;s++){var p=this._children[s];if(null!=p){var m=e;if(e){var g=t.containsBoundBox(p._relaxBox);if(D.treeNodeCollision+=1,0===g)continue;m=2===g}p.cullingObjects(t,m,i,n,r)}}},e.cullingShadowObjects=function(t,e,i,n,r){var a,s=0,o=0,l=0;for(this._scene._dynamicBatchManager,s=0,a=this._objects.length;s<a;s++){var h=this._objects[s];if(h.castShadow&&W.isVisible(h._owner.layer.mask)&&h.enable){if(i&&0===t[0].containsBoundSphere(h.boundingSphere))continue;for(var c=1,u=t.length;c<u;c++){var _=e[c-1];if(0!==t[c].containsBoundSphere(h.boundingSphere)){var d=h._renderElements;for(o=0,l=d.length;o<l;o++)_._addRenderElement(d[o])}}}}for(s=0;s<8;s++){var f=this._children[s];if(null!=f){var p=i;if(i){var m=t[0].containsBoundBox(f._relaxBox);if(0===m)continue;p=2===m}f.cullingShadowObjects(t,e,p,n,r)}}},e.cullingShadowObjectsOnePSSM=function(t,e,i,n,r,a){var s,o=e[0],l=0,h=0,c=0;for(l=0,s=this._objects.length;l<s;l++){var u=this._objects[l];if(u.castShadow&&W.isVisible(u._owner.layer.mask)&&u.enable){if(n&&0===t.containsBoundSphere(u.boundingSphere))continue;u._renderUpdate(i);var _=u._renderElements;for(h=0,c=_.length;h<c;h++)o._addRenderElement(_[h])}}for(l=0;l<8;l++){var d=this._children[l];if(null!=d){var f=n;if(n){var p=t.containsBoundBox(d._relaxBox);if(0===p)continue;f=2===p}d.cullingShadowObjectsOnePSSM(t,e,i,f,r,a)}}},e.renderBoudingBox=function(t){this._renderBoudingBox(t);for(var e=0;e<8;++e){var i=this._children[e];i&&i.renderBoudingBox(t)}},e.buildAllChild=function(t){if(t<this._scene.treeLevel)for(var e=0;e<8;e++)this.addChild(e).buildAllChild(t+1)},e._renderBoudingBox=function(t){},a(0,e,"exactBox",function(){return this._exactBox},function(t){this._exactBox=t,Pe.add(t.min,t.max,this._boundingBoxCenter),Pe.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),a(0,e,"relaxBox",function(){return this._relaxBox},function(t){this._relaxBox=t,t.getCorners(this._corners),Ee.createfromPoints(this._corners,this._boundingSphere)}),t.debugMode=!1,t.relax=1.15,t.CHILDNUM=8,n(t,["tempVector0",function(){return this.tempVector0=new Pe},"tempSize",function(){return this.tempSize=new Pe},"tempCenter",function(){return this.tempCenter=new Pe},"_octreeSplit",function(){return this._octreeSplit=[new Pe(.25,.25,.25),new Pe(.75,.25,.25),new Pe(.25,.75,.25),new Pe(.75,.75,.25),new Pe(.25,.25,.75),new Pe(.75,.25,.75),new Pe(.25,.75,.75),new Pe(.75,.75,.75)]}]),t}(),ft=(function(){r(function(){},"laya.d3.core.scene.SceneManager")}(),function(){function t(t,e,i,n){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),this._r=t,this._g=e,this._b=i,this._a=n}return r(t,"laya.d3.core.trail.module.Color",null,"Color$1"),t.prototype.cloneTo=function(t){t._r=this._r,t._g=this._g,t._b=this._b,t._a=this._a},n(t,["RED",function(){return this.RED=new t(1,0,0,1)},"GREEN",function(){return this.GREEN=new t(0,1,0,1)},"BLUE",function(){return this.BLUE=new t(0,0,1,1)},"CYAN",function(){return this.CYAN=new t(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new t(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new t(1,0,1,1)},"GRAY",function(){return this.GRAY=new t(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new t(1,1,1,1)},"BLACK",function(){return this.BLACK=new t(0,0,0,1)}]),t}()),pt=function(){function t(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}r(t,"laya.d3.core.trail.module.Gradient");var e=t.prototype;return e.setKeys=function(t,e){this._colorKeys=t,this.index=0;for(var i,n=0;n<t.length;n++){var r=(i=t[n]).color;this._colorKeyData[this.index++]=r._r,this._colorKeyData[this.index++]=r._g,this._colorKeyData[this.index++]=r._b,this._colorKeyData[this.index++]=i.time}this._alphaKeys=e,this.index=0;for(var a,s=0;s<e.length;s++)a=e[s],this._alphaKeyData[this.index++]=a.alpha,this._alphaKeyData[this.index++]=a.time},e.cloneTo=function(t){var e=0,i=0,n=this.colorKeys,r=[];for(e=0,i=n.length;e<i;e++){var a=new gt;n[e].cloneTo(a),r.push(a)}var s=this.alphaKeys,o=[];for(e=0,i=s.length;e<i;e++){var l=new mt;s[e].cloneTo(l),o.push(l)}t.setKeys(r,o)},a(0,e,"mode",function(){return this._mode},function(t){this._mode=t}),a(0,e,"colorKeys",function(){return this._colorKeys},function(t){this._colorKeys=t,this.index=0;for(var e=0;e<t.length;e++){var i=t[e],n=i.color;this._colorKeyData[this.index++]=n._r,this._colorKeyData[this.index++]=n._g,this._colorKeyData[this.index++]=n._b,this._colorKeyData[this.index++]=i.time}}),a(0,e,"alphaKeys",function(){return this._alphaKeys},function(t){this._alphaKeys=t,this.index=0;for(var e=0;e<t.length;e++){var i=t[e];this._alphaKeyData[this.index++]=i.alpha,this._alphaKeyData[this.index++]=i.time}}),t}(),mt=function(){function t(t,e){this._alpha=NaN,this._time=NaN,void 0===t&&(t=0),void 0===e&&(e=0),this._alpha=t,this._time=e}r(t,"laya.d3.core.trail.module.GradientAlphaKey");var e=t.prototype;return e.cloneTo=function(t){t.alpha=this.alpha,t.time=this.time},a(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),a(0,e,"time",function(){return this._time},function(t){this._time=t}),t}(),gt=function(){function t(t,e){this._color=null,this._time=NaN,void 0===e&&(e=0),this._color=t||new ft,this._time=e}r(t,"laya.d3.core.trail.module.GradientColorKey");var e=t.prototype;return e.cloneTo=function(t){this.color.cloneTo(t.color),t.time=this.time},a(0,e,"color",function(){return this._color},function(t){this._color=t}),a(0,e,"time",function(){return this._time},function(t){this._time=t}),t}(),yt=(function(){function t(){}r(t,"laya.d3.core.trail.module.GradientMode"),t.Blend=0,t.Fixed=1}(),function(){function t(){}r(t,"laya.d3.core.trail.module.TextureMode"),t.Stretch=0,t.Tile=1}(),function(){function t(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}return r(t,"laya.d3.core.trail.module.TrailKeyFrame"),t.prototype.cloneTo=function(t){t.time=this.time,t.inTangent=this.inTangent,t.outTangent=this.outTangent,t.value=this.value},t}()),vt=function(){function t(e){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new Pe,this._curPosition=new Pe,this._delVector3=new Pe,this._lastFixedVertexPosition=new Pe,this._pointAtoBVector3=new Pe,this._pointA=new Pe,this._pointB=new Pe,this._owner=e,this._id=t.renderElementCount++,0==this._id?e._owner.transform.position.cloneTo(this._lastPosition):e._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new Ki(St.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new Ki(St.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}r(t,"laya.d3.core.trail.TrailRenderElement");var e=t.prototype;return i.imps(e,{"laya.d3.core.render.IRenderable":!0}),e._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},e._addTrailByFirstPosition=function(t,e){Pe.subtract(e,t,this._delVector3),Pe.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),Pe.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Pe.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},e._addTrailByNextPosition=function(t){Pe.subtract(t,this._lastFixedVertexPosition,this._delVector3),Pe.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),Pe.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Pe.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=Pe.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=we.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(t),this._virtualVerticesCount=2)},e._updateVerticesByPosition=function(t){this._pointe=t.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},e._updateVertexBuffer2=function(){var t,e=0,i=0,n=0;for(n=0,t=(this._verticesCount+this._virtualVerticesCount)/2;n<t;n++)i=0==this._owner.textureMode?(this._VerticesToTailLength[n]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[n],this._vertices2[e++]=1-i,this._vertices2[e++]=1-i;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},e._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},e._updateDisappear=function(){var t,e=0;for(e=this._curDisappearIndex,t=(this._verticesCount+this._virtualVerticesCount)/2;e<t;e++)this._owner._curtime-this._everyGroupVertexBirthTime[e]>=this._owner.time+we.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},e._beforeRender=function(t){return this._camera=t.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),Pe.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),this._verticesCount>0)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},e._render=function(t){this._isDead||(P.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),D.drawCall++,D.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},e._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer1:1===t?this._vertexBuffer2:null},e._getVertexBuffers=function(){return this._vertexBuffers},e._getIndexBuffer=function(){return null},e.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},e._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},a(0,e,"_vertexBufferCount",function(){return this._vertexBuffers.length}),a(0,e,"triangleCount",function(){return 0}),t.renderElementCount=0,t}(),St=function(){function t(){}r(t,"laya.d3.core.trail.VertexTrail");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration1}),a(1,t,"vertexDeclaration1",function(){return t._vertexDeclaration1}),a(1,t,"vertexDeclaration2",function(){return t._vertexDeclaration2}),n(t,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new bt(32,[new Mt(0,"vector3",0),new Mt(12,"vector3",41),new Mt(24,"single",33),new Mt(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new bt(4,[new Mt(0,"single",38)])}]),t}(),xt=function(){function t(t){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=t}r(t,"laya.d3.graphics.DynamicBatch");var e=t.prototype;return i.imps(e,{"laya.d3.core.render.IRenderable":!0}),e._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._getCombineRenderElementFromPool=function(t,e,i){var n=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return n||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=n=new ct,n._sprite3D=new gn),n._sprite3D._render._renderUpdate(i),n},e._getRenderElement=function(e,i,n){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*t.maxVertexCount),this._indexDatas=new Uint16Array(t.maxIndexCount),this._vertexBuffer=Ki.create(this._vertexDeclaration,t.maxVertexCount,35048),this._indexBuffer=ji.create("ushort",t.maxIndexCount,35048)),this._merageElements.length=0;for(var r=0,a=0,s=0,o=this._combineRenderElements.length;s<o;s++){var l=this._combineRenderElements[s],h=l.getDynamicBatchBakedVertexs(0),c=l.getBakedIndices(),u=l._sprite3D.transform._isFrontFaceInvert,_=r/(this._vertexDeclaration.vertexStride/4),d=a,f=d+c.length;l._tempBatchIndexStart=d,l._tempBatchIndexEnd=f,this._indexDatas.set(c,a);var p=0;if(u)for(p=d;p<f;p+=3){this._indexDatas[p]=_+this._indexDatas[p];var m=this._indexDatas[p+1],g=this._indexDatas[p+2];this._indexDatas[p+1]=_+g,this._indexDatas[p+2]=_+m}else for(p=d;p<f;p+=3)this._indexDatas[p]=_+this._indexDatas[p],this._indexDatas[p+1]=_+this._indexDatas[p+1],this._indexDatas[p+2]=_+this._indexDatas[p+2];a+=c.length,this._vertexDatas.set(h,r),r+=h.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),this._combineRenderElementPoolIndex=0,s=0,o=this._materials.length;s<o;s++){var y=this._getCombineRenderElementFromPool(e,i,n);y._type=2,y._staticBatch=null,y.renderObj=this;var v=this._combineRenderElements[this._materialToRenderElementsOffsets[s]]._tempBatchIndexStart,S=s+1===this._materialToRenderElementsOffsets.length?a:this._combineRenderElements[this._materialToRenderElementsOffsets[s+1]]._tempBatchIndexStart;y._tempBatchIndexStart=v,y._tempBatchIndexEnd=S,y._material=this._materials[s],this._merageElements.push(y)}},e._addCombineRenderObjTest=function(e){var i=e.renderObj,n=this._currentCombineIndexCount+i._getIndexBuffer().indexCount;return!(this._currentCombineVertexCount+i._getVertexBuffer().vertexCount>t.maxVertexCount||n>t.maxIndexCount)},e._addCombineRenderObj=function(t){var e=t.renderObj;this._combineRenderElements.push(t),this._currentCombineIndexCount=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount},e._addCombineMaterial=function(t){this._materials.push(t)},e._addMaterialToRenderElementOffset=function(t){this._materialToRenderElementsOffsets.push(t)},e._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},e._addToRenderQueue=function(t,e,i,n){this._getRenderElement(e,i,n);for(var r=0,a=this._materials.length;r<a;r++)t.getRenderQueue(this._materials[r].renderQueue)._addDynamicBatchElement(this._merageElements[r])},e._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(t){var e=t._batchIndexEnd-t._batchIndexStart;P.mainContext.drawElements(4,e,5123,2*t._batchIndexStart),D.drawCall++,D.trianglesFaces+=e/3},e._getVertexBuffers=function(){return null},a(0,e,"_vertexBufferCount",function(){return 1}),a(0,e,"triangleCount",function(){return this._indexBuffer.indexCount/3}),a(0,e,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),t.maxVertexCount=2e4,t.maxIndexCount=4e4,t.maxCombineTriangleCount=10,t}(),Et=function(){function t(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}r(t,"laya.d3.graphics.DynamicBatchManager");var e=t.prototype;return e.getDynamicBatch=function(t,e){var i,n=t.id.toString()+e;return this._dynamicBatches[n]?i=this._dynamicBatches[n]:this._dynamicBatches[n]=i=new xt(t),i},e._garbageCollection=function(){for(var t in this._dynamicBatches)0===this._dynamicBatches[t].combineRenderElementsCount&&delete this._dynamicBatches[t]},e._addPrepareRenderElement=function(t){this._prepareDynamicBatchCombineElements.push(t)},e._finishCombineDynamicBatch=function(e){this._prepareDynamicBatchCombineElements.sort(t._sortPrepareDynamicBatch);for(var i,n,r,a,s,o,l,h,c=-1,u=!0,_=0,d=-1,f=0,p=this._prepareDynamicBatchCombineElements.length;f<p;f++){var m=(s=this._prepareDynamicBatchCombineElements[f]).renderObj._getVertexBuffer(0).vertexDeclaration,g=n!==m;g&&(_=0,n=m);var y=_!==c;if(y&&(c=_),(g||y)&&(o=this.getDynamicBatch(m,_),i=null),u)if(o._addCombineRenderObjTest(s)){if(i!==(a=s._material))l&&(e.getRenderQueue(h._material.renderQueue)._addRenderElement(h),l=null,h=null,d=-1),l=a,d=o.combineRenderElementsCount,h=s,i=a;else if(l){var v=h.renderObj,S=s.renderObj;v._getVertexBuffer().vertexCount+S._getVertexBuffer().vertexCount>xt.maxVertexCount||v._getIndexBuffer().indexCount+S._getIndexBuffer().indexCount>xt.maxIndexCount?(e.getRenderQueue(h._material.renderQueue)._addRenderElement(h),l=a,d=o.combineRenderElementsCount,h=s):(o._addCombineMaterial(l),o._addMaterialToRenderElementOffset(d),o._addCombineRenderObj(h),l=null,h=null,d=-1,o._addCombineRenderObj(s))}else o._addCombineRenderObj(s);u=!0}else l&&(e.getRenderQueue(h._material.renderQueue)._addRenderElement(h),l=null,h=null,d=-1),_++,u=!1;else r=this._prepareDynamicBatchCombineElements[f-1],o._addMaterialToRenderElementOffset(o.combineRenderElementsCount),i=r._material,o._addCombineMaterial(i),o._addCombineRenderObj(r),u=!0,i!==(a=s._material)?(l=a,d=o.combineRenderElementsCount,h=s):o._addCombineRenderObj(s),i=a}l&&(e.getRenderQueue(h._material.renderQueue)._addRenderElement(h),l=null,h=null,d=-1),this._prepareDynamicBatchCombineElements.length=0},e._clearRenderElements=function(){for(var t in this._dynamicBatches)this._dynamicBatches[t]._clearRenderElements()},e._addToRenderQueue=function(t,e,i,n){for(var r in this._dynamicBatches){var a=this._dynamicBatches[r];a.combineRenderElementsCount>0&&a._addToRenderQueue(t,e,i,n)}},e.dispose=function(){this._dynamicBatches=null},t._sortPrepareDynamicBatch=function(t,e){return t._mainSortID-e._mainSortID},t}(),Tt=function(){function t(){}return r(t,"laya.d3.graphics.FrustumCulling"),t.renderShadowObjectCulling=function(t,e,i,n,r){var a=0,s=0,o=0,l=0;for(a=0,o=i.length;a<o;a++){var h=i[a];h&&h._clearRenderElements()}var c,u,_,d=t._cullingRenders;if(r>1){for(a=0,o=t._cullingRendersLength;a<o;a++)if((c=d[a]).castShadow&&W.isVisible(c._owner.layer.mask)&&c.enable)for(var f=1,p=e.length;f<p;f++)if(u=i[f-1],0!==e[f].containsBoundSphere(c.boundingSphere))for(s=0,l=(_=c._renderElements).length;s<l;s++)u._addRenderElement(_[s])}else for(a=0,o=t._cullingRendersLength;a<o;a++)if((c=d[a]).castShadow&&W.isVisible(c._owner.layer.mask)&&c.enable&&0!==e[0].containsBoundSphere(c.boundingSphere))for(c._renderUpdate(n),u=i[0],s=0,l=(_=c._renderElements).length;s<l;s++)u._addRenderElement(_[s])},t.renderShadowObjectCullingOctree=function(t,e,i,n,r){for(var a=0,s=i.length;a<s;a++){var o=i[a];o&&o._clearRenderElements()}r>1?t.treeRoot.cullingShadowObjects(e,i,!0,0,t):t.treeRoot.cullingShadowObjectsOnePSSM(e[0],i,n,!0,0,t)},t.renderObjectCulling=function(t,e,i,n,r,a){var s=0,o=0,l=0,h=0,c=e._quenes,u=e._dynamicBatchManager,_=e._cullingRenders;for(s=0,o=c.length;s<o;s++){var d=c[s];d&&d._clearRenderElements()}var f=wt._staticBatchManagers;for(s=0,o=f.length;s<o;s++)f[s]._clearRenderElements();u._clearRenderElements();var p=i.transform.position;for(s=0,o=e._cullingRendersLength;s<o;s++){var m=_[s];if(W.isVisible(m._owner.layer.mask)&&m.enable&&0!==t.containsBoundSphere(m.boundingSphere)&&m._renderUpdate(a)){m._distanceForSort=Pe.distance(m.boundingSphere.center,p)+m.sortingFudge;var g=m._renderElements;for(l=0,h=g.length;l<h;l++){var y=g[l],v=y._staticBatch;if(v&&v._material===y._material)v._addBatchRenderElement(y);else{var S=y.renderObj;S.triangleCount<10&&1===S._vertexBufferCount&&S._getIndexBuffer()&&y._material.renderQueue<2&&y._canDynamicBatch&&!m._owner.isStatic?u._addPrepareRenderElement(y):e.getRenderQueue(y._material.renderQueue)._addRenderElement(y)}}}}for(s=0,o=f.length;s<o;s++)f[s]._addToRenderQueue(e,n,r,a);u._finishCombineDynamicBatch(e),u._addToRenderQueue(e,n,r,a)},t.renderObjectCullingOctree=function(t,e,i,n,r,a){var s=0,o=0,l=e._quenes,h=e._dynamicBatchManager;for(s=0,o=l.length;s<o;s++){var c=l[s];c&&c._clearRenderElements()}var u=wt._staticBatchManagers;for(s=0,o=u.length;s<o;s++)u[s]._clearRenderElements();for(h._clearRenderElements(),e._cullingRenders.length=0,e.treeRoot.cullingObjects(t,!0,0,i.transform.position,a),s=0,o=u.length;s<o;s++)u[s]._addToRenderQueue(e,n,r,a);h._finishCombineDynamicBatch(e),h._addToRenderQueue(e,n,r,a)},t.renderObjectCullingNoBoundFrustum=function(t,e,i,n,r){var a=0,s=0,o=0,l=0,h=t._quenes,c=t._dynamicBatchManager,u=t._cullingRenders;for(a=0,s=h.length;a<s;a++){var _=h[a];_&&_._clearRenderElements()}var d=wt._staticBatchManagers;for(a=0,s=d.length;a<s;a++)d[a]._clearRenderElements();c._clearRenderElements();var f=e.transform.position;for(a=0,s=t._cullingRendersLength;a<s;a++){var p=u[a];if(W.isVisible(p._owner.layer.mask)&&p.enable){p._renderUpdate(r),p._distanceForSort=Pe.distance(p.boundingSphere.center,f)+p.sortingFudge;var m=p._renderElements;for(o=0,l=m.length;o<l;o++){var g=m[o],y=g._staticBatch;if(y&&y._material===g._material)y._addBatchRenderElement(g);else{var v=g.renderObj;v.triangleCount<10&&1===v._vertexBufferCount&&v._getIndexBuffer()&&g._material.renderQueue<2&&g._canDynamicBatch&&!p._owner.isStatic?c._addPrepareRenderElement(g):t.getRenderQueue(g._material.renderQueue)._addRenderElement(g)}}}}for(a=0,s=d.length;a<s;a++)d[a]._addToRenderQueue(t,i,n,r);c._finishCombineDynamicBatch(t),c._addToRenderQueue(t,i,n,r)},t}(),wt=function(){function t(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}r(t,"laya.d3.graphics.StaticBatchManager");var e=t.prototype;return e._finishInit=function(){for(var t in this._staticBatches)this._staticBatches[t]._finishInit();this._initBatchRenderElements.length=0},e._initStaticBatchs=function(t){throw new Error("StaticBatchManager:must override this function.")},e._addInitBatchSprite=function(t){for(var e=t._render._renderElements,i=0,n=e.length;i<n;i++)this._initBatchRenderElements.push(e[i])},e._clearRenderElements=function(){for(var t in this._staticBatches)this._staticBatches[t]._clearRenderElements()},e._garbageCollection=function(t){var e=t._staticBatch,i=e._initBatchRenderElements,n=i.indexOf(t);i.splice(n,1),0===i.length&&(e.dispose(),delete this._staticBatches[e._key])},e._addToRenderQueue=function(t,e,i,n){for(var r in this._staticBatches){var a=this._staticBatches[r];a._batchRenderElements.length>0&&a._updateToRenderQueue(t,n)}},e.dispose=function(){this._staticBatches=null},t._addToStaticBatchQueue=function(e){e instanceof laya.d3.core.RenderableSprite3D&&e._addToInitStaticBatchManager();for(var i=0,n=e.numChildren;i<n;i++)t._addToStaticBatchQueue(e._childs[i])},t.combine=function(e,i){var n,r=0,a=0;if(i)for(r=0,a=i.length;r<a;r++)i[r]._addToInitStaticBatchManager();else e&&t._addToStaticBatchQueue(e);for(r=0,a=t._staticBatchManagers.length;r<a;r++)(n=t._staticBatchManagers[r])._initStaticBatchs(e),n._finishInit()},t._staticBatchManagers=[],t}(),Ct=function(){function t(t,e,i){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=t,this._manager=e,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=i}r(t,"laya.d3.graphics.StaticBatch");var e=t.prototype;return i.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),e._binarySearch=function(t){for(var e=0,i=this._batchRenderElements.length-1,n=0;e<=i;)n=Math.floor((e+i)/2),this._compareBatchRenderElement(this._batchRenderElements[n],t)?i=n-1:e=n+1;return e},e._compareBatchRenderElement=function(t,e){throw new Error("StaticBatch:must override this function.")},e._getVertexDecLightMap=function(t){return t===ae.vertexDeclaration?te.vertexDeclaration:t===re.vertexDeclaration?Jt.vertexDeclaration:t===jt.vertexDeclaration?Gt.vertexDeclaration:t===he.vertexDeclaration?null:t===kt.vertexDeclaration?Ft.vertexDeclaration:t===oe.vertexDeclaration?ie.vertexDeclaration:t===Qt.vertexDeclaration?$t.vertexDeclaration:t===se.vertexDeclaration?ee.vertexDeclaration:t===re.vertexDeclaration?Jt.vertexDeclaration:t===Kt.vertexDeclaration?Wt.vertexDeclaration:t===he.vertexDeclaration?null:t===kt.vertexDeclaration?Ft.vertexDeclaration:t===le.vertexDeclaration?ne.vertexDeclaration:t===Qt.vertexDeclaration?$t.vertexDeclaration:t},e._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},e._addBatchRenderElement=function(t){this._batchRenderElements.splice(this._binarySearch(t),0,t)},e._updateToRenderQueue=function(t,e){this._combineRenderElementPoolIndex=0,this._getRenderElement(t.getRenderQueue(this._material.renderQueue)._renderElements,t,e)},e._getRenderElement=function(t,e,i){throw new Error("StaticBatch:must override this function.")},e._finishInit=function(){throw new Error("StaticBatch:must override this function.")},e._clearRenderElements=function(){this._batchRenderElements.length=0},e.dispose=function(){},e._getVertexBuffer=function(t){return void 0===t&&(t=0),null},e._getIndexBuffer=function(){return null},e._beforeRender=function(t){return!0},e._render=function(t){},e._getVertexBuffers=function(){return null},a(0,e,"_vertexBufferCount",function(){return 1}),a(0,e,"triangleCount",function(){return 0}),t.combine=function(t){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),wt.combine(t)},t.maxBatchVertexCount=65535,t}(),bt=function(){function t(e,i){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++t._uniqueIDCounter,this._id>t.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",t.maxVertexDeclaration);this._shaderValues=new Ue,this._vertexElementsDic={},this._vertexStride=e,this._vertexElements=i;for(var n=0;n<i.length;n++){var r=i[n],a=r.elementUsage;this._vertexElementsDic[a]=r;var s=[t._getTypeSize(r.elementFormat)/4,5126,!1,this._vertexStride,r.offset];switch(this._shaderValues.setValue(a,s),a){case 1:this._addShaderDefine(ci.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(ci.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(ci.SHADERDEFINE_UV1)}}}r(t,"laya.d3.graphics.VertexDeclaration");var e=t.prototype;return e._addShaderDefine=function(t){this._shaderDefineValue|=t},e._removeShaderDefine=function(t){this._shaderDefineValue&=~t},e.getVertexElements=function(){return this._vertexElements.slice()},e.getVertexElementByUsage=function(t){return this._vertexElementsDic[t]},e.unBinding=function(){},a(0,e,"shaderDefineValue",function(){return this._shaderDefineValue}),a(0,e,"id",function(){return this._id}),a(0,e,"vertexStride",function(){return this._vertexStride}),a(0,e,"shaderValues",function(){return this._shaderValues}),t._getTypeSize=function(t){switch(t){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},t.getVertexStride=function(e){for(var i=0,n=0;n<e.Length;n++){var r=e[n],a=r.offset+t._getTypeSize(r.elementFormat);i<a&&(i=a)}return i},t._maxVertexDeclarationBit=1e3,t._uniqueIDCounter=1,n(t,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),t}(),Mt=function(){function t(t,e,i){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=t,this.elementFormat=e,this.elementUsage=i}return r(t,"laya.d3.graphics.VertexElement"),t}(),It=(function(){function t(){}r(t,"laya.d3.graphics.VertexElementFormat"),t.Single="single",t.Vector2="vector2",t.Vector3="vector3",t.Vector4="vector4",t.Color="color",t.Byte4="byte4",t.Short2="short2",t.Short4="short4",t.NormalizedShort2="normalizedshort2",t.NormalizedShort4="normalizedshort4",t.HalfVector2="halfvector2",t.HalfVector4="halfvector4"}(),function(){function t(){}r(t,"laya.d3.graphics.VertexElementUsage"),t.POSITION0=0,t.COLOR0=1,t.TEXTURECOORDINATE0=2,t.NORMAL0=3,t.BINORMAL0=4,t.TANGENT0=5,t.BLENDINDICES0=6,t.BLENDWEIGHT0=7,t.DEPTH0=8,t.FOG0=9,t.POINTSIZE0=10,t.SAMPLE0=11,t.TESSELLATEFACTOR0=12,t.COLOR1=13,t.NEXTTEXTURECOORDINATE0=14,t.TEXTURECOORDINATE1=15,t.NEXTTEXTURECOORDINATE1=16,t.CORNERTEXTURECOORDINATE0=17,t.VELOCITY0=18,t.STARTCOLOR0=19,t.STARTSIZE=20,t.AGEADDSCALE0=21,t.STARTROTATION=22,t.ENDCOLOR0=23,t.STARTLIFETIME=24,t.TIME0=33,t.SHAPEPOSITIONSTARTLIFETIME=30,t.DIRECTIONTIME=32,t.SIZEROTATION0=27,t.RADIUS0=28,t.RADIAN0=29,t.STARTSPEED=31,t.RANDOM0=34,t.RANDOM1=35,t.SIMULATIONWORLDPOSTION=36,t.SIMULATIONWORLDROTATION=37,t.TEXTURECOORDINATE0X=38,t.TEXTURECOORDINATE0X1=39,t.TEXTURECOORDINATE0Y=40,t.OFFSETVECTOR=41}(),function(){function t(t,e,i){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=t,this._textureCoordinate0=e,this._time=i}r(t,"laya.d3.graphics.VertexGlitter");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate0}),a(0,e,"position",function(){return this._position}),a(0,e,"time",function(){return this._time}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(24,[new Mt(0,"vector3",0),new Mt(12,"vector2",2),new Mt(20,"single",33)])}]),t}()),Dt=(function(){function t(t,e,i,n,r,a,s,o,l,h){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=t,this._position=e,this._velocity=i,this._startColor=n,this._endColor=r,this._sizeRotation=a,this._radius=s,this._radian=o,this._ageAddScale=l,this._time=h}r(t,"laya.d3.graphics.VertexParticle");var e=t.prototype;i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"endColor",function(){return this._endColor}),a(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),a(0,e,"sizeRotation",function(){return this._sizeRotation}),a(0,e,"velocity",function(){return this._velocity}),a(0,e,"position",function(){return this._position}),a(0,e,"startColor",function(){return this._startColor}),a(0,e,"radius",function(){return this._radius}),a(0,e,"radian",function(){return this._radian}),a(0,e,"ageAddScale",function(){return this._ageAddScale}),a(0,e,"time",function(){return this._time}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(116,[new Mt(0,"vector4",17),new Mt(16,"vector3",0),new Mt(28,"vector3",18),new Mt(40,"vector4",19),new Mt(56,"vector4",23),new Mt(72,"vector3",27),new Mt(84,"vector2",28),new Mt(92,"vector4",29),new Mt(108,"single",24),new Mt(112,"single",33)])}])}(),function(){function t(t){this._position=null,this._position=t}r(t,"laya.d3.graphics.VertexPosition");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(12,[new Mt(0,"vector3",0)])}]),t}()),At=function(){function t(t,e){this._position=null,this._normal=null,this._position=t,this._normal=e}r(t,"laya.d3.graphics.VertexPositionNormal");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(24,[new Mt(0,"vector3",0),new Mt(12,"vector3",3)])}]),t}(),Rt=function(){function t(t,e,i){this._position=null,this._normal=null,this._color=null,this._position=t,this._normal=e,this._color=i}r(t,"laya.d3.graphics.VertexPositionNormalColor");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(40,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1)])}]),t}(),Lt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._blendIndex=n,this._blendWeight=r}r(t,"laya.d3.graphics.VertexPositionNormalColorSkin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(72,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector4",7),new Mt(56,"vector4",6)])}]),t}(),Pt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(88,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector4",7),new Mt(56,"vector4",6),new Mt(72,"vector4",5)])}]),t}(),Nt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(84,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector4",7),new Mt(56,"vector4",6),new Mt(72,"vector3",5)])}]),t}(),Ot=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}r(t,"laya.d3.graphics.VertexPositionNormalColorSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(56,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector4",5)])}]),t}(),Vt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}r(t,"laya.d3.graphics.VertexPositionNormalColorTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(52,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector3",5)])}]),t}(),kt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(48,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2)])}]),t}(),Ft=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(56,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector2",15)])}]),t}(),Bt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._blendIndex=a,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(88,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector2",15),new Mt(56,"vector4",7),new Mt(72,"vector4",6)])}]),t}(),Ut=function(){function t(t,e,i,n,r,a,s,o){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(104,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector2",15),new Mt(56,"vector4",7),new Mt(72,"vector4",6),new Mt(88,"vector4",5)])}]),t}(),Ht=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0SkinTangent=function(t,e,i,n,r,a,s,o){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o},a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(100,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector2",15),new Mt(56,"vector4",7),new Mt(72,"vector4",6),new Mt(88,"vector3",5)])}]),t}(),Gt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(72,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector2",15),new Mt(56,"vector4",5)])}]),t}(),Wt=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0Tangent=function(t,e,i,n,r,a){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a},a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(68,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector2",15),new Mt(56,"vector3",5)])}]),t}(),zt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(80,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector4",7),new Mt(64,"vector4",6)])}]),t}(),Yt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(96,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector4",7),new Mt(64,"vector4",6),new Mt(80,"vector4",5)])}]),t}(),Xt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"color",function(){return this._color}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(92,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector4",7),new Mt(64,"vector4",6),new Mt(80,"vector3",5)])}]),t}(),jt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(64,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector4",5)])}]),t}(),Kt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"color",function(){return this._color}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(60,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",1),new Mt(40,"vector2",2),new Mt(48,"vector3",5)])}]),t}(),qt=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}r(t,"laya.d3.graphics.VertexPositionNormalSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(40,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector4",5)])}]),t}(),Zt=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}r(t,"laya.d3.graphics.VertexPositionNormalTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(36,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector3",5)])}]),t}(),Qt=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}r(t,"laya.d3.graphics.VertexPositionNormalTexture");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(32,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2)])}]),t}(),$t=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(40,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector2",15)])}]),t}(),Jt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(72,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector2",15),new Mt(40,"vector4",7),new Mt(56,"vector4",6)])}]),t}(),te=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(88,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector2",15),new Mt(40,"vector4",7),new Mt(56,"vector4",6),new Mt(72,"vector4",5)])}]),t}(),ee=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0SkinTangent=function(t,e,i,n,r,a,s){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s},a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(84,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector2",15),new Mt(40,"vector4",7),new Mt(56,"vector4",6),new Mt(72,"vector3",5)])}]),t}(),ie=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(56,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector2",15),new Mt(40,"vector4",5)])}]),t}(),ne=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0Tangent=function(t,e,i,n,r){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r},a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(52,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector2",15),new Mt(40,"vector3",5)])}]),t}(),re=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._blendIndex=n,this._blendWeight=r}r(t,"laya.d3.graphics.VertexPositionNormalTextureSkin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(64,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector4",7),new Mt(48,"vector4",6)])}]),t}(),ae=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(80,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector4",7),new Mt(48,"vector4",6),new Mt(64,"vector4",5)])}]),t}(),se=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(76,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector4",7),new Mt(48,"vector4",6),new Mt(64,"vector3",5)])}]),t}(),oe=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}r(t,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(48,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector4",5)])}]),t}(),le=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}r(t,"laya.d3.graphics.VertexPositionNormalTextureTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(44,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector3",5)])}]),t}(),he=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}r(t,"laya.d3.graphics.VertexPositionNTBTexture");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(56,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector3",5),new Mt(36,"vector3",4),new Mt(48,"vector2",2)])}]),t}(),ce=function(){function t(t,e,i,n,r,a,s,o){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,i=i,this._blendIndex=s,this._blendWeight=o}r(t,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(96,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector3",5),new Mt(36,"vector3",4),new Mt(48,"vector2",2),new Mt(56,"vector2",15),new Mt(64,"vector4",7),new Mt(80,"vector4",6)])}]),t}(),ue=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}r(t,"laya.d3.graphics.VertexPositionNTBTextureSkin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(88,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector3",5),new Mt(36,"vector3",4),new Mt(48,"vector2",2),new Mt(56,"vector4",7),new Mt(72,"vector4",6)])}]),t}(),_e=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=t,this._normal=e,this._textureCoord0=i,this._textureCoord1=n}r(t,"laya.d3.graphics.VertexPositionTerrain");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"normal",function(){return this._normal}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoord0",function(){return this._textureCoord0}),a(0,e,"textureCoord1",function(){return this._textureCoord1}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(40,[new Mt(0,"vector3",0),new Mt(12,"vector3",3),new Mt(24,"vector2",2),new Mt(32,"vector2",15)])}]),t}(),de=function(){function t(t,e){this._position=null,this._textureCoordinate0=null,this._position=t,this._textureCoordinate0=e}r(t,"laya.d3.graphics.VertexPositionTexture0");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(20,[new Mt(0,"vector3",0),new Mt(12,"vector2",2)])}]),t}(),fe=function(){function t(t,e,i,n,r,a,s,o,l,h,c,u,_,d){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=a,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=h,this._startSpeed=c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=d}r(t,"laya.d3.graphics.VertexShurikenParticleBillboard");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),a(0,e,"random1",function(){return this._randoms1}),a(0,e,"startRotation2",function(){return this._startRotation2}),a(0,e,"positionStartLifeTime",function(){return this._positionStartLifeTime}),a(0,e,"velocity",function(){return this._velocity}),a(0,e,"random0",function(){return this._randoms0}),a(0,e,"startSize",function(){return this._startSize}),a(0,e,"startColor",function(){return this._startColor}),a(0,e,"startRotation0",function(){return this._startRotation0}),a(0,e,"startRotation1",function(){return this._startRotation1}),a(0,e,"startLifeTime",function(){return this._startLifeTime}),a(0,e,"time",function(){return this._time}),a(0,e,"startSpeed",function(){return this._startSpeed}),a(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(152,[new Mt(0,"vector4",17),new Mt(16,"vector4",30),new Mt(32,"vector4",32),new Mt(48,"vector4",19),new Mt(64,"vector3",20),new Mt(76,"vector3",22),new Mt(88,"single",31),new Mt(92,"vector4",34),new Mt(108,"vector4",35),new Mt(124,"vector3",36),new Mt(136,"vector4",37)])}]),t}(),pe=function(){function t(t,e,i,n,r,a,s,o,l,h,c,u,_,d){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=a,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=h,this._startSpeed=c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=d}r(t,"laya.d3.graphics.VertexShurikenParticleMesh");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),a(0,e,"velocity",function(){return this._velocity}),a(0,e,"position",function(){return this._positionStartLifeTime}),a(0,e,"random0",function(){return this._randoms0}),a(0,e,"startSize",function(){return this._startSize}),a(0,e,"startColor",function(){return this._startColor}),a(0,e,"startRotation0",function(){return this._startRotation0}),a(0,e,"startRotation1",function(){return this._startRotation1}),a(0,e,"random1",function(){return this._randoms1}),a(0,e,"startRotation2",function(){return this._startRotation2}),a(0,e,"startLifeTime",function(){return this._startLifeTime}),a(0,e,"time",function(){return this._time}),a(0,e,"startSpeed",function(){return this._startSpeed}),a(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new bt(172,[new Mt(0,"vector3",0),new Mt(12,"vector4",1),new Mt(28,"vector2",2),new Mt(36,"vector4",30),new Mt(52,"vector4",32),new Mt(68,"vector4",19),new Mt(84,"vector3",20),new Mt(96,"vector3",22),new Mt(108,"single",31),new Mt(112,"vector4",34),new Mt(128,"vector4",35),new Mt(144,"vector3",36),new Mt(156,"vector4",37)])}]),t}(),me=function(){function t(t,e,i,n,r,a){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=i,this._materials=n,this._subMeshes=r,this._materialMap=a,this._version=e,this._onLoaded(t)}r(t,"laya.d3.loaders.LoadModelV01");var e=t.prototype;return e._onLoaded=function(t){this._readData=t,this.READ_BLOCK();for(var e=0;e<this._BLOCK.count;e++){var i=this._readData.getUint16(),n=this._strings[i],r=this["READ_"+n];if(null==r)throw new Error("model file err,no this function:"+i+" "+n);if(!r.call(this))break}return this._mesh},e.onError=function(){},e._readString=function(){return this._strings[this._readData.getUint16()]},e.READ_BLOCK=function(){return this._readData.getUint16(),this._BLOCK.count=this._readData.getUint16(),!0},e.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},e.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var t=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var e=0;e<this._STRINGS.size;e++)this._strings[e]=this._readData.readUTFString();return this._readData.pos=t,!0},e.READ_MATERIAL=function(){var t=this._readData.getUint16(),e=(this._readString(),this._readString());return this._materials[t]="null"!==e?v.getRes(this._materialMap[e]):new mi,!0},e.READ_MESH=function(){switch(this._readString(),this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var t,e=this._readData.__getBuffer(),i=0,n=this._readData.getUint32(),r=this._readData.getUint32(),a=(new Float32Array(e.slice(n+this._DATA.offset,n+this._DATA.offset+r)),this._readData.getUint32()),s=this._readData.getUint32(),o=new Float32Array(e.slice(a+this._DATA.offset,a+this._DATA.offset+s));for(this.mesh._inverseBindPoses=[],i=0,t=o.length;i<t;i+=16){var l=new be(o[i+0],o[i+1],o[i+2],o[i+3],o[i+4],o[i+5],o[i+6],o[i+7],o[i+8],o[i+9],o[i+10],o[i+11],o[i+12],o[i+13],o[i+14],o[i+15]);this.mesh._inverseBindPoses.push(l)}break;default:throw new Error("LoadModel:unknown version.")}return!0},e.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var e=this._readString();this._shaderAttributes=e.match(t._attrReg);var i=this._readData.getUint32(),n=this._readData.getUint32(),r=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),a=this._readData.getUint32(),s=this._readData.getUint32(),o=this._readData.getUint32(),l=this._readData.__getBuffer(),h=new ke(this._mesh),c=this._getVertexDeclaration(),u=Ki.create(c,a/c.vertexStride,35044,!0),_=r+this._DATA.offset,d=l.slice(_,_+a);u.setData(new Float32Array(d)),h._vertexBuffer=u;for(var f=u.vertexDeclaration.getVertexElements(),p=0;p<f.length;p++)h._bufferUsage[f[p].elementUsage]=u;var m=ji.create("ushort",n/2,35044,!0),g=i+this._DATA.offset,y=l.slice(g,g+n);m.setData(new Uint16Array(y)),h._indexBuffer=m;var v=l.slice(s+this._DATA.offset,s+this._DATA.offset+o);return h._boneIndicesList[0]=new Uint8Array(v),this._subMeshes.push(h),!0},e.READ_DATAAREA=function(){return!1},e._getVertexDeclaration=function(){for(var t=!1,e=!1,i=!1,n=!1,r=!1,a=!1,s=!1,o=!1,l=!1,h=0;h<this._shaderAttributes.length;h+=8)switch(this._shaderAttributes[h]){case"POSITION":t=!0;break;case"NORMAL":e=!0;break;case"COLOR":i=!0;break;case"UV":n=!0;break;case"UV1":r=!0;break;case"BLENDWEIGHT":s=!0;break;case"BLENDINDICES":o=!0;break;case"TANGENT":a=!0;break;case"BINORMAL":l=!0}var c;return t&&e&&i&&n&&r&&s&&o&&a?c=Ht.vertexDeclaration:t&&e&&i&&n&&r&&s&&o?c=Bt.vertexDeclaration:t&&e&&n&&r&&s&&o&&a?c=ee.vertexDeclaration:t&&e&&n&&r&&s&&o?c=Jt.vertexDeclaration:t&&e&&i&&n&&s&&o&&a?c=Xt.vertexDeclaration:t&&e&&i&&n&&s&&o?c=zt.vertexDeclaration:t&&e&&a&&l&&n&&s&&o?c=ue.vertexDeclaration:t&&e&&n&&s&&o&&a?c=se.vertexDeclaration:t&&e&&n&&s&&o?c=re.vertexDeclaration:t&&e&&i&&s&&o&&a?c=Nt.vertexDeclaration:t&&e&&i&&s&&o?c=Lt.vertexDeclaration:t&&e&&i&&n&&r&&a?c=Wt.vertexDeclaration:t&&e&&i&&n&&r?c=Ft.vertexDeclaration:t&&e&&n&&r&&a?c=ne.vertexDeclaration:t&&e&&n&&r?c=$t.vertexDeclaration:t&&e&&i&&n&&a?c=Kt.vertexDeclaration:t&&e&&n&&a&&l?c=he.vertexDeclaration:t&&e&&i&&n?c=kt.vertexDeclaration:t&&e&&n&&a?c=le.vertexDeclaration:t&&e&&n?c=Qt.vertexDeclaration:t&&e&&i&&a?c=Vt.vertexDeclaration:t&&e&&i&&(c=Rt.vertexDeclaration),c},a(0,e,"mesh",function(){return this._mesh}),t._attrReg=new RegExp("(\\w+)|([:,;])","g"),t}(),ge=function(){function t(){}return r(t,"laya.d3.loaders.LoadModelV02"),t.parse=function(e,i,n,r,a,s){t._mesh=n,t._materials=r,t._subMeshes=a,t._materialMap=s,t._version=i,t._readData=e,t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var o=0,l=t._BLOCK.count;o<l;o++){t._readData.pos=t._BLOCK.blockStarts[o];var h=t._readData.getUint16(),c=t._strings[h],u=t["READ_"+c];if(null==u)throw new Error("model file err,no this function:"+h+" "+c);u.call()}t._strings.length=0,t._readData=null,t._version=null,t._mesh=null,t._materials=null,t._subMeshes=null,t._materialMap=null},t._readString=function(){return t._strings[t._readData.getUint16()]},t.READ_DATA=function(){t._DATA.offset=t._readData.getUint32(),t._DATA.size=t._readData.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._readData.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._readData.getUint32()),n.push(t._readData.getUint32())},t.READ_STRINGS=function(){var e=t._readData.getUint32(),i=t._readData.getUint16(),n=t._readData.pos;t._readData.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._readData.readUTFString();t._readData.pos=n},t.READ_MATERIAL=function(){t._readString(),t._readString();var e=t._readString();return""!==e&&t._materials.push(v.getRes(t._materialMap[e])),!0},t.READ_MESH=function(){t._readString();var e,i=t._readData.__getBuffer(),n=0,r=t._readData.getInt16(),a=t._DATA.offset;for(n=0;n<r;n++){var s=a+t._readData.getUint32(),o=t._readData.getUint32(),l=new Float32Array(i.slice(s,s+o)),h=t._readString().match(t._attrReg),c=t._getVertexDeclaration(h),u=Ki.create(c,4*l.length/c.vertexStride,35044,!0);u.setData(l),t._mesh._vertexBuffers.push(u)}var _=a+t._readData.getUint32(),d=t._readData.getUint32(),f=new Uint16Array(i.slice(_,_+d)),p=ji.create("ushort",d/2,35044,!0);p.setData(f),t._mesh._indexBuffer=p;var m=t._mesh._boneNames=[],g=t._readData.getUint16();for(m.length=g,n=0;n<g;n++)m[n]=t._strings[t._readData.getUint16()];var y=t._readData.getUint32(),v=t._readData.getUint32(),S=(new Float32Array(i.slice(a+y,a+y+v)),t._readData.getUint32()),x=t._readData.getUint32(),E=new Float32Array(i.slice(a+S,a+S+x));for(t._mesh._inverseBindPoses=[],n=0,e=E.length;n<e;n+=16){var T=new be(E[n+0],E[n+1],E[n+2],E[n+3],E[n+4],E[n+5],E[n+6],E[n+7],E[n+8],E[n+9],E[n+10],E[n+11],E[n+12],E[n+13],E[n+14],E[n+15]);t._mesh._inverseBindPoses.push(T)}return t._mesh._skinnedDatas=new Float32Array(16*E.length),!0},t.READ_SUBMESH=function(){var e=t._readData.__getBuffer(),i=new ke(t._mesh),n=t._readData.getInt16(),r=t._readData.getUint32(),a=t._readData.getUint32();i._vertexBuffer=t._mesh._vertexBuffers[n],i._vertexStart=r,i._vertexCount=a;var s=t._readData.getUint32(),o=t._readData.getUint32(),l=t._mesh._indexBuffer;i._indexBuffer=l,i._indexStart=s,i._indexCount=o,i._indices=new Uint16Array(l.getData().buffer,2*s,o);var h=t._DATA.offset,c=i._subIndexBufferStart,u=i._subIndexBufferCount,_=i._boneIndicesList,d=t._readData.getUint16();c.length=d,u.length=d,_.length=d;for(var f=0;f<d;f++){c[f]=t._readData.getUint32(),u[f]=t._readData.getUint32();var p=t._readData.getUint32(),m=t._readData.getUint32();i._boneIndicesList[f]=new Uint8Array(e.slice(h+p,h+p+m))}return t._subMeshes.push(i),!0},t._getVertexDeclaration=function(t){for(var e=!1,i=!1,n=!1,r=!1,a=!1,s=!1,o=!1,l=!1,h=!1,c=0;c<t.length;c++)switch(t[c]){case"POSITION":e=!0;break;case"NORMAL":i=!0;break;case"COLOR":n=!0;break;case"UV":r=!0;break;case"UV1":a=!0;break;case"BLENDWEIGHT":o=!0;break;case"BLENDINDICES":l=!0;break;case"TANGENT":s=!0;break;case"BINORMAL":h=!0}var u;return e&&i&&n&&r&&a&&o&&l&&s?u=Ht.vertexDeclaration:e&&i&&n&&r&&a&&o&&l?u=Bt.vertexDeclaration:e&&i&&r&&a&&o&&l&&s?u=ee.vertexDeclaration:e&&i&&r&&a&&o&&l?u=Jt.vertexDeclaration:e&&i&&n&&r&&o&&l&&s?u=Xt.vertexDeclaration:e&&i&&n&&r&&o&&l?u=zt.vertexDeclaration:e&&i&&r&&o&&l&&s?u=se.vertexDeclaration:e&&i&&r&&o&&l?u=re.vertexDeclaration:e&&i&&n&&o&&l&&s?u=Nt.vertexDeclaration:e&&i&&n&&o&&l?u=Lt.vertexDeclaration:e&&i&&n&&r&&a&&s?u=Wt.vertexDeclaration:e&&i&&n&&r&&a?u=Ft.vertexDeclaration:e&&i&&r&&a&&s?u=ne.vertexDeclaration:e&&i&&r&&a?u=$t.vertexDeclaration:e&&i&&n&&r&&s?u=Kt.vertexDeclaration:e&&i&&r&&s&&h?u=he.vertexDeclaration:e&&i&&n&&r?u=kt.vertexDeclaration:e&&i&&r&&s?u=le.vertexDeclaration:e&&i&&r?u=Qt.vertexDeclaration:e&&i&&n&&s?u=Vt.vertexDeclaration:e&&i&&n&&(u=Rt.vertexDeclaration),u},t._attrReg=new RegExp("(\\w+)|([:,;])","g"),t._strings=[],t._readData=null,t._version=null,t._mesh=null,t._materials=null,t._subMeshes=null,t._materialMap=null,n(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),ye=function(){function t(){}return r(t,"laya.d3.loaders.LoadModelV03"),t.parse=function(e,i,n,r,a){t._mesh=n,t._subMeshes=r,t._materialMap=a,t._version=i,t._readData=e,t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var s=0,o=t._BLOCK.count;s<o;s++){t._readData.pos=t._BLOCK.blockStarts[s];var l=t._readData.getUint16(),h=t._strings[l],c=t["READ_"+h];if(null==c)throw new Error("model file err,no this function:"+l+" "+h);c.call()}t._strings.length=0,t._readData=null,t._version=null,t._mesh=null,t._subMeshes=null,t._materialMap=null},t._readString=function(){return t._strings[t._readData.getUint16()]},t.READ_DATA=function(){t._DATA.offset=t._readData.getUint32(),t._DATA.size=t._readData.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._readData.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._readData.getUint32()),n.push(t._readData.getUint32())},t.READ_STRINGS=function(){var e=t._readData.getUint32(),i=t._readData.getUint16(),n=t._readData.pos;t._readData.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._readData.readUTFString();t._readData.pos=n},t.READ_MESH=function(){t._readString();var e,i=t._readData.__getBuffer(),n=0,r=t._readData.getInt16(),a=t._DATA.offset;for(n=0;n<r;n++){var s,o=a+t._readData.getUint32(),l=t._readData.getUint32(),h=new Float32Array(i.slice(o,o+l)),c=t._readString();switch(t._version){case"LAYAMODEL:03":s=t._vertexDeclarationMap_Discard[c];break;case"LAYAMODEL:0301":s=t._vertexDeclarationMap[c];break;default:throw new Error("LoadModelV03: unknown version.")}if(!s)throw new Error("LoadModelV03: unknown vertexDeclaration.");var u=Ki.create(s,4*h.length/s.vertexStride,35044,!0);u.setData(h),t._mesh._vertexBuffers.push(u)}var _=a+t._readData.getUint32(),d=t._readData.getUint32(),f=new Uint16Array(i.slice(_,_+d)),p=ji.create("ushort",d/2,35044,!0);p.setData(f),t._mesh._indexBuffer=p;var m=t._mesh._boneNames=[],g=t._readData.getUint16();for(m.length=g,n=0;n<g;n++)m[n]=t._strings[t._readData.getUint16()];t._readData.pos+=8;var y=t._readData.getUint32(),v=t._readData.getUint32(),S=new Float32Array(i.slice(a+y,a+y+v));for(t._mesh._inverseBindPoses=[],n=0,e=S.length;n<e;n+=16){var x=new be(S[n+0],S[n+1],S[n+2],S[n+3],S[n+4],S[n+5],S[n+6],S[n+7],S[n+8],S[n+9],S[n+10],S[n+11],S[n+12],S[n+13],S[n+14],S[n+15]);t._mesh._inverseBindPoses.push(x)}return t._mesh._skinnedDatas=new Float32Array(16*S.length),!0},t.READ_SUBMESH=function(){var e=t._readData.__getBuffer(),i=new ke(t._mesh),n=t._readData.getInt16(),r=t._readData.getUint32(),a=t._readData.getUint32();i._vertexBuffer=t._mesh._vertexBuffers[n],i._vertexStart=r,i._vertexCount=a;var s=t._readData.getUint32(),o=t._readData.getUint32(),l=t._mesh._indexBuffer;i._indexBuffer=l,i._indexStart=s,i._indexCount=o,i._indices=new Uint16Array(l.getData().buffer,2*s,o);var h=t._DATA.offset,c=i._subIndexBufferStart,u=i._subIndexBufferCount,_=i._boneIndicesList,d=t._readData.getUint16();c.length=d,u.length=d,_.length=d;for(var f=0;f<d;f++){c[f]=t._readData.getUint32(),u[f]=t._readData.getUint32();var p=t._readData.getUint32(),m=t._readData.getUint32();_[f]=new Uint8Array(e.slice(h+p,h+p+m))}return t._subMeshes.push(i),!0},t._strings=[],t._readData=null,t._version=null,t._mesh=null,t._subMeshes=null,t._materialMap=null,n(t,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":Ht.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":Bt.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":ce.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":ee.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":Jt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Xt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":zt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":se.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":re.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":Nt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":Lt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":Wt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":Ft.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":ne.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$t.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":Kt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":he.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":kt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":le.vertexDeclaration,"POSITION,NORMAL,UV":Qt.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":Vt.vertexDeclaration,"POSITION,NORMAL,COLOR":Rt.vertexDeclaration,"POSITION,NORMAL,TANGENT":Zt.vertexDeclaration,"POSITION,NORMAL":At.vertexDeclaration,"POSITION,UV":de.vertexDeclaration,POSITION:Dt.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":Ut.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":Bt.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":ce.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":te.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":Jt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":zt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":ae.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":re.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":Pt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":Lt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":Gt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":Ft.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":ie.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$t.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":jt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":he.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":kt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":oe.vertexDeclaration,"POSITION,NORMAL,UV":Qt.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":Ot.vertexDeclaration,"POSITION,NORMAL,COLOR":Rt.vertexDeclaration,"POSITION,NORMAL,TANGENT":qt.vertexDeclaration,"POSITION,NORMAL":At.vertexDeclaration,"POSITION,UV":de.vertexDeclaration,POSITION:Dt.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),ve=function(){function t(){}return r(t,"laya.d3.loaders.MeshReader"),t.read=function(e,i,n,r,a){var s=new f(e);s.pos=0;var o=s.readUTFString();switch(o){case"LAYAMODEL:01":case"LAYASKINANI:01":t._readVersion01(s,o,i,n,r,a);break;case"LAYAMODEL:02":ge.parse(s,o,i,n,r,a);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":ye.parse(s,o,i,r,a);break;default:throw new Error("MeshReader: unknown mesh version.")}i._setSubMeshes(r)},t._readVersion01=function(t,e,i,n,r,a){new me(t,e,i,n,r,a)},t}(),Se=function(){function t(t,e){this.min=null,this.max=null,this.min=t,this.max=e}r(t,"laya.d3.math.BoundBox");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.getCorners=function(t){t.length=8;var e=this.min.elements,i=this.max.elements,n=e[0],r=e[1],a=e[2],s=i[0],o=i[1],l=i[2];t[0]=new Pe(n,o,l),t[1]=new Pe(s,o,l),t[2]=new Pe(s,r,l),t[3]=new Pe(n,r,l),t[4]=new Pe(n,o,a),t[5]=new Pe(s,o,a),t[6]=new Pe(s,r,a),t[7]=new Pe(n,r,a)},e.toDefault=function(){this.min.toDefault(),this.max.toDefault()},e.cloneTo=function(t){var e=t;this.min.cloneTo(e.min),this.max.cloneTo(e.max)},e.clone=function(){var t=new this.constructor(new Pe,new Pe);return this.cloneTo(t),t},t.createfromPoints=function(t,e){if(null==t)throw new Error("points");var i=e.min,n=e.max,r=i.elements;r[0]=Number.MAX_VALUE,r[1]=Number.MAX_VALUE,r[2]=Number.MAX_VALUE;var a=n.elements;a[0]=-Number.MAX_VALUE,a[1]=-Number.MAX_VALUE,a[2]=-Number.MAX_VALUE;for(var s=0,o=t.length;s<o;++s)Pe.min(i,t[s],i),Pe.max(n,t[s],n)},t.merge=function(t,e,i){Pe.min(t.min,e.min,i.min),Pe.max(t.max,e.max,i.max)},t}(),xe=function(){function t(e){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=e,this._near=new Ie(new Pe),this._far=new Ie(new Pe),this._left=new Ie(new Pe),this._right=new Ie(new Pe),this._top=new Ie(new Pe),this._bottom=new Ie(new Pe),t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}r(t,"laya.d3.math.BoundFrustum");var e=t.prototype;return e.equalsBoundFrustum=function(t){return this._matrix.equalsOtherMatrix(t.matrix)},e.equalsObj=function(t){if(t instanceof laya.d3.math.BoundFrustum){var e=t;return this.equalsBoundFrustum(e)}return!1},e.getPlane=function(t){switch(t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},e.getCorners=function(e){t._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(e[0]),t._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(e[1]),t._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(e[2]),t._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(e[3]),t._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(e[4]),t._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(e[5]),t._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(e[6]),t._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(e[7])},e.containsPoint=function(t){for(var e=Ie.PlaneIntersectionType_Front,i=Ie.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=Te.intersectsPlaneAndPoint(this._near,t);break;case 1:i=Te.intersectsPlaneAndPoint(this._far,t);break;case 2:i=Te.intersectsPlaneAndPoint(this._left,t);break;case 3:i=Te.intersectsPlaneAndPoint(this._right,t);break;case 4:i=Te.intersectsPlaneAndPoint(this._top,t);break;case 5:i=Te.intersectsPlaneAndPoint(this._bottom,t)}switch(i){case Ie.PlaneIntersectionType_Back:return 0;case Ie.PlaneIntersectionType_Intersecting:e=Ie.PlaneIntersectionType_Intersecting}}switch(e){case Ie.PlaneIntersectionType_Intersecting:return 2;default:return 1}},e.containsBoundBox=function(e){for(var i,n=t._tempV30,r=t._tempV31,a=1,s=0;s<6;s++){if(i=this.getPlane(s),this._getBoxToPlanePVertexNVertex(e,i.normal,n,r),Te.intersectsPlaneAndPoint(i,n)===Ie.PlaneIntersectionType_Back)return 0;Te.intersectsPlaneAndPoint(i,r)===Ie.PlaneIntersectionType_Back&&(a=2)}return a},e.containsBoundSphere=function(t){for(var e=Ie.PlaneIntersectionType_Front,i=Ie.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=Te.intersectsPlaneAndSphere(this._near,t);break;case 1:i=Te.intersectsPlaneAndSphere(this._far,t);break;case 2:i=Te.intersectsPlaneAndSphere(this._left,t);break;case 3:i=Te.intersectsPlaneAndSphere(this._right,t);break;case 4:i=Te.intersectsPlaneAndSphere(this._top,t);break;case 5:i=Te.intersectsPlaneAndSphere(this._bottom,t)}switch(i){case Ie.PlaneIntersectionType_Back:return 0;case Ie.PlaneIntersectionType_Intersecting:e=Ie.PlaneIntersectionType_Intersecting}}switch(e){case Ie.PlaneIntersectionType_Intersecting:return 2;default:return 1}},e._getBoxToPlanePVertexNVertex=function(t,e,i,n){var r=t.min,a=r.elements,s=t.max,o=s.elements,l=e.elements,h=l[0],c=l[1],u=l[2];r.cloneTo(i);var _=i.elements;h>=0&&(_[0]=o[0]),c>=0&&(_[1]=o[1]),u>=0&&(_[2]=o[2]),s.cloneTo(n);var d=n.elements;h>=0&&(d[0]=a[0]),c>=0&&(d[1]=a[1]),u>=0&&(d[2]=a[2])},a(0,e,"top",function(){return this._top}),a(0,e,"matrix",function(){return this._matrix},function(e){this._matrix=e,t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),a(0,e,"near",function(){return this._near}),a(0,e,"far",function(){return this._far}),a(0,e,"left",function(){return this._left}),a(0,e,"right",function(){return this._right}),a(0,e,"bottom",function(){return this._bottom}),t._getPlanesFromMatrix=function(t,e,i,n,r,a,s){var o=t.elements,l=o[0],h=o[1],c=o[2],u=o[3],_=o[4],d=o[5],f=o[6],p=o[7],m=o[8],g=o[9],y=o[10],v=o[11],S=o[12],x=o[13],E=o[14],T=o[15],w=e.normal.elements;w[0]=u+c,w[1]=p+f,w[2]=v+y,e.distance=T+E,e.normalize();var C=i.normal.elements;C[0]=u-c,C[1]=p-f,C[2]=v-y,i.distance=T-E,i.normalize();var b=n.normal.elements;b[0]=u+l,b[1]=p+_,b[2]=v+m,n.distance=T+S,n.normalize();var M=r.normal.elements;M[0]=u-l,M[1]=p-_,M[2]=v-m,r.distance=T-S,r.normalize();var I=a.normal.elements;I[0]=u-h,I[1]=p-d,I[2]=v-g,a.distance=T-x,a.normalize();var D=s.normal.elements;D[0]=u+h,D[1]=p+d,D[2]=v+g,s.distance=T+x,s.normalize()},t._get3PlaneInterPoint=function(e,i,n){var r=e.normal,a=i.normal,s=n.normal;Pe.cross(a,s,t._tempV30),Pe.cross(s,r,t._tempV31),Pe.cross(r,a,t._tempV32);var o=Pe.dot(r,t._tempV30),l=Pe.dot(a,t._tempV31),h=Pe.dot(s,t._tempV32);return Pe.scale(t._tempV30,-e.distance/o,t._tempV33),Pe.scale(t._tempV31,-i.distance/l,t._tempV34),Pe.scale(t._tempV32,-n.distance/h,t._tempV35),Pe.add(t._tempV33,t._tempV34,t._tempV36),Pe.add(t._tempV35,t._tempV36,t._tempV37),t._tempV37},n(t,["_tempV30",function(){return this._tempV30=new Pe},"_tempV31",function(){return this._tempV31=new Pe},"_tempV32",function(){return this._tempV32=new Pe},"_tempV33",function(){return this._tempV33=new Pe},"_tempV34",function(){return this._tempV34=new Pe},"_tempV35",function(){return this._tempV35=new Pe},"_tempV36",function(){return this._tempV36=new Pe},"_tempV37",function(){return this._tempV37=new Pe}]),t}(),Ee=function(){function t(t,e){this.center=null,this.radius=NaN,this.center=t,this.radius=e}r(t,"laya.d3.math.BoundSphere");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.toDefault=function(){this.center.toDefault(),this.radius=0},e.intersectsRayDistance=function(t){return Te.intersectsRayAndSphereRD(t,this)},e.intersectsRayPoint=function(t,e){return Te.intersectsRayAndSphereRP(t,this,e)},e.cloneTo=function(t){var e=t;this.center.cloneTo(e.center),e.radius=this.radius},e.clone=function(){var t=new this.constructor(new Pe,new Pe);return this.cloneTo(t),t},t.createFromSubPoints=function(e,i,n,r){if(null==e)throw new Error("points");if(i<0||i>=e.length)throw new Error("start"+i+"Must be in the range [0, "+(e.length-1)+"]");if(n<0||i+n>e.length)throw new Error("count"+n+"Must be in the range <= "+e.length+"}");var a=i+n,s=t._tempVector3;s.elements[0]=0,s.elements[1]=0,s.elements[2]=0;for(var o=i;o<a;++o)Pe.add(e[o],s,s);var l=r.center;Pe.scale(s,1/n,l);var h=0;for(o=i;o<a;++o){var c=Pe.distanceSquared(l,e[o]);c>h&&(h=c)}r.radius=Math.sqrt(h)},t.createfromPoints=function(e,i){if(null==e)throw new Error("points");t.createFromSubPoints(e,0,e.length,i)},n(t,["_tempVector3",function(){return this._tempVector3=new Pe}]),t}(),Te=function(){function t(){}return r(t,"laya.d3.math.Collision"),t.distancePlaneToPoint=function(t,e){return Pe.dot(t.normal,e)-t.distance},t.distanceBoxToPoint=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],c=e.elements,u=c[0],_=c[1],d=c[2],f=0;return u<n&&(f+=(n-u)*(n-u)),u>o&&(f+=(o-u)*(o-u)),_<r&&(f+=(r-_)*(r-_)),_>l&&(f+=(l-_)*(l-_)),d<a&&(f+=(a-d)*(a-d)),d>h&&(f+=(h-d)*(h-d)),Math.sqrt(f)},t.distanceBoxToBox=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],c=e.min.elements,u=c[0],_=c[1],d=c[2],f=e.max.elements,p=f[0],m=f[1],g=f[2],y=0,v=NaN;return n>p?y+=(v=n-p)*v:u>o&&(y+=(v=u-o)*v),r>m?y+=(v=r-m)*v:_>l&&(y+=(v=_-l)*v),a>g?y+=(v=a-g)*v:d>h&&(y+=(v=d-h)*v),Math.sqrt(y)},t.distanceSphereToPoint=function(t,e){var i=Math.sqrt(Pe.distanceSquared(t.center,e));return i-=t.radius,Math.max(i,0)},t.distanceSphereToSphere=function(t,e){var i=Math.sqrt(Pe.distanceSquared(t.center,e.center));return i-=t.radius+e.radius,Math.max(i,0)},t.intersectsRayAndTriangleRD=function(e,i,n,r,a){var s=e.origin.elements,o=s[0],l=s[1],h=s[2],c=e.direction.elements,u=c[0],_=c[1],d=c[2],f=i.elements,p=f[0],m=f[1],g=f[2],y=n.elements,v=y[0],S=y[1],x=y[2],E=r.elements,T=E[0],w=E[1],C=E[2],b=t._tempV30.elements,M=b[0],I=b[1],D=b[2];M=v-p,I=S-m,D=x-g;var A=t._tempV31.elements,R=A[0],L=A[1],P=A[2];R=T-p,L=w-m,P=C-g;var N=t._tempV32.elements,O=N[0],V=N[1],k=N[2],F=M*(O=_*P-d*L)+I*(V=d*R-u*P)+D*(k=u*L-_*R);if(we.isZero(F))return!1;var B=1/F,U=t._tempV33.elements,H=U[0],G=U[1],W=U[2],z=(H=o-p)*O+(G=l-m)*V+(W=h-g)*k;if((z*=B)<0||z>1)return!1;var Y=t._tempV34.elements,X=Y[0],j=Y[1],K=Y[2],q=u*(X=G*D-W*I)+_*(j=W*M-H*D)+d*(K=H*I-G*M);if((q*=B)<0||z+q>1)return!1;var Z=R*X+L*j+P*K;return!((Z*=B)<0)},t.intersectsRayAndTriangleRP=function(e,i,n,r,a){return t.intersectsRayAndTriangleRD(e,i,n,r,NaN)?(Pe.scale(e.direction,NaN,t._tempV30),Pe.add(e.origin,t._tempV30,a),!0):(a=Pe.ZERO,!1)},t.intersectsRayAndPoint=function(e,i){Pe.subtract(e.origin,i,t._tempV30);var n=Pe.dot(t._tempV30,e.direction),r=Pe.dot(t._tempV30,t._tempV30)-we.zeroTolerance;return!(r>0&&n>0)&&!(n*n-r<0)},t.intersectsRayAndRay=function(e,i,n){var r=e.origin,a=r.elements,s=a[0],o=a[1],l=a[2],h=e.direction,c=h.elements,u=c[0],_=c[1],d=c[2],f=i.origin,p=f.elements,m=p[0],g=p[1],y=p[2],v=i.direction,S=v.elements,x=S[0],E=S[1],T=S[2];Pe.cross(h,v,t._tempV30);var w=t._tempV30.elements,C=Pe.scalarLengthSquared(t._tempV30);if(we.isZero(C)&&we.nearEqual(m,s)&&we.nearEqual(g,o)&&we.nearEqual(y,l))return Pe.ZERO.cloneTo(n),!0;var b=m-s,M=g-o,I=y-l,D=x,A=E,R=T,L=w[0],P=w[1],N=w[2],O=(b*A*N+M*R*L+I*D*P-b*R*P-M*D*N-I*A*L)/C,V=(b*(A=_)*N+M*(R=d)*L+I*(D=u)*P-b*R*P-M*D*N-I*A*L)/C;Pe.scale(h,O,t._tempV30),Pe.scale(v,V,t._tempV31),Pe.add(r,t._tempV30,t._tempV32),Pe.add(f,t._tempV31,t._tempV33);var k=t._tempV32.elements,F=t._tempV33.elements;return we.nearEqual(F[0],k[0])&&we.nearEqual(F[1],k[1])&&we.nearEqual(F[2],k[2])?(t._tempV32.cloneTo(n),!0):(Pe.ZERO.cloneTo(n),!1)},t.intersectsPlaneAndTriangle=function(e,i,n,r){var a=t.intersectsPlaneAndPoint(e,i),s=t.intersectsPlaneAndPoint(e,n),o=t.intersectsPlaneAndPoint(e,r);return a==Ie.PlaneIntersectionType_Front&&s==Ie.PlaneIntersectionType_Front&&o==Ie.PlaneIntersectionType_Front?Ie.PlaneIntersectionType_Front:a==Ie.PlaneIntersectionType_Back&&s==Ie.PlaneIntersectionType_Back&&o==Ie.PlaneIntersectionType_Back?Ie.PlaneIntersectionType_Back:Ie.PlaneIntersectionType_Intersecting},t.intersectsRayAndPlaneRD=function(t,e,i){var n=e.normal,r=Pe.dot(n,t.direction);if(we.isZero(r))return!1;var a=Pe.dot(n,t.origin);return!((-e.distance-a)/r<0)},t.intersectsRayAndPlaneRP=function(e,i,n){return t.intersectsRayAndPlaneRD(e,i,NaN)?(Pe.scale(e.direction,NaN,t._tempV30),Pe.add(e.origin,t._tempV30,t._tempV31),t._tempV31,!0):(Pe.ZERO,!1)},t.intersectsRayAndBoxRD=function(t,e){var i=t.origin.elements,n=i[0],r=i[1],a=i[2],s=t.direction.elements,o=s[0],l=s[1],h=s[2],c=e.min.elements,u=c[0],_=c[1],d=c[2],f=e.max.elements,p=f[0],m=f[1],g=f[2],y=0,v=we.MaxValue;if(we.isZero(o)){if(n<u||n>p)return-1}else{var S=1/o,x=(u-n)*S,E=(p-n)*S;if(x>E){var T=x;x=E,E=T}if((y=Math.max(x,y))>(v=Math.min(E,v)))return-1}if(we.isZero(l)){if(r<_||r>m)return-1}else{var w=1/l,C=(_-r)*w,b=(m-r)*w;if(C>b){var M=C;C=b,b=M}if((y=Math.max(C,y))>(v=Math.min(b,v)))return-1}if(we.isZero(h)){if(a<d||a>g)return-1}else{var I=1/h,D=(d-a)*I,A=(g-a)*I;if(D>A){var R=D;D=A,A=R}if((y=Math.max(D,y))>(v=Math.min(A,v)))return-1}return y},t.intersectsRayAndBoxRP=function(e,i,n){var r=t.intersectsRayAndBoxRD(e,i);return-1===r?(Pe.ZERO.cloneTo(n),r):(Pe.scale(e.direction,r,t._tempV30),Pe.add(e.origin,t._tempV30,t._tempV31),t._tempV31.cloneTo(n),r)},t.intersectsRayAndSphereRD=function(e,i){var n=i.radius;Pe.subtract(e.origin,i.center,t._tempV30);var r=Pe.dot(t._tempV30,e.direction),a=Pe.dot(t._tempV30,t._tempV30)-n*n;if(a>0&&r>0)return-1;var s=r*r-a;if(s<0)return-1;var o=-r-Math.sqrt(s);return o<0&&(o=0),o},t.intersectsRayAndSphereRP=function(e,i,n){var r=t.intersectsRayAndSphereRD(e,i);return-1===r?(Pe.ZERO.cloneTo(n),r):(Pe.scale(e.direction,r,t._tempV30),Pe.add(e.origin,t._tempV30,t._tempV31),t._tempV31.cloneTo(n),r)},t.intersectsSphereAndTriangle=function(e,i,n,r){var a=e.center,s=e.radius;return t.closestPointPointTriangle(a,i,n,r,t._tempV30),Pe.subtract(t._tempV30,a,t._tempV31),Pe.dot(t._tempV31,t._tempV31)<=s*s},t.intersectsPlaneAndPoint=function(t,e){var i=Pe.dot(t.normal,e)+t.distance;return i>0?Ie.PlaneIntersectionType_Front:i<0?Ie.PlaneIntersectionType_Back:Ie.PlaneIntersectionType_Intersecting},t.intersectsPlaneAndPlane=function(e,i){Pe.cross(e.normal,i.normal,t._tempV30);var n=Pe.dot(t._tempV30,t._tempV30);return!we.isZero(n)},t.intersectsPlaneAndPlaneRL=function(e,i,n){var r=e.normal,a=i.normal;Pe.cross(r,a,t._tempV34);var s=Pe.dot(t._tempV34,t._tempV34);return!we.isZero(s)&&(Pe.scale(a,e.distance,t._tempV30),Pe.scale(r,i.distance,t._tempV31),Pe.subtract(t._tempV30,t._tempV31,t._tempV32),Pe.cross(t._tempV32,t._tempV34,t._tempV33),Pe.normalize(t._tempV34,t._tempV34),new Re(t._tempV33,t._tempV34),!0)},t.intersectsPlaneAndBox=function(e,i){var n=e.distance,r=e.normal,a=r.elements,s=a[0],o=a[1],l=a[2],h=i.min.elements,c=h[0],u=h[1],_=h[2],d=i.max.elements,f=d[0],p=d[1],m=d[2];t._tempV30.elements[0]=s>0?c:f,t._tempV30.elements[1]=o>0?u:p,t._tempV30.elements[2]=l>0?_:m,t._tempV31.elements[0]=s>0?f:c,t._tempV31.elements[1]=o>0?p:u,t._tempV31.elements[2]=l>0?m:_;var g=Pe.dot(r,t._tempV30);return g+n>0?Ie.PlaneIntersectionType_Front:(g=Pe.dot(r,t._tempV31))+n<0?Ie.PlaneIntersectionType_Back:Ie.PlaneIntersectionType_Intersecting},t.intersectsPlaneAndSphere=function(t,e){var i=e.radius,n=Pe.dot(t.normal,e.center)+t.distance;return n>i?Ie.PlaneIntersectionType_Front:n<-i?Ie.PlaneIntersectionType_Back:Ie.PlaneIntersectionType_Intersecting},t.intersectsBoxAndBox=function(t,e){var i=t.min.elements,n=t.max.elements,r=e.min.elements,a=e.max.elements;return!(i[0]>a[0]||r[0]>n[0]||i[1]>a[1]||r[1]>n[1]||i[2]>a[2]||r[2]>n[2])},t.intersectsBoxAndSphere=function(e,i){var n=i.center,r=i.radius;return Pe.Clamp(n,e.min,e.max,t._tempV30),Pe.distanceSquared(n,t._tempV30)<=r*r},t.intersectsSphereAndSphere=function(t,e){var i=t.radius+e.radius;return Pe.distanceSquared(t.center,e.center)<=i*i},t.boxContainsPoint=function(t,e){var i=t.min.elements,n=t.max.elements,r=e.elements;return i[0]<=r[0]&&n[0]>=r[0]&&i[1]<=r[1]&&n[1]>=r[1]&&i[2]<=r[2]&&n[2]>=r[2]?1:0},t.boxContainsBox=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],c=e.min.elements,u=c[0],_=c[1],d=c[2],f=e.max.elements,p=f[0],m=f[1],g=f[2];return o<u||n>p?0:l<_||r>m?0:h<d||a>g?0:n<=u&&p<=p&&r<=_&&m<=l&&a<=d&&g<=h?1:2},t.boxContainsSphere=function(e,i){var n=e.min,r=n.elements,a=r[0],s=r[1],o=r[2],l=e.max,h=l.elements,c=h[0],u=h[1],_=h[2],d=i.center,f=d.elements,p=f[0],m=f[1],g=f[2],y=i.radius;return Pe.Clamp(d,n,l,t._tempV30),Pe.distanceSquared(d,t._tempV30)>y*y?0:a+y<=p&&p<=c-y&&c-a>y&&s+y<=m&&m<=u-y&&u-s>y&&o+y<=g&&g<=_-y&&_-o>y?1:2},t.sphereContainsPoint=function(t,e){return Pe.distanceSquared(e,t.center)<=t.radius*t.radius?1:0},t.sphereContainsTriangle=function(e,i,n,r){var a=t.sphereContainsPoint(e,i),s=t.sphereContainsPoint(e,n),o=t.sphereContainsPoint(e,r);return 1==a&&1==s&&1==o?1:t.intersectsSphereAndTriangle(e,i,n,r)?2:0},t.sphereContainsBox=function(e,i){var n=e.center.elements,r=(n[0],n[1],n[2],e.radius),a=i.min.elements,s=(a[0],a[1],a[2],i.max.elements),o=(s[0],s[1],s[2],t._tempV30.elements);if(o[0],o[1],o[2],!t.intersectsBoxAndSphere(i,e))return 0;var l=r*r;return Pe.scalarLengthSquared(t._tempV30)>l?2:Pe.scalarLengthSquared(t._tempV30)>l?2:Pe.scalarLengthSquared(t._tempV30)>l?2:Pe.scalarLengthSquared(t._tempV30)>l?2:Pe.scalarLengthSquared(t._tempV30)>l?2:Pe.scalarLengthSquared(t._tempV30)>l?2:Pe.scalarLengthSquared(t._tempV30)>l?2:Pe.scalarLengthSquared(t._tempV30)>l?2:1},t.sphereContainsSphere=function(t,e){var i=t.radius,n=e.radius,r=Pe.distance(t.center,e.center);return i+n<r?0:i-n<r?2:1},t.closestPointPointTriangle=function(e,i,n,r,a){Pe.subtract(n,i,t._tempV30),Pe.subtract(r,i,t._tempV31),Pe.subtract(e,i,t._tempV32),Pe.subtract(e,n,t._tempV33),Pe.subtract(e,r,t._tempV34);var s=Pe.dot(t._tempV30,t._tempV32),o=Pe.dot(t._tempV31,t._tempV32),l=Pe.dot(t._tempV30,t._tempV33),h=Pe.dot(t._tempV31,t._tempV33),c=Pe.dot(t._tempV30,t._tempV34),u=Pe.dot(t._tempV31,t._tempV34);if(s<=0&&o<=0)i.cloneTo(a);else if(l>=0&&h<=l)n.cloneTo(a);else{var _=s*h-l*o;if(_<=0&&s>=0&&l<=0){var d=s/(s-l);return Pe.scale(t._tempV30,d,a),void Pe.add(i,a,a)}if(u>=0&&c<=u)r.cloneTo(a);else{var f=c*o-s*u;if(f<=0&&o>=0&&u<=0){var p=o/(o-u);return Pe.scale(t._tempV31,p,a),void Pe.add(i,a,a)}var m=l*u-c*h;if(m<=0&&h-l>=0&&c-u>=0){var g=(h-l)/(h-l+(c-u));return Pe.subtract(r,n,a),Pe.scale(a,g,a),void Pe.add(n,a,a)}var y=1/(m+f+_),v=f*y,S=_*y;Pe.scale(t._tempV30,v,t._tempV35),Pe.scale(t._tempV31,S,t._tempV36),Pe.add(t._tempV35,t._tempV36,a),Pe.add(i,a,a)}}},t.closestPointPlanePoint=function(e,i,n){var r=e.normal,a=Pe.dot(r,i)-e.distance;Pe.scale(r,a,t._tempV30),Pe.subtract(i,t._tempV30,n)},t.closestPointBoxPoint=function(e,i,n){Pe.max(i,e.min,t._tempV30),Pe.min(t._tempV30,e.max,n)},t.closestPointSpherePoint=function(t,e,i){var n=t.center;Pe.subtract(e,n,i),Pe.normalize(i,i),Pe.scale(i,t.radius,i),Pe.add(i,n,i)},t.closestPointSphereSphere=function(t,e,i){var n=t.center;Pe.subtract(e.center,n,i),Pe.normalize(i,i),Pe.scale(i,t.radius,i),Pe.add(i,n,i)},n(t,["_tempV30",function(){return this._tempV30=new Pe},"_tempV31",function(){return this._tempV31=new Pe},"_tempV32",function(){return this._tempV32=new Pe},"_tempV33",function(){return this._tempV33=new Pe},"_tempV34",function(){return this._tempV34=new Pe},"_tempV35",function(){return this._tempV35=new Pe},"_tempV36",function(){return this._tempV36=new Pe}]),t}(),we=(function(){function t(){}r(t,"laya.d3.math.ContainmentType"),t.Disjoint=0,t.Contains=1,t.Intersects=2}(),function(){function t(){}return r(t,"laya.d3.math.MathUtils3D"),t.isZero=function(e){return Math.abs(e)<t.zeroTolerance},t.nearEqual=function(e,i){return!!t.isZero(e-i)},t.fastInvSqrt=function(e){return t.isZero(e)?e:1/Math.sqrt(e)},n(t,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=3.40282347e38},"MinValue",function(){return this.MinValue=-3.40282347e38}]),t}()),Ce=function(){function t(){var t=this.elements=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}r(t,"laya.d3.math.Matrix3x3");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.determinant=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8];return e*(h*a-s*l)+i*(-h*r+s*o)+n*(l*r-a*o)},e.translate=function(t,e){var i=e.elements,n=this.elements,r=t.elements,a=n[0],s=n[1],o=n[2],l=n[3],h=n[4],c=n[5],u=n[6],_=n[7],d=n[8],f=r[0],p=r[1];i[0]=a,i[1]=s,i[2]=o,i[3]=l,i[4]=h,i[5]=c,i[6]=f*a+p*l+u,i[7]=f*s+p*h+_,i[8]=f*o+p*c+d},e.rotate=function(t,e){var i=e.elements,n=this.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],h=n[5],c=n[6],u=n[7],_=n[8],d=Math.sin(t),f=Math.cos(t);i[0]=f*r+d*o,i[1]=f*a+d*l,i[2]=f*s+d*h,i[3]=f*o-d*r,i[4]=f*l-d*a,i[5]=f*h-d*s,i[6]=c,i[7]=u,i[8]=_},e.scale=function(t,e){var i=e.elements,n=this.elements,r=t.elements,a=r[0],s=r[1];i[0]=a*n[0],i[1]=a*n[1],i[2]=a*n[2],i[3]=s*n[3],i[4]=s*n[4],i[5]=s*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8]},e.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],_=u*o-l*c,d=-u*s+l*h,f=c*s-o*h,p=n*_+r*d+a*f;p||(t=null),p=1/p,e[0]=_*p,e[1]=(-u*r+a*c)*p,e[2]=(l*r-a*o)*p,e[3]=d*p,e[4]=(u*n-a*h)*p,e[5]=(-l*n+a*s)*p,e[6]=f*p,e[7]=(-c*n+r*h)*p,e[8]=(o*n-r*s)*p},e.transpose=function(t){var e=t.elements,i=this.elements;if(t===this){var n=i[1],r=i[2],a=i[5];e[1]=i[3],e[2]=i[6],e[3]=n,e[5]=i[7],e[6]=r,e[7]=a}else e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8]},e.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},e.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<9;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.createFromTranslation=function(t,e){e.elements;var i=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=i[0],e[7]=i[1],e[8]=1},t.createFromRotation=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[0]=r,i[1]=n,i[2]=0,i[3]=-n,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1},t.createFromScaling=function(t,e){var i=e.elements,n=t.elements;i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1},t.createFromMatrix4x4=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],l=r[2],h=r[3],c=r[4],u=r[5],_=r[6],d=r[7],f=r[8],p=a[0],m=a[1],g=a[2],y=a[3],v=a[4],S=a[5],x=a[6],E=a[7],T=a[8];n[0]=p*s+m*h+g*_,n[1]=p*o+m*c+g*d,n[2]=p*l+m*u+g*f,n[3]=y*s+v*h+S*_,n[4]=y*o+v*c+S*d,n[5]=y*l+v*u+S*f,n[6]=x*s+E*h+T*_,n[7]=x*o+E*c+T*d,n[8]=x*l+E*u+T*f},t.lookAt=function(e,i,n,r){Pe.subtract(e,i,t._tempV30),Pe.normalize(t._tempV30,t._tempV30),Pe.cross(n,t._tempV30,t._tempV31),Pe.normalize(t._tempV31,t._tempV31),Pe.cross(t._tempV30,t._tempV31,t._tempV32);var a=t._tempV30.elements,s=t._tempV31.elements,o=t._tempV32.elements,l=r.elements;l[0]=s[0],l[3]=s[1],l[6]=s[2],l[1]=o[0],l[4]=o[1],l[7]=o[2],l[2]=a[0],l[5]=a[1],l[8]=a[2]},t.DEFAULT=new t,n(t,["_tempV30",function(){return this._tempV30=new Pe},"_tempV31",function(){return this._tempV31=new Pe},"_tempV32",function(){return this._tempV32=new Pe}]),t}(),be=function(){function t(t,e,i,n,r,a,s,o,l,h,c,u,_,d,f,p){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===c&&(c=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===f&&(f=0),void 0===p&&(p=1);var m=this.elements=new Float32Array(16);m[0]=t,m[1]=e,m[2]=i,m[3]=n,m[4]=r,m[5]=a,m[6]=s,m[7]=o,m[8]=l,m[9]=h,m[10]=c,m[11]=u,m[12]=_,m[13]=d,m[14]=f,m[15]=p}r(t,"laya.d3.math.Matrix4x4");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.getElementByRowColumn=function(t,e){if(t<0||t>3)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||e>3)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*t+e]},e.setElementByRowColumn=function(t,e,i){if(t<0||t>3)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||e>3)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*t+e]=i},e.equalsOtherMatrix=function(t){var e=this.elements,i=t.elements;return we.nearEqual(e[0],i[0])&&we.nearEqual(e[1],i[1])&&we.nearEqual(e[2],i[2])&&we.nearEqual(e[3],i[3])&&we.nearEqual(e[4],i[4])&&we.nearEqual(e[5],i[5])&&we.nearEqual(e[6],i[6])&&we.nearEqual(e[7],i[7])&&we.nearEqual(e[8],i[8])&&we.nearEqual(e[9],i[9])&&we.nearEqual(e[10],i[10])&&we.nearEqual(e[11],i[11])&&we.nearEqual(e[12],i[12])&&we.nearEqual(e[13],i[13])&&we.nearEqual(e[14],i[14])&&we.nearEqual(e[15],i[15])},e.decomposeTransRotScale=function(e,i,n){var r=t._tempMatrix4x4;return this.decomposeTransRotMatScale(e,r,n)?(De.createFromMatrix4x4(r,i),!0):(i.identity(),!1)},e.decomposeTransRotMatScale=function(e,i,n){var r=this.elements,a=e.elements,s=i.elements,o=n.elements;a[0]=r[12],a[1]=r[13],a[2]=r[14];var l=r[0],h=r[1],c=r[2],u=r[4],_=r[5],d=r[6],f=r[8],p=r[9],m=r[10],g=o[0]=Math.sqrt(l*l+h*h+c*c),y=o[1]=Math.sqrt(u*u+_*_+d*d),v=o[2]=Math.sqrt(f*f+p*p+m*m);if(we.isZero(g)||we.isZero(y)||we.isZero(v))return s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[12]=s[13]=s[14]=0,s[0]=s[5]=s[10]=s[15]=1,!1;var S=t._tempVector0,x=S.elements;x[0]=f/v,x[1]=p/v,x[2]=m/v;var E=t._tempVector1,T=E.elements;T[0]=l/g,T[1]=h/g,T[2]=c/g;var w=t._tempVector2;Pe.cross(S,E,w);var C=t._tempVector1;return Pe.cross(w,S,C),s[3]=s[7]=s[11]=s[12]=s[13]=s[14]=0,s[15]=1,s[0]=C.x,s[1]=C.y,s[2]=C.z,s[4]=w.x,s[5]=w.y,s[6]=w.z,s[8]=S.x,s[9]=S.y,s[10]=S.z,s[0]*l+s[1]*h+s[2]*c<0&&(o[0]=-g),s[4]*u+s[5]*_+s[6]*d<0&&(o[1]=-y),s[8]*f+s[9]*p+s[10]*m<0&&(o[2]=-v),!0},e.decomposeYawPitchRoll=function(t){var e=t.elements,i=Math.asin(-this.elements[9]);e[1]=i,Math.cos(i)>we.zeroTolerance?(e[2]=Math.atan2(this.elements[1],this.elements[5]),e[0]=Math.atan2(this.elements[8],this.elements[10])):(e[2]=Math.atan2(-this.elements[4],this.elements[0]),e[0]=0)},e.normalize=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=Math.sqrt(e*e+i*i+n*n);if(!r)return t[0]=0,t[1]=0,void(t[2]=0);1!=r&&(r=1/r,t[0]=e*r,t[1]=i*r,t[2]=n*r)},e.transpose=function(){var t,e;return e=(t=this.elements)[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},e.invert=function(t){var e=this.elements,i=t.elements,n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=e[6],c=e[7],u=e[8],_=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],y=e[15],v=n*l-r*o,S=n*h-a*o,x=n*c-s*o,E=r*h-a*l,T=r*c-s*l,w=a*c-s*h,C=u*m-_*p,b=u*g-d*p,M=u*y-f*p,I=_*g-d*m,D=_*y-f*m,A=d*y-f*g,R=v*A-S*D+x*I+E*M-T*b+w*C;0!==Math.abs(R)&&(R=1/R,i[0]=(l*A-h*D+c*I)*R,i[1]=(a*D-r*A-s*I)*R,i[2]=(m*w-g*T+y*E)*R,i[3]=(d*T-_*w-f*E)*R,i[4]=(h*M-o*A-c*b)*R,i[5]=(n*A-a*M+s*b)*R,i[6]=(g*x-p*w-y*S)*R,i[7]=(u*w-d*x+f*S)*R,i[8]=(o*D-l*M+c*C)*R,i[9]=(r*M-n*D-s*C)*R,i[10]=(p*T-m*x+y*v)*R,i[11]=(_*x-u*T-f*v)*R,i[12]=(l*b-o*I-h*C)*R,i[13]=(n*I-r*b+a*C)*R,i[14]=(m*S-p*E-g*v)*R,i[15]=(u*E-_*S+d*v)*R)},e.identity=function(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1},e.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<16;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.getTranslationVector=function(t){var e=this.elements,i=t.elements;i[0]=e[12],i[1]=e[13],i[2]=e[14]},e.setTranslationVector=function(t){var e=this.elements,i=t.elements;e[12]=i[0],e[13]=i[1],e[14]=i[2]},e.getForward=function(t){var e=this.elements,i=t.elements;i[0]=-e[8],i[1]=-e[9],i[2]=-e[10]},e.setForward=function(t){var e=this.elements,i=t.elements;e[8]=-i[0],e[9]=-i[1],e[10]=-i[2]},t.createRotationX=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[2]=i[3]=i[4]=i[7]=i[8]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[15]=1,i[5]=i[10]=r,i[6]=n,i[9]=-n},t.createRotationY=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[3]=i[4]=i[6]=i[7]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[5]=i[15]=1,i[0]=i[10]=r,i[2]=-n,i[8]=n},t.createRotationZ=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[10]=i[15]=1,i[0]=i[5]=r,i[1]=n,i[4]=-n},t.createRotationYawPitchRoll=function(e,i,n,r){De.createFromYawPitchRoll(e,i,n,t._tempQuaternion),t.createRotationQuaternion(t._tempQuaternion,r)},t.createRotationAxis=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=Math.cos(e),l=Math.sin(e),h=r*r,c=a*a,u=s*s,_=r*a,d=r*s,f=a*s,p=i.elements;p[3]=p[7]=p[11]=p[12]=p[13]=p[14]=0,p[15]=1,p[0]=h+o*(1-h),p[1]=_-o*_+l*s,p[2]=d-o*d-l*a,p[4]=_-o*_-l*s,p[5]=c+o*(1-c),p[6]=f-o*f+l*r,p[8]=d-o*d+l*a,p[9]=f-o*f-l*r,p[10]=u+o*(1-u)},t.createRotationQuaternion=function(t,e){var i=t.elements,n=e.elements,r=i[0],a=i[1],s=i[2],o=i[3],l=r*r,h=a*a,c=s*s,u=r*a,_=s*o,d=s*r,f=a*o,p=a*s,m=r*o;n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=1-2*(h+c),n[1]=2*(u+_),n[2]=2*(d-f),n[4]=2*(u-_),n[5]=1-2*(c+l),n[6]=2*(p+m),n[8]=2*(d+f),n[9]=2*(p-m),n[10]=1-2*(h+l)},t.createTranslate=function(t,e){var i=t.elements,n=e.elements;n[4]=n[8]=n[1]=n[9]=n[2]=n[6]=n[3]=n[7]=n[11]=0,n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},t.createScaling=function(t,e){var i=t.elements,n=e.elements;n[0]=i[0],n[5]=i[1],n[10]=i[2],n[1]=n[4]=n[8]=n[12]=n[9]=n[13]=n[2]=n[6]=n[14]=n[3]=n[7]=n[11]=0,n[15]=1},t.multiply=function(t,e,i){var n,r,a,s,o,l,h,c;if(r=i.elements,a=t.elements,r===(s=e.elements))for(s=new Float32Array(16),n=0;n<16;++n)s[n]=r[n];for(n=0;n<4;n++)o=a[n],l=a[n+4],h=a[n+8],c=a[n+12],r[n]=o*s[0]+l*s[1]+h*s[2]+c*s[3],r[n+4]=o*s[4]+l*s[5]+h*s[6]+c*s[7],r[n+8]=o*s[8]+l*s[9]+h*s[10]+c*s[11],r[n+12]=o*s[12]+l*s[13]+h*s[14]+c*s[15]},t.createFromQuaternion=function(t,e){var i=e.elements,n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=r+r,h=a+a,c=s+s,u=r*l,_=a*l,d=a*h,f=s*l,p=s*h,m=s*c,g=o*l,y=o*h,v=o*c;i[0]=1-d-m,i[1]=_+v,i[2]=f-y,i[3]=0,i[4]=_-v,i[5]=1-u-m,i[6]=p+g,i[7]=0,i[8]=f+y,i[9]=p-g,i[10]=1-u-d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1},t.createAffineTransformation=function(t,e,i,n){var r=t.elements,a=e.elements,s=i.elements,o=n.elements,l=a[0],h=a[1],c=a[2],u=a[3],_=l+l,d=h+h,f=c+c,p=l*_,m=l*d,g=l*f,y=h*d,v=h*f,S=c*f,x=u*_,E=u*d,T=u*f,w=s[0],C=s[1],b=s[2];o[0]=(1-(y+S))*w,o[1]=(m+T)*w,o[2]=(g-E)*w,o[3]=0,o[4]=(m-T)*C,o[5]=(1-(p+S))*C,o[6]=(v+x)*C,o[7]=0,o[8]=(g+E)*b,o[9]=(v-x)*b,o[10]=(1-(p+y))*b,o[11]=0,o[12]=r[0],o[13]=r[1],o[14]=r[2],o[15]=1},t.createLookAt=function(e,i,n,r){var a=r.elements,s=t._tempVector0,o=t._tempVector1,l=t._tempVector2;Pe.subtract(e,i,l),Pe.normalize(l,l),Pe.cross(n,l,s),Pe.normalize(s,s),Pe.cross(l,s,o),r.identity(),a[0]=s.x,a[4]=s.y,a[8]=s.z,a[1]=o.x,a[5]=o.y,a[9]=o.z,a[2]=l.x,a[6]=l.y,a[10]=l.z,a[12]=-Pe.dot(s,e),a[13]=-Pe.dot(o,e),a[14]=-Pe.dot(l,e)},t.createPerspective=function(t,e,i,n,r){var a=r.elements,s=1/Math.tan(t/2),o=1/(i-n);a[0]=s/e,a[5]=s,a[10]=(n+i)*o,a[11]=-1,a[14]=2*n*i*o,a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[12]=a[13]=a[15]=0},t.createOrthoOffCenterRH=function(t,e,i,n,r,a,s){var o=s.elements,l=1/(t-e),h=1/(i-n),c=1/(r-a);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=0,o[15]=1,o[0]=-2*l,o[5]=-2*h,o[10]=2*c,o[12]=(t+e)*l,o[13]=(n+i)*h,o[14]=(a+r)*c},t.translation=function(t,e){var i=t.elements,n=e.elements;n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},n(t,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new t},"_tempVector0",function(){return this._tempVector0=new Pe},"_tempVector1",function(){return this._tempVector1=new Pe},"_tempVector2",function(){return this._tempVector2=new Pe},"_tempQuaternion",function(){return this._tempQuaternion=new De},"DEFAULT",function(){return this.DEFAULT=new t},"ZERO",function(){return this.ZERO=new t(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),t}(),Me=function(){function t(t,e){this.extents=null,this.transformation=null,this.extents=t,this.transformation=e}r(t,"laya.d3.math.OrientedBoundBox");var e=t.prototype;return e.getCorners=function(e){var i=t._tempV30.elements,n=t._tempV31.elements,r=t._tempV32.elements,a=this.extents.elements;i[0]=a[0],i[1]=i[2]=0,n[1]=a[1],n[0]=n[2]=0,r[2]=a[2],r[0]=r[1]=0,Pe.TransformNormal(t._tempV30,this.transformation,t._tempV30),Pe.TransformNormal(t._tempV31,this.transformation,t._tempV31),Pe.TransformNormal(t._tempV32,this.transformation,t._tempV32);var s=t._tempV33;this.transformation.getTranslationVector(s),e.length=8,Pe.add(s,t._tempV30,t._tempV34),Pe.add(t._tempV34,t._tempV31,t._tempV34),Pe.add(t._tempV34,t._tempV32,e[0]),Pe.add(s,t._tempV30,t._tempV34),Pe.add(t._tempV34,t._tempV31,t._tempV34),Pe.subtract(t._tempV34,t._tempV32,e[1]),Pe.subtract(s,t._tempV30,t._tempV34),Pe.add(t._tempV34,t._tempV31,t._tempV34),Pe.subtract(t._tempV34,t._tempV32,e[2]),Pe.subtract(s,t._tempV30,t._tempV34),Pe.add(t._tempV34,t._tempV31,t._tempV34),Pe.add(t._tempV34,t._tempV32,e[3]),Pe.add(s,t._tempV30,t._tempV34),Pe.subtract(t._tempV34,t._tempV31,t._tempV34),Pe.add(t._tempV34,t._tempV32,e[4]),Pe.add(s,t._tempV30,t._tempV34),Pe.subtract(t._tempV34,t._tempV31,t._tempV34),Pe.subtract(t._tempV34,t._tempV32,e[5]),Pe.subtract(s,t._tempV30,t._tempV34),Pe.subtract(t._tempV34,t._tempV31,t._tempV34),Pe.subtract(t._tempV34,t._tempV32,e[6]),Pe.subtract(s,t._tempV30,t._tempV34),Pe.subtract(t._tempV34,t._tempV31,t._tempV34),Pe.add(t._tempV34,t._tempV32,e[7])},e.transform=function(t){be.multiply(this.transformation,t,this.transformation)},e.scale=function(t){Pe.multiply(this.extents,t,this.extents)},e.translate=function(e){this.transformation.getTranslationVector(t._tempV30),Pe.add(t._tempV30,e,t._tempV31),this.transformation.setTranslationVector(t._tempV31)},e.Size=function(t){Pe.scale(this.extents,2,t)},e.getSize=function(e){var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],Pe.TransformNormal(t._tempV30,this.transformation,t._tempV30),Pe.TransformNormal(t._tempV31,this.transformation,t._tempV31),Pe.TransformNormal(t._tempV31,this.transformation,t._tempV32);var n=e.elements;n[0]=Pe.scalarLength(t._tempV30),n[1]=Pe.scalarLength(t._tempV31),n[2]=Pe.scalarLength(t._tempV32)},e.getSizeSquared=function(e){var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],Pe.TransformNormal(t._tempV30,this.transformation,t._tempV30),Pe.TransformNormal(t._tempV31,this.transformation,t._tempV31),Pe.TransformNormal(t._tempV31,this.transformation,t._tempV32);var n=e.elements;n[0]=Pe.scalarLengthSquared(t._tempV30),n[1]=Pe.scalarLengthSquared(t._tempV31),n[2]=Pe.scalarLengthSquared(t._tempV32)},e.getCenter=function(t){this.transformation.getTranslationVector(t)},e.containsPoint=function(e){var i=this.extents.elements,n=i[0],r=i[1],a=i[2];this.transformation.invert(t._tempM0),Pe.transformCoordinate(e,t._tempM0,t._tempV30);var s=t._tempV30.elements,o=Math.abs(s[0]),l=Math.abs(s[1]),h=Math.abs(s[2]);return we.nearEqual(o,n)&&we.nearEqual(l,r)&&we.nearEqual(h,a)?2:o<n&&l<r&&h<a?1:0},e.containsPoints=function(e){var i=this.extents.elements,n=i[0],r=i[1],a=i[2];this.transformation.invert(t._tempM0);for(var s=!0,o=!1,l=0;l<e.length;l++){Pe.transformCoordinate(e[l],t._tempM0,t._tempV30);var h=t._tempV30.elements,c=Math.abs(h[0]),u=Math.abs(h[1]),_=Math.abs(h[2]);we.nearEqual(c,n)&&we.nearEqual(u,r)&&we.nearEqual(_,a)&&(o=!0),c<n&&u<r&&_<a?o=!0:s=!1}return s?1:o?2:0},e.containsSphere=function(e,i){void 0===i&&(i=!1);var n=this.extents.elements,r=n[0],a=n[1],s=n[2],o=e.radius;this.transformation.invert(t._tempM0),Pe.transformCoordinate(e.center,t._tempM0,t._tempV30);var l=NaN;if(i?l=o:(Pe.scale(Pe.UnitX,o,t._tempV31),Pe.TransformNormal(t._tempV31,t._tempM0,t._tempV31),l=Pe.scalarLength(t._tempV31)),Pe.scale(this.extents,-1,t._tempV32),Pe.Clamp(t._tempV30,t._tempV32,this.extents,t._tempV33),Pe.distanceSquared(t._tempV30,t._tempV33)>l*l)return 0;var h=t._tempV30.elements,c=h[0],u=h[1],_=h[2],d=t._tempV32.elements,f=d[0],p=d[1],m=d[2];return f+l<=c&&c<=r-l&&r-f>l&&p+l<=u&&u<=a-l&&a-p>l&&m+l<=_&&_<=s-l&&s-m>l?1:2},e.containsOrientedBoundBox=function(e){var i=0,n=0;e.getCorners(t._corners);var r=this.containsPoints(t._corners);if(0!=r)return r;var a=this.extents.elements;e.extents.cloneTo(t._tempV35);var s=t._tempV35.elements;t._getRows(this.transformation,t._rows1),t._getRows(e.transformation,t._rows2);var o=NaN,l=NaN,h=NaN;for(i=0;i<4;i++)for(n=0;n<4;n++)3==i||3==n?(t._tempM0.setElementByRowColumn(i,n,0),t._tempM1.setElementByRowColumn(i,n,0)):(h=Pe.dot(t._rows1[i],t._rows2[n]),t._tempM0.setElementByRowColumn(i,n,h),t._tempM1.setElementByRowColumn(i,n,Math.abs(h)));e.getCenter(t._tempV34),this.getCenter(t._tempV36),Pe.subtract(t._tempV34,t._tempV36,t._tempV30);var c=t._tempV31.elements;c[0]=Pe.dot(t._tempV30,t._rows1[0]),c[1]=Pe.dot(t._tempV30,t._rows1[1]),c[2]=Pe.dot(t._tempV30,t._rows1[2]);var u=t._tempV32.elements,_=t._tempV33.elements;for(i=0;i<3;i++)if(u[0]=t._tempM1.getElementByRowColumn(i,0),u[1]=t._tempM1.getElementByRowColumn(i,1),u[2]=t._tempM1.getElementByRowColumn(i,2),o=a[i],l=Pe.dot(t._tempV35,t._tempV32),Math.abs(c[i])>o+l)return 0;for(n=0;n<3;n++)if(u[0]=t._tempM1.getElementByRowColumn(0,n),u[1]=t._tempM1.getElementByRowColumn(1,n),u[2]=t._tempM1.getElementByRowColumn(2,n),_[0]=t._tempM0.getElementByRowColumn(0,n),_[1]=t._tempM0.getElementByRowColumn(1,n),_[2]=t._tempM0.getElementByRowColumn(2,n),o=Pe.dot(this.extents,t._tempV32),l=s[n],Math.abs(Pe.dot(t._tempV31,t._tempV33))>o+l)return 0;for(i=0;i<3;i++)for(n=0;n<3;n++){var d=(i+1)%3,f=(i+2)%3,p=(n+1)%3,m=(n+2)%3;if(o=a[d]*t._tempM1.getElementByRowColumn(f,n)+a[f]*t._tempM1.getElementByRowColumn(d,n),l=s[p]*t._tempM1.getElementByRowColumn(i,m)+s[m]*t._tempM1.getElementByRowColumn(i,p),Math.abs(c[f]*t._tempM0.getElementByRowColumn(d,n)-c[d]*t._tempM0.getElementByRowColumn(f,n))>o+l)return 0}return 2},e.containsLine=function(e,i){t._corners[0]=e,t._corners[1]=i;var n=this.containsPoints(t._corners);if(0!=n)return n;var r=this.extents.elements,a=r[0],s=r[1],o=r[2];this.transformation.invert(t._tempM0),Pe.transformCoordinate(e,t._tempM0,t._tempV30),Pe.transformCoordinate(i,t._tempM0,t._tempV31),Pe.add(t._tempV30,t._tempV31,t._tempV32),Pe.scale(t._tempV32,.5,t._tempV32),Pe.subtract(t._tempV30,t._tempV32,t._tempV33);var l=t._tempV33.elements,h=l[0],c=l[1],u=l[2],_=t._tempV34.elements,d=_[0]=Math.abs(l[0]),f=_[1]=Math.abs(l[1]),p=_[2]=Math.abs(l[2]),m=t._tempV32.elements,g=m[0],y=m[1],v=m[2];return Math.abs(g)>a+d?0:Math.abs(y)>s+f?0:Math.abs(v)>o+p?0:Math.abs(y*u-v*c)>s*p+o*f?0:Math.abs(g*u-v*h)>a*p+o*d?0:Math.abs(g*c-y*h)>a*f+s*d?0:2},e.containsBoundBox=function(e){var i=0,n=0,r=e.min,a=e.max;e.getCorners(t._corners);var s=this.containsPoints(t._corners);if(0!=s)return s;Pe.subtract(a,r,t._tempV30),Pe.scale(t._tempV30,.5,t._tempV30),Pe.add(r,t._tempV30,t._tempV30),Pe.subtract(a,t._tempV30,t._tempV31);var o=this.extents.elements,l=t._tempV31.elements;t._getRows(this.transformation,t._rows1),this.transformation.invert(t._tempM0);var h=NaN,c=NaN;for(i=0;i<3;i++)for(n=0;n<3;n++)t._tempM1.setElementByRowColumn(i,n,Math.abs(t._tempM0.getElementByRowColumn(i,n)));this.getCenter(t._tempV35),Pe.subtract(t._tempV30,t._tempV35,t._tempV32);var u=t._tempV31.elements;u[0]=Pe.dot(t._tempV32,t._rows1[0]),u[1]=Pe.dot(t._tempV32,t._rows1[1]),u[2]=Pe.dot(t._tempV32,t._rows1[2]);var _=t._tempV33.elements,d=t._tempV34.elements;for(i=0;i<3;i++)if(_[0]=t._tempM1.getElementByRowColumn(i,0),_[1]=t._tempM1.getElementByRowColumn(i,1),_[2]=t._tempM1.getElementByRowColumn(i,2),h=o[i],c=Pe.dot(t._tempV31,t._tempV33),Math.abs(u[i])>h+c)return 0;for(n=0;n<3;n++)if(_[0]=t._tempM1.getElementByRowColumn(0,n),_[1]=t._tempM1.getElementByRowColumn(1,n),_[2]=t._tempM1.getElementByRowColumn(2,n),d[0]=t._tempM0.getElementByRowColumn(0,n),d[1]=t._tempM0.getElementByRowColumn(1,n),d[2]=t._tempM0.getElementByRowColumn(2,n),h=Pe.dot(this.extents,t._tempV33),c=l[n],Math.abs(Pe.dot(t._tempV31,t._tempV34))>h+c)return 0;for(i=0;i<3;i++)for(n=0;n<3;n++){var f=(i+1)%3,p=(i+2)%3,m=(n+1)%3,g=(n+2)%3;if(h=o[f]*t._tempM1.getElementByRowColumn(p,n)+o[p]*t._tempM1.getElementByRowColumn(f,n),c=l[m]*t._tempM1.getElementByRowColumn(i,g)+l[g]*t._tempM1.getElementByRowColumn(i,m),Math.abs(u[p]*t._tempM0.getElementByRowColumn(f,n)-u[f]*t._tempM0.getElementByRowColumn(p,n))>h+c)return 0}return 2},e.intersectsRay=function(e,i){Pe.scale(this.extents,-1,t._tempV30),this.transformation.invert(t._tempM0),Pe.TransformNormal(e.direction,t._tempM0,t._ray.direction),Pe.transformCoordinate(e.origin,t._tempM0,t._ray.origin),t._boxBound1.min=t._tempV30,t._boxBound1.max=this.extents;var n=Te.intersectsRayAndBoxRP(t._ray,t._boxBound1,i);return-1!==n&&Pe.transformCoordinate(i,this.transformation,i),n},e._getLocalCorners=function(e){e.length=8;var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],Pe.add(t._tempV30,t._tempV31,t._tempV33),Pe.add(t._tempV33,t._tempV32,e[0]),Pe.add(t._tempV30,t._tempV31,t._tempV33),Pe.subtract(t._tempV33,t._tempV32,e[1]),Pe.subtract(t._tempV31,t._tempV30,t._tempV33),Pe.subtract(t._tempV33,t._tempV30,e[2]),Pe.subtract(t._tempV31,t._tempV30,t._tempV33),Pe.add(t._tempV33,t._tempV32,e[3]),Pe.subtract(t._tempV30,t._tempV31,t._tempV33),Pe.add(t._tempV33,t._tempV32,e[4]),Pe.subtract(t._tempV30,t._tempV31,t._tempV33),Pe.subtract(t._tempV33,t._tempV32,e[5]),Pe.scale(e[0],-1,e[6]),Pe.subtract(t._tempV32,t._tempV30,t._tempV33),Pe.subtract(t._tempV33,t._tempV31,e[7])},e.equals=function(t){return this.extents==t.extents&&this.transformation==t.transformation},e.cloneTo=function(t){var e=t;this.extents.cloneTo(e.extents),this.transformation.cloneTo(e.transformation)},t.createByBoundBox=function(e,i){var n=e.min,r=e.max;Pe.subtract(r,n,t._tempV30),Pe.scale(t._tempV30,.5,t._tempV30),Pe.add(n,t._tempV30,t._tempV31),Pe.subtract(r,t._tempV31,t._tempV32),be.translation(t._tempV31,t._tempM0);var a=t._tempV32.clone(),s=t._tempM0.clone();i.extents=a,i.transformation=s},t.createByMinAndMaxVertex=function(e,i){return Pe.subtract(i,e,t._tempV30),Pe.scale(t._tempV30,.5,t._tempV30),Pe.add(e,t._tempV30,t._tempV31),Pe.subtract(i,t._tempV31,t._tempV32),be.translation(t._tempV31,t._tempM0),new t(t._tempV32,t._tempM0)},t._getRows=function(t,e){e.length=3;var i=t.elements,n=e[0].elements;n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=e[1].elements;r[0]=i[4],r[1]=i[5],r[2]=i[6];var a=e[2].elements;a[0]=i[8],a[1]=i[9],a[2]=i[10]},t.getObbtoObbMatrix4x4=function(e,i,n,r){var a=e.transformation,s=i.transformation;if(n){t._getRows(a,t._rows1),t._getRows(s,t._rows2);for(var o=0;o<3;o++)for(var l=0;l<3;l++)r.setElementByRowColumn(o,l,Pe.dot(t._rows2[o],t._rows1[l]));i.getCenter(t._tempV30),e.getCenter(t._tempV31),Pe.subtract(t._tempV30,t._tempV31,t._tempV32);var h=r.elements;h[12]=Pe.dot(t._tempV32,t._rows1[0]),h[13]=Pe.dot(t._tempV32,t._rows1[1]),h[14]=Pe.dot(t._tempV32,t._rows1[2]),h[15]=1}else a.invert(t._tempM0),be.multiply(s,t._tempM0,r)},t.merge=function(e,i,n){var r=e.extents,a=e.transformation;t.getObbtoObbMatrix4x4(e,i,n,t._tempM0),i._getLocalCorners(t._corners),Pe.transformCoordinate(t._corners[0],t._tempM0,t._corners[0]),Pe.transformCoordinate(t._corners[1],t._tempM0,t._corners[1]),Pe.transformCoordinate(t._corners[2],t._tempM0,t._corners[2]),Pe.transformCoordinate(t._corners[3],t._tempM0,t._corners[3]),Pe.transformCoordinate(t._corners[4],t._tempM0,t._corners[4]),Pe.transformCoordinate(t._corners[5],t._tempM0,t._corners[5]),Pe.transformCoordinate(t._corners[6],t._tempM0,t._corners[6]),Pe.transformCoordinate(t._corners[7],t._tempM0,t._corners[7]),Pe.scale(r,-1,t._boxBound1.min),r.cloneTo(t._boxBound1.max),Se.createfromPoints(t._corners,t._boxBound2),Se.merge(t._boxBound2,t._boxBound1,t._boxBound3);var s=t._boxBound3.min,o=t._boxBound3.max;Pe.subtract(o,s,t._tempV30),Pe.scale(t._tempV30,.5,t._tempV30),Pe.add(s,t._tempV30,t._tempV32),Pe.subtract(o,t._tempV32,r),Pe.transformCoordinate(t._tempV32,a,t._tempV33)},n(t,["_tempV30",function(){return this._tempV30=new Pe},"_tempV31",function(){return this._tempV31=new Pe},"_tempV32",function(){return this._tempV32=new Pe},"_tempV33",function(){return this._tempV33=new Pe},"_tempV34",function(){return this._tempV34=new Pe},"_tempV35",function(){return this._tempV35=new Pe},"_tempV36",function(){return this._tempV36=new Pe},"_tempM0",function(){return this._tempM0=new be},"_tempM1",function(){return this._tempM1=new be},"_corners",function(){return this._corners=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe]},"_rows1",function(){return this._rows1=[new Pe,new Pe,new Pe]},"_rows2",function(){return this._rows2=[new Pe,new Pe,new Pe]},"_ray",function(){return this._ray=new Re(new Pe,new Pe)},"_boxBound1",function(){return this._boxBound1=new Se(new Pe,new Pe)},"_boxBound2",function(){return this._boxBound2=new Se(new Pe,new Pe)},"_boxBound3",function(){return this._boxBound3=new Se(new Pe,new Pe)}]),t}(),Ie=function(){function t(t,e){this.normal=null,this.distance=NaN,void 0===e&&(e=0),this.normal=t,this.distance=e}return r(t,"laya.d3.math.Plane"),t.prototype.normalize=function(){var t=this.normal.elements,e=t[0],i=t[1],n=t[2],r=1/Math.sqrt(e*e+i*i+n*n);t[0]=e*r,t[1]=i*r,t[2]=n*r,this.distance*=r},t.createPlaneBy3P=function(e,i,n){var r=e.elements,a=i.elements,s=n.elements,o=a[0]-r[0],l=a[1]-r[1],h=a[2]-r[2],c=s[0]-r[0],u=s[1]-r[1],_=s[2]-r[2],d=l*_-h*u,f=h*c-o*_,p=o*u-l*c,m=1/Math.sqrt(d*d+f*f+p*p),g=d*m,y=f*m,v=p*m,S=t._TEMPVec3.elements;S[0]=g,S[1]=y,S[2]=v;var x=-(g*r[0]+y*r[1]+v*r[2]);return new t(t._TEMPVec3,x)},t.PlaneIntersectionType_Back=0,t.PlaneIntersectionType_Front=1,t.PlaneIntersectionType_Intersecting=2,n(t,["_TEMPVec3",function(){return this._TEMPVec3=new Pe}]),t}(),De=function(){function t(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.elements[0]=t,this.elements[1]=e,this.elements[2]=i,this.elements[3]=n}r(t,"laya.d3.math.Quaternion");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.scaling=function(t,e){var i=e.elements,n=this.elements;i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t,i[3]=n[3]*t},e.normalize=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=n*n+r*r+a*a+s*s;o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=s*o)},e.length=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},e.rotateX=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h+o*l,i[1]=a*h+s*l,i[2]=s*h-a*l,i[3]=o*h-r*l},e.rotateY=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h-s*l,i[1]=a*h+o*l,i[2]=s*h+r*l,i[3]=o*h-a*l},e.rotateZ=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h+a*l,i[1]=a*h-r*l,i[2]=s*h+o*l,i[3]=o*h-s*l},e.getYawPitchRoll=function(e){Pe.transformQuat(Pe.ForwardRH,this,t.TEMPVector31),Pe.transformQuat(Pe.Up,this,t.TEMPVector32);var i=t.TEMPVector32.elements;t.angleTo(Pe.ZERO,t.TEMPVector31,t.TEMPVector33);var n=t.TEMPVector33.elements;n[0]==Math.PI/2?(n[1]=t.arcTanAngle(i[2],i[0]),n[2]=0):n[0]==-Math.PI/2?(n[1]=t.arcTanAngle(-i[2],-i[0]),n[2]=0):(be.createRotationY(-n[1],t.TEMPMatrix0),be.createRotationX(-n[0],t.TEMPMatrix1),Pe.transformCoordinate(t.TEMPVector32,t.TEMPMatrix0,t.TEMPVector32),Pe.transformCoordinate(t.TEMPVector32,t.TEMPMatrix1,t.TEMPVector32),n[2]=t.arcTanAngle(i[1],-i[0])),n[1]<=-Math.PI&&(n[1]=Math.PI),n[2]<=-Math.PI&&(n[2]=Math.PI),n[1]>=Math.PI&&n[2]>=Math.PI&&(n[1]=0,n[2]=0,n[0]=Math.PI-n[0]);var r=e.elements;r[0]=n[1],r[1]=n[0],r[2]=n[2]},e.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=n*n+r*r+a*a+s*s,l=o?1/o:0;e[0]=-n*l,e[1]=-r*l,e[2]=-a*l,e[3]=s*l},e.identity=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=1},e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},e.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<4;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.equals=function(t){var e=this.elements,i=t.elements;return we.nearEqual(e[0],i[0])&&we.nearEqual(e[1],i[1])&&we.nearEqual(e[2],i[2])&&we.nearEqual(e[3],i[3])},e.lengthSquared=function(){var t=this.elements[0],e=this.elements[1],i=this.elements[2],n=this.elements[3];return t*t+e*e+i*i+n*n},a(0,e,"x",function(){return this.elements[0]}),a(0,e,"y",function(){return this.elements[1]}),a(0,e,"z",function(){return this.elements[2]}),a(0,e,"w",function(){return this.elements[3]}),t.createFromYawPitchRoll=function(t,e,i,n){var r=.5*i,a=.5*e,s=.5*t,o=Math.sin(r),l=Math.cos(r),h=Math.sin(a),c=Math.cos(a),u=Math.sin(s),_=Math.cos(s),d=n.elements;d[0]=_*h*l+u*c*o,d[1]=u*c*l-_*h*o,d[2]=_*c*o-u*h*l,d[3]=_*c*l+u*h*o},t.multiply=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=n[0],o=n[1],l=n[2],h=n[3],c=r[0],u=r[1],_=r[2],d=r[3],f=o*_-l*u,p=l*c-s*_,m=s*u-o*c,g=s*c+o*u+l*_;a[0]=s*d+c*h+f,a[1]=o*d+u*h+p,a[2]=l*d+_*h+m,a[3]=h*d-g},t.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:t>0?Math.atan(e/t):t<0?e>0?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},t.angleTo=function(e,i,n){Pe.subtract(i,e,t.TEMPVector30),Pe.normalize(t.TEMPVector30,t.TEMPVector30),n.elements[0]=Math.asin(t.TEMPVector30.y),n.elements[1]=t.arcTanAngle(-t.TEMPVector30.z,-t.TEMPVector30.x)},t.createFromAxisAngle=function(t,e,i){var n=i.elements,r=t.elements;e*=.5;var a=Math.sin(e);n[0]=a*r[0],n[1]=a*r[1],n[2]=a*r[2],n[3]=Math.cos(e)},t.createFromMatrix3x3=function(t,e){var i,n=e.elements,r=t.elements,a=r[0]+r[4]+r[8];if(a>0)i=Math.sqrt(a+1),n[3]=.5*i,i=.5/i,n[0]=(r[5]-r[7])*i,n[1]=(r[6]-r[2])*i,n[2]=(r[1]-r[3])*i;else{var s=0;r[4]>r[0]&&(s=1),r[8]>r[3*s+s]&&(s=2);var o=(s+1)%3,l=(s+2)%3;i=Math.sqrt(r[3*s+s]-r[3*o+o]-r[3*l+l]+1),n[s]=.5*i,i=.5/i,n[3]=(r[3*o+l]-r[3*l+o])*i,n[o]=(r[3*o+s]+r[3*s+o])*i,n[l]=(r[3*l+s]+r[3*s+l])*i}},t.createFromMatrix4x4=function(t,e){var i,n,r=t.elements,a=e.elements,s=r[0]+r[5]+r[10];s>0?(i=Math.sqrt(s+1),a[3]=.5*i,i=.5/i,a[0]=(r[6]-r[9])*i,a[1]=(r[8]-r[2])*i,a[2]=(r[1]-r[4])*i):r[0]>=r[5]&&r[0]>=r[10]?(n=.5/(i=Math.sqrt(1+r[0]-r[5]-r[10])),a[0]=.5*i,a[1]=(r[1]+r[4])*n,a[2]=(r[2]+r[8])*n,a[3]=(r[6]-r[9])*n):r[5]>r[10]?(n=.5/(i=Math.sqrt(1+r[5]-r[0]-r[10])),a[0]=(r[4]+r[1])*n,a[1]=.5*i,a[2]=(r[9]+r[6])*n,a[3]=(r[8]-r[2])*n):(n=.5/(i=Math.sqrt(1+r[10]-r[0]-r[5])),a[0]=(r[8]+r[2])*n,a[1]=(r[9]+r[6])*n,a[2]=.5*i,a[3]=(r[1]-r[4])*n)},t.slerp=function(t,e,i,n){var r,a,s,o,l,h=t.elements,c=e.elements,u=n.elements,_=h[0],d=h[1],f=h[2],p=h[3],m=c[0],g=c[1],y=c[2],v=c[3];return(a=_*m+d*g+f*y+p*v)<0&&(a=-a,m=-m,g=-g,y=-y,v=-v),1-a>1e-6?(r=Math.acos(a),s=Math.sin(r),o=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(o=1-i,l=i),u[0]=o*_+l*m,u[1]=o*d+l*g,u[2]=o*f+l*y,u[3]=o*p+l*v,u},t.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2],c=a[3];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h),r[3]=c+i*(s[3]-c)},t.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3]},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},t.rotationLookAt=function(e,i,n){t.lookAt(Pe.ZERO,e,i,n)},t.lookAt=function(e,i,n,r){Ce.lookAt(e,i,n,t._tempMatrix3x3),t.rotationMatrix(t._tempMatrix3x3,r)},t.invert=function(t,e){var i=t.elements,n=e.elements,r=t.lengthSquared();we.isZero(r)||(r=1/r,n[0]=-i[0]*r,n[1]=-i[1]*r,n[2]=-i[2]*r,n[3]=i[3]*r)},t.rotationMatrix=function(t,e){var i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],_=e.elements,d=NaN,f=NaN,p=n+o+u;p>0?(d=Math.sqrt(p+1),_[3]=.5*d,d=.5/d,_[0]=(l-c)*d,_[1]=(h-a)*d,_[2]=(r-s)*d):n>=o&&n>=u?(f=.5/(d=Math.sqrt(1+n-o-u)),_[0]=.5*d,_[1]=(r+s)*f,_[2]=(a+h)*f,_[3]=(l-c)*f):o>u?(f=.5/(d=Math.sqrt(1+o-n-u)),_[0]=(s+r)*f,_[1]=.5*d,_[2]=(c+l)*f,_[3]=(h-a)*f):(f=.5/(d=Math.sqrt(1+u-n-o)),_[0]=(h+a)*f,_[1]=(c+l)*f,_[2]=.5*d,_[3]=(r-s)*f)},t.DEFAULT=new t,n(t,["TEMPVector30",function(){return this.TEMPVector30=new Pe},"TEMPVector31",function(){return this.TEMPVector31=new Pe},"TEMPVector32",function(){return this.TEMPVector32=new Pe},"TEMPVector33",function(){return this.TEMPVector33=new Pe},"TEMPMatrix0",function(){return this.TEMPMatrix0=new be},"TEMPMatrix1",function(){return this.TEMPMatrix1=new be},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new Ce},"NAN",function(){return this.NAN=new t(NaN,NaN,NaN,NaN)}]),t}(),Ae=function(){function t(t){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}r(t,"laya.d3.math.Rand");var e=t.prototype;return e.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},e.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},e.getSignedFloat=function(){return 2*this.getFloat()-1},a(0,e,"seed",function(){return this.seeds[0]},function(t){this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),t.getFloatFromInt=function(t){return 1/8388607*(8388607&t)},t.getByteFromInt=function(t){return(8388607&t)>>>15},t}(),Re=(function(){function t(t){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(t instanceof Array)||4!==t.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|t[0],this._state0L=0|t[1],this._state1U=0|t[2],this._state1L=0|t[3]}r(t,"laya.d3.math.RandX");var e=t.prototype;e.randomint=function(){var t=this._state0U,e=this._state0L,i=this._state1U,n=this._state1L,r=(n>>>0)+(e>>>0),a=i+t+(r/2>>>31)>>>0,s=r>>>0;this._state0U=i,this._state0L=n;var o=0,l=0;return o=(t^=o=t<<23|(-512&e)>>>9)^i,l=(e^=l=e<<23)^n,o^=t>>>18,l^=e>>>18|(262143&t)<<14,o^=i>>>5,l^=n>>>5|(31&i)<<27,this._state1U=o,this._state1L=l,[a,s]},e.random=function(){var e=this.randomint(),i=e[0],n=1023<<20|i>>>12,r=e[1]>>>12|(4095&i)<<20|0;return t._CONVERTION_BUFFER.setUint32(0,n,!1),t._CONVERTION_BUFFER.setUint32(4,r,!1),Ae._CONVERTION_BUFFER.getFloat64(0,!1)-1},n(t,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new Ae([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function t(t,e){this.origin=null,this.direction=null,this.origin=t,this.direction=e}return r(t,"laya.d3.math.Ray"),t}()),Le=function(){function t(t,e){this.elements=new Float32Array(2),void 0===t&&(t=0),void 0===e&&(e=0);var i=this.elements;i[0]=t,i[1]=e}r(t,"laya.d3.math.Vector2");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),a(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e},n(t,["ZERO",function(){return this.ZERO=new t(0,0)},"ONE",function(){return this.ONE=new t(1,1)}]),t}(),Pe=function(){function t(t,e,i){this.elements=new Float32Array(3),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this.elements;n[0]=t,n[1]=e,n[2]=i}r(t,"laya.d3.math.Vector3");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},a(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),a(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),a(0,e,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),t.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2];return r*r+a*a+s*s},t.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2];return Math.sqrt(r*r+a*a+s*s)},t.min=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2])},t.max=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2])},t.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],l=r[2],h=a[0],c=a[1],u=a[2],_=a[3],d=_*s+c*l-u*o,f=_*o+u*s-h*l,p=_*l+h*o-c*s,m=-h*s-c*o-u*l;n[0]=d*_+m*-h+f*-u-p*-c,n[1]=f*_+m*-c+p*-h-d*-u,n[2]=p*_+m*-u+d*-c-f*-h},t.scalarLength=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return Math.sqrt(i*i+n*n+r*r)},t.scalarLengthSquared=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return i*i+n*n+r*r},t.normalize=function(t,e){var i=t.elements,n=e.elements,r=i[0],a=i[1],s=i[2],o=r*r+a*a+s*s;o>0&&(o=1/Math.sqrt(o),n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o)},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2]},t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e},t.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h)},t.transformV3ToV3=function(e,i,n){var r=t._tempVector4;t.transformV3ToV4(e,i,r);var a=r.elements,s=n.elements;s[0]=a[0],s[1]=a[1],s[2]=a[2]},t.transformV3ToV4=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=i.elements;l[0]=r*o[0]+a*o[4]+s*o[8]+o[12],l[1]=r*o[1]+a*o[5]+s*o[9]+o[13],l[2]=r*o[2]+a*o[6]+s*o[10]+o[14],l[3]=r*o[3]+a*o[7]+s*o[11]+o[15]},t.TransformNormal=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=i.elements;l[0]=r*o[0]+a*o[4]+s*o[8],l[1]=r*o[1]+a*o[5]+s*o[9],l[2]=r*o[2]+a*o[6]+s*o[10]},t.transformCoordinate=function(e,i,n){var r=t._tempVector4.elements,a=e.elements,s=a[0],o=a[1],l=a[2],h=i.elements;r[0]=s*h[0]+o*h[4]+l*h[8]+h[12],r[1]=s*h[1]+o*h[5]+l*h[9]+h[13],r[2]=s*h[2]+o*h[6]+l*h[10]+h[14],r[3]=1/(s*h[3]+o*h[7]+l*h[11]+h[15]);var c=n.elements;c[0]=r[0]*r[3],c[1]=r[1]*r[3],c[2]=r[2]*r[3]},t.Clamp=function(t,e,i,n){var r=t.elements,a=r[0],s=r[1],o=r[2],l=e.elements,h=l[0],c=l[1],u=l[2],_=i.elements,d=_[0],f=_[1],p=_[2],m=n.elements;a=(a=a>d?d:a)<h?h:a,s=(s=s>f?f:s)<c?c:s,o=(o=o>p?p:o)<u?u:o,m[0]=a,m[1]=s,m[2]=o},t.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2]},t.subtract=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2]},t.cross=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=n[0],o=n[1],l=n[2],h=r[0],c=r[1],u=r[2];a[0]=o*u-l*c,a[1]=l*h-s*u,a[2]=s*c-o*h},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]},t.equals=function(t,e){var i=t.elements,n=e.elements;return we.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&we.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&we.nearEqual(Math.abs(i[2]),Math.abs(n[2]))},t.ZERO=new t(0,0,0),t.ONE=new t(1,1,1),t.NegativeUnitX=new t(-1,0,0),t.UnitX=new t(1,0,0),t.UnitY=new t(0,1,0),t.UnitZ=new t(0,0,1),t.ForwardRH=new t(0,0,-1),t.ForwardLH=new t(0,0,1),t.Up=new t(0,1,0),t.NAN=new t(NaN,NaN,NaN),n(t,["_tempVector4",function(){return this._tempVector4=new Ne}]),t}(),Ne=function(){function t(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var r=this.elements;r[0]=t,r[1]=e,r[2]=i,r[3]=n}r(t,"laya.d3.math.Vector4");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},a(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),a(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),a(0,e,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),a(0,e,"w",function(){return this.elements[3]},function(t){this.elements[3]=t}),t.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2],c=a[3];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h),r[3]=c+i*(s[3]-c)},t.transformByM4x4=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=e.elements,h=i.elements;h[0]=r*l[0]+a*l[4]+s*l[8]+o*l[12],h[1]=r*l[1]+a*l[5]+s*l[9]+o*l[13],h[2]=r*l[2]+a*l[6]+s*l[10]+o*l[14],h[3]=r*l[3]+a*l[7]+s*l[11]+o*l[15]},t.equals=function(t,e){var i=t.elements,n=e.elements;return we.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&we.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&we.nearEqual(Math.abs(i[2]),Math.abs(n[2]))&&we.nearEqual(Math.abs(i[3]),Math.abs(n[3]))},t.normalize=function(t,e){var i=t.elements,n=e.elements,r=t.length();r>0&&(n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=i[3]*r)},t.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3]},t.subtract=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3]},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2],n[3]=r[3]*a[3]},t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n[3]=r[3]*e},t.Clamp=function(t,e,i,n){var r=t.elements,a=r[0],s=r[1],o=r[2],l=r[3],h=e.elements,c=h[0],u=h[1],_=h[2],d=h[3],f=i.elements,p=f[0],m=f[1],g=f[2],y=f[3],v=n.elements;a=(a=a>p?p:a)<c?c:a,s=(s=s>m?m:s)<u?u:s,o=(o=o>g?g:o)<_?_:o,l=(l=l>y?y:l)<d?d:l,v[0]=a,v[1]=s,v[2]=o,v[3]=l},t.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return r*r+a*a+s*s+o*o},t.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return Math.sqrt(r*r+a*a+s*s+o*o)},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},t.min=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2]),n[3]=Math.min(r[3],a[3])},t.max=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2]),n[3]=Math.max(r[3],a[3])},n(t,["ZERO",function(){return this.ZERO=new t},"ONE",function(){return this.ONE=new t(1,1,1,1)},"UnitX",function(){return this.UnitX=new t(1,0,0,0)},"UnitY",function(){return this.UnitY=new t(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new t(0,0,1,0)},"UnitW",function(){return this.UnitW=new t(0,0,0,1)}]),t}(),Oe=function(){function t(t,e,i,n){this.minDepth=0,this.maxDepth=1,this.x=t,this.y=e,this.width=i,this.height=n}r(t,"laya.d3.math.Viewport");var e=t.prototype;return e.project=function(t,e,i){Pe.transformV3ToV3(t,e,i);var n=t.elements,r=e.elements,a=i.elements,s=n[0]*r[3]+n[1]*r[7]+n[2]*r[11]+r[15];1!==s&&(a[0]=a[0]/s,a[1]=a[1]/s,a[2]=a[2]/s),a[0]=.5*(a[0]+1)*this.width+this.x,a[1]=.5*(1-a[1])*this.height+this.y,a[2]=a[2]*(this.maxDepth-this.minDepth)+this.minDepth},e.unprojectFromMat=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements;a[0]=(n[0]-this.x)/this.width*2-1,a[1]=-((n[1]-this.y)/this.height*2-1);var s=(this.maxDepth-this.minDepth)/2;a[2]=(n[2]-this.minDepth-s)/s;var o=a[0]*r[3]+a[1]*r[7]+a[2]*r[11]+r[15];Pe.transformV3ToV3(i,e,i),1!==o&&(a[0]=a[0]/o,a[1]=a[1]/o,a[2]=a[2]/o)},e.unprojectFromWVP=function(e,i,n,r,a){be.multiply(i,n,t._tempMatrix4x4),r&&be.multiply(t._tempMatrix4x4,r,t._tempMatrix4x4),t._tempMatrix4x4.invert(t._tempMatrix4x4),this.unprojectFromMat(e,t._tempMatrix4x4,a)},n(t,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new be}]),t}(),Ve=function(){function t(){this._alphaBlending=1,this._colorIntensity=1,this._shaderValue=new Ue}r(t,"laya.d3.resource.models.Sky");var e=t.prototype;return e._setEnvironmentDiffuse=function(){this._environmentDiffuse.loaded?this.__ownerCamera._shaderValues.setValue(7,this._environmentDiffuse):this._environmentDiffuse.on("loaded",this,this._environmentDiffuseLoaded)},e._setEnvironmentSpecular=function(){if(this._environmentSpecular.loaded){var t=this._environmentSpecular.simLodInfo;t&&t instanceof Float32Array&&this.__ownerCamera._shaderValues.setValue(9,t),this.__ownerCamera._shaderValues.setValue(8,this._environmentSpecular)}else this._environmentSpecular.on("loaded",this,this._environmentSpecularLoaded)},e._environmentDiffuseLoaded=function(){this.__ownerCamera._shaderValues.setValue(7,this._environmentDiffuse)},e._environmentSpecularLoaded=function(){var t=this._environmentSpecular.simLodInfo;t&&t instanceof Float32Array&&this.__ownerCamera._shaderValues.setValue(9,t),this.__ownerCamera._shaderValues.setValue(8,this._environmentSpecular)},e._render=function(t){},e.destroy=function(){this.__ownerCamera=null},a(0,e,"_ownerCamera",null,function(t){this.__ownerCamera=t,this._environmentDiffuse&&this._setEnvironmentDiffuse(),this._environmentSpecular&&this._setEnvironmentSpecular()}),a(0,e,"alphaBlending",function(){return this._alphaBlending},function(t){this._alphaBlending=t,this._alphaBlending<0&&(this._alphaBlending=0),this._alphaBlending>1&&(this._alphaBlending=1)}),a(0,e,"envDiffuseSHBlue",null,function(t){this.__ownerCamera._shaderValues.setValue(12,t)}),a(0,e,"colorIntensity",function(){return this._colorIntensity},function(t){this._colorIntensity=t,this._colorIntensity<0&&(this._colorIntensity=0)}),a(0,e,"envDiffuseSHGreen",null,function(t){this.__ownerCamera._shaderValues.setValue(11,t)}),a(0,e,"envDiffuseSHRed",null,function(t){this.__ownerCamera._shaderValues.setValue(10,t)}),a(0,e,"environmentDiffuse",function(){return this._environmentDiffuse},function(t){t.minFifter=9728,this._environmentDiffuse=t,this.__ownerCamera&&this._setEnvironmentDiffuse()}),a(0,e,"environmentSpecular",function(){return this._environmentSpecular},function(t){this._environmentSpecular=t,this.__ownerCamera&&this._setEnvironmentSpecular()}),t.MVPMATRIX=0,t.INTENSITY=1,t.ALPHABLENDING=2,t.DIFFUSETEXTURE=3,t}(),ke=function(){function t(t){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=t,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}r(t,"laya.d3.resource.models.SubMesh");var e=t.prototype;return i.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),e._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._getStaticBatchBakedVertexs=function(e,i){var n,r,a=this._vertexBuffer,s=a.vertexDeclaration,o=s.getVertexElementByUsage(0).offset/4,l=s.getVertexElementByUsage(3).offset/4,h=i.meshRender.lightmapScaleOffset,c=0,u=0,_=0,d=0,f=0,p=0;if(h)if(r=s.getVertexElementByUsage(15))_=s.vertexStride/4,n=this._vertexCount>0?a.getData().slice(this._vertexStart*_,(this._vertexStart+this._vertexCount)*_):a.getData().slice(),d=r.offset/4;else{_=2+(p=s.vertexStride/4),n=this._vertexCount?new Float32Array(this._vertexCount*(a.vertexDeclaration.vertexStride/4+2)):new Float32Array(a.vertexCount*(a.vertexDeclaration.vertexStride/4+2)),d=2+(f=s.getVertexElementByUsage(2).offset/4);var m=a.getData();for(c=0,u=m.length/p;c<u;c++){var g;g=this._vertexCount>0?(this._vertexStart+c)*p:c*p;var y=c*_,v=0;for(v=0;v<d;v++)n[y+v]=m[g+v];for(v=d;v<p;v++)n[y+v+2]=m[g+v]}}else _=s.vertexStride/4,n=this._vertexCount?a.getData().slice(this._vertexStart*_,(this._vertexStart+this._vertexCount)*_):a.getData().slice();if(e){var S=e.worldMatrix,x=t._tempMatrix4x40;S.invert(x);var E=t._tempMatrix4x41,T=i.transform.worldMatrix;be.multiply(x,T,E)}else E=i.transform.worldMatrix;var w=t._tempQuaternion0;for(E.decomposeTransRotScale(t._tempVector30,w,t._tempVector31),c=0,u=n.length/_;c<u;c++){var C=c*_+o,b=c*_+l;if(Ze.transformVector3ArrayToVector3ArrayCoordinate(n,C,E,n,C),Ze.transformVector3ArrayByQuat(n,b,w,n,b),h){var M=c*_+d;if(r)Ze.transformLightingMapTexcoordByUV1Array(n,M,h,n,M);else{var I=c*p+f;Ze.transformLightingMapTexcoordByUV0Array(m,I,h,n,M)}}}return n},e._getVertexBuffers=function(){return null},e._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(t){var e,i=0,n=t.renderElement;if(this._indexCount>1){var r=this._boneIndicesList.length;if(r>1){for(var a=0;a<r;a++)(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[a]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),P.mainContext.drawElements(4,this._subIndexBufferCount[a],5123,2*this._subIndexBufferStart[a]);D.drawCall+=r}else(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[0]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),P.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),D.drawCall++;i=this._indexCount}else i=this._indexBuffer.indexCount,(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[0]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),P.mainContext.drawElements(4,i,5123,0),D.drawCall++;D.trianglesFaces+=i/3},e.getIndices=function(){return this._indexCount>0?this._indices:this._indexBuffer.getData()},e.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},a(0,e,"_vertexBufferCount",function(){return 1}),a(0,e,"triangleCount",function(){return this._indexBuffer.indexCount/3}),n(t,["_tempVector30",function(){return this._tempVector30=new Pe},"_tempVector31",function(){return this._tempVector31=new Pe},"_tempQuaternion0",function(){return this._tempQuaternion0=new De},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new be},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new be}]),t}(),Fe=function(){function t(t){this.defineCounter=0,this.defines=null,t?(this.defineCounter=t.defineCounter,this.defines=t.defines.slice()):(this.defineCounter=0,this.defines=[])}return r(t,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),t.prototype.registerDefine=function(t){var e=Math.pow(2,this.defineCounter++);return this.defines[e]=t,e},t}(),Be=function(){function t(){}return r(t,"laya.d3.shader.ShaderInit3D"),t.__init__=function(){ci._globalRegDefine("HIGHPRECISION",ci.SHADERDEFINE_HIGHPRECISION),ci._globalRegDefine("FOG",ci.SHADERDEFINE_FOG),ci._globalRegDefine("DIRECTIONLIGHT",ci.SHADERDEFINE_DIRECTIONLIGHT),ci._globalRegDefine("POINTLIGHT",ci.SHADERDEFINE_POINTLIGHT),ci._globalRegDefine("SPOTLIGHT",ci.SHADERDEFINE_SPOTLIGHT),ci._globalRegDefine("UV",ci.SHADERDEFINE_UV0),ci._globalRegDefine("COLOR",ci.SHADERDEFINE_COLOR),ci._globalRegDefine("UV1",ci.SHADERDEFINE_UV1),ci._globalRegDefine("CASTSHADOW",He.SHADERDEFINE_CAST_SHADOW),ci._globalRegDefine("SHADOWMAP_PSSM1",He.SHADERDEFINE_SHADOW_PSSM1),ci._globalRegDefine("SHADOWMAP_PSSM2",He.SHADERDEFINE_SHADOW_PSSM2),ci._globalRegDefine("SHADOWMAP_PSSM3",He.SHADERDEFINE_SHADOW_PSSM3),ci._globalRegDefine("SHADOWMAP_PCF_NO",He.SHADERDEFINE_SHADOW_PCF_NO),ci._globalRegDefine("SHADOWMAP_PCF1",He.SHADERDEFINE_SHADOW_PCF1),ci._globalRegDefine("SHADOWMAP_PCF2",He.SHADERDEFINE_SHADOW_PCF2),ci._globalRegDefine("SHADOWMAP_PCF3",He.SHADERDEFINE_SHADOW_PCF3),ci._globalRegDefine("DEPTHFOG",ci.SAHDERDEFINE_DEPTHFOG),ki.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),ki.addInclude("Lighting.glsl","\nstruct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nstruct PointLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tfloat Range;\n};\n\nstruct SpotLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tvec3 Direction;\n\tfloat Spot;\n\tfloat Range;\n};\n\n// U3D中使用衰减纹理,此函数模拟并非正确\n//float U3DAttenuation(in vec3 L,in float invLightRadius)\n//{\n//\tfloat fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\n//\tfRatio *= fRatio;\n//\treturn 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\n//} \n\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\nfloat BasicAttenuation(in vec3 L,in float invLightRadius)\n{\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius)); \t\n\treturn attenuation * attenuation;\n} \n\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread\t\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius)\n{\n\tfloat attenuationFactor = 30.0;\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\n\tattenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\n\t// Second we move down the function therewith it reaches zero at abscissa 1:\n\tattenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\n\tattenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\n\t// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\n\tattenuation /= 1.0 - attenuationFactor;\n\treturn attenuation;\n} \n\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor)\n{\n    mediump vec3 h = normalize(viewDir-lightVec);\n    lowp float ln = max (0.0, dot (-lightVec,normal));\n    float nh = max (0.0, dot (h,normal));\n\tdiffuseColor=lightColor * ln;\n\tspecularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\n}\n\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec=normalize(light.Direction);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec,diffuseColor,specularColor);\n}\n\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec/length(lightVec),diffuseColor,specularColor);\n\tfloat attenuate = BasicAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tvec3 normalLightVec=lightVec/length(lightVec);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,normalLightVec,diffuseColor,specularColor);\n\tfloat spot = pow(max(dot(normalLightVec, normalize(light.Direction)), 0.0), light.Spot);\n\tfloat attenuate = spot*BasicAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal)\n{\n\tvec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\n\t\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tmat3 TBN = mat3(T, B, N);\n\t\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\n"),ki.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),ki.addInclude("WaveFunction.glsl","\nuniform vec2 u_WaveInfoD[20];\nuniform vec4 u_WaveInfo[20];\n\nuniform float TEXWAVE_UV_SCALE ;//= 20.0; //每texwidth像素代表的实际距离\n/**\n\t这里的计算都是\n*/\n\n/**\n* 计算一个波形\n*  开始计算的时候都按照z向上，最后输出的时候，颠倒一下。\n* @param tm {float} 毫秒\n*/\nvoid calcGerstnerWave(float curtm, vec3 pos, float deep, vec2 uvpos, out vec3 opos, out vec3 B, out vec3 T, out vec3 N, out float foamS){\n\tfloat tm = curtm/1000.;\n\topos = pos;\n\tvec3 wpos=vec3(0.);\t\t//累加的位置\n\tN=vec3(0.,0.,0.);\t//输出的法线初始化一下\n\tT=vec3(0.,0.,0.);\n\tB=vec3(0.,0.,0.);\n\tvec2 cD ;//= D;\n\t//float deepAtt = max(0.,min(deep,1.0));\n\t//A*=deepAtt; //TODO\n\t\n\tfor( int i=0; i<4; i++){\n\t\tcD = u_WaveInfoD[i];//vec2(wi.winfo[0],wi.winfo[1]);// wi.vDir;\n\t\tfloat Q = u_WaveInfo[i].x;//wi.QorK;\n\t\tfloat A = u_WaveInfo[i].y;//wi.A;\n\t\tfloat W = u_WaveInfo[i].z;//wi.omega;\n\t\tfloat P = u_WaveInfo[i].w;//wi.phi;\n\t\tfloat dop = dot(cD,uvpos);\n\t\tfloat c = cos(dop*W - tm*P);//TODO 优化\n\t\tfloat s = sin(dop*W - tm*P);\n\t\tfloat AWs = A*W*s;\n\t\tfloat AWc = A*W*c;\n\t\tfloat _QxyAWs = -Q*cD.x*cD.y*AWs;\n\t\t\n\t\twpos += vec3(Q*A*cD.x*c,\n\t\t\t\t\tQ*A*cD.y*c,\n\t\t\t\t\tA*s);\n\t\tN += vec3(-cD.x*AWc,\n\t\t\t\t-cD.y*AWc,\n\t\t\t\tQ*AWs);//记得最后1-\n\t\tT += vec3(_QxyAWs,\n\t\t\t\tQ*cD.y*cD.y*AWs,//记得1-\n\t\t\t\tcD.y*AWc\n\t\t\t);\n\t\tB += vec3(Q*cD.x*cD.x*AWs,//记得1-\n\t\t\t\t_QxyAWs,\n\t\t\t\tcD.x*AWc\n\t\t\t);\n\t\t//float v1 = exp(-tan((dop*W - tm*P)/2.+1.07));//除2，+pi/2 这样正好能对齐\n#ifdef USE_FOAM\t\t\n\t\tfloat v1 = 0.5-sin((dop*W - tm*P)/1.+2.0)/2.;\n\t\tfoamS += pow(v1,9.)/4.;\n#endif\n\t}\n\tT.y=1.-T.y; B.x=1.-B.x;N.z=1.-N.z;\n\topos += vec3(wpos.x,wpos.z*min(deep/10.,1.),wpos.y);\n\t//y和z交换一下。现在根据uv计算的位置，所以直接交换yz就行。其他情况下有问题么\n\tT.xyz=T.xzy;\n\tB.xyz=B.xzy;\n\tN.xyz=N.xzy;\n}\n\n\nvoid calcWave(float curtm, vec2 uv, out vec3 B, out vec3 T, out vec3 N){\n\tfloat tm = curtm/1000.;\n\tN=vec3(0.,0.,0.);\t//输出的法线初始化一下\n\tvec2 uvpos = uv*TEXWAVE_UV_SCALE; //TODO 这个范围是什么 就是1？\n\tuvpos.y*=-1.;\n\tvec2 cD;// = D;\n\tconst int NumWaves = 4;\n\tfloat scale = 1./float(NumWaves);\n\tfor( int i=0; i<NumWaves; i++){\n\t\tcD = u_WaveInfoD[i];//vec2(wi.winfo[0],wi.winfo[1]);// wi.vDir;\n\t\tfloat k = 1.5;//u_WaveInfo[i].x;//wi.QorK; TODO  不知道为什么，这个取u_WaveInfo[i].x，在mi3w上就会闪。测试发现实际值也传过来了，就是1.5\n\t\tfloat A = u_WaveInfo[i].y;//wi.A;\n\t\tfloat W = u_WaveInfo[i].z;//wi.omega;\n\t\tfloat P = u_WaveInfo[i].w;//wi.phi;\n\t\t\n\t\tfloat dop = dot(cD,uvpos);\n\t\tfloat c = cos(dop*W - tm*P);//TODO 优化\n\t\tfloat s = sin(dop*W - tm*P);\n\t\t/*\n\t\tfloat AWs = A*W*s;\n\t\tfloat AWc = A*W*c;\n\t\tfloat _QxyAWs = -Q*cD.x*cD.y*AWs;\n\t\t\n\t\tN += vec3(-cD.x*AWc,\n\t\t\t\t-cD.y*AWc,\n\t\t\t\tQ*AWs);//记得最后1-\n\t\t*/\n\t\tfloat kWAc = scale*c;//k*W*A*c;  为了提高精度，这里只保留sin，cos部分，实际使用的时候再乘回来。\n\t\t//float kWAc = k*W*A*c;  \n\t\tN += vec3(\n\t\t\t-kWAc*cD.x*pow((s+1.)/2.,k-1.),\n\t\t\t-kWAc*cD.y*pow((s+1.)/2.,k-1.),\n\t\t\t1.\n\t\t);\n\t}\n\t//N.z=1.-N.z;\n\t//y和z交换一下。现在根据uv计算的位置，所以直接交换yz就行。其他情况下有问题么\n\tN.xyz=N.xzy;\n}\n"),ki.addInclude("BRDF.glsl","vec4 LayaAirBRDF(in vec3 diffuseColor, in vec3 specularColor, in float oneMinusReflectivity, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n\tvec3 halfDir = SafeNormalize(viewDir - lightDir);\n\t\n\tfloat nv = abs(dot(normal, viewDir));\n\t\n\tfloat nl = clamp(dot(normal,   -lightDir),  0.0, 1.0);\n\tfloat nh = clamp(dot(normal,     halfDir),  0.0, 1.0);\n\tfloat lv = clamp(dot(lightDir,   viewDir),  0.0, 1.0);\n\tfloat lh = clamp(dot(lightDir,  -halfDir),  0.0, 1.0);\n\t\n\tfloat diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\t\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\t\n\t//#if UNITY_BRDF_GGX\n\tfloat V = SmithJointGGXVisibilityTerm(nl, nv, roughness);\n\tfloat D = GGXTerm(nh, roughness);\n\t\n\tfloat specularTerm = V * D * PI;\n\t\n\tspecularTerm = sqrt(max(0.0001, specularTerm));\n\tspecularTerm = max(0.0, specularTerm * nl);\n\t\n\tvec4 color;\n\tcolor.rgb = diffuseColor * (gi + lightColor * diffuseTerm) + specularTerm * lightColor * FresnelTerm (specularColor, lh);\n\t\n\tcolor.a = 1.0;\n\treturn color;\n}"),ki.addInclude("PBRUtils.glsl","struct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nvec3 UnpackScaleNormal(in vec2 uv0)\n{\n\t#ifdef NORMALTEXTURE\n\t\tvec3 normalT;\n\t\tvec4 normalMapSample = texture2D(u_NormalTexture, uv0);\n\t\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\t\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\t\tnormalT.xy *= u_normalScale;\n\t\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\t\t\n\t\tvec3 T = normalize(v_Tangent);\n\t\tvec3 B = normalize(v_Binormal);\n\t\tvec3 N = normalize(v_Normal);\n\t\tmat3 TBN = mat3(T, B, N);\n\t\t\n\t\tvec3 bumpedNormal = TBN * normalize(normalT);\n\t\treturn bumpedNormal;\n\t#else\n\t\treturn normalize(v_Normal);\n\t#endif\n}\n\nvec4 DielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\n\nfloat PI = 3.14159265359;\n\nvec3 FresnelTerm (in vec3 F0, in float cosA)\n{\n\treturn F0 + (vec3(1.0) - F0) * pow(1.0 - cosA, 5.0);\n}\n\nfloat PerceptualRoughnessToRoughness(in float perceptualRoughness)\n{\n\treturn perceptualRoughness * perceptualRoughness;\n}\n\nfloat PerceptualRoughnessToSpecularPower(in float perceptualRoughness)\n{\n\tfloat m = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat sq = max(0.0001, m * m);\n\tfloat n = (2.0 / sq) - 2.0;\n\tn = max(n, 0.0001);\n\treturn n;\n}\n\nfloat RoughnessToPerceptualRoughness(in float roughness)\n{\n\treturn sqrt(roughness);\n}\n\nfloat SmoothnessToRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness) * (1.0 - smoothness);\n}\n\nfloat SmoothnessToPerceptualRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness);\n}\n\nvec3 SafeNormalize(in vec3 inVec)\n{\n\tfloat dp3 = max(0.001,dot(inVec,inVec));\n\treturn inVec * (1.0 / sqrt(dp3));\n}\n\nfloat DisneyDiffuse(in float NdotV, in float NdotL, in float LdotH, in float perceptualRoughness)\n{\n\tfloat fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n\tfloat lightScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotL,5.0));\n\tfloat viewScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotV,5.0));\n\n\treturn lightScatter * viewScatter;\n}\n\nfloat SmithJointGGXVisibilityTerm (float NdotL, float NdotV, float roughness)\n{\n\tfloat a = roughness;\n\tfloat lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n\tfloat lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\n\treturn 0.5 / (lambdaV + lambdaL + 0.00001);\n}\n\nfloat GGXTerm (float NdotH, float roughness)\n{\n\tfloat a2 = roughness * roughness;\n\tfloat d = (NdotH * a2 - NdotH) * NdotH + 1.0;\n\treturn 0.31830988618 * a2 / (d * d + 0.0000001);\n}\n\nfloat OneMinusReflectivityFromMetallic(in float metallic)\n{\n\tfloat oneMinusDielectricSpec = DielectricSpecularColor.a;\n\treturn oneMinusDielectricSpec - metallic * oneMinusDielectricSpec;\n}\n\nfloat SpecularStrength(vec3 specular)\n{\n    //(SHADER_TARGET < 30)return specular.r; \n    return max (max (specular.r, specular.g), specular.b);\n}\n\nvec3 DiffuseAndSpecularFromMetallic(in vec3 diffuseColor, in float metallic, out vec3 specularColor, out float oneMinusReflectivity)\n{\n\tspecularColor = mix(DielectricSpecularColor.rgb, diffuseColor, metallic);\n\toneMinusReflectivity = OneMinusReflectivityFromMetallic(metallic);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec3 EnergyConservationBetweenDiffuseAndSpecular(in vec3 diffuseColor, in vec3 specularColor, out float oneMinusReflectivity)\n{\n\toneMinusReflectivity = 1.0 - SpecularStrength(specularColor);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec4 Occlusion(in vec2 uv0){\n\t#ifdef OCCLUSIONTEXTURE\n\t\tvec4 occlusionTextureColor = texture2D(u_OcclusionTexture, uv0);\n\t\tfloat occ = occlusionTextureColor.g;\n\t\tfloat oneMinusT = 1.0 - u_occlusionStrength;\n\t\tfloat lerpOneTo = oneMinusT + occ * u_occlusionStrength;\n\t\treturn occlusionTextureColor * lerpOneTo;\n\t#else\n\t\treturn vec4(1.0);\n\t#endif\n}\n\nvec2 ParallaxOffset(in vec3 viewDir){\n\t#ifdef PARALLAXTEXTURE\n\t\tfloat h = texture2D(u_ParallaxTexture, v_Texcoord0).g;\n\t\th = h * u_parallaxScale - u_parallaxScale / 2.0;\n\t\tvec3 v = viewDir;\n\t\tv.z += 0.42;\n\t\tvec2 offset = h * (v.xy / v.z);\n\t\treturn v_Texcoord0 + offset;\n\t#else\n\t\treturn v_Texcoord0;\n\t#endif\n}\n\n"),ki.addInclude("PBRStandardLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRStandardLight(in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 specularColor;\n\tdiffuseColor = DiffuseAndSpecularFromMetallic (diffuseColor, metallic, specularColor, oneMinusReflectivity);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\treturn color;\n}\n\nvec4 PBRStandardDiectionLight (in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in vec3 gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRStandardLight(diffuseColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec2 MetallicGloss(in float diffuseTextureAlpha, in vec2 uv0)\n{\n\tvec2 mg;\n\t\n\t#ifdef METALLICGLOSSTEXTURE\n\t\tvec4 metallicGlossTextureColor = texture2D(u_MetallicGlossTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tmg.r = metallicGlossTextureColor.r;\n\t\t\tmg.g = diffuseTextureAlpha;\n\t\t#else\n\t\t    mg = metallicGlossTextureColor.ra;\n\t\t#endif\n\t\tmg.g *= u_smoothnessScale;\n\t#else\n\t\tmg.r = u_metallic;\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tmg.g = diffuseTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tmg.g = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n\treturn mg;\n}\n\n'),ki.addInclude("PBRSpecularLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRSpecularLight(in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat oneMinusReflectivity;\n\tdiffuseColor = EnergyConservationBetweenDiffuseAndSpecular (diffuseColor, specularColor, oneMinusReflectivity);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\treturn color;\n}\n\nvec4 PBRSpecularDiectionLight (in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in vec3 gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRSpecularLight(diffuseColor, specularColor, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec4 SpecularGloss(float diffuseTextureAlpha, in vec2 uv0)\n{\n    vec4 sg;\n\t\n\t#ifdef SPECULARTEXTURE\n\t\tvec4 specularTextureColor = texture2D(u_SpecularTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tsg.rgb = specularTextureColor.rgb;\n\t\t\tsg.a = diffuseTextureAlpha;\n\t\t#else\n\t\t\tsg = specularTextureColor;\n\t\t#endif\n\t\tsg.a *= u_smoothnessScale;\n\t#else\n\t\tsg.rgb = u_SpecularColor.rgb;\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tsg.a = diffuseTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tsg.a = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n    return sg;\n}\n\n');var t,e,i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_ReflectTexture:[5,1],u_AlphaTestValue:[0,1],u_DiffuseColor:[6,1],u_MaterialSpecular:[8,1],u_Shininess:[9,1],u_MaterialReflect:[10,1],u_TilingOffset:[11,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Color":[4,4],"u_DirectionLight.Direction":[3,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Color":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Color":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},r=ki.nameKey.add("BLINNPHONG");t='attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldMat;\n\t\t#ifdef BONE\n\t\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\t#else\n\t\t\tworldMat=mat3(u_WorldMat);\n\t\t#endif  \n\t\tv_Normal=worldMat*a_Normal;//TODO:法线可以用"魔法"矩阵\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=worldMat*a_Tangent0.xyz;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t\t#ifdef BONE\n\t\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t\t#else\n\t\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\tv_Texcoord0=a_Texcoord0;\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0+v_Texcoord0.y);\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#ifdef COLOR\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}',e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_ViewDir; \n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform vec3 u_MaterialReflect;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#ifdef COLOR\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular= vec3(0.0);\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef SPOTLIGHT\n\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t\n\tvec3 finalDiffuse;\n\t#ifdef LIGHTMAP\n\t\tfinalDiffuse=texture2D(u_LightMap, v_LightMapUV).rgb*2.0;\n\t\t//float exponent = texture2D(u_LightMap, v_LightMapUV).a;\n\t\t//finalDiffuse = texture2D(u_LightMap, v_LightMapUV).rgb;\n\t\t//float ratio = pow(2.0, exponent * 255.0 - (128.0 + 8.0));\n\t\t//finalDiffuse = finalDiffuse * 255.0 * ratio;\t\n\t\t//finalDiffuse = sqrt(finalDiffuse);\n\t#else\n\t\tfinalDiffuse=vec3(0.0);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tfinalDiffuse+=diffuse;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse)*shadowValue,mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse),mainColor.a);\n\t#endif\n\t\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\n\n\t#ifdef REFLECTMAP\n\t\tvec3 incident = -viewDir;\n\t\tvec3 reflectionVector = reflect(incident,normal);\n\t\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\t\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t  main_normal();\n\t#endif  \n}\n\n';var a=ci.add(r,t,e,i,n);Fi.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),Fi.SHADERDEFINE_NORMALMAP=a.registerMaterialDefine("NORMALMAP"),Fi.SHADERDEFINE_SPECULARMAP=a.registerMaterialDefine("SPECULARMAP"),Fi.SHADERDEFINE_REFLECTMAP=a.registerMaterialDefine("REFLECTMAP"),Fi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),Fi.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var s=ki.nameKey.add("SIMPLE");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",e='#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',a=ci.add(s,t,e,i,n),zi.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),zi.SHADERDEFINE_NORMALMAP=a.registerMaterialDefine("NORMALMAP"),zi.SHADERDEFINE_SPECULARMAP=a.registerMaterialDefine("SPECULARMAP"),zi.SHADERDEFINE_EMISSIVEMAP=a.registerMaterialDefine("EMISSIVEMAP"),zi.SHADERDEFINE_AMBIENTMAP=a.registerMaterialDefine("AMBIENTMAP"),zi.SHADERDEFINE_REFLECTMAP=a.registerMaterialDefine("REFLECTMAP"),zi.SHADERDEFINE_UVTRANSFORM=a.registerMaterialDefine("UVTRANSFORM"),zi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),zi.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),i={a_Position:0,a_Color:1},n={u_MvpMatrix:[1,2]};var o=ki.nameKey.add("LINE");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  v_Color=a_Color;\n}",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n  gl_FragColor=v_Color; \n}\n\n",ci.add(o,t,e,i,n),i={a_position:0,a_normal:3,tangent:5,binormal:4,uv:2,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_lodRect:[9,3],irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],u_aoObjPos:[14,1],texBaseColor:[1,1],texNormal:[2,1],texPbrInfo:[3,1],texPrefilterdEnv:[8,3],texHSNoise:[15,1],texPrefilterDiff:[7,3],u_AlphaTestValue:[0,1],texBRDFLUT:[4,1],u_UVAniAge:[5,1],u_roughness:[6,1],u_metaless:[7,1],u_UVMatrix:[8,1],u_UVAge:[9,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var l=ki.nameKey.add("PBR");t="\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n#ifdef HAS_TANGENT\nattribute vec3 tangent;\nattribute vec3 binormal;\n#endif\nattribute vec2 uv;\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\n\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\nvoid main() {\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tgl_Position = mvp*skinTransform*vec4(a_position,1.);\n\tmat4 modelMat = modelMatrix*skinTransform;\n#else\n\tgl_Position = mvp*vec4(a_position,1.);\n\tmat4 modelMat = modelMatrix;\n#endif\t\n\tvWorldPos = modelMat*vec4(a_position,1.);\n\n#ifdef CASTSHADOW \n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tvUv = uv;\n\t#endif\t\n#else\n    vUv = uv;\n\tvWorldNorm = normalize((modelMat*vec4(a_normal,0.0)).xyz);\n\t#ifdef HAS_TANGENT\n\tvWorldTangent = normalize((modelMat*vec4(tangent,0.0)).xyz);\n\tvWorldBinormal = normalize((modelMat*vec4(binormal,0.0)).xyz);\n\t#endif\n    \n    vViewDir = (vWorldPos.xyz-cameraPosition);//这个不能normalize。否则无法线性差值了\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.z;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vWorldPos;\n\t#endif\n#endif\t\n#endif\n}\n",e='//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\nvarying vec3 vViewDir;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n//预计算的贴图\nuniform sampler2D texPrefilterdEnv;\nuniform sampler2D texBRDFLUT;\nuniform sampler2D texPrefilterDiff;\n#ifdef HAS_PBRINFO\nuniform sampler2D texPbrInfo;   //Ao, Roughness, Metallic\n#endif\nuniform float u_hdrexposure;\nuniform float u_AlphaTestValue;\n\nuniform float u_roughness;\nuniform float u_metaless;\nconst float maxlv = 7.;\t//现在只支持512分辨率的环境贴图\nconst int nmaxlv = 9;//\n\t\t\t\t\t\t\t\nuniform mat4 irrad_mat_red;\nuniform mat4 irrad_mat_green;\nuniform mat4 irrad_mat_blue;\t\t\t\t\t\t\t\n\nvec3 speccontrib = vec3(0.);\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\nvec4 tex2dLod(sampler2D tex, float u, float v, float lod){\n\tvec2 uv = vec2(u,v);\n\tuv+=mod(gl_FragCoord.xy-vec2(0.5),2.0)*vec2(128.,0.);\n\treturn texture2D(tex,uv,lod-16.);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn texture2D(tex,vec2(envu,envv));\n}\n\nvec4 texPanoramaLod(sampler2D tex, const in vec3 dir, float lod){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn tex2dLod(tex,envu,envv,lod);\n}\n\n/*\n    计算sh光照。\n    使用level=2，所以需要9个系数。\n    https://cseweb.ucsd.edu/~ravir/papers/envmap/envmap.pdf\n*/\nfloat environment_exposure = 1.0;\nvec3 diff_sh9(vec3 dir){\n\tvec4 shDir = vec4(dir.x,-dir.z,dir.y,1.0);\n  return max(vec3(0.0), vec3(\n\tdot(shDir, irrad_mat_red * shDir),\n\tdot(shDir, irrad_mat_green * shDir),\n\tdot(shDir, irrad_mat_blue * shDir)\n\t)) * environment_exposure;\t\n}\n\n#ifdef HAS_TANGENT\nvec3 applyNormalTex( vec3 norm, vec3 surf_norm ) {\n    vec3 mapN = norm * 2.0 - 1.0;\n    //mapN.xy = normalScale * mapN.xy;\n    mat3 tsn = mat3( vWorldTangent, vWorldBinormal, surf_norm );\n    return normalize( tsn * mapN );\n}\n#endif\n\nvec4 pbrlight(vec3 normal, float rough, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n\tbasecolor.rgb = pow(basecolor.rgb,vec3(2.2));\n\tfloat metaless = 1.0; \t\n\tconst float ismetalinfov = (128./255.);\n\tif(basecolor.a>=ismetalinfov){//这时候表示金属度\n\t\tmetaless = (basecolor.a-ismetalinfov)*2.;\n\t\tbasecolor.a = 1.0;\n\t}else{\n\t\tmetaless = 0.;\n\t\tbasecolor.a = basecolor.a*2.0;\n\t}\n\t#ifdef FIX_METALESS\n\tmetaless = u_metaless;\n\t#endif\n\t#ifdef HAS_PBRINFO\t\n\tvec4 pbrinfo = texture2D(texPbrInfo, vUv);\n\tmetaless = pbrinfo.b;\n\trough = pbrinfo.g;\n\t#endif\n    const vec3 nonmetalF0 =vec3(0.02);\n    vec3 F0 =  mix(nonmetalF0, basecolor.rgb, metaless);\n\t\n    vec4 PrefilteredColor = texPanoramaLod(texPrefilterdEnv, R, rough*maxlv);\n    PrefilteredColor.rgb = _RGBEToRGB(PrefilteredColor);\n    vec4 EnvBRDF = texture2D(texBRDFLUT,vec2(rough , NoV));//TODO lod\n    vec2 rg = _RGBAToU16(EnvBRDF);    \n    speccontrib = (F0* rg.x + saturate( 50.0 * PrefilteredColor.g ) * rg.y);\n\tvec3 color_spec = PrefilteredColor.rgb*speccontrib;\n\t\n\tvec3 color_diff=diff_sh9(normal);\n\tvec3 outc =  color_diff*mix(basecolor.rgb,vec3(0.),metaless)*(vec3(1.0)-speccontrib)+color_spec;\n\t#ifdef HAS_PBRINFO\n\toutc*=pbrinfo.r;\n\t#endif\n\treturn vec4(outc, basecolor.a);\n}\n\nvec3 oldlight(vec4 normal, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n\tconst vec3 lightdir=normalize(vec3(1.,1.,0.));\n\tconst vec3 spcecol = vec3(1.,0.8,0.8);\n\tconst vec3 amb = vec3(0.5);\n\tvec3 diffv =  (vec3(saturate(dot(lightdir,normal.xyz)))+amb);\n\t//vec3 spec = spcecol* pow(saturate(dot(R,lightdir)),(1.-pbrinfo.g)*5.);\n\treturn diffv*basecolor.rgb;//+spec;\n}\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main() {\n#ifdef CASTSHADOW\n\tgl_FragColor=packDepth(gl_FragCoord.w);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(texBaseColor,vUv).w;\n\t\tif( alpha < u_AlphaTestValue ){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n#else\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.0001);\n\t\t#endif\n\t#endif\t\n\t\n    vec3 normal =  normalize(vWorldNorm);\n\tvec4 normtex = texture2D( texNormal, vUv );\n\t#ifdef HAS_TANGENT\t\n\tnormal = applyNormalTex(normtex.xyz, normal);\n\t#endif\n    vec3 view   = -normalize(vViewDir);\n    float NoV = saturate(dot( view, normal ));\n    vec3 R = 2. * NoV * normal - view;\n\tfloat roughness = normtex.a;\n\t#ifdef FIX_ROUGHNESS\n\troughness = u_roughness;\n\t#endif\n\t\n\tvec4 pbrl = pbrlight(normal,roughness,NoV,R)*u_hdrexposure;\n    gl_FragColor.rgb =  pow(pbrl.rgb,vec3(0.45455));\n\t//gl_FragColor.rgb = oldlight(normtex,NoV,R);\n\t#ifdef RECEIVESHADOW\n\tgl_FragColor.rgb *= max(shadowValue,0.7);\n\t#endif\n\t\n    gl_FragColor.a = pbrl.a;\n\n#endif\n}\n',a=ci.add(l,t,e,i,n),Hi.SHADERDEFINE_FIX_METALESS=a.registerMaterialDefine("FIX_METALESS"),Hi.SHADERDEFINE_FIX_ROUGHNESS=a.registerMaterialDefine("FIX_ROUGHNESS"),Hi.SHADERDEFINE_HAS_TANGENT=a.registerMaterialDefine("HAS_TANGENT"),Hi.SHADERDEFINE_HAS_PBRINFO=a.registerMaterialDefine("HAS_PBRINFO"),Hi.SHADERDEFINE_USE_GROUNDTRUTH=a.registerMaterialDefine("USE_GROUNDTRUTH"),Hi.SHADERDEFINE_TEST_CLIPZ=a.registerMaterialDefine("CLIPZ"),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_EmissionColor:[8,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_MetallicGlossTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_metallic:[9,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[17,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var h=ki.nameKey.add("PBRStandard");t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tmat4 skinTransform = mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\tv_PositionWorld = (u_WorldMat * position).xyz;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t\tworldMat = mat3(u_WorldMat);\n\t\tv_PositionWorld = (u_WorldMat * a_Position).xyz;\n\t#endif\n\t\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n\tv_Texcoord0 = a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n\tv_ViewDir = u_CameraPos - v_PositionWorld;\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\n\n#ifdef DIFFUSETEXTURE\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef METALLICGLOSSTEXTURE\n\tuniform sampler2D u_MetallicGlossTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRStandardLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec2 mg;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n\t\tvec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n\t\tmg = MetallicGloss(diffuseTextureColor.a, uv0);\n\t#else\n\t\tvec4 diffuseColor = u_DiffuseColor;\n\t\tmg = MetallicGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(diffuseColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tgl_FragColor = diffuseColor;\n\t\n\tvec3 normal = UnpackScaleNormal(uv0);\n  \n\tvec3 gi = (u_AmbientColor * Occlusion(uv0)).rgb;\n  \n\tvec4 color = PBRStandardDiectionLight(diffuseColor.rgb, mg.r, mg.g, normal, viewDir, u_DirectionLight, gi);\n\t\n\tcolor.a = diffuseColor.a;\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',a=ci.add(h,t,e,i,n),Wi.SHADERDEFINE_DIFFUSETEXTURE=a.registerMaterialDefine("DIFFUSETEXTURE"),Wi.SHADERDEFINE_METALLICGLOSSTEXTURE=a.registerMaterialDefine("METALLICGLOSSTEXTURE"),Wi.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=a.registerMaterialDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),Wi.SHADERDEFINE_NORMALTEXTURE=a.registerMaterialDefine("NORMALTEXTURE"),Wi.SHADERDEFINE_PARALLAXTEXTURE=a.registerMaterialDefine("PARALLAXTEXTURE"),Wi.SHADERDEFINE_OCCLUSIONTEXTURE=a.registerMaterialDefine("OCCLUSIONTEXTURE"),Wi.SHADERDEFINE_EMISSION=a.registerMaterialDefine("EMISSION"),Wi.SHADERDEFINE_EMISSIONTEXTURE=a.registerMaterialDefine("EMISSIONTEXTURE"),Wi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_SpecularColor:[8,1],u_EmissionColor:[9,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_SpecularTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[17,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var c=ki.nameKey.add("PBRSpecular");t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tmat4 skinTransform = mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\tv_PositionWorld = (u_WorldMat * position).xyz;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t\tworldMat = mat3(u_WorldMat);\n\t\tv_PositionWorld = (u_WorldMat * a_Position).xyz;\n\t#endif\n\t\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n\tv_Texcoord0 = a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n\tv_ViewDir = u_CameraPos - v_PositionWorld;\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\nuniform vec4 u_SpecularColor;\n\n#ifdef DIFFUSETEXTURE\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef SPECULARTEXTURE\n\tuniform sampler2D u_SpecularTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRSpecularLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec4 sg;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n\t\tvec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n\t\tsg = SpecularGloss(diffuseTextureColor.a, uv0);\n\t#else\n\t\tvec4 diffuseColor = u_DiffuseColor;\n\t\tsg = SpecularGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(diffuseColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\tvec3 normal = UnpackScaleNormal(uv0);\n\t\n\tvec3 gi = (u_AmbientColor * Occlusion(uv0)).rgb;\n\t\n\t//float a = (sg.r+sg.g+sg.b) / 3.0;\n  \n\tvec4 color = PBRSpecularDiectionLight(diffuseColor.rgb, sg.rgb, sg.a, normal,viewDir, u_DirectionLight, gi);\n\t\n\tcolor.a = diffuseColor.a;\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',a=ci.add(c,t,e,i,n),Gi.SHADERDEFINE_DIFFUSETEXTURE=a.registerMaterialDefine("DIFFUSETEXTURE"),Gi.SHADERDEFINE_SPECULARTEXTURE=a.registerMaterialDefine("SPECULARTEXTURE"),Gi.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=a.registerMaterialDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),Gi.SHADERDEFINE_NORMALTEXTURE=a.registerMaterialDefine("NORMALTEXTURE"),Gi.SHADERDEFINE_PARALLAXTEXTURE=a.registerMaterialDefine("PARALLAXTEXTURE"),Gi.SHADERDEFINE_OCCLUSIONTEXTURE=a.registerMaterialDefine("OCCLUSIONTEXTURE"),Gi.SHADERDEFINE_EMISSION=a.registerMaterialDefine("EMISSION"),Gi.SHADERDEFINE_EMISSIONTEXTURE=a.registerMaterialDefine("EMISSIONTEXTURE"),Gi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),i={a_position:0,a_normal:3,uv:2},n={irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],texBaseColor:[1,1],texNormal:[2,1],texSky:[11,1],texUnderWater:[3,1],texPrefilterdEnv:[8,3],texPrefilterDiff:[7,3],texWaterDisp:[4,1],texWaveDetail:[9,1],texDeepColor:[10,1],texWaterInfo:[16,1],texFoam:[17,1],GEOWAVE_UV_SCALE:[18,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_curTm:[8,1],u_scrsize:[15,1],u_WaveInfoD:[13,1],u_WaveInfo:[12,1],u_WaveMainDir:[14,1],u_DeepScale:[20,1],u_SeaColor:[19,1],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4]};var u=ki.nameKey.add("Water");t='\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\nuniform float u_curTm;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 uv;\n//uniform sampler2D texWaterDisp;\n#ifdef USE_VERTEX_DEEPINFO\n#else\nuniform sampler2D texWaterInfo;\nvarying vec4 vWaterInfo;\nuniform float u_DeepScale;//texWaterInfo.r*vDeepScale\n#endif\nuniform float u_WaveMainDir;\t//主波方向\nuniform float GEOWAVE_UV_SCALE ;//= 100.0;\n\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTan;\nvarying vec3 vWorldBin;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\nvarying vec3 vDisp;\nvarying float fDeep;\nvarying mat2 matUVTrans;\nvarying float fFoam;\n\nconst float PI = 3.14159265358979323846264;\n\n#include "WaveFunction.glsl"\n\nvec2 getPosFromUV(vec2 uv){\n\treturn uv*50.;\n}\n\nvoid main() {\n\tvec3 pos = a_position;\n    vUv = uv;\n\t\n\t//vDisp = texture2D(texWaterDisp,uv).rgb;\n\t//vec3 disp = vDisp;\n\t\n\t//TODO 这里有个潜规则。\n\tfloat tt = pos.y; pos.y=pos.z; pos.z=-tt;\n\t\n\t#ifdef USE_VERTEX_DEEPINFO\n\tfDeep = -pos.y;\n\tpos.y=0.0;\n\t#else\n\tvWaterInfo = texture2D(texWaterInfo,uv);\n\tfDeep = vWaterInfo.r*u_DeepScale;\n\t#endif\n\t\n\t\n\t//计算波形\n\tmat4 modelMat = modelMatrix;\n\tvec3 opos, T,B,N;\n\tfloat foams=0.;\n\tvec2 uvpos = uv*GEOWAVE_UV_SCALE+vec2(modelMat[3][0],0.);//TODO 如果有旋转缩放怎么办\n\tcalcGerstnerWave(u_curTm, pos,fDeep, uvpos,opos,B,T,N,foams);\n\tfFoam = foams;\n\tgl_Position = mvp*vec4(opos,1.);\n\tvWorldPos = modelMat*vec4(opos,1.);\n\n\tvWorldNorm = normalize((modelMatrix*vec4(N,0.0)).xyz);\n\tvWorldTan = normalize((modelMatrix*vec4(T,0.0)).xyz);\n\tvWorldBin = normalize((modelMatrix*vec4(B,0.0)).xyz);\n    vViewDir = vWorldPos.xyz-cameraPosition; //这个不能取normalize，否则会引入非线性\n\t\n\tfloat s = sin(u_WaveMainDir);\n\tfloat c = cos(u_WaveMainDir);\n\tmatUVTrans = mat2(c,-s,s,c);\n}\n',e="//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTan;\nvarying vec3 vWorldBin;\nvarying vec3 vViewDir;//入射。pos-cam\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying float fDeep;\nvarying mat2 matUVTrans;\n#ifdef USE_VERTEX_DEEPINFO\n#else\nvarying vec4 vWaterInfo;\n#endif\nmat3 matTBNOff;//\n\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n#ifdef CUBE_ENV\nuniform samplerCube texSky;\n#else\nuniform sampler2D texSky;\n#endif\nuniform sampler2D texUnderWater;\nuniform sampler2D texWaveDetail;\n//uniform sampler2D texDeepColor;\nuniform sampler2D texFoam;\nvarying float fFoam;\nuniform float u_curTm;\nuniform vec2 u_scrsize;\nuniform vec3 u_SeaColor;//\n\nconst int NumTexWaves=4;\nconst float Amp_over_L = 0.01;\n//const vec3 SEA_COLOR1 = vec3(0.0292,0.672,0.7467);//大洋\n//const vec3 SEA_COLOR2 = vec3(0,0.927,0.43);//近海\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\n/*\n\t各种 ToneMap\n*/\n//Reinhard\nvec3 ReinhardToneMapping(vec3 color, float adapted_lum) {\n    const float MIDDLE_GREY = 1.;\n    color *= MIDDLE_GREY / adapted_lum;\n    return color / (1.0 + color);\n}\n\n//CE2\nvec3 CEToneMapping(vec3 color, float adapted_lum){\n    return 1. - exp(-adapted_lum * color);\n}\n\n//UC2\nvec3 F1(vec3 x){\n\tconst float A = 0.22;\n\tconst float B = 0.30;\n\tconst float C = 0.10;\n\tconst float D = 0.20;\n\tconst float E = 0.01;\n\tconst float F = 0.30;\n \n\treturn ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F;\n}\n\nvec3 Uncharted2ToneMapping(vec3 color, float adapted_lum){\n\tconst vec3 WHITE = vec3(11.2);\n\treturn F1(1.6 * adapted_lum * color) / F1(WHITE);\n}\n\n//ACES\nvec3 ACESToneMapping(vec3 color, float adapted_lum){\n\tconst float A = 2.51;\n\tconst float B = 0.03;\n\tconst float C = 2.43;\n\tconst float D = 0.59;\n\tconst float E = 0.14;\n\n\tcolor *= adapted_lum;\n\treturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn texture2D(tex,vec2(envu,envv));\n}\n\n/*\n\t与位于0点的测试棒的相交测试交点\n\t这个是瞎写的，只是为了测试\n*/\nbool hitClydiner(vec3 pos, vec3 dir, out vec3 hitpos, out vec3 hitnormal){\n\tconst float r = 0.5;\n\tfloat a = dir.x*dir.x+dir.z*dir.z;\n\tfloat b = 2.*dir.x*pos.x+2.*dir.z*pos.z;\n\tfloat c = pos.x*pos.x+pos.z*pos.z-r*r;\n\tfloat d = b*b-4.*a*c;\n\tif(d>=0.0){\n\t\tfloat t = (-b+sqrt(d))/2./a;\n\t\tt =min(t, (-b-sqrt(d))/2./a);\n\t\thitpos = pos+dir*t;\n\t\treturn true;\n\t}\n\t/*\n\tvec3 v1 = normalize(cross(dir,vec3(0.,1.,0.)));//公垂线\n\tfloat dist = dot(pos,v1);//最短距离\n\tif(abs(dist)<r){\n\t\treturn true;\n\t}\n\t*/\n\treturn false;\n}\n\n///* 根据散射公式来计算某个方向的颜色 *///\n//\nfloat phase_function(float costheta, float g, float g2){\n\treturn 1.5*( (1.0-g2) / (2.0+g2) ) * (1.0+costheta*costheta) / pow(1.0+g2-2.0*g*costheta, 1.5);\t\n}\n\nconst float _density = .2;\nconst vec3 _vLightDir=vec3(0.,-1.,0.);//必须是规格化的\nconst int _SAMPLENUM = 20;\nconst float _K1 = 1.0;\nconst float _g = -0.93;\n//\nvec3 calcScatter(vec3 start, vec3 dir, vec3 end){\n\tfloat len = length(end-start);\n\tfloat costheta = dot(dir,_vLightDir);\n\tfloat g2 = _g*_g;\n\tfloat K = _K1*len*_density*phase_function(costheta,_g,g2);\n\t//用分段的方式来积分\n\tfloat dlen = len/float(_SAMPLENUM);//距离平分\n\tfloat ddeep = (start.y-end.y)/float(_SAMPLENUM);//深度平分\n\tfloat sum=0.;\n\tfor( int i=0; i<_SAMPLENUM; i++){\n\t\tfloat fi = float(i);\n\t\tfloat v1 = exp(-_density*(dlen+ddeep)*fi);//TODO 应该可以用分析法计算出来\n\t\tsum += v1;\n\t}\n\treturn vec3(K*sum);\n}\n///* 根据散射公式来计算某个方向的亮度  END *///\n\nconst float cDeep = -2.;\t//假设水的深度\nvec3 getShuiDiColor(vec3 pos, vec3 dir, vec3 normal){\n\t//一个无限大的水底，黑白格纹理。纹理长度为1米\n\tfloat t = ( cDeep-pos.y )/dir.y;\n\tif(t<0.) return vec3(1.,0.,0.);//TEST\n\tbool bhit = false;\n\tvec3 hitpos;\n\tvec3 hitcolor;\n\tvec3 hn;\n\tif(hitClydiner(pos,dir,hitpos,hn) && hitpos.y>cDeep && hitpos.y<pos.y){\n\t\tbhit=true;\n\t\thitcolor = vec3(.8,.8,.8);\n\n\t}else\n\t{\n\t\thitpos = pos+dir*t;\n\t\tvec3 hp = floor(hitpos);\n\t\tfloat a = mod((hp.x+hp.z),2.);\n\t\thitcolor = (a<.9)?vec3(0.,0.,0.):vec3(1.,1.,1.);\n\t\t//hitcolor = texture2D(texUnderWater,hitpos.xz/10.).rgb;\n\t}\n\t\n\tfloat l = length(hitpos-pos);\n\t//return texture2D(texDeepColor,vec2(min(max(l/400.,0.),1.),0.5)).rgb;\n\t//return SEA_COLOR1*calcScatter(pos,dir,hitpos);\n\tfloat left = pow(0.8,l);//假设透过率为80%，则到达水底的时候的光强。\n\treturn mix(hitcolor,u_SeaColor,1.-left);\n}\n\n/*\n\tview已经normalize了\n*/\nvec3 getRefractColor(vec3 view,vec3 normal){\n\tvec3 T = refract(-view, normal, 0.7);\n\treturn getShuiDiColor(vWorldPos.xyz,T,normal); \n}\n\nvec4 calcWaterC(vec3 view, vec3 normal, float von, vec3 R, float rough){\n\t/*\n\t只有浪顶的法线向下，也就是波形形成了交叠的时候，才会这样，所以要通过参数控制避免出现这种情况，而不是在这里保护。\n\tif(dot(R,vec3(0.,1.,0.))<0.){\n\t\tR = -R;\n\t}\n\t*/\n\t//vec3 refr = getRefractColor(-view,normal);\n#ifdef USE_REFR_TEX\t\n\tvec3 refr = texture2D(texUnderWater, gl_FragCoord.xy/u_scrsize+normal.xz/8.).rgb;\n#else\n\tvec3 refr = u_SeaColor;\n#endif\n\tfloat F0=0.02;\n\t//菲涅尔，越大反射越强\n\tfloat f =  F0+(1.0-F0)*exp2((-5.55473*von-6.98316)*von);\n\t//float f = F0+(1.0-F0)*pow(1.-von,5.);\n\t//能看到水底的程度。反射剩余的*水中的衰减\n\t//float a = (1.-f)*(1.-deepk);\n#ifdef CUBE_ENV\n\tvec4 reflc = textureCube(texSky,R);\n#else\n\tvec4 reflc = texPanorama(texSky, R);\n#endif\n#ifdef HDR_ENV\n\tvec3 refl = _RGBEToRGB(reflc)*f;\n#else\n\tvec3 refl = reflc.rgb*f;\n#endif\n\t//return vec4(refl*(1.-rough),1.);\n\t\n\t//vec3 refl = reflc.rgb*f;\n\tvec3 final = mix(refr, u_SeaColor, min(fDeep/10.,1.))+refl*(max(0.,1.-rough));\n#ifdef HDR_ENV\n\tfinal = ACESToneMapping(final,1.);//TODO 这个要uniform传入\n#endif\n\treturn vec4(final,f);\n}\n\nvoid main() {\n    vec3 normal =  normalize(vWorldNorm);\n\t//如果uv=1为100米，希望每个细节纹理表示20米的小波形，则uv缩放是 100/20。细节纹理内部也要用这个值，即pos=uv*20\n\tvec2 ruv = matUVTrans*vUv;\n\tvec3 detailNorm = texture2D(texWaveDetail,fract(ruv*5.)).rgb*2.-vec3(1.);//TODO uv怎么算\n\tfloat texNormScale = 2.*PI*float(NumTexWaves)*Amp_over_L*2.5;\n\tdetailNorm *= vec3(texNormScale,1.,texNormScale);\n\t//旋转\n\t//细节纹理来自rendertarget，因此需要颠倒z\n\t\n\tmatTBNOff = mat3(matUVTrans[0][0],0.,matUVTrans[1][0],\n\t0.,1.,0.,\n\tmatUVTrans[0][1],0.,matUVTrans[1][1]\n\t);\n\t\n\t/*\n\tmatTBNOff = mat3(0.,0.,1.,\n\t0.,1.,0.,\n\t-1.,0.,0.\n\t);\n\t*/\n\n    mat3 tsn = mat3( vWorldBin, normal, vWorldTan);\t\n    //normal = normalize(tsn * matTBNOff * detailNorm);\n\tnormal = normalize(tsn * detailNorm); //这个应该更正确。因为本身方向就是根据uv算的，如果是静态图片才需要转换。\n\t//vec4 normtex = texture2D( texNormal, vUv );\n    vec3 view   = -normalize(vViewDir);//view 是指向camera的\n    float NoV = saturate(dot( view, normal ));\n    //vec3 R = 2. * NoV * normal - view;\n\t\n#ifdef USE_FOAM\t\n\tvec4 foamc = (texture2D(texFoam,vUv*50.)+texture2D(texFoam,vUv*20.))/2.;\n\tfloat nearcoast = 1.-min(fDeep/10.,1.);// 1.-vWaterInfo.r;\n\tfloat foams = (nearcoast/4.+fFoam)*2.*nearcoast;\n#else\n\tfloat foams =0.;\n#endif\n\t\n\tvec3 R = reflect(-view,normal);\n\tvec4 wc = calcWaterC(view, normal,NoV,R, foams);\n\n\tgl_FragColor.rgb = wc.rgb;//normalize(detailNorm).rrr;//((normal)+vec3(0.0))/1.;//normalize(normal).rgb;//texture2D(texWaveDetail,vUv).rgb;// fracColor * texture2D(texUnderWater, vUv*20.0).rgb;// vec3(1.0);//pbrl.rgb;\n    gl_FragColor.a = 1.0;//wc.a;\n#ifdef USE_FOAM\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb,vec3(1.),foamc.a*foams);\n\tgl_FragColor.a = foamc.r;\n#endif\n\t//if(mod(vUv.x*100.,1.0)<0.02 || mod(vUv.y*100.,1.0)<0.02) gl_FragColor.rgb=vec3(0.5,.5,.5);\n\t//gl_FragColor.rgb = detailNorm;\n}\n",a=ci.add(u,t,e,i,n),Xi.SHADERDEFINE_CUBE_ENV=a.registerMaterialDefine("CUBE_ENV"),Xi.SHADERDEFINE_HDR_ENV=a.registerMaterialDefine("HDR_ENV"),Xi.SHADERDEFINE_SHOW_NORMAL=a.registerMaterialDefine("SHOW_NORMAL"),Xi.SHADERDEFINE_USEVERTEXHEIGHT=a.registerMaterialDefine("USE_VERTEX_DEEPINFO"),Xi.SHADERDEFINE_USE_FOAM=a.registerMaterialDefine("USE_FOAM"),Xi.SHADERDEFINE_USE_REFRACT_TEX=a.registerMaterialDefine("USE_REFR_TEX"),i={a_CornerTextureCoordinate:17,a_MeshPosition:0,a_MeshColor:1,a_MeshTextureCoordinate:2,a_ShapePositionStartLifeTime:30,a_DirectionTime:32,a_StartColor:19,a_EndColor:23,a_StartSize:20,a_StartRotation0:22,a_StartSpeed:31,a_Random0:34,a_Random1:35,a_SimulationWorldPostion:36,a_SimulationWorldRotation:37},n={u_Tintcolor:[2,1],u_TilingOffset:[3,1],u_texture:[1,1],u_WorldPosition:[0,2],u_WorldRotation:[1,2],u_PositionScale:[4,2],u_SizeScale:[5,2],u_ScalingMode:[6,2],u_Gravity:[7,2],u_ThreeDStartRotation:[8,2],u_StretchedBillboardLengthScale:[9,2],u_StretchedBillboardSpeedScale:[10,2],u_SimulationSpace:[11,2],u_CurrentTime:[12,2],u_ColorOverLifeGradientAlphas:[22,2],u_ColorOverLifeGradientColors:[23,2],u_MaxColorOverLifeGradientAlphas:[24,2],u_MaxColorOverLifeGradientColors:[25,2],u_VOLVelocityConst:[13,2],u_VOLVelocityGradientX:[14,2],u_VOLVelocityGradientY:[15,2],u_VOLVelocityGradientZ:[16,2],u_VOLVelocityConstMax:[17,2],u_VOLVelocityGradientMaxX:[18,2],u_VOLVelocityGradientMaxY:[19,2],u_VOLVelocityGradientMaxZ:[20,2],u_VOLSpaceType:[21,2],u_SOLSizeGradient:[26,2],u_SOLSizeGradientX:[27,2],u_SOLSizeGradientY:[28,2],u_SOLSizeGradientZ:[29,2],u_SOLSizeGradientMax:[30,2],u_SOLSizeGradientMaxX:[31,2],u_SOLSizeGradientMaxY:[32,2],u_SOLSizeGradientMaxZ:[33,2],u_ROLAngularVelocityConst:[34,2],u_ROLAngularVelocityConstSeprarate:[35,2],u_ROLAngularVelocityGradient:[36,2],u_ROLAngularVelocityGradientX:[37,2],u_ROLAngularVelocityGradientY:[38,2],u_ROLAngularVelocityGradientZ:[39,2],u_ROLAngularVelocityGradientW:[40,2],u_ROLAngularVelocityConstMax:[41,2],u_ROLAngularVelocityConstMaxSeprarate:[42,2],u_ROLAngularVelocityGradientMax:[43,2],u_ROLAngularVelocityGradientMaxX:[44,2],u_ROLAngularVelocityGradientMaxY:[45,2],u_ROLAngularVelocityGradientMaxZ:[46,2],u_ROLAngularVelocityGradientMaxW:[47,2],u_TSACycles:[48,2],u_TSASubUVLength:[49,2],u_TSAGradientUVs:[50,2],u_TSAMaxGradientUVs:[51,2],u_CameraPosition:[0,3],u_CameraDirection:[5,3],u_CameraUp:[6,3],u_View:[1,3],u_Projection:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4]};var _=ki.nameKey.add("PARTICLESHURIKEN");t="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying float v_Discard;\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPosition;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientW[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t   finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0){ \n\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t#endif \n\tvec3 gravityVelocity=u_Gravity*age;\n\t\n\tvec4 worldRotation;\n\tif(u_SimulationSpace==0)\n\t\tworldRotation=a_SimulationWorldRotation;\n\telse\n\t\tworldRotation=u_WorldRotation;\n\t\n\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n   \n   \n   #ifdef SPHERHBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        vec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n        vec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t    corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\tfloat c = cos(rot);\n\t\t\t\tfloat s = sin(rot);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#endif\n   #endif\n   \n   #ifdef STRETCHEDBILLBOARD\n\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\tvec3 velocity;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t    if(u_VOLSpaceType==0)\n\t\t  velocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t    else\n\t\t  velocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n    #else\n\t    velocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n    #endif\t\n\t\tvec3 cameraUpVector = normalize(velocity);\n\t\tvec3 direction = normalize(center-u_CameraPosition);\n        vec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\n\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\n\t    vec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\n\t    const mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t    corner=rotaionZHalfPI*corner;\n\t    corner.y=corner.y-abs(corner.y);\n\t\t\n\t    float speed=length(velocity);//TODO:\n\t    center +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef HORIZONTALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t    const vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef VERTICALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef RENDERMODE_MESH\n\t    vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,-computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,a_StartRotation0.z), age,normalizedAge);\n\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t#endif\t\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t#else\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t}\n\t\t#endif\n\t\tv_MeshColor=a_MeshColor;\n   #endif\n   \n    gl_Position=u_Projection*u_View*vec4(center,1.0);\n    v_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t#ifdef DIFFUSEMAP\n\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t#endif\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t#endif\n\t\t\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y)*u_TilingOffset.xy+vec2(u_TilingOffset.z,-u_TilingOffset.w);//需要特殊处理\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y);//需要特殊处理\n\t\t#endif\n\t#endif\n    v_Discard=0.0;\n\t  \n\t#ifdef FOG\n\t\tv_PositionWorld=center;\n\t#endif\n   }\n   else\n\t{\n\t\tv_Discard=1.0;\n\t}\n}\n\n",e="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying float v_Discard;\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n\tuniform vec3 u_CameraPosition;\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\tif(v_Discard!=0.0)\n\t\t\tdiscard;\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\tvec3 toEye=u_CameraPosition-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t\t\n\t\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}",a=ci.add(_,t,e,i,n),qi.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),qi.SHADERDEFINE_TINTCOLOR=a.registerMaterialDefine("TINTCOLOR"),qi.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),qi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),yn.SHADERDEFINE_RENDERMODE_BILLBOARD=a.registerSpriteDefine("SPHERHBILLBOARD"),yn.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=a.registerSpriteDefine("STRETCHEDBILLBOARD"),yn.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=a.registerSpriteDefine("HORIZONTALBILLBOARD"),yn.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=a.registerSpriteDefine("VERTICALBILLBOARD"),yn.SHADERDEFINE_COLOROVERLIFETIME=a.registerSpriteDefine("COLOROVERLIFETIME"),yn.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=a.registerSpriteDefine("RANDOMCOLOROVERLIFETIME"),yn.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=a.registerSpriteDefine("VELOCITYOVERLIFETIMECONSTANT"),yn.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=a.registerSpriteDefine("VELOCITYOVERLIFETIMECURVE"),yn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=a.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),yn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=a.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),yn.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=a.registerSpriteDefine("TEXTURESHEETANIMATIONCURVE"),yn.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=a.registerSpriteDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),yn.SHADERDEFINE_ROTATIONOVERLIFETIME=a.registerSpriteDefine("ROTATIONOVERLIFETIME"),yn.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=a.registerSpriteDefine("ROTATIONOVERLIFETIMESEPERATE"),yn.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=a.registerSpriteDefine("ROTATIONOVERLIFETIMECONSTANT"),yn.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=a.registerSpriteDefine("ROTATIONOVERLIFETIMECURVE"),yn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=a.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCONSTANTS"),yn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=a.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),yn.SHADERDEFINE_SIZEOVERLIFETIMECURVE=a.registerSpriteDefine("SIZEOVERLIFETIMECURVE"),yn.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=a.registerSpriteDefine("SIZEOVERLIFETIMECURVESEPERATE"),yn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=a.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVES"),yn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=a.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),yn.SHADERDEFINE_RENDERMODE_MESH=a.registerSpriteDefine("RENDERMODE_MESH"),yn.SHADERDEFINE_SHAPE=a.registerSpriteDefine("SHAPE"),i={a_Position:0,a_Texcoord0:2,a_Time:33},n={u_Texture:[1,1],u_Albedo:[2,1],u_Color:[3,1],u_CurrentTime:[2,2],u_Duration:[3,2],u_MvpMatrix:[1,2]};var d=ki.nameKey.add("GLITTER");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nattribute float a_Time;\n\nuniform mat4 u_MvpMatrix;\nuniform  float u_CurrentTime;\nuniform  vec4 u_Color;\nuniform float u_Duration;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  \n  float age = u_CurrentTime-a_Time;\n  float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   \n  v_Texcoord=a_Texcoord0;\n  \n  v_Color=u_Color;\n  v_Color.a*=1.0-normalizedAge;\n}\n",e="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform vec4 u_Albedo;\nuniform sampler2D u_Texture;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\t\n  gl_FragColor=texture2D(u_Texture, v_Texcoord)*v_Color;\n  gl_FragColor=gl_FragColor*u_Albedo;\n}\n\n",a=ci.add(d,t,e,i,n),i={a_Position:0},n={u_Intensity:[1,1],u_AlphaBlending:[2,1],u_CubeTexture:[3,1],u_MvpMatrix:[4,3]};var f=ki.nameKey.add("SkyBox");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nvarying vec3 v_Texcoord;\n\n\nvoid main()\n{\n  gl_Position = (u_MvpMatrix*a_Position).xyww;\n  v_Texcoord=a_Position.xyz;\n}\n",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Intensity;\nuniform float u_AlphaBlending;\nuniform samplerCube u_CubeTexture;\n\nvarying vec3 v_Texcoord;\n\n\nvoid main()\n{\t\n  gl_FragColor=vec4(textureCube(u_CubeTexture, v_Texcoord).rgb*u_Intensity,u_AlphaBlending);\n}\n\n",ci.add(f,t,e,i,n),i={a_Position:0,a_Texcoord0:2},n={u_Intensity:[1,1],u_AlphaBlending:[2,1],u_texture:[3,1],u_MvpMatrix:[4,3]};var p=ki.nameKey.add("SkyDome");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nuniform mat4 u_MvpMatrix;\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\n  gl_Position = (u_MvpMatrix*a_Position).xyww;\n  v_Texcoord = a_Texcoord0;\n}\n",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Intensity;\nuniform float u_AlphaBlending;\nuniform sampler2D u_texture;\n\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\t\n  gl_FragColor=vec4(texture2D(u_texture, v_Texcoord).rgb*u_Intensity,u_AlphaBlending);\n}\n\n",ci.add(p,t,e,i,n),i={a_Position:0,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_NormalTexture:[1,1],u_DiffuseTexture1:[2,1],u_DiffuseTexture2:[3,1],u_DiffuseTexture3:[4,1],u_DiffuseTexture4:[5,1],u_DiffuseScale1:[6,1],u_DiffuseScale2:[7,1],u_DiffuseScale3:[8,1],u_DiffuseScale4:[9,1],u_MaterialDiffuse:[11,1],u_MaterialAmbient:[10,1],u_MaterialSpecular:[12,1],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var m=ki.nameKey.add("Terrain");t="attribute vec4 a_Position;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nattribute vec2 a_Texcoord0;\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\nuniform mat4 u_MvpMatrix;\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n\tv_Texcoord0=a_Texcoord0;\n\tv_Texcoord1=a_Texcoord1;\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tv_Normal=a_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n#endif\n\n#ifdef LIGHTMAP\n\t//这个地方使用a_Normal 并不是真的代表normal，其实凑巧法线图的uv正好是符合 light_Map的UV\n\tv_LightMapUV=vec2(a_Normal.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Normal.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1\n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n\n}",e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialDiffuse;\n\tuniform vec4 u_MaterialSpecular;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tuniform vec3 u_MaterialAmbient;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\nuniform sampler2D u_NormalTexture;\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform vec2 u_DiffuseScale1;\nuniform vec2 u_DiffuseScale2;\nuniform vec2 u_DiffuseScale3;\nuniform vec2 u_DiffuseScale4;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n#ifdef DETAIL_NUM1\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz;\n#endif\n#ifdef DETAIL_NUM2\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-splatAlpha.r) + color2.xyz * splatAlpha.r;\n#endif\n#ifdef DETAIL_NUM3\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g)) + color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g;\n#endif\n#ifdef DETAIL_NUM4\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord1/u_DiffuseScale4);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g+splatAlpha.b))+ color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g + color4.xyz * splatAlpha.b;\n#endif\n\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = texture2D(u_NormalTexture,v_Normal.xy).xyz;\n\tnormal = normal*2.0 - vec3(1.0);\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t\t#endif\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n';var g=ci.add(m,t,e,i,n);Yi.SHADERDEFINE_DETAIL_NUM1=g.registerMaterialDefine("DETAIL_NUM1"),Yi.SHADERDEFINE_DETAIL_NUM2=g.registerMaterialDefine("DETAIL_NUM2"),Yi.SHADERDEFINE_DETAIL_NUM4=g.registerMaterialDefine("DETAIL_NUM4"),Yi.SHADERDEFINE_DETAIL_NUM3=g.registerMaterialDefine("DETAIL_NUM3"),i={a_Position:0,a_Normal:3,a_Texcoord0:2},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_DiffuseTexture1:[1,1],u_DiffuseTexture2:[2,1],u_DiffuseTexture3:[3,1],u_DiffuseTexture4:[4,1],u_DiffuseTexture5:[5,1],u_DiffuseScaleOffset1:[6,1],u_DiffuseScaleOffset2:[7,1],u_DiffuseScaleOffset3:[8,1],u_DiffuseScaleOffset4:[9,1],u_DiffuseScaleOffset5:[10,1],u_MaterialAlbedo:[14,1],u_MaterialDiffuse:[12,1],u_MaterialAmbient:[11,1],u_MaterialSpecular:[13,1],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var y=ki.nameKey.add("ExtendTerrain");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform vec4 u_LightmapScaleOffset;\n#endif\n\n#ifdef RECEIVESHADOW\n\tvarying float v_posViewZ;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n#endif\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n  \n\tv_Texcoord0 = a_Texcoord0;\n  \n\t#ifdef LIGHTMAP\n\t\tv_LightMapUV = vec2(a_Texcoord0.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Texcoord0.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_Normal = a_Normal;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}",e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tuniform vec3 u_MaterialDiffuse;\n\tuniform vec4 u_MaterialSpecular;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\n\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform sampler2D u_DiffuseTexture5;\n\nuniform vec4 u_DiffuseScaleOffset1;\nuniform vec4 u_DiffuseScaleOffset2;\nuniform vec4 u_DiffuseScaleOffset3;\nuniform vec4 u_DiffuseScaleOffset4;\nuniform vec4 u_DiffuseScaleOffset5;\n\nvarying vec2 v_Texcoord0;\n\nuniform vec3 u_MaterialAmbient;\nuniform vec4 u_MaterialAlbedo;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n\t#ifdef ExtendTerrain_DETAIL_NUM1\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r;\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM2\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM3\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM4\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM5\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tvec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\n\t#endif\n\t\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = v_Normal;\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t#else\n\t\t#if defined(RECEIVESHADOW)\t\t\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t\t//vec3 tColor= u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue + mix(vec3(0.15,0.15,0.15),vec3(0.0),shadowValue);\n\t\t\t//gl_FragColor.rgb*=tColor;\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_MaterialAlbedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor = vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n\n\n\n\n';var v=ci.add(y,t,e,i,n);v.addSpriteDefines(_n.shaderDefines),v.addMaterialDefines(Bi.shaderDefines),i={a_Position:0,a_OffsetVector:41,a_Texcoord0X:38,a_Texcoord0Y:40,a_BirthTime:33},n={u_MvpMatrix:[1,2],u_VMatrix:[1,3],u_PMatrix:[2,3],u_TilingOffset:[3,1],u_MainTexture:[1,1],u_MainColor:[2,1],u_CurTime:[3,2],u_LifeTime:[4,2],u_WidthCurve:[5,2],u_WidthCurveKeyLength:[6,2],u_GradientColorkey:[7,2],u_GradientAlphakey:[8,2]};var S=ki.nameKey.add("Trail");t="attribute vec3 a_Position;\nattribute vec3 a_OffsetVector;\nattribute vec4 a_Color;\nattribute float a_Texcoord0X;\nattribute float a_Texcoord0Y;\nattribute float a_BirthTime;\n\nuniform mat4 u_VMatrix;\nuniform mat4 u_PMatrix;\n\nuniform vec4 u_TilingOffset;\n\nuniform float u_CurTime;\nuniform float u_LifeTime;\nuniform vec4 u_WidthCurve[10];\nuniform int u_WidthCurveKeyLength;\n\nuniform vec4 u_GradientColorkey[10];\nuniform vec2 u_GradientAlphakey[10];\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\n{\n\tfloat t2 = t * t;\n\tfloat t3 = t2 * t;\n\tfloat a = 2.0 * t3 - 3.0 * t2 + 1.0;\n\tfloat b = t3 - 2.0 * t2 + t;\n\tfloat c = t3 - t2;\n\tfloat d = -2.0 * t3 + 3.0 * t2;\n\treturn a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\n}\n\nfloat getCurWidth(in float normalizeTime)\n{\n\tif(normalizeTime == 0.0){\n\t\treturn u_WidthCurve[0].w;\n\t}\n\telse if(normalizeTime >= 1.0){\n\t\treturn u_WidthCurve[u_WidthCurveKeyLength - 1].w;\n\t}\n\telse{\n\t\tfor(int i = 0; i < 10; i ++ )\n\t\t{\n\t\t\tif(normalizeTime == u_WidthCurve[i].x)\n\t\t\t{\n\t\t\t\treturn u_WidthCurve[i].w;\n\t\t\t}\n\t\t\t\n\t\t\tvec4 lastFrame = u_WidthCurve[i];\n\t\t\tvec4 nextFrame = u_WidthCurve[i + 1];\n\t\t\tif(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\n\t\t\t{\n\t\t\t\tfloat duration = nextFrame.x - lastFrame.x;\n\t\t\t\tfloat t = (normalizeTime - lastFrame.x) / duration;\n\t\t\t\tfloat outTangent = lastFrame.z;\n\t\t\t\tfloat inTangent = nextFrame.y;\n\t\t\t\tfloat value1 = lastFrame.w;\n\t\t\t\tfloat value2 = nextFrame.w;\n\t\t\t\treturn hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\n\t\t\t}\n\t\t}\t\n\t}\n}\t\n\nvec4 getColorFromGradientByBlend(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tfloat colorKey = gradientColor.w;\n\t\tif(colorKey >= normalizeTime)\n\t\t{\n\t\t\tvec4 lastGradientColor = gradientColors[i-1];\n\t\t\tfloat lastColorKey = lastGradientColor.w;\n\t\t\tfloat age = (normalizeTime - lastColorKey) / (colorKey - lastColorKey);\n\t\t\tcolor.rgb = mix(gradientColors[i-1].xyz, gradientColor.xyz, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tfloat alphaKey = gradientAlpha.y;\n\t\tif(alphaKey >= normalizeTime)\n\t\t{\n\t\t\tvec2 lastGradientAlpha = gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey = lastGradientAlpha.y;\n\t\t\tfloat age = (normalizeTime - lastAlphaKey) / (alphaKey - lastAlphaKey);\n\t\t\tcolor.a = mix(lastGradientAlpha.x, gradientAlpha.x, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvec4 getColorFromGradientByFixed(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tif(gradientColor.w >= normalizeTime)\n\t\t{\n\t\t\tcolor.rgb = gradientColor.xyz;\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tif(gradientAlpha.y >= normalizeTime)\n\t\t{\n\t\t\tcolor.a = gradientAlpha.x;\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvoid main()\n{\n\tfloat normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\n\t\n\tgl_Position = u_PMatrix * u_VMatrix * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0 = (vec2(a_Texcoord0X, a_Texcoord0Y) * u_TilingOffset.xy) + u_TilingOffset.zw;\n\t#else\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\n\t#endif\n\t\n\t#ifdef GRADIENTMODE_BLEND\n\t\tv_Color = getColorFromGradientByBlend(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#else\n\t\tv_Color = getColorFromGradientByFixed(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#endif\n}\n\n\n\n",e="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTexture;\nuniform vec4 u_MainColor;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nvoid main()\n{\t\n\tvec4 color = 2.0 * u_MainColor * v_Color;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\n\t\tcolor *= mainTextureColor;\n\t#endif\n\tgl_FragColor = color;\n}\n\n";var x=ci.add(S,t,e,i,n);Zi.SHADERDEFINE_DIFFUSETEXTURE=x.registerMaterialDefine("DIFFUSETEXTURE"),Zi.SHADERDEFINE_TILINGOFFSET=x.registerSpriteDefine("TILINGOFFSET"),Sn.SHADERDEFINE_GRADIENTMODE_BLEND=x.registerSpriteDefine("GRADIENTMODE_BLEND")},t}(),Ue=function(){function t(){this._data=null,this._data=[]}r(t,"laya.d3.shader.ValusArray");var e=t.prototype;return e.setValue=function(t,e){this._data[t]=e},a(0,e,"data",function(){return this._data}),t}(),He=function(){function t(){this._currentPSSM=-1,this._numberOfPSSM=3,this._maxDistance=200,this._ratioOfDistance=1/this._numberOfPSSM,this._statesDirty=!0,this._lightCulling=null,this._renderTarget=null,this._lightVPMatrix=null,this._lightCameras=null,this._shadowQuenes=null,this._shadowMapTextureSize=1024,this._scene=null,this._PCFType=0,this._shaderValueLightVP=null,this._shaderValueVPs=null,this._spiltDistance=new Array(4),this._globalParallelLightDir=new Pe(0,-1,0),this._boundingSphere=new Array(4),this._boundingBox=new Array(4),this._frustumPos=new Array(16),this._uniformDistance=new Array(4),this._logDistance=new Array(4),this._dimension=new Array(4),this._tempLookAt3=new Pe,this._tempLookAt4=new Ne,this._tempValue=new Ne,this._tempPos=new Pe,this._tempLightUp=new Pe,this._tempMin=new Ne,this._tempMax=new Ne,this._tempMatrix44=new be,this._splitFrustumCulling=new xe(be.DEFAULT),this._tempScaleMatrix44=new be,this._shadowPCFOffset=new Le(1/1024,1/1024),this._shaderValueDistance=new Ne;var t=0;for(t=0;t<this._spiltDistance.length;t++)this._spiltDistance[t]=0;for(t=0;t<this._dimension.length;t++)this._dimension[t]=new Le;for(t=0;t<this._frustumPos.length;t++)this._frustumPos[t]=new Pe;for(t=0;t<this._boundingBox.length;t++)this._boundingBox[t]=new Se(new Pe,new Pe);for(t=0;t<this._boundingSphere.length;t++)this._boundingSphere[t]=new Ee(new Pe,0);be.createScaling(new Pe(.5,.5,1),this._tempScaleMatrix44),this._tempScaleMatrix44.elements[12]=.5,this._tempScaleMatrix44.elements[13]=.5}r(t,"laya.d3.shadowMap.ParallelSplitShadowMap");var e=t.prototype;return e.setInfo=function(t,e,i,n,r,a){r>3&&(this._numberOfPSSM=3),this._scene=t,this._maxDistance=e,this.PSSMNum=r,this._globalParallelLightDir=i,this._ratioOfDistance=1/this._numberOfPSSM;for(var s=0;s<this._spiltDistance.length;s++)this._spiltDistance[s]=0;this._shadowMapTextureSize=n,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this.setPCFType(a),this._statesDirty=!0},e.setPCFType=function(t){switch(this._PCFType=t,this._PCFType){case 0:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 1:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 2:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 3:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2)}},e.getPCFType=function(){return this._PCFType},e.setFarDistance=function(t){this._maxDistance!=t&&(this._maxDistance=t,this._statesDirty=!0)},e.getFarDistance=function(){return this._maxDistance},e._setGlobalParallelLightDir=function(t){this._globalParallelLightDir=t},e.getGlobalParallelLightDir=function(){return this._globalParallelLightDir},e.getCurrentPSSM=function(){return this._currentPSSM},e.getLightCamera=function(t){return this._lightCameras[t]},e._beginSampler=function(t,e){if(t<0||t>this._numberOfPSSM)throw new Error("ParallelSplitShadowMap: beginSample invalid index");this._currentPSSM=t,this._update(e)},e.endSampler=function(t){this._currentPSSM=-1},e._calcAllLightCameraInfo=function(t){if(1===this._numberOfPSSM)this._beginSampler(0,t),this.endSampler(t);else for(var e=0,i=this._numberOfPSSM+1;e<i;e++)this._beginSampler(e,t),this.endSampler(t)},e._recalculate=function(t,e,i){this._calcSplitDistance(t),this._calcBoundingBox(e,i),this._rebuildRenderInfo()},e._update=function(t){var e=t.nearPlane,i=t.fieldOfView,n=t.aspectRatio;(this._statesDirty||this.lastNearPlane!==e||this.lastFieldOfView!==i||this.lastAspectRatio!==n)&&(this._recalculate(e,i,n),this._uploadShaderValue(),this._statesDirty=!1,this.lastNearPlane=e,this.lastFieldOfView=i,this.lastAspectRatio=n),this._calcLightViewProject(t)},e._uploadShaderValue=function(){var t=this._scene;switch(this._numberOfPSSM){case 1:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3);break;case 2:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3);break;case 3:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2)}var e=t._shaderValues;switch(e.setValue(15,this._shaderValueDistance.elements),e.setValue(16,this._shaderValueLightVP),e.setValue(17,this._shadowPCFOffset.elements),this._numberOfPSSM){case 3:e.setValue(18,this.getRenderTarget(1)),e.setValue(19,this.getRenderTarget(2)),e.setValue(20,this.getRenderTarget(3));break;case 2:e.setValue(18,this.getRenderTarget(1)),e.setValue(19,this.getRenderTarget(2));break;case 1:e.setValue(18,this.getRenderTarget(1))}},e._calcSplitDistance=function(t){var e=this._maxDistance,i=1/this._numberOfPSSM,n=0;for(n=0;n<=this._numberOfPSSM;n++)this._uniformDistance[n]=t+(e-t)*n*i;var r=e/t;for(n=0;n<=this._numberOfPSSM;n++){var a=Math.pow(r,n*i);this._logDistance[n]=t*a}for(n=0;n<=this._numberOfPSSM;n++)this._spiltDistance[n]=this._uniformDistance[n]*this._ratioOfDistance+this._logDistance[n]*(1-this._ratioOfDistance);this._shaderValueDistance.x=this._spiltDistance[1],this._shaderValueDistance.y=this._spiltDistance[2],this._shaderValueDistance.z=this._spiltDistance[3],this._shaderValueDistance.w=this._spiltDistance[4]},e._calcBoundingBox=function(t,e){var i,n,r,a,s=3.1415926*t/180,o=Math.tan(s/2),l=NaN,h=NaN,c=NaN,u=0;for(u=0;u<=this._numberOfPSSM;u++){h=(l=(c=this._spiltDistance[u])*o)*e;var _=this._frustumPos[4*u+0].elements;_[0]=-h,_[1]=-l,_[2]=-c,(_=this._frustumPos[4*u+1].elements)[0]=h,_[1]=-l,_[2]=-c,(_=this._frustumPos[4*u+2].elements)[0]=-h,_[1]=l,_[2]=-c,(_=this._frustumPos[4*u+3].elements)[0]=h,_[1]=l,_[2]=-c,(_=this._dimension[u].elements)[0]=h,_[1]=l}for(u=1;u<=this._numberOfPSSM;u++)i=this._dimension[u].elements,(n=this._boundingBox[u].min.elements)[0]=-i[0],n[1]=-i[1],n[2]=-this._spiltDistance[u],(r=this._boundingBox[u].max.elements)[0]=i[0],r[1]=i[1],r[2]=-this._spiltDistance[u-1],(a=this._boundingSphere[u].center.elements)[0]=.5*(n[0]+r[0]),a[1]=.5*(n[1]+r[1]),a[2]=.5*(n[2]+r[2]),this._boundingSphere[u].radius=.5*Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2));n=this._boundingBox[0].min.elements,i=this._dimension[this._numberOfPSSM].elements,n[0]=-i[0],n[1]=-i[1],n[2]=-this._spiltDistance[this._numberOfPSSM],(r=this._boundingBox[0].max.elements)[0]=i[0],r[1]=i[1],r[2]=-this._spiltDistance[0],(a=this._boundingSphere[0].center.elements)[0]=.5*(n[0]+r[0]),a[1]=.5*(n[1]+r[1]),a[2]=.5*(n[2]+r[2]),this._boundingSphere[0].radius=.5*Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2))},e.calcSplitFrustum=function(t){this._currentPSSM>0?be.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[this._currentPSSM-1],this._spiltDistance[this._currentPSSM],this._tempMatrix44):be.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[0],this._spiltDistance[this._numberOfPSSM],this._tempMatrix44),be.multiply(this._tempMatrix44,t.viewMatrix,this._tempMatrix44),this._splitFrustumCulling.matrix=this._tempMatrix44},e._rebuildRenderInfo=function(){var t=this._numberOfPSSM+1,e=0;if(null==this._renderTarget)for(this._renderTarget=s(t),this._renderTarget[0]=null,e=1;e<t;e++)this._renderTarget[e]=new an(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728);else if(this._renderTarget.length!=t)for(this.disposeAllRenderTarget(),this._renderTarget.length=t,this._renderTarget[0]=null,e=1;e<t;e++)this._renderTarget[e]=new an(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728);else for(e=1;e<t;e++)null!=this._renderTarget[e]&&this._renderTarget[e].width==this._shadowMapTextureSize&&this._renderTarget[e].height==this._shadowMapTextureSize||(null!=this._renderTarget[e]&&this._renderTarget[e].destroy(),this._renderTarget[e]=new an(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728));if(null==this._lightCulling||this._lightCulling.length!=t)for(this._lightCulling?this._lightCulling.length=t:this._lightCulling=s(t),e=0;e<this._lightCulling.length;e++)this._lightCulling[e]=new xe(be.DEFAULT);if(null==this._lightVPMatrix||this._lightVPMatrix.length!=t)for(this._lightVPMatrix?this._lightVPMatrix.length=t:this._lightVPMatrix=s(t),e=0;e<this._lightVPMatrix.length;e++)this._lightVPMatrix[e]=new be;if(null==this._lightCameras||this._lightCameras.length!=t)for(this._lightCameras?this._lightCameras.length=t:this._lightCameras=s(t),e=0;e<this._lightCameras.length;e++)this._lightCameras[e]=new pn,this._lightCameras[e].name="lightCamera"+e;if(null==this._shadowQuenes||this._shadowQuenes.length!=this._numberOfPSSM)for(this._shadowQuenes?this._shadowQuenes.length=this._numberOfPSSM:this._shadowQuenes=s(this._numberOfPSSM),e=0;e<this._shadowQuenes.length;e++)this._shadowQuenes[e]=new ut(this._scene);if(null==this._shaderValueVPs||this._shaderValueVPs.length!=t)for(this._shaderValueVPs?this._shaderValueVPs.length=t:this._shaderValueVPs=s(t),this._shaderValueLightVP=new Float32Array(16*t),e=0;e<t;e++)this._shaderValueVPs[e]=new Float32Array(this._shaderValueLightVP.buffer,64*e)},e._calcLightViewProject=function(e){var i=this._boundingSphere[this._currentPSSM],n=e.transform.worldMatrix;i.radius,i.center.cloneTo(this._tempLookAt3),Pe.transformV3ToV4(this._tempLookAt3,n,this._tempLookAt4);var r=this._tempLookAt3.elements,a=this._tempLookAt4.elements;r[0]=a[0],r[1]=a[1],r[2]=a[2];var s=this._tempLightUp.elements,o=e.forward.elements;s[0]=o[0],s[1]=1,s[2]=o[2],Pe.normalize(this._tempLightUp,this._tempLightUp),Pe.scale(this._globalParallelLightDir,4*i.radius,this._tempPos),Pe.subtract(this._tempLookAt3,this._tempPos,this._tempPos);var l=this._lightCameras[this._currentPSSM];l.transform.position=this._tempPos,l.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1);var h=this._tempMax.elements,c=this._tempMin.elements;h[0]=h[1]=h[2]=-1e5,h[3]=1,c[0]=c[1]=c[2]=1e5,c[3]=1,be.multiply(l.viewMatrix,n,this._tempMatrix44);var u=this._tempValue.elements,_=[];_.length=8,this._boundingBox[this._currentPSSM].getCorners(_);for(var d=0;d<8;d++){var f=_[d].elements;u[0]=f[0],u[1]=f[1],u[2]=f[2],u[3]=1,Ne.transformByM4x4(this._tempValue,this._tempMatrix44,this._tempValue),c[0]=u[0]<c[0]?u[0]:c[0],c[1]=u[1]<c[1]?u[1]:c[1],c[2]=u[2]<c[2]?u[2]:c[2],h[0]=u[0]>h[0]?u[0]:h[0],h[1]=u[1]>h[1]?u[1]:h[1],h[2]=u[2]>h[2]?u[2]:h[2]}Ne.add(this._tempMax,this._tempMin,this._tempValue),u[0]*=.5,u[1]*=.5,u[2]*=.5,u[3]=1,Ne.transformByM4x4(this._tempValue,l.transform.worldMatrix,this._tempValue);var p=Math.abs(-this._tempMax.z),m=p>this._maxDistance?p:this._maxDistance;Pe.scale(this._globalParallelLightDir,m,this._tempPos);var g=this._tempPos.elements;g[0]=u[0]-g[0],g[1]=u[1]-g[1],g[2]=u[2]-g[2],l.transform.position=this._tempPos,l.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1),be.createOrthoOffCenterRH(c[0],h[0],c[1],h[1],1,m+.5*(h[2]-c[2]),l.projectionMatrix),l.projectionViewMatrix.cloneTo(this._lightVPMatrix[this._currentPSSM]),this._lightCulling[this._currentPSSM].matrix=this._lightVPMatrix[this._currentPSSM],t.multiplyMatrixOutFloat32Array(this._tempScaleMatrix44,this._lightVPMatrix[this._currentPSSM],this._shaderValueVPs[this._currentPSSM])},e.getLightFrustumCulling=function(t){return this._lightCulling[t]},e.getSplitFrustumCulling=function(){return this._splitFrustumCulling},e.getSplitDistance=function(t){return this._spiltDistance[t]},e.setShadowMapTextureSize=function(t){t!==this._shadowMapTextureSize&&(this._shadowMapTextureSize=t,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this._statesDirty=!0)},e.getShadowMapTextureSize=function(){return this._shadowMapTextureSize},e.beginRenderTarget=function(t){this._renderTarget[t].start()},e.endRenderTarget=function(t){this._renderTarget[t].end()},e.getRenderTarget=function(t){return this._renderTarget[t]},e.disposeAllRenderTarget=function(){for(var t=0,e=this._numberOfPSSM+1;t<e;t++)this._renderTarget[t]&&(this._renderTarget[t].destroy(),this._renderTarget[t]=null)},a(0,e,"PSSMNum",function(){return this._numberOfPSSM},function(t){t=(t=t>0?t:1)<=3?t:3,this._numberOfPSSM!=t&&(this._numberOfPSSM=t,this._ratioOfDistance=1/this._numberOfPSSM,this._statesDirty=!0)}),t.multiplyMatrixOutFloat32Array=function(t,e,i){var n,r,a,s,o,l,h;for(r=t.elements,a=e.elements,n=0;n<4;n++)s=r[n],o=r[n+4],l=r[n+8],h=r[n+12],i[n]=s*a[0]+o*a[1]+l*a[2]+h*a[3],i[n+4]=s*a[4]+o*a[5]+l*a[6]+h*a[7],i[n+8]=s*a[8]+o*a[9]+l*a[10]+h*a[11],i[n+12]=s*a[12]+o*a[13]+l*a[14]+h*a[15]},t.SHADERDEFINE_RECEIVE_SHADOW=1,t.SHADERDEFINE_CAST_SHADOW=512,t.SHADERDEFINE_SHADOW_PSSM1=1024,t.SHADERDEFINE_SHADOW_PSSM2=2048,t.SHADERDEFINE_SHADOW_PSSM3=4096,t.SHADERDEFINE_SHADOW_PCF_NO=8192,t.SHADERDEFINE_SHADOW_PCF1=16384,t.SHADERDEFINE_SHADOW_PCF2=32768,t.SHADERDEFINE_SHADOW_PCF3=65536,t.MAX_PSSM_COUNT=3,t}(),Ge=function(){function t(){this._boundingSphere=null,this._boundingBox=null,this._sizeOfY=null,this._currentLODLevel=0,this._lastDistanceToEye=NaN,this._originalBoundingSphere=null,this._originalBoundingBox=null,this._originalBoundingBoxCorners=null,this._bUseStrip=!1,this._gridSize=NaN,this._beginGridX=0,this._beginGridZ=0,this._LODError=null,t.__init__(),this._currentLODLevel=0}r(t,"laya.d3.terrain.TerrainLeaf");var e=t.prototype;return e.calcVertextNorml=function(e,i,n,r,a,s){var o=0,l=0;l=-1*t.getHeightFromTerrainHeightData(e-1,i-1,n,r,a),l+=-1*t.getHeightFromTerrainHeightData(e-1,i,n,r,a),l+=-1*t.getHeightFromTerrainHeightData(e-1,i+1,n,r,a),l+=1*t.getHeightFromTerrainHeightData(e+1,i-1,n,r,a),l+=1*t.getHeightFromTerrainHeightData(e+1,i,n,r,a),l+=1*t.getHeightFromTerrainHeightData(e+1,i+1,n,r,a),o=-1*t.getHeightFromTerrainHeightData(e-1,i-1,n,r,a),o+=-1*t.getHeightFromTerrainHeightData(e,i-1,n,r,a),o+=-1*t.getHeightFromTerrainHeightData(e+1,i-1,n,r,a),o+=1*t.getHeightFromTerrainHeightData(e-1,i+1,n,r,a),o+=1*t.getHeightFromTerrainHeightData(e,i+1,n,r,a),o+=1*t.getHeightFromTerrainHeightData(e+1,i+1,n,r,a),s.x=-l,s.y=6,s.z=-o,Pe.normalize(s,s)},e.calcVertextNormlUV=function(t,e,i,n,r){r.x=t/i,r.y=e/n,r.z=e/n},e.calcVertextBuffer=function(e,i,n,r,a,s,o,l,h,c,u,_){if(1==_&&!t.__ADAPT_MATRIX__){t.__ADAPT_MATRIX__=new be;var d=new be;be.createRotationY(Math.PI,t.__ADAPT_MATRIX__),be.createTranslate(new Pe(0,0,(u-1)*a),d),be.multiply(d,t.__ADAPT_MATRIX__,t.__ADAPT_MATRIX__),t.__ADAPT_MATRIX_INV__=new be,t.__ADAPT_MATRIX__.invert(t.__ADAPT_MATRIX_INV__)}this._gridSize=a,this._beginGridX=e*t.CHUNK_GRID_NUM+n,this._beginGridZ=i*t.CHUNK_GRID_NUM+r;for(var f=o*l,p=2147483647,m=-2147483648,g=new Pe,y=0,v=t.LEAF_GRID_NUM+1;y<v;y++)for(var S=0,x=t.LEAF_GRID_NUM+1;S<x;S++)t.__VECTOR3__.x=(this._beginGridX+S)*this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+y)*this._gridSize,t.__VECTOR3__.y=h[(this._beginGridZ+y)*c+(this._beginGridX+S)],p=t.__VECTOR3__.y<p?t.__VECTOR3__.y:p,m=t.__VECTOR3__.y>m?t.__VECTOR3__.y:m,t.__ADAPT_MATRIX__&&Pe.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[f]=t.__VECTOR3__.x,s[++f]=t.__VECTOR3__.y,s[++f]=t.__VECTOR3__.z,f++,this.calcVertextNormlUV(this._beginGridX+S,this._beginGridZ+y,c,u,g),s[f]=g.x,s[++f]=g.y,s[++f]=g.z,s[++f]=(n+S)/t.CHUNK_GRID_NUM,s[++f]=(r+y)/t.CHUNK_GRID_NUM,s[++f]=this._beginGridX+S,s[++f]=this._beginGridZ+y,f++;this._sizeOfY=new Le(p-1,m+1),this.calcLODErrors(h,c,u),this.calcOriginalBoudingBoxAndSphere()},e.calcSkirtVertextBuffer=function(e,i,n,r,a,s,o,l,h,c,u){this._gridSize=a,this._beginGridX=e*t.CHUNK_GRID_NUM+n,this._beginGridZ=i*t.CHUNK_GRID_NUM+r;var _=o*l,d=0,f=0,p=t.LEAF_GRID_NUM+1,m=new Pe,g=0,y=0;for(d=0;d<2;d++)for(f=0;f<p;f++)t.__VECTOR3__.x=(this._beginGridX+f)*this._gridSize,t.__VECTOR3__.y=1==d?h[this._beginGridZ*c+(this._beginGridX+f)]:-this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+0)*this._gridSize,t.__ADAPT_MATRIX__&&Pe.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[_]=t.__VECTOR3__.x,s[++_]=t.__VECTOR3__.y,s[++_]=t.__VECTOR3__.z,_++,g=0==d?this._beginGridZ-1:this._beginGridZ,this.calcVertextNormlUV(this._beginGridX+f,g,c,u,m),s[_]=m.x,s[++_]=m.y,s[++_]=m.z,s[++_]=(n+f)/t.CHUNK_GRID_NUM,s[++_]=(r+0)/t.CHUNK_GRID_NUM,s[++_]=this._beginGridX+f,s[++_]=g,_++;for(d=0;d<2;d++)for(f=0;f<p;f++)t.__VECTOR3__.x=(this._beginGridX+f)*this._gridSize,t.__VECTOR3__.y=0==d?h[(this._beginGridZ+t.LEAF_GRID_NUM)*c+(this._beginGridX+f)]:-this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+t.LEAF_GRID_NUM)*this._gridSize,t.__ADAPT_MATRIX__&&Pe.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[_]=t.__VECTOR3__.x,s[++_]=t.__VECTOR3__.y,s[++_]=t.__VECTOR3__.z,_++,g=0==d?this._beginGridZ+t.LEAF_GRID_NUM:this._beginGridZ+t.LEAF_GRID_NUM+1,this.calcVertextNormlUV(this._beginGridX+f,g,c,u,m),s[_]=m.x,s[++_]=m.y,s[++_]=m.z,s[++_]=(n+f)/t.CHUNK_GRID_NUM,s[++_]=(r+t.LEAF_GRID_NUM)/t.CHUNK_GRID_NUM,s[++_]=this._beginGridX+f,s[++_]=g,_++;for(d=0;d<2;d++)for(f=0;f<p;f++)t.__VECTOR3__.x=(this._beginGridX+0)*this._gridSize,t.__VECTOR3__.y=0==d?h[(this._beginGridZ+f)*c+(this._beginGridX+0)]:-this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+f)*this._gridSize,t.__ADAPT_MATRIX__&&Pe.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[_]=t.__VECTOR3__.x,s[++_]=t.__VECTOR3__.y,s[++_]=t.__VECTOR3__.z,_++,y=0==d?this._beginGridX:this._beginGridX-1,this.calcVertextNormlUV(y,this._beginGridZ+f,c,u,m),s[_]=m.x,s[++_]=m.y,s[++_]=m.z,s[++_]=(n+0)/t.CHUNK_GRID_NUM,s[++_]=(r+f)/t.CHUNK_GRID_NUM,s[++_]=y,s[++_]=this._beginGridZ+f,_++;for(d=0;d<2;d++)for(f=0;f<p;f++)t.__VECTOR3__.x=(this._beginGridX+t.LEAF_GRID_NUM)*this._gridSize,t.__VECTOR3__.y=1==d?h[(this._beginGridZ+f)*c+(this._beginGridX+t.LEAF_GRID_NUM)]:-this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+f)*this._gridSize,t.__ADAPT_MATRIX__&&Pe.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[_]=t.__VECTOR3__.x,s[++_]=t.__VECTOR3__.y,s[++_]=t.__VECTOR3__.z,_++,y=0==d?this._beginGridX+t.LEAF_GRID_NUM+1:this._beginGridX+t.LEAF_GRID_NUM,this.calcVertextNormlUV(y,this._beginGridZ+f,c,u,m),s[_]=m.x,s[++_]=m.y,s[++_]=m.z,s[++_]=(n+t.LEAF_GRID_NUM)/t.CHUNK_GRID_NUM,s[++_]=(r+f)/t.CHUNK_GRID_NUM,s[++_]=y,s[++_]=this._beginGridZ+f,_++},e.calcOriginalBoudingBoxAndSphere=function(){var e=new Pe(this._beginGridX*this._gridSize,this._sizeOfY.x,this._beginGridZ*this._gridSize),i=new Pe((this._beginGridX+t.LEAF_GRID_NUM)*this._gridSize,this._sizeOfY.y,(this._beginGridZ+t.LEAF_GRID_NUM)*this._gridSize);t.__ADAPT_MATRIX__&&(Pe.transformV3ToV3(e,t.__ADAPT_MATRIX__,e),Pe.transformV3ToV3(i,t.__ADAPT_MATRIX__,i)),this._originalBoundingBox=new Se(e,i);var n=new Pe;Pe.subtract(i,e,n),Pe.scale(n,.5,n);var r=new Pe;Pe.add(e,n,r),this._originalBoundingSphere=new Ee(r,Pe.scalarLength(n)),this._originalBoundingBoxCorners=s(8,null),this._originalBoundingBox.getCorners(this._originalBoundingBoxCorners),this._boundingBox=new Se(new Pe(-.5,-.5,-.5),new Pe(.5,.5,.5)),this._boundingSphere=new Ee(new Pe(0,0,0),1)},e.calcLeafBoudingBox=function(t){for(var e=0;e<8;e++)Pe.transformCoordinate(this._originalBoundingBoxCorners[e],t,ei._tempBoundBoxCorners[e]);Se.createfromPoints(ei._tempBoundBoxCorners,this._boundingBox)},e.calcLeafBoudingSphere=function(t,e){Pe.transformCoordinate(this._originalBoundingSphere.center,t,this._boundingSphere.center),this._boundingSphere.radius=this._originalBoundingSphere.radius*e},e.calcLODErrors=function(e,i,n){this._LODError=new Float32Array(t._maxLODLevel+1);for(var r=1,a=0,s=t._maxLODLevel+1;a<s;a++){for(var o=0,l=0,h=t.LEAF_GRID_NUM;l<h;l+=r)for(var c=0,u=t.LEAF_GRID_NUM;c<u;c+=r)for(var _=e[(this._beginGridZ+l)*i+(this._beginGridX+c)],d=e[(this._beginGridZ+l)*i+(this._beginGridX+c)+r],f=e[(this._beginGridZ+l+r)*i+(this._beginGridX+c)],p=e[(this._beginGridZ+l+r)*i+(this._beginGridX+c)+r],m=0;m<r;m++)for(var g=m/r,y=0;y<r;y++){var v=y/r,S=e[(this._beginGridZ+l+m)*i+(this._beginGridX+c)+y],x=v+g<=1?_+(d-_)*v+(f-_)*g:p+(f-p)*(1-v)+(d-p)*(1-g),E=Math.abs(x-S);o=Math.max(o,E)}r*=2,this._LODError[a]=o}},e.determineLod=function(e,i,n,r){var a=Pe.distance(e,this._boundingSphere.center),s=t._maxLODLevel;if(!r){if(this._lastDistanceToEye==a)return this._currentLODLevel;this._lastDistanceToEye>a&&(s=this._currentLODLevel)}for(var o=s;o>=1;o--)if(fn.LOD_DISTANCE_FACTOR*this._LODError[o]/a*i<n){this._currentLODLevel=o;break}return this._lastDistanceToEye=a,this._currentLODLevel},t.__init__=function(){if(!t._bInit){var e=t.CHUNK_GRID_NUM/t.LEAF_GRID_NUM*(t.CHUNK_GRID_NUM/t.LEAF_GRID_NUM);t._planeLODIndex=s(e);var i=0,n=0,r=0,a=0,o=0,l=0,h=null,c=null;for(i=0;i<e;i++)t._planeLODIndex[i]=new Array(t._maxLODLevel+1);for(i=0,a=t._maxLODLevel+1;i<a;i++)t._planeLODIndex[0][i]=t.calcPlaneLODIndex(i);for(i=1;i<e;i++)for(l=i*t.LEAF_PLANE_VERTEXT_COUNT,n=0,o=t._maxLODLevel+1;n<o;n++){for(h=t._planeLODIndex[0][n],c=new Uint16Array(h.length),r=0;r<h.length;r++)c[r]=h[r]+l;t._planeLODIndex[i][n]=c}for(t._skirtLODIndex=s(e),i=0;i<e;i++)t._skirtLODIndex[i]=new Array(t._maxLODLevel+1);for(i=0,a=t._maxLODLevel+1;i<a;i++)t._skirtLODIndex[0][i]=t.calcSkirtLODIndex(i);for(i=1;i<e;i++)for(l=i*t.LEAF_SKIRT_VERTEXT_COUNT,n=0,o=t._maxLODLevel+1;n<o;n++){for(h=t._skirtLODIndex[0][n],c=new Uint16Array(h.length),r=0;r<h.length;r++)c[r]=h[r]+l;t._skirtLODIndex[i][n]=c}t._bInit=!0}},t.getPlaneLODIndex=function(e,i){return t._planeLODIndex[e][i]},t.getSkirtLODIndex=function(e,i){return t._skirtLODIndex[e][i]},t.calcPlaneLODIndex=function(e){e>t._maxLODLevel&&(e=t._maxLODLevel);var i=t.LEAF_GRID_NUM+1,n=0,r=null,a=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,e);r=new Uint16Array(a*a*6);for(var s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/a,o=0;o<t.LEAF_GRID_NUM;o+=s)for(var l=0;l<t.LEAF_GRID_NUM;l+=s)r[n]=(o+s)*i+l,r[++n]=o*i+l,r[++n]=o*i+l+s,r[++n]=o*i+l+s,r[++n]=(o+s)*i+l+s,r[++n]=(o+s)*i+l,n++;return r},t.calcSkirtLODIndex=function(e){e>t._maxLODLevel&&(e=t._maxLODLevel);var i=t.CHUNK_GRID_NUM/t.LEAF_GRID_NUM*(t.CHUNK_GRID_NUM/t.LEAF_GRID_NUM)*t.LEAF_PLANE_VERTEXT_COUNT,n=t.LEAF_GRID_NUM+1,r=0,a=null,s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,e);a=new Uint16Array(4*s*6);for(var o=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/s,l=0;l<4;l++){for(var h=0;h<t.LEAF_GRID_NUM;h+=o)a[r]=i+n+h,a[++r]=i+h,a[++r]=i+h+o,a[++r]=i+h+o,a[++r]=i+n+h+o,a[++r]=i+n+h,r++;i+=2*n}return a},t.getHeightFromTerrainHeightData=function(t,e,i,n,r){return t=(t=t<0?0:t)>=n?n-1:t,i[(e=(e=e<0?0:e)>=r?r-1:e)*n+t]},t.CHUNK_GRID_NUM=64,t.LEAF_GRID_NUM=32,t.__ADAPT_MATRIX__=null,t.__ADAPT_MATRIX_INV__=null,t._planeLODIndex=null,t._skirtLODIndex=null,t._bInit=!1,n(t,["LEAF_PLANE_VERTEXT_COUNT",function(){return this.LEAF_PLANE_VERTEXT_COUNT=(t.LEAF_GRID_NUM+1)*(t.LEAF_GRID_NUM+1)},"LEAF_SKIRT_VERTEXT_COUNT",function(){return this.LEAF_SKIRT_VERTEXT_COUNT=2*(t.LEAF_GRID_NUM+1)*4},"LEAF_VERTEXT_COUNT",function(){return this.LEAF_VERTEXT_COUNT=t.LEAF_PLANE_VERTEXT_COUNT+t.LEAF_SKIRT_VERTEXT_COUNT},"LEAF_PLANE_MAX_INDEX_COUNT",function(){return this.LEAF_PLANE_MAX_INDEX_COUNT=t.LEAF_GRID_NUM*t.LEAF_GRID_NUM*6},"LEAF_SKIRT_MAX_INDEX_COUNT",function(){return this.LEAF_SKIRT_MAX_INDEX_COUNT=4*t.LEAF_GRID_NUM*6},"LEAF_MAX_INDEX_COUNT",function(){return this.LEAF_MAX_INDEX_COUNT=t.LEAF_PLANE_MAX_INDEX_COUNT+t.LEAF_SKIRT_MAX_INDEX_COUNT},"__VECTOR3__",function(){return this.__VECTOR3__=new Pe},"_maxLODLevel",function(){return this._maxLODLevel=Math.log2(t.LEAF_GRID_NUM)}]),t}(),We=function(){function t(){this.alphaMap=null,this.detailID=null,this.normalMap=null}return r(t,"laya.d3.terrain.unit.ChunkInfo"),t}(),ze=function(){function t(){this.diffuseTexture=null,this.normalTexture=null,this.scale=null,this.offset=null}return r(t,"laya.d3.terrain.unit.DetailTextureInfo"),t}(),Ye=function(){function t(){this.ambientColor=null,this.diffuseColor=null,this.specularColor=null}return r(t,"laya.d3.terrain.unit.MaterialInfo"),t}(),Xe=function(){function t(){}return r(t,"laya.d3.utils.Physics"),t.__init__=function(){t._layerCollsionMatrix.length=31;for(var e=0;e<31;e++){var i=[],n=31-e;i.length=n;for(var r=0;r<n;r++)i[r]=r===n-1;t._layerCollsionMatrix[e]=i}},t.setLayerCollision=function(e,i,n){t._layerCollsionMatrix[e.number][30-i.number]=n},t.getLayerCollision=function(e,i){return t._layerCollsionMatrix[e.number][30-i.number]},t.setColliderCollision=function(t,e,i){i?(delete t._ignoreCollisonMap[e.id],delete e._ignoreCollisonMap[t.id]):(t._ignoreCollisonMap[e.id]=e,e._ignoreCollisonMap[t.id]=t)},t.getIColliderCollision=function(t,e){return!!t._ignoreCollisonMap[e.id]},t.rayCast=function(e,i,n,r){void 0===n&&(n=1.79e308),void 0===r&&(r=0),t._outHitAllInfo.length=0;for(var a=W.getLayerByNumber(r)._colliders,s=0,o=a.length;s<o;s++){var l=a[s];if(l.enable&&(l.raycast(e,t._outHitInfo,n),-1!==t._outHitInfo.distance&&t._outHitInfo.distance<=n)){var h=new Ke;t._outHitInfo.cloneTo(h),t._outHitAllInfo.push(h)}}if(0==t._outHitAllInfo.length)return i.sprite3D=null,void(i.distance=-1);for(var c=Number.MAX_VALUE,u=0,_=0;_<t._outHitAllInfo.length;_++)t._outHitAllInfo[_].distance<c&&(c=t._outHitAllInfo[_].distance,u=_);t._outHitAllInfo[u].cloneTo(i)},t.rayCastAll=function(e,i,n,r){void 0===n&&(n=1.79e308),void 0===r&&(r=0),i.length=0;for(var a=W.getLayerByNumber(r)._colliders,s=0,o=a.length;s<o;s++){var l=a[s];if(l.enable&&(t._outHitInfo.distance=-1,t._outHitInfo.sprite3D=null,l.raycast(e,t._outHitInfo,n),-1!==t._outHitInfo.distance&&t._outHitInfo.distance<=n)){var h=new Ke;t._outHitInfo.cloneTo(h),i.push(h)}}},t._outHitAllInfo=[],t._layerCollsionMatrix=[],n(t,["_outHitInfo",function(){return this._outHitInfo=new Ke},"collisionManager",function(){return this.collisionManager=new ni},"gravity",function(){return this.gravity=new Pe(0,-9.81,0)}]),t}(),je=function(){function t(){}return r(t,"laya.d3.utils.Picker"),t.calculateCursorRay=function(e,i,n,r,a,s){var o=e.elements[0],l=e.elements[1],h=t._tempVector30,c=h.elements;c[0]=o,c[1]=l,c[2]=i.minDepth;var u=t._tempVector31,_=u.elements;_[0]=o,_[1]=l,_[2]=i.maxDepth;var d=s.origin,f=t._tempVector32;i.unprojectFromWVP(h,n,r,a,d),i.unprojectFromWVP(u,n,r,a,f);var p=s.direction.elements;p[0]=f.x-d.x,p[1]=f.y-d.y,p[2]=f.z-d.z,Pe.normalize(s.direction,s.direction)},t.rayIntersectsPositionsAndIndices=function(e,i,n,r,a){for(var s=n.vertexStride/4,o=n.getVertexElementByUsage(0).offset/4,l=Number.MAX_VALUE,h=-1,c=-1,u=-1,_=0;_<r.length;_+=3){var d=t._tempVector35,f=d.elements,p=r[_]*s,m=p+o;f[0]=i[m],f[1]=i[m+1],f[2]=i[m+2];var g=t._tempVector36,y=g.elements,v=r[_+1]*s,S=v+o;y[0]=i[S],y[1]=i[S+1],y[2]=i[S+2];var x=t._tempVector37,E=x.elements,T=r[_+2]*s,w=T+o;E[0]=i[w],E[1]=i[w+1],E[2]=i[w+2];var C=laya.d3.utils.Picker.rayIntersectsTriangle(e,d,g,x);!isNaN(C)&&C<l&&(l=C,h=p,c=v,u=T)}if(l!==Number.MAX_VALUE){a.distance=l,Pe.scale(e.direction,l,a.position),Pe.add(e.origin,a.position,a.position);var b=a.trianglePositions,M=b[0],I=b[1],D=b[2],A=M.elements,R=I.elements,L=D.elements,P=h+o;A[0]=i[P],A[1]=i[P+1],A[2]=i[P+2];var N=c+o;R[0]=i[N],R[1]=i[N+1],R[2]=i[N+2];var O=u+o;L[0]=i[O],L[1]=i[O+1],L[2]=i[O+2];var V=n.getVertexElementByUsage(3);if(V){var k=V.offset/4,F=a.triangleNormals,B=F[0],U=F[1],H=F[2],G=B.elements,W=U.elements,z=H.elements,Y=h+k;G[0]=i[Y],G[1]=i[Y+1],G[2]=i[Y+2];var X=c+k;W[0]=i[X],W[1]=i[X+1],W[2]=i[X+2];var j=u+k;z[0]=i[j],z[1]=i[j+1],z[2]=i[j+2]}return!0}return a.position.toDefault(),a.distance=Number.MAX_VALUE,a.trianglePositions[0].toDefault(),a.trianglePositions[1].toDefault(),a.trianglePositions[2].toDefault(),a.triangleNormals[0].toDefault(),a.triangleNormals[1].toDefault(),a.triangleNormals[2].toDefault(),!1},t.rayIntersectsTriangle=function(e,i,n,r){var a=t._tempVector30,s=t._tempVector31;Pe.subtract(n,i,a),Pe.subtract(r,i,s);var o,l=t._tempVector32;if(Pe.cross(e.direction,s,l),(o=Pe.dot(a,l))>-Number.MIN_VALUE&&o<Number.MIN_VALUE)return Number.NaN;var h,c=1/o,u=t._tempVector33;if(Pe.subtract(e.origin,i,u),h=Pe.dot(u,l),(h*=c)<0||h>1)return Number.NaN;var _,d,f=t._tempVector34;return Pe.cross(u,a,f),_=Pe.dot(e.direction,f),(_*=c)<0||h+_>1?Number.NaN:(d=Pe.dot(s,f),(d*=c)<0?Number.NaN:d)},n(t,["_tempVector30",function(){return this._tempVector30=new Pe},"_tempVector31",function(){return this._tempVector31=new Pe},"_tempVector32",function(){return this._tempVector32=new Pe},"_tempVector33",function(){return this._tempVector33=new Pe},"_tempVector34",function(){return this._tempVector34=new Pe},"_tempVector35",function(){return this._tempVector35=new Pe},"_tempVector36",function(){return this._tempVector36=new Pe},"_tempVector37",function(){return this._tempVector37=new Pe}]),t}(),Ke=function(){function t(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new Pe,new Pe,new Pe],this.trianglePositions.length=3,this.triangleNormals=[new Pe,new Pe,new Pe],this.triangleNormals.length=3,this.position=new Pe}return r(t,"laya.d3.utils.RaycastHit"),t.prototype.cloneTo=function(t){t.distance=this.distance,this.trianglePositions[0].cloneTo(t.trianglePositions[0]),this.trianglePositions[1].cloneTo(t.trianglePositions[1]),this.trianglePositions[2].cloneTo(t.trianglePositions[2]),this.triangleNormals[0].cloneTo(t.triangleNormals[0]),this.triangleNormals[1].cloneTo(t.triangleNormals[1]),this.triangleNormals[2].cloneTo(t.triangleNormals[2]),this.position.cloneTo(t.position),t.sprite3D=this.sprite3D},t}(),qe=function(){function t(t,e){this._width=0,this._height=0,this._width=t,this._height=e}r(t,"laya.d3.utils.Size");var e=t.prototype;return a(0,e,"width",function(){return-1===this._width?_t.clientWidth:this._width}),a(0,e,"height",function(){return-1===this._height?_t.clientHeight:this._height}),a(1,t,"fullScreen",function(){return new t(-1,-1)}),t}(),Ze=function(){function t(){}return r(t,"laya.d3.utils.Utils3D"),t._rotationTransformScaleSkinAnimation=function(e,i,n,r,a,s,o,l,h,c,u,_){var d,f,p,m,g,y=t._tempArray16_0,v=t._tempArray16_1,S=t._tempArray16_2,x=r+r,E=a+a,T=s+s,w=r*x,C=a*x,b=a*E,M=s*x,I=s*E,D=s*T,A=o*x,R=o*E,L=o*T;for(y[15]=1,y[0]=1-b-D,y[1]=C+L,y[2]=M-R,y[4]=C-L,y[5]=1-w-D,y[6]=I+A,y[8]=M+R,y[9]=I-A,y[10]=1-w-b,v[15]=1,v[0]=l,v[5]=h,v[10]=c,d=0;d<4;d++)f=y[d],p=y[d+4],m=y[d+8],g=y[d+12],S[d]=f,S[d+4]=p,S[d+8]=m,S[d+12]=f*e+p*i+m*n+g;for(d=0;d<4;d++)f=S[d],p=S[d+4],m=S[d+8],g=S[d+12],u[d+_]=f*v[0]+p*v[1]+m*v[2]+g*v[3],u[d+_+4]=f*v[4]+p*v[5]+m*v[6]+g*v[7],u[d+_+8]=f*v[8]+p*v[9]+m*v[10]+g*v[11],u[d+_+12]=f*v[12]+p*v[13]+m*v[14]+g*v[15]},t._createNodeByJson=function(e,i,n,r){if(!n)switch(i.type){case"Sprite3D":n=new Vi;break;case"MeshSprite3D":n=new gn;break;case"SkinnedMeshSprite3D":n=new vn;break;case"ShuriKenParticle3D":n=new yn;break;case"TrailSprite3D":n=new Sn;break;case"Terrain":n=new fn;break;case"Camera":n=new pn;break;case"DirectionLight":n=new mn;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var a=i.props;if(a)for(var s in a)n[s]=a[s];var o=i.customProps;o&&(n instanceof laya.d3.core.Sprite3D?(n._parseBaseCustomProps(o),n._parseCustomProps(e,r,o,i),n._parseCustomComponent(e,r,i.components)):n._parseCustomProps(e,r,o,i));var l=i.child;if(l)for(var h=0,c=l.length;h<c;h++){var u=t._createNodeByJson(e,l[h],null,r);n.addChild(u)}return n},t._computeBoneAndAnimationDatasByBindPoseMatrxix=function(t,e,i,n,r,a){var s,o,l=0,h=0,c=t.length;for(s=0;s<c;l+=t[s].keyframeWidth,h+=16,s++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[l+0],e[l+1],e[l+2],e[l+3],e[l+4],e[l+5],e[l+6],e[l+7],e[l+8],e[l+9],n,h),0!=s&&(o=16*t[s].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,o,n,h,n,h));var u=i.length;for(s=0;s<u;s++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,16*a[s],i[s],r,16*s)},t._computeAnimationDatasByArrayAndMatrixFast=function(t,e,i,n){for(var r=0,a=t.length;r<a;r++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,16*n[r],t[r],i,16*r)},t._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(t,e,i,n,r){var a,s,o=0,l=0,h=t.length;for(a=0;a<h;o+=t[a].keyframeWidth,l+=16,a++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[o+7],e[o+8],e[o+9],e[o+3],e[o+4],e[o+5],e[o+6],e[o+0],e[o+1],e[o+2],n,l),0!=a&&(s=16*t[a].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,s,n,l,n,l));var c=i.length;for(a=0;a<c;a++){var u=16*a;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,u,i[a],r,u)}},t._computeAnimationDatasByArrayAndMatrixFastOld=function(t,e,i){for(var n=t.length,r=0;r<n;r++){var a=16*r;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,a,t[r],i,a)}},t._computeRootAnimationData=function(t,e,i){for(var n=0,r=0,a=0,s=t.length;n<s;r+=t[n].keyframeWidth,a+=16,n++)laya.d3.utils.Utils3D.createAffineTransformationArray(e[r+0],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],i,a)},t.transformVector3ArrayByQuat=function(t,e,i,n,r){var a=i.elements,s=t[e],o=t[e+1],l=t[e+2],h=a[0],c=a[1],u=a[2],_=a[3],d=_*s+c*l-u*o,f=_*o+u*s-h*l,p=_*l+h*o-c*s,m=-h*s-c*o-u*l;n[r]=d*_+m*-h+f*-u-p*-c,n[r+1]=f*_+m*-c+p*-h-d*-u,n[r+2]=p*_+m*-u+d*-c-f*-h},t.mulMatrixByArray=function(e,i,n,r,a,s){var o,l,h,c,u;if(a===n){for(n=t._tempArray16_3,o=0;o<16;++o)n[o]=a[s+o];r=0}for(o=0;o<4;o++)l=e[i+o],h=e[i+o+4],c=e[i+o+8],u=e[i+o+12],a[s+o]=l*n[r+0]+h*n[r+1]+c*n[r+2]+u*n[r+3],a[s+o+4]=l*n[r+4]+h*n[r+5]+c*n[r+6]+u*n[r+7],a[s+o+8]=l*n[r+8]+h*n[r+9]+c*n[r+10]+u*n[r+11],a[s+o+12]=l*n[r+12]+h*n[r+13]+c*n[r+14]+u*n[r+15]},t.mulMatrixByArrayFast=function(t,e,i,n,r,a){var s,o,l,h,c;for(s=0;s<4;s++)o=t[e+s],l=t[e+s+4],h=t[e+s+8],c=t[e+s+12],r[a+s]=o*i[n+0]+l*i[n+1]+h*i[n+2]+c*i[n+3],r[a+s+4]=o*i[n+4]+l*i[n+5]+h*i[n+6]+c*i[n+7],r[a+s+8]=o*i[n+8]+l*i[n+9]+h*i[n+10]+c*i[n+11],r[a+s+12]=o*i[n+12]+l*i[n+13]+h*i[n+14]+c*i[n+15]},t.mulMatrixByArrayAndMatrixFast=function(t,e,i,n,r){var a,s,o,l,h,c=i.elements,u=c[0],_=c[1],d=c[2],f=c[3],p=c[4],m=c[5],g=c[6],y=c[7],v=c[8],S=c[9],x=c[10],E=c[11],T=c[12],w=c[13],C=c[14],b=c[15],M=e,I=e+4,D=e+8,A=e+12,R=r,L=r+4,P=r+8,N=r+12;for(a=0;a<4;a++)s=t[M+a],o=t[I+a],l=t[D+a],h=t[A+a],n[R+a]=s*u+o*_+l*d+h*f,n[L+a]=s*p+o*m+l*g+h*y,n[P+a]=s*v+o*S+l*x+h*E,n[N+a]=s*T+o*w+l*C+h*b},t.createAffineTransformationArray=function(t,e,i,n,r,a,s,o,l,h,c,u){var _=n+n,d=r+r,f=a+a,p=n*_,m=n*d,g=n*f,y=r*d,v=r*f,S=a*f,x=s*_,E=s*d,T=s*f;c[u+0]=(1-(y+S))*o,c[u+1]=(m+T)*o,c[u+2]=(g-E)*o,c[u+3]=0,c[u+4]=(m-T)*l,c[u+5]=(1-(p+S))*l,c[u+6]=(v+x)*l,c[u+7]=0,c[u+8]=(g+E)*h,c[u+9]=(v-x)*h,c[u+10]=(1-(p+y))*h,c[u+11]=0,c[u+12]=t,c[u+13]=e,c[u+14]=i,c[u+15]=1},t.transformVector3ArrayToVector3ArrayCoordinate=function(e,i,n,r,a){var s=t._tempArray4_0,o=e[i+0],l=e[i+1],h=e[i+2],c=n.elements;s[0]=o*c[0]+l*c[4]+h*c[8]+c[12],s[1]=o*c[1]+l*c[5]+h*c[9]+c[13],s[2]=o*c[2]+l*c[6]+h*c[10]+c[14],s[3]=1/(o*c[3]+l*c[7]+h*c[11]+c[15]),r[a+0]=s[0]*s[3],r[a+1]=s[1]*s[3],r[a+2]=s[2]*s[3]},t.transformLightingMapTexcoordByUV0Array=function(t,e,i,n,r){var a=i.elements;n[r+0]=t[e+0]*a[0]+a[2],n[r+1]=(t[e+1]-1)*a[1]+a[3]},t.transformLightingMapTexcoordByUV1Array=function(t,e,i,n,r){var a=i.elements;n[r+0]=t[e+0]*a[0]+a[2],n[r+1]=1+t[e+1]*a[1]+a[3]},t.getURLVerion=function(t){var e=t.indexOf("?");return e>=0?t.substr(e):null},t._quaternionCreateFromYawPitchRollArray=function(t,e,i,n){var r=.5*i,a=.5*e,s=.5*t,o=Math.sin(r),l=Math.cos(r),h=Math.sin(a),c=Math.cos(a),u=Math.sin(s),_=Math.cos(s);n[0]=_*h*l+u*c*o,n[1]=u*c*l-_*h*o,n[2]=_*c*o-u*h*l,n[3]=_*c*l+u*h*o},t._createAffineTransformationArray=function(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=e[3],l=r+r,h=a+a,c=s+s,u=r*l,_=r*h,d=r*c,f=a*h,p=a*c,m=s*c,g=o*l,y=o*h,v=o*c,S=i[0],x=i[1],E=i[2];n[0]=(1-(f+m))*S,n[1]=(_+v)*S,n[2]=(d-y)*S,n[3]=0,n[4]=(_-v)*x,n[5]=(1-(u+m))*x,n[6]=(p+g)*x,n[7]=0,n[8]=(d+y)*E,n[9]=(p-g)*E,n[10]=(1-(u+f))*E,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1},t._mulMatrixArray=function(t,e,i,n){var r,a,s,o,l,h=e.elements,c=h[0],u=h[1],_=h[2],d=h[3],f=h[4],p=h[5],m=h[6],g=h[7],y=h[8],v=h[9],S=h[10],x=h[11],E=h[12],T=h[13],w=h[14],C=h[15],b=n,M=n+4,I=n+8,D=n+12;for(r=0;r<4;r++)a=t[r],s=t[r+4],o=t[r+8],l=t[r+12],i[b+r]=a*c+s*u+o*_+l*d,i[M+r]=a*f+s*p+o*m+l*g,i[I+r]=a*y+s*v+o*S+l*x,i[D+r]=a*E+s*T+o*w+l*C},t.getYawPitchRoll=function(e,i){t.transformQuat(Pe.ForwardRH,e,De.TEMPVector31),t.transformQuat(Pe.Up,e,De.TEMPVector32);var n=De.TEMPVector32.elements;t.angleTo(Pe.ZERO,De.TEMPVector31,De.TEMPVector33);var r=De.TEMPVector33.elements;r[0]==Math.PI/2?(r[1]=t.arcTanAngle(n[2],n[0]),r[2]=0):r[0]==-Math.PI/2?(r[1]=t.arcTanAngle(-n[2],-n[0]),r[2]=0):(be.createRotationY(-r[1],De.TEMPMatrix0),be.createRotationX(-r[0],De.TEMPMatrix1),Pe.transformCoordinate(De.TEMPVector32,De.TEMPMatrix0,De.TEMPVector32),Pe.transformCoordinate(De.TEMPVector32,De.TEMPMatrix1,De.TEMPVector32),r[2]=t.arcTanAngle(n[1],-n[0])),r[1]<=-Math.PI&&(r[1]=Math.PI),r[2]<=-Math.PI&&(r[2]=Math.PI),r[1]>=Math.PI&&r[2]>=Math.PI&&(r[1]=0,r[2]=0,r[0]=Math.PI-r[0]),i[0]=r[1],i[1]=r[0],i[2]=r[2]},t.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:t>0?Math.atan(e/t):t<0?e>0?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},t.angleTo=function(e,i,n){Pe.subtract(i,e,De.TEMPVector30),Pe.normalize(De.TEMPVector30,De.TEMPVector30),n.elements[0]=Math.asin(De.TEMPVector30.y),n.elements[1]=t.arcTanAngle(-De.TEMPVector30.z,-De.TEMPVector30.x)},t.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,a=e,s=r[0],o=r[1],l=r[2],h=a[0],c=a[1],u=a[2],_=a[3],d=_*s+c*l-u*o,f=_*o+u*s-h*l,p=_*l+h*o-c*s,m=-h*s-c*o-u*l;n[0]=d*_+m*-h+f*-u-p*-c,n[1]=f*_+m*-c+p*-h-d*-u,n[2]=p*_+m*-u+d*-c-f*-h},t.quaterionNormalize=function(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=i*i+n*n+r*r+a*a;s>0&&(s=1/Math.sqrt(s),e[0]=i*s,e[1]=n*s,e[2]=r*s,e[3]=a*s)},t.matrix4x4MultiplyFFF=function(t,e,i){var n,r,a,s,o;if(i===e)for(e=new Float32Array(16),n=0;n<16;++n)e[n]=i[n];for(n=0;n<4;n++)r=t[n],a=t[n+4],s=t[n+8],o=t[n+12],i[n]=r*e[0]+a*e[1]+s*e[2]+o*e[3],i[n+4]=r*e[4]+a*e[5]+s*e[6]+o*e[7],i[n+8]=r*e[8]+a*e[9]+s*e[10]+o*e[11],i[n+12]=r*e[12]+a*e[13]+s*e[14]+o*e[15]},t.matrix4x4MultiplyMFM=function(e,i,n){t.matrix4x4MultiplyFFF(e.elements,i,n.elements)},t._tempVector3_0=new Pe,t._tempVector3_1=new Pe,t._tempVector3_2=new Pe,t._tempVector3_3=new Pe,t._tempVector3_4=new Pe,t._tempVector3_5=new Pe,t._tempVector3_6=new Pe,t._tempArray4_0=new Float32Array(4),t._tempArray16_0=new Float32Array(16),t._tempArray16_1=new Float32Array(16),t._tempArray16_2=new Float32Array(16),t._tempArray16_3=new Float32Array(16),n(t,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}}]),t}(),Qe=function(){function t(){}return r(t,"Laya3D"),t._cancelLoadByUrl=function(e){i.loader.cancelLoadByUrl(e),t._innerFirstLevelLoaderManager.cancelLoadByUrl(e),t._innerSecondLevelLoaderManager.cancelLoadByUrl(e),t._innerThirdLevelLoaderManager.cancelLoadByUrl(e),t._innerFourthLevelLoaderManager.cancelLoadByUrl(e)},t._changeWebGLSize=function(t,e){P.onStageResize(t,e),_t.clientWidth=t,_t.clientHeight=e},t.__init__=function(){var e=S.createMap;e.lh=[Vi,"SPRITE3DHIERARCHY"],e.ls=[Oi,"SPRITE3DHIERARCHY"],e.lm=[rn,"MESH"],e.lmat=[zi,"MATERIAL"],e.lpbr=[Hi,"MATERIAL"],e.ltc=[hn,"TEXTURECUBE"],e.jpg=[ln,"nativeimage"],e.jpeg=[ln,"nativeimage"],e.png=[ln,"nativeimage"],e.pkm=[ln,"arraybuffer"],e.lsani=[l,"arraybuffer"],e.lrani=[l,"arraybuffer"],e.raw=[en,"arraybuffer"],e.mipmaps=[en,"arraybuffer"],e.thdata=[vi,"arraybuffer"],e.lt=[Si,"TERRAIN"],e.lani=[fi,"arraybuffer"],e.lav=[pi,"json"],e.ani=[l,"arraybuffer"],v.parserMap.SPRITE3DHIERARCHY=t._loadHierarchy,v.parserMap.MESH=t._loadMesh,v.parserMap.MATERIAL=t._loadMaterial,v.parserMap.TEXTURECUBE=t._loadTextureCube,v.parserMap.TERRAIN=t._loadTerrain,t._innerFirstLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerSecondLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerThirdLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerFourthLevelLoaderManager.on("error",null,t._eventLoadManagerError)},t.READ_BLOCK=function(){return t._readData.pos+=4,!0},t.READ_DATA=function(){return t._DATA.offset=t._readData.getUint32(),t._DATA.size=t._readData.getUint32(),!0},t.READ_STRINGS=function(){var e=[],i={offset:0,size:0};i.offset=t._readData.getUint16(),i.size=t._readData.getUint16(),t._readData.pos,t._readData.pos=i.offset+t._DATA.offset;for(var n=0;n<i.size;n++){var r=t._readData.readUTFString();-1===r.lastIndexOf(".lmat")&&-1===r.lastIndexOf(".lpbr")||e.push(r)}return e},t.formatRelativePath=function(t,e){var i;if("."===e.charAt(0)){for(var n=(t+e).split("/"),r=0,a=n.length;r<a;r++)if(".."==n[r]){var s=r-1;s>0&&".."!==n[s]&&(n.splice(s,2),r-=2)}i=n.join("/")}else i=t+e;return null!=R.customFormat&&(i=R.customFormat(i,null)),i},t._eventLoadManagerError=function(t){i.loader.event("error",t)},t._addHierarchyInnerUrls=function(e,i,n,r,a,s){var o=t.formatRelativePath(r,a);n&&(o+=n),e.push({url:o,clas:s}),i[a]=o},t._getSprite3DHierarchyInnerUrls=function(e,i,n,r,a,s,o){var l,h=0,c=0;switch(e.type){case"Scene":var u=e.customProps.lightmaps;for(h=0,c=u.length;h<c;h++){var d=u[h].replace(".exr",".png");t._addHierarchyInnerUrls(r,a,s,o,d,ln)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var f;if(e.instanceParams)(f=e.instanceParams.loadPath)&&t._addHierarchyInnerUrls(i,a,s,o,f,rn);else{(f=(l=e.customProps).meshPath)&&t._addHierarchyInnerUrls(i,a,s,o,f,rn);var p=l.materials;if(p)for(h=0,c=p.length;h<c;h++){var m=p[h],g=m.type.split("."),y=_.window;if(g.forEach(function(t){y=y[t]}),"function"!=typeof y)throw"_getSprite3DHierarchyInnerUrls 错误: "+m.type+" 不是类";t._addHierarchyInnerUrls(n,a,s,o,m.path,y)}}break;case"ShuriKenParticle3D":var v=(l=e.customProps).meshPath;v&&t._addHierarchyInnerUrls(i,a,s,o,v,rn);var S=l.material;if(S)g=S.type.split("."),y=_.window,g.forEach(function(t){y=y[t]}),t._addHierarchyInnerUrls(n,a,s,o,S.path,y);else{var x=l.materialPath;if(x)t._addHierarchyInnerUrls(n,a,s,o,x,qi);else{var E=l.texturePath;E&&t._addHierarchyInnerUrls(r,a,s,o,E,ln)}}break;case"Terrain":t._addHierarchyInnerUrls(r,a,s,o,e.customProps.dataPath,Si)}var T=e.components;for(var w in T){var C=T[w];switch(w){case"Animator":var b=C.avatarPath;if(b)t._addHierarchyInnerUrls(r,a,s,o,b,pi);else{var M=C.avatar;M&&t._addHierarchyInnerUrls(r,a,s,o,M.path,pi)}var I=C.clipPaths;for(h=0,c=I.length;h<c;h++)t._addHierarchyInnerUrls(r,a,s,o,I[h],fi)}}var D=e.child;for(h=0,c=D.length;h<c;h++)t._getSprite3DHierarchyInnerUrls(D[h],i,n,r,a,s,o)},t._loadHierarchy=function(e){e.on("loaded",null,t._onHierarchylhLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onHierarchylhLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r=e.url,a=Ze.getURLVerion(r),s=R.getPath(r),o=[],l=[],h=[],c={};t._getSprite3DHierarchyInnerUrls(n,o,l,h,c,a,s);var u=o.length+l.length+h.length,_=u+1,d=1/_;if(t._onProcessChange(e,0,d,1),h.length>0){var f=u/_,p=y.create(null,t._onProcessChange,[e,d,f],!1);t._innerFourthLevelLoaderManager.create(h,y.create(null,t._onHierarchyInnerForthLevResouLoaded,[e,i,p,n,c,o,l,d+f*h.length,f]),p,null,null,1,!0,i)}else t._onHierarchyInnerForthLevResouLoaded(e,i,null,n,c,o,l,d,f)}},t._onHierarchyInnerForthLevResouLoaded=function(e,i,n,r,a,s,o,l,h){if(e._class.destroyed)e.endLoad();else if(n&&n.recover(),o.length>0){var c=y.create(null,t._onProcessChange,[e,l,h],!1);t._innerSecondLevelLoaderManager.create(o,y.create(null,t._onHierarchyInnerSecondLevResouLoaded,[e,i,c,r,a,s,l+h*o.length,h]),n,null,null,1,!0,i)}else t._onHierarchyInnerSecondLevResouLoaded(e,i,null,r,a,s,l,h)},t._onHierarchyInnerSecondLevResouLoaded=function(e,i,n,r,a,s,o,l){if(e._class.destroyed)e.endLoad();else if(n&&n.recover(),s.length>0){var h=y.create(null,t._onProcessChange,[e,o,l],!1);t._innerFirstLevelLoaderManager.create(s,y.create(null,t._onHierarchyInnerFirstLevResouLoaded,[e,h,r,a]),n,null,null,1,!0,i)}else t._onHierarchyInnerFirstLevResouLoaded(e,null,r,a)},t._onHierarchyInnerFirstLevResouLoaded=function(t,e,i,n){e&&e.recover(),t.endLoad([i,n])},t._loadTerrain=function(e){e.on("loaded",null,t._onTerrainLtLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onTerrainLtLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,a,s=e.url,o=Ze.getURLVerion(s),l=R.getPath(s),h=[],c={},u=0,_=0,d=n.heightData;r=d.url,a=t.formatRelativePath(l,r),o&&(a+=o),c[r]=a,r=a;var f=n.detailTexture;for(u=0,_=f.length;u<_;u++)h.push({url:f[u].diffuse});var p=n.normalMap;for(u=0,_=p.length;u<_;u++)h.push({url:p[u]});var m=n.alphaMap;for(u=0,_=m.length;u<_;u++)h.push({url:m[u],params:[!1,!1,6408,!0]});for(u=0,_=h.length;u<_;u++){var g=h[u].url;a=t.formatRelativePath(l,g),o&&(a+=o),h[u].url=a,c[g]=a}var v=h.length,S=v+2,x=1/S;t._onProcessChange(e,0,x,1);var E={heightMapLoaded:!1,texturesLoaded:!1},T=y.create(null,t._onProcessChange,[e,x,x],!1);t._innerFourthLevelLoaderManager.create(r,y.create(null,t._onTerrainHeightMapLoaded,[e,T,n,c,E]),T,null,[d.numX,d.numZ,d.bitType,d.value],1,!0,i);var w=y.create(null,t._onProcessChange,[e,2*x,v/S],!1);t._innerFourthLevelLoaderManager.create(h,y.create(null,t._onTerrainTexturesLoaded,[e,w,n,c,E]),w,null,null,1,!0,i)}},t._onTerrainHeightMapLoaded=function(t,e,i,n,r){r.heightMapLoaded=!0,r.texturesLoaded&&(t.endLoad([i,n]),e.recover())},t._onTerrainTexturesLoaded=function(t,e,i,n,r){r.texturesLoaded=!0,r.heightMapLoaded&&(t.endLoad([i,n]),e.recover())},t._loadMesh=function(e){e.on("loaded",null,t._onMeshLmLoaded,[e,e._class._getGroup()]),e.load(e.url,"arraybuffer",!1,null,!0)},t._onMeshLmLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,a,s,o=e.url,l=Ze.getURLVerion(o),h=R.getPath(o),c={},u=0,_=0;switch((t._readData=new f(n)).pos=0,t._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var d=t._readData.getUint32();t._readData.pos=t._readData.pos+4,_=t._readData.getUint16(),t._readData.pos=t._readData.pos+8*_;var p=t._readData.getUint32();for(_=t._readData.getUint16(),t._readData.pos=d+p,r=[],u=0;u<_;u++){var m=t._readData.readUTFString();-1!==m.lastIndexOf(".lmat")&&r.push(m)}break;default:for(t.READ_BLOCK(),u=0;u<2;u++){var g=t._readData.getUint16(),v=t._strings[g],S=t["READ_"+v];if(null==S)throw new Error("model file err,no this function:"+g+" "+v);1===u?r=S.call():S.call()}}for(u=0,s=r.length;u<s;u++){var x=r[u];a=t.formatRelativePath(h,x),l&&(a+=l),r[u]=a,c[x]=a}if(r.length>0){t._onProcessChange(e,0,.5,1);var E=y.create(null,t._onProcessChange,[e,.5,.5],!1);t._innerSecondLevelLoaderManager.create(r,y.create(null,t._onMeshMateialLoaded,[e,E,n,c]),E,null,null,1,!0,i)}else e.endLoad([n,c])}},t._onMeshMateialLoaded=function(t,e,i,n){t.endLoad([i,n]),e.recover()},t._getMaterialTexturePath=function(e,i,n){var r=e.length-4;return e.indexOf(".dds")!=r&&e.indexOf(".tga")!=r&&e.indexOf(".exr")!=r&&e.indexOf(".DDS")!=r&&e.indexOf(".TGA")!=r&&e.indexOf(".EXR")!=r||(e=e.substr(0,r)+".png"),e=t.formatRelativePath(n,e),i&&(e+=i),e},t._loadMaterial=function(e){e.on("loaded",null,t._onMaterilLmatLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onMaterilLmatLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,a=e.url,s=Ze.getURLVerion(a),o=R.getPath(a),l=[],h={},c=n.customProps,u=n.version;if(u)switch(u){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var _=n.props.textures,d=0,f=_.length;d<f;d++){var p=_[d],m=p.path;if(m){var g=m.length-4;m.indexOf(".exr")!=g&&m.indexOf(".EXR")!=g||(m=m.substr(0,g)+".png"),r=t.formatRelativePath(o,m),s&&(r+=s),l.push({url:r,params:p.params}),h[m]=r}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var v=c.diffuseTexture.texture2D;if(v&&(r=t._getMaterialTexturePath(v,s,o),l.push(r),h[v]=r),c.normalTexture){var S=c.normalTexture.texture2D;S&&(r=t._getMaterialTexturePath(S,s,o),l.push(r),h[S]=r)}if(c.specularTexture){var x=c.specularTexture.texture2D;x&&(r=t._getMaterialTexturePath(x,s,o),l.push(r),h[x]=r)}if(c.emissiveTexture){var E=c.emissiveTexture.texture2D;E&&(r=t._getMaterialTexturePath(E,s,o),l.push(r),h[E]=r)}if(c.ambientTexture){var T=c.ambientTexture.texture2D;T&&(r=t._getMaterialTexturePath(T,s,o),l.push(r),h[T]=r)}if(c.reflectTexture){var w=c.reflectTexture.texture2D;w&&(r=t._getMaterialTexturePath(w,s,o),l.push(r),h[w]=r)}}var C=l.length,b=C+1,M=1/b;if(t._onProcessChange(e,0,M,1),C>0){var I=y.create(null,t._onProcessChange,[e,M,C/b],!1);t._innerFourthLevelLoaderManager.create(l,y.create(null,t._onMateialTexturesLoaded,[e,I,n,h]),I,ln,null,1,!0,i)}else t._onMateialTexturesLoaded(e,null,n,null)}},t._onMateialTexturesLoaded=function(t,e,i,n){t.endLoad([i,n]),e&&e.recover()},t._loadTextureCube=function(e){e.on("loaded",null,t._onTextureCubeLtcLoaded,[e]),e.load(e.url,"json",!1,null,!0)},t._onTextureCubeLtcLoaded=function(e,i){if(e._class.destroyed)e.endLoad();else{var n=R.getPath(e.url),r=[t.formatRelativePath(n,i.px),t.formatRelativePath(n,i.nx),t.formatRelativePath(n,i.py),t.formatRelativePath(n,i.ny),t.formatRelativePath(n,i.pz),t.formatRelativePath(n,i.nz)];t._onProcessChange(e,0,1/7,1);var a=y.create(null,t._onProcessChange,[e,1/7,6/7],!1);t._innerFourthLevelLoaderManager.load(r,y.create(null,t._onTextureCubeImagesLoaded,[e,r,a]),a,"nativeimage")}},t._onTextureCubeImagesLoaded=function(t,e,i){var n=[];n.length=6;for(var r=0;r<6;r++){var a=e[r];n[r]=v.getRes(a),v.clearRes(a)}t.endLoad(n),i.recover()},t._onProcessChange=function(t,e,i,n){(n=e+n*i)<1&&t.event("progress",n)},t.init=function(e,n,r,a,s,o){void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===s&&(s=!0),void 0===o&&(o=!0),b.update3DLoop=function(){ni._triggerCollision()},b.cancelLoadByUrl=function(e){t._cancelLoadByUrl(e)},m.isAntialias=r,m.isAlpha=a,m.premultipliedAlpha=s,m.isStencil=o,P.enable()?(b.changeWebGLSize=t._changeWebGLSize,T.is3DMode=!0,i.init(e,n),W.__init__(),Xe.__init__(),Bi.__init__(),Be.__init__(),gn.__init__(),F.__init__(),t.__init__(),c.maxTextureCount=2,(t.debugMode||dt.debugMode)&&(t._debugPhasorSprite=new ht)):alert("Laya3D init error,must support webGL!")},t.HIERARCHY="SPRITE3DHIERARCHY",t.MESH="MESH",t.MATERIAL="MATERIAL",t.PBRMATERIAL="PBRMTL",t.TEXTURECUBE="TEXTURECUBE",t.TERRAIN="TERRAIN",t._readData=null,t._debugPhasorSprite=null,t.debugMode=!1,n(t,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new S},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new S},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new S},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new S}]),t}(),$e=function(t){function e(t){e.__super.call(this),this._owner=t,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}r(e,"laya.d3.animation.AnimationTransform3D",g);var i=e.prototype;return i._getlocalMatrix=function(){return this._localUpdate&&(Ze._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},i._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldTransform()}},i._setWorldMatrixAndUpdate=function(t){if(this._worldMatrix=t,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var e=this._getlocalMatrix(),i=0;i<16;++i)this._worldMatrix[i]=e[i];else Ze.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},i._setWorldMatrixNoUpdate=function(t){this._worldMatrix=t},i._setWorldMatrixIgnoreUpdate=function(t){this._worldMatrix=t,this._worldUpdate=!1},i.getLocalPosition=function(){return this._localPosition},i.setLocalPosition=function(t){if(this._parent)this._localPosition=t,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localPosition,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localPosition=i}},i.getLocalRotation=function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler;Ze._quaternionCreateFromYawPitchRollArray(t[1]/e._angleToRandin,t[0]/e._angleToRandin,t[2]/e._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},i.setLocalRotation=function(t){if(this._parent)this._localRotation=t,Ze.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localRotation,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],e.localRotation=i}},i.getLocalScale=function(){return this._localScale},i.setLocalScale=function(t){if(this._parent)this._localScale=t,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localScale,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localScale=i}},i.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){Ze.getYawPitchRoll(this._localRotation,e._tempVector3);var t=e._tempVector3,i=this._localRotationEuler;i[0]=t[1]*e._angleToRandin,i[1]=t[0]*e._angleToRandin,i[2]=t[2]*e._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},i.setLocalRotationEuler=function(t){if(this._parent)Ze._quaternionCreateFromYawPitchRollArray(t[1]/e._angleToRandin,t[0]/e._angleToRandin,t[2]/e._angleToRandin,this._localRotation),this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var i=this._entity.owner._transform,n=this._entity.localRotationEuler,r=n.elements;r[0]=t[0],r[1]=t[1],r[2]=t[2],i.localRotationEuler=n}},i.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)Ze.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var t=this._getlocalMatrix(),e=0;e<16;++e)this._worldMatrix[e]=t[e];this._worldUpdate=!1}return this._worldMatrix},i.setParent=function(t){if(this._parent!==t){if(this._parent){var e=this._parent._childs,i=e.indexOf(this);e.splice(i,1)}t&&(t._childs.push(this),t&&this._onWorldTransform()),this._parent=t}},n(e,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),e}(),Je=function(t){function e(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,e.__super.call(this),this._destroyed=!1,this._id=e._uniqueIDCounter,e._uniqueIDCounter++}r(e,"laya.d3.component.Component3D",g);var n=e.prototype;return i.imps(n,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),n._initialize=function(t){this._owner=t,this._enable=!0,this.started=!1,this._load(t)},n._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},n._load=function(t){},n._start=function(t){},n._update=function(t){},n._lateUpdate=function(t){},n._preRenderUpdate=function(t){},n._postRenderUpdate=function(t){},n._unload=function(t){this.offAll()},n._cloneTo=function(t){},a(0,n,"id",function(){return this._id}),a(0,n,"destroyed",function(){return this._destroyed}),a(0,n,"owner",function(){return this._owner}),a(0,n,"enable",function(){return this._enable},function(t){this._enable!==t&&(this._enable=t,this.event("enablechanged",this._enable))}),a(0,n,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!0,e._uniqueIDCounter=1,e}(),ti=function(t){function e(){this._destroyed=!1,e.__super.call(this),this._destroyed=!1}r(e,"laya.d3.core.GeometryFilter",g);var n=e.prototype;return i.imps(n,{"laya.resource.IDestroy":!0}),n._destroy=function(){this.offAll(),this._destroyed=!0},a(0,n,"_isAsyncLoaded",function(){return!0}),a(0,n,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),a(0,n,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),a(0,n,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),a(0,n,"destroyed",function(){return this._destroyed}),e}(),ei=function(t){function e(t){e.__super.call(this),this._id=++e._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new Se(new Pe,new Pe),this._boundingBoxCenter=new Pe,this._boundingSphere=new Ee(new Pe,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=t,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}r(e,"laya.d3.core.render.BaseRender",g);var s=e.prototype;return i.imps(s,{"laya.resource.IDestroy":!0}),s._changeMaterialReference=function(t,e){t&&t._removeReference(),e._addReference()},s._getInstanceMaterial=function(t,e){var i=new t.constructor;return t.cloneTo(i),i.name=i.name+"(Instance)",this._materialsInstance[e]=!0,this._changeMaterialReference(this._materials[e],i),this._materials[e]=i,i},s._setShaderValuelightMap=function(t){this._setShaderValueTexture(3,t)},s._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},s._renderRenderableBoundBox=function(){var t=Qe._debugPhasorSprite,i=this.boundingBox,n=e._tempBoundBoxCorners;i.getCorners(n),t.line(n[0],e._greenColor,n[1],e._greenColor),t.line(n[2],e._greenColor,n[3],e._greenColor),t.line(n[4],e._greenColor,n[5],e._greenColor),t.line(n[6],e._greenColor,n[7],e._greenColor),t.line(n[0],e._greenColor,n[3],e._greenColor),t.line(n[1],e._greenColor,n[2],e._greenColor),t.line(n[2],e._greenColor,n[6],e._greenColor),t.line(n[3],e._greenColor,n[7],e._greenColor),t.line(n[0],e._greenColor,n[4],e._greenColor),t.line(n[1],e._greenColor,n[5],e._greenColor),t.line(n[4],e._greenColor,n[7],e._greenColor),t.line(n[5],e._greenColor,n[6],e._greenColor)},s._calculateBoundingSphere=function(){throw"BaseRender: must override it."},s._calculateBoundingBox=function(){throw"BaseRender: must override it."},s._setShaderValueTexture=function(t,e){this._owner._shaderValues.setValue(t,e)},s._setShaderValueMatrix4x4=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},s._setShaderValueColor=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},s._setShaderValueBuffer=function(t,e){this._owner._shaderValues.setValue(t,e)},s._setShaderValueInt=function(t,e){this._owner._shaderValues.setValue(t,e)},s._setShaderValueBool=function(t,e){this._owner._shaderValues.setValue(t,e)},s._setShaderValueNumber=function(t,e){this._owner._shaderValues.setValue(t,e)},s._setShaderValueVector2=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},s._addShaderDefine=function(t){this._owner._shaderDefineValue|=t},s._removeShaderDefine=function(t){this._owner._shaderDefineValue&=~t},s._renderUpdate=function(t){return!0},s._applyLightMapParams=function(){if(this._lightmapIndex>=0){var t=this._owner.scene;if(t){var e=t.getlightmaps()[this._lightmapIndex];e?(this._addShaderDefine(_n.SAHDERDEFINE_LIGHTMAP),e.loaded?this._setShaderValuelightMap(e):e.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(_n.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(_n.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(_n.SAHDERDEFINE_LIGHTMAP)},s._updateOctreeNode=function(){var t=this._treeNode;t&&this._octreeNodeNeedChange&&(t.updateObject(this),this._octreeNodeNeedChange=!1)},s._destroy=function(){this.offAll();var t=0,e=0;for(t=0,e=this._renderElements.length;t<e;t++)this._renderElements[t]._destroy();for(t=0,e=this._materials.length;t<e;t++)this._materials[t]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},a(0,s,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),a(0,s,"id",function(){return this._id}),a(0,s,"material",function(){var t=this._materials[0];if(t&&!this._materialsInstance[0]){var e=this._getInstanceMaterial(t,0);this.event("materialchanged",[this,0,e])}return this._materials[0]},function(t){this.sharedMaterial=t}),a(0,s,"sharedMaterial",function(){return this._materials[0]},function(t){var e=this._materials[0];e!==t&&(this._materials[0]=t,this._materialsInstance[0]=!1,this._changeMaterialReference(e,t),this.event("materialchanged",[this,0,t]))}),a(0,s,"lightmapIndex",function(){return this._lightmapIndex},function(t){this._lightmapIndex=t,this._applyLightMapParams()}),a(0,s,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(t){this._lightmapScaleOffset=t,this._setShaderValueColor(2,t),this._addShaderDefine(_n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),a(0,s,"enable",function(){return this._enable},function(t){this._enable=t,this.event("enablechanged",[this,t])}),a(0,s,"materials",function(){for(var t=0,e=this._materials.length;t<e;t++)if(!this._materialsInstance[t]){var i=this._getInstanceMaterial(this._materials[t],t);this.event("materialchanged",[this,t,i])}return this._materials.slice()},function(t){this.sharedMaterials=t}),a(0,s,"sharedMaterials",function(){return this._materials.slice()},function(t){if(!t)throw new Error("MeshRender: shadredMaterials value can't be null.");var e=t.length;this._materialsInstance.length=e;for(var i=0;i<e;i++){var n=this._materials[i];n!==t[i]&&(this._materialsInstance[i]=!1,this._changeMaterialReference(n,t[i]),this.event("materialchanged",[this,i,t[i]]))}this._materials=t}),a(0,s,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),a(0,s,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var t=this.boundingBox;Pe.add(t.min,t.max,this._boundingBoxCenter),Pe.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),a(0,s,"receiveShadow",function(){return this._receiveShadow},function(t){this._receiveShadow!==t&&(this._receiveShadow=t,t?this._addShaderDefine(He.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(He.SHADERDEFINE_RECEIVE_SHADOW))}),a(0,s,"destroyed",function(){return this._destroyed}),e._uniqueIDCounter=0,n(e,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe]},"_greenColor",function(){return this._greenColor=new Ne(0,1,0,1)}]),e}(),ii=function(t){function e(t){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,e.__super.call(this),this._localPosition=new Pe,this._localRotation=new De(0,0,0,1),this._localScale=new Pe(1,1,1),this._localRotationEuler=new Pe,this._localMatrix=new be,this._position=new Pe,this._rotation=new De(0,0,0,1),this._scale=new Pe(1,1,1),this._worldMatrix=new be,this._forward=new Pe,this._up=new Pe,this._right=new Pe,this._owner=t,this._childs=[]}r(e,"laya.d3.core.Transform3D",g);var i=e.prototype;return i._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)be.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var t=e._tempVector30;Pe.multiply(this.pivot,this._localScale,t);var i=e._tempVector31;Pe.subtract(t,this.pivot,i);var n=e._tempVector32,r=this.localRotation;Pe.transformQuat(t,r,n),Pe.subtract(n,t,n);var a=e._tempVector33;Pe.subtract(this._localPosition,i,a),Pe.subtract(a,n,a),be.createAffineTransformation(a,r,this._localScale,this._localMatrix)}},i._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionRotationTransform()}},i._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionScaleTransform()}},i._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionTransform()}},i._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionRotationTransform()}},i._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionScaleTransform()}},i._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldTransform()}},i.translate=function(t,i){void 0===i&&(i=!0),i?(be.createFromQuaternion(this.localRotation,e._tempMatrix0),Pe.transformCoordinate(t,e._tempMatrix0,e._tempVector30),Pe.add(this.localPosition,e._tempVector30,this._localPosition),this.localPosition=this._localPosition):(Pe.add(this.position,t,this._position),this.position=this._position)},i.rotate=function(t,i,n){var r;void 0===i&&(i=!0),void 0===n&&(n=!0),n?r=t:(Pe.scale(t,Math.PI/180,e._tempVector30),r=e._tempVector30),De.createFromYawPitchRoll(r.y,r.x,r.z,e._tempQuaternion0),i?(De.multiply(this._localRotation,e._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(De.multiply(e._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},i.lookAt=function(t,e,i){void 0===i&&(i=!1);var n,r=t.elements;if(i){if(n=this._localPosition.elements,Math.abs(n[0]-r[0])<we.zeroTolerance&&Math.abs(n[1]-r[1])<we.zeroTolerance&&Math.abs(n[2]-r[2])<we.zeroTolerance)return;De.lookAt(this._localPosition,t,e,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var a=this.position;if(n=a.elements,Math.abs(n[0]-r[0])<we.zeroTolerance&&Math.abs(n[1]-r[1])<we.zeroTolerance&&Math.abs(n[2]-r[2])<we.zeroTolerance)return;De.lookAt(a,t,e,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},a(0,i,"_isFrontFaceInvert",function(){var t=this.scale,e=t.x<0;return t.y<0&&(e=!e),t.z<0&&(e=!e),e}),a(0,i,"owner",function(){return this._owner}),a(0,i,"localRotation",function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler.elements;De.createFromYawPitchRoll(t[1]/e._angleToRandin,t[0]/e._angleToRandin,t[2]/e._angleToRandin,this._localRotation)}return this._localRotation},function(t){this._localRotation=t,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),a(0,i,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?be.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(t){null===this._parent?t.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),be.multiply(this._localMatrix,t,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=t,this._worldUpdate=!1}),a(0,i,"worldNeedUpdate",function(){return this._worldUpdate}),a(0,i,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(t){this._localMatrix=t,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),a(0,i,"dummy",function(){return this._dummy},function(t){this._dummy!==t&&(this._dummy&&(this._dummy._entity=null),t&&(t._entity=this),this._dummy=t)}),a(0,i,"localPosition",function(){return this._localPosition},function(t){this._localPosition=t,this._localUpdate=!0,this._onWorldPositionTransform()}),a(0,i,"position",function(){if(this._positionUpdate){if(null!=this._parent){var t=this._parent.position;Pe.multiply(this._localPosition,this._parent.scale,e._tempVector30),Pe.transformQuat(e._tempVector30,this._parent.rotation,e._tempVector30),Pe.add(t,e._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(t){if(null!=this._parent){Pe.subtract(t,this._parent.position,this._localPosition);var i=this._parent.scale.elements,n=i[0],r=i[1],a=i[2];if(1!==n||1!==r||1!==a){var s=e._tempVector30,o=s.elements;o[0]=1/n,o[1]=1/r,o[2]=1/a,Pe.multiply(this._localPosition,s,this._localPosition)}this._parent.rotation.invert(e._tempQuaternion0),Pe.transformQuat(this._localPosition,e._tempQuaternion0,this._localPosition)}else t.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=t,this._positionUpdate=!1}),a(0,i,"localScale",function(){return this._localScale},function(t){this._localScale=t,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),a(0,i,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(e._tempVector30);var t=e._tempVector30.elements,i=this._localRotationEuler.elements;i[0]=t[1]*e._angleToRandin,i[1]=t[0]*e._angleToRandin,i[2]=t[2]*e._angleToRandin}return this._localRotationEuler},function(t){this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),a(0,i,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?De.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(t){null!=this._parent?(this._parent.rotation.invert(e._tempQuaternion0),De.multiply(t,e._tempQuaternion0,this._localRotation)):t.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=t,this._rotationUpdate=!1}),a(0,i,"scale",function(){return this._scaleUpdate?(null!==this._parent?Pe.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1,this._scale):this._scale},function(t){if(null!==this._parent){var i=this._parent.scale.elements,n=e._tempVector30.elements;n[0]=1/i[0],n[1]=1/i[1],n[2]=1/i[2],Pe.multiply(t,e._tempVector30,this._localScale)}else t.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=t,this._scaleUpdate=!1}),a(0,i,"rotationEuler",null,function(t){De.createFromYawPitchRoll(t.y,t.x,t.z,this._rotation),this.rotation=this._rotation}),a(0,i,"forward",function(){var t=this.worldMatrix.elements;return this._forward.elements[0]=-t[8],this._forward.elements[1]=-t[9],this._forward.elements[2]=-t[10],this._forward}),a(0,i,"up",function(){var t=this.worldMatrix.elements;return this._up.elements[0]=t[4],this._up.elements[1]=t[5],this._up.elements[2]=t[6],this._up}),a(0,i,"right",function(){var t=this.worldMatrix.elements;return this._right.elements[0]=t[0],this._right.elements[1]=t[1],this._right.elements[2]=t[2],this._right}),a(0,i,"parent",function(){return this._parent},function(t){if(this._parent!==t){if(this._parent){var e=this._parent._childs,i=e.indexOf(this);e.splice(i,1)}t&&(t._childs.push(this),t&&this._onWorldTransform()),this._parent=t}}),n(e,["_tempVector30",function(){return this._tempVector30=new Pe},"_tempVector31",function(){return this._tempVector31=new Pe},"_tempVector32",function(){return this._tempVector32=new Pe},"_tempVector33",function(){return this._tempVector33=new Pe},"_tempQuaternion0",function(){return this._tempQuaternion0=new De},"_tempMatrix0",function(){return this._tempMatrix0=new be},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),e}(),ni=(function(t){function e(){this._rotation=0,this._matNeedUpdte=!1,e.__super.call(this),this._matrix=new be,this._offset=new Le,this._tiling=new Le(1,1)}r(e,"laya.d3.core.TransformUV",g);var s=e.prototype;i.imps(s,{"laya.d3.core.IClone":!0}),s._updateMatrix=function(){e._tempOffsetV3.elements[0]=this._offset.x,e._tempOffsetV3.elements[1]=this._offset.y,De.createFromYawPitchRoll(0,0,this._rotation,e._tempRotationQua),e._tempTitlingV3.elements[0]=this._tiling.x,e._tempTitlingV3.elements[1]=this._tiling.y,be.createAffineTransformation(e._tempOffsetV3,e._tempRotationQua,e._tempTitlingV3,this._matrix)},s.cloneTo=function(t){t._matrix=this._matrix.clone(),t._offset=this._offset.clone(),t._rotation=this._rotation,t._tiling=this._tiling.clone()},s.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,s,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),a(0,s,"tiling",function(){return this._tiling},function(t){this._tiling=t,this._matNeedUpdte=!0}),a(0,s,"offset",function(){return this._offset},function(t){this._offset=t,this._matNeedUpdte=!0}),a(0,s,"rotation",function(){return this._rotation},function(t){this._rotation=t,this._matNeedUpdte=!0}),n(e,["_tempOffsetV3",function(){return this._tempOffsetV3=new Pe(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new De},"_tempTitlingV3",function(){return this._tempTitlingV3=new Pe(1,1,1)}])}(),function(t){function e(){e.__super.call(this)}return r(e,"laya.d3.utils.CollisionManager",g),e._onTrigger=function(t,e,i,n,r){var a=0,s=0,o=t.id,l=e.id;if(!t._ignoreCollisonMap[l]){var h=Xe.collisionManager,c=t._runtimeCollisonTestMap[l];if(null!=c)if(c)if(t._collisonTo(e))if(t._runtimeCollisonMap[l]){for(a=0,s=i.length;a<s;a++)i[a].onTriggerStay(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerStay(t);h.event("triggerstay",[t,e])}else{for(t._runtimeCollisonMap[l]=e,t._runtimeCollisonTestMap[l]=!1,e._runtimeCollisonMap[o]=t,r&&(e._runtimeCollisonTestMap[o]=!1),a=0,s=i.length;a<s;a++)i[a].onTriggerEnter(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerEnter(t);h.event("triggerenter",[t,e])}else{var u=t._runtimeCollisonMap;if(u[l]){for(delete u[l],delete t._runtimeCollisonTestMap[l],delete e._runtimeCollisonMap[o],r&&delete e._runtimeCollisonTestMap[o],a=0,s=i.length;a<s;a++)i[a].onTriggerExit(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerExit(t);h.event("triggerexit",[t,e])}}else{for(a=0,s=i.length;a<s;a++)i[a].onTriggerStay(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerStay(t);h.event("triggerstay",[t,e])}else if(t._collisonTo(e)){for(t._runtimeCollisonMap[l]=e,t._runtimeCollisonTestMap[l]=!1,e._runtimeCollisonMap[o]=t,r&&(e._runtimeCollisonTestMap[o]=!1),a=0,s=i.length;a<s;a++)i[a].onTriggerEnter(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerEnter(t);h.event("triggerenter",[t,e])}}},e._triggerCollision=function(){for(var t=W._collsionTestList,i=t.length,n=Xe._layerCollsionMatrix,r=0;r<i;r++)for(var a=t[r],s=W.getLayerByNumber(a),o=s._colliders,l=s._nonRigidbodyOffset,h=i-1;h>=r;h--){var c=t[h];if(n[a][30-c]){var u,_,d,f=0,p=0,m=0,g=0,y=W.getLayerByNumber(c),v=y._colliders,S=y._nonRigidbodyOffset;if(s!==y){for(f=0;f<l;f++)if((u=o[f]).enable){for(d=u.owner._scripts,m=0,g=S;m<g;m++)(_=v[m]).enable&&e._onTrigger(u,_,d,_.owner._scripts,!0);for(m=S,g=v.length;m<g;m++)(_=v[m]).enable&&e._onTrigger(u,_,d,_.owner._scripts,!1)}for(f=l,p=o.length;f<p;f++)if((u=o[f]).enable)for(d=u.owner._scripts,m=0,g=y._nonRigidbodyOffset;m<g;m++)(_=v[m]).enable&&e._onTrigger(_,u,d,_.owner._scripts,!1)}else for(f=0;f<l;f++)if((u=o[f]).enable){for(d=u.owner._scripts,m=f+1,g=l;m<g;m++)(_=v[m]).enable&&e._onTrigger(u,_,d,_.owner._scripts,!0);for(m=l,g=o.length;m<g;m++)(_=v[m]).enable&&e._onTrigger(u,_,d,_.owner._scripts,!1)}}}},e}()),ri=(function(t){function e(){e.__super.call(this)}r(e,"laya.d3.core.glitter.SplineCurvePosition",t);var i=e.prototype;i._CalcVelocity=function(t,e,i){Pe.subtract(t,e,i),Pe.scale(i,.5,i)},i.Init=function(e,i,n,r){this._CalcVelocity(i,e,this._tempVector30),this._CalcVelocity(r,n,this._tempVector31),t.prototype.Init.call(this,i,this._tempVector30,r,this._tempVector31)}}(H),function(t){function e(){this.x=NaN,this.y=NaN,this.z=NaN,e.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.BoxShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=.5*-this.x,e[1]=.5*-this.y,e[2]=.5*-this.z;var i=t.max.elements;i[0]=.5*this.x,i[1]=.5*this.y,i[2]=.5*this.z},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=0,e[1]=0,e[2]=0;var i=t.max.elements;i[0]=0,i[1]=1,i[2]=0},i.generatePositionAndDirection=function(t,e,i,n){var r=t.elements,a=e.elements;i?(i.seed=n[16],nt._randomPointInsideHalfUnitBox(t,i),n[16]=i.seed):nt._randomPointInsideHalfUnitBox(t),r[0]=this.x*r[0],r[1]=this.y*r[1],r[2]=this.z*r[2],this.randomDirection?i?(i.seed=n[17],nt._randomPointUnitSphere(e,i),n[17]=i.seed):nt._randomPointUnitSphere(e):(a[0]=0,a[1]=0,a[2]=1)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.x=this.x,i.y=this.y,i.z=this.z,i.randomDirection=this.randomDirection},e}(it)),ai=function(t){function e(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,e.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.CircleShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[2]=-this.radius,e[1]=0;var i=t.max.elements;i[0]=i[2]=this.radius,i[1]=0},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=1,i[2]=0},i.generatePositionAndDirection=function(t,i,n,r){var a=t.elements,s=e._tempPositionPoint.elements;n?(n.seed=r[16],this.emitFromEdge?nt._randomPointUnitArcCircle(this.arc,e._tempPositionPoint,n):nt._randomPointInsideUnitArcCircle(this.arc,e._tempPositionPoint,n),r[16]=n.seed):this.emitFromEdge?nt._randomPointUnitArcCircle(this.arc,e._tempPositionPoint):nt._randomPointInsideUnitArcCircle(this.arc,e._tempPositionPoint),a[0]=-s[0],a[1]=s[1],a[2]=0,Pe.scale(t,this.radius,t),this.randomDirection?n?(n.seed=r[17],nt._randomPointUnitSphere(i,n),r[17]=n.seed):nt._randomPointUnitSphere(i):t.cloneTo(i)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.arc=this.arc,i.emitFromEdge=this.emitFromEdge,i.randomDirection=this.randomDirection},n(e,["_tempPositionPoint",function(){return this._tempPositionPoint=new Le}]),e}(it),si=function(t){function e(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,e.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.ConeShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=this.radius+this.length*Math.sin(this.angle),i=this.length*Math.cos(this.angle),n=t.min.elements;n[0]=n[1]=-e,n[2]=0;var r=t.max.elements;r[0]=r[1]=e,r[2]=i},i._getSpeedBoundBox=function(t){var e=Math.sin(this.angle),i=t.min.elements;i[0]=i[1]=-e,i[2]=0;var n=t.max.elements;n[0]=i[1]=e,n[2]=1},i.generatePositionAndDirection=function(t,i,n,r){var a,s=t.elements,o=i.elements,l=e._tempPositionPoint.elements,h=NaN,c=NaN,u=Math.cos(this.angle),_=Math.sin(this.angle);switch(this.emitType){case 0:n?(n.seed=r[16],nt._randomPointInsideUnitCircle(e._tempPositionPoint,n),r[16]=n.seed):nt._randomPointInsideUnitCircle(e._tempPositionPoint),h=l[0],c=l[1],s[0]=h*this.radius,s[1]=c*this.radius,s[2]=0,this.randomDirection?(n?(n.seed=r[17],nt._randomPointInsideUnitCircle(e._tempDirectionPoint,n),r[17]=n.seed):nt._randomPointInsideUnitCircle(e._tempDirectionPoint),a=e._tempDirectionPoint.elements,o[0]=a[0]*_,o[1]=a[1]*_):(o[0]=h*_,o[1]=c*_),o[2]=u;break;case 1:n?(n.seed=r[16],nt._randomPointUnitCircle(e._tempPositionPoint,n),r[16]=n.seed):nt._randomPointUnitCircle(e._tempPositionPoint),h=l[0],c=l[1],s[0]=h*this.radius,s[1]=c*this.radius,s[2]=0,this.randomDirection?(n?(n.seed=r[17],nt._randomPointInsideUnitCircle(e._tempDirectionPoint,n),r[17]=n.seed):nt._randomPointInsideUnitCircle(e._tempDirectionPoint),a=e._tempDirectionPoint.elements,o[0]=a[0]*_,o[1]=a[1]*_):(o[0]=h*_,o[1]=c*_),o[2]=u;break;case 2:n?(n.seed=r[16],nt._randomPointInsideUnitCircle(e._tempPositionPoint,n)):nt._randomPointInsideUnitCircle(e._tempPositionPoint),h=l[0],c=l[1],s[0]=h*this.radius,s[1]=c*this.radius,s[2]=0,o[0]=h*_,o[1]=c*_,o[2]=u,Pe.normalize(i,i),n?(Pe.scale(i,this.length*n.getFloat(),i),r[16]=n.seed):Pe.scale(i,this.length*Math.random(),i),Pe.add(t,i,t),this.randomDirection&&(n?(n.seed=r[17],nt._randomPointUnitSphere(i,n),r[17]=n.seed):nt._randomPointUnitSphere(i));break;case 3:n?(n.seed=r[16],nt._randomPointUnitCircle(e._tempPositionPoint,n)):nt._randomPointUnitCircle(e._tempPositionPoint),h=l[0],c=l[1],s[0]=h*this.radius,s[1]=c*this.radius,s[2]=0,o[0]=h*_,o[1]=c*_,o[2]=u,Pe.normalize(i,i),n?(Pe.scale(i,this.length*n.getFloat(),i),r[16]=n.seed):Pe.scale(i,this.length*Math.random(),i),Pe.add(t,i,t),this.randomDirection&&(n?(n.seed=r[17],nt._randomPointUnitSphere(i,n),r[17]=n.seed):nt._randomPointUnitSphere(i));break;default:throw new Error("ConeShape:emitType is invalid.")}},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.angle=this.angle,i.radius=this.radius,i.length=this.length,i.emitType=this.emitType,i.randomDirection=this.randomDirection},n(e,["_tempPositionPoint",function(){return this._tempPositionPoint=new Le},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new Le}]),e}(it),oi=function(t){function e(){this.radius=NaN,this.emitFromShell=!1,e.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=this.radius,i[2]=0},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=i[2]=1},i.generatePositionAndDirection=function(t,e,i,n){var r=t.elements;i?(i.seed=n[16],this.emitFromShell?nt._randomPointUnitSphere(t,i):nt._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?nt._randomPointUnitSphere(t):nt._randomPointInsideUnitSphere(t),Pe.scale(t,this.radius,t);var a=r[2];a<0&&(r[2]=-1*a),this.randomDirection?i?(i.seed=n[17],nt._randomPointUnitSphere(e,i),n[17]=i.seed):nt._randomPointUnitSphere(e):t.cloneTo(e)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.emitFromShell=this.emitFromShell,i.randomDirection=this.randomDirection},e}(it),li=function(t){function e(){this.radius=NaN,this.emitFromShell=!1,e.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.SphereShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=i[2]=this.radius},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-1;var i=t.max.elements;i[0]=i[1]=i[2]=1},i.generatePositionAndDirection=function(t,e,i,n){i?(i.seed=n[16],this.emitFromShell?nt._randomPointUnitSphere(t,i):nt._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?nt._randomPointUnitSphere(t):nt._randomPointInsideUnitSphere(t),Pe.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],nt._randomPointUnitSphere(e,i),n[17]=i.seed):nt._randomPointUnitSphere(e):t.cloneTo(e)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.emitFromShell=this.emitFromShell,i.randomDirection=this.randomDirection},e}(it),hi=function(t){function e(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,e.__super.call(this)}return r(e,"laya.d3.core.render.SubMeshRenderElement",ct),e}(),ci=function(t){function e(t,i,n,r,a,s){var o;for(o in this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=t,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[He.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[_n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[_n.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[vn.SHADERDEFINE_BONE]="BONE",this._materialInt2name[mi.SHADERDEFINE_ALPHATEST]="ALPHATEST",e.__super.call(this,t,i,n,null,{}),this._attributeMap=r,a){var l=a[o];switch(l[1]){case 0:this._renderElementUniformMap[o]=l[0];break;case 1:this._materialUniformMap[o]=l[0];break;case 2:this._spriteUniformMap[o]=l[0];break;case 3:this._cameraUniformMap[o]=l[0];break;case 4:this._sceneUniformMap[o]=l[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}r(e,"laya.d3.shader.ShaderCompile3D",M);var i=e.prototype;return i._definesToNameDic=function(t,e){for(var i={},n=1,r=0;r<32&&!((n=1<<r)>t);r++)if(t&n){var a=e[n];a&&(i[a]="")}return i},i.withCompile=function(t,i,n){var r,a,s;if(a=this.sharders[t])if(s=a[i]){if(r=s[n])return r}else s=a[i]=[];else s=(a=this.sharders[t]=[])[i]=[];var o,l=this._definesToNameDic(t,e._globalInt2name),h=this._definesToNameDic(i,this._spriteInt2name),c=this._definesToNameDic(n,this._materialInt2name);if(laya.d3.shader.ShaderCompile3D.debugMode){var u="";for(o in l)u+=o+" ";var _="";for(o in h)_+=o+" ";var d="";for(o in c)d+=o+" ";console.log("ShaderCompile3DDebugMode---(Name:"+ki.nameKey.getName(this._name)+" PublicDefine:"+t+" SpriteDefine:"+i+" MaterialDefine:"+n+" PublicDefineGroup:"+u+" SpriteDefineGroup:"+_+"MaterialDefineGroup: "+d+")---ShaderCompile3DDebugMode")}var f={},p="";if(l)for(o in l)p+="#define "+o+"\n",f[o]=!0;if(h)for(o in h)p+="#define "+o+"\n",f[o]=!0;if(c)for(o in c)p+="#define "+o+"\n",f[o]=!0;var m=this._VS.toscript(f,[]),g=this._PS.toscript(f,[]);return r=ki.create(p+m.join("\n"),p+g.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap),s[n]=r,r},i.precompileShaderWithShaderDefine=function(t,e,i){this.withCompile(t,e,i)},i.addMaterialDefines=function(t){var e=t.defines;for(var i in e){var n=e[i],r=parseInt(i);this._materialInt2name[r]=n,this._materialName2Int[n]=r}},i.addSpriteDefines=function(t){var e=t.defines;for(var i in e){var n=e[i],r=parseInt(i);this._spriteInt2name[r]=n,this._spriteName2Int[n]=r}},i.getMaterialDefineByName=function(t){return this._materialName2Int[t]},i.registerMaterialDefine=function(t){var e=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[e]=t,this._materialName2Int[t]=e,e},i.registerSpriteDefine=function(t){var e=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[e]=t,this._spriteName2Int[t]=e,e},e._globalRegDefine=function(t,i){e._globalInt2name[i]=t},e.add=function(t,i,n,r,a){return laya.d3.shader.ShaderCompile3D._preCompileShader[t]=new e(t,i,n,r,a,M.includes)},e.get=function(t){return laya.d3.shader.ShaderCompile3D._preCompileShader[ki.nameKey.getID(t)]},e._preCompileShader={},e._globalInt2name=[],e.debugMode=!1,e.SHADERDEFINE_HIGHPRECISION=1,e.SHADERDEFINE_FOG=4,e.SHADERDEFINE_DIRECTIONLIGHT=8,e.SHADERDEFINE_POINTLIGHT=16,e.SHADERDEFINE_SPOTLIGHT=32,e.SHADERDEFINE_UV0=64,e.SHADERDEFINE_COLOR=128,e.SHADERDEFINE_UV1=256,e.SAHDERDEFINE_DEPTHFOG=131072,e}(),ui=function(t){function e(){e.__super.call(this)}r(e,"laya.d3.graphics.MeshSprite3DStaticBatchManager",wt);var i=e.prototype;return i._getStaticBatch=function(t,e,i,n){var r,a;return a=t?t.id.toString()+i.id.toString()+e.id.toString()+n.toString():i.id.toString()+e.id.toString()+n.toString(),this._staticBatches[a]?r=this._staticBatches[a]:this._staticBatches[a]=r=new _i(a,this,t,e,i),r},i._initStaticBatchs=function(t){this._initBatchRenderElements.sort(e._sortPrepareStaticBatch);for(var i,n,r,a=!1,s=0,o=0,l=this._initBatchRenderElements.length;o<l;o++){var h,c=this._initBatchRenderElements[o],u=c.renderObj._getVertexBuffer(0);if(c._sprite3D,n===u.vertexDeclaration&&i===c._material)if(a)r._addCombineBatchRenderObjTest(c)?(h=c._staticBatch)!==r&&(h&&h._deleteCombineBatchRenderObj(c),r._addCombineBatchRenderObj(c)):(a=!1,s++);else{var _=this._initBatchRenderElements[o-1],d=_.renderObj,f=c.renderObj;d._getVertexBuffer().vertexCount+f._getVertexBuffer().vertexCount>65535?a=!1:(r=this._getStaticBatch(t,n,i,s),(h=_._staticBatch)!==r&&(h&&h._deleteCombineBatchRenderObj(_),r._addCombineBatchRenderObj(_)),(h=c._staticBatch)!==r&&(h&&h._deleteCombineBatchRenderObj(c),r._addCombineBatchRenderObj(c)),a=!0)}else a=!1,s=0;i=c._material,n=u.vertexDeclaration}},e._sortPrepareStaticBatch=function(t,e){var i=t._render,n=e._render,r=i.lightmapIndex-n.lightmapIndex;if(0===r){var a=i.receiveShadow-n.receiveShadow;if(0===a){var s=t._mainSortID-e._mainSortID;return 0===s?t.renderObj.triangleCount-e.renderObj.triangleCount:s}return a}return r},e}(),_i=function(t){function e(t,i,n,r,a){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,e.__super.call(this,t,i,n),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=r,this._material=a}r(e,"laya.d3.graphics.SubMeshStaticBatch",Ct);var i=e.prototype;return i._compareBatchRenderElement=function(t,e){return t._batchIndexStart>e._batchIndexStart},i._addCombineBatchRenderObjTest=function(t){var e=t.renderObj._vertexCount;return!((e>0?this._currentCombineVertexCount+e:this._currentCombineVertexCount+t.renderObj._getVertexBuffer().vertexCount)>65535)},i._addCombineBatchRenderObj=function(t){var e=t.renderObj,i=e._vertexCount;this._initBatchRenderElements.push(t),t._staticBatch=this,i>0?(this._currentCombineIndexCount+=e._indexCount,this._currentCombineVertexCount+=i):(this._currentCombineIndexCount=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount),this._needFinishCombine=!0},i._deleteCombineBatchRenderObj=function(t){var e=t.renderObj,i=this._initBatchRenderElements.indexOf(t);if(-1!==i){this._initBatchRenderElements.splice(i,1),t._staticBatch=null;var n=e._vertexCount;n>0?(this._currentCombineIndexCount=this._currentCombineIndexCount-e._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-n):(this._currentCombineIndexCount=this._currentCombineIndexCount-e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-e._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},i._finishInit=function(){if(this._needFinishCombine){var t=0,e=0;this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex>=0?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var i=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),n=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=Ki.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=ji.create("ushort",this._currentCombineIndexCount,35044);for(var r=0,a=this._initBatchRenderElements.length;r<a;r++){var s=this._initBatchRenderElements[r],o=s.renderObj,l=o._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,s._sprite3D),h=o.getIndices(),c=s._sprite3D.transform._isFrontFaceInvert,u=t/(this._vertexDeclaration.vertexStride/4)-o._vertexStart,_=e,d=_+h.length;s._batchIndexStart=_,s._batchIndexEnd=d,n.set(h,e);var f=0;if(c)for(f=_;f<d;f+=3){n[f]=u+n[f];var p=n[f+1],m=n[f+2];n[f+1]=u+m,n[f+2]=u+p}else for(f=_;f<d;f+=3)n[f]=u+n[f],n[f+1]=u+n[f+1],n[f+2]=u+n[f+2];e+=h.length,i.set(l,t),t+=l.length}this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this._needFinishCombine=!1}},i._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new hi)},i._getRenderElement=function(t,e,i){for(var n,r,a=this._batchRenderElements.length,s=!0,o=0;o<a;o++){var l,h,c=(r=this._batchRenderElements[o])._sprite3D._render;if(0!==o&&(s=(l=(n=this._batchRenderElements[o-1])._sprite3D._render).lightmapIndex!==c.lightmapIndex||l.receiveShadow!==c.receiveShadow||n._batchIndexEnd!==r._batchIndexStart),s){(h=this._getCombineRenderElementFromPool()).renderObj=this,h._material=this._material,h._batchIndexStart=r._batchIndexStart,h._batchIndexEnd=r._batchIndexEnd;var u=c.lightmapIndex,_=u+1,d=this._batchOwnerIndices[_];d||(d=this._batchOwnerIndices[_]=[]);var f,p=d[r._render.receiveShadow?1:0];void 0===p?(d[c.receiveShadow?1:0]=this._batchOwners.length,(f=new gn(null,"StaticBatchMeshSprite3D"))._scene=e,f._transform=this._rootOwner?this._rootOwner._transform:null,f._render.lightmapIndex=u,f._render.receiveShadow=r._render.receiveShadow,this._batchOwners.push(f)):f=this._batchOwners[p],f._render._renderUpdate(i),h._sprite3D=f,t.push(h)}else h._batchIndexEnd=r._batchIndexEnd}},i._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},i._render=function(t){var e=t.renderElement,i=e._batchIndexStart,n=e._batchIndexEnd-i;P.mainContext.drawElements(4,n,5123,2*i),D.drawCall++,D.trianglesFaces+=n/3},i.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},i._getVertexBuffer=function(t){return void 0===t&&(t=0),this._vertexBuffer},e}(),di=(function(t){function e(){e.__super.call(this),e._nameNumber++,this.loadShaderParams(),this.createResource(),this.alphaBlending=1,this.colorIntensity=1}r(e,"laya.d3.resource.models.SkyBox",t);var i=e.prototype;i._getShader=function(t){var e=t.scene._shaderDefineValue;return this._shader=this._shaderCompile.withCompile(e,0,0),this._shader},i.createResource=function(){this._numberVertices=36,this._numberIndices=36;var t=new Uint16Array(this._numberIndices),i=e._vertexDeclaration.vertexStride/4,n=new Float32Array(this._numberVertices*i),r=new Pe(-.5,.5,.5),a=new Pe(-.5,-.5,.5),s=new Pe(.5,.5,.5),o=new Pe(.5,-.5,.5),l=new Pe(-.5,.5,-.5),h=new Pe(.5,.5,-.5),c=new Pe(-.5,-.5,-.5),u=new Pe(.5,-.5,-.5),_=0;_=this._addVertex(n,_,r),_=this._addVertex(n,_,a),_=this._addVertex(n,_,s),_=this._addVertex(n,_,a),_=this._addVertex(n,_,o),_=this._addVertex(n,_,s),_=this._addVertex(n,_,l),_=this._addVertex(n,_,h),_=this._addVertex(n,_,c),_=this._addVertex(n,_,c),_=this._addVertex(n,_,h),_=this._addVertex(n,_,u),_=this._addVertex(n,_,r),_=this._addVertex(n,_,h),_=this._addVertex(n,_,l),_=this._addVertex(n,_,r),_=this._addVertex(n,_,s),_=this._addVertex(n,_,h),_=this._addVertex(n,_,a),_=this._addVertex(n,_,c),_=this._addVertex(n,_,u),_=this._addVertex(n,_,a),_=this._addVertex(n,_,u),_=this._addVertex(n,_,o),_=this._addVertex(n,_,r),_=this._addVertex(n,_,c),_=this._addVertex(n,_,a),_=this._addVertex(n,_,l),_=this._addVertex(n,_,c),_=this._addVertex(n,_,r),_=this._addVertex(n,_,s),_=this._addVertex(n,_,o),_=this._addVertex(n,_,u),_=this._addVertex(n,_,h),_=this._addVertex(n,_,s),_=this._addVertex(n,_,u);for(var d=0;d<36;d++)t[d]=d;this._vertexBuffer=new Ki(e._vertexDeclaration,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(t)},i._addVertex=function(t,e,i){var n=i.elements;return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],e+3},i.loadShaderParams=function(){this._sharderNameID=ki.nameKey.getID("SkyBox"),this._shaderCompile=ci._preCompileShader[this._sharderNameID]},i._render=function(t){this._textureCube&&this._textureCube.loaded&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),this._shader=this._getShader(t),this._shader.bind(),t.camera.transform.worldMatrix.cloneTo(e._tempMatrix4x40),e._tempMatrix4x40.transpose(),be.multiply(t._projectionMatrix,e._tempMatrix4x40,e._tempMatrix4x41),t.camera._shaderValues.setValue(4,e._tempMatrix4x41.elements),this._shader.uploadCameraUniforms(t.camera._shaderValues.data),this._shaderValue.setValue(1,this._colorIntensity),this._shaderValue.setValue(2,this._alphaBlending),this._shaderValue.setValue(3,this.textureCube),this._shader.uploadAttributes(e._vertexDeclaration.shaderValues.data,null),this._shader.uploadMaterialUniforms(this._shaderValue.data),P.mainContext.drawElements(4,36,5123,0),D.trianglesFaces+=12,D.drawCall++)},i.destroy=function(){t.prototype.destroy.call(this),this._textureCube&&(this._textureCube._removeReference(),this._textureCube=null)},a(0,i,"textureCube",function(){return this._textureCube},function(t){this._textureCube!==t&&(this._textureCube&&this._textureCube._removeReference(),this._textureCube=t,t&&t._addReference())}),e._nameNumber=1,n(e,["_tempMatrix4x40",function(){return this._tempMatrix4x40=new be},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new be},"_vertexDeclaration",function(){return this._vertexDeclaration=new bt(12,[new Mt(0,"vector3",0)])}])}(Ve),function(t){function e(){this._stacks=16,this._slices=16,this._radius=1,e.__super.call(this),e._nameNumber++,this.loadShaderParams(),this.recreateResource(),this.alphaBlending=1,this.colorIntensity=1}r(e,"laya.d3.resource.models.SkyDome",t);var s=e.prototype;s._getShader=function(t){var e=t.scene._shaderDefineValue;return this._shader=this._shaderCompile.withCompile(e,0,0),this._shader},s.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2;for(var t=new Uint16Array(this._numberIndices),i=e._vertexDeclaration.vertexStride/4,n=new Float32Array(this._numberVertices*i),r=Math.PI/this._stacks,a=2*Math.PI/this._slices,s=0,o=0,l=0,h=0;h<this._stacks+1;h++)for(var c=Math.sin(h*r),u=Math.cos(h*r),_=0;_<this._slices+1;_++){var d=c*Math.sin(_*a),f=c*Math.cos(_*a);n[o+0]=d*this._radius,n[o+1]=u*this._radius,n[o+2]=f*this._radius,n[o+3]=-_/this._slices+.75,n[o+4]=h/this._stacks,o+=i,h!=this._stacks-1&&(t[l++]=s+1,t[l++]=s,t[l++]=s+(this._slices+1),t[l++]=s+(this._slices+1),t[l++]=s,t[l++]=s+this._slices,s++)}this._vertexBuffer=new Ki(e._vertexDeclaration,this._numberVertices,35044),this._indexBuffer=new ji("ushort",this._numberIndices,35044),this._vertexBuffer.setData(n),this._indexBuffer.setData(t)},s.loadShaderParams=function(){this._sharderNameID=ki.nameKey.getID("SkyDome"),this._shaderCompile=ci._preCompileShader[this._sharderNameID]},s._render=function(t){this._texture&&this._texture.loaded&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),this._shader=this._getShader(t),this._shader.bind(),t.camera.transform.worldMatrix.cloneTo(e._tempMatrix4x40),e._tempMatrix4x40.transpose(),be.multiply(t._projectionMatrix,e._tempMatrix4x40,e._tempMatrix4x41),t.camera._shaderValues.setValue(4,e._tempMatrix4x41.elements),this._shader.uploadCameraUniforms(t.camera._shaderValues.data),this._shaderValue.setValue(1,this._colorIntensity),this._shaderValue.setValue(2,this._alphaBlending),this._shaderValue.setValue(3,this.texture),this._shader.uploadAttributes(e._vertexDeclaration.shaderValues.data,null),this._shader.uploadMaterialUniforms(this._shaderValue.data),P.mainContext.drawElements(4,this._indexBuffer.indexCount,5123,0),D.trianglesFaces+=this._numberIndices/3,D.drawCall++)},s.onEnvDescLoaded=function(t){var e="",n=Math.max(t.lastIndexOf("/"),t.lastIndexOf("\\"));n>0&&(e=t.substr(0,n+1));var r=i.loader.getRes(t);void 0!=r.ev&&this.__ownerCamera?this.__ownerCamera._shaderValues.setValue(13,Math.pow(2,r.ev)):this.__ownerCamera._shaderValues.setValue(13,Math.pow(2,0)),this.texture=ln.load(e+r.skytex),this.environmentSpecular=en.load(e+r.prefiltedEnv);var a=new Float32Array(r.IrradianceMat);this.envDiffuseSHRed=a.slice(0,16),this.envDiffuseSHGreen=a.slice(16,32),this.envDiffuseSHBlue=a.slice(32,48)},s.loadEnvInfo=function(t){i.loader.load(t,y.create(this,this.onEnvDescLoaded,[t]))},s.destroy=function(){t.prototype.destroy.call(this),this._texture&&(this._texture._removeReference(),this._texture=null)},a(0,s,"texture",function(){return this._texture},function(t){this._texture!==t&&(this._texture&&this._texture._removeReference(),this._texture=t,t&&t._addReference())}),e._nameNumber=1,n(e,["_tempMatrix4x40",function(){return this._tempMatrix4x40=new be},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new be},"_vertexDeclaration",function(){return this._vertexDeclaration=new bt(20,[new Mt(0,"vector3",0),new Mt(12,"vector2",2)])}])}(Ve),function(t){function e(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,e.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}r(e,"laya.d3.core.ComponentNode",E);var i=e.prototype;return i.addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=p.getInstance(t);return e.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},i._removeComponent=function(t,e){var i=this._typeComponentsIndices[t],n=i[e],r=this._components[n];this._components.splice(n,1),r instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(r),1),i.splice(e,1),0===i.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1));for(var a=0,s=this._componentsMap.length;a<s;a++)for(var o=(i=this._typeComponentsIndices[a]).length-1;o>=0;o--){var l=i[o];if(!(l>n))break;i[o]=--l}r._destroy()},i.getComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);return-1===i?null:this._components[this._typeComponentsIndices[i][e]]},i.getComponentsByType=function(t,e){var i=this._componentsMap.indexOf(t);if(-1!==i){var n=this._typeComponentsIndices[i],r=n.length;e.length=r;for(var a=0;a<r;a++)e[a]=this._components[n[a]]}else e.length=0},i.getComponentByIndex=function(t){return this._components[t]},i.removeComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);-1!==i&&this._removeComponent(i,e)},i.removeComponentsByType=function(t){var e=this._componentsMap.indexOf(t);if(-1!==e)for(var i=this._typeComponentsIndices[e],n=0,r=i.length;n<r;i.length<r?r--:n++)this._removeComponent(e,n)},i.removeAllComponent=function(){for(var t=0,e=this._componentsMap.length;t<e;this._componentsMap.length<e?e--:t++)this.removeComponentsByType(this._componentsMap[t])},i._updateComponents=function(t){for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.enable&&n._update(t)}},i._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._lateUpdate(t)}},i._preRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._preRenderUpdate(t)}},i._postRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._postRenderUpdate(t)}},e}()),fi=function(t){function e(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._avatarDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._cachePropertyMap=null,this._nodeToCachePropertyMap=null,this._unCachePropertyMap=null,this._duration=NaN,this._frameRate=0,this._animationEvents=null,this._publicClipDatas=null,this.islooping=!1,e.__super.call(this),this._fullKeyframeIndicesCache={},this._animationDatasCache=[],this._avatarDatasCache=[],this._skinnedDatasCache=[],this._animationEvents=[]}r(e,"laya.d3.animation.AnimationClip",C);var n=e.prototype;return n.duration=function(){return this._duration},n._hermiteInterpolate=function(t,e,i,n){for(var r=t.data,a=t.outTangent,s=t.next,o=s.data,l=s.inTangent,h=!1,c=NaN,u=NaN,_=NaN,d=NaN,f=0,p=n.length;f<p;f++){var m=a[f],g=l[f];if(Number.isFinite(m)&&Number.isFinite(g)){if(!h){var y=e*e,v=y*e;c=2*v-3*y+1,u=v-2*y+e,_=v-y,d=-2*v+3*y,h=!0}n[f]=c*r[f]+u*m*i+_*g*i+d*o[f]}else n[f]=r[f]}},n._getFullKeyframeIndicesWithCache=function(t){return this._fullKeyframeIndicesCache[t]},n._cacheFullKeyframeIndices=function(t,e){this._fullKeyframeIndicesCache[t]=e},n._getAnimationDataWithCache=function(t,e){var i=this._animationDatasCache[t];return i?i[e]:null},n._cacheAnimationData=function(t,e,i){(this._animationDatasCache[t]||(this._animationDatasCache[t]=[]))[e]=i},n._getAvatarDataWithCache=function(t,e,i){var n=this._avatarDatasCache[t.id];if(n){var r=n[e];return r?r[i]:null}return null},n._cacheAvatarData=function(t,e,i,n){var r=this._avatarDatasCache[t.id]||(this._avatarDatasCache[t.id]=[]);(r[e]||(r[e]=[]))[i]=n},n._evaluateAnimationlDatasCacheMode=function(t,e,i,n,r){for(var a=0,s=0,o=0,l=r?r.length:this._nodes.length;o<l;o++){var h=r?r[o]:o,c=this._nodes[h],u=c._cacheProperty;if(t[h]){var _,d=e[h],f=d[i.currentFrameIndex],p=0;if(-1!==f){var m=c.keyFrames[f];if(m.next){r&&!u?(_=n[h])||(_=n[h]=new Float32Array(c.keyFrameWidth)):(_=new Float32Array(c.keyFrameWidth),n[o]=_);var g,y=m.duration;g=0!==y?(i.currentFrameTime-m.startTime)/y:0,this._hermiteInterpolate(m,g,y,_)}else{if(r&&!u)(_=n[h])||(_=n[h]=new Float32Array(c.keyFrameWidth));else{if(-1!==(p=i._lastFrameIndex)&&d[p]===f)continue;_=new Float32Array(c.keyFrameWidth),n[o]=_}var v=m.data;for(a=0,s=_.length;a<s;a++)_[a]=v[a]}}else{if(r&&!u)(_=n[h])||(_=n[h]=new Float32Array(c.keyFrameWidth));else{if(-1!==(p=i._lastFrameIndex)&&d[p]===f)continue;_=new Float32Array(c.keyFrameWidth),n[o]=_}var S=c.keyFrames[0].data;for(a=0,s=_.length;a<s;a++)_[a]=S[a]}}}},n._evaluateAnimationlDatasRealTime=function(t,e,i,n){var r=0,a=0,s=this._nodes;if(!this._realTimeCurrentFrameIndexes){for(this._realTimeCurrentFrameIndexes=new Int32Array(s.length),r=0,a=s.length;r<a;r++)this._realTimeCurrentFrameIndexes[r]=-1;this._realTimeCurrentTimes=new Float32Array(s.length)}for(r=0,a=n?n.length:this._nodes.length;r<a;r++){var o=n?n[r]:r,l=s[o];e<this._realTimeCurrentTimes[o]&&(this._realTimeCurrentFrameIndexes[o]=-1),this._realTimeCurrentTimes[o]=e;for(var h=this._realTimeCurrentFrameIndexes[o]+1,c=l.keyFrames,u=c.length;h<u;){if(c[h].startTime>e){this._realTimeCurrentFrameIndexes[o]=h-1;break}h++}h===u&&(this._realTimeCurrentFrameIndexes[o]=u-1);var _=0,d=0,f=i[o];f||(f=i[o]=new Float32Array(l.keyFrameWidth));var p=c[this._realTimeCurrentFrameIndexes[o]];if(p)if(p.next){var m,g=p.duration;m=0!==g?(e-p.startTime)/g:0,this._hermiteInterpolate(p,m,g,f)}else{var y=p.data;for(_=0,d=f.length;_<d;_++)f[_]=y[_]}else{var v=l.keyFrames[0].data;for(_=0,d=f.length;_<d;_++)f[_]=v[_]}var S=t[o];S&&(n?F._propertySetFuncs[l.propertyNameID](S,null,f):F._propertySetFuncs[l.propertyNameID](null,S,f))}},n._binarySearchEventIndex=function(t){for(var e=0,i=this._animationEvents.length-1,n=0;e<=i;){n=Math.floor((e+i)/2);var r=this._animationEvents[n].time;if(r==t)return n;r>t?i=n-1:e=n+1}return e},n.addEvent=function(t){var e=this._binarySearchEventIndex(t.time);this._animationEvents.splice(e,0,t)},n.onAsynLoaded=function(t,e,i){var n=new f(e);switch(this._version=n.readUTFString(),this._version){case"LAYAANIMATION:01":O.parse(this,n);break;case"LAYAANIMATION:02":V.parse(this,n)}this.completeCreate(),this._endLoaded()},n.disposeResource=function(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._avatarDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._cachePropertyMap=null,this._nodeToCachePropertyMap=null,this._unCachePropertyMap=null,this._publicClipDatas=null},e.load=function(t){return i.loader.create(t,null,null,e)},e}(),pi=function(t){function e(){e.__super.call(this)}r(e,"laya.d3.core.Avatar",C);var n=e.prototype;return i.imps(n,{"laya.d3.core.IClone":!0}),n._initCloneToAnimator=function(t,e){e._avatarNodeMap[t.name]=t,e._avatarNodes.push(t);for(var i=0,n=t.getChildCount();i<n;i++)this._initCloneToAnimator(t.getChildByIndex(i),e)},n._parseNode=function(t,e){var i=t.props.name;if(e.name=i,e._parent){var n=t.customProps,r=e.transform;r._localRotationEuler=new Float32Array(3),r.setLocalPosition(new Float32Array(n.translate)),r.setLocalRotation(new Float32Array(n.rotation)),r.setLocalScale(new Float32Array(n.scale)),r._setWorldMatrixAndUpdate(new Float32Array(16))}for(var a=t.child,s=0,o=a.length;s<o;s++){var l=a[s],h=new F;e.addChild(h),this._parseNode(l,h)}},n.onAsynLoaded=function(t,e,i){if(this._rootNode=new F,e.version){this._version=e.version;var n=e.rootNode;n&&this._parseNode(n,this._rootNode)}else this._parseNode(e,this._rootNode);this._endLoaded()},n._cloneDatasToAnimator=function(t){var e=this._rootNode.clone();e.transform._setWorldMatrixIgnoreUpdate(null),t._avatarNodeMap={},t._avatarNodes=[],this._initCloneToAnimator(e,t)},n.cloneTo=function(t){var e=t,i=this._rootNode.clone();e._rootNode=i},n.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.load=function(t){return i.loader.create(t,null,null,e)},e}(),mi=function(t){function e(){e.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new Ue,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new Ne(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}r(e,"laya.d3.core.material.BaseMaterial",t);var s=e.prototype;return i.imps(s,{"laya.d3.core.IClone":!0}),s._addShaderDefine=function(t){this._shaderDefineValue|=t},s._removeShaderDefine=function(t){this._shaderDefineValue&=~t},s._addDisablePublicShaderDefine=function(t){this._disablePublicShaderDefine|=t},s._removeDisablePublicShaderDefine=function(t){this._disablePublicShaderDefine&=~t},s._setBuffer=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},s._getBuffer=function(t){return this._values[t]},s._setMatrix4x4=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},s._getMatrix4x4=function(t){return this._values[t]},s._setInt=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},s._getInt=function(t){return this._values[t]},s._setNumber=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},s._getNumber=function(t){return this._values[t]},s._setBool=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},s._getBool=function(t){return this._values[t]},s._setVector2=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},s._getVector2=function(t){return this._values[t]},s._setColor=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},s._getColor=function(t){return this._values[t]},s._setTexture=function(t,e){var i=this._values[t];this._values[t]=e,this._shaderValues.setValue(t,e),this.referenceCount>0&&(i&&i._removeReference(),e&&e._addReference())},s._getTexture=function(t){return this._values[t]},s._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},s._getShader=function(t,e,i){var n=(t|e)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(n,i,this._shaderDefineValue),this._shader},s._setRenderStateBlendDepth=function(){var t=P.mainContext;switch(N.setDepthMask(t,this.depthWrite),0===this.depthTest?N.setDepthTest(t,!1):(N.setDepthTest(t,!0),N.setDepthFunc(t,this.depthTest)),this.blend){case 0:N.setBlend(t,!1);break;case 1:N.setBlend(t,!0),N.setBlendFunc(t,this.srcBlend,this.dstBlend);break;case 2:N.setBlend(t,!0)}},s._setRenderStateFrontFace=function(t,e){var i=P.mainContext,n=0;switch(this.cull){case 0:N.setCullFace(i,!1);break;case 1:N.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2305:2304:e&&e._isFrontFaceInvert?2304:2305,N.setFrontFace(i,n);break;case 2:N.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2304:2305:e&&e._isFrontFaceInvert?2305:2304,N.setFrontFace(i,n)}},s.onAsynLoaded=function(t,e,i){var n=e[0],r=e[1];switch(n.version){case"LAYAMATERIAL:01":var a=0,s=0,o=n.props;for(var l in o)switch(l){case"vectors":var h=o[l];for(a=0,s=h.length;a<s;a++){var c=h[a],u=c.value;switch(u.length){case 2:this[c.name]=new Le(u[0],u[1]);break;case 3:this[c.name]=new Pe(u[0],u[1],u[2]);break;case 4:this[c.name]=new Ne(u[0],u[1],u[2],u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var _=o[l];for(a=0,s=_.length;a<s;a++){var d=_[a],f=d.path;f&&(this[d.name]=v.getRes(r[f]))}break;case"defines":var p=o[l];for(a=0,s=p.length;a<s;a++){var m=this._shaderCompile.getMaterialDefineByName(p[a]);this._addShaderDefine(m)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[l]=o[l];break;case"renderQueue":switch(o[l]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[l]=o[l]}break;case"LAYAMATERIAL:02":for(l in o=n.props)switch(l){case"vectors":for(a=0,s=(h=o[l]).length;a<s;a++)switch((u=(c=h[a]).value).length){case 2:this[c.name]=new Le(u[0],u[1]);break;case 3:this[c.name]=new Pe(u[0],u[1],u[2]);break;case 4:this[c.name]=new Ne(u[0],u[1],u[2],u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(a=0,s=(_=o[l]).length;a<s;a++)(f=(d=_[a]).path)&&(this[d.name]=v.getRes(r[f]));break;case"defines":for(a=0,s=(p=o[l]).length;a<s;a++)m=this._shaderCompile.getMaterialDefineByName(p[a]),this._addShaderDefine(m);break;default:this[l]=o[l]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},s._addReference=function(){t.prototype._addReference.call(this);for(var e=0,i=this._values.length;e<i;e++){var n=this._values[e];n&&n instanceof laya.d3.resource.BaseTexture&&n._addReference()}},s._removeReference=function(){t.prototype._removeReference.call(this);for(var e=0,i=this._values.length;e<i;e++){var n=this._values[e];n&&n instanceof laya.d3.resource.BaseTexture&&n._removeReference()}},s.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null;for(var t=0,e=this._values.length;t<e;t++){var i=this._values[t];i&&i instanceof laya.d3.resource.BaseTexture&&i._removeReference()}this._values=null},s.setShaderName=function(t){var e=ki.nameKey.getID(t);if(-1===e)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=ci._preCompileShader[e]},s.cloneTo=function(t){var e=t;e.name=this.name,e.cull=this.cull,e.blend=this.blend,e.srcBlend=this.srcBlend,e.dstBlend=this.dstBlend,e.srcBlendRGB=this.srcBlendRGB,e.dstBlendRGB=this.dstBlendRGB,e.srcBlendAlpha=this.srcBlendAlpha,e.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(e.blendConstColor),e.blendEquation=this.blendEquation,e.blendEquationRGB=this.blendEquationRGB,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.renderQueue=this.renderQueue,e._shader=this._shader,e._disablePublicShaderDefine=this._disablePublicShaderDefine,e._shaderDefineValue=this._shaderDefineValue;var i,n=0,r=e._shaderValues;e._shaderValues.data.length=this._shaderValues.data.length;var a=this._values.length,s=e._values;for(s.length=a,n=0,i=a;n<i;n++){var o=this._values[n];if(o)if("number"==typeof o)s[n]=o,r.data[n]=o;else if("number"==typeof o&&Math.floor(o)==o)s[n]=o,r.data[n]=o;else if("boolean"==typeof o)s[n]=o,r.data[n]=o;else if(o instanceof laya.d3.math.Vector2){var l=s[n]||(s[n]=new Le);o.cloneTo(l),r.data[n]=l.elements}else if(o instanceof laya.d3.math.Vector3){var h=s[n]||(s[n]=new Pe);o.cloneTo(h),r.data[n]=h.elements}else if(o instanceof laya.d3.math.Vector4){var c=s[n]||(s[n]=new Ne);o.cloneTo(c),r.data[n]=c.elements}else if(o instanceof laya.d3.math.Matrix4x4){var u=s[n]||(s[n]=new be);o.cloneTo(u),r.data[n]=u.elements}else o instanceof laya.d3.resource.BaseTexture&&(s[n]=o,r.data[n]=o)}},s.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},a(0,s,"alphaTestValue",function(){return this._getNumber(0)},function(t){this._setNumber(0,t)}),a(0,s,"alphaTest",function(){return this._alphaTest},function(t){this._alphaTest=t,t?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),e.__init__=function(){e.SHADERDEFINE_ALPHATEST=e.shaderDefines.registerDefine("ALPHATEST")},e.RENDERQUEUE_OPAQUE=2e3,e.RENDERQUEUE_ALPHATEST=2450,e.RENDERQUEUE_TRANSPARENT=3e3,e.CULL_NONE=0,e.CULL_FRONT=1,e.CULL_BACK=2,e.BLEND_DISABLE=0,e.BLEND_ENABLE_ALL=1,e.BLEND_ENABLE_SEPERATE=2,e.BLENDPARAM_ZERO=0,e.BLENDPARAM_ONE=1,e.BLENDPARAM_SRC_COLOR=768,e.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,e.BLENDPARAM_DST_COLOR=774,e.BLENDPARAM_ONE_MINUS_DST_COLOR=775,e.BLENDPARAM_SRC_ALPHA=770,e.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,e.BLENDPARAM_DST_ALPHA=772,e.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,e.BLENDPARAM_SRC_ALPHA_SATURATE=776,e.BLENDEQUATION_ADD=0,e.BLENDEQUATION_SUBTRACT=1,e.BLENDEQUATION_REVERSE_SUBTRACT=2,e.DEPTHTEST_OFF=0,e.DEPTHTEST_NEVER=512,e.DEPTHTEST_LESS=513,e.DEPTHTEST_EQUAL=514,e.DEPTHTEST_LEQUAL=515,e.DEPTHTEST_GREATER=516,e.DEPTHTEST_NOTEQUAL=517,e.DEPTHTEST_GEQUAL=518,e.DEPTHTEST_ALWAYS=519,e.SHADERDEFINE_ALPHATEST=1,e.ALPHATESTVALUE=0,n(e,["shaderDefines",function(){return this.shaderDefines=new Fe}]),e}(C),gi=function(t){function e(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,e.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}r(e,"laya.d3.resource.BaseTexture",C);var i=e.prototype;return a(0,i,"width",function(){return this._width}),a(0,i,"repeat",function(){return this._repeat},function(t){if(this._repeat!==t&&(this._repeat=t,this._source)){var e=P.mainContext;N.bindTexture(e,this._type,this._source),h.isPOT(this._width,this._height)&&this._repeat?(e.texParameteri(this._type,10242,10497),e.texParameteri(this._type,10243,10497)):(e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071))}}),a(0,i,"height",function(){return this._height}),a(0,i,"magFifter",function(){return this._magFifter},function(t){this._magFifter=t,t!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(t)}),a(0,i,"wrapModeV",function(){return this._wrapModeV}),a(0,i,"size",function(){return this._size}),a(0,i,"wrapModeU",function(){return this._wrapModeU}),a(0,i,"mipmap",function(){return this._mipmap},function(t){this._mipmap=t,this._mipmap!=t&&this._conchTexture&&this._conchTexture.setMipMap(t)}),a(0,i,"minFifter",function(){return this._minFifter},function(t){this._minFifter=t,this._minFifter!=t&&this._conchTexture&&this._conchTexture.setMinFifter(t)}),a(0,i,"format",function(){return this._format}),a(0,i,"source",function(){return this.activeResource(),this._source}),a(0,i,"defaulteTexture",function(){return sn.grayTexture}),e.WARPMODE_REPEAT=0,e.WARPMODE_CLAMP=1,e}(),yi=function(t){function e(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,e.__super.call(this),this._boundingBoxCorners=s(8,null)}r(e,"laya.d3.resource.models.BaseMesh",C);var i=e.prototype;return i._getPositions=function(){throw new Error("未Override,请重载该属性！")},i._generateBoundingObject=function(){this._boundingSphere=new Ee(new Pe,0),Ee.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new Se(new Pe,new Pe),Se.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},i.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},i.getRenderElement=function(t){throw new Error("未Override,请重载该属性！")},a(0,i,"subMeshCount",function(){return this._subMeshCount}),a(0,i,"boundingBox",function(){return this._boundingBox}),a(0,i,"boundingBoxCorners",function(){return this._boundingBoxCorners}),a(0,i,"boundingSphere",function(){return this._boundingSphere}),e}(),vi=function(t){function e(){this._terrainHeightData=null,this._width=0,this._height=0,this._bitType=0,this._value=NaN,e.__super.call(this)}return r(e,"laya.d3.terrain.TerrainHeightData",C),e.prototype.onAsynLoaded=function(t,e,i){this._width=i[0],this._height=i[1],this._bitType=i[2],this._value=i[3];var n,r=NaN;8==this._bitType?(n=new Uint8Array(e),r=1/255):16==this._bitType&&(n=new Int16Array(e),r=1/32766),this._terrainHeightData=new Float32Array(this._height*this._width);for(var a=0,s=this._height*this._width;a<s;a++)this._terrainHeightData[a]=n[a]*r*this._value/2;this._endLoaded()},e.load=function(t,n,r,a,s){return i.loader.create(t,null,null,e,[n,r,a,s],1,!1)},e}(),Si=function(t){function e(){this._version=NaN,this._cameraCoordinateInverse=!1,this._gridSize=NaN,this._chunkNumX=0,this._chunkNumZ=0,this._heightDataX=0,this._heightDataZ=0,this._heightDataBitType=0,this._heightDataValue=NaN,this._heightDataUrl=null,this._detailTextureInfos=null,this._chunkInfos=null,this._heightData=null,this._materialInfo=null,this._alphaMaps=null,this._normalMaps=null,e.__super.call(this)}r(e,"laya.d3.terrain.TerrainRes",C);var n=e.prototype;return n.parseData=function(t){var e=t[0],i=t[1];if(this._version=e.version,1==this._version){this._cameraCoordinateInverse=e.cameraCoordinateInverse,this._gridSize=e.gridSize,this._chunkNumX=e.chunkNumX,this._chunkNumZ=e.chunkNumZ;var n=e.heightData;if(this._heightDataX=n.numX,this._heightDataZ=n.numZ,this._heightDataBitType=n.bitType,this._heightDataValue=n.value,this._heightDataUrl=i[n.url],this._materialInfo=new Ye,e.material){var r=e.material.ambient,a=e.material.diffuse,o=e.material.specular;this._materialInfo.ambientColor=new Pe(r[0],r[1],r[2]),this._materialInfo.diffuseColor=new Pe(a[0],a[1],a[2]),this._materialInfo.specularColor=new Ne(o[0],o[1],o[2],o[3])}var l=e.detailTexture;this._detailTextureInfos=s(l.length);for(var h=0;h<l.length;h++){var c=l[h],u=new ze;u.diffuseTexture=i[c.diffuse],u.normalTexture=c.normal?i[c.normal]:null,c.scale?u.scale=new Le(c.scale[0],c.scale[1]):u.scale=new Le(1,1),c.offset?u.offset=new Le(c.offset[0],c.offset[1]):u.offset=new Le(0,0),this._detailTextureInfos[h]=u}var _=e.alphaMap;for(this._alphaMaps=s(_.length),h=0;h<this._alphaMaps.length;h++)this._alphaMaps[h]=e.alphaMap[h];var d=e.normalMap;for(this._normalMaps=s(d.length),h=0;h<this._normalMaps.length;h++)this._normalMaps[h]=e.normalMap[h];var f=e.chunkInfo;if(this._chunkNumX*this._chunkNumZ!=f.length)return alert("terrain data error"),!1;for(this._chunkInfos=s(f.length),h=0;h<f.length;h++){var p=f[h],m=new We,g=p.alphaMap.length,y=p.detailID.length;if(g!=y)return alert("terrain chunk data error"),!1;m.alphaMap=s(g),m.detailID=s(y),m.normalMap=i[this._normalMaps[p.normalMap]];for(var S=0;S<g;S++){m.alphaMap[S]=i[this._alphaMaps[p.alphaMap[S]]];var x=p.detailID[S],E=x.length;m.detailID[S]=new Uint8Array(E);for(var T=0;T<E;T++)m.detailID[S][T]=x[T]}this._chunkInfos[h]=m}this._heightData=v.getRes(this._heightDataUrl),this.onLoadTerrainComplete(this._heightData)}return!0},n.onLoadTerrainComplete=function(t){this._endLoaded()},n.onAsynLoaded=function(t,e,i){this.parseData(e)},e.load=function(t){return i.loader.create(t,null,null,e,null,1,!1)},e}(),xi=function(t){function e(){this._player=null,this._templet=null,e.__super.call(this),this._player=new o}r(e,"laya.d3.component.animation.KeyframeAnimations",t);var n=e.prototype;return n._updateAnimtionPlayer=function(){this._player._update(i.timer.delta)},n._addUpdatePlayerToTimer=function(){i.timer.frameLoop(1,this,this._updateAnimtionPlayer)},n._removeUpdatePlayerToTimer=function(){i.timer.clear(this,this._updateAnimtionPlayer)},n._onOwnerActiveHierarchyChanged=function(t){this._owner.displayedInStage&&(t?this._addUpdatePlayerToTimer():this._removeUpdatePlayerToTimer())},n._load=function(t){t.activeInHierarchy&&this._addUpdatePlayerToTimer(),t.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)},n._unload=function(e){t.prototype._unload.call(this,e),e.activeInHierarchy&&this._removeUpdatePlayerToTimer(),e.off("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged),this._player._destroy(),this._player=null,this._templet=null},a(0,n,"url",null,function(t){console.log("Warning: discard property,please use templet property instead.");var e=i.loader.create(t,null,null,l);this._templet!==e&&(0!==this._player.state&&this._player.stop(!0),this._templet=e,this._player.templet=e,this.event("animationchanged",this))}),a(0,n,"player",function(){return this._player}),a(0,n,"templet",function(){return this._templet},function(t){this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this.event("animationchanged",this))}),a(0,n,"currentFrameIndex",function(){return this._player.currentKeyframeIndex}),a(0,n,"currentAnimationClipIndex",function(){return this._player.currentAnimationClipIndex}),a(0,n,"nodeCount",function(){return this._templet.getNodeCount(this._player.currentAnimationClipIndex)}),e}(Je),Ei=function(t){function e(){e.__super.call(this),this._clipNames=[],this._clips=[],this._playStartFrames=[],this._playEndFrames=[],this._cacheNodesSpriteOwners=[],this._cacheNodesAvatarOwners=[],this._cacheNodesDefaultlValues=[],this._cacheNodesToSpriteMap=[],this._cacheSpriteToNodesMap=[],this._cacheFullFrames=[],this._publicClipsDatas=[],this._playEventIndex=-1,this._updateTransformPropertyLoopCount=-1,this._lastFrameIndex=-1,this._defaultClipIndex=-1,this._cachePlayRate=1,this._currentPlayClip=null,this._currentFrameIndex=-1,this._currentTime=0,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this.isCache=!0,this.cacheFrameRate=60,this.playbackRate=1,this.playOnWake=!0}r(e,"laya.d3.component.Animator",t);var s=e.prototype;return i.imps(s,{"laya.resource.IDestroy":!0}),s._getAvatarOwnersByClip=function(t){var e=this._clips[t]._nodes,i=e.length,n=this._cacheNodesAvatarOwners[t];n.length=i;var r=this._cacheNodesDefaultlValues[t];r.length=i;for(var a=0;a<i;a++){for(var s=this._avatarNodes[0],o=e[a],l=o.path,h=0,c=l.length;h<c;h++){var u=l[h];if(""===u)break;if(!(s=s.getChildByName(u)))break}if(s){n[a]=s;var _=F._propertyGetFuncs[o.propertyNameID](s);if(_){var d=new Float32Array(o.keyFrameWidth);for(r[a]=d,h=0,c=_.length;h<c;h++)d[h]=_[h]}}}},s._handleSpriteOwnersByClip=function(t){var e=this._clips[t]._nodes,i=e.length,n=this._cacheNodesSpriteOwners[t];n.length=i;var r=this._cacheNodesDefaultlValues[t];r.length=i;for(var a=0;a<i;a++){var s=this._owner,o=e[a],l=o.path,h=0,c=0;for(h=0,c=l.length;h<c;h++){var u=l[h];if(""===u)break;if(!(s=s.getChildByName(u)))break}if(s){n[a]=s;var _=F._propertyGetFuncs[o.propertyNameID](null,s);if(_){var d=new Float32Array(o.keyFrameWidth);for(r[a]=d,h=0,c=_.length;h<c;h++)d[h]=_[h]}}}},s._offClipAndAvatarRelateEvent=function(t,e){t.loaded?e.loaded||e.off("loaded",this,this._getAvatarOwnersByClip):t.off("loaded",this,this._getAvatarOwnersAndInitDatasAsync)},s._getAvatarOwnersByClipAsync=function(t,e){e.loaded?this._getAvatarOwnersByClip(t):e.once("loaded",this,this._getAvatarOwnersByClip,[t])},s._offGetSpriteOwnersByClipAsyncEvent=function(t){t.loaded||t.off("loaded",this,this._getSpriteOwnersByClipAsync)},s._getSpriteOwnersByClipAsync=function(t,e){e.loaded?this._handleSpriteOwnersByClip(t):e.once("loaded",this,this._handleSpriteOwnersByClip,[t])},s._getAvatarOwnersAndInitDatasAsync=function(){for(var t=0,e=this._clips.length;t<e;t++)this._getAvatarOwnersByClipAsync(t,this._clips[t]);for(this._avatar._cloneDatasToAnimator(this),t=0,e=this._avatarNodes.length;t<e;t++)this._checkAnimationNode(this._avatarNodes[t],this._owner)},s._offGetClipCacheFullKeyframeIndicesEvent=function(t){t.loaded||t.off("loaded",this,this._computeCacheFullKeyframeIndices)},s._computeCacheFullKeyframeIndices=function(t){var e=this._clips[t],i=this._cacheFrameRateInterval*this._cachePlayRate,n=e._getFullKeyframeIndicesWithCache(i);if(n)this._cacheFullFrames[t]=n;else{n=this._cacheFullFrames[t]=[];var r=e._nodes,a=r.length;n.length=a;for(var s=Math.ceil(e._duration/i-1e-5)+1,o=0;o<a;o++){var l=r[o],h=new Int32Array(s);h.fill(-1);for(var c=l.keyFrames,u=0,_=c.length;u<_;u++)for(var d=c[u],f=d.startTime,p=f+d.duration;f<=p;)h[Math.ceil(f/i-1e-5)]=u,f+=i;n[o]=h}e._cacheFullKeyframeIndices(i,n)}},s._updateAnimtionPlayer=function(){this._updatePlayer(i.timer.delta/1e3)},s._onOwnerActiveHierarchyChanged=function(){this._owner.activeInHierarchy?(i.timer.frameLoop(1,this,this._updateAnimtionPlayer),this.playOnWake&&this.clip&&this.play()):(0!==this.playState&&(this._stoped=!0),i.timer.clear(this,this._updateAnimtionPlayer))},s._eventScript=function(t,e){for(var i=this._currentPlayClip._animationEvents,n=i.length;this._playEventIndex<n;this._playEventIndex++){var r=i[this._playEventIndex],a=r.time;if(!(t<=a&&a<e))break;for(var s=this._owner._scripts,o=0,l=s.length;o<l;o++){var h=s[o],c=h[r.eventName];c&&c.apply(h,r.params)}}},s._setPlayParams=function(t,e){var i=this._currentTime;this._currentTime=t,this._currentFrameIndex=Math.max(Math.floor(this.currentPlayTime/e-1e-5),0),this._currentFrameTime=this._currentFrameIndex*e,this._eventScript(i,t)},s._setPlayParamsWhenStop=function(t,e){var i=this._currentTime;this._currentTime=t,this._currentFrameIndex=Math.max(Math.floor(t/e-1e-5),0),this._currentFrameTime=this._currentFrameIndex*e,this._eventScript(i,t),this._currentPlayClip=null},s._revertKeyframeNodes=function(t,e){var i=this._cacheNodesDefaultlValues[e],n=t._nodes;if(this._avatar)for(var r=this._cacheNodesAvatarOwners[e],a=0,s=r.length;a<s;a++){var o=r[a];o&&F._propertySetFuncs[n[a].propertyNameID](o,null,i[a])}else{var l=this._cacheNodesSpriteOwners[e];for(a=0,s=l.length;a<s;a++){var h=l[a];h&&F._propertySetFuncs[n[a].propertyNameID](null,h,i[a])}}},s._onAnimationStop=function(){var t,e,i,n=0,r=0;this._lastFrameIndex=-1;var a=this._currentPlayClip._nodes;if(this._avatar){var s=this._cacheNodesAvatarOwners[this._currentPlayClipIndex];for(n=0,r=s.length;n<r;n++){var o=s[n];i=(e=(t=a[n]).keyFrames)[e.length-1].data,o&&F._propertySetFuncs[t.propertyNameID](o,null,i)}}else{var l=this._cacheNodesSpriteOwners[this._currentPlayClipIndex];for(n=0,r=l.length;n<r;n++){var h=l[n];i=(e=(t=a[n]).keyFrames)[e.length-1].data,h&&F._propertySetFuncs[t.propertyNameID](null,h,i)}}},s._setAnimationClipPropertyToAnimationNode=function(t,e,i){for(var n=0,r=e.length;n<r;n++){var a=e[n],s=t[a];if(s){var o=this._currentPlayClip._nodes[a],l=i[a];l&&F._propertySetFuncs[o.propertyNameID](s,null,l)}}},s._setAnimationClipPropertyToSprite3D=function(t,e){for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r){var a=this._currentPlayClip._nodes[i],s=e[i];s&&F._propertySetFuncs[a.propertyNameID](null,r,s)}}},s._handleSpriteOwnersBySprite=function(t,e,i,n){var r=this._clips[t],a=i.join("/"),s=r._nodesMap[a];if(s)for(var o=this._cacheNodesSpriteOwners[t],l=r._nodes,h=this._cacheNodesDefaultlValues[t],c=0,u=s.length;c<u;c++){var _=s[c],d=l.indexOf(_);if(e){o[d]=n;var f=F._propertyGetFuncs[_.propertyNameID](null,n);if(f){var p=h[d];p||(h[d]=p=new Float32Array(_.keyFrameWidth));for(var m=0,g=f.length;m<g;m++)p[m]=f[m]}}else o[d]=null}},s._evaluateAvatarNodesCacheMode=function(t,i,n,r,a){i._evaluateAnimationlDatasCacheMode(t,this._cacheFullFrames[this._currentPlayClipIndex],this,n,a),this._setAnimationClipPropertyToAnimationNode(t,a,n);for(var s=0,o=this._avatarNodes.length;s<o;s++){var l=this._avatarNodes[s].transform;if(l._worldUpdate){var h=new Float32Array(16);r[s]=h,l._setWorldMatrixAndUpdate(h)}else{var c=l.getWorldMatrix();r[s]=c||e.deafaultMatrix}}},s._evaluateAvatarNodesRealTime=function(t,i,n,r,a){i._evaluateAnimationlDatasRealTime(t,this.currentPlayTime,n,a),this._setAnimationClipPropertyToAnimationNode(t,a,n);for(var s=0,o=this._avatarNodes.length;s<o;s++){var l=this._avatarNodes[s].transform;l._worldUpdate?l._setWorldMatrixNoUpdate(r[s]):r[s]=e.deafaultMatrix}},s._updateAvatarNodesToSpriteCacheMode=function(t,i){for(var n=0,r=this._cacheSpriteToNodesMap.length;n<r;n++){var a=this._cacheSpriteToNodesMap[n],s=i[a];if(s!==e.deafaultMatrix){var o=this._avatarNodes[a].transform._entity,l=o.worldMatrix;Ze.matrix4x4MultiplyMFM(this._owner._transform.worldMatrix,s,l),o.worldMatrix=l}}},s._updateAvatarNodesToSpriteRealTime=function(){for(var t=0,i=this._cacheSpriteToNodesMap.length;t<i;t++){var n=this._avatarNodes[this._cacheSpriteToNodesMap[t]],r=n.transform._entity,a=n.transform;if(a._worldUpdate){var s=e._tempMatrix4x40;a._setWorldMatrixAndUpdate(s);var o=r.worldMatrix;Ze.matrix4x4MultiplyMFM(this._owner._transform.worldMatrix,s,o),r.worldMatrix=o}}},s._updatePlayer=function(t){if(null!=this._currentPlayClip&&!this._stoped&&this._currentPlayClip.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==D.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this._currentPlayClip._frameRate,r=this._playStartFrames[this._currentPlayClipIndex]/n,a=Math.min(this._playEndFrames[this._currentPlayClipIndex]/n,this._currentPlayClip._duration)-r;if(!this._currentPlayClip.islooping&&this._elapsedPlaybackTime>=a)return this._onAnimationStop(),this._setPlayParamsWhenStop(a,e),void this.event("stopped");if(i+=this._currentTime,a>0)if(i>=a)do{(i-=a)<a&&(this._setPlayParams(i,e),this.event("complete")),this._playEventIndex=0,this._eventScript(0,i)}while(i>=a);else this._setPlayParams(i,e);else this._currentTime=this._currentFrameTime=this._currentFrameIndex=this._playEventIndex=0,this.event("complete")}},s._update=function(t){var e=this._currentPlayClip;if(2===this.playState&&e&&e.loaded){var n=this.playbackRate*i.timer.scale,r=this._cachePlayRate;this._canCache=this.isCache&&n>=r;var a,s=-1;if(this._canCache){if(s=this._currentFrameIndex,this._lastFrameIndex===s)return;if(a=e._getAnimationDataWithCache(r,s),this._avatar){var o=this._cacheNodesAvatarOwners[this._currentPlayClipIndex],l=e._cachePropertyMap,h=l.length;h>0&&(a||((a=[]).length=h,e._cacheAnimationData(r,s,a),e._evaluateAnimationlDatasCacheMode(o,this._cacheFullFrames[this._currentPlayClipIndex],this,a,l)),this._setAnimationClipPropertyToAnimationNode(o,l,a)),this._curAvatarNodeDatas=e._getAvatarDataWithCache(this._avatar,this._cachePlayRate,s),this._curAvatarNodeDatas||(this._curAvatarNodeDatas=[],this._curAvatarNodeDatas.length=this._avatarNodes.length,e._cacheAvatarData(this._avatar,this._cachePlayRate,s,this._curAvatarNodeDatas),this._evaluateAvatarNodesCacheMode(o,e,e._publicClipDatas,this._curAvatarNodeDatas,e._unCachePropertyMap)),this._updateAvatarNodesToSpriteCacheMode(e,this._curAvatarNodeDatas)}else{var c=this._cacheNodesSpriteOwners[this._currentPlayClipIndex];a||((a=[]).length=this._currentPlayClip._nodes.length,e._evaluateAnimationlDatasCacheMode(c,this._cacheFullFrames[this._currentPlayClipIndex],this,a,null),e._cacheAnimationData(r,s,a)),this._setAnimationClipPropertyToSprite3D(c,a)}}else if(a=e._publicClipDatas,this._avatar){if(e._evaluateAnimationlDatasRealTime(this._cacheNodesAvatarOwners[this._currentPlayClipIndex],this.currentPlayTime,a,e._cachePropertyMap),!this._publicAvatarNodeDatas){this._publicAvatarNodeDatas=[];var u=this._avatarNodes.length;this._publicAvatarNodeDatas.length=u;for(var _=1;_<u;_++)this._publicAvatarNodeDatas[_]=new Float32Array(16)}this._curAvatarNodeDatas=this._publicAvatarNodeDatas,this._evaluateAvatarNodesRealTime(this._cacheNodesAvatarOwners[this._currentPlayClipIndex],e,a,this._curAvatarNodeDatas,e._unCachePropertyMap),this._updateAvatarNodesToSpriteRealTime()}else e._evaluateAnimationlDatasRealTime(this._cacheNodesSpriteOwners[this._currentPlayClipIndex],this.currentPlayTime,a,null);this._lastFrameIndex=s}},s._checkAnimationNode=function(t,e){t.name!==e.name||e._transform.dummy||e._isLinkSpriteToAnimationNode(this,t,!0);for(var i=0,n=e._childs.length;i<n;i++)this._checkAnimationNode(t,e.getChildAt(i))},s._load=function(t){t.activeInHierarchy&&i.timer.frameLoop(1,this,this._updateAnimtionPlayer),this._owner.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)},s._unload=function(e){t.prototype._unload.call(this,e),e.activeInHierarchy&&i.timer.clear(this,this._updateAnimtionPlayer),this._owner.off("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged),this._curAvatarNodeDatas=null},s._destroy=function(){t.prototype._destroy.call(this);for(var e=0,i=this._clips.length;e<i;e++)this._clips[e]._removeReference();this._currentPlayClip=null,this._clipNames=null,this._cacheNodesSpriteOwners=null,this._cacheNodesAvatarOwners=null,this._cacheNodesDefaultlValues=null,this._clips=null,this._cacheFullFrames=null},s._cloneTo=function(t){var e=t;e.avatar=this.avatar,this._clips.length;for(var i=0,n=this._clips.length;i<n;i++)e.addClip(this._clips[i]);if(this.clip&&(e.clip=this.clip),this._linkSpritesData)for(var r in e._linkSpritesData={},this._linkSpritesData)e._linkSpritesData[r]=this._linkSpritesData[r].slice()},s.addClip=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=4294967295),e=e||t.name;var r=this._clipNames.indexOf(e);if(-1!==r){if(this._clips[r]!==t)throw new Error("Animation:this playName has exist with another clip.")}else{var a=this._clips.indexOf(t);if(i<0||n<0)throw new Error("Animator:startFrame and endFrame must large than zero.");if(i>n)throw new Error("Animator:startFrame must less than endFrame.");this._clipNames.push(e),this._clips.push(t),this._playStartFrames.push(i),this._playEndFrames.push(n),this._cacheNodesSpriteOwners.push([]),this._cacheNodesAvatarOwners.push([]),this._cacheNodesDefaultlValues.push([]),this._publicClipsDatas.push([]),t._addReference(),a=this._clips.length-1,this._avatar?this._avatar.loaded?this._getAvatarOwnersByClipAsync(a,t):this._avatar.once("loaded",this,this._getAvatarOwnersByClipAsync,[a,t]):this._getSpriteOwnersByClipAsync(a,t),t.loaded?this._computeCacheFullKeyframeIndices(a):t.once("loaded",this,this._computeCacheFullKeyframeIndices,[a])}},s.removeClip=function(t){var e=this._clips.indexOf(t);-1!==e&&(this._avatar?this._offClipAndAvatarRelateEvent(this._avatar,t):this._offGetSpriteOwnersByClipAsyncEvent(t),this._offGetClipCacheFullKeyframeIndicesEvent(t),this._clipNames.splice(e,1),this._clips.splice(e,1),this._playStartFrames.splice(e,1),this._playEndFrames.splice(e,1),this._cacheNodesSpriteOwners.splice(e,1),this._cacheNodesAvatarOwners.splice(e,1),this._cacheNodesDefaultlValues.splice(e,1),this._publicClipsDatas.splice(e,1),t._removeReference())},s.removeClipByName=function(t){var e=this._clipNames.indexOf(t);if(-1!==e){var i=this._clips[e];this._avatar?this._offClipAndAvatarRelateEvent(this._avatar,i):this._offGetSpriteOwnersByClipAsyncEvent(i),this._offGetClipCacheFullKeyframeIndicesEvent(i),this._clipNames.splice(e,1),this._clips.splice(e,1),this._playStartFrames.splice(e,1),this._playEndFrames.splice(e,1),this._cacheNodesSpriteOwners.splice(e,1),this._cacheNodesAvatarOwners.splice(e,1),this._cacheNodesDefaultlValues.splice(e,1),this._publicClipsDatas.splice(e,1)}},s.getClip=function(t){var e=this._clipNames.indexOf(t);return-1!==e?this._clips[e]:null},s.getClipCount=function(){return this._clips.length},s.play=function(t,e){if(void 0===e&&(e=1),!t&&-1==this._defaultClipIndex)throw new Error("Animator:must have  default clip value,please set clip property.");t?(this._currentPlayClipIndex=this._clipNames.indexOf(t),this._currentPlayClip=this._clips[this._currentPlayClipIndex]):(this._currentPlayClipIndex=this._defaultClipIndex,this._currentPlayClip=this._clips[this._defaultClipIndex]),this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this._playEventIndex=0,this.playbackRate=e,this._stoped=!1,this._currentFrameIndex=0,this._startUpdateLoopCount=D.loopCount,this._lastPlayAnimationClip&&this._lastPlayAnimationClip!==this._currentPlayClip&&this._revertKeyframeNodes(this._lastPlayAnimationClip,this._lastPlayAnimationClipIndex),this._updatePlayer(0),this._lastPlayAnimationClip=this._currentPlayClip,this._lastPlayAnimationClipIndex=this._currentPlayClipIndex},s.stop=function(){0!==this.playState&&(this._stoped=!0,this.event("stopped"))},s._getLinkSpritePath=function(t,e){e.unshift(t.name);var i=t._parent;i._hierarchyAnimator===this?this._getLinkSpritePath(i,e):e.shift()},s.linkSprite3DToAvatarNode=function(t,e){if(e._hierarchyAnimator===this){if(this._avatar){var i=this._avatarNodeMap[t];if(i){this._linkSpritesData=this._linkSpritesData||{};var n=[];return this._getLinkSpritePath(e,n),this._linkSpritesData[t]=n,e._isLinkSpriteToAnimationNode(this,i,!0),!0}return!1}return!1}throw"Animator:sprite3D must belong to this Animator"},s.unLinkSprite3DToAvatarNode=function(t){if(this._avatar){var e=t.transform.dummy;if(e){var i=this._avatarNodeMap[e._owner.name];return t._isLinkSpriteToAnimationNode(this,i,!1),!0}return!1}return!1},a(0,s,"playState",function(){return null==this._currentPlayClip?0:this._stoped?0:2}),a(0,s,"avatar",function(){return this._avatar},function(t){if(this._avatar!==t){var e=this._avatar;this._avatar=t;for(var i=this._clips.length,n=0;n<i;n++)this._offClipAndAvatarRelateEvent(e,this._clips[n]);t&&(t.loaded?this._getAvatarOwnersAndInitDatasAsync():t.once("loaded",this,this._getAvatarOwnersAndInitDatasAsync))}}),a(0,s,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){if(this._cacheFrameRate!==t){this._cacheFrameRate=t,this._cacheFrameRateInterval=1/this._cacheFrameRate;for(var e=0,i=this._clips.length;e<i;e++)this._clips[e].loaded&&this._computeCacheFullKeyframeIndices(e)}}),a(0,s,"clip",function(){return this._clips[this._defaultClipIndex]},function(t){var e=t?this._clips.indexOf(t):-1;this._defaultClipIndex!==e&&(-1!==this._defaultClipIndex&&this.removeClip(this._clips[this._defaultClipIndex]),-1!==e&&this.addClip(t,t.name),this._defaultClipIndex=e)}),a(0,s,"currentFrameIndex",function(){return this._currentFrameIndex}),a(0,s,"cachePlayRate",function(){return this._cachePlayRate},function(t){if(this._cachePlayRate!==t){this._cachePlayRate=t;for(var e=0,i=this._clips.length;e<i;e++)this._clips[e].loaded&&this._computeCacheFullKeyframeIndices(e)}}),a(0,s,"currentFrameTime",function(){return this._currentFrameTime}),a(0,s,"currentPlayClip",function(){return this._currentPlayClip}),a(0,s,"currentPlayTime",function(){return this._currentTime+this._playStartFrames[this._currentPlayClipIndex]/this._currentPlayClip._frameRate}),a(0,s,"playbackTime",null,function(t){if(null!=this._currentPlayClip&&this._currentPlayClip&&this._currentPlayClip.loaded){this._startUpdateLoopCount=D.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentFrameIndex=Math.floor(this.currentPlayTime/e),this._currentFrameTime=this._currentFrameIndex*e}}),a(0,s,"paused",function(){return this._stoped},function(t){this._stoped=t,t&&this.event("paused")}),n(e,["deafaultMatrix",function(){return this.deafaultMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new Float32Array(16)}]),e}(Je),Ti=(function(t){function e(){this._attachSkeleton=null,this._extenData=null,this.attachBones=null,this.matrixs=null,e.__super.call(this),this.attachBones=[],this.matrixs=[]}r(e,"laya.d3.component.AttachPoint",t);var i=e.prototype;i._load=function(e){t.prototype._load.call(this,e),this._attachSkeleton=e.getComponentByType(Qi)},i._update=function(t){if(this._attachSkeleton&&!this._attachSkeleton.destroyed&&0!==this._attachSkeleton.player.state&&this._attachSkeleton.curBonesDatas){var e=this._attachSkeleton.player,i=this._attachSkeleton.templet;this.matrixs.length=this.attachBones.length;for(var n=this._attachSkeleton.curBonesDatas,r=this.owner.transform.worldMatrix,a=0,s=this.attachBones.length;a<s;a++){var o=16*i.getNodeIndexWithName(e.currentAnimationClipIndex,this.attachBones[a]),l=this.matrixs[a];l||(l=this.matrixs[a]=new be);for(var h=l.elements,c=0;c<16;c++)h[c]=n[o+c];be.multiply(r,l,l)}this.event("complete")}}}(Je),function(t){function e(){e.__super.call(this),this._isRigidbody=!1,this._runtimeCollisonMap={},this._runtimeCollisonTestMap={},this._ignoreCollisonMap={},this.isTrigger=!0}r(e,"laya.d3.component.physics.Collider",t);var i=e.prototype;return i._clearCollsionMap=function(){for(var t in this._runtimeCollisonMap){var e=this._runtimeCollisonMap[t];delete e._runtimeCollisonMap[this.id],e._isRigidbody&&delete e._runtimeCollisonTestMap[this.id];var i=e.id;delete this._runtimeCollisonMap[i],this._isRigidbody&&delete this._runtimeCollisonTestMap[i]}},i._unload=function(t){for(var e in this._runtimeCollisonMap){var i=this._runtimeCollisonMap[e];delete i._runtimeCollisonMap[this.id],i._isRigidbody&&delete i._runtimeCollisonTestMap[this.id],delete this._ignoreCollisonMap[e]._ignoreCollisonMap[this.id]}},i._setIsRigidbody=function(t){if(this._isRigidbody!==t){this._isRigidbody=t;var e=this._owner;if(e.displayedInStage){var i=e.layer;i._removeCollider(this),i._addCollider(this)}}},i._getType=function(){return-1},i._collisonTo=function(t){return!1},i.raycast=function(t,e,i){throw void 0===i&&(i=1.79e308),new Error("Collider:Must override it.")},a(0,i,"enable",t.prototype._$get_enable,function(t){this._enable!==t&&(this._owner.displayedInStage&&(t||this._clearCollsionMap()),this._enable=t,this.event("enablechanged",this._enable))}),a(0,i,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!1,e}(Je)),wi=function(t){function e(){e.__super.call(this)}return r(e,"laya.d3.component.Rigidbody",t),a(0,e.prototype,"enable",t.prototype._$get_enable,function(t){if(this._enable!==t){for(var e=this._owner._colliders,i=0,n=e.length;i<n;i++){var r=e[i];r._setIsRigidbody(t);var a=r._runtimeCollisonMap,s=r._runtimeCollisonTestMap;if(!t)for(var o in a)delete s[o]}this._enable=t,this.event("enablechanged",this._enable)}}),e}(Je),Ci=(function(t){function e(){e.__super.call(this)}r(e,"laya.d3.component.Script",Je);var i=e.prototype;i.onTriggerEnter=function(t){},i.onTriggerExit=function(t){},i.onTriggerStay=function(t){},a(0,i,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!1}(),function(t){function e(t){e.__super.call(this,t)}r(e,"laya.d3.core.GlitterRender",ei);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},i._renderUpdate=function(t){this._setShaderValueMatrix4x4(0,this._owner.transform.worldMatrix);var e=this._owner.getProjectionViewWorldMatrix(t);this._setShaderValueMatrix4x4(1,e);var i=this._owner.templet;return this._setShaderValueNumber(3,i.lifeTime),this._setShaderValueNumber(2,i._currentTime),!0},e}()),bi=function(t){function e(t){this._owner=null,this._sharedMesh=null,e.__super.call(this),this._owner=t}r(e,"laya.d3.core.MeshFilter",t);var i=e.prototype;return i._sharedMeshLoaded=function(){this.event("loaded")},i._destroy=function(){t.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},a(0,i,"sharedMesh",function(){return this._sharedMesh},function(t){var e=this._sharedMesh;e&&e._removeReference(),this._sharedMesh=t,t._addReference(),this.event("meshchanged",[this,e,t]),t.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),a(0,i,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),a(0,i,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),a(0,i,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),a(0,i,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),e}(ti),Mi=function(t){function e(t){e.__super.call(this,t),t.meshFilter.on("meshchanged",this,this._onMeshChanged)}r(e,"laya.d3.core.MeshRender",ei);var i=e.prototype;return i._onMeshChanged=function(t,e,i){i.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:i.once("loaded",this,this._onMeshLoaed)},i._onMeshLoaed=function(t,e){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},i._calculateBoundingSphereByInitSphere=function(t){var e,i=this._owner.transform,n=i.scale.elements,r=Math.abs(n[0]),a=Math.abs(n[1]),s=Math.abs(n[2]);e=r>=a&&r>=s?r:a>=s?a:s,Pe.transformCoordinate(t.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*e},i._calculateBoundBoxByInitCorners=function(t){for(var e=this._owner.transform.worldMatrix,i=0;i<8;i++)Pe.transformCoordinate(t[i],e,ei._tempBoundBoxCorners[i]);Se.createfromPoints(ei._tempBoundBoxCorners,this._boundingBox)},i._calculateBoundingSphere=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(t.boundingSphere)},i._calculateBoundingBox=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(t.boundingBoxCorners)},i._renderUpdate=function(t){var e=this._owner.transform;if(e){this._setShaderValueMatrix4x4(0,e.worldMatrix);var i=this._owner.getProjectionViewWorldMatrix(t);this._setShaderValueMatrix4x4(1,i)}else this._setShaderValueMatrix4x4(0,be.DEFAULT),this._setShaderValueMatrix4x4(1,t);return Qe.debugMode&&this._renderRenderableBoundBox(),!0},e}(),Ii=function(t){function e(t){e.__super.call(this),this._tempRotationMatrix=new be,this._uvLength=new Le,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._owner=t,this._ownerRender=t.particleRender,this._boundingBoxCorners=s(8,null),this._boundingSphere=new Ee(new Pe,Number.MAX_VALUE),this._boundingBox=new Se(new Pe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new Pe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this._currentTime=0,this._isEmitting=!1,this._isPlaying=!1,this._isPaused=!1,this._burstsIndex=0,this._frameRateTime=0,this._emissionTime=0,this._totalDelayTime=0,this._simulateUpdate=!1,this._bufferMaxParticles=1,this.duration=5,this.looping=!0,this.prewarm=!1,this.startDelayType=0,this.startDelay=0,this.startDelayMin=0,this.startDelayMax=0,this._startLifetimeType=0,this._startLifetimeConstant=5,this._startLifeTimeGradient=new $,this._startLifetimeConstantMin=0,this._startLifetimeConstantMax=5,this._startLifeTimeGradientMin=new $,this._startLifeTimeGradientMax=new $,this._maxStartLifetime=5,this.startSpeedType=0,this.startSpeedConstant=5,this.startSpeedConstantMin=0,this.startSpeedConstantMax=5,this.threeDStartSize=!1,this.startSizeType=0,this.startSizeConstant=1,this.startSizeConstantSeparate=new Pe(1,1,1),this.startSizeConstantMin=0,this.startSizeConstantMax=1,this.startSizeConstantMinSeparate=new Pe(0,0,0),this.startSizeConstantMaxSeparate=new Pe(1,1,1),this.threeDStartRotation=!1,this.startRotationType=0,this.startRotationConstant=0,this.startRotationConstantSeparate=new Pe(0,0,0),this.startRotationConstantMin=0,this.startRotationConstantMax=0,this.startRotationConstantMinSeparate=new Pe(0,0,0),this.startRotationConstantMaxSeparate=new Pe(0,0,0),this.randomizeRotationDirection=0,this.startColorType=0,this.startColorConstant=new Ne(1,1,1,1),this.startColorConstantMin=new Ne(1,1,1,1),this.startColorConstantMax=new Ne(1,1,1,1),this.gravityModifier=0,this.simulationSpace=1,this.scaleMode=0,this.playOnAwake=!0,this._rand=new Ae(0),this.autoRandomSeed=!0,this.randomSeed=new Uint32Array(1),this._randomSeeds=new Uint32Array(e._RANDOMOFFSET.length),this.isPerformanceMode=!0,this._emission=new X,this._emission.enbale=!0,this._owner.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)}r(e,"laya.d3.core.particleShuriKen.ShurikenParticleSystem",t);var o=e.prototype;return i.imps(o,{"laya.d3.core.render.IRenderable":!0,"laya.d3.core.IClone":!0}),o._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},o._getIndexBuffer=function(){return this._indexBuffer},o._generateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},o._generateBoundingBox=function(){var t=this._owner.particleRender,i=this._boundingBox.min,n=this._boundingBox.max,r=0,a=0,s=NaN;switch(this.startLifetimeType){case 0:s=this.startLifetimeConstant;break;case 1:s=-Number.MAX_VALUE;var o=o;for(r=0,a=o.gradientCount;r<a;r++)s=Math.max(s,o.getValueByIndex(r));break;case 2:s=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:s=-Number.MAX_VALUE;var l=l;for(r=0,a=l.gradientCount;r<a;r++)s=Math.max(s,l.getValueByIndex(r));var h=h;for(r=0,a=h.gradientCount;r<a;r++)s=Math.max(s,h.getValueByIndex(r))}var c,u,_,d,f=NaN,p=NaN;switch(this.startSpeedType){case 0:f=p=this.startSpeedConstant;break;case 1:break;case 2:f=this.startLifetimeConstantMin,p=this.startLifetimeConstantMax}this._shape&&this._shape.enable||(c=u=Pe.ZERO,_=Pe.ZERO,d=Pe.UnitZ);var m=new Pe(_.x*f,_.y*f,_.z*f),g=new Pe(d.x*p,d.y*p,d.z*p);if(this._velocityOverLifetime&&this._velocityOverLifetime.enbale){var y=this._velocityOverLifetime.velocity;switch(y.type){case 0:y.constant;break;case 1:new Pe(y.gradientX.getAverageValue(),y.gradientY.getAverageValue(),y.gradientZ.getAverageValue());break;case 2:y.constantMin,y.constantMax;break;case 3:new Pe(y.gradientXMin.getAverageValue(),y.gradientYMin.getAverageValue(),y.gradientZMin.getAverageValue()),new Pe(y.gradientXMax.getAverageValue(),y.gradientYMax.getAverageValue(),y.gradientZMax.getAverageValue())}}var v,S,x,E,T=this._owner.transform,w=T.position,C=e._tempVector39,b=C.elements,M=t.renderMode;switch(this.scaleMode){case 0:var I=T.scale;v=I,b[0]=I.x,b[1]=I.z,b[2]=I.y,1===M&&(S=I);break;case 1:var D=T.localScale;v=D,b[0]=D.x,b[1]=D.z,b[2]=D.y,1===M&&(S=D);break;case 2:v=T.scale,b[0]=b[1]=b[2]=1,1===M&&(S=Pe.ONE)}switch(this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(x=new Pe(m.x*s,m.y*s,m.z*s),E=new Pe(g.x*s,g.y*s,g.z*s),2!=this.scaleMode?(Pe.add(c,x,i),Pe.multiply(v,i,i),Pe.add(u,E,n),Pe.multiply(v,n,n)):(Pe.multiply(v,c,i),Pe.add(i,x,i),Pe.multiply(v,u,n),Pe.add(n,E,n))),this.simulationSpace){case 0:break;case 1:Pe.add(i,w,i),Pe.add(n,w,n)}var A=NaN,R=NaN;switch(this.startSizeType){case 0:if(this.threeDStartSize){var L=L;A=Math.max(L.x,L.y),1===M&&(R=L.y)}else A=this.startSizeConstant,1===M&&(R=this.startSizeConstant);break;case 1:break;case 2:if(this.threeDStartSize){var P=P;A=Math.max(P.x,P.y),1===M&&(R=P.y)}else A=this.startSizeConstantMax,1===M&&(R=this.startSizeConstantMax)}this._sizeOverLifetime&&this._sizeOverLifetime.enbale&&(this._sizeOverLifetime.size,A*=this._sizeOverLifetime.size.getMaxSizeInGradient());var N=e._tempVector30,O=N.elements,V=NaN,k=NaN;switch(M){case 0:V=A*e.halfKSqrtOf2,Pe.scale(C,A,N),Pe.subtract(i,N,i),Pe.add(n,N,n);break;case 1:var F=e._tempVector31,B=e._tempVector32,U=e._tempVector33,H=e._tempVector34;this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(Pe.multiply(S,g,B),Pe.multiply(S,m,U));var G=R*t.stretchedBillboardLengthScale,W=Pe.scalarLength(B)*t.stretchedBillboardSpeedScale+G,z=Pe.scalarLength(U)*t.stretchedBillboardSpeedScale+G,Y=e._tempVector35,X=e._tempVector36;Pe.normalize(B,Y),Pe.scale(Y,W,H),Pe.subtract(E,H,H),Pe.normalize(U,X),Pe.scale(X,z,F),Pe.add(x,F,F),V=A*e.halfKSqrtOf2,Pe.scale(C,V,N);var j=e._tempVector37,K=e._tempVector38;Pe.scale(Y,.5,j),Pe.scale(X,.5,K),Pe.multiply(j,C,j),Pe.multiply(K,C,K),Pe.add(i,K,i),Pe.min(i,H,i),Pe.subtract(i,N,i),Pe.subtract(n,j,n),Pe.max(n,F,n),Pe.add(n,N,n);break;case 2:k=.5*(A*=Math.cos(.7853981633974483)),O[0]=C.x*k,O[1]=C.z*k,Pe.subtract(i,N,i),Pe.add(n,N,n);break;case 3:k=.5*(A*=Math.cos(.7853981633974483)),Pe.scale(C,k,N),Pe.subtract(i,N,i),Pe.add(n,N,n)}this._boundingBox.getCorners(this._boundingBoxCorners)},o._updateEmission=function(){if(i.stage.isVisibility&&this.isAlive)if(this._simulateUpdate)this._simulateUpdate=!1;else{var t=this._startUpdateLoopCount===D.loopCount||this._isPaused?0:i.timer.delta/1e3;t=Math.min(e._maxElapsedTime,t),this._updateParticles(t)}},o._updateParticles=function(t){(4!==this._ownerRender.renderMode||this._ownerRender.mesh)&&(this._currentTime+=t,this._retireActiveParticles(),this._freeRetiredParticles(),this._totalDelayTime+=t,this._totalDelayTime<this._playStartDelay||this._emission.enbale&&this._isEmitting&&!this._isPaused&&this._advanceTime(t,this._currentTime))},o._updateParticlesSimulationRestart=function(t){this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._burstsIndex=0,this._frameRateTime=t,this._emissionTime=0,this._totalDelayTime=0,this._currentTime=t;var e=t;e<this._playStartDelay?this._totalDelayTime=e:this._emission.enbale&&this._advanceTime(t,t)},o._addUpdateEmissionToTimer=function(){i.timer.frameLoop(1,this,this._updateEmission)},o._removeUpdateEmissionToTimer=function(){i.timer.clear(this,this._updateEmission)},o._onOwnerActiveHierarchyChanged=function(t){this._owner.displayedInStage&&(t?this._addUpdateEmissionToTimer():this._removeUpdateEmissionToTimer())},o._retireActiveParticles=function(){for(;this._firstActiveElement!=this._firstNewElement;){var t=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride,e=t+this._timeIndex;if(this._currentTime-this._vertices[e]+1e-4<this._vertices[t+this._startLifeTimeIndex])break;this._vertices[e]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this._bufferMaxParticles&&(this._firstActiveElement=0)}},o._freeRetiredParticles=function(){for(;this._firstRetiredElement!=this._firstActiveElement;){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];if(this.isPerformanceMode&&t<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this._bufferMaxParticles&&(this._firstRetiredElement=0)}},o._burst=function(t,e){for(var i=0,n=this._emission._bursts,r=n.length;this._burstsIndex<r;this._burstsIndex++){var a=n[this._burstsIndex],s=a.time;if(!(t<=s&&s<e))break;var o=0;this.autoRandomSeed?o=x.lerp(a.minCount,a.maxCount,Math.random()):(this._rand.seed=this._randomSeeds[0],o=x.lerp(a.minCount,a.maxCount,this._rand.getFloat()),this._randomSeeds[0]=this._rand.seed),i+=o}return i},o._advanceTime=function(t,e){var i=0,n=this._emissionTime;this._emissionTime+=t;var r=0;if(this._emissionTime>this.duration){if(!this.looping){for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);return this._isPlaying=!1,void this.stop()}r+=this._burst(n,this._emissionTime),this._emissionTime-=this.duration,this.event("complete"),this._burstsIndex=0,r+=this._burst(0,this._emissionTime)}else r+=this._burst(n,this._emissionTime);for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);var a=this.emission.emissionRate;if(a>0){var s=1/a;for(this._frameRateTime+=s,this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;this._frameRateTime<=e&&this.emit(this._frameRateTime);)this._frameRateTime+=s;this._frameRateTime=Math.floor(e/s)*s}},o._initBufferDatas=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy());var t=this._ownerRender,e=t.renderMode;if(-1!==e&&this.maxParticles>0){var i,n,r=0,a=0,s=0,o=0,l=0,h=t.mesh;if(4===e){if(h){if(h._vertexBuffers.length>1)throw new Error("ShurikenParticleSystem: submesh Count mesh be One or all subMeshes have the same vertexDeclaration.");n=pe.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=12,this._timeIndex=16,this._vertexStride=h._vertexBuffers[0].vertexCount;var c=this._bufferMaxParticles*this._vertexStride,u=c%65535;if(Math.floor(c/65535)+1>1)throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.");this._vertexBuffer=Ki.create(n,u,35048),this._vertices=new Float32Array(this._floatCountPerVertex*u),this._indexStride=h._indexBuffer.indexCount;var _=h._indexBuffer.getData(),d=this._bufferMaxParticles*this._indexStride;for(this._indexBuffer=ji.create("ushort",d,35044),i=new Uint16Array(d),o=0,r=0;r<this._bufferMaxParticles;r++){var f=r*this._vertexStride;for(a=0,s=_.length;a<s;a++)i[o++]=f+_[a]}this._indexBuffer.setData(i)}}else{for(n=fe.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=7,this._timeIndex=11,this._vertexStride=4,this._vertexBuffer=Ki.create(n,this._bufferMaxParticles*this._vertexStride,35048),this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride),r=0;r<this._bufferMaxParticles;r++)l=r*this._floatCountPerVertex*this._vertexStride,this._vertices[l]=-.5,this._vertices[l+1]=-.5,this._vertices[l+2]=0,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=-.5,this._vertices[l+2]=1,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=.5,this._vertices[l+2]=1,this._vertices[l+3]=0,l+=this._floatCountPerVertex,this._vertices[l]=-.5,this._vertices[l+1]=.5,this._vertices[l+2]=0,this._vertices[l+3]=0;for(this._indexStride=6,this._indexBuffer=ji.create("ushort",6*this._bufferMaxParticles,35044),i=new Uint16Array(6*this._bufferMaxParticles),r=0;r<this._bufferMaxParticles;r++){o=6*r;var p=r*this._vertexStride,m=p+2;i[o++]=p,i[o++]=m,i[o++]=p+1,i[o++]=p,i[o++]=p+3,i[o++]=m}this._indexBuffer.setData(i)}}},o._destroy=function(){t.prototype._destroy.call(this),this._owner.activeInHierarchy&&this._removeUpdateEmissionToTimer(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._emission._destroy(),this._owner=null,this._vertices=null,this._vertexBuffer=null,this._indexBuffer=null,this._emission=null,this._shape=null,this.startLifeTimeGradient=null,this.startLifeTimeGradientMin=null,this.startLifeTimeGradientMax=null,this.startSizeConstantSeparate=null,this.startSizeConstantMinSeparate=null,this.startSizeConstantMaxSeparate=null,this.startRotationConstantSeparate=null,this.startRotationConstantMinSeparate=null,this.startRotationConstantMaxSeparate=null,this.startColorConstant=null,this.startColorConstantMin=null,this.startColorConstantMax=null,this._velocityOverLifetime=null,this._colorOverLifetime=null,this._sizeOverLifetime=null,this._rotationOverLifetime=null,this._textureSheetAnimation=null},o.emit=function(t){var i=e._tempPosition,n=e._tempDirection;if(this._shape&&this._shape.enable)this.autoRandomSeed?this._shape.generatePositionAndDirection(i,n):this._shape.generatePositionAndDirection(i,n,this._rand,this._randomSeeds);else{var r=i.elements,a=n.elements;r[0]=r[1]=r[2]=0,a[0]=a[1]=0,a[2]=1}return this.addParticle(i,n,t)},o.addParticle=function(t,e,i){Pe.normalize(e,e);var n=this._firstFreeElement+1;if(n>=this._bufferMaxParticles&&(n=0),n===this._firstRetiredElement)return!1;if(lt.create(this,this._ownerRender,this._owner.transform),this._currentTime-i>=lt.startLifeTime)return!0;var r=NaN,a=NaN,s=NaN,o=NaN,l=NaN,h=NaN,c=NaN,u=this._velocityOverLifetime&&this._velocityOverLifetime.enbale;if(u){var _=this._velocityOverLifetime.velocity.type;2===_||3===_?this.autoRandomSeed?(r=Math.random(),a=Math.random(),s=Math.random()):(this._rand.seed=this._randomSeeds[9],r=this._rand.getFloat(),a=this._rand.getFloat(),s=this._rand.getFloat(),this._randomSeeds[9]=this._rand.seed):u=!1}else u=!1;var d=this._colorOverLifetime&&this._colorOverLifetime.enbale;d&&3===this._colorOverLifetime.color.type?this.autoRandomSeed?o=Math.random():(this._rand.seed=this._randomSeeds[10],o=this._rand.getFloat(),this._randomSeeds[10]=this._rand.seed):d=!1;var f=this._sizeOverLifetime&&this._sizeOverLifetime.enbale;f&&3===this._sizeOverLifetime.size.type?this.autoRandomSeed?l=Math.random():(this._rand.seed=this._randomSeeds[11],l=this._rand.getFloat(),this._randomSeeds[11]=this._rand.seed):f=!1;var p=this._rotationOverLifetime&&this._rotationOverLifetime.enbale;if(p){var m=this._rotationOverLifetime.angularVelocity.type;2===m||3===m?this.autoRandomSeed?h=Math.random():(this._rand.seed=this._randomSeeds[12],h=this._rand.getFloat(),this._randomSeeds[12]=this._rand.seed):p=!1}else p=!1;var g=this._textureSheetAnimation&&this._textureSheetAnimation.enable;g&&3===this._textureSheetAnimation.frame.type?this.autoRandomSeed?c=Math.random():(this._rand.seed=this._randomSeeds[15],c=this._rand.getFloat(),this._randomSeeds[15]=this._rand.seed):g=!1;var y,v=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride,S=lt.startUVInfo[0],x=lt.startUVInfo[1],E=lt.startUVInfo[2],T=lt.startUVInfo[3],w=t.elements,C=e.elements,b=0,M=0,I=0,D=0,A=0,R=this._ownerRender;if(4===R.renderMode){var L=R.mesh._vertexBuffers[0];y=L.getData();var P=L.vertexDeclaration;M=P.getVertexElementByUsage(0).offset/4;var N=P.getVertexElementByUsage(1);I=N?N.offset/4:-1;var O=P.getVertexElementByUsage(2);D=O?O.offset/4:-1,b=P.vertexStride/4,A=0}else{this._vertices[v+2]=E,this._vertices[v+3]=T+x;var V=v+this._floatCountPerVertex;this._vertices[V+2]=E+S,this._vertices[V+3]=T+x;var k=V+this._floatCountPerVertex;this._vertices[k+2]=E+S,this._vertices[k+3]=T;var F=k+this._floatCountPerVertex;this._vertices[F+2]=E,this._vertices[F+3]=T}for(var B=v,U=v+this._floatCountPerVertex*this._vertexStride;B<U;B+=this._floatCountPerVertex){var H=0;if(4===R.renderMode){H=B;var G=b*A++,W=G+M;this._vertices[H++]=y[W++],this._vertices[H++]=y[W++],this._vertices[H++]=y[W],-1===I?(this._vertices[H++]=1,this._vertices[H++]=1,this._vertices[H++]=1,this._vertices[H++]=1):(W=G+I,this._vertices[H++]=y[W++],this._vertices[H++]=y[W++],this._vertices[H++]=y[W++],this._vertices[H++]=y[W]),-1===D?(this._vertices[H++]=0,this._vertices[H++]=0):(W=G+D,this._vertices[H++]=E+y[W++]*S,this._vertices[H++]=T+y[W]*x)}else H=B+4;switch(this._vertices[H++]=w[0],this._vertices[H++]=w[1],this._vertices[H++]=w[2],this._vertices[H++]=lt.startLifeTime,this._vertices[H++]=C[0],this._vertices[H++]=C[1],this._vertices[H++]=C[2],this._vertices[H++]=i,this._vertices[H++]=lt.startColor[0],this._vertices[H++]=lt.startColor[1],this._vertices[H++]=lt.startColor[2],this._vertices[H++]=lt.startColor[3],this._vertices[H++]=lt.startSize[0],this._vertices[H++]=lt.startSize[1],this._vertices[H++]=lt.startSize[2],this._vertices[H++]=lt.startRotation[0],this._vertices[H++]=lt.startRotation[1],this._vertices[H++]=lt.startRotation[2],this._vertices[H++]=lt.startSpeed,d&&(this._vertices[H+1]=o),f&&(this._vertices[H+2]=l),p&&(this._vertices[H+3]=h),g&&(this._vertices[H+4]=c),u&&(this._vertices[H+5]=r,this._vertices[H+6]=a,this._vertices[H+7]=s),this.simulationSpace){case 0:H+=8,this._vertices[H++]=lt.simulationWorldPostion[0],this._vertices[H++]=lt.simulationWorldPostion[1],this._vertices[H++]=lt.simulationWorldPostion[2],this._vertices[H++]=lt.simulationWorldRotation[0],this._vertices[H++]=lt.simulationWorldRotation[1],this._vertices[H++]=lt.simulationWorldRotation[2],this._vertices[H++]=lt.simulationWorldRotation[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}}return this._firstFreeElement=n,!0},o.addNewParticlesToVertexBuffer=function(){var t=0;this._firstNewElement<this._firstFreeElement?(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._firstFreeElement-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex)):(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._bufferMaxParticles-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex),this._firstFreeElement>0&&this._vertexBuffer.setData(this._vertices,0,0,this._firstFreeElement*this._vertexStride*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},o._beforeRender=function(t){return this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),!0)},o._render=function(t){var e=0,i=P.mainContext;this._firstActiveElement<this._firstFreeElement?(e=(this._firstFreeElement-this._firstActiveElement)*this._indexStride,i.drawElements(4,e,5123,2*this._firstActiveElement*this._indexStride),D.trianglesFaces+=e/3,D.drawCall++):(e=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride,i.drawElements(4,e,5123,2*this._firstActiveElement*this._indexStride),D.trianglesFaces+=e/3,D.drawCall++,this._firstFreeElement>0&&(e=this._firstFreeElement*this._indexStride,i.drawElements(4,e,5123,0),D.trianglesFaces+=e/3,D.drawCall++))},o.play=function(){if(this._burstsIndex=0,this._isEmitting=!0,this._isPlaying=!0,this._isPaused=!1,this._emissionTime=0,this._totalDelayTime=0,!this.autoRandomSeed)for(var t=0,i=this._randomSeeds.length;t<i;t++)this._randomSeeds[t]=this.randomSeed[0]+e._RANDOMOFFSET[t];switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:this.autoRandomSeed?this._playStartDelay=x.lerp(this.startDelayMin,this.startDelayMax,Math.random()):(this._rand.seed=this._randomSeeds[2],this._playStartDelay=x.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat()),this._randomSeeds[2]=this._rand.seed);break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay,this._startUpdateLoopCount=D.loopCount,this.event("played")},o.pause=function(){this._isPaused=!0,this.event("paused")},o.simulate=function(t,e){void 0===e&&(e=!0),this._simulateUpdate=!0,e?this._updateParticlesSimulationRestart(t):(this._isPaused=!1,this._updateParticles(t)),this.pause()},o.stop=function(){this._burstsIndex=0,this._isEmitting=!1,this._emissionTime=0,this.event("stopped")},o.cloneTo=function(t){var e=t;e.duration=this.duration,e.looping=this.looping,e.prewarm=this.prewarm,e.startDelayType=this.startDelayType,e.startDelay=this.startDelay,e.startDelayMin=this.startDelayMin,e.startDelayMax=this.startDelayMax,e._maxStartLifetime=this._maxStartLifetime,e.startLifetimeType=this.startLifetimeType,e.startLifetimeConstant=this.startLifetimeConstant,this.startLifeTimeGradient.cloneTo(e.startLifeTimeGradient),e.startLifetimeConstantMin=this.startLifetimeConstantMin,e.startLifetimeConstantMax=this.startLifetimeConstantMax,this.startLifeTimeGradientMin.cloneTo(e.startLifeTimeGradientMin),this.startLifeTimeGradientMax.cloneTo(e.startLifeTimeGradientMax),e.startSpeedType=this.startSpeedType,e.startSpeedConstant=this.startSpeedConstant,e.startSpeedConstantMin=this.startSpeedConstantMin,e.startSpeedConstantMax=this.startSpeedConstantMax,e.threeDStartSize=this.threeDStartSize,e.startSizeType=this.startSizeType,e.startSizeConstant=this.startSizeConstant,this.startSizeConstantSeparate.cloneTo(e.startSizeConstantSeparate),e.startSizeConstantMin=this.startSizeConstantMin,e.startSizeConstantMax=this.startSizeConstantMax,this.startSizeConstantMinSeparate.cloneTo(e.startSizeConstantMinSeparate),this.startSizeConstantMaxSeparate.cloneTo(e.startSizeConstantMaxSeparate),e.threeDStartRotation=this.threeDStartRotation,e.startRotationType=this.startRotationType,e.startRotationConstant=this.startRotationConstant,this.startRotationConstantSeparate.cloneTo(e.startRotationConstantSeparate),e.startRotationConstantMin=this.startRotationConstantMin,e.startRotationConstantMax=this.startRotationConstantMax,this.startRotationConstantMinSeparate.cloneTo(e.startRotationConstantMinSeparate),this.startRotationConstantMaxSeparate.cloneTo(e.startRotationConstantMaxSeparate),e.randomizeRotationDirection=this.randomizeRotationDirection,e.startColorType=this.startColorType,this.startColorConstant.cloneTo(e.startColorConstant),this.startColorConstantMin.cloneTo(e.startColorConstantMin),this.startColorConstantMax.cloneTo(e.startColorConstantMax),e.gravityModifier=this.gravityModifier,e.simulationSpace=this.simulationSpace,e.scaleMode=this.scaleMode,e.playOnAwake=this.playOnAwake,e.maxParticles=this.maxParticles,this._emission&&(e._emission=this._emission.clone()),this.shape&&(e.shape=this.shape.clone()),this.velocityOverLifetime&&(e.velocityOverLifetime=this.velocityOverLifetime.clone()),this.colorOverLifetime&&(e.colorOverLifetime=this.colorOverLifetime.clone()),this.sizeOverLifetime&&(e.sizeOverLifetime=this.sizeOverLifetime.clone()),this.rotationOverLifetime&&(e.rotationOverLifetime=this.rotationOverLifetime.clone()),this.textureSheetAnimation&&(e.textureSheetAnimation=this.textureSheetAnimation.clone()),e.isPerformanceMode=this.isPerformanceMode,e._isEmitting=this._isEmitting,e._isPlaying=this._isPlaying,e._isPaused=this._isPaused,e._playStartDelay=this._playStartDelay,e._frameRateTime=this._frameRateTime,e._emissionTime=this._emissionTime,e._totalDelayTime=this._totalDelayTime,e._burstsIndex=this._burstsIndex},o.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},o._getVertexBuffers=function(){return null},a(0,o,"maxParticles",function(){return this._bufferMaxParticles-1},function(t){var e=t+1;e!==this._bufferMaxParticles&&(this._bufferMaxParticles=e,this._initBufferDatas())}),a(0,o,"isEmitting",function(){return this._isEmitting}),a(0,o,"isAlive",function(){return!!(this._isPlaying||this.aliveParticleCount>0)}),a(0,o,"shape",function(){return this._shape},function(t){this._shape!==t&&(t&&t.enable?this._ownerRender._addShaderDefine(yn.SHADERDEFINE_SHAPE):this._ownerRender._removeShaderDefine(yn.SHADERDEFINE_SHAPE),this._shape=t)}),a(0,o,"rotationOverLifetime",function(){return this._rotationOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.angularVelocity;if(!i)return;var n=i.separateAxes,r=i.type;if(t.enbale)switch(n?e._addShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE):e._addShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIME),r){case 0:e._addShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:e._addShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:e._addShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:e._addShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}else e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIME),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);switch(r){case 0:n?e._setShaderValueColor(35,i.constantSeparate):e._setShaderValueNumber(34,i.constant);break;case 1:n?(e._setShaderValueBuffer(37,i.gradientX._elements),e._setShaderValueBuffer(38,i.gradientY._elements),e._setShaderValueBuffer(39,i.gradientZ._elements),e._setShaderValueBuffer(40,i.gradientW._elements)):e._setShaderValueBuffer(36,i.gradient._elements);break;case 2:n?(e._setShaderValueColor(35,i.constantMinSeparate),e._setShaderValueColor(42,i.constantMaxSeparate)):(e._setShaderValueNumber(34,i.constantMin),e._setShaderValueNumber(41,i.constantMax));break;case 3:n?(e._setShaderValueBuffer(37,i.gradientXMin._elements),e._setShaderValueBuffer(44,i.gradientXMax._elements),e._setShaderValueBuffer(38,i.gradientYMin._elements),e._setShaderValueBuffer(45,i.gradientYMax._elements),e._setShaderValueBuffer(39,i.gradientZMin._elements),e._setShaderValueBuffer(46,i.gradientZMax._elements),e._setShaderValueBuffer(40,i.gradientWMin._elements),e._setShaderValueBuffer(47,i.gradientWMax._elements)):(e._setShaderValueBuffer(36,i.gradientMin._elements),e._setShaderValueBuffer(43,i.gradientMax._elements))}}else e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIME),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e._removeShaderDefine(yn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES),e._setShaderValueColor(35,null),e._setShaderValueColor(42,null),e._setShaderValueNumber(34,void 0),e._setShaderValueNumber(41,void 0),e._setShaderValueBuffer(37,null),e._setShaderValueBuffer(44,null),e._setShaderValueBuffer(38,null),e._setShaderValueBuffer(45,null),e._setShaderValueBuffer(39,null),e._setShaderValueBuffer(46,null),e._setShaderValueBuffer(40,null),e._setShaderValueBuffer(47,null),e._setShaderValueBuffer(36,null),e._setShaderValueBuffer(43,null);this._rotationOverLifetime=t}),a(0,o,"emission",function(){return this._emission}),a(0,o,"emissionTime",function(){return this._emissionTime>this.duration?this.duration:this._emissionTime}),a(0,o,"aliveParticleCount",function(){return this._firstNewElement>=this._firstRetiredElement?this._firstNewElement-this._firstRetiredElement:this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}),a(0,o,"isPlaying",function(){return this._isPlaying}),a(0,o,"isPaused",function(){return this._isPaused}),a(0,o,"startLifetimeType",function(){return this._startLifetimeType},function(t){var e=0,i=0;switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;var n=n;for(e=0,i=n.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,n.getValueByIndex(e));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var r=r;for(e=0,i=r.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(e));var a=a;for(e=0,i=a.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,a.getValueByIndex(e))}this._startLifetimeType=t}),a(0,o,"_originalBoundingSphere",function(){return this._boundingSphere}),a(0,o,"startLifetimeConstant",function(){return this._startLifetimeConstant},function(t){0===this._startLifetimeType&&(this._maxStartLifetime=t),this._startLifetimeConstant=t}),a(0,o,"startLifetimeConstantMin",function(){return this._startLifetimeConstantMin},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(t,this._startLifetimeConstantMax)),this._startLifetimeConstantMin=t}),a(0,o,"startLifeTimeGradient",function(){return this._startLifeTimeGradient},function(t){if(1===this._startLifetimeType){this._maxStartLifetime=-Number.MAX_VALUE;for(var e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradient=t}),a(0,o,"startLifetimeConstantMax",function(){return this._startLifetimeConstantMax},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,t)),this._startLifetimeConstantMax=t}),a(0,o,"startLifeTimeGradientMin",function(){return this._startLifeTimeGradientMin},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e));for(e=0,i=this._startLifeTimeGradientMax.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(e))}this._startLifeTimeGradientMin=t}),a(0,o,"startLifeTimeGradientMax",function(){return this._startLifeTimeGradientMax},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=this._startLifeTimeGradientMin.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(e));for(e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradientMax=t}),a(0,o,"velocityOverLifetime",function(){return this._velocityOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.velocity,n=i.type;if(t.enbale)switch(n){case 0:e._addShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:e._addShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:e._addShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:e._addShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}else e._removeShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e._removeShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e._removeShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e._removeShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);switch(n){case 0:e._setShaderValueColor(13,i.constant);break;case 1:e._setShaderValueBuffer(14,i.gradientX._elements),e._setShaderValueBuffer(15,i.gradientY._elements),e._setShaderValueBuffer(16,i.gradientZ._elements);break;case 2:e._setShaderValueColor(13,i.constantMin),e._setShaderValueColor(17,i.constantMax);break;case 3:e._setShaderValueBuffer(14,i.gradientXMin._elements),e._setShaderValueBuffer(18,i.gradientXMax._elements),e._setShaderValueBuffer(15,i.gradientYMin._elements),e._setShaderValueBuffer(19,i.gradientYMax._elements),e._setShaderValueBuffer(16,i.gradientZMin._elements),e._setShaderValueBuffer(20,i.gradientZMax._elements)}e._setShaderValueInt(21,t.space)}else e._removeShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e._removeShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e._removeShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e._removeShaderDefine(yn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE),e._setShaderValueColor(13,null),e._setShaderValueBuffer(14,null),e._setShaderValueBuffer(15,null),e._setShaderValueBuffer(16,null),e._setShaderValueColor(13,null),e._setShaderValueColor(17,null),e._setShaderValueBuffer(14,null),e._setShaderValueBuffer(18,null),e._setShaderValueBuffer(15,null),e._setShaderValueBuffer(19,null),e._setShaderValueBuffer(16,null),e._setShaderValueBuffer(20,null),e._setShaderValueInt(21,void 0);this._velocityOverLifetime=t}),a(0,o,"colorOverLifetime",function(){return this._colorOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.color;if(t.enbale)switch(i.type){case 1:e._addShaderDefine(yn.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:e._addShaderDefine(yn.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}else e._removeShaderDefine(yn.SHADERDEFINE_COLOROVERLIFETIME),e._removeShaderDefine(yn.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);switch(i.type){case 1:var n=i.gradient;e._setShaderValueBuffer(22,n._alphaElements),e._setShaderValueBuffer(23,n._rgbElements);break;case 3:var r=i.gradientMin,a=i.gradientMax;e._setShaderValueBuffer(22,r._alphaElements),e._setShaderValueBuffer(23,r._rgbElements),e._setShaderValueBuffer(24,a._alphaElements),e._setShaderValueBuffer(25,a._rgbElements)}}else e._removeShaderDefine(yn.SHADERDEFINE_COLOROVERLIFETIME),e._removeShaderDefine(yn.SHADERDEFINE_RANDOMCOLOROVERLIFETIME),e._setShaderValueBuffer(22,n._alphaElements),e._setShaderValueBuffer(23,n._rgbElements),e._setShaderValueBuffer(22,r._alphaElements),e._setShaderValueBuffer(23,r._rgbElements),e._setShaderValueBuffer(24,a._alphaElements),e._setShaderValueBuffer(25,a._rgbElements);this._colorOverLifetime=t}),a(0,o,"sizeOverLifetime",function(){return this._sizeOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.size,n=i.separateAxes,r=i.type;if(t.enbale)switch(r){case 0:n?e._addShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE):e._addShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:n?e._addShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE):e._addShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES)}else e._removeShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e._removeShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e._removeShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e._removeShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);switch(r){case 0:n?(e._setShaderValueBuffer(27,i.gradientX._elements),e._setShaderValueBuffer(28,i.gradientY._elements),e._setShaderValueBuffer(29,i.gradientZ._elements)):e._setShaderValueBuffer(26,i.gradient._elements);break;case 2:n?(e._setShaderValueBuffer(27,i.gradientXMin._elements),e._setShaderValueBuffer(31,i.gradientXMax._elements),e._setShaderValueBuffer(28,i.gradientYMin._elements),e._setShaderValueBuffer(32,i.gradientYMax._elements),e._setShaderValueBuffer(29,i.gradientZMin._elements),e._setShaderValueBuffer(33,i.gradientZMax._elements)):(e._setShaderValueBuffer(26,i.gradientMin._elements),e._setShaderValueBuffer(30,i.gradientMax._elements))}}else e._removeShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e._removeShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e._removeShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e._removeShaderDefine(yn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE),e._setShaderValueBuffer(27,null),e._setShaderValueBuffer(31,null),e._setShaderValueBuffer(28,null),e._setShaderValueBuffer(32,null),e._setShaderValueBuffer(29,null),e._setShaderValueBuffer(33,null),e._setShaderValueBuffer(26,null),e._setShaderValueBuffer(30,null);this._sizeOverLifetime=t}),a(0,o,"textureSheetAnimation",function(){return this._textureSheetAnimation},function(t){var e=this._ownerRender;if(t){var i=t.frame,n=i.type;if(t.enable)switch(n){case 1:e._addShaderDefine(yn.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:e._addShaderDefine(yn.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}else e._removeShaderDefine(yn.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e._removeShaderDefine(yn.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);if(1===n||3===n){e._setShaderValueInt(48,t.cycles);var r=t.tiles,a=this._uvLength.elements;a[0]=1/r.x,a[1]=1/r.y,e._setShaderValueVector2(49,this._uvLength)}switch(n){case 1:e._setShaderValueBuffer(50,i.frameOverTimeData._elements);break;case 3:e._setShaderValueBuffer(50,i.frameOverTimeDataMin._elements),e._setShaderValueBuffer(51,i.frameOverTimeDataMax._elements)}}else e._removeShaderDefine(yn.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e._removeShaderDefine(yn.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE),e._setShaderValueInt(48,void 0),e._setShaderValueVector2(49,null),e._setShaderValueBuffer(50,null),e._setShaderValueBuffer(51,null);this._textureSheetAnimation=t}),a(0,o,"_vertexBufferCount",function(){return 1}),a(0,o,"triangleCount",function(){return this._indexBuffer?this._indexBuffer.indexCount/3:0}),a(0,o,"_originalBoundingBox",function(){return this._boundingBox}),a(0,o,"_originalBoundingBoxCorners",function(){return this._boundingBoxCorners}),e.halfKSqrtOf2=.71,n(e,["_RANDOMOFFSET",function(){return this._RANDOMOFFSET=new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447])},"_maxElapsedTime",function(){return this._maxElapsedTime=1/3},"_tempVector30",function(){return this._tempVector30=new Pe},"_tempVector31",function(){return this._tempVector31=new Pe},"_tempVector32",function(){return this._tempVector32=new Pe},"_tempVector33",function(){return this._tempVector33=new Pe},"_tempVector34",function(){return this._tempVector34=new Pe},"_tempVector35",function(){return this._tempVector35=new Pe},"_tempVector36",function(){return this._tempVector36=new Pe},"_tempVector37",function(){return this._tempVector37=new Pe},"_tempVector38",function(){return this._tempVector38=new Pe},"_tempVector39",function(){return this._tempVector39=new Pe},"_tempPosition",function(){return this._tempPosition=new Pe},"_tempDirection",function(){return this._tempDirection=new Pe}]),e}(ti),Di=function(t){function e(t){this._finalGravity=new Pe,this._tempRotationMatrix=new be,e.__super.call(this,t),this._defaultBoundBox=new Se(new Pe,new Pe),this._renderMode=-1,this.stretchedBillboardCameraSpeedScale=0,this.stretchedBillboardSpeedScale=0,this.stretchedBillboardLengthScale=1}r(e,"laya.d3.core.particleShuriKen.ShurikenParticleRender",t);var n=e.prototype;return n._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},n._calculateBoundingSphere=function(){var t,e=this._owner.particleSystem._boundingSphere,i=this._owner.transform,n=i.scale.elements,r=Math.abs(n[0]),a=Math.abs(n[1]),s=Math.abs(n[2]);t=r>=a&&r>=s?r:a>=s?a:s,Pe.transformCoordinate(e.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=e.radius*t},n._renderUpdate=function(t){var e=this._owner.particleSystem;if(!i.stage.isVisibility||!e.isAlive)return!1;var n=this._owner.transform;switch(e.simulationSpace){case 0:break;case 1:this._setShaderValueColor(0,n.position),this._setShaderValueColor(1,n.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(e.scaleMode){case 0:var r=n.scale;this._setShaderValueColor(4,r),this._setShaderValueColor(5,r);break;case 1:var a=n.localScale;this._setShaderValueColor(4,a),this._setShaderValueColor(5,a);break;case 2:this._setShaderValueColor(4,n.scale),this._setShaderValueColor(5,Pe.ONE)}var s=this._finalGravity.elements,o=Xe.gravity.elements,l=e.gravityModifier;return s[0]=o[0]*l,s[1]=o[1]*l,s[2]=o[2]*l,this._setShaderValueBuffer(7,s),this._setShaderValueInt(11,e.simulationSpace),this._setShaderValueBool(8,e.threeDStartRotation),this._setShaderValueInt(6,e.scaleMode),this._setShaderValueInt(9,this.stretchedBillboardLengthScale),this._setShaderValueInt(10,this.stretchedBillboardSpeedScale),this._setShaderValueNumber(12,e._currentTime),Qe.debugMode&&this._renderRenderableBoundBox(),!0},n._destroy=function(){t.prototype._destroy.call(this),this._mesh&&(this._mesh._removeReference(),this._mesh=null)},a(0,n,"boundingBox",function(){return this._owner.particleSystem.isAlive?(this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox):this._defaultBoundBox}),a(0,n,"renderMode",function(){return this._renderMode},function(t){if(this._renderMode!==t){switch(this._renderMode){case 0:this._removeShaderDefine(yn.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:this._removeShaderDefine(yn.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:this._removeShaderDefine(yn.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:this._removeShaderDefine(yn.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:this._removeShaderDefine(yn.SHADERDEFINE_RENDERMODE_MESH)}switch(this._renderMode=t,t){case 0:this._addShaderDefine(yn.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:this._addShaderDefine(yn.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:this._addShaderDefine(yn.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:this._addShaderDefine(yn.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:this._addShaderDefine(yn.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}this._owner.particleSystem._initBufferDatas()}}),a(0,n,"mesh",function(){return this._mesh},function(t){this._mesh!==t&&(this._mesh&&this._mesh._removeReference(),this._mesh=t,t&&t._addReference(),this._owner.particleSystem._initBufferDatas())}),e}(ei),Ai=function(t){function e(t){this._owner=null,this._trailRenderElements=null,this._minVertexDistance=NaN,this._widthMultiplier=NaN,this._time=NaN,this._widthCurve=null,this._colorGradient=null,this._textureMode=0,this._curtime=0,this._curSubTrailFinishCurTime=0,this._curSubTrailFinished=!1,this._hasLifeSubTrail=!1,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0,this._isStart=!1,this._trailRenderElementIndex=0,e.__super.call(this),this._curSubTrailFinishPosition=new Pe,this._curSubTrailFinishDirection=new Pe,this._owner=t,this._trailRenderElements=[],this.addRenderElement()}r(e,"laya.d3.core.trail.TrailFilter",t);var i=e.prototype;return i.getRenderElementsCount=function(){return this._trailRenderElements.length},i.addRenderElement=function(){for(var t=0;t<this._trailRenderElements.length;t++)if(1==this._trailRenderElements[t]._isDead)return this._trailRenderElements[t].reActivate(),t;var e=new vt(this);return this._trailRenderElements.push(e),this._trailRenderElements.length-1},i.getRenderElement=function(t){return this._trailRenderElements[t]},i._update=function(t){this._curtime+=t.elapsedTime/1e3,this._owner._render._setShaderValueNumber(3,this._curtime),this._curSubTrailFinished&&(this._curSubTrailFinished=!1,this._trailRenderElementIndex=this.addRenderElement(),this.event("trailfilterchange",[this._trailRenderElementIndex,this._trailRenderElements[this._trailRenderElementIndex]]))},i.reset=function(){for(var t=0;t<this._trailRenderElements.length;t++)this._trailRenderElements[t].reActivate();this._isStart=!1,this._hasLifeSubTrail=!1,this._curSubTrailFinished=!1,this._curSubTrailFinishCurTime=0,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0},i._destroy=function(){t.prototype._destroy.call(this);for(var e=0;e<this._trailRenderElements.length;e++)this._trailRenderElements[e]._destroy();this._trailRenderElements=null,this._widthCurve=null,this._colorGradient=null,this._curSubTrailFinishPosition=null,this._curSubTrailFinishDirection=null},a(0,i,"widthMultiplier",function(){return this._widthMultiplier},function(t){this._widthMultiplier=t}),a(0,i,"time",function(){return this._time},function(t){this._time=t,this._owner._render._setShaderValueNumber(4,t)}),a(0,i,"widthCurve",function(){return this._widthCurve},function(t){this._widthCurve=t;var e,i=new Float32Array(4*t.length),n=0,r=0;for(n=0,e=t.length;n<e;n++)i[r++]=t[n].time,i[r++]=t[n].inTangent,i[r++]=t[n].outTangent,i[r++]=t[n].value;this._owner._render._setShaderValueBuffer(5,i),this._owner._render._setShaderValueInt(6,t.length)}),a(0,i,"minVertexDistance",function(){return this._minVertexDistance},function(t){this._minVertexDistance=t}),a(0,i,"colorGradient",function(){return this._colorGradient},function(t){this._colorGradient=t,this._owner._render._setShaderValueBuffer(7,t._colorKeyData),this._owner._render._setShaderValueBuffer(8,t._alphaKeyData),0==t.mode?this._owner._render._addShaderDefine(Sn.SHADERDEFINE_GRADIENTMODE_BLEND):this._owner._render._removeShaderDefine(Sn.SHADERDEFINE_GRADIENTMODE_BLEND)}),a(0,i,"textureMode",function(){return this._textureMode},function(t){this._textureMode=t}),e}(ti),Ri=function(t){function e(t){e.__super.call(this,t)}r(e,"laya.d3.core.trail.TrailRenderer",ei);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},i._renderUpdate=function(t){return!0},e}(),Li=function(t){function e(t){this._floatCountPerVertex=6,this._owner=null,this._vertices=null,this._vertexBuffer=null,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=NaN,this._drawCounter=0,this.scLeft=null,this.scRight=null,this._numPositionMode=0,this._numPositionVelocityMode=0,this._lastTime=NaN,this._needPatch=!1,this._lastPatchAddPos0=null,this._lastPatchAddPos1=null,this._lastPatchAddTime=NaN,this.lifeTime=NaN,this.minSegmentDistance=NaN,this.minInterpDistance=NaN,this.maxSlerpCount=0,this._maxSegments=0,e.__super.call(this),this._tempVector0=new Pe,this._tempVector1=new Pe,this._tempVector2=new Pe,this._tempVector3=new Pe,this._posModeLastPosition0=new Pe,this._posModeLastPosition1=new Pe,this._posModePosition0=new Pe,this._posModePosition1=new Pe,this._posVelModePosition0=new Pe,this._posVelModeVelocity0=new Pe,this._posVelModePosition1=new Pe,this._posVelModeVelocity1=new Pe,this._owner=t,this._lastTime=0,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0,this._needPatch=!1,this._lastPatchAddPos0=new Pe,this._lastPatchAddPos1=new Pe,this.scLeft=new H,this.scRight=new H,this.lifeTime=.5,this.minSegmentDistance=.1,this.minInterpDistance=.6,this.maxSlerpCount=128,this._maxSegments=200,this._owner.on("activeinhierarchychanged",this,this._onActiveHierarchyChanged)}r(e,"laya.d3.resource.tempelet.GlitterTemplet",t);var n=e.prototype;return i.imps(n,{"laya.d3.core.render.IRenderable":!0}),n._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},n._getIndexBuffer=function(){return null},n._initialize=function(){this._vertexBuffer=Ki.create(It.vertexDeclaration,2*this.maxSegments,35048),this._vertices=new Float32Array(this.maxSegments*this._floatCountPerVertex*2)},n._onActiveHierarchyChanged=function(t){t||(this._numPositionMode=0,this._numPositionVelocityMode=0,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0)},n._updateTextureCoordinates=function(){this._firstActiveElement<this._firstFreeElement?this._updateSubTextureCoordinates(this._firstActiveElement,2*(this._firstFreeElement-this._firstActiveElement)):(this._updateSubTextureCoordinates(this._firstActiveElement,2*(this.maxSegments-this._firstActiveElement)),this._firstFreeElement>0&&this._updateSubTextureCoordinates(0,2*this._firstFreeElement))},n._updateSubTextureCoordinates=function(t,e){for(var i=2*t,n=0;n<e;n+=2){var r=i+n,a=r*this._floatCountPerVertex,s=(r+1)*this._floatCountPerVertex;this._vertices[a+3]=this._vertices[s+3]=(this._vertices[a+5]-this._currentTime)/this.lifeTime}},n._retireActiveGlitter=function(){for(var t=this.lifeTime,e=2*this._floatCountPerVertex;this._firstActiveElement!=this._firstNewElement;){var i=this._firstActiveElement*e+5;if(this._currentTime-this._vertices[i]<t)break;this._vertices[i]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this.maxSegments&&(this._firstActiveElement=0)}},n._freeRetiredGlitter=function(){for(var t=2*this._floatCountPerVertex;this._firstRetiredElement!=this._firstActiveElement&&!(this._drawCounter-this._vertices[this._firstRetiredElement*t+5]<3);)this._firstRetiredElement++,this._firstRetiredElement>=this.maxSegments&&(this._firstRetiredElement=0)},n._calcVelocity=function(t,e,i){Pe.subtract(t,e,i),Pe.scale(i,.5,i)},n._addNewGlitterSegementToVertexBuffer=function(){var t=0;this._firstActiveElement<this._firstFreeElement?(t=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,2*(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex)):(t=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,2*(this.maxSegments-this._firstActiveElement)*this._floatCountPerVertex),this._firstFreeElement>0&&this._vertexBuffer.setData(this._vertices,0,0,2*this._firstFreeElement*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},n._addGlitter=function(t,e,i){this._needPatch&&(this._needPatch=!1,this._addGlitter(this._lastPatchAddPos0,this._lastPatchAddPos1,this._lastPatchAddTime));var n=this._firstFreeElement+1;n>=this.maxSegments&&(n=0,t.cloneTo(this._lastPatchAddPos0),e.cloneTo(this._lastPatchAddPos1),this._lastPatchAddTime=i,this._needPatch=!0),n===this._firstRetiredElement&&console.log("GlitterTemplet:current segement count have large than maxSegments,please adjust the  value of maxSegments or add Glitter Vertex Frequency.");var r=t.elements,a=e.elements,s=0,o=this._firstFreeElement*this._floatCountPerVertex*2;for(s=0;s<3;s++)this._vertices[o+s]=r[s];this._vertices[o+3]=0,this._vertices[o+4]=0,this._vertices[o+5]=i;var l=o+this._floatCountPerVertex;for(s=0;s<3;s++)this._vertices[l+s]=a[s];this._vertices[l+3]=0,this._vertices[l+4]=1,this._vertices[l+5]=i,this._firstFreeElement=n},n._update=function(t){this._currentTime+=t/1e3,this._retireActiveGlitter(),this._freeRetiredGlitter(),this._firstActiveElement==this._firstFreeElement&&(this._currentTime=0),this._firstRetiredElement==this._firstActiveElement&&(this._drawCounter=0),this._updateTextureCoordinates()},n._beforeRender=function(t){return this._firstNewElement!=this._firstFreeElement&&this._addNewGlitterSegementToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement&&(this._vertexBuffer.bindWithIndexBuffer(null),!0)},n._render=function(t){var e=0,i=P.mainContext;this._firstActiveElement<this._firstFreeElement?(e=2*(this._firstFreeElement-this._firstActiveElement),i.drawArrays(5,2*this._firstActiveElement,e),D.trianglesFaces+=e-2,D.drawCall++):(e=2*(this.maxSegments-this._firstActiveElement),i.drawArrays(5,2*this._firstActiveElement,e),D.trianglesFaces+=e-2,D.drawCall++,this._firstFreeElement>0&&(e=2*this._firstFreeElement,i.drawArrays(5,0,e),D.trianglesFaces+=e-2,D.drawCall++))},n.addVertexPosition=function(t,e){if(this._owner.activeInHierarchy)if(this._numPositionMode<2)0===this._numPositionMode?(t.cloneTo(this._posModeLastPosition0),e.cloneTo(this._posModeLastPosition1)):(t.cloneTo(this._posModePosition0),e.cloneTo(this._posModePosition1)),this._numPositionMode++;else{var i=this._tempVector2;this._calcVelocity(t,this._posModeLastPosition0,i);var n=this._tempVector3;this._calcVelocity(e,this._posModeLastPosition1,n),this.addVertexPositionVelocity(this._posModePosition0,i,this._posModePosition1,n),this._posModePosition0.cloneTo(this._posModeLastPosition0),this._posModePosition1.cloneTo(this._posModeLastPosition1),t.cloneTo(this._posModePosition0),e.cloneTo(this._posModePosition1)}},n.addVertexPositionVelocity=function(t,e,i,n){if(this._owner.activeInHierarchy){if(0===this._numPositionVelocityMode)this._numPositionVelocityMode++;else{var r=this._tempVector0;Pe.subtract(t,this._posVelModePosition0,r);var a=Pe.scalarLength(r);Pe.subtract(i,this._posVelModePosition1,r);var s=Pe.scalarLength(r),o=0,l=l;if(a<l&&s<l)return;if(1===(o=1+Math.floor(Math.max(a,s)/this.minInterpDistance)))this._addGlitter(t,i,this._currentTime);else{o=Math.min(o,this.maxSlerpCount),this.scLeft.Init(this._posVelModePosition0,this._posVelModeVelocity0,t,e),this.scRight.Init(this._posVelModePosition1,this._posVelModeVelocity1,i,n);for(var h=1/o,c=h,u=this._currentTime-this._lastTime,_=1;_<=o;_++){var d=this._tempVector0;this.scLeft.Slerp(c,d);var f=this._tempVector1;this.scRight.Slerp(c,f);var p=this._lastTime+u*_/o;this._addGlitter(d,f,p),c+=h}}}this._lastTime=this._currentTime,t.cloneTo(this._posVelModePosition0),e.cloneTo(this._posVelModeVelocity0),i.cloneTo(this._posVelModePosition1),n.cloneTo(this._posVelModeVelocity1)}},n._destroy=function(){t.prototype._destroy.call(this),this._tempVector0=null,this._tempVector1=null,this._tempVector2=null,this._tempVector3=null,this._owner=null,this._vertices=null,this._vertexBuffer.destroy(),this._vertexBuffer=null,this.scLeft=null,this.scRight=null,this._posModeLastPosition0=null,this._posModeLastPosition1=null,this._posModePosition0=null,this._posModePosition1=null,this._posVelModePosition0=null,this._posVelModeVelocity0=null,this._posVelModePosition1=null,this._posVelModeVelocity1=null,this._lastPatchAddPos0=null,this._lastPatchAddPos1=null},n._getVertexBuffers=function(){return null},a(0,n,"maxSegments",function(){return this._maxSegments-1},function(t){var e=t+1;e!==this._maxSegments&&(this._maxSegments=e,this._vertexBuffer&&this._vertexBuffer.destroy(),this._initialize())}),a(0,n,"_vertexBufferCount",function(){return 1}),a(0,n,"triangleCount",function(){var t=0;return this._firstActiveElement<this._firstFreeElement?t=2*(this._firstFreeElement-this._firstActiveElement)-2:(t=2*(this.maxSegments-this._firstActiveElement)-2,t+=2*this._firstFreeElement-2),t}),a(0,n,"_originalBoundingSphere",function(){return i.superGet(ti,this,"_originalBoundingSphere")}),a(0,n,"_originalBoundingBox",function(){return i.superGet(ti,this,"_originalBoundingBox")}),e}(ti),Pi=function(t){function e(t,i,n,r,a,o,l,h){this._owner=null,this._gridSize=NaN,this.memorySize=0,this._numberVertices=0,this._maxNumberIndices=0,this._currentNumberIndices=0,this._numberTriangle=0,this._vertexBuffer=null,this._indexBuffer=null,this._boundingSphere=null,this._boundingBox=null,this._indexArrayBuffer=null,this._boundingBoxCorners=null,this._leafs=null,this._leafNum=0,this._terrainHeightData=null,this._terrainHeightDataWidth=0,this._terrainHeightDataHeight=0,this._chunkOffsetX=0,this._chunkOffsetZ=0,this._cameraCoordinateInverse=!1,this._cameraPos=null,this._currentLOD=0,this._perspectiveFactor=NaN,this._LODTolerance=0,e.__super.call(this),this._owner=t,this._cameraPos=new Pe,this._chunkOffsetX=i,this._chunkOffsetZ=n,this._gridSize=r,this._terrainHeightData=a,this._terrainHeightDataWidth=o,this._terrainHeightDataHeight=l,this._leafNum=Ge.CHUNK_GRID_NUM/Ge.LEAF_GRID_NUM*(Ge.CHUNK_GRID_NUM/Ge.LEAF_GRID_NUM),this._leafs=s(this._leafNum),this._cameraCoordinateInverse=h;for(var c=0;c<this._leafNum;c++)this._leafs[c]=new Ge;this.recreateResource()}r(e,"laya.d3.terrain.TerrainFilter",t);var o=e.prototype;return i.imps(o,{"laya.d3.core.render.IRenderable":!0}),o._destroy=function(){t.prototype._destroy.call(this),this._owner=null,this._vertexBuffer&&this._vertexBuffer.destroy(),this._indexBuffer&&this._indexBuffer.destroy()},o.recreateResource=function(){this._currentNumberIndices=0,this._numberTriangle=0;var t=Ge.LEAF_VERTEXT_COUNT,e=Ge.LEAF_MAX_INDEX_COUNT;this._numberVertices=t*this._leafNum,this._maxNumberIndices=e*this._leafNum,this._indexArrayBuffer=new Uint16Array(this._maxNumberIndices);var i=_e.vertexDeclaration,n=i.vertexStride/4,r=new Float32Array(this._numberVertices*n),a=Ge.CHUNK_GRID_NUM/Ge.LEAF_GRID_NUM,s=0,o=0,l=0;for(s=0;s<this._leafNum;s++)o=s%a,l=Math.floor(s/a),this._leafs[s].calcVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*Ge.LEAF_GRID_NUM,l*Ge.LEAF_GRID_NUM,this._gridSize,r,s*Ge.LEAF_PLANE_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight,this._cameraCoordinateInverse);for(s=0;s<this._leafNum;s++)o=s%a,l=Math.floor(s/a),this._leafs[s].calcSkirtVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*Ge.LEAF_GRID_NUM,l*Ge.LEAF_GRID_NUM,this._gridSize,r,this._leafNum*Ge.LEAF_PLANE_VERTEXT_COUNT+s*Ge.LEAF_SKIRT_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight);this.assembleIndexInit(),this._vertexBuffer=new Ki(i,this._numberVertices,35044,!1),this._indexBuffer=new ji("ushort",this._maxNumberIndices,35044,!1),this._vertexBuffer.setData(r),this._indexBuffer.setData(this._indexArrayBuffer),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.calcOriginalBoudingBoxAndSphere()},o.setLODLevel=function(t){if(4!=t.length)return!0;var e=(t[0]+1<<24)+(t[1]+1<<16)+(t[2]+1<<8)+(t[3]+1);return this._currentLOD!=e&&(this._currentLOD=e,!0)},o.assembleIndexInit=function(){this._currentNumberIndices=0,this._numberTriangle=0;for(var t=0,e=0;e<this._leafNum;e++){var i=Ge.getPlaneLODIndex(e,0);this._indexArrayBuffer.set(i,t),t+=i.length;var n=Ge.getSkirtLODIndex(e,0);this._indexArrayBuffer.set(n,t),t+=n.length,this._currentNumberIndices+=i.length+n.length}this._numberTriangle=this._currentNumberIndices/3},o.isNeedAssemble=function(t,e){var i=Math.min(t.viewport.width,t.viewport.height)/(2*Math.tan(Math.PI*t.fieldOfView/180));return this._perspectiveFactor!=i?(this._perspectiveFactor=i,1):this._LODTolerance!=fn.LOD_TOLERANCE_VALUE?(this._LODTolerance=fn.LOD_TOLERANCE_VALUE,1):0==Pe.equals(e,this._cameraPos)?(this._cameraPos.x=e.x,this._cameraPos.y=e.y,this._cameraPos.z=e.z,2):0},o.assembleIndex=function(t,i){var n=this.isNeedAssemble(t,i);if(n>0){for(var r=0;r<this._leafNum;r++)e._TEMP_ARRAY_BUFFER[r]=this._leafs[r].determineLod(i,this._perspectiveFactor,fn.LOD_TOLERANCE_VALUE,1==n);if(this.setLODLevel(e._TEMP_ARRAY_BUFFER)){this._currentNumberIndices=0,this._numberTriangle=0;var a=0;for(r=0;r<this._leafNum;r++){var s=e._TEMP_ARRAY_BUFFER[r],o=Ge.getPlaneLODIndex(r,s);this._indexArrayBuffer.set(o,a),a+=o.length;var l=Ge.getSkirtLODIndex(r,s);this._indexArrayBuffer.set(l,a),a+=l.length,this._currentNumberIndices+=o.length+l.length}return this._numberTriangle=this._currentNumberIndices/3,!0}}return!1},o.calcOriginalBoudingBoxAndSphere=function(){for(var t=new Le(2147483647,-2147483647),e=0;e<this._leafNum;e++)t.x=this._leafs[e]._sizeOfY.x<t.x?this._leafs[e]._sizeOfY.x:t.x,t.y=this._leafs[e]._sizeOfY.y>t.y?this._leafs[e]._sizeOfY.y:t.y;var i=new Pe(this._chunkOffsetX*Ge.CHUNK_GRID_NUM*this._gridSize,t.x,this._chunkOffsetZ*Ge.CHUNK_GRID_NUM*this._gridSize),n=new Pe((this._chunkOffsetX+1)*Ge.CHUNK_GRID_NUM*this._gridSize,t.y,(this._chunkOffsetZ+1)*Ge.CHUNK_GRID_NUM*this._gridSize);Ge.__ADAPT_MATRIX__&&(Pe.transformV3ToV3(i,Ge.__ADAPT_MATRIX__,i),Pe.transformV3ToV3(n,Ge.__ADAPT_MATRIX__,n)),this._boundingBox=new Se(i,n);var r=new Pe;Pe.subtract(n,i,r),Pe.scale(r,.5,r);var a=new Pe;Pe.add(i,r,a),this._boundingSphere=new Ee(a,Pe.scalarLength(r)),this._boundingBoxCorners=s(8,null),this._boundingBox.getCorners(this._boundingBoxCorners)},o.calcLeafBoudingBox=function(t){for(var e=0;e<this._leafNum;e++)this._leafs[e].calcLeafBoudingBox(t)},o.calcLeafBoudingSphere=function(t,e){for(var i=0;i<this._leafNum;i++)this._leafs[i].calcLeafBoudingSphere(t,e)},o._getVertexBuffer=function(t){return void 0===t&&(t=0),0==t?this._vertexBuffer:null},o._getIndexBuffer=function(){return this._indexBuffer},o._beforeRender=function(t){if(this._vertexBuffer._bind(),this._indexBuffer._bind(),0==t.renderElement._material.blend){var e=t.camera;this.assembleIndex(e,e.position)&&this._indexBuffer.setData(this._indexArrayBuffer)}return!0},o._getVertexBuffers=function(){return null},o._render=function(t){P.mainContext.drawElements(fn.RENDER_LINE_MODEL?1:4,this._currentNumberIndices,5123,0),D.trianglesFaces+=this._numberTriangle,D.drawCall++},a(0,o,"_originalBoundingSphere",function(){return this._boundingSphere}),a(0,o,"_originalBoundingBox",function(){return this._boundingBox}),a(0,o,"_vertexBufferCount",function(){return this._numberVertices}),a(0,o,"triangleCount",function(){return this._numberTriangle}),n(e,["_TEMP_ARRAY_BUFFER",function(){return this._TEMP_ARRAY_BUFFER=new Uint32Array(Ge.CHUNK_GRID_NUM/Ge.LEAF_GRID_NUM*Ge.CHUNK_GRID_NUM/Ge.LEAF_GRID_NUM)}]),e}(ti),Ni=function(t){function e(t){this._terrainSprite3DOwner=null,e.__super.call(this,t),this._terrainSprite3DOwner=t}r(e,"laya.d3.terrain.TerrainRender",t);var i=e.prototype;return i._calculateBoundingSphere=function(){var t=this._terrainSprite3DOwner.terrainFilter;if(null==t)this._boundingSphere.toDefault();else{var e,i=t._originalBoundingSphere,n=this._terrainSprite3DOwner.transform,r=n.scale;e=r.x>=r.y&&r.x>=r.z?r.x:r.y>=r.z?r.y:r.z,Pe.transformCoordinate(i.center,n.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=i.radius*e,t.calcLeafBoudingSphere(n.worldMatrix,e)}},i._calculateBoundingBox=function(){var t=this._terrainSprite3DOwner.terrainFilter;if(null==t)this._boundingBox.toDefault();else{for(var e=this._terrainSprite3DOwner.transform.worldMatrix,i=t._boundingBoxCorners,n=0;n<8;n++)Pe.transformCoordinate(i[n],e,ei._tempBoundBoxCorners[n]);Se.createfromPoints(ei._tempBoundBoxCorners,this._boundingBox),t.calcLeafBoudingBox(e)}},i._renderUpdate=function(t){this._setShaderValueMatrix4x4(0,this._owner.transform.worldMatrix);var e=this._owner.getProjectionViewWorldMatrix(t);return this._setShaderValueMatrix4x4(1,e),!0},i._destroy=function(){t.prototype._destroy.call(this),this._terrainSprite3DOwner=null},e}(ei),Oi=function(t){function e(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,e.__super.call(this),this._renderState=new _t,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new Ue,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new Et,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new Pe(.7,.7,.7),this.ambientColor=new Pe(.212,.227,.259),P.shaderHighPrecision&&this.addShaderDefine(ci.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}r(e,"laya.d3.core.scene.Scene",t);var n=e.prototype;return i.imps(n,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),n._setUrl=function(t){this._url=t},n._getGroup=function(){return this._group},n._setGroup=function(t){this._group=t},n._display=function(){i.stage._scenes.push(this),i.stage._scenes.sort(e._sortScenes);for(var t=0,n=this._childs.length;t<n;t++){var r=this._childs[t];r.active&&r._activeHierarchy()}},n._unDisplay=function(){var t=i.stage._scenes;t.splice(t.indexOf(this),1);for(var e=0,n=this._childs.length;e<n;e++){var r=this._childs[e];r.active&&r._inActiveHierarchy()}},n._addChild3D=function(t){t.transform._onWorldTransform(),t._setBelongScene(this),this.displayedInStage&&t.active&&t._activeHierarchy()},n._removeChild3D=function(t){t.transform.parent=null,this.displayedInStage&&t.active&&t._inActiveHierarchy(),t._setUnBelongScene()},n.initOctree=function(t,e,i,n,r){void 0===r&&(r=6),this.treeSize=new Pe(t,e,i),this.treeLevel=r,this.treeRoot=new dt(this,0),this.treeRoot.init(n,this.treeSize)},n._prepareUpdateToRenderState=function(t,e){e.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,e.scene=this},n._prepareSceneToRender=function(t){var e=this._lights.length;if(e>0)for(var i=0,n=0;n<e&&!(this._lights[n]._prepareToScene(t)&&++i>=this._enableLightCount);n++);},n._updateChilds=function(t){for(var e=0,i=this._childs.length;e<i;++e)this._childs[e]._update(t)},n._preRenderScene=function(t,e,i){var n,r=e._viewMatrix,a=e._projectionMatrix,s=e._projectionViewMatrix,o=0,l=e.camera;for(l.useOcclusionCulling?this.treeRoot?Tt.renderObjectCullingOctree(i,this,l,r,a,s):Tt.renderObjectCulling(i,this,l,r,a,s):Tt.renderObjectCullingNoBoundFrustum(this,l,r,a,s),o=0,n=this._quenes.length;o<n;o++)this._quenes[o]&&this._quenes[o]._preRender(e)},n._clear=function(t,e){var i=e._viewport,n=e.camera,r=i.x,a=n.renderTargetSize.height-i.y-i.height,s=i.width,o=i.height;t.viewport(r,a,s,o);var l=256,h=n.renderTarget;switch(n.clearFlag){case 0:var c=n.clearColor;if(c){t.enable(3089),t.scissor(r,a,s,o);var u=c.elements;t.clearColor(u[0],u[1],u[2],u[3]),l|=16384}if(h)switch(c||(l=16384),h.depthStencilFormat){case 33189:l|=256;break;case 36168:l|=1024;break;case 34041:l|=256,l|=1024}t.clear(l),c&&t.disable(3089);break;case 1:case 2:if(h)switch(l=16384,h.depthStencilFormat){case 33189:l|=256;break;case 36168:l|=1024;break;case 34041:l|=256,l|=1024}t.clear(l);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},n._renderScene=function(t,e){var i,n,r=e.camera,a=0;for(a=0;a<2;a++)(i=this._quenes[a])&&(r.renderTarget?i._render(e,!0):i._render(e,!1));if(1===r.clearFlag){var s=r.sky;s&&(N.setCullFace(t,!1),N.setDepthFunc(t,515),N.setDepthMask(t,!1),s._render(e),N.setDepthFunc(t,513),N.setDepthMask(t,!0))}for(a=2,n=this._quenes.length;a<n;a++)(i=this._quenes[a])&&(i._sortAlpha(e.camera.transform.position),r.renderTarget?i._render(e,!0):i._render(e,!1))},n._set3DRenderConfig=function(t){t.disable(3042),N._blend=!1,t.blendFunc(770,771),N._sFactor=770,N._dFactor=771,t.disable(2929),N._depthTest=!1,t.enable(2884),N._cullFace=!0,t.depthMask(1),N._depthMask=!0,t.frontFace(2304),N._frontFace=2304},n._set2DRenderConfig=function(t){N.setBlend(t,!0),N.setBlendFunc(t,1,771),N.setDepthTest(t,!1),N.setCullFace(t,!1),N.setDepthMask(t,!0),N.setFrontFace(t,2305),t.viewport(0,0,w.width,w.height)},n._parseCustomProps=function(t,e,i,n){var r=n.customProps.lightmaps,a=r.length,s=this._lightmaps;s.length=a;for(var o=0;o<a;o++)s[o]=v.getRes(e[r[o].replace(".exr",".png")]);this.setlightmaps(s);var l=n.customProps.ambientColor;l&&(this.ambientColor=new Pe(l[0],l[1],l[2]));var h=n.customProps.fogColor;h&&(this.fogColor=new Pe(h[0],h[1],h[2]))},n._addLight=function(t){this._lights.indexOf(t)<0&&this._lights.push(t)},n._removeLight=function(t){var e=this._lights.indexOf(t);e>=0&&this._lights.splice(e,1)},n._updateScene=function(){var t=this._renderState;this._prepareUpdateToRenderState(P.mainContext,t),this._updateComponents(t),this._updateChilds(t),this._lateUpdateComponents(t),this._time+=t.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},n._updateSceneConch=function(){var t=this._renderState;this._prepareUpdateToRenderState(P.mainContext,t),this._updateComponents(t),this._lateUpdateComponents(t),this._prepareSceneToRender(t);for(var e=0,i=this._cameraPool.length;e<i;e++){var n=this._cameraPool[e];t.camera=n,n._prepareCameraToRender()}},n._preRenderShadow=function(t,e,i,n,r){this.treeRoot?Tt.renderShadowObjectCullingOctree(this,e,i,n,r):Tt.renderShadowObjectCulling(this,e,i,n,r);for(var a=0,s=i.length;a<s;a++)i[a]&&i[a]._preRender(t)},n._renderShadowMap=function(t,e,i){var n=this.parallelSplitShadowMaps[0];n._calcAllLightCameraInfo(i);var r,a,s,o=n.PSSMNum;if(this._preRenderShadow(e,n._lightCulling,n._shadowQuenes,n._lightVPMatrix[0],o),this.addShaderDefine(He.SHADERDEFINE_CAST_SHADOW),o>1)for(var l=0;l<o;l++)r=n.getRenderTarget(l+1),n.beginRenderTarget(l+1),t.clearColor(1,1,1,1),t.clear(16640),t.viewport(0,0,r.width,r.height),e.camera=s=n.getLightCamera(l),s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix),e._projectionViewMatrix=n._lightVPMatrix[l+1],(a=n._shadowQuenes[l])._preRender(e),a._renderShadow(e,!1),n.endRenderTarget(l+1);else r=n.getRenderTarget(1),n.beginRenderTarget(1),t.clearColor(1,1,1,1),t.clear(16640),t.viewport(0,0,r.width,r.height),e.camera=s=n.getLightCamera(0),s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix),e._projectionViewMatrix=n._lightVPMatrix[0],(a=n._shadowQuenes[0])._preRender(e),a._renderShadow(e,!0),n.endRenderTarget(1);this.removeShaderDefine(He.SHADERDEFINE_CAST_SHADOW)},n.addTreeNode=function(t){this.treeRoot.addTreeNode(t)},n.removeTreeNode=function(t){this.treeSize&&t._treeNode&&t._treeNode.removeObject(t)},n.setlightmaps=function(t){this._lightmaps=t;for(var e=0,i=this._renderableSprite3Ds.length;e<i;e++)this._renderableSprite3Ds[e]._render._applyLightMapParams()},n.getlightmaps=function(){return this._lightmaps},n.addChildAt=function(t,e){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),e>=0&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===E.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),t.parent=this,this._addChild3D(t);return t}throw new Error("appendChildAt:The index is out of bounds")},n.addChild=function(t){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===E.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),t.parent=this,this._childChanged(),this._addChild3D(t);return t},n.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._removeChild3D(e),this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},n.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&this._childs.length>0){var i=this._childs;if(0===t&&e>=a){var n=i;this._childs=E.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,a=n.length;r<a;r++)this._removeChild3D(n[r]),n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},n.addFrustumCullingObject=function(t){this.treeRoot?this.addTreeNode(t):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(t):this._cullingRenders[this._cullingRendersLength]=t,t._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},n.removeFrustumCullingObject=function(t){if(this.treeRoot)this.removeTreeNode(t);else{this._cullingRendersLength--;var e=t._indexInSceneFrustumCullingObjects;if(e!==this._cullingRendersLength){var i=this._cullingRenders[this._cullingRendersLength];this._cullingRenders[e]=i,i._indexInSceneFrustumCullingObjects=e,t._indexInSceneFrustumCullingObjects=-1}}},n.getRenderQueue=function(t){return t<3e3?this._quenes[1]||(this._quenes[1]=new ut(this)):this._quenes[2]||(this._quenes[2]=new ut(this))},n.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new ut(this)},n.addShaderDefine=function(t){this._shaderDefineValue|=t},n.removeShaderDefine=function(t){this._shaderDefineValue&=~t},n.addScript=function(t){return this._addComponent(t)},n.getScriptByType=function(t,e){return void 0===e&&(e=0),this._getComponentByType(t,e)},n.getScriptsByType=function(t,e){this._getComponentsByType(t,e)},n.getScriptByIndex=function(t){return this._getComponentByIndex(t)},n.removeScriptByType=function(t,e){void 0===e&&(e=0),this._removeComponentByType(t,e)},n.removeScriptsByType=function(t){this._removeComponentByType(t)},n.removeAllScript=function(){this._removeAllComponent()},n.render=function(t,e,i){T._context.ctx._renderKey=0,this._childs.length>0&&t.addRenderObject(this)},n.renderSubmit=function(){var t=P.mainContext,e=this._renderState;this._set3DRenderConfig(t),this._prepareSceneToRender(this._renderState);var i,n=0,r=0;if(Qe.debugMode||dt.debugMode)for(n=0,r=this._cameraPool.length;n<r;n++)i=this._cameraPool[n],Qe._debugPhasorSprite.begin(1,i),i.activeInHierarchy&&i._renderCamera(t,e,this),Qe._debugPhasorSprite.end();else for(n=0,r=this._cameraPool.length;n<r;n++)(i=this._cameraPool[n]).activeInHierarchy&&i._renderCamera(t,e,this);return this._set2DRenderConfig(t),1},n.onAsynLoaded=function(t,e,i){var n=e[0];if("Scene"!==n.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var r=e[1];Ze._createNodeByJson(this,n,this,r),this.event("hierarchyloaded",[this]),this.__loaded=!0},n.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,v.clearRes(this.url),this.loaded||Qe._cancelLoadByUrl(this.url))},n.getRenderType=function(){return 0},n.releaseRender=function(){},n._addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=p.getInstance(t);return e.push(this._components.length),this._components.push(n),n._initialize(this),n},n._removeComponent=function(t,e){var i=this._typeComponentsIndices[t],n=i[e],r=this._components[n];this._components.splice(n,1),i.splice(e,1),0===i.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1));for(var a=0,s=this._componentsMap.length;a<s;a++)for(var o=(i=this._typeComponentsIndices[a]).length-1;o>=0;o--){var l=i[o];if(!(l>n))break;i[o]=--l}r._destroy()},n._getComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);return-1===i?null:this._components[this._typeComponentsIndices[i][e]]},n._getComponentsByType=function(t,e){var i=this._componentsMap.indexOf(t);if(-1!==i){var n=this._typeComponentsIndices[i],r=n.length;e.length=r;for(var a=0;a<r;a++)e[a]=this._components[n[a]]}else e.length=0},n._getComponentByIndex=function(t){return this._components[t]},n._removeComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);-1!==i&&this._removeComponent(i,e)},n._removeComponentsByType=function(t){var e=this._componentsMap.indexOf(t);if(-1!==e)for(var i=this._typeComponentsIndices[e],n=0,r=i.length;n<r;i.length<r?r--:n++)this._removeComponent(e,n)},n._removeAllComponent=function(){for(var t=0,e=this._componentsMap.length;t<e;this._componentsMap.length<e?e--:t++)this._removeComponentsByType(this._componentsMap[t])},n._updateComponents=function(t){for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.enable&&n._update(t)}},n._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._lateUpdate(t)}},n._preRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._preRenderUpdate(t)}},n._postRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._postRenderUpdate(t)}},a(0,n,"_loaded",null,function(t){this.__loaded=t}),a(0,n,"fogColor",function(){return this._fogColor},function(t){this._fogColor=t,this._shaderValues.setValue(0,t.elements)}),a(0,n,"enableFog",function(){return this._enableFog},function(t){this._enableFog!==t&&(this._enableFog=t,t?(this.addShaderDefine(ci.SHADERDEFINE_FOG),this.removeShaderDefine(ci.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(ci.SHADERDEFINE_FOG))}),a(0,n,"url",function(){return this._url}),a(0,n,"loaded",function(){return this.__loaded}),a(0,n,"enableDepthFog",function(){return this._enableDepthFog},function(t){this._enableDepthFog!=t&&(this._enableDepthFog=t,t?(this.addShaderDefine(ci.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(ci.SHADERDEFINE_FOG)):this.removeShaderDefine(ci.SAHDERDEFINE_DEPTHFOG))}),a(0,n,"fogStart",function(){return this._fogStart},function(t){this._fogStart=t,this._shaderValues.setValue(1,t)}),a(0,n,"fogRange",function(){return this._fogRange},function(t){this._fogRange=t,this._shaderValues.setValue(2,t)}),a(0,n,"ambientColor",function(){return this._ambientColor},function(t){this._ambientColor=t,this._shaderValues.setValue(21,t.elements)}),a(0,n,"scene",function(){return this}),a(0,n,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),e._sortScenes=function(t,n){if(t.parent===i.stage&&n.parent===i.stage){var r=i.stage._childs;return r.indexOf(t)-r.indexOf(n)}return t.parent!==i.stage&&n.parent!==i.stage?e._sortScenes(t.parent,n.parent):t.parent===i.stage?-1:1},e.load=function(t){return i.loader.create(t,null,null,e)},e.FOGCOLOR=0,e.FOGSTART=1,e.FOGRANGE=2,e.LIGHTDIRECTION=3,e.LIGHTDIRCOLOR=4,e.POINTLIGHTPOS=5,e.POINTLIGHTRANGE=6,e.POINTLIGHTATTENUATION=7,e.POINTLIGHTCOLOR=8,e.SPOTLIGHTPOS=9,e.SPOTLIGHTDIRECTION=10,e.SPOTLIGHTSPOT=11,e.SPOTLIGHTRANGE=12,e.SPOTLIGHTATTENUATION=13,e.SPOTLIGHTCOLOR=14,e.SHADOWDISTANCE=15,e.SHADOWLIGHTVIEWPROJECT=16,e.SHADOWMAPPCFOFFSET=17,e.SHADOWMAPTEXTURE1=18,e.SHADOWMAPTEXTURE2=19,e.SHADOWMAPTEXTURE3=20,e.AMBIENTCOLOR=21,e.TIME=22,e}(I),Vi=function(t){function e(t){e.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new be,this._shaderValues=new Ue,this._colliders=[],this._id=++e._uniqueIDCounter,this._transform=new ii(this),this.name=t||"Sprite3D-"+e._nameNumberCounter++,this.layer=W.currentCreationLayer,this.active=!0}r(e,"laya.d3.core.Sprite3D",di);var n=e.prototype;return i.imps(n,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),n._setUrl=function(t){this._url=t},n._getGroup=function(){return this._group},n._setGroup=function(t){this._group=t},n._addChild3D=function(t){t.transform.parent=this.transform,this._hierarchyAnimator&&(!t._hierarchyAnimator&&t._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(t,!0,[t.name])),this._scene&&(t._setBelongScene(this._scene),this._activeInHierarchy&&t._active&&t._activeHierarchy())},n._removeChild3D=function(t){t.transform.parent=null,this._scene&&(this._activeInHierarchy&&t._active&&t._inActiveHierarchy(),t._setUnBelongScene()),this._hierarchyAnimator&&(t._hierarchyAnimator==this._hierarchyAnimator&&t._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(t,!1,[t.name]))},n._parseBaseCustomProps=function(t){var e=this.transform.localPosition;e.fromArray(t.translate),this.transform.localPosition=e;var i=this.transform.localRotation;i.fromArray(t.rotation),this.transform.localRotation=i;var n=this.transform.localScale;n.fromArray(t.scale),this.transform.localScale=n;var r=t.layer;null!=r&&(this.layer=W.getLayerByNumber(r))},n._parseCustomComponent=function(t,e,i){for(var n in i){var r=i[n];switch(n){case"Animator":var a=this.addComponent(Ei);if(r.avatarPath)a.avatar=v.getRes(e[r.avatarPath]);else{var s=r.avatar;if(s){a.avatar=v.getRes(e[s.path]);var o=s.linkSprites;o&&t.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[a,o])}}for(var l=r.clipPaths,h=l.length,c=0;c<h;c++)a.addClip(v.getRes(e[l[c]]));a.clip=v.getRes(e[l[0]]);var u=r.playOnWake;void 0!==u&&(a.playOnWake=u);break;case"Rigidbody":this.addComponent(wi);break;case"SphereCollider":var _=this.addComponent(tn);_.isTrigger=r.isTrigger;var d=_.center;d.fromArray(r.center),_.center=d,_.radius=r.radius;break;case"BoxCollider":var f=this.addComponent($i);f.isTrigger=r.isTrigger,f.center.fromArray(r.center);var p=f.size;p.fromArray(r.size),f.size=p;break;case"MeshCollider":this.addComponent(Ji)}}},n._onRootNodeHierarchyLoaded=function(t,e){for(var i in e){for(var n=this,r=e[i],a=0,s=r.length;a<s;a++){var o=r[a];if(""===o)break;if(!(n=n.getChildByName(o)))break}n&&t.linkSprite3DToAvatarNode(i,n)}},n._setHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(t);for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i];r._hierarchyAnimator==e&&r._setHierarchyAnimator(t,e)}},n._clearHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(e);for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i];r._hierarchyAnimator==t&&r._clearHierarchyAnimator(t,e)}},n._getAnimatorToLinkSprite3D=function(t,e,i){var n=this.getComponentByType(Ei);if(n&&(n.avatar?n.avatar._version||t._setAnimatorToLinkAvatar(n,e):t._setAnimatorToLinkSprite3DNoAvatar(n,e,i)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){i.unshift(this._parent.name);var r=this._parent;r._hierarchyAnimator&&r._getAnimatorToLinkSprite3D(t,e,i)}},n._setAnimatorToLinkSprite3DNoAvatar=function(t,e,i){var n=0,r=0;for(n=0,r=t.getClipCount();n<r;n++)t._handleSpriteOwnersBySprite(n,e,i,this);for(n=0,r=this._childs.length;n<r;n++){var a=this._childs[n],s=i.length;i.push(a.name),a._setAnimatorToLinkSprite3DNoAvatar(t,e,i),i.splice(s,1)}},n._changeHierarchyAnimator=function(t){this._hierarchyAnimator=t},n._isLinkSpriteToAnimationNode=function(t,e,i){var n=t._avatarNodes.indexOf(e),r=t._cacheSpriteToNodesMap;if(i)this._transform.dummy=e.transform,t._cacheNodesToSpriteMap[n]=r.length,r.push(n);else{this._transform.dummy=null;var a=t._cacheNodesToSpriteMap[n];t._cacheNodesToSpriteMap[n]=null,r.splice(a,1)}},n._setBelongScene=function(t){this._scene=t;for(var e=0,i=this._childs.length;e<i;e++)this._childs[e]._setBelongScene(t)},n._setUnBelongScene=function(){this._scene=null;for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._setUnBelongScene()},n._activeHierarchy=function(){var t=0,e=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),t=0,e=this._colliders.length;t<e;t++)this._layer._addCollider(this._colliders[t]);for(this.event("activeinhierarchychanged",!0),t=0,e=this._childs.length;t<e;t++){var i=this._childs[t];i._active&&i._activeHierarchy()}},n._inActiveHierarchy=function(){var t=0,e=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),t=0,e=this._colliders.length;t<e;t++){var i=this._colliders[t];i._clearCollsionMap(),this._layer._removeCollider(i)}for(this.event("activeinhierarchychanged",!1),t=0,e=this._childs.length;t<e;t++){var n=this._childs[t];n._active&&n._inActiveHierarchy()}},n.addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=p.getInstance(t);if(e.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.physics.Collider)this.getComponentByType(wi)&&(n._isRigidbody=!0),this._activeInHierarchy&&this._layer._addCollider(n),this._colliders.push(n);else if(n instanceof laya.d3.component.Animator){var r=n;this._setHierarchyAnimator(r,this._parent?this._parent._hierarchyAnimator:null),this._setAnimatorToLinkSprite3DNoAvatar(r,!0,[])}else if(n instanceof laya.d3.component.Rigidbody)for(var a=0,s=this._colliders.length;a<s;a++)this._colliders[a]._setIsRigidbody(!0);return n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},n._removeComponent=function(t,e){var i=0,n=0,r=this._typeComponentsIndices[t],a=r[e],s=this._components[a];if(s instanceof laya.d3.component.physics.Collider){var o=s;this._activeInHierarchy&&this._layer._removeCollider(o),this._colliders.splice(this._colliders.indexOf(o),1)}else if(s instanceof laya.d3.component.Animator){var l=s;this._clearHierarchyAnimator(l,this._parent?this._parent._hierarchyAnimator:null)}else if(s instanceof laya.d3.component.Rigidbody)for(i=0,n=this._colliders.length;i<n;i++){var h=this._colliders[i];h._setIsRigidbody(!1);var c=h._runtimeCollisonMap,u=h._runtimeCollisonTestMap;for(var _ in c)delete u[_]}for(this._components.splice(a,1),s instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(s),1),r.splice(e,1),0===r.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1)),i=0,n=this._componentsMap.length;i<n;i++)for(var d=(r=this._typeComponentsIndices[i]).length-1;d>=0;d--){var f=r[d];if(!(f>a))break;r[d]=--f}s._destroy()},n._clearSelfRenderObjects=function(){},n._addSelfRenderObjects=function(){},n._parseCustomProps=function(t,e,i,n){},n._updateChilds=function(t){var e=this._childs.length;if(0!==e)for(var i=0;i<e;++i)this._childs[i]._update(t)},n._getSortID=function(t,e){return 1e3*e.id+t._getVertexBuffer().vertexDeclaration.id},n._update=function(t){t.owner=this,this._activeInHierarchy&&(this._updateComponents(t),this._lateUpdateComponents(t),D.spriteCount++,this._childs.length&&this._updateChilds(t))},n.getProjectionViewWorldMatrix=function(t){return be.multiply(t,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},n.loadHierarchy=function(t){this.addChild(laya.d3.core.Sprite3D.load(t))},n.addChildAt=function(t,e){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),e>=0&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===E.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),t.parent=this,this._addChild3D(t);return t}throw new Error("appendChildAt:The index is out of bounds")},n.addChild=function(t){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===E.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),t.parent=this,this._childChanged(),this._addChild3D(t);return t},n.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._removeChild3D(e),this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},n.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&this._childs.length>0){var i=this._childs;if(0===t&&e>=a){var n=i;this._childs=E.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,a=n.length;r<a;r++)this._removeChild3D(n[r]),n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},n.onAsynLoaded=function(t,e,i){var n=e[0];if("Sprite3D"!==n.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var r=e[1];Ze._createNodeByJson(this,n,this,r),this.event("hierarchyloaded",[this]),this.__loaded=!0},n.cloneTo=function(t){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var e=t;e.name=this.name,e._destroyed=this._destroyed,e.timer=this.timer,e._$P=this._$P,e.active=this._active;var i=e.transform.localPosition;this.transform.localPosition.cloneTo(i),e.transform.localPosition=i;var n=e.transform.localRotation;this.transform.localRotation.cloneTo(n),e.transform.localRotation=n;var r=e.transform.localScale;this.transform.localScale.cloneTo(r),e.transform.localScale=r,e.isStatic=this.isStatic;var a=0,s=0;for(a=0,s=this._componentsMap.length;a<s;a++){var o=e.addComponent(this._componentsMap[a]);this._components[a]._cloneTo(o)}for(a=0,s=this._childs.length;a<s;a++)e.addChild(this._childs[a].clone());var l=e.getComponentByType(Ei);if(l){var h=l._linkSpritesData;if(h)for(var c in h){for(var u=h[c],_=e,d=0,f=u.length;d<f&&(_=_.getChildByName(u[d]));d++);if(_){var p=l._avatarNodeMap[c];_._isLinkSpriteToAnimationNode(l,p,!0)}}}},n.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},n.destroy=function(t){if(void 0===t&&(t=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,t);var e,i=0;for(i=0,e=this._components.length;i<e;i++)this._components[i]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,v.clearRes(this.url),this.loaded||Qe._cancelLoadByUrl(this.url)}},n._handleSpriteToAvatar=function(t,e){t._avatarNodes;var i=t._avatarNodeMap[this.name];i&&i.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(t,i,e)},n._setAnimatorToLinkAvatar=function(t,e){this._handleSpriteToAvatar(t,e);for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._setAnimatorToLinkAvatar(t,e)},a(0,n,"activeInHierarchy",function(){return this._activeInHierarchy}),a(0,n,"_loaded",null,function(t){this.__loaded=t}),a(0,n,"active",function(){return this._active},function(t){this._active!==t&&(this._active=t,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(t?this._activeHierarchy():this._inActiveHierarchy()))}),a(0,n,"componentsCount",function(){return this._components.length}),a(0,n,"loaded",function(){return this.__loaded}),a(0,n,"id",function(){return this._id}),a(0,n,"url",function(){return this._url}),a(0,n,"layer",function(){return this._layer},function(t){if(this._layer!==t){if(!t)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var e=0,i=this._colliders.length;if(this._layer)for(e=0;e<i;e++)this._layer._removeCollider(this._colliders[e]);for(e=0;e<i;e++)t._addCollider(this._colliders[e])}this._layer=t,this.event("layerchanged",t)}}),a(0,n,"scene",function(){return this._scene}),a(0,n,"transform",function(){return this._transform}),e.instantiate=function(t,e,i,n,r){void 0===i&&(i=!0);var a=t.clone();e&&e.addChild(a);var s=a.transform;if(i){var o=s.worldMatrix;t.transform.worldMatrix.cloneTo(o),s.worldMatrix=o}else n&&(s.position=n),r&&(s.rotation=r);return a},e.load=function(t){return i.loader.create(t,null,null,e)},e.WORLDMATRIX=0,e.MVPMATRIX=1,e._uniqueIDCounter=0,e._nameNumberCounter=0,e}(),ki=function(t){function e(t,i,n,r,a,s,o,l){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],e.__super.call(this),!t||!i)throw"Shader Error";this._id=++e._count,this._vs=t,this._ps=i,this._attributeMap=n,this._sceneUniformMap=r,this._cameraUniformMap=a,this._spriteUniformMap=s,this._materialUniformMap=o,this._renderElementUniformMap=l,this.recreateResource()}r(e,"laya.d3.shader.Shader3D",u);var i=e.prototype;return i.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},i.disposeResource=function(){P.mainContext.deleteShader(this._vshader),P.mainContext.deleteShader(this._pshader),P.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},i._compile=function(){if(this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var t=[this._vs,this._ps],i=P.mainContext;if(this._program=i.createProgram(),this._vshader=e._createShader(i,t[0],35633),this._pshader=e._createShader(i,t[1],35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader),i.linkProgram(this._program),!T.isConchApp&&ci.debugMode&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var n,r,a=0,s=0;for(r=T.isConchApp?i.getProgramParameterEx(this._vs,this._ps,"",35721):i.getProgramParameter(this._program,35721),a=0;a<r;a++){var o=null;n={vartype:"attribute",ivartype:0,attrib:o=T.isConchApp?i.getActiveAttribEx(this._vs,this._ps,"",a):i.getActiveAttrib(this._program,a),location:i.getAttribLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(n)}var l;for(l=T.isConchApp?i.getProgramParameterEx(this._vs,this._ps,"",35718):i.getProgramParameter(this._program,35718),a=0;a<l;a++){var h;h=T.isConchApp?i.getActiveUniformEx(this._vs,this._ps,"",a):i.getActiveUniform(this._program,a),(n={vartype:"uniform",ivartype:1,attrib:o,location:i.getUniformLocation(this._program,h.name),name:h.name,type:h.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")>0&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=i.getUniformLocation(this._program,n.name)),this._uniformParams.push(n)}for(a=0,s=this._attributeParams.length;a<s;a++)(n=this._attributeParams[a]).indexOfParams=a,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=null!=this._attributeMap[n.codename]?this._attributeMap[n.codename]:n.codename,this._attributeParamsMap.push(n.name),this._attributeParamsMap.push(n),n._this=this,n.uploadedValue=[],n.fun=this._attribute;for(a=0,s=this._uniformParams.length;a<s;a++)switch((n=this._uniformParams[a]).indexOfParams=a,n.index=1,n.value=[n.location,null],n.codename=n.name,null!=this._sceneUniformMap[n.codename]?(n.name=this._sceneUniformMap[n.codename],this._sceneUniformParamsMap.push(n.name),this._sceneUniformParamsMap.push(n)):null!=this._cameraUniformMap[n.codename]?(n.name=this._cameraUniformMap[n.codename],this._cameraUniformParamsMap.push(n.name),this._cameraUniformParamsMap.push(n)):null!=this._spriteUniformMap[n.codename]?(n.name=this._spriteUniformMap[n.codename],this._spriteUniformParamsMap.push(n.name),this._spriteUniformParamsMap.push(n)):null!=this._materialUniformMap[n.codename]?(n.name=this._materialUniformMap[n.codename],this._materialUniformParamsMap.push(n.name),this._materialUniformParamsMap.push(n)):null!=this._renderElementUniformMap[n.codename]?(n.name=this._renderElementUniformMap[n.codename],this._renderElementUniformParamsMap.push(n.name),this._renderElementUniformParamsMap.push(n)):console.log("Shader:can't find uinform name:"+n.codename+" in shader file."),n._this=this,n.uploadedValue=[],n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;case 35674:n.fun=this._uinformMatrix2fv;break;case 35675:n.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},i._attribute=function(t,e){var i=P.mainContext,n=d._enableAtributes,r=t.location;return n[r]||i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e[0],e[1],e[2],e[3],e[4]),n[r]=d._bindVertexBuffer,1},i._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(P.mainContext.uniform1f(t.location,i[0]=e),1):0},i._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(P.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return P.mainContext.uniform1fv(t.location,e),1},i._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(P.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(P.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return P.mainContext.uniform2fv(t.location,e),1},i._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(P.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3v=function(t,e){return P.mainContext.uniform3fv(t.location,e),1},i._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(P.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4v=function(t,e){return P.mainContext.uniform4fv(t.location,e),1},i._uniformMatrix2fv=function(t,e){return P.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uniformMatrix3fv=function(t,e){return P.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniformMatrix4fv=function(t,e){return P.mainContext.uniformMatrix4fv(t.location,!1,e),1},i._uinformMatrix2fv=function(t,e){return P.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uinformMatrix3fv=function(t,e){return P.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(P.mainContext.uniform1i(t.location,i[0]=e),1):0},i._uniform1iv=function(t,e){return P.mainContext.uniform1iv(t.location,e),1},i._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(P.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_ivec2v=function(t,e){return P.mainContext.uniform2iv(t.location,e),1},i._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(P.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3vi=function(t,e){return P.mainContext.uniform3iv(t.location,e),1},i._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(P.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4vi=function(t,e){return P.mainContext.uniform4iv(t.location,e),1},i._uniform_sampler2D=function(t,i){var n=i.source||i.defaulteTexture.source,r=P.mainContext,a=t.uploadedValue;if(null==a[0]){if(this._curActTexIndex>7)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return a[0]=this._curActTexIndex,r.uniform1i(t.location,this._curActTexIndex),r.activeTexture(e._TEXTURES[this._curActTexIndex]),n&&N.bindTexture(r,3553,n),this._curActTexIndex++,1}return r.activeTexture(e._TEXTURES[a[0]]),n&&N.bindTexture(r,3553,n),0},i._uniform_samplerCube=function(t,i){var n=i.source||i.defaulteTexture.source,r=P.mainContext,a=t.uploadedValue;if(null==a[0]){if(this._curActTexIndex>7)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return a[0]=this._curActTexIndex,r.uniform1i(t.location,this._curActTexIndex),r.activeTexture(e._TEXTURES[this._curActTexIndex]),n?N.bindTexture(r,34067,n):N.bindTexture(r,34067,on.grayTexture.source),this._curActTexIndex++,1}return r.activeTexture(e._TEXTURES[a[0]]),n?N.bindTexture(r,34067,n):N.bindTexture(r,34067,on.grayTexture.source),0},i._noSetValue=function(t){console.log("no....:"+t.name)},i.bind=function(){return u.activeShader=this,u.bindShader=this,this.activeResource(),N.UseProgram(this._program)},i.uploadAttributes=function(t,e){for(var i,n,r=0,a=0,s=this._attributeParamsMap.length;a<s;a+=2)n=this._attributeParamsMap[a+1],null!=(i=t[this._attributeParamsMap[a]])&&(e&&e[n.name]&&e[n.name].bind(),r+=n.fun.call(this,n,i));D.shaderCall+=r},i.uploadAttributesX=function(t,e){for(var i,n,r=0,a=0,s=this._attributeParamsMap.length;a<s;a+=2)n=this._attributeParamsMap[a+1],null!=(i=t[this._attributeParamsMap[a]])&&(e._bind(),r+=n.fun.call(this,n,i));D.shaderCall+=r},i.uploadSceneUniforms=function(t){for(var e,i,n=0,r=0,a=this._sceneUniformParamsMap.length;r<a;r+=2)i=this._sceneUniformParamsMap[r+1],null!=(e=t[this._sceneUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));D.shaderCall+=n},i.uploadCameraUniforms=function(t){for(var e,i,n=0,r=0,a=this._cameraUniformParamsMap.length;r<a;r+=2)i=this._cameraUniformParamsMap[r+1],null!=(e=t[this._cameraUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));D.shaderCall+=n},i.uploadSpriteUniforms=function(t){for(var e,i,n=0,r=0,a=this._spriteUniformParamsMap.length;r<a;r+=2)i=this._spriteUniformParamsMap[r+1],null!=(e=t[this._spriteUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));D.shaderCall+=n},i.uploadMaterialUniforms=function(t){for(var e,i,n=0,r=0,a=this._materialUniformParamsMap.length;r<a;r+=2)i=this._materialUniformParamsMap[r+1],null!=(e=t[this._materialUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));D.shaderCall+=n},i.uploadRenderElementUniforms=function(t){for(var e,i,n=0,r=0,a=this._renderElementUniformParamsMap.length;r<a;r+=2)i=this._renderElementUniformParamsMap[r+1],null!=(e=t[this._renderElementUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));D.shaderCall+=n},e.create=function(t,i,n,r,a,s,o,l){return new e(t,i,n,r,a,s,o,l)},e.addInclude=function(t,e){M.addInclude(t,e)},e._createShader=function(t,e,i){var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),ci.debugMode&&!t.getShaderParameter(n,35713))throw t.getShaderInfoLog(n);return n},e.PERIOD_RENDERELEMENT=0,e.PERIOD_MATERIAL=1,e.PERIOD_SPRITE=2,e.PERIOD_CAMERA=3,e.PERIOD_SCENE=4,e._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],e._count=0,n(e,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new A}]),e}(),Fi=function(t){function e(){e.__super.call(this),this.setShaderName("BLINNPHONG"),this._albedoIntensity=1,this._albedoColor=new Ne(1,1,1,1),this._setColor(6,new Ne(1,1,1,1)),this._setColor(8,new Pe(1,1,1)),this._setNumber(9,.078125),this._setColor(10,new Pe(1,1,1)),this._setNumber(0,.5),this._setColor(11,new Ne(1,1,0,0)),this._enableLighting=!0,this.renderMode=0}r(e,"laya.d3.core.material.BlinnPhongMaterial",t);var s=e.prototype;return s.disableLight=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_POINTLIGHT|ci.SHADERDEFINE_SPOTLIGHT|ci.SHADERDEFINE_DIRECTIONLIGHT)},s.disableFog=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_FOG)},s.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i._enableLighting=this._enableLighting,i._albedoIntensity=this._albedoIntensity,this._albedoColor.cloneTo(i._albedoColor)},a(0,s,"renderMode",null,function(t){switch(t){case 0:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 1:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this.depthTest=513,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),a(0,s,"normalTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,t)}),a(0,s,"reflectColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),a(0,s,"tilingOffset",function(){return this._getColor(11)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(11,t)}),a(0,s,"specularColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),a(0,s,"albedoColor",function(){return this._albedoColor},function(t){var e=this._getColor(6);Ne.scale(t,this._albedoIntensity,e),this._albedoColor=t}),a(0,s,"albedoIntensity",function(){return this._albedoIntensity},function(t){if(this._albedoIntensity!==t){var e=this._getColor(6);Ne.scale(this._albedoColor,t,e),this._albedoIntensity=t}}),a(0,s,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),a(0,s,"shininess",function(){return this._getNumber(9)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(9,t)}),a(0,s,"specularTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,t)}),a(0,s,"reflectTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(5,t)}),a(0,s,"enableLighting",function(){return this._enableLighting},function(t){this._enableLighting!==t&&(t?this._removeDisablePublicShaderDefine(ci.SHADERDEFINE_POINTLIGHT|ci.SHADERDEFINE_SPOTLIGHT|ci.SHADERDEFINE_DIRECTIONLIGHT):this._addDisablePublicShaderDefine(ci.SHADERDEFINE_POINTLIGHT|ci.SHADERDEFINE_SPOTLIGHT|ci.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSEMAP=e.shaderDefines.registerDefine("DIFFUSEMAP"),e.SHADERDEFINE_NORMALMAP=e.shaderDefines.registerDefine("NORMALMAP"),e.SHADERDEFINE_SPECULARMAP=e.shaderDefines.registerDefine("SPECULARMAP"),e.SHADERDEFINE_REFLECTMAP=e.shaderDefines.registerDefine("REFLECTMAP"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET"),e.SHADERDEFINE_ADDTIVEFOG=e.shaderDefines.registerDefine("ADDTIVEFOG")},e.load=function(t){return i.loader.create(t,null,null,e)},e.SPECULARSOURCE_DIFFUSEMAPALPHA=0,e.SPECULARSOURCE_SPECULARMAP=0,e.RENDERMODE_OPAQUE=0,e.RENDERMODE_CUTOUT=1,e.RENDERMODE_TRANSPARENT=2,e.RENDERMODE_ADDTIVE=3,e.SHADERDEFINE_DIFFUSEMAP=0,e.SHADERDEFINE_NORMALMAP=0,e.SHADERDEFINE_SPECULARMAP=0,e.SHADERDEFINE_REFLECTMAP=0,e.SHADERDEFINE_TILINGOFFSET=0,e.SHADERDEFINE_ADDTIVEFOG=0,e.ALBEDOTEXTURE=1,e.NORMALTEXTURE=2,e.SPECULARTEXTURE=3,e.EMISSIVETEXTURE=4,e.REFLECTTEXTURE=5,e.ALBEDOCOLOR=6,e.MATERIALSPECULAR=8,e.SHININESS=9,e.MATERIALREFLECT=10,e.TILINGOFFSET=11,n(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(mi),Bi=function(t){function e(){e.__super.call(this),this.setShaderName("ExtendTerrain"),this.renderMode=1}r(e,"laya.d3.core.material.ExtendTerrainMaterial",mi);var i=e.prototype;return i._setDetailNum=function(t){switch(t){case 1:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4)}},i.disableLight=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_POINTLIGHT|ci.SHADERDEFINE_SPOTLIGHT|ci.SHADERDEFINE_DIRECTIONLIGHT)},a(0,i,"diffuseScaleOffset2",null,function(t){this._setColor(7,t)}),a(0,i,"splatAlphaTexture",function(){return this._getTexture(0)},function(t){this._setTexture(0,t)}),a(0,i,"diffuseScaleOffset3",null,function(t){this._setColor(8,t)}),a(0,i,"diffuseTexture1",null,function(t){this._setTexture(1,t),this._setDetailNum(1)}),a(0,i,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=2e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.depthTest=515;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),a(0,i,"diffuseTexture2",function(){return this._getTexture(2)},function(t){this._setTexture(2,t),this._setDetailNum(2)}),a(0,i,"diffuseScaleOffset1",null,function(t){this._setColor(6,t)}),a(0,i,"diffuseTexture3",function(){return this._getTexture(3)},function(t){this._setTexture(3,t),this._setDetailNum(3)}),a(0,i,"diffuseTexture4",function(){return this._getTexture(4)},function(t){this._setTexture(4,t),this._setDetailNum(4)}),a(0,i,"diffuseTexture5",function(){return this._getTexture(5)},function(t){this._setTexture(5,t),this._setDetailNum(5)}),a(0,i,"diffuseScaleOffset4",null,function(t){this._setColor(9,t)}),a(0,i,"diffuseScaleOffset5",null,function(t){this._setColor(10,t)}),a(0,i,"albedo",function(){return this._getColor(14)},function(t){this._setColor(14,t)}),a(0,i,"ambientColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),a(0,i,"diffuseColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),a(0,i,"specularColor",function(){return this._getColor(13)},function(t){this._setColor(13,t)}),e.__init__=function(){e.SHADERDEFINE_DETAIL_NUM1=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM1"),e.SHADERDEFINE_DETAIL_NUM2=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM2"),e.SHADERDEFINE_DETAIL_NUM3=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM3"),e.SHADERDEFINE_DETAIL_NUM4=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM4"),e.SHADERDEFINE_DETAIL_NUM5=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM5")},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_TRANSPARENT=2,e.SPLATALPHATEXTURE=0,e.DIFFUSETEXTURE1=1,e.DIFFUSETEXTURE2=2,e.DIFFUSETEXTURE3=3,e.DIFFUSETEXTURE4=4,e.DIFFUSETEXTURE5=5,e.DIFFUSESCALEOFFSET1=6,e.DIFFUSESCALEOFFSET2=7,e.DIFFUSESCALEOFFSET3=8,e.DIFFUSESCALEOFFSET4=9,e.DIFFUSESCALEOFFSET5=10,e.MATERIALAMBIENT=11,e.MATERIALDIFFUSE=12,e.MATERIALSPECULAR=13,e.MATERIALALBEDO=14,e.SHADERDEFINE_DETAIL_NUM1=0,e.SHADERDEFINE_DETAIL_NUM2=0,e.SHADERDEFINE_DETAIL_NUM3=0,e.SHADERDEFINE_DETAIL_NUM4=0,e.SHADERDEFINE_DETAIL_NUM5=0,n(e,["shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(),Ui=function(t){function e(){e.__super.call(this),this.setShaderName("GLITTER"),this.renderMode=1,this._setColor(3,new Ne(1,1,1,1)),this._setColor(2,new Ne(1,1,1,1))}r(e,"laya.d3.core.material.GlitterMaterial",t);var s=e.prototype;return s.setShaderName=function(e){t.prototype.setShaderName.call(this,e)},a(0,s,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),a(0,s,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),a(0,s,"albedo",function(){return this._getColor(2)},function(t){this._setColor(2,t)}),a(0,s,"color",function(){return this._getColor(3)},function(t){this._setColor(3,t)}),e.load=function(t){return i.loader.create(t,null,null,e)},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_TRANSPARENT=13,e.RENDERMODE_TRANSPARENTDOUBLEFACE=14,e.RENDERMODE_ADDTIVE=15,e.RENDERMODE_ADDTIVEDOUBLEFACE=16,e.RENDERMODE_DEPTHREAD_TRANSPARENT=5,e.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,e.RENDERMODE_DEPTHREAD_ADDTIVE=7,e.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,e.RENDERMODE_NONDEPTH_TRANSPARENT=9,e.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,e.RENDERMODE_NONDEPTH_ADDTIVE=11,e.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,e.DIFFUSETEXTURE=1,e.ALBEDO=2,e.UNICOLOR=3,n(e,["defaultMaterial",function(){return this.defaultMaterial=new e}]),e}(mi),Hi=function(t){function e(){if(this._transformUV=null,e.__super.call(this),!laya.d3.core.material.PBRMaterial.pbrlutTex){var t=_.window.__pbrlutdata;if(!t)throw alert("no pbr lutdata, need pbrlut.js"),"no pbr lutdata, need pbrlut.js";var i=en.create(new Uint32Array(t).buffer,256,256,9728,9728,!1);laya.d3.core.material.PBRMaterial.pbrlutTex=i}this._setTexture(4,laya.d3.core.material.PBRMaterial.pbrlutTex),this.setShaderName("PBR"),this._setNumber(0,.5),this.use_groundtruth=!1}r(e,"laya.d3.core.material.PBRMaterial",t);var s=e.prototype;return s.disableLight=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_POINTLIGHT|ci.SHADERDEFINE_SPOTLIGHT|ci.SHADERDEFINE_DIRECTIONLIGHT)},s.disableFog=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_FOG)},s.onAsynLoaded=function(e,i,n){t.prototype.onAsynLoaded.call(this,e,i,n)},s.radicalInverse_VdC=function(t){var e=new Uint32Array(1);return function(t){return t=(16711935&(t=(252645135&(t=(858993459&(t=(1431655765&(t=t<<16|t>>>16))<<1|(2863311530&t)>>>1))<<2|(3435973836&t)>>>2))<<4|(4042322160&t)>>>4))<<8|(4278255360&t)>>>8,e[0]=t,2.3283064365386963e-10*e[0]}(t)},s.createHammersleyTex=function(t,e){var i=new Uint8Array(t*e*4),n=0,r=0;for(r=0;r<t*e;r++){var a=this.radicalInverse_VdC(r);i[n++]=255*a,i[n++]=0,i[n++]=0,i[n++]=255}return i},a(0,s,"normalTexture",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),a(0,s,"has_tangent",null,function(t){this._addShaderDefine(e.SHADERDEFINE_HAS_TANGENT)}),a(0,s,"roughness",function(){return this._getNumber(6)},function(t){this._setNumber(6,t),this._addShaderDefine(e.SHADERDEFINE_FIX_ROUGHNESS)}),a(0,s,"metaless",function(){return this._getNumber(7)},function(t){this._setNumber(7,t),this._addShaderDefine(e.SHADERDEFINE_FIX_METALESS)}),a(0,s,"pbrlutTexture",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),a(0,s,"use_groundtruth",null,function(t){if(t){if(this._addShaderDefine(e.SHADERDEFINE_USE_GROUNDTRUTH),!laya.d3.core.material.PBRMaterial.HammersleyNoiseTex){var i=this.createHammersleyTex(32,32);laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=en.create(i.buffer,32,32,9728,9728,!1)}this._setTexture(15,e.HammersleyNoiseTex)}else laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=null,this._removeShaderDefine(e.SHADERDEFINE_USE_GROUNDTRUTH)}),a(0,s,"transformUV",function(){return this._transformUV},function(t){this._transformUV=t,this._setMatrix4x4(8,t.matrix),this._conchMaterial&&this._conchMaterial.setShaderValue(8,t.matrix.elements,0)}),a(0,s,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),a(0,s,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1;break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),a(0,s,"pbrInfoTexture",function(){return this._getTexture(3)},function(t){this._setTexture(3,t),this._addShaderDefine(e.SHADERDEFINE_HAS_PBRINFO)}),a(0,s,"testClipZ",null,function(t){this._addShaderDefine(e.SHADERDEFINE_TEST_CLIPZ)}),e.__init__=function(){e.SHADERDEFINE_FIX_METALESS=e.shaderDefines.registerDefine("FIX_METALESS"),e.SHADERDEFINE_FIX_ROUGHNESS=e.shaderDefines.registerDefine("FIX_ROUGHNESS"),e.SHADERDEFINE_HAS_TANGENT=e.shaderDefines.registerDefine("HAS_TANGENT"),e.SHADERDEFINE_HAS_PBRINFO=e.shaderDefines.registerDefine("HAS_PBRINFO"),e.SHADERDEFINE_USE_GROUNDTRUTH=e.shaderDefines.registerDefine("USE_GROUNDTRUTH"),e.SHADERDEFINE_TEST_CLIPZ=e.shaderDefines.registerDefine("CLIPZ")},e.load=function(t){return i.loader.create(t,null,null,e)},e.DIFFUSETEXTURE=1,e.NORMALTEXTURE=2,e.PBRINFOTEXTURE=3,e.PBRLUTTEXTURE=4,e.UVANIAGE=5,e.MATERIALROUGHNESS=6,e.MATERIALMETALESS=7,e.UVMATRIX=8,e.UVAGE=9,e.AOOBJPOS=14,e.HSNOISETEXTURE=15,e.SHADERDEFINE_FIX_ROUGHNESS=0,e.SHADERDEFINE_FIX_METALESS=0,e.SHADERDEFINE_HAS_TANGENT=0,e.SHADERDEFINE_TEST_CLIPZ=0,e.SHADERDEFINE_HAS_PBRINFO=0,e.SHADERDEFINE_USE_GROUNDTRUTH=0,e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,e.pbrlutTex=null,e.HammersleyNoiseTex=null,n(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(mi),Gi=function(t){function e(){e.__super.call(this),this.setShaderName("PBRSpecular"),this._setColor(7,new Ne(1,1,1,1)),this._setColor(9,new Ne(0,0,0,0)),this._setColor(8,new Ne(.2,.2,.2,.2)),this._setNumber(10,.5),this._setNumber(11,1),this._setNumber(12,0),this._setNumber(13,1),this._setNumber(14,1),this._setNumber(15,.001),this._setBool(16,!1),this._setNumber(0,.5)}r(e,"laya.d3.core.material.PBRSpecularMaterial",mi);var i=e.prototype;return a(0,i,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),a(0,i,"specularTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE),this._setTexture(2,t)}),a(0,i,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),a(0,i,"occlusionTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._setTexture(5,t)}),a(0,i,"normalTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE),this._setTexture(3,t)}),a(0,i,"parallaxTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._setTexture(4,t)}),a(0,i,"emissionColor",function(){return this._getColor(9)},function(t){this._setColor(9,t)}),a(0,i,"normalTextureScale",function(){return this._getNumber(14)},function(t){this._setNumber(14,t)}),a(0,i,"parallaxTextureScale",function(){return this._getNumber(15)},function(t){t=Math.max(.005,Math.min(.08,t)),this._setNumber(15,t)}),a(0,i,"occlusionTextureStrength",function(){return this._getNumber(13)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(13,t)}),a(0,i,"specularColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),a(0,i,"smoothness",function(){return this._getNumber(10)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(10,t)}),a(0,i,"smoothnessTextureScale",function(){return this._getNumber(11)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(11,t)}),a(0,i,"smoothnessSource",function(){return this._getNumber(12)},function(t){1==t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),t=0),this._setNumber(12,t)}),a(0,i,"enableEmission",function(){return this._getBool(16)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION),this._setBool(16,t)}),a(0,i,"emissionTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._setTexture(6,t)}),a(0,i,"tilingOffset",function(){return this._getColor(17)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(17,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_SPECULARTEXTURE=e.shaderDefines.registerDefine("SPECULARTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_SPECULARTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.SPECULARTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.SPECULARCOLOR=8,e.EMISSIONCOLOR=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.TILINGOFFSET=17,n(e,["shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(),Wi=function(t){function e(){e.__super.call(this),this.setShaderName("PBRStandard"),this._setColor(7,new Ne(1,1,1,1)),this._setColor(8,new Ne(0,0,0,0)),this._setNumber(9,0),this._setNumber(10,.5),this._setNumber(11,1),this._setNumber(12,0),this._setNumber(13,1),this._setNumber(14,1),this._setNumber(15,.001),this._setBool(16,!1),this._setNumber(0,.5)}r(e,"laya.d3.core.material.PBRStandardMaterial",mi);var i=e.prototype;return a(0,i,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),a(0,i,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),a(0,i,"enableEmission",function(){return this._getBool(16)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION),this._setBool(16,t)}),a(0,i,"metallicGlossTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE),this._setTexture(2,t)}),a(0,i,"occlusionTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._setTexture(5,t)}),a(0,i,"normalTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE),this._setTexture(3,t)}),a(0,i,"parallaxTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._setTexture(4,t)}),a(0,i,"emissionColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),a(0,i,"normalTextureScale",function(){return this._getNumber(14)},function(t){this._setNumber(14,t)}),a(0,i,"parallaxTextureScale",function(){return this._getNumber(15)},function(t){t=Math.max(.005,Math.min(.08,t)),this._setNumber(15,t)}),a(0,i,"occlusionTextureStrength",function(){return this._getNumber(13)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(13,t)}),a(0,i,"metallic",function(){return this._getNumber(9)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(9,t)}),a(0,i,"smoothness",function(){return this._getNumber(10)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(10,t)}),a(0,i,"smoothnessTextureScale",function(){return this._getNumber(11)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(11,t)}),a(0,i,"smoothnessSource",function(){return this._getNumber(12)},function(t){1==t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),t=0),this._setNumber(12,t)}),a(0,i,"emissionTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._setTexture(6,t)}),a(0,i,"tilingOffset",function(){return this._getColor(17)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(17,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_METALLICGLOSSTEXTURE=e.shaderDefines.registerDefine("METALLICGLOSSTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_METALLICGLOSSTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.METALLICGLOSSTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.EMISSIONCOLOR=8,e.METALLIC=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.TILINGOFFSET=17,n(e,["shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(),zi=function(t){function e(){this._transformUV=null,e.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new Pe(.6,.6,.6)),this._setColor(10,new Pe(1,1,1)),this._setColor(11,new Ne(1,1,1,8)),this._setColor(12,new Pe(1,1,1)),this._setColor(7,new Ne(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new Ne(1,1,0,0)),this.renderMode=1}r(e,"laya.d3.core.material.StandardMaterial",t);var s=e.prototype;return s.disableLight=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_POINTLIGHT|ci.SHADERDEFINE_SPOTLIGHT|ci.SHADERDEFINE_DIRECTIONLIGHT)},s.disableFog=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_FOG)},s.onAsynLoaded=function(i,n,r){var a=n[0];if(a.version)t.prototype.onAsynLoaded.call(this,i,n,r);else{var s=n[1],o=a.props;for(var l in o)this[l]=o[l];e._parseStandardMaterial(s,this,a),this._endLoaded()}},s.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;this._transformUV&&(i._transformUV=this._transformUV.clone())},a(0,s,"ambientColor",function(){return this._getColor(9)},function(t){this._setColor(9,t)}),a(0,s,"ambientTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,t)}),a(0,s,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),a(0,s,"reflectColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),a(0,s,"tilingOffset",function(){return this._getColor(15)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,t)}),a(0,s,"albedo",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),a(0,s,"diffuseColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),a(0,s,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),a(0,s,"specularColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),a(0,s,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),a(0,s,"normalTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,t)}),a(0,s,"specularTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,t)}),a(0,s,"emissiveTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,t)}),a(0,s,"reflectTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,t)}),a(0,s,"transformUV",function(){return this._transformUV},function(t){this._transformUV=t,this._setMatrix4x4(13,t.matrix),t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,t.matrix.elements,0)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSEMAP=e.shaderDefines.registerDefine("DIFFUSEMAP"),e.SHADERDEFINE_NORMALMAP=e.shaderDefines.registerDefine("NORMALMAP"),e.SHADERDEFINE_SPECULARMAP=e.shaderDefines.registerDefine("SPECULARMAP"),e.SHADERDEFINE_EMISSIVEMAP=e.shaderDefines.registerDefine("EMISSIVEMAP"),e.SHADERDEFINE_AMBIENTMAP=e.shaderDefines.registerDefine("AMBIENTMAP"),e.SHADERDEFINE_REFLECTMAP=e.shaderDefines.registerDefine("REFLECTMAP"),e.SHADERDEFINE_UVTRANSFORM=e.shaderDefines.registerDefine("UVTRANSFORM"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET"),e.SHADERDEFINE_ADDTIVEFOG=e.shaderDefines.registerDefine("ADDTIVEFOG")},e.load=function(t){return i.loader.create(t,null,null,e)},e._parseStandardMaterial=function(t,e,i){var n=i.customProps,r=n.ambientColor;e.ambientColor=new Pe(r[0],r[1],r[2]);var a=n.diffuseColor;e.diffuseColor=new Pe(a[0],a[1],a[2]);var s=n.specularColor;e.specularColor=new Ne(s[0],s[1],s[2],s[3]);var o=n.reflectColor;e.reflectColor=new Pe(o[0],o[1],o[2]);var l=n.albedoColor;l&&(e.albedo=new Ne(l[0],l[1],l[2],l[3]));var h=n.diffuseTexture.texture2D;h&&(e.diffuseTexture=v.getRes(t[h]));var c=n.normalTexture.texture2D;c&&(e.normalTexture=v.getRes(t[c]));var u=n.specularTexture.texture2D;u&&(e.specularTexture=v.getRes(t[u]));var _=n.emissiveTexture.texture2D;_&&(e.emissiveTexture=v.getRes(t[_]));var d=n.ambientTexture.texture2D;d&&(e.ambientTexture=v.getRes(t[d]));var f=n.reflectTexture.texture2D;f&&(e.reflectTexture=v.getRes(t[f]))},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,e.RENDERMODE_TRANSPARENTDOUBLEFACE=14,e.RENDERMODE_ADDTIVE=15,e.RENDERMODE_ADDTIVEDOUBLEFACE=16,e.RENDERMODE_DEPTHREAD_TRANSPARENT=5,e.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,e.RENDERMODE_DEPTHREAD_ADDTIVE=7,e.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,e.RENDERMODE_NONDEPTH_TRANSPARENT=9,e.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,e.RENDERMODE_NONDEPTH_ADDTIVE=11,e.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,e.SHADERDEFINE_DIFFUSEMAP=0,e.SHADERDEFINE_NORMALMAP=0,e.SHADERDEFINE_SPECULARMAP=0,e.SHADERDEFINE_EMISSIVEMAP=0,e.SHADERDEFINE_AMBIENTMAP=0,e.SHADERDEFINE_REFLECTMAP=0,e.SHADERDEFINE_UVTRANSFORM=0,e.SHADERDEFINE_TILINGOFFSET=0,e.SHADERDEFINE_ADDTIVEFOG=0,e.DIFFUSETEXTURE=1,e.NORMALTEXTURE=2,e.SPECULARTEXTURE=3,e.EMISSIVETEXTURE=4,e.AMBIENTTEXTURE=5,e.REFLECTTEXTURE=6,e.ALBEDO=7,e.UVANIAGE=8,e.MATERIALAMBIENT=9,e.MATERIALDIFFUSE=10,e.MATERIALSPECULAR=11,e.MATERIALREFLECT=12,e.UVMATRIX=13,e.UVAGE=14,e.TILINGOFFSET=15,n(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(mi),Yi=function(t){function e(){this._diffuseScale1=null,this._diffuseScale2=null,this._diffuseScale3=null,this._diffuseScale4=null,e.__super.call(this),this.setShaderName("Terrain"),this.renderMode=1,this._diffuseScale1=new Le,this._diffuseScale2=new Le,this._diffuseScale3=new Le,this._diffuseScale4=new Le,this.ambientColor=new Pe(.6,.6,.6),this.diffuseColor=new Pe(1,1,1),this.specularColor=new Ne(.2,.2,.2,32)}r(e,"laya.d3.core.material.TerrainMaterial",t);var s=e.prototype;return s.setDiffuseScale1=function(t,e){this._diffuseScale1.x=t,this._diffuseScale1.y=e,this._setColor(6,this._diffuseScale1)},s.setDiffuseScale2=function(t,e){this._diffuseScale2.x=t,this._diffuseScale2.y=e,this._setColor(7,this._diffuseScale2)},s.setDiffuseScale3=function(t,e){this._diffuseScale3.x=t,this._diffuseScale3.y=e,this._setColor(8,this._diffuseScale3)},s.setDiffuseScale4=function(t,e){this._diffuseScale4.x=t,this._diffuseScale4.y=e,this._setColor(9,this._diffuseScale4)},s.setDetailNum=function(t){switch(t){case 1:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 2:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 3:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 4:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3)}},s.disableLight=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_POINTLIGHT|ci.SHADERDEFINE_SPOTLIGHT|ci.SHADERDEFINE_DIRECTIONLIGHT)},s.setShaderName=function(e){t.prototype.setShaderName.call(this,e)},a(0,s,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=2e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.depthTest=515;break;default:throw new Error("TerrainMaterial:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),a(0,s,"diffuseTexture2",function(){return this._getTexture(3)},function(t){this._setTexture(3,t)}),a(0,s,"ambientColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),a(0,s,"diffuseTexture4",function(){return this._getTexture(5)},function(t){this._setTexture(5,t)}),a(0,s,"diffuseColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),a(0,s,"diffuseTexture1",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),a(0,s,"specularColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),a(0,s,"diffuseTexture3",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),a(0,s,"splatAlphaTexture",function(){return this._getTexture(0)},function(t){this._setTexture(0,t)}),a(0,s,"normalTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),e.__init__=function(){e.SHADERDEFINE_DETAIL_NUM1=e.shaderDefines.registerDefine("DETAIL_NUM1"),e.SHADERDEFINE_DETAIL_NUM2=e.shaderDefines.registerDefine("DETAIL_NUM2"),e.SHADERDEFINE_DETAIL_NUM4=e.shaderDefines.registerDefine("DETAIL_NUM4"),e.SHADERDEFINE_DETAIL_NUM3=e.shaderDefines.registerDefine("DETAIL_NUM3")},e.load=function(t){return i.loader.create(t,null,null,e)},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_TRANSPARENT=2,e.SPLATALPHATEXTURE=0,e.NORMALTEXTURE=1,e.DIFFUSETEXTURE1=2,e.DIFFUSETEXTURE2=3,e.DIFFUSETEXTURE3=4,e.DIFFUSETEXTURE4=5,e.DIFFUSESCALE1=6,e.DIFFUSESCALE2=7,e.DIFFUSESCALE3=8,e.DIFFUSESCALE4=9,e.MATERIALAMBIENT=10,e.MATERIALDIFFUSE=11,e.MATERIALSPECULAR=12,e.SHADERDEFINE_DETAIL_NUM1=0,e.SHADERDEFINE_DETAIL_NUM2=0,e.SHADERDEFINE_DETAIL_NUM3=0,e.SHADERDEFINE_DETAIL_NUM4=0,n(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(mi),Xi=function(t){function e(){this._useVertexDeep=!1,e.__super.call(this),this.setShaderName("Water")}r(e,"laya.d3.core.material.WaterMaterial",t);var s=e.prototype;return s.disableFog=function(){this._addDisablePublicShaderDefine(ci.SHADERDEFINE_FOG)},s.onAsynLoaded=function(e,i,n){t.prototype.onAsynLoaded.call(this,e,i,n)},a(0,s,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),a(0,s,"normalTexture",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),a(0,s,"underWaterTexture",function(){return this._getTexture(3)},function(t){this._setTexture(3,t)}),a(0,s,"deepColorTexture",function(){return this._getTexture(10)},function(t){this._setTexture(10,t)}),a(0,s,"useFoam",null,function(t){t?this._addShaderDefine(e.SHADERDEFINE_USE_FOAM):this._removeShaderDefine(e.SHADERDEFINE_USE_FOAM)}),a(0,s,"skyTexture",function(){return this._getTexture(11)},function(t){this._setTexture(11,t)}),a(0,s,"deepScale",function(){return this._getNumber(20)},function(t){this._setNumber(20,t)}),a(0,s,"detailTexture",function(){return this._getTexture(9)},function(t){this._setTexture(9,t)}),a(0,s,"foamTexture",function(){return this._getTexture(17)},function(t){this._setTexture(17,t)}),a(0,s,"waterInfoTexture",function(){return this._getTexture(16)},function(t){this._setTexture(16,t)}),a(0,s,"vertexDispTexture",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),a(0,s,"currentTm",function(){return this._getNumber(8)},function(t){this._setNumber(8,t)}),a(0,s,"waveInfo",function(){return this._getBuffer(12)},function(t){this._setBuffer(12,t)}),a(0,s,"waveInfoD",function(){return this._getBuffer(13)},function(t){this._setBuffer(13,t)}),a(0,s,"waveMainDir",function(){return this._getNumber(14)},function(t){this._setNumber(14,t*Math.PI/180)}),a(0,s,"geoWaveUVScale",function(){return this._getNumber(18)},function(t){this._setNumber(18,t)}),a(0,s,"windSpeed",function(){return 0},function(t){}),a(0,s,"scrsize",null,function(t){this._setBuffer(15,t)}),a(0,s,"seaColor",function(){return this._getBuffer(19)},function(t){this._setBuffer(19,t)}),a(0,s,"useVertexDeep",function(){return this._useVertexDeep},function(t){this._useVertexDeep=t,t?this._addShaderDefine(e.SHADERDEFINE_USEVERTEXHEIGHT):this._removeShaderDefine(e.SHADERDEFINE_USEVERTEXHEIGHT)}),a(0,s,"windDir",function(){return 0},function(t){}),a(0,s,"useRefractTexture",null,function(t){t?this._addShaderDefine(e.SHADERDEFINE_USE_REFRACT_TEX):this._removeShaderDefine(e.SHADERDEFINE_USE_REFRACT_TEX)}),a(0,s,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1;break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),e.__init__=function(){e.SHADERDEFINE_CUBE_ENV=e.shaderDefines.registerDefine("CUBE_ENV"),e.SHADERDEFINE_HDR_ENV=e.shaderDefines.registerDefine("HDR_ENV"),e.SHADERDEFINE_SHOW_NORMAL=e.shaderDefines.registerDefine("SHOW_NORMAL"),e.SHADERDEFINE_USEVERTEXHEIGHT=e.shaderDefines.registerDefine("USE_VERTEX_DEEPINFO"),e.SHADERDEFINE_USE_FOAM=e.shaderDefines.registerDefine("USE_FOAM"),e.SHADERDEFINE_USE_REFRACT_TEX=e.shaderDefines.registerDefine("USE_REFR_TEX")},e.load=function(t){return i.loader.create(t,null,null,e)},e.DIFFUSETEXTURE=1,e.NORMALTEXTURE=2,e.UNDERWATERTEXTURE=3,e.VERTEXDISPTEXTURE=4,e.UVANIAGE=5,e.UVMATRIX=6,e.UVAGE=7,e.CURTM=8,e.DETAILTEXTURE=9,e.DEEPCOLORTEXTURE=10,e.SKYTEXTURE=11,e.WAVEINFO=12,e.WAVEINFOD=13,e.WAVEMAINDIR=14,e.SCRSIZE=15,e.WATERINFO=16,e.FOAMTEXTURE=17,e.GEOWAVE_UV_SCALE=18,e.SEA_COLOR=19,e.WAVEINFODEEPSCALE=20,e.SHADERDEFINE_SHOW_NORMAL=0,e.SHADERDEFINE_CUBE_ENV=0,e.SHADERDEFINE_HDR_ENV=0,e.SHADERDEFINE_USE_FOAM=0,e.SHADERDEFINE_USE_REFRACT_TEX=0,e.SHADERDEFINE_USEVERTEXHEIGHT=0,e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,n(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(mi),ji=function(t){function e(t,i,n,r){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===n&&(n=35044),void 0===r&&(r=!1),e.__super.call(this),this._indexType=t,this._indexCount=i,this._bufferUsage=n,this._bufferType=34963,this._canRead=r;var a;if("ushort"==t)this._indexTypeByteCount=2;else{if("ubyte"!=t)throw new Error("unidentification index type.");this._indexTypeByteCount=1}a=this._indexTypeByteCount*i,this._byteLength=a,this._bind(),d._gl.bufferData(this._bufferType,a,this._bufferUsage),r?("ushort"==t?this._buffer=new Uint16Array(i):"ubyte"==t&&(this._buffer=new Uint8Array(i)),this.memorySize=2*a):this.memorySize=a}r(e,"laya.d3.graphics.IndexBuffer3D",t);var i=e.prototype;return i.setData=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295);var r=0;if("ushort"==this._indexType?(r=2,0===i&&4294967295===n||(t=new Uint16Array(t.buffer,i*r,n))):"ubyte"==this._indexType&&(r=1,0===i&&4294967295===n||(t=new Uint8Array(t.buffer,i*r,n))),this._bind(),d._gl.bufferSubData(this._bufferType,e*r,t),this._canRead)if(0!==e||0!==i||4294967295!==n){var a=this._buffer.length-e;n>a&&(n=a);for(var s=0;s<n;s++)this._buffer[e+s]=t[s]}else this._buffer=t},i.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},a(0,i,"indexType",function(){return this._indexType}),a(0,i,"indexTypeByteCount",function(){return this._indexTypeByteCount}),a(0,i,"indexCount",function(){return this._indexCount}),a(0,i,"canRead",function(){return this._canRead}),e.INDEXTYPE_UBYTE="ubyte",e.INDEXTYPE_USHORT="ushort",e.create=function(t,i,n,r){return void 0===n&&(n=35044),void 0===r&&(r=!1),new e(t,i,n,r)},e}(d),Ki=function(t){function e(t,i,n,r){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===r&&(r=!1),e.__super.call(this),this._vertexDeclaration=t,this._vertexCount=i,this._bufferUsage=n,this._bufferType=34962,this._canRead=r,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*i,this._bind(),d._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),r&&(this._buffer=new Float32Array(this._byteLength/4))}r(e,"laya.d3.graphics.VertexBuffer3D",t);var i=e.prototype;return i.bindWithIndexBuffer=function(t){t&&t._bind(),this._bind()},i.setData=function(t,e,i,n){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295),0===i&&4294967295===n||(t=new Float32Array(t.buffer,4*i,n)),this._bind(),d._gl.bufferSubData(this._bufferType,4*e,t),this._canRead)if(0!==e||0!==i||4294967295!==n){var r=this._buffer.length-e;n>r&&(n=r);for(var a=0;a<n;a++)this._buffer[e+a]=t[a]}else this._buffer=t},i.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},i.disposeResource=function(){for(var e=P.mainContext,i=this._vertexDeclaration.getVertexElements(),n=d._enableAtributes,r=0,a=i.length;r<a;r++)n[r]===this._glBuffer&&(e.disableVertexAttribArray(r),n[r]=null);t.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},a(0,i,"vertexDeclaration",function(){return this._vertexDeclaration}),a(0,i,"vertexCount",function(){return this._vertexCount}),a(0,i,"canRead",function(){return this._canRead}),e.create=function(t,i,n,r){return void 0===n&&(n=35044),void 0===r&&(r=!1),new e(t,i,n,r)},e}(d),qi=function(t){function e(){e.__super.call(this),this.setShaderName("PARTICLESHURIKEN"),this.renderMode=6}r(e,"laya.d3.core.particleShuriKen.ShurikenParticleMaterial",t);var s=e.prototype;return s.onAsynLoaded=function(i,n,r){var a=n[0];if(a.version)t.prototype.onAsynLoaded.call(this,i,n,r);else{var s=n[1],o=a.props;for(var l in o)this[l]=o[l];e._parseShurikenParticleMaterial(s,this,a),this._endLoaded()}},a(0,s,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),a(0,s,"tintColor",function(){return this._getColor(2)},function(t){t?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR),this._setColor(2,t)}),a(0,s,"tilingOffset",function(){return this._getColor(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(3,t)}),a(0,s,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSEMAP=e.shaderDefines.registerDefine("DIFFUSEMAP"),e.SHADERDEFINE_TINTCOLOR=e.shaderDefines.registerDefine("TINTCOLOR"),e.SHADERDEFINE_ADDTIVEFOG=e.shaderDefines.registerDefine("ADDTIVEFOG"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.load=function(t){return i.loader.create(t,null,null,e)},e._parseShurikenParticleMaterial=function(t,e,i){var n=i.customProps,r=n.diffuseTexture.texture2D;r&&(e.diffuseTexture=v.getRes(t[r]));var a=n.tintColor;a&&(e.tintColor=new Ne(a[0],a[1],a[2],a[3]))},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,e.RENDERMODE_TRANSPARENTDOUBLEFACE=14,e.RENDERMODE_ADDTIVE=15,e.RENDERMODE_ADDTIVEDOUBLEFACE=16,e.RENDERMODE_DEPTHREAD_TRANSPARENT=5,e.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,e.RENDERMODE_DEPTHREAD_ADDTIVE=7,e.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,e.RENDERMODE_NONDEPTH_TRANSPARENT=9,e.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,e.RENDERMODE_NONDEPTH_ADDTIVE=11,e.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,e.SHADERDEFINE_DIFFUSEMAP=0,e.SHADERDEFINE_TINTCOLOR=0,e.SHADERDEFINE_TILINGOFFSET=0,e.SHADERDEFINE_ADDTIVEFOG=0,e.DIFFUSETEXTURE=1,e.TINTCOLOR=2,e.TILINGOFFSET=3,n(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(mi),Zi=function(t){function e(){e.__super.call(this),this.setShaderName("Trail"),this._setColor(2,new Ne(1,1,1,1))}r(e,"laya.d3.core.trail.TrailMaterial",mi);var s=e.prototype;return a(0,s,"tintColor",function(){return this._getColor(2)},function(t){this._setColor(2,t)}),a(0,s,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),a(0,s,"tilingOffset",function(){return this._getColor(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(3,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.load=function(t){return i.loader.create(t,null,null,e)},e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.TINTCOLOR=2,e.TILINGOFFSET=3,n(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Fe(mi.shaderDefines)}]),e}(),Qi=(function(t){function e(){this._animationSprites=null,this._animationSpritesInitLocalMatrix=null,this._tempCurAnimationData=null,this._curOriginalData=null,this._lastFrameIndex=-1,this._curAnimationDatas=null,e.__super.call(this),this._animationSprites=[],this._animationSpritesInitLocalMatrix=[]}r(e,"laya.d3.component.animation.RigidAnimations",t);var n=e.prototype;n._init=function(){for(var t=this._templet.getNodes(this.currentAnimationClipIndex),e=this._owner,i=t.length,n=0,r=new Uint16Array(this._templet.getPublicExtData()),a=0;a<i;a++){var s=r.slice(n+1,n+1+r[n]);n+=r[n]+1;for(var o=1;o<s.length;o++)s[o],e=e._childs[s[o]];var l=e.getChildByName(t[a].name);if(!l)break;this._animationSprites[a]=l;var h=this._animationSpritesInitLocalMatrix[a];h||(h=this._animationSpritesInitLocalMatrix[a]=new be),l.transform.localMatrix.cloneTo(h),e=this._owner}},n._animtionPlay=function(){this._templet.loaded?this._init():this._templet.once("loaded",this,this._init)},n._animtionStop=function(){if(this._lastFrameIndex=-1,this._player.returnToZeroStopped){this._curAnimationDatas=null;for(var t=0;t<this._animationSprites.length;t++)this._animationSprites[t].transform.localMatrix=this._animationSpritesInitLocalMatrix[t]}},n._effectAnimation=function(t){for(var e=0,i=this._animationSprites.length;e<i;e++){for(var n=this._animationSprites[e],r=n.transform.localMatrix,a=r.elements,s=0;s<16;s++)a[s]=this._curAnimationDatas[16*e+s];n.transform.localMatrix=r}},n._load=function(e){t.prototype._load.call(this,e),this._player.on("stopped",this,this._animtionStop),this._player.on("played",this,this._animtionPlay)},n._update=function(t){if(2===this._player.state&&this._templet&&this._templet.loaded){var e=this._player.playbackRate*i.timer.scale,n=this._player.cachePlayRate,r=this._player.isCache&&e>=n,a=r?this.currentFrameIndex:-1;if(-1===a||this._lastFrameIndex!==a){var s=this.currentAnimationClipIndex,o=this._templet.getNodes(s),l=this._templet._animationDatasCache;if(r){var h=this._templet.getAnimationDataWithCache(n,l,s,a);if(h)return this._curAnimationDatas=h,this._lastFrameIndex=a,void this._effectAnimation(o)}var c=16*o.length;r?this._curAnimationDatas=new Float32Array(c):(this._tempCurAnimationData||(this._tempCurAnimationData=new Float32Array(c)),this._curAnimationDatas=this._tempCurAnimationData),this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(s))),r?this._templet.getOriginalData(s,this._curOriginalData,this._player._fullFrames[s],a,this._player.currentFrameTime):this._templet.getOriginalDataUnfixedRate(s,this._curOriginalData,this._player.currentPlayTime),Ze._computeRootAnimationData(o,this._curOriginalData,this._curAnimationDatas),r&&this._templet.setAnimationDataWithCache(n,l,s,a,this._curAnimationDatas),this._lastFrameIndex=a,this._effectAnimation(o)}}},n._unload=function(e){t.prototype._unload.call(this,e),this._animationSprites=null,this._animationSpritesInitLocalMatrix=null,this._tempCurAnimationData=null,this._curOriginalData=null,this._curAnimationDatas=null},a(0,n,"url",null,function(t){console.log("Warning: discard property,please use templet property instead.");var e=i.loader.create(t,null,null,l);this._templet!==e&&(0!==this._player.state&&this._player.stop(!0),this._templet=e,this._player.templet=e,this._curOriginalData=null,this._curAnimationDatas=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[]),this.event("animationchanged",this))}),a(0,n,"templet",t.prototype._$get_templet,function(t){this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this._curOriginalData=null,this._curAnimationDatas=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[]),this.event("animationchanged",this))})}(xi),function(t){function e(){this._tempCurAnimationData=null,this._tempCurBonesData=null,this._curOriginalData=null,this._lastFrameIndex=-1,this._curMeshAnimationData=null,this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh=null,this._boneIndexToMeshList=null,this._oldVersion=!1,e.__super.call(this),this._boneIndexToMeshList=[]}r(e,"laya.d3.component.animation.SkinAnimations",t);var n=e.prototype;return n._computeBoneIndexToMeshOnTemplet=function(){this._templet.loaded?this._computeBoneIndexToMeshOnMesh():this._templet.once("loaded",this,this._computeBoneIndexToMeshOnMesh)},n._computeBoneIndexToMeshOnMesh=function(){"LAYAANIMATION:02"===this._templet._aniVersion?this._oldVersion=!1:this._oldVersion=!0;var t=this._owner.meshFilter.sharedMesh;t.loaded?this._computeBoneIndexToMesh(t):t.on("loaded",this,this._computeBoneIndexToMesh)},n._computeBoneIndexToMesh=function(t){var e=t._boneNames;if(e)for(var i=e.length,n=this._templet._anis,r=0,a=n.length;r<a;r++){var s=this._boneIndexToMeshList[r];s||(s=this._boneIndexToMeshList[r]=[]),s.length=i;for(var o=n[r],l=0;l<i;l++)s[l]=o.bone3DMap[e[l]]}},n._getAnimationDatasWithCache=function(t,e,i,n,r){var a=i[n];if(a){var s=a[t];if(s){var o=s[e.id];return o?o[r]:null}return null}return null},n._setAnimationDatasWithCache=function(t,e,i,n,r,a){var s=i[n]||(i[n]={}),o=s[t]||(s[t]={});(o[e.id]||(o[e.id]=[]))[r]=a},n._onAnimationPlayMeshLoaded=function(){for(var t=this._ownerMesh.meshRender._renderElements,e=0,i=t.length;e<i;e++)t[e]._canDynamicBatch=!1},n._onAnimationPlay=function(){this._ownerMesh._render._addShaderDefine(vn.SHADERDEFINE_BONE);var t=this._ownerMesh.meshFilter.sharedMesh;t.loaded?this._onAnimationPlayMeshLoaded():t.once("loaded",this,this._onAnimationPlayMeshLoaded)},n._onAnimationStop=function(){this._lastFrameIndex=-1,this._player.returnToZeroStopped&&(this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh._render._removeShaderDefine(vn.SHADERDEFINE_BONE));for(var t=this._ownerMesh.meshRender._renderElements,e=0,i=t.length;e<i;e++)t[e]._canDynamicBatch=!0},n._load=function(e){t.prototype._load.call(this,e),this._ownerMesh=e,this._player.on("played",this,this._onAnimationPlay),this._player.on("stopped",this,this._onAnimationStop),this._owner.meshFilter.on("meshchanged",this,this._computeBoneIndexToMeshOnTemplet)},n._update=function(t){var n=this._ownerMesh.meshFilter.sharedMesh;if(2===this._player.state&&this._templet&&this._templet.loaded&&n.loaded){var r=this._player.playbackRate*i.timer.scale,a=this._player.cachePlayRate,s=this._player.isCache&&r>=a,o=s?this.currentFrameIndex:-1;if(-1===o||this._lastFrameIndex!==o){var l=this.currentAnimationClipIndex,h=this._templet._animationDatasCache[0],c=this._templet._animationDatasCache[1];if(s){var u=this._getAnimationDatasWithCache(a,n,c,l,o);if(u)return this._curAnimationDatas=u,this._curBonesDatas=this._templet.getAnimationDataWithCache(a,h,l,o),void(this._lastFrameIndex=o)}var _=!1;s&&(this._curBonesDatas=this._templet.getAnimationDataWithCache(a,h,l,o),_=!!this._curBonesDatas);var d=this._templet.getNodes(l),f=16*d.length,p=n.InverseAbsoluteBindPoses;this._oldVersion?this._curMeshAnimationData||(this._curMeshAnimationData=new Float32Array(f)):this._curMeshAnimationData||(this._curMeshAnimationData=new Float32Array(16*p.length));var m,g,y=0,v=0,S=0,x=n.getSubMeshCount();if(s){for(this._curAnimationDatas=[],this._curAnimationDatas.length=x,y=0;y<x;y++)for(m=this._curAnimationDatas[y]=[],S=(g=n.getSubMesh(y))._boneIndicesList.length,m.length=S,v=0;v<S;v++)m[v]=new Float32Array(16*g._boneIndicesList[v].length);_||(this._curBonesDatas=new Float32Array(f))}else{if(!this._tempCurAnimationData)for(this._tempCurAnimationData=[],this._tempCurAnimationData.length=x,y=0;y<x;y++)for(m=this._tempCurAnimationData[y]=[],S=(g=n.getSubMesh(y))._boneIndicesList.length,m.length=S,v=0;v<S;v++)m[v]=new Float32Array(16*g._boneIndicesList[v].length);this._tempCurBonesData||(this._tempCurBonesData=new Float32Array(f)),this._curAnimationDatas=this._tempCurAnimationData,this._curBonesDatas=this._tempCurBonesData}if(this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(l))),s?this._templet.getOriginalData(l,this._curOriginalData,this._player._fullFrames[l],o,this._player.currentFrameTime):this._templet.getOriginalDataUnfixedRate(l,this._curOriginalData,this._player.currentPlayTime),this._oldVersion)s&&_?Ze._computeAnimationDatasByArrayAndMatrixFastOld(p,this._curBonesDatas,this._curMeshAnimationData):Ze._computeBoneAndAnimationDatasByBindPoseMatrxixOld(d,this._curOriginalData,p,this._curBonesDatas,this._curMeshAnimationData);else{var E=this._boneIndexToMeshList[l];s&&_?Ze._computeAnimationDatasByArrayAndMatrixFast(p,this._curBonesDatas,this._curMeshAnimationData,E):Ze._computeBoneAndAnimationDatasByBindPoseMatrxix(d,this._curOriginalData,p,this._curBonesDatas,this._curMeshAnimationData,E)}for(y=0;y<x;y++){var T=n.getSubMesh(y)._boneIndicesList;for(S=T.length,m=this._curAnimationDatas[y],v=0;v<S;v++)e._splitAnimationDatas(T[v],this._curMeshAnimationData,m[v])}s&&(this._setAnimationDatasWithCache(a,n,c,l,o,this._curAnimationDatas),_||this._templet.setAnimationDataWithCache(a,h,l,o,this._curBonesDatas)),this._lastFrameIndex=o}}},n._preRenderUpdate=function(t){var e=t.renderElement.renderObj;this._curAnimationDatas?e._skinAnimationDatas=this._curAnimationDatas[e._indexInMesh]:e._skinAnimationDatas=null},n._unload=function(e){2==this.player.state&&this._ownerMesh._render._removeShaderDefine(vn.SHADERDEFINE_BONE),this._templet&&!this._templet.loaded&&this._templet.off("loaded",this,this._computeBoneIndexToMeshOnMesh);var i=this._ownerMesh.meshFilter.sharedMesh;i.loaded||i.off("loaded",this,this._onAnimationPlayMeshLoaded),t.prototype._unload.call(this,e),this._tempCurAnimationData=null,this._tempCurBonesData=null,this._curOriginalData=null,this._curMeshAnimationData=null,this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh=null},a(0,n,"curBonesDatas",function(){return this._curBonesDatas}),a(0,n,"templet",t.prototype._$get_templet,function(t){this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this._computeBoneIndexToMeshOnTemplet(),this._curOriginalData=null,this._curMeshAnimationData=null,this._tempCurBonesData=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[[],[]]),this.event("animationchanged",this))}),e._splitAnimationDatas=function(t,e,i){for(var n=0,r=t.length,a=0;n<r;n++)for(var s=0;s<16;s++,a++)i[a]=e[(t[n]<<4)+s]},e}(xi)),$i=function(t){function e(){this._size=null,this._transformOrientedBoundBox=null,this.center=null,e.__super.call(this),this._needUpdate=!1}r(e,"laya.d3.component.physics.BoxCollider",Ti);var i=e.prototype;return i._updateCollider=function(){if(this._needUpdate){var t=this._transformOrientedBoundBox.transformation,i=this._owner.transform,n=i.rotation,r=i.scale,a=this.center.elements;0===a[0]&&0===a[1]&&0===a[2]?be.createAffineTransformation(i.position,n,Pe.ONE,t):(Pe.multiply(this.center,r,e._deviationV3),Pe.transformQuat(e._deviationV3,n,e._deviationV3),Pe.add(i.position,e._deviationV3,e._deviationV3),be.createAffineTransformation(e._deviationV3,n,Pe.ONE,t)),this._transformOrientedBoundBox.transformation=t;var s=this._transformOrientedBoundBox.extents.elements,o=this._size.elements,l=r.elements;s[0]=.5*o[0]*l[0],s[1]=.5*o[1]*l[1],s[2]=.5*o[2]*l[2],this._needUpdate=!1}},i._onWorldMatrixChanged=function(){for(var t in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[t]=!0,this._runtimeCollisonMap[t]._runtimeCollisonTestMap[this.id]=!0},i._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),this._transformOrientedBoundBox=new Me(new Pe,new be),this._size=new Pe,this.center=new Pe,t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},i._getType=function(){return 1},i._collisonTo=function(t){switch(t._getType()){case 0:return 0!==this.boundBox.containsSphere(t.boundSphere);case 1:return 0!==this.boundBox.containsOrientedBoundBox(t.boundBox);case 2:var e=t;if(0!==this.boundBox.containsBoundBox(e._boundBox)){for(var i=t.mesh._positions,n=0,r=i.length;n<r;n++)if(1===this.boundBox.containsPoint(i[n]))return!0;return!1}return!1;default:throw new Error("BoxCollider:unknown collider type.")}},i._cloneTo=function(t){var e=t,i=e.size;this.size.cloneTo(i),e.size=i,this.center.cloneTo(e.center)},i.raycast=function(t,e,i){void 0===i&&(i=1.79e308),this._updateCollider();var n=this._transformOrientedBoundBox.intersectsRay(t,e.position);return-1!==n&&n<=i?(e.distance=n,e.sprite3D=this._owner,!0):(e.distance=-1,e.sprite3D=null,!1)},i.setFromBoundBox=function(t){Me.createByBoundBox(t,this._transformOrientedBoundBox);var e=this._transformOrientedBoundBox.extents;this._size=new Pe(2*e.x,2*e.y,2*e.z),this.center=new Pe,Pe.add(t.min,t.max,this.center),Pe.scale(this.center,.5,this.center),this._needUpdate=!0},a(0,i,"boundBox",function(){return this._updateCollider(),this._transformOrientedBoundBox}),a(0,i,"size",function(){return this._size},function(t){this._size=t,this._needUpdate=!0}),n(e,["_deviationV3",function(){return this._deviationV3=new Pe},"_obbCenterV3",function(){return this._obbCenterV3=new Pe}]),e}(),Ji=function(t){function e(){this._transformBoundingBox=null,this._mesh=null,e.__super.call(this),this._transformBoundingBox=new Se(new Pe,new Pe),this._needUpdate=!1}r(e,"laya.d3.component.physics.MeshCollider",Ti);var i=e.prototype;return i._updateBoundBoxCollider=function(){if(this._needUpdate){for(var t=this._owner.transform.worldMatrix,i=this._mesh.boundingBoxCorners,n=0;n<8;n++)Pe.transformCoordinate(i[n],t,e._tempBoundBoxCorners[n]);Se.createfromPoints(e._tempBoundBoxCorners,this._transformBoundingBox),this._needUpdate=!1}},i._raycastMesh=function(t,i,n,r){void 0===r&&(r=1.79e308);var a=i.transform.worldMatrix,s=e._tempMatrix4x40;a.invert(s);var o=t.origin,l=t.direction,h=e._tempRay0;Pe.transformCoordinate(o,s,h.origin),Pe.TransformNormal(l,s,h.direction);for(var c=Number.MAX_VALUE,u=0,_=this._mesh.getRenderElementsCount();u<_;u++){var d=this._mesh.getRenderElement(u),f=d._getVertexBuffer(0),p=f.getData(),m=d._getIndexBuffer().getData(),g=e._tempRaycastHit;if(je.rayIntersectsPositionsAndIndices(h,p,f.vertexDeclaration,m,g)){Pe.transformCoordinate(g.position,a,g.position);var y=e._tempVector30;Pe.subtract(o,g.position,y);var v=Pe.scalarLength(y);if(v<r&&v<c){g.distance=v,g.sprite3D=i;var S=g.trianglePositions;Pe.transformCoordinate(S[0],a,S[0]),Pe.transformCoordinate(S[1],a,S[1]),Pe.transformCoordinate(S[2],a,S[2]);var x=g.triangleNormals;return Pe.transformCoordinate(x[0],a,x[0]),Pe.transformCoordinate(x[1],a,x[1]),Pe.transformCoordinate(x[2],a,x[2]),c=v,g.cloneTo(n),!0}return!1}}return!1},i._onWorldMatrixChanged=function(){this._needUpdate=!0},i._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},i._getType=function(){return 2},i._collisonTo=function(t){var e=0,i=0,n=this.mesh._positions;switch(t._getType()){case 0:var r=t;if(0!==Te.sphereContainsBox(r.boundSphere,this._boundBox)){for(e=0,i=n.length;e<i;e++)if(1===Te.sphereContainsPoint(r.boundSphere,n[e]))return!0;return!1}return!1;case 1:var a=t;if(0!==a.boundBox.containsBoundBox(this._boundBox)){for(e=0,i=n.length;e<i;e++)if(1===a.boundBox.containsPoint(n[e]))return!0;return!1}return!1;case 2:var s=t;return 1!==Te.intersectsBoxAndBox(s._boundBox,this._boundBox);default:throw new Error("MeshCollider:unknown collider type.")}},i._cloneTo=function(t){t.mesh=this._mesh},i.raycast=function(t,e,i){if(void 0===i&&(i=1.79e308),null==this._mesh||!this._mesh.loaded)return!1;var n=Te.intersectsRayAndBoxRD(t,this._boundBox);return!!(-1!==n&&n<=i&&this._raycastMesh(t,this._owner,e,i))||(e.distance=-1,e.sprite3D=null,!1)},a(0,i,"_boundBox",function(){return this._updateBoundBoxCollider(),this._transformBoundingBox}),a(0,i,"mesh",function(){return this._mesh},function(t){this._mesh=t}),n(e,["_tempRay0",function(){return this._tempRay0=new Re(new Pe,new Pe)},"_tempVector30",function(){return this._tempVector30=new Pe},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new be},"_tempRaycastHit",function(){return this._tempRaycastHit=new Ke},"_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe]}]),e}(),tn=function(t){function e(){this._originalBoundSphere=null,this._transformBoundSphere=null,e.__super.call(this),this._needUpdate=!1}r(e,"laya.d3.component.physics.SphereCollider",Ti);var i=e.prototype;return i._updateCollider=function(){if(this._needUpdate){var t,e=this._owner.transform,i=e.scale;t=i.x>=i.y&&i.x>=i.z?i.x:i.y>=i.z?i.y:i.z,Pe.transformCoordinate(this._originalBoundSphere.center,e.worldMatrix,this._transformBoundSphere.center),this._transformBoundSphere.radius=this._originalBoundSphere.radius*t,this._needUpdate=!1}},i._onWorldMatrixChanged=function(){for(var t in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[t]=!0,this._runtimeCollisonMap[t]._runtimeCollisonTestMap[this.id]=!0},i._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),this._originalBoundSphere=new Ee(new Pe(0,0,0),.5),this._transformBoundSphere=new Ee(new Pe(0,0,0),.5),t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},i._getType=function(){return 0},i._collisonTo=function(t){switch(t._getType()){case 0:return 0!==Te.sphereContainsSphere(this.boundSphere,t.boundSphere);case 1:return 0!==t.boundBox.containsSphere(this.boundSphere);case 2:var e=t;if(0!==Te.sphereContainsBox(this.boundSphere,e._boundBox)){for(var i=e.mesh._positions,n=0,r=i.length;n<r;n++)if(1===Te.sphereContainsPoint(this.boundSphere,i[n]))return!0;return!1}return!1;default:throw new Error("SphereCollider:unknown collider type.")}},i._cloneTo=function(t){var e=t;e.radius=this.radius;var i=e.center;this.center.cloneTo(i),e.center=i},i.raycast=function(t,e,i){void 0===i&&(i=1.79e308),this._updateCollider();var n=this._transformBoundSphere.intersectsRayPoint(t,e.position);return-1!==n&&n<=i?(e.distance=n,e.sprite3D=this._owner,!0):(e.distance=-1,e.sprite3D=null,!1)},a(0,i,"center",function(){return this._originalBoundSphere.center},function(t){this._originalBoundSphere.center=t}),a(0,i,"radius",function(){return this._originalBoundSphere.radius},function(t){this._originalBoundSphere.radius=t}),a(0,i,"boundSphere",function(){return this._updateCollider(),this._transformBoundSphere}),e}(),en=function(t){function e(){this.simLodInfo=null,this._src=null,this._buffer=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,e.__super.call(this),this._type=3553}r(e,"laya.d3.resource.DataTexture2D",gi);var s=e.prototype;return s.genDebugMipmaps=function(){var t=[];return t.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),t.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),t.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),t.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),t.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),t.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),t.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),t.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),t.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),t.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),t},s._onTextureLoaded=function(t){},s._createWebGlTexture=function(){if(!this._buffer&&!this._mipmaps)throw"create GLTextur err:no data";var t=P.mainContext;t.getExtension("EXT_shader_texture_lod");var i=this._source=t.createTexture(),n=this._width,r=this._height,a=N.curBindTexTarget,s=N.curBindTexValue;if(N.bindTexture(t,this._type,i),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var o=0;t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var l=0;l<this._mipmaps.length;l++){if(this._mipmaps[l].byteLength!=c*u*4)throw"mipmap size error  level:"+l;t.texSubImage2D(this._type,0,e.simLodRect[o++],e.simLodRect[o++],e.simLodRect[o++],e.simLodRect[o++],6408,5121,new Uint8Array(this._mipmaps[l]))}this.minFifter=9729,this.magFifter=9729}else{var c=this._width,u=this._height;for(o=0,t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),l=0;l<this._mipmaps.length;l++){if(this._mipmaps[l].byteLength!=c*u*4)throw"mipmap size error  level:"+l;t.texImage2D(this._type,l,6408,c,u,0,6408,5121,new Uint8Array(this._mipmaps[l])),u/=2,(c/=2)<1&&(c=1),u<1&&(u=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else t.texImage2D(this._type,0,6408,n,r,0,6408,5121,new Uint8Array(this._buffer));var _=this._minFifter,d=this._magFifter,f=this._repeat?10497:33071,p=h.isPOT(n,r);if(!p)throw"data texture must be POT";this._mipmap||this._mipmaps?-1!==_||(_=9987):-1!==_||(_=9729),-1!==d||(d=9729),t.texParameteri(this._type,10241,_),t.texParameteri(this._type,10240,d),t.texParameteri(this._type,10242,f),this._mipmaps?t.texParameteri(this._type,10243,33071):t.texParameteri(this._type,10243,f),this._mipmap&&t.generateMipmap(this._type),a&&s&&N.bindTexture(t,a,s),this.src&&this.src.length>0&&(this._buffer=null),this.memorySize=p?n*r*4*(1+1/3):n*r*4,this._recreateLock=!1},s.recreateResource=function(){if(this._buffer||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else this._recreateLock=!0},s.onAsynLoaded=function(t,e,i){var n;i&&(n=i[0].call(this,e)),n&&(this._width=n.width,this._height=n.height,this._buffer=n.data),this._src=t,this._size=new qe(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},s.getPixels=function(){return new Uint8Array(this._buffer)},s.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(P.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this.memorySize=0)},a(0,s,"src",function(){return this._src}),e.create=function(t,i,n,r,a,s){if(void 0===r&&(r=9729),void 0===a&&(a=9729),void 0===s&&(s=!0),!t||t.byteLength<i*n*4)throw"DataTexture2D create error";var o=new e;return o._buffer=t,o._width=i,o._height=n,o._mipmap=s,o._magFifter=r,o._minFifter=a,o._size=new qe(o._width,o._height),o._conchTexture?alert("怎么给runtime传递datatexture数据"):o.activeResource(),o},e.load=function(t,n,r,a,s){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=9729),void 0===s&&(s=9729),"mipmaps"===L.getFileExtension(t)){var o=i.loader.create(t,null,null,e,[function(t){this._mipmaps=[];var e=new Uint32Array(t);this._width=e[0];var i=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,i=1024),this._width!=i)throw console.error("现在只支持512x256的环境贴图。当前的是"+e[0]),"现在只支持512x256的环境贴图。当前的是"+e[0];this._height=e[1];for(var n=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,r=this._height,a=8;;){var s=n*r*4;if(a+s>t.byteLength)throw"load mipmaps data size error ";var o=new Uint8Array(t,a,s);if(this._mipmaps.push(o),a+=s,1==n&&1==r)break;r/=2,(n/=2)<1&&(n=1),r<1&&(r=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){o.simLodInfo=new Float32Array(40);for(var l=0;l<o.simLodInfo.length;)o.simLodInfo[l]=(e.simLodRect[l]+.5)/1024,l++,o.simLodInfo[l]=(e.simLodRect[l]+.5)/256,l++,o.simLodInfo[l]=Math.max(e.simLodRect[l]-1,.1)/1024,l++,o.simLodInfo[l]=Math.max(e.simLodRect[l]-1.5,.1)/256,l++}return o}if("number"==typeof n)return i.loader.create(t,null,null,e,[function(t){return this._width=n,this._height=r,this._buffer=t,null}]);if("function"==typeof n)return i.loader.create(t,null,null,e,[n]);throw new Error("unknown params.")},e.lodasatlas=!1,n(e,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),e}(),nn=function(t){function e(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,e.__super.call(this)}r(e,"laya.d3.resource.models.PrimitiveMesh",yi);var n=e.prototype;return i.imps(n,{"laya.d3.core.render.IRenderable":!0}),n._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},n._getVertexBuffers=function(){return null},n._getIndexBuffer=function(){return this._indexBuffer},n._getPositions=function(){var t,e=[],i=this._vertexBuffer.vertexDeclaration.getVertexElements(),n=0;for(n=0;n<i.length;n++){var r=i[n];if("vector3"===r.elementFormat&&0===r.elementUsage){t=r;break}}var a=this._vertexBuffer.getData();for(n=0;n<a.length;n+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var s=n+t.offset/4,o=new Pe(a[s+0],a[s+1],a[s+2]);e.push(o)}return e},n.getRenderElement=function(t){return this},n.getRenderElementsCount=function(){return 1},n.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this.memorySize=0},n._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},n._render=function(t){P.mainContext.drawElements(4,this._numberIndices,5123,0),D.drawCall++,D.trianglesFaces+=this._numberIndices/3},a(0,n,"_vertexBufferCount",function(){return 1}),a(0,n,"triangleCount",function(){return this._indexBuffer.indexCount/3}),e}(),rn=function(t){function e(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,e.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}r(e,"laya.d3.resource.models.Mesh",yi);var n=e.prototype;return n._getPositions=function(){var t,e,i,n,r,a=[],s=0,o=0,l=0;if(0!==this._vertexBuffers.length){var h=this._vertexBuffers.length;for(s=0;s<h;s++){for(i=(t=this._vertexBuffers[s]).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)l=o+e.offset/4,a.push(new Pe(r[l+0],r[l+1],r[l+2]))}}else{var c=this._subMeshes.length;for(s=0;s<c;s++){for(i=(t=this._subMeshes[s]._getVertexBuffer()).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)l=o+e.offset/4,a.push(new Pe(r[l+0],r[l+1],r[l+2]))}}return a},n._setSubMeshes=function(t){this._subMeshes=t,this._subMeshCount=t.length;for(var e=0;e<this._subMeshCount;e++)t[e]._indexInMesh=e;this._positions=this._getPositions(),this._generateBoundingObject()},n.onAsynLoaded=function(t,e,i){var n=e[0],r=e[1];ve.read(n,this,this._materials,this._subMeshes,r),this.completeCreate(),this._endLoaded()},n.getSubMesh=function(t){return this._subMeshes[t]},n.getSubMeshCount=function(){return this._subMeshes.length},n.getRenderElementsCount=function(){return this._subMeshes.length},n.getRenderElement=function(t){return this._subMeshes[t]},n.disposeResource=function(){for(var t=0;t<this._subMeshes.length;t++)this._subMeshes[t].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},a(0,n,"materials",function(){return this._materials.slice()}),a(0,n,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),e.load=function(t){return i.loader.create(t,null,null,e)},e}(),an=function(t){function e(t,i,n,r,a,s,o,l,h){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===n&&(n=6408),void 0===r&&(r=5121),void 0===a&&(a=33189),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===l&&(l=-1),void 0===h&&(h=-1),e.__super.call(this),this._type=3553,this._width=t,this._height=i,this._size=new qe(t,i),this._surfaceFormat=n,this._surfaceType=r,this._depthStencilFormat=a,this._mipmap=s,this._repeat=o,this._minFifter=l,this._magFifter=h,this.activeResource(),this._alreadyResolved=!0}r(e,"laya.d3.resource.RenderTexture",gi);var n=e.prototype;return n.recreateResource=function(){var t=P.mainContext;this._frameBuffer=t.createFramebuffer(),this._source=t.createTexture();var e=N.curBindTexTarget,i=N.curBindTexValue;N.bindTexture(t,this._type,this._source),t.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,r=this._magFifter,a=this._repeat?10497:33071;if(h.isPOT(this._width,this._height)?(this._mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(this._type,10241,n),t.texParameteri(this._type,10240,r),t.texParameteri(this._type,10242,a),t.texParameteri(this._type,10243,a),this._mipmap&&t.generateMipmap(this._type)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(this._type,10241,n),t.texParameteri(this._type,10240,r),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&N.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),this.memorySize=this._width*this._height*4,this.completeCreate()},n.start=function(){P.mainContext.bindFramebuffer(36160,this.frameBuffer),e._currentRenderTarget=this,this._alreadyResolved=!1},n.end=function(){P.mainContext.bindFramebuffer(36160,null),e._currentRenderTarget=null,this._alreadyResolved=!0},n.getData=function(t,e,i,n){var r=P.mainContext;if(r.bindFramebuffer(36160,this._frameBuffer),36053!==r.checkFramebufferStatus(36160))return r.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._width*this._height*4);return r.readPixels(t,e,i,n,this._surfaceFormat,this._surfaceType,a),r.bindFramebuffer(36160,null),a},n.disposeResource=function(){if(this._frameBuffer){var t=P.mainContext;t.deleteTexture(this._source),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},a(0,n,"surfaceFormat",function(){return this._surfaceFormat}),a(0,n,"surfaceType",function(){return this._surfaceType}),a(0,n,"depthStencilFormat",function(){return this._depthStencilFormat}),a(0,n,"source",function(){return this._alreadyResolved?i.superGet(gi,this,"source"):null}),a(0,n,"depthStencilBuffer",function(){return this._depthStencilBuffer}),a(0,n,"frameBuffer",function(){return this._frameBuffer}),e._currentRenderTarget=null,e}(),sn=function(t){function e(t){this._color=null,this._pixels=null,e.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new qe(this.width,this.height),this._color=t,this._pixels=new Uint8Array([255*t.x,255*t.y,255*t.z,255*t.w])}r(e,"laya.d3.resource.SolidColorTexture2D",gi);var i=e.prototype;return i._createWebGlTexture=function(){var t=P.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=N.curBindTexTarget,a=N.curBindTexValue;N.bindTexture(t,this._type,e),t.texImage2D(this._type,0,6408,i,n,0,6408,5121,this._pixels);var s=this._minFifter,o=this._magFifter,l=this._repeat?10497:33071,c=h.isPOT(i,n);c?(this._mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),this._mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&N.bindTexture(t,r,a),this.memorySize=c?i*n*4*(1+1/3):i*n*4},i.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&(P.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},n(e,["magentaTexture",function(){return this.magentaTexture=new e(new Ne(1,0,1,1))},"grayTexture",function(){return this.grayTexture=new e(new Ne(.5,.5,.5,1))}]),e}(),on=function(t){function e(t){this._color=null,this._pixels=null,this._texCount=6,e.__super.call(this),this._type=34067,this._width=1,this._height=1,this._size=new qe(this.width,this.height),this._color=t,this._pixels=new Uint8Array([255*t.x,255*t.y,255*t.z,255*t.w])}r(e,"laya.d3.resource.SolidColorTextureCube",gi);var i=e.prototype;return i._createWebGlTexture=function(){var t=P.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=N.curBindTexTarget,a=N.curBindTexValue;N.bindTexture(t,this._type,e),t.texImage2D(34069,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34070,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34071,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34072,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34073,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34074,0,6408,i,n,0,6408,5121,this._pixels);var s=this.minFifter,o=this.magFifter,l=this._repeat?10497:33071,c=h.isPOT(i,n);c?(this.mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),this.mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&N.bindTexture(t,r,a),this.memorySize=c?i*n*4*(1+1/3)*this._texCount:i*n*4*this._texCount},i.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&(P.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},n(e,["magentaTexture",function(){return this.magentaTexture=new e(new Ne(1,0,1,1))},"grayTexture",function(){return this.grayTexture=new e(new Ne(.5,.5,.5,1))}]),e}(),ln=function(e){function n(t,e,i,r){this._canRead=!1,this._image=null,this._pixels=null,void 0===t&&(t=!1),void 0===e&&(e=!0),void 0===i&&(i=6408),void 0===r&&(r=!0),n.__super.call(this),this._type=3553,this._repeat=e,this._canRead=t,this._format=i,this._mipmap=r}r(n,"laya.d3.resource.Texture2D",gi);var s=n.prototype;return s._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=P.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=N.curBindTexTarget,a=N.curBindTexValue;switch(N.bindTexture(t,this._type,e),this._format){case 6407:case 6408:this._canRead?t.texImage2D(this._type,0,this._format,i,n,0,this._format,5121,this._pixels):t.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case P.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image)}var s=this._minFifter,o=this._magFifter,l=this._repeat?10497:33071,c=0==this._wrapModeU?10497:33071,u=0==this._wrapModeV?10497:33071,_=h.isPOT(i,n);_?(this._mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),t.texParameteri(this._type,10242,c),t.texParameteri(this._type,10243,u),this._mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&N.bindTexture(t,r,a),this._image.onload=null,this._image=null,this.memorySize=_?i*n*4*(1+1/3):i*n*4},s.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},s.onAsynLoaded=function(e,i,n){if(n){var r=n[0];void 0!==r&&(this._canRead=r);var a=n[1];void 0!==a&&(this._repeat=a);var s=n[2];void 0!==s&&(this._format=s);var o=n[3];void 0!==o&&(this._mipmap=o);var l=n.wrapModeU;void 0!==l&&(this._wrapModeU=l);var h=n.wrapModeV;void 0!==h&&(this._wrapModeV=h)}switch(this._format){case 6407:case 6408:this._image=i;var c=i.width,u=i.height;this._width=c,this._height=u,this._size=new qe(c,u),this._canRead&&(T.isConchApp?i instanceof t.HTMLElement&&(this._pixels=new Uint8Array(i.getImageData(0,0,c,u))):(_.canvas.size(c,u),_.canvas.clear(),_.context.drawImage(i,0,0,c,u),this._pixels=new Uint8Array(_.context.getImageData(0,0,c,u).data.buffer)));break;case P.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var d=new f(i);d.readUTFBytes(4),d.readUTFBytes(2),d.getInt16(),d.endian="bigEndian",this._width=d.getInt16(),this._height=d.getInt16(),this._size=new qe(this._width,this._height),d.getInt16(),d.getInt16(),this._image=new Uint8Array(i,d.pos)}this.recreateResource(),this._endLoaded()},s.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},s.disposeResource=function(){this._source&&(P.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},a(0,s,"_src",function(){return this.url}),a(0,s,"src",function(){return this.url}),n.load=function(t){return i.loader.create(t,null,null,n)},n}(),hn=function(t){function e(){e.__super.call(this),this._type=34067}r(e,"laya.d3.resource.TextureCube",gi);var n=e.prototype;return n._onTextureLoaded=function(t){this._images=t;for(var e=2147483647,i=2147483647,n=0;n<6;n++){var r=t[n];e=Math.min(e,r.width),i=Math.min(i,r.height)}this._width=e,this._height=i,this._size=new qe(e,i)},n._createWebGlTexture=function(){var t=0;for(t=0;t<6;t++)if(!this._images[t])throw"create GLTextur err:no data:"+this._images[t];var e=P.mainContext,i=this._source=e.createTexture(),n=this._width,r=this._height,a=N.curBindTexTarget,s=N.curBindTexValue;N.bindTexture(e,this._type,i),e.texImage2D(34069,0,6408,6408,5121,this._images[0]),e.texImage2D(34070,0,6408,6408,5121,this._images[1]),e.texImage2D(34071,0,6408,6408,5121,this._images[2]),e.texImage2D(34072,0,6408,6408,5121,this._images[3]),e.texImage2D(34073,0,6408,6408,5121,this._images[4]),e.texImage2D(34074,0,6408,6408,5121,this._images[5]);var o=this.minFifter,l=this.magFifter,c=this._repeat?10497:33071,u=h.isPOT(n,r);for(u?(this.mipmap?-1!==o||(o=9987):-1!==o||(o=9729),-1!==l||(l=9729),e.texParameteri(this._type,10241,o),e.texParameteri(this._type,10240,l),e.texParameteri(this._type,10242,c),e.texParameteri(this._type,10243,c),this.mipmap&&e.generateMipmap(this._type)):(-1!==o||(o=9729),-1!==l||(l=9729),e.texParameteri(this._type,10241,o),e.texParameteri(this._type,10240,l),e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071)),a&&s&&N.bindTexture(e,a,s),t=0;t<6;t++)this._images[t].onload=null,this._images[t]=null;this.memorySize=u?n*r*4*(1+1/3)*6:n*r*4*6},n.recreateResource=function(){null!=this._url&&(this._createWebGlTexture(),this.completeCreate())},n.onAsynLoaded=function(t,e,i){this._onTextureLoaded(e),this.activeResource(),this._endLoaded()},n.disposeResource=function(){this._source&&(P.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},a(0,n,"defaulteTexture",function(){return on.grayTexture}),e.load=function(t){return i.loader.create(t,null,null,e)},e}(),cn=function(t){function e(t){this._hasIndependentBound=!0,e.__super.call(this,t),this._owner.transform.off("worldmatrixneedchanged",this,this._onWorldMatNeedChange),this._cacheAnimationNodeIndex=[],this._cacheAnimationNode=[],this._localBoundingBoxCorners=s(8,null),this._owner.meshFilter.on("meshchanged",this,this._$3__onMeshChanged)}r(e,"laya.d3.core.SkinnedMeshRender",t);var i=e.prototype;return i._getCacheAnimationNodes=function(){var t=this._cacheMesh._boneNames,e=t.length;this._cacheAnimationNode.length=e,this._cacheAnimationNodeIndex.length=e;for(var i=this._cacheAnimator._avatarNodes,n=this._cacheAnimator._avatarNodeMap,r=0;r<e;r++){var a=n[t[r]];this._cacheAnimationNode[r]=a,this._cacheAnimationNodeIndex[r]=i.indexOf(a)}},i._offComputeBoneIndexToMeshEvent=function(t,e){t.loaded?e.loaded||e.off("loaded",this,this._getCacheAnimationNodes):t.off("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},i._computeBoneIndexToMeshWithAsyncAvatar=function(){this._cacheAvatar.loaded?this._computeBoneIndexToMeshWithAsyncMesh():this._cacheAvatar.once("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},i._computeBoneIndexToMeshWithAsyncMesh=function(){this._cacheMesh.loaded?this._getCacheAnimationNodes():this._cacheMesh.on("loaded",this,this._getCacheAnimationNodes)},i._$3__onMeshChanged=function(t,e,i){this._cacheMesh=i,e&&!e.loaded&&i.off("loaded",this,this._onMeshLoaded),i.loaded?this._onMeshLoaded(i):i.on("loaded",this,this._onMeshLoaded),this._cacheAvatar&&(e&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,e),i&&this._computeBoneIndexToMeshWithAsyncAvatar())},i._onMeshLoaded=function(t){var e=t.subMeshCount;this._subSkinnedDatas=[],this._subSkinnedDatas.length=e;for(var i=0;i<e;i++)for(var n=this._subSkinnedDatas[i]=[],r=t.getSubMesh(i)._boneIndicesList,a=0,s=r.length;a<s;a++)n[a]=new Float32Array(16*r[a].length)},i._setCacheAnimator=function(t){this._cacheAnimator=t,this._rootBone&&(this._rootIndex=t._avatarNodes.indexOf(t._avatarNodeMap[this._rootBone]))},i._setRootBone=function(t){this._rootBone=t,this._cacheAnimator&&(this._rootIndex=this._cacheAnimator._avatarNodes.indexOf(this._cacheAnimator._avatarNodeMap[t]))},i._setCacheAvatar=function(t){this._cacheAvatar!==t&&(this._cacheMesh?(this._cacheAvatar&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,this._cacheMesh),this._cacheAvatar=t,t&&(this._addShaderDefine(vn.SHADERDEFINE_BONE),this._computeBoneIndexToMeshWithAsyncAvatar())):this._cacheAvatar=t)},i._calculateBoundingBox=function(){if(this._hasIndependentBound){if(this._cacheAnimator){var e=this._owner.transform,i=e.worldMatrix;if(this._cacheAnimator._canCache){var n=this._cacheAnimator._curAvatarNodeDatas;Ze.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,n[this._rootIndex],i)}else Ze.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheAnimator._avatarNodeMap[this._rootBone].transform.getWorldMatrix(),i);e.worldMatrix=i,null==this._cacheAnimator._avatarNodeMap[this._rootBone]||null==this._localBoundBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(this._localBoundingBoxCorners)}}else t.prototype._calculateBoundingBox.call(this)},i._calculateBoundingSphere=function(){if(this._hasIndependentBound){if(this._cacheAnimator){var e=this._owner.transform,i=e.worldMatrix;if(this._cacheAnimator._canCache){var n=this._cacheAnimator._curAvatarNodeDatas;Ze.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,n[this._rootIndex],i)}else Ze.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheAnimator._avatarNodeMap[this._rootBone].transform.getWorldMatrix(),i);e.worldMatrix=i,null==this._cacheAnimator._avatarNodeMap[this._rootBone]||null==this.localBoundSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(this.localBoundSphere)}}else t.prototype._calculateBoundingSphere.call(this)},i._updateOctreeNode=function(){var t=this._treeNode;t&&t.updateObject(this)},i._renderUpdate=function(t){var i,n=this._cacheAnimator,r=this._cacheMesh.subMeshCount,a=this._owner.transform;if(n){var s=n._canCache,o=this._cacheAnimator._curAvatarNodeDatas,l=n.owner;if(this._setShaderValueMatrix4x4(0,l._transform.worldMatrix),i=l.getProjectionViewWorldMatrix(t),this._setShaderValueMatrix4x4(1,i),this._cacheMesh&&this._cacheMesh.loaded&&this._cacheAvatar&&this._cacheAvatar.loaded){var h=0,c=0,u=this._cacheMesh._inverseBindPoses,_=this._cacheMesh._skinnedDatas;if(s)for(h=0,c=u.length;h<c;h++)Ze._mulMatrixArray(o[this._cacheAnimationNodeIndex[h]],u[h],_,16*h);else for(h=0,c=u.length;h<c;h++)Ze._mulMatrixArray(this._cacheAnimationNode[h].transform.getWorldMatrix(),u[h],_,16*h);for(h=0;h<r;h++){for(var d=this._cacheMesh.getSubMesh(h)._boneIndicesList,f=d.length,p=this._subSkinnedDatas[h],m=0;m<f;m++)e._splitAnimationDatas(d[m],_,p[m]);this._renderElements[h]._skinAnimationDatas=p}}}else this._setShaderValueMatrix4x4(0,a.worldMatrix),i=this._owner.getProjectionViewWorldMatrix(t),this._setShaderValueMatrix4x4(1,i);return Qe.debugMode&&this._renderRenderableBoundBox(),!0},a(0,i,"localBoundBox",function(){return this._localBoundBox},function(t){this._localBoundBox=t,t.getCorners(this._localBoundingBoxCorners)}),a(0,i,"boundingSphere",function(){return this._calculateBoundingSphere(),this._boundingSphere}),a(0,i,"boundingBox",function(){return this._calculateBoundingBox(),this._boundingBox}),a(0,i,"boundingBoxCenter",function(){var t=this.boundingBox;return Pe.add(t.min,t.max,this._boundingBoxCenter),Pe.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenter}),e._splitAnimationDatas=function(t,e,i){for(var n=0,r=t.length,a=0;n<r;n++)for(var s=t[n]<<4,o=0;o<16;o++,a++)i[a]=e[s+o]},e}(Mi),un=function(t){function e(t,n){e.__super.call(this),void 0===t&&(t=.3),void 0===n&&(n=1e3),this._tempVector3=new Pe,this._position=new Pe,this._up=new Pe,this._forward=new Pe,this._right=new Pe,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=qe.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=t,this._farPlane=n,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),i.stage.on("resize",this,this._onScreenSizeChanged)}r(e,"laya.d3.core.BaseCamera",t);var s=e.prototype;return s._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var t=this.scene._cameraPool,e=t.length-1,i=0;i<e;i++)if(t[i].renderingOrder>t[e].renderingOrder){var n=t[i];t[i]=t[e],t[e]=n}},s._calculateProjectionMatrix=function(){},s._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},s._prepareCameraToRender=function(){W._currentCameraCullingMask=this.cullingMask;var t=this._shaderValues;t.setValue(0,this.transform.position.elements),t.setValue(5,this.forward.elements),t.setValue(6,this.up.elements)},s._prepareCameraViewProject=function(t,e){var i=this._shaderValues;i.setValue(1,t.elements),i.setValue(2,e.elements)},s._renderCamera=function(t,e,i){},s.addLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask|t.mask)},s.removeLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask&~t.mask)},s.addAllLayers=function(){this.cullingMask=2147483647},s.removeAllLayers=function(){this.cullingMask=0|W.getLayerByNumber(29).mask|W.getLayerByNumber(30).mask},s.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},s.moveForward=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=t,this.transform.translate(this._tempVector3)},s.moveRight=function(t){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=t,this.transform.translate(this._tempVector3)},s.moveVertical=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=t,this.transform.translate(this._tempVector3,!1)},s._addSelfRenderObjects=function(){var t=this.scene._cameraPool,e=t.length;if(e>0){for(var i=e-1;i>=0;i--)if(this.renderingOrder<=t[i].renderingOrder){t.splice(i+1,0,this);break}}else t.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},s._clearSelfRenderObjects=function(){var t=this.scene._cameraPool;t.splice(t.indexOf(this),1)},s.destroy=function(e){void 0===e&&(e=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,i.stage.off("resize",this,this._onScreenSizeChanged),t.prototype.destroy.call(this,e)},a(0,s,"sky",function(){return this._sky},function(t){this._sky=t,t._ownerCamera=this}),a(0,s,"forward",function(){var t=this.transform.worldMatrix.elements,e=this._forward.elements;return e[0]=-t[8],e[1]=-t[9],e[2]=-t[10],this._forward}),a(0,s,"position",function(){var t=this.transform.worldMatrix.elements,e=this._position.elements;return e[0]=t[12],e[1]=t[13],e[2]=t[14],this._position}),a(0,s,"renderTarget",function(){return this._renderTarget},function(t){this._renderTarget=t,null!=t&&(this._renderTargetSize=t.size)}),a(0,s,"up",function(){var t=this.transform.worldMatrix.elements,e=this._up.elements;return e[0]=t[4],e[1]=t[5],e[2]=t[6],this._up}),a(0,s,"right",function(){var t=this.transform.worldMatrix.elements,e=this._right.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],this._right}),a(0,s,"renderTargetSize",function(){return this._renderTargetSize},function(t){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=t,this._calculateProjectionMatrix()}),a(0,s,"fieldOfView",function(){return this._fieldOfView},function(t){this._fieldOfView=t,this._calculateProjectionMatrix()}),a(0,s,"nearPlane",function(){return this._nearPlane},function(t){this._nearPlane=t,this._calculateProjectionMatrix()}),a(0,s,"farPlane",function(){return this._farPlane},function(t){this._farPlane=t,this._calculateProjectionMatrix()}),a(0,s,"orthographic",function(){return this._orthographic},function(t){this._orthographic=t,this._calculateProjectionMatrix()}),a(0,s,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(t){this._orthographicVerticalSize=t,this._calculateProjectionMatrix()}),a(0,s,"renderingOrder",function(){return this._renderingOrder},function(t){this._renderingOrder=t,this._sortCamerasByRenderingOrder()}),e.CAMERAPOS=0,e.VIEWMATRIX=1,e.PROJECTMATRIX=2,e.VPMATRIX=3,e.VPMATRIX_NO_TRANSLATE=4,e.CAMERADIRECTION=5,e.CAMERAUP=6,e.ENVIRONMENTDIFFUSE=7,e.ENVIRONMENTSPECULAR=8,e.SIMLODINFO=9,e.DIFFUSEIRRADMATR=10,e.DIFFUSEIRRADMATG=11,e.DIFFUSEIRRADMATB=12,e.HDREXPOSURE=13,e.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",e.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",e.CLEARFLAG_SOLIDCOLOR=0,e.CLEARFLAG_SKY=1,e.CLEARFLAG_DEPTHONLY=2,e.CLEARFLAG_NONE=3,n(e,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new be(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new be},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new be}]),e}(Vi),_n=function(t){function e(t){this._render=null,this._geometryFilter=null,e.__super.call(this,t)}r(e,"laya.d3.core.RenderableSprite3D",t);var i=e.prototype;return i._addToInitStaticBatchManager=function(){},i._setBelongScene=function(e){t.prototype._setBelongScene.call(this,e),e._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},i._setUnBelongScene=function(){var e=this._scene._renderableSprite3Ds,i=e.indexOf(this);e.splice(i,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),t.prototype._setUnBelongScene.call(this)},i._update=function(t){t.owner=this,this._activeInHierarchy&&(this._updateComponents(t),this._render._updateOctreeNode(),this._lateUpdateComponents(t),D.spriteCount++,this._childs.length&&this._updateChilds(t))},i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._render._destroy(),this._render=null},e.__init__=function(){e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=e.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),e.SAHDERDEFINE_LIGHTMAP=e.shaderDefines.registerDefine("LIGHTMAP")},e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,e.SAHDERDEFINE_LIGHTMAP=4,e.LIGHTMAPSCALEOFFSET=2,e.LIGHTMAP=3,n(e,["shaderDefines",function(){return this.shaderDefines=new Fe}]),e}(Vi),dn=function(t){function e(){this._intensityColor=null,this._intensity=NaN,this._shadow=!1,this._shadowFarPlane=0,this._shadowMapSize=0,this._shadowMapCount=0,this._shadowMapPCFType=0,this._parallelSplitShadowMap=null,this._lightmapBakedType=0,this.color=null,e.__super.call(this),this._intensity=1,this._intensityColor=new Pe,this.color=new Pe(1,1,1),this._shadow=!1,this._shadowFarPlane=8,this._shadowMapSize=512,this._shadowMapCount=1,this._shadowMapPCFType=0,this._lightmapBakedType=e.LIGHTMAPBAKEDTYPE_REALTIME}r(e,"laya.d3.core.light.LightSprite",Vi);var i=e.prototype;return i._parseCustomProps=function(t,e,i,n){var r=i.color,a=this.color.elements;a[0]=r[0],a[1]=r[1],a[2]=r[2]},i._addSelfRenderObjects=function(){this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._addLight(this)},i._clearSelfRenderObjects=function(){this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._removeLight(this)},i._prepareToScene=function(t){return!1},a(0,i,"lightmapBakedType",function(){return this._lightmapBakedType},function(t){this._lightmapBakedType!==t&&(this._lightmapBakedType=t,this._activeInHierarchy&&(t!==e.LIGHTMAPBAKEDTYPE_BAKED?this._scene._addLight(this):this._scene._removeLight(this)))}),a(0,i,"shadowPCFType",function(){return this._shadowMapPCFType},function(t){this._shadowMapPCFType=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setPCFType(t)}),a(0,i,"intensity",function(){return this._intensity},function(t){this._intensity=t}),a(0,i,"shadow",function(){return this._shadow},function(t){throw new Error("LightSprite: must override it.")}),a(0,i,"shadowDistance",function(){return this._shadowFarPlane},function(t){this._shadowFarPlane=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setFarDistance(t)}),a(0,i,"shadowPSSMCount",function(){return this._shadowMapCount},function(t){this._shadowMapCount=t,this._parallelSplitShadowMap&&(this._parallelSplitShadowMap.PSSMNum=t)}),a(0,i,"shadowResolution",function(){return this._shadowMapSize},function(t){this._shadowMapSize=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setShadowMapTextureSize(t)}),a(0,i,"diffuseColor",function(){return console.log("LightSprite: discard property,please use color property instead."),this.color},function(t){console.log("LightSprite: discard property,please use color property instead."),this.color=t}),e.LIGHTMAPBAKEDTYPE_REALTIME=0,e.LIGHTMAPBAKEDTYPE_MIXED=1,e.LIGHTMAPBAKEDTYPE_BAKED=2,e}(),fn=function(t){function e(t){this._terrainRes=null,this._lightmapScaleOffset=null,e.__super.call(this),this._lightmapScaleOffset=new Ne(1,1,0,0),t&&(this._terrainRes=t,t.loaded?this.buildTerrain(t):t.once("loaded",this,this.buildTerrain))}r(e,"laya.d3.terrain.Terrain",Vi);var n=e.prototype;return n._parseCustomProps=function(t,e,i,n){this.terrainRes=v.getRes(e[i.dataPath]);var r=i.lightmapIndex;null!=r&&this.setLightmapIndex(r);var a=i.lightmapScaleOffset;a&&this.setLightmapScaleOffset(new Ne(a[0],a[1],a[2],a[3]))},n.setLightmapIndex=function(t){for(var e=0;e<this._childs.length;e++)this._childs[e].terrainRender.lightmapIndex=t},n.setLightmapScaleOffset=function(t){if(t){t.cloneTo(this._lightmapScaleOffset);for(var e=0;e<this._childs.length;e++)this._childs[e].terrainRender.lightmapScaleOffset=this._lightmapScaleOffset}},n.disableLight=function(){for(var t=0,e=this._childs.length;t<e;t++)for(var i=this._childs[t],n=0,r=i._render.sharedMaterials.length;n<r;n++)i._render.sharedMaterials[n].disableLight()},n.buildTerrain=function(t){for(var e=t._chunkNumX,i=t._chunkNumZ,n=t._heightData,r=0,a=0;a<i;a++)for(var s=0;s<e;s++){for(var o=new xn(s,a,t._gridSize,n._terrainHeightData,n._width,n._height,t._cameraCoordinateInverse),l=t._chunkInfos[r++],h=0;h<l.alphaMap.length;h++){var c=l.detailID[h].length,u=c>0?t._detailTextureInfos[l.detailID[h][0]].diffuseTexture:null,_=c>1?t._detailTextureInfos[l.detailID[h][1]].diffuseTexture:null,d=c>2?t._detailTextureInfos[l.detailID[h][2]].diffuseTexture:null,f=c>3?t._detailTextureInfos[l.detailID[h][3]].diffuseTexture:null,p=c>0?t._detailTextureInfos[l.detailID[h][0]].scale:null,m=c>1?t._detailTextureInfos[l.detailID[h][1]].scale:null,g=c>2?t._detailTextureInfos[l.detailID[h][2]].scale:null,y=c>3?t._detailTextureInfos[l.detailID[h][3]].scale:null;o.buildRenderElementAndMaterial(c,l.normalMap,l.alphaMap[h],u,_,d,f,t._materialInfo.ambientColor,t._materialInfo.diffuseColor,t._materialInfo.specularColor,p?p.x:1,p?p.y:1,m?m.x:1,m?m.y:1,g?g.x:1,g?g.y:1,y?y.x:1,y?y.y:1)}o.terrainRender.receiveShadow=!0,o.terrainRender.lightmapScaleOffset=this._lightmapScaleOffset,this.addChild(o)}},n.width=function(){return this._terrainRes._chunkNumX*Ge.CHUNK_GRID_NUM*this._terrainRes._gridSize},n.depth=function(){return this._terrainRes._chunkNumZ*Ge.CHUNK_GRID_NUM*this._terrainRes._gridSize},n.getHeightXZ=function(t,i){if(!this._terrainRes||!this._terrainRes.loaded)return NaN;if(t-=this.transform.position.x,i-=this.transform.position.z,e.__VECTOR3__||(e.__VECTOR3__=new Pe),e.__VECTOR3__.elements[0]=t,e.__VECTOR3__.elements[1]=0,e.__VECTOR3__.elements[2]=i,Pe.transformV3ToV3(e.__VECTOR3__,Ge.__ADAPT_MATRIX_INV__,e.__VECTOR3__),t=e.__VECTOR3__.elements[0],i=e.__VECTOR3__.elements[2],t<0||t>this.width()||i<0||i>this.depth())return NaN;var n=this._terrainRes._gridSize,r=parseInt(""+t/n),a=parseInt(""+i/n),s=t-r*n,o=i-a*n,l=NaN,h=NaN,c=NaN,u=this._terrainRes._heightData;return s+o>n?(l=u._terrainHeightData[(a+1-1)*u._width+r+1],h=u._terrainHeightData[(a+1-1)*u._width+r],c=u._terrainHeightData[(a-1)*u._width+r+1],l+(h-l)*((n-s)/n)+(c-l)*((n-o)/n)):(l=u._terrainHeightData[Math.max(0,a-1)*u._width+r],h=u._terrainHeightData[Math.min(u._width*u._height-1,(a+1-1)*u._width+r)],c=u._terrainHeightData[Math.min(u._width*u._height-1,Math.max(0,a-1)*u._width+r+1)],l+(h-l)*(o/n)+(c-l)*(s/n))},a(0,n,"terrainRes",null,function(t){t&&(this._terrainRes=t,t.loaded?this.buildTerrain(t):t.once("loaded",this,this.buildTerrain))}),e.load=function(t){return i.loader.create(t,null,null,e,null,1,!1)},e.RENDER_LINE_MODEL=!1,e.LOD_TOLERANCE_VALUE=4,e.LOD_DISTANCE_FACTOR=2,e.__VECTOR3__=null,e}(),pn=(function(t){function e(t,i,n){this._long=NaN,this._width=NaN,this._height=NaN,void 0===t&&(t=1),void 0===i&&(i=1),void 0===n&&(n=1),e.__super.call(this),this._long=t,this._width=i,this._height=n,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}r(e,"laya.d3.resource.models.BoxMesh",nn);var i=e.prototype;i.recreateResource=function(){this._numberVertices=24,this._numberIndices=36;var t=Qt.vertexDeclaration,e=(t.vertexStride,this._long/2),i=this._height/2,n=this._width/2,r=new Float32Array([-e,i,-n,0,1,0,0,0,e,i,-n,0,1,0,1,0,e,i,n,0,1,0,1,1,-e,i,n,0,1,0,0,1,-e,-i,-n,0,-1,0,0,1,e,-i,-n,0,-1,0,1,1,e,-i,n,0,-1,0,1,0,-e,-i,n,0,-1,0,0,0,-e,i,-n,-1,0,0,0,0,-e,i,n,-1,0,0,1,0,-e,-i,n,-1,0,0,1,1,-e,-i,-n,-1,0,0,0,1,e,i,-n,1,0,0,1,0,e,i,n,1,0,0,0,0,e,-i,n,1,0,0,0,1,e,-i,-n,1,0,0,1,1,-e,i,n,0,0,1,0,0,e,i,n,0,0,1,1,0,e,-i,n,0,0,1,1,1,-e,-i,n,0,0,1,0,1,-e,i,-n,0,0,-1,1,0,e,i,-n,0,0,-1,0,0,e,-i,-n,0,0,-1,0,1,-e,-i,-n,0,0,-1,1,1]),a=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new Ki(t,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(r),this._indexBuffer.setData(a),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a(0,i,"long",function(){return this._long},function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())}),a(0,i,"width",function(){return this._width},function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())}),a(0,i,"height",function(){return this._height},function(t){this._height!==t&&(this._height=t,this.releaseResource(),this.activeResource())})}(),function(t){function e(t,i,n,r){this._radius=NaN,this._height=NaN,this._slices=0,this._stacks=0,void 0===t&&(t=.5),void 0===i&&(i=2),void 0===n&&(n=16),void 0===r&&(r=32),e.__super.call(this),this._radius=t,this._height=i<2*t?2*t:i,this._stacks=n,this._slices=r,this.recreateResource(),this._positions=this._getPositions(),this._generateBoundingObject()}r(e,"laya.d3.resource.models.CapsuleMesh",nn);var i=e.prototype;i.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this.slices+1)*2+2*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2*2+2*this._slices*3;var t=Qt.vertexDeclaration,e=t.vertexStride/4,i=new Float32Array(this._numberVertices*e),n=new Uint16Array(this._numberIndices),r=Math.PI/2/this._stacks,a=2*Math.PI/this._slices,s=this._height/2-this._radius,o=0,l=0,h=0,c=0,u=0,_=0,d=0,f=0;for(d=0;d<=this._stacks;d++)for(f=0;f<=this._slices;f++)o=this._radius*Math.cos(d*r)*Math.cos(f*a+Math.PI),l=this._radius*Math.sin(d*r),h=this._radius*Math.cos(d*r)*Math.sin(f*a+Math.PI),i[c++]=o,i[c++]=l+s,i[c++]=h,i[c++]=o,i[c++]=l,i[c++]=h,i[c++]=1-f/this._slices,i[c++]=(1-d/this._stacks)*(Math.PI*this._radius/2/(this._height+Math.PI*this._radius)),d<this._stacks&&(n[u++]=d*(this._slices+1)+f+(this._slices+1),n[u++]=d*(this._slices+1)+f,n[u++]=d*(this._slices+1)+f+1,n[u++]=d*(this._slices+1)+f+this._slices,n[u++]=d*(this._slices+1)+f,n[u++]=d*(this._slices+1)+f+(this._slices+1));for(_+=(this._stacks+1)*(this._slices+1),d=0;d<=this._stacks;d++)for(f=0;f<=this._slices;f++)o=this._radius*Math.cos(d*r)*Math.cos(f*a+Math.PI),l=this._radius*Math.sin(-d*r),h=this._radius*Math.cos(d*r)*Math.sin(f*a+Math.PI),i[c++]=o,i[c++]=l-s,i[c++]=h,i[c++]=o,i[c++]=l,i[c++]=h,i[c++]=1-f/this._slices,i[c++]=(d/this._stacks*(Math.PI*this._radius/2)+(this._height+Math.PI*this._radius/2))/(this._height+Math.PI*this._radius),d<this._stacks&&(n[u++]=_+d*(this._slices+1)+f,n[u++]=_+d*(this._slices+1)+f+(this._slices+1),n[u++]=_+d*(this._slices+1)+f+1,n[u++]=_+d*(this._slices+1)+f,n[u++]=_+d*(this._slices+1)+f+this._slices,n[u++]=_+d*(this._slices+1)+f+(this._slices+1));for(_+=(this._stacks+1)*(this._slices+1),f=0;f<=this._slices;f++)o=this._radius*Math.cos(f*a+Math.PI),l=s,h=this._radius*Math.sin(f*a+Math.PI),i[c++]=o,i[c+8*(this._slices+1)-1]=o,i[c++]=l,i[c+8*(this._slices+1)-1]=-l,i[c++]=h,i[c+8*(this._slices+1)-1]=h,i[c++]=o,i[c+8*(this._slices+1)-1]=o,i[c++]=0,i[c+8*(this._slices+1)-1]=0,i[c++]=h,i[c+8*(this._slices+1)-1]=h,i[c++]=1-1*f/this._slices,i[c+8*(this._slices+1)-1]=1-1*f/this._slices,i[c++]=Math.PI*this._radius/2/(this._height+Math.PI*this._radius),i[c+8*(this._slices+1)-1]=(Math.PI*this._radius/2+this._height)/(this._height+Math.PI*this._radius);for(f=0;f<this._slices;f++)n[u++]=f+_+(this._slices+1),n[u++]=f+_+1,n[u++]=f+_,n[u++]=f+_+(this._slices+1),n[u++]=f+_+(this._slices+1)+1,n[u++]=f+_+1;_+=2*(this._slices+1),this._vertexBuffer=new Ki(t,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a(0,i,"radius",function(){return this._radius},function(t){this._radius!==t&&(this._radius=t,this.releaseResource(),this.activeResource())}),a(0,i,"height",function(){return this._height},function(t){this._height!==t&&(this._height=t,this.releaseResource(),this.activeResource())}),a(0,i,"stacks",function(){return this._stacks},function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this.activeResource())}),a(0,i,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())})}(),function(t){function e(t,i,n){this._radius=NaN,this._height=NaN,this._slices=0,void 0===t&&(t=.5),void 0===i&&(i=2),void 0===n&&(n=32),e.__super.call(this),this._radius=t,this._height=i,this._slices=n,this.recreateResource(),this._positions=this._getPositions(),this._generateBoundingObject()}r(e,"laya.d3.resource.models.CylinderMesh",nn);var i=e.prototype;i.recreateResource=function(){this._numberVertices=this._slices+1+1+2*(this._slices+1)+(this._slices+1+1),this._numberIndices=3*this._slices+6*this._slices+3*this._slices;for(var t=Qt.vertexDeclaration,e=t.vertexStride/4,i=new Float32Array(this._numberVertices*e),n=new Uint16Array(this._numberIndices),r=2*Math.PI/this._slices,a=this._height/2,s=0,o=0,l=0,h=0,c=0,u=0,_=0,d=0;d<=this._slices;d++)0===d&&(i[u++]=0,i[u++]=a,i[u++]=0,i[u++]=0,i[u++]=1,i[u++]=0,i[u++]=.5,i[u++]=.5),s=d*r,l=Math.cos(s)*this._radius,h=a,c=Math.sin(s)*this._radius,i[u++]=l,i[u++]=h,i[u++]=c,i[u++]=0,i[u++]=1,i[u++]=0,i[u++]=.5+.5*Math.cos(s),i[u++]=.5+.5*Math.sin(s);for(var f=0;f<this._slices;f++)n[_++]=0,n[_++]=f+1,n[_++]=f+2;o+=this._slices+1+1;for(var p=0;p<=this._slices;p++)s=p*r,l=Math.cos(s+Math.PI)*this._radius,h=a,c=Math.sin(s+Math.PI)*this._radius,i[u++]=l,i[u+8*(this._slices+1)-1]=l,i[u++]=h,i[u+8*(this._slices+1)-1]=-h,i[u++]=c,i[u+8*(this._slices+1)-1]=c,i[u++]=l,i[u+8*(this._slices+1)-1]=l,i[u++]=0,i[u+8*(this._slices+1)-1]=0,i[u++]=c,i[u+8*(this._slices+1)-1]=c,i[u++]=1-1*p/this._slices,i[u+8*(this._slices+1)-1]=1-1*p/this._slices,i[u++]=0,i[u+8*(this._slices+1)-1]=1;u+=8*(this._slices+1);for(var m=0;m<this._slices;m++)n[_++]=m+o+(this._slices+1),n[_++]=m+o+1,n[_++]=m+o,n[_++]=m+o+(this._slices+1),n[_++]=m+o+(this._slices+1)+1,n[_++]=m+o+1;o+=2*(this._slices+1);for(var g=0;g<=this._slices;g++)0===g&&(i[u++]=0,i[u++]=-a,i[u++]=0,i[u++]=0,i[u++]=-1,i[u++]=0,i[u++]=.5,i[u++]=.5),s=g*r,l=Math.cos(s+Math.PI)*this._radius,h=-a,c=Math.sin(s+Math.PI)*this._radius,i[u++]=l,i[u++]=h,i[u++]=c,i[u++]=0,i[u++]=-1,i[u++]=0,i[u++]=.5+.5*Math.cos(s),i[u++]=.5+.5*Math.sin(s);for(var y=0;y<this._slices;y++)n[_++]=0+o,n[_++]=y+2+o,n[_++]=y+1+o;o+=this._slices+1+1,this._vertexBuffer=new Ki(t,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a(0,i,"radius",function(){return this._radius},function(t){this._radius!==t&&(this._radius=t,this.releaseResource(),this.activeResource())}),a(0,i,"height",function(){return this._height},function(t){this._height!==t&&(this._height=t,this.releaseResource(),this.activeResource())}),a(0,i,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())})}(),function(t){function e(t,i,n,r){this._long=NaN,this._width=NaN,this._stacks=0,this._slices=0,void 0===t&&(t=10),void 0===i&&(i=10),void 0===n&&(n=10),void 0===r&&(r=10),e.__super.call(this),this._long=t,this._width=i,this._stacks=n,this._slices=r,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}r(e,"laya.d3.resource.models.PlaneMesh",nn);var i=e.prototype;i.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var t=new Uint16Array(this._numberIndices),e=Qt.vertexDeclaration,i=e.vertexStride/4,n=new Float32Array(this._numberVertices*i),r=this._long/2,a=this._width/2,s=this._long/this._stacks,o=this._width/this._slices,l=0,h=0;h<=this._slices;h++)for(var c=0;c<=this._stacks;c++)n[l++]=c*s-r,n[l++]=0,n[l++]=h*o-a,n[l++]=0,n[l++]=1,n[l++]=0,n[l++]=1*c/this._stacks,n[l++]=1*h/this._slices;var u=0;for(h=0;h<this._slices;h++)for(c=0;c<this._stacks;c++)t[u++]=(h+1)*(this._stacks+1)+c,t[u++]=h*(this._stacks+1)+c,t[u++]=(h+1)*(this._stacks+1)+c+1,t[u++]=h*(this._stacks+1)+c,t[u++]=h*(this._stacks+1)+c+1,t[u++]=(h+1)*(this._stacks+1)+c+1;this._vertexBuffer=new Ki(e,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(t),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a(0,i,"long",function(){return this._long},function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())}),a(0,i,"width",function(){return this._width},function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())}),a(0,i,"stacks",function(){return this._stacks},function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this.activeResource())}),a(0,i,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())})}(),function(t){function e(t,i){this._long=NaN,this._width=NaN,void 0===t&&(t=1),void 0===i&&(i=1),e.__super.call(this),this._long=t,this._width=i,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}r(e,"laya.d3.resource.models.QuadMesh",nn);var i=e.prototype;i.recreateResource=function(){this._numberVertices=4,this._numberIndices=6;var t=Qt.vertexDeclaration,e=(t.vertexStride,this._long/2),i=this._width/2,n=new Float32Array([-e,i,0,0,0,1,0,0,e,i,0,0,0,1,1,0,-e,-i,0,0,0,1,0,1,e,-i,0,0,0,1,1,1]),r=new Uint16Array([0,1,2,3,2,1]);this._vertexBuffer=new Ki(t,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(r),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a(0,i,"long",function(){return this._long},function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())}),a(0,i,"width",function(){return this._width},function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())})}(),function(t){function e(t,i,n){this._radius=NaN,this._slices=0,this._stacks=0,void 0===t&&(t=.5),void 0===i&&(i=32),void 0===n&&(n=32),e.__super.call(this),this._radius=t,this._stacks=i,this._slices=n,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}r(e,"laya.d3.resource.models.SphereMesh",nn);var i=e.prototype;i.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2;for(var t=new Uint16Array(this._numberIndices),e=Qt.vertexDeclaration,i=e.vertexStride/4,n=new Float32Array(this._numberVertices*i),r=Math.PI/this._stacks,a=2*Math.PI/this._slices,s=0,o=0,l=0,h=0;h<this._stacks+1;h++)for(var c=Math.sin(h*r),u=Math.cos(h*r),_=0;_<this._slices+1;_++){var d=c*Math.sin(_*a+1*Math.PI/2),f=c*Math.cos(_*a+1*Math.PI/2);n[o+0]=d*this._radius,n[o+1]=u*this._radius,n[o+2]=f*this._radius,n[o+3]=d,n[o+4]=u,n[o+5]=f,n[o+6]=_/this._slices,n[o+7]=h/this._stacks,o+=i,h!=this._stacks-1&&(t[l++]=s+(this._slices+1),t[l++]=s,t[l++]=s+1,t[l++]=s+this._slices,t[l++]=s,t[l++]=s+(this._slices+1),s++)}this._vertexBuffer=new Ki(e,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(t),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a(0,i,"radius",function(){return this._radius},function(t){this._radius!==t&&(this._radius=t,this.releaseResource(),this.activeResource())}),a(0,i,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())}),a(0,i,"stacks",function(){return this._stacks},function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this.activeResource())})}(),function(t){function e(t,i,n){void 0===t&&(t=0),void 0===i&&(i=.3),void 0===n&&(n=1e3),this._viewMatrix=new be,this._projectionMatrix=new be,this._projectionViewMatrix=new be,this._viewport=new Oe(0,0,0,0),this._normalizedViewport=new Oe(0,0,1,1),this._aspectRatio=t,this._boundFrustumUpdate=!0,this._boundFrustum=new xe(be.DEFAULT),e.__super.call(this,i,n),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}r(e,"laya.d3.core.Camera",un);var s=e.prototype;return s._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},s._parseCustomProps=function(t,e,i,n){var r=i.clearColor;this.clearColor=new Ne(r[0],r[1],r[2],r[3]);var a=i.viewport;this.normalizedViewport=new Oe(a[0],a[1],a[2],a[3])},s._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.aspectRatio*.5,e=.5*this.orthographicVerticalSize;be.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._projectionMatrix)}else be.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},s._update=function(t){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,t)},s._renderCamera=function(t,e,i){var n,r;i.parallelSplitShadowMaps[0]&&i._renderShadowMap(t,e,this),e.camera=this,this._prepareCameraToRender(),i._preRenderUpdateComponents(e),n=e._viewMatrix=this.viewMatrix;var a=this._renderTarget;a?(a.start(),be.multiply(un._invertYScaleMatrix,this._projectionMatrix,un._invertYProjectionMatrix),be.multiply(un._invertYScaleMatrix,this.projectionViewMatrix,un._invertYProjectionViewMatrix),r=e._projectionMatrix=un._invertYProjectionMatrix,e._projectionViewMatrix=un._invertYProjectionViewMatrix):(r=e._projectionMatrix=this._projectionMatrix,e._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(n,r),e._viewport=this.viewport,i._preRenderScene(t,e,this.boundFrustum),i._clear(t,e),i._renderScene(t,e),i._postRenderUpdateComponents(e),a&&a.end()},s.viewportPointToRay=function(t,e){je.calculateCursorRay(t,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},s.normalizedViewportPointToRay=function(t,i){var n=e._tempVector20,r=this.viewport,a=t.elements,s=n.elements;s[0]=a[0]*r.width,s[1]=a[1]*r.height,je.calculateCursorRay(n,this.viewport,this._projectionMatrix,this.viewMatrix,null,i)},s.worldToViewportPoint=function(t,e){be.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(t,this._projectionViewMatrix,e);var n=e.elements;n[0]=n[0]/i.stage.clientScaleX,n[1]=n[1]/i.stage.clientScaleY},s.worldToNormalizedViewportPoint=function(t,e){be.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(t,this._projectionViewMatrix,e);var n=e.elements;n[0]=n[0]/i.stage.clientScaleX,n[1]=n[1]/i.stage.clientScaleY},s.convertScreenCoordToOrthographicCoord=function(t,e){if(this._orthographic){var i=_t.clientWidth,n=_t.clientHeight,r=this.orthographicVerticalSize*this.aspectRatio/i,a=this.orthographicVerticalSize/n,s=t.elements,o=e.elements;return o[0]=(-i/2+s[0])*r,o[1]=(n/2-s[1])*a,o[2]=(this.nearPlane-this.farPlane)*(s[2]+1)/2-this.nearPlane,Pe.transformCoordinate(e,this.transform.worldMatrix,e),!0}return!1},a(0,s,"projectionViewMatrix",function(){return be.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),a(0,s,"aspectRatio",function(){if(0===this._aspectRatio){var t=this.viewport;return t.width/t.height}return this._aspectRatio},function(t){if(t<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=t,this._calculateProjectionMatrix()}),a(0,s,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),a(0,s,"needViewport",function(){var t=this.normalizedViewport;return 0===t.x&&0===t.y&&1===t.width&&1===t.height}),a(0,s,"viewport",function(){if(this._viewportExpressedInClipSpace){var t=this._normalizedViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._viewport.x=t.x*i,this._viewport.y=t.y*n,this._viewport.width=t.width*i,this._viewport.height=t.height*n}return this._viewport},function(t){if(null!=this.renderTarget&&(t.x<0||t.y<0||0==t.width||0==t.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=t,this._calculateProjectionMatrix()}),a(0,s,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var t=this._viewport,e=this.renderTargetSize,i=e.width,n=e.height;this._normalizedViewport.x=t.x/i,this._normalizedViewport.y=t.y/n,this._normalizedViewport.width=t.width/i,this._normalizedViewport.height=t.height/n}return this._normalizedViewport},function(t){t.x<0&&(t.x=0,console.warn("Camera: viewport.x must large than 0.0.")),t.y<0&&(t.y=0,console.warn("Camera: viewport.y must large than 0.0.")),t.x+t.width>1&&(t.width=1-t.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),t.y+t.height>1&&(t.height=1-t.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=t,this._calculateProjectionMatrix()}),a(0,s,"projectionMatrix",function(){return this._projectionMatrix},function(t){this._projectionMatrix=t,this._useUserProjectionMatrix=!0}),a(0,s,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),n(e,["_tempVector20",function(){return this._tempVector20=new Le}]),e}()),mn=(function(t){function e(){e.__super.call(this),this._render=new Ci(this),this._render.on("materialchanged",this,this._onMaterialChanged);var t=new Ui;this._render.sharedMaterial=t,this._geometryFilter=new Li(this),t.renderMode=8,this._changeRenderObject(0)}r(e,"laya.d3.core.glitter.Glitter",t);var i=e.prototype;i._changeRenderObject=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new ct),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=Ui.defaultMaterial);var r=this._geometryFilter;return i._mainSortID=0,i._sprite3D=this,i.renderObj=r,i._material=n,i},i._onMaterialChanged=function(t,e,i){e<t._renderElements.length&&this._changeRenderObject(e)},i._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},i._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},i._update=function(e){this._geometryFilter._update(e.elapsedTime),t.prototype._update.call(this,e)},i.addGlitterByPositions=function(t,e){this._geometryFilter.addVertexPosition(t,e)},i.addGlitterByPositionsVelocitys=function(t,e,i,n){this._geometryFilter.addVertexPositionVelocity(t,e,i,n)},i.cloneTo=function(t){var e=t,i=e.templet,n=this._geometryFilter;i.lifeTime=n.lifeTime,i.minSegmentDistance=n.minSegmentDistance,i.minInterpDistance=n.minInterpDistance,i.maxSlerpCount=n.maxSlerpCount,i._maxSegments=n._maxSegments;var r=e._render,a=this._render;r.sharedMaterials=a.sharedMaterials,r.enable=a.enable,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy(),this._geometryFilter=null)},a(0,i,"templet",function(){return this._geometryFilter}),a(0,i,"glitterRender",function(){return this._render}),e.CURRENTTIME=2,e.DURATION=3}(_n),function(t){function e(){this._direction=null,this._updateDirection=!1,e.__super.call(this),this._updateDirection=!1,this._direction=new Pe,this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChange)}r(e,"laya.d3.core.light.DirectionLight",t);var i=e.prototype;return i._initShadow=function(){if(this._shadow)this._parallelSplitShadowMap=new He,this.scene.parallelSplitShadowMaps.push(this._parallelSplitShadowMap),this.transform.worldMatrix.getForward(this._direction),Pe.normalize(this._direction,this._direction),this._parallelSplitShadowMap.setInfo(this.scene,this._shadowFarPlane,this._direction,this._shadowMapSize,this._shadowMapCount,this._shadowMapPCFType);else{var t=this.scene.parallelSplitShadowMaps;t.splice(t.indexOf(this._parallelSplitShadowMap),1),this._parallelSplitShadowMap.disposeAllRenderTarget(),this._parallelSplitShadowMap=null,this.scene.removeShaderDefine(He.SHADERDEFINE_SHADOW_PSSM1),this.scene.removeShaderDefine(He.SHADERDEFINE_SHADOW_PSSM2),this.scene.removeShaderDefine(He.SHADERDEFINE_SHADOW_PSSM3)}},i._addSelfRenderObjects=function(){t.prototype._addSelfRenderObjects.call(this),this._shadow&&this._initShadow()},i._clearSelfRenderObjects=function(){var t=this.scene,e=t._shaderValues;e.setValue(4,null),e.setValue(3,null),t.removeShaderDefine(ci.SHADERDEFINE_DIRECTIONLIGHT)},i._prepareToScene=function(t){var e=t.scene;if(e.enableLight&&this._activeInHierarchy){var i=e._shaderValues;return e.addShaderDefine(ci.SHADERDEFINE_DIRECTIONLIGHT),Pe.scale(this.color,this._intensity,this._intensityColor),i.setValue(4,this._intensityColor.elements),this.transform.worldMatrix.getForward(this._direction),Pe.normalize(this._direction,this._direction),i.setValue(3,this._direction.elements),!0}return e.removeShaderDefine(ci.SHADERDEFINE_DIRECTIONLIGHT),!1},i._onWorldMatrixChange=function(){this._updateDirection=!0},a(0,i,"shadow",t.prototype._$get_shadow,function(t){this._shadow!==t&&(this._shadow=t,this.scene&&this._initShadow())}),a(0,i,"direction",function(){return console.log("Warning: discard property,please use transform's property instead."),this._updateDirection&&(this.transform.worldMatrix.getForward(this._direction),Pe.normalize(this._direction,this._direction),this._updateDirection=!1),this._direction},function(t){console.log("Warning: discard property,please use transform's property instead.");var e=this.transform.worldMatrix;e.setForward(t),this.transform.worldMatrix=e,Pe.normalize(t,t),this._direction=t,this.shadow&&this._parallelSplitShadowMap&&this._parallelSplitShadowMap._setGlobalParallelLightDir(this._direction)}),e}(dn)),gn=(function(t){function e(){this._range=NaN,this._attenuation=null,e.__super.call(this),this._range=6,this._attenuation=new Pe(.6,.6,.6)}r(e,"laya.d3.core.light.PointLight",dn);var i=e.prototype;i._clearSelfRenderObjects=function(){var t=this.scene,e=t._shaderValues;e.setValue(8,null),e.setValue(5,null),e.setValue(6,null),e.setValue(7,null),t.removeShaderDefine(ci.SHADERDEFINE_POINTLIGHT)},i._prepareToScene=function(t){var e=t.scene;if(e.enableLight&&this._activeInHierarchy){var i=e._shaderValues;return e.addShaderDefine(ci.SHADERDEFINE_POINTLIGHT),Pe.scale(this.color,this._intensity,this._intensityColor),i.setValue(8,this._intensityColor.elements),i.setValue(5,this.transform.position.elements),i.setValue(6,this.range),i.setValue(7,this.attenuation.elements),!0}return e.removeShaderDefine(ci.SHADERDEFINE_POINTLIGHT),!1},a(0,i,"range",function(){return this._range},function(t){this._range=t}),a(0,i,"attenuation",function(){return this._attenuation},function(t){this._attenuation=t})}(),function(t){function e(){this._updateDirection=!1,this._direction=null,this._spot=NaN,this._range=NaN,this._attenuation=null,e.__super.call(this),this._updateDirection=!1,this.direction=new Pe(0,-1,-1),this._attenuation=new Pe(.6,.6,.6),this._spot=96,this._range=6,this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChange)}r(e,"laya.d3.core.light.SpotLight",dn);var i=e.prototype;i._onWorldMatrixChange=function(){this._updateDirection=!0},i._clearSelfRenderObjects=function(){var t=this.scene,e=t._shaderValues;e.setValue(14,null),e.setValue(9,null),e.setValue(10,null),e.setValue(12,null),e.setValue(11,null),e.setValue(13,null),t.removeShaderDefine(ci.SHADERDEFINE_SPOTLIGHT)},i._prepareToScene=function(t){var e=t.scene;if(e.enableLight&&this._activeInHierarchy){var i=e._shaderValues;return e.addShaderDefine(ci.SHADERDEFINE_SPOTLIGHT),Pe.scale(this.color,this._intensity,this._intensityColor),i.setValue(14,this._intensityColor.elements),i.setValue(9,this.transform.position.elements),this.transform.worldMatrix.getForward(this._direction),Pe.normalize(this._direction,this._direction),i.setValue(10,this._direction.elements),i.setValue(12,this.range),i.setValue(11,this.spot),i.setValue(13,this.attenuation.elements),!0}return e.removeShaderDefine(ci.SHADERDEFINE_SPOTLIGHT),!1},a(0,i,"spot",function(){return this._spot},function(t){this._spot=t}),a(0,i,"direction",function(){return console.log("Warning: discard property,please use transform's property instead."),this._updateDirection&&(this.transform.worldMatrix.getForward(this._direction),this._updateDirection=!1),this._direction},function(t){console.log("Warning: discard property,please use transform's property instead.");var e=this.transform.worldMatrix;e.setForward(t),this.transform.worldMatrix=e,this._direction=t}),a(0,i,"range",function(){return this._range},function(t){this._range=t}),a(0,i,"attenuation",function(){return this._attenuation},function(t){this._attenuation=t})}(),function(t){function e(t,i){e.__super.call(this,i),this._geometryFilter=new bi(this),this._render=new Mi(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),t&&(this._geometryFilter.sharedMesh=t,t instanceof laya.d3.resource.models.Mesh&&(t.loaded?this._render.sharedMaterials=t.materials:t.once("loaded",this,this._applyMeshMaterials)))}r(e,"laya.d3.core.MeshSprite3D",t);var s=e.prototype;return s._changeRenderObjectByMesh=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new hi),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=zi.defaultMaterial);var r=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(r,n),i._sprite3D=this,i.renderObj=r,i._material=n,i},s._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements[t];e||(e=zi.defaultMaterial);var n=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(n,e),i._sprite3D=this,i.renderObj=n,i._material=e,i},s._changeRenderObjectsByMesh=function(){var t=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=t;for(var e=0;e<t;e++)this._changeRenderObjectByMesh(e)},s._onMeshChanged=function(t){var e=t.sharedMesh;e.loaded?this._changeRenderObjectsByMesh():e.once("loaded",this,this._onMeshLoaded)},s._onMeshLoaded=function(t){t===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},s._onMaterialChanged=function(t,e,i){e<this._render._renderElements.length&&this._changeRenderObjectByMaterial(e,i)},s._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},s._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},s._parseCustomProps=function(t,e,i,n){var r=this.meshRender,a=i.lightmapIndex;null!=a&&(r.lightmapIndex=a);var s,o,l=i.lightmapScaleOffset;if(l&&(r.lightmapScaleOffset=new Ne(l[0],l[1],l[2],l[3])),n.instanceParams)(s=n.instanceParams.loadPath)&&(o=v.getRes(e[s]),this.meshFilter.sharedMesh=o,o.loaded?r.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(s=i.meshPath)&&(o=v.getRes(e[s]),this.meshFilter.sharedMesh=o);var h=i.materials;if(h){var c=r.sharedMaterials,u=h.length;c.length=u;for(var _=0;_<u;_++)c[_]=v.getRes(e[h[_].path]);r.sharedMaterials=c}}},s._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},s._addToInitStaticBatchManager=function(){e._staticBatchManager._addInitBatchSprite(this)},s.cloneTo=function(t){var e=t;e._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.lightmapIndex=i.lightmapIndex,n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},s.destroy=function(e){if(void 0===e&&(e=!0),!this.destroyed){var i=this.meshFilter.sharedMesh;i.loaded||i.off("loaded",this,this._applyMeshMaterials),t.prototype.destroy.call(this,e),this._geometryFilter._destroy()}},a(0,s,"meshFilter",function(){return this._geometryFilter}),a(0,s,"meshRender",function(){return this._render}),e.__init__=function(){wt._staticBatchManagers.push(e._staticBatchManager)},e.load=function(t){return i.loader.create(t,null,null,e)},n(e,["_staticBatchManager",function(){return this._staticBatchManager=new ui}]),e}(_n)),yn=function(t){function e(t){e.__super.call(this),this._render=new Di(this),this._render.on("materialchanged",this,this._onMaterialChanged),this._geometryFilter=new Ii(this),this._createRenderElement(0),t&&(this._render.sharedMaterial=t)}r(e,"laya.d3.core.particleShuriKen.ShuriKenParticle3D",t);var s=e.prototype;return s._initParticleVelocity=function(t){for(var e=new $,i=t.velocitys,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},s._initParticleColor=function(t){var e=new Z,i=t.alphas,n=0,r=0;for(n=0,r=i.length;n<r;n++){var a=i[n];e.addAlpha(a.key,a.value)}var s=t.rgbs;for(n=0,r=s.length;n<r;n++){var o=s[n],l=o.value;e.addRGB(o.key,new Pe(l[0],l[1],l[2]))}return e},s._initParticleSize=function(t){for(var e=new $,i=t.sizes,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},s._initParticleRotation=function(t){for(var e=new $,i=t.angularVelocitys,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value/180*Math.PI)}return e},s._initParticleFrame=function(t){for(var e=new Q,i=t.frames,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},s._createRenderElement=function(t){var e=this._render._renderElements[t]=new ct;e._render=this._render;var i=this._render.sharedMaterials[t];i||(i=qi.defaultMaterial);var n=this._geometryFilter;e._mainSortID=0,e._sprite3D=this,e.renderObj=n,e._material=i},s._onMaterialChanged=function(t,e,i){var n=t._renderElements;e<n.length&&(n[e]._material=i||qi.defaultMaterial)},s._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},s._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},s._parseCustomProps=function(t,i,n,r){var a,s=Math.PI/180,o=0,l=0,h=this.particleRender,c=n.material;if(c)a=v.getRes(i[c.path]);else{var u=n.materialPath;u?a=v.getRes(i[u]):(a=new qi).diffuseTexture=i?v.getRes(i[n.texturePath]):ln.load(n.texturePath)}h.sharedMaterial=a;var _=n.meshPath;_&&(h.mesh=v.getRes(i[_])),h.renderMode=n.renderMode,h.stretchedBillboardCameraSpeedScale=n.stretchedBillboardCameraSpeedScale,h.stretchedBillboardSpeedScale=n.stretchedBillboardSpeedScale,h.stretchedBillboardLengthScale=n.stretchedBillboardLengthScale,h.sortingFudge=n.sortingFudge?n.sortingFudge:0;var d=this.particleSystem;d.isPerformanceMode=n.isPerformanceMode,d.duration=n.duration,d.looping=n.looping,d.prewarm=n.prewarm,d.startDelayType=n.startDelayType,d.startDelay=n.startDelay,d.startDelayMin=n.startDelayMin,d.startDelayMax=n.startDelayMax,d.startLifetimeType=n.startLifetimeType,d.startLifetimeConstant=n.startLifetimeConstant,d.startLifeTimeGradient=e._initStartLife(n.startLifetimeGradient),d.startLifetimeConstantMin=n.startLifetimeConstantMin,d.startLifetimeConstantMax=n.startLifetimeConstantMax,d.startLifeTimeGradientMin=e._initStartLife(n.startLifetimeGradientMin),d.startLifeTimeGradientMax=e._initStartLife(n.startLifetimeGradientMax),d.startSpeedType=n.startSpeedType,d.startSpeedConstant=n.startSpeedConstant,d.startSpeedConstantMin=n.startSpeedConstantMin,d.startSpeedConstantMax=n.startSpeedConstantMax,d.threeDStartSize=n.threeDStartSize,d.startSizeType=n.startSizeType,d.startSizeConstant=n.startSizeConstant;var f=n.startSizeConstantSeparate,p=d.startSizeConstantSeparate.elements;p[0]=f[0],p[1]=f[1],p[2]=f[2],d.startSizeConstantMin=n.startSizeConstantMin,d.startSizeConstantMax=n.startSizeConstantMax;var m=n.startSizeConstantMinSeparate,g=d.startSizeConstantMinSeparate.elements;g[0]=m[0],g[1]=m[1],g[2]=m[2];var y=n.startSizeConstantMaxSeparate,S=d.startSizeConstantMaxSeparate.elements;S[0]=y[0],S[1]=y[1],S[2]=y[2],d.threeDStartRotation=n.threeDStartRotation,d.startRotationType=n.startRotationType,d.startRotationConstant=n.startRotationConstant*s;var x=n.startRotationConstantSeparate,E=d.startRotationConstantSeparate.elements;E[0]=x[0]*s,E[1]=x[1]*s,E[2]=x[2]*s,d.startRotationConstantMin=n.startRotationConstantMin*s,d.startRotationConstantMax=n.startRotationConstantMax*s;var T=n.startRotationConstantMinSeparate,w=d.startRotationConstantMinSeparate.elements;w[0]=T[0]*s,w[1]=T[1]*s,w[2]=T[2]*s;var C=n.startRotationConstantMaxSeparate,b=d.startRotationConstantMaxSeparate.elements;b[0]=C[0]*s,b[1]=C[1]*s,b[2]=C[2]*s,d.randomizeRotationDirection=n.randomizeRotationDirection,d.startColorType=n.startColorType;var M=n.startColorConstant,I=d.startColorConstant.elements;I[0]=M[0],I[1]=M[1],I[2]=M[2],I[3]=M[3];var D=n.startColorConstantMin,A=d.startColorConstantMin.elements;A[0]=D[0],A[1]=D[1],A[2]=D[2],A[3]=D[3];var R=n.startColorConstantMax,L=d.startColorConstantMax.elements;L[0]=R[0],L[1]=R[1],L[2]=R[2],L[3]=R[3],d.gravityModifier=n.gravityModifier,d.simulationSpace=n.simulationSpace,d.scaleMode=n.scaleMode,d.playOnAwake=n.playOnAwake,d.maxParticles=n.maxParticles;var P=n.autoRandomSeed;null!=P&&(d.autoRandomSeed=P);var N=n.randomSeed;null!=N&&(d.randomSeed[0]=N);var O=n.emission,V=d.emission;if(O){V.emissionRate=O.emissionRate;var k=O.bursts;if(k)for(o=0,l=k.length;o<l;o++){var F=k[o];V.addBurst(new z(F.time,F.min,F.max))}V.enbale=O.enable}else V.enbale=!1;var B=n.shape;if(B){var U;switch(B.shapeType){case 0:var H;U=H=new li,H.radius=B.sphereRadius,H.emitFromShell=B.sphereEmitFromShell,H.randomDirection=B.sphereRandomDirection;break;case 1:var G;U=G=new oi,G.radius=B.hemiSphereRadius,G.emitFromShell=B.hemiSphereEmitFromShell,G.randomDirection=B.hemiSphereRandomDirection;break;case 2:var W;U=W=new si,W.angle=B.coneAngle*s,W.radius=B.coneRadius,W.length=B.coneLength,W.emitType=B.coneEmitType,W.randomDirection=B.coneRandomDirection;break;case 3:var X;U=X=new ri,X.x=B.boxX,X.y=B.boxY,X.z=B.boxZ,X.randomDirection=B.boxRandomDirection;break;case 7:var Z;U=Z=new ai,Z.radius=B.circleRadius,Z.arc=B.circleArc*s,Z.emitFromEdge=B.circleEmitFromEdge,Z.randomDirection=B.circleRandomDirection;break;default:var Q;U=Q=new ai,Q.radius=B.circleRadius,Q.arc=B.circleArc*s,Q.emitFromEdge=B.circleEmitFromEdge,Q.randomDirection=B.circleRandomDirection}U.enable=B.enable,d.shape=U}var $=n.velocityOverLifetime;if($){var it,nt=$.velocity;switch(nt.type){case 0:var lt=nt.constant;it=tt.createByConstant(new Pe(lt[0],lt[1],lt[2]));break;case 1:it=tt.createByGradient(this._initParticleVelocity(nt.gradientX),this._initParticleVelocity(nt.gradientY),this._initParticleVelocity(nt.gradientZ));break;case 2:var ht=nt.constantMin,ct=nt.constantMax;it=tt.createByRandomTwoConstant(new Pe(ht[0],ht[1],ht[2]),new Pe(ct[0],ct[1],ct[2]));break;case 3:it=tt.createByRandomTwoGradient(this._initParticleVelocity(nt.gradientXMin),this._initParticleVelocity(nt.gradientXMax),this._initParticleVelocity(nt.gradientYMin),this._initParticleVelocity(nt.gradientYMax),this._initParticleVelocity(nt.gradientZMin),this._initParticleVelocity(nt.gradientZMax))}var ut=new ot(it);ut.space=$.space,ut.enbale=$.enable,d.velocityOverLifetime=ut}var _t=n.colorOverLifetime;if(_t){var dt,ft=_t.color;switch(ft.type){case 0:var pt=ft.constant;dt=q.createByConstant(new Ne(pt[0],pt[1],pt[2],pt[3]));break;case 1:dt=q.createByGradient(this._initParticleColor(ft.gradient));break;case 2:var mt=ft.constantMin,gt=ft.constantMax;dt=q.createByRandomTwoConstant(new Ne(mt[0],mt[1],mt[2],mt[3]),new Ne(gt[0],gt[1],gt[2],gt[3]));break;case 3:dt=q.createByRandomTwoGradient(this._initParticleColor(ft.gradientMin),this._initParticleColor(ft.gradientMax))}var yt=new Y(dt);yt.enbale=_t.enable,d.colorOverLifetime=yt}var vt=n.sizeOverLifetime;if(vt){var St,xt=vt.size;switch(xt.type){case 0:St=xt.separateAxes?J.createByGradientSeparate(this._initParticleSize(xt.gradientX),this._initParticleSize(xt.gradientY),this._initParticleSize(xt.gradientZ)):J.createByGradient(this._initParticleSize(xt.gradient));break;case 1:if(xt.separateAxes){var Et=xt.constantMinSeparate,Tt=xt.constantMaxSeparate;St=J.createByRandomTwoConstantSeparate(new Pe(Et[0],Et[1],Et[2]),new Pe(Tt[0],Tt[1],Tt[2]))}else St=J.createByRandomTwoConstant(xt.constantMin,xt.constantMax);break;case 2:St=xt.separateAxes?J.createByRandomTwoGradientSeparate(this._initParticleSize(xt.gradientXMin),this._initParticleSize(xt.gradientYMin),this._initParticleSize(xt.gradientZMin),this._initParticleSize(xt.gradientXMax),this._initParticleSize(xt.gradientYMax),this._initParticleSize(xt.gradientZMax)):J.createByRandomTwoGradient(this._initParticleSize(xt.gradientMin),this._initParticleSize(xt.gradientMax))}var wt=new rt(St);wt.enbale=vt.enable,d.sizeOverLifetime=wt}var Ct=n.rotationOverLifetime;if(Ct){var bt,Mt=Ct.angularVelocity;switch(Mt.type){case 0:Mt.separateAxes||(bt=K.createByConstant(Mt.constant*s));break;case 1:Mt.separateAxes||(bt=K.createByGradient(this._initParticleRotation(Mt.gradient)));break;case 2:if(Mt.separateAxes){var It=Mt.constantMinSeparate,Dt=Mt.constantMaxSeparate;bt=K.createByRandomTwoConstantSeparate(new Pe(It[0]*s,It[1]*s,It[2]*s),new Pe(Dt[0]*s,Dt[1]*s,Dt[2]*s))}else bt=K.createByRandomTwoConstant(Mt.constantMin*s,Mt.constantMax*s);break;case 3:Mt.separateAxes||(bt=K.createByRandomTwoGradient(this._initParticleRotation(Mt.gradientMin),this._initParticleRotation(Mt.gradientMax)))}var At=new et(bt);At.enbale=Ct.enable,d.rotationOverLifetime=At}var Rt=n.textureSheetAnimation;if(Rt){var Lt,Pt=Rt.frame;switch(Pt.type){case 0:Lt=j.createByConstant(Pt.constant);break;case 1:Lt=j.createByOverTime(this._initParticleFrame(Pt.overTime));break;case 2:Lt=j.createByRandomTwoConstant(Pt.constantMin,Pt.constantMax);break;case 3:Lt=j.createByRandomTwoOverTime(this._initParticleFrame(Pt.overTimeMin),this._initParticleFrame(Pt.overTimeMax))}var Nt,Ot=Rt.startFrame;switch(Ot.type){case 0:Nt=at.createByConstant(Ot.constant);break;case 1:Nt=at.createByRandomTwoConstant(Ot.constantMin,Ot.constantMax)}var Vt=new st(Lt,Nt);Vt.enable=Rt.enable;var kt=Rt.tiles;Vt.tiles=new Le(kt[0],kt[1]),Vt.type=Rt.type,Vt.randomRow=Rt.randomRow;var Ft=Rt.rowIndex;void 0!==Ft&&(Vt.rowIndex=Ft),Vt.cycles=Rt.cycles,d.textureSheetAnimation=Vt}},s._activeHierarchy=function(){laya.d3.core.Sprite3D.prototype._activeHierarchy.call(this),this.particleSystem.playOnAwake&&this.particleSystem.play()},s._inActiveHierarchy=function(){laya.d3.core.Sprite3D.prototype._inActiveHierarchy.call(this),this.particleSystem.isAlive&&this.particleSystem.simulate(0,!0)},s.cloneTo=function(t){var e=t,i=e._geometryFilter;this._geometryFilter.cloneTo(i);var n=e._render,r=this._render;n.sharedMaterials=r.sharedMaterials,n.enable=r.enable,n.renderMode=r.renderMode,n.mesh=r.mesh,n.stretchedBillboardCameraSpeedScale=r.stretchedBillboardCameraSpeedScale,n.stretchedBillboardSpeedScale=r.stretchedBillboardSpeedScale,n.stretchedBillboardLengthScale=r.stretchedBillboardLengthScale,n.sortingFudge=r.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},s.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy(),this._geometryFilter=null)},a(0,s,"particleSystem",function(){return this._geometryFilter}),a(0,s,"particleRender",function(){return this._render}),e.__init__=function(){e.SHADERDEFINE_RENDERMODE_BILLBOARD=e.shaderDefines.registerDefine("SPHERHBILLBOARD"),e.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=e.shaderDefines.registerDefine("STRETCHEDBILLBOARD"),e.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=e.shaderDefines.registerDefine("HORIZONTALBILLBOARD"),e.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=e.shaderDefines.registerDefine("VERTICALBILLBOARD"),e.SHADERDEFINE_COLOROVERLIFETIME=e.shaderDefines.registerDefine("COLOROVERLIFETIME"),e.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=e.shaderDefines.registerDefine("RANDOMCOLOROVERLIFETIME"),e.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=e.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECONSTANT"),e.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=e.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECURVE"),e.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=e.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),e.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=e.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),e.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=e.shaderDefines.registerDefine("TEXTURESHEETANIMATIONCURVE"),e.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=e.shaderDefines.registerDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),e.SHADERDEFINE_ROTATIONOVERLIFETIME=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIME"),e.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMESEPERATE"),e.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECONSTANT"),e.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECURVE"),e.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),e.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),e.SHADERDEFINE_SIZEOVERLIFETIMECURVE=e.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVE"),e.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=e.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVESEPERATE"),e.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=e.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVES"),e.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=e.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),e.SHADERDEFINE_RENDERMODE_MESH=e.shaderDefines.registerDefine("RENDERMODE_MESH"),e.SHADERDEFINE_SHAPE=e.shaderDefines.registerDefine("SHAPE")},e.load=function(t){return i.loader.create(t,null,null,e)},e._initStartLife=function(t){for(var e=new $,i=t.startLifetimes,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},e.SHADERDEFINE_RENDERMODE_BILLBOARD=0,e.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=0,e.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=0,e.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=0,e.SHADERDEFINE_COLOROVERLIFETIME=0,e.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=0,e.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=0,e.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=0,e.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=0,e.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=0,e.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=0,e.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=0,e.SHADERDEFINE_ROTATIONOVERLIFETIME=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=0,e.SHADERDEFINE_SIZEOVERLIFETIMECURVE=0,e.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=0,e.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=0,e.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=0,e.SHADERDEFINE_RENDERMODE_MESH=0,e.SHADERDEFINE_SHAPE=0,e.WORLDPOSITION=0,e.WORLDROTATION=1,e.POSITIONSCALE=4,e.SIZESCALE=5,e.SCALINGMODE=6,e.GRAVITY=7,e.THREEDSTARTROTATION=8,e.STRETCHEDBILLBOARDLENGTHSCALE=9,e.STRETCHEDBILLBOARDSPEEDSCALE=10,e.SIMULATIONSPACE=11,e.CURRENTTIME=12,e.VOLVELOCITYCONST=13,e.VOLVELOCITYGRADIENTX=14,e.VOLVELOCITYGRADIENTY=15,e.VOLVELOCITYGRADIENTZ=16,e.VOLVELOCITYCONSTMAX=17,e.VOLVELOCITYGRADIENTXMAX=18,e.VOLVELOCITYGRADIENTYMAX=19,e.VOLVELOCITYGRADIENTZMAX=20,e.VOLSPACETYPE=21,e.COLOROVERLIFEGRADIENTALPHAS=22,e.COLOROVERLIFEGRADIENTCOLORS=23,e.MAXCOLOROVERLIFEGRADIENTALPHAS=24,e.MAXCOLOROVERLIFEGRADIENTCOLORS=25,e.SOLSIZEGRADIENT=26,e.SOLSIZEGRADIENTX=27,e.SOLSIZEGRADIENTY=28,e.SOLSizeGradientZ=29,e.SOLSizeGradientMax=30,e.SOLSIZEGRADIENTXMAX=31,e.SOLSIZEGRADIENTYMAX=32,e.SOLSizeGradientZMAX=33,e.ROLANGULARVELOCITYCONST=34,e.ROLANGULARVELOCITYCONSTSEPRARATE=35,e.ROLANGULARVELOCITYGRADIENT=36,e.ROLANGULARVELOCITYGRADIENTX=37,e.ROLANGULARVELOCITYGRADIENTY=38,e.ROLANGULARVELOCITYGRADIENTZ=39,e.ROLANGULARVELOCITYGRADIENTW=40,e.ROLANGULARVELOCITYCONSTMAX=41,e.ROLANGULARVELOCITYCONSTMAXSEPRARATE=42,e.ROLANGULARVELOCITYGRADIENTMAX=43,e.ROLANGULARVELOCITYGRADIENTXMAX=44,e.ROLANGULARVELOCITYGRADIENTYMAX=45,e.ROLANGULARVELOCITYGRADIENTZMAX=46,e.ROLANGULARVELOCITYGRADIENTWMAX=47,e.TEXTURESHEETANIMATIONCYCLES=48,e.TEXTURESHEETANIMATIONSUBUVLENGTH=49,e.TEXTURESHEETANIMATIONGRADIENTUVS=50,e.TEXTURESHEETANIMATIONGRADIENTMAXUVS=51,n(e,["shaderDefines",function(){return this.shaderDefines=new Fe(_n.shaderDefines)}]),e}(_n),vn=function(t){function e(t,i){this._subMeshOffset=null,e.__super.call(this,i),this._subMeshOffset=[],this._geometryFilter=new bi(this),this._render=new cn(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),t&&(this._geometryFilter.sharedMesh=t)}r(e,"laya.d3.core.SkinnedMeshSprite3D",t);var s=e.prototype;return s._changeRenderObjectByMesh=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new hi),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=zi.defaultMaterial);var r=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(r,n),i._sprite3D=this,i.renderObj=r,i._material=n,i},s._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements[t];e||(e=zi.defaultMaterial);var n=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(n,e),i._sprite3D=this,i.renderObj=n,i._material=e,i},s._changeRenderObjectsByMesh=function(){var t=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=t;for(var e=0;e<t;e++)this._changeRenderObjectByMesh(e)},s._onMeshChanged=function(t){var e=t.sharedMesh;e.loaded?this._changeRenderObjectsByMesh():e.once("loaded",this,this._changeRenderObjectsByMesh)},s._onMaterialChanged=function(t,e,i){e<this._render._renderElements.length&&this._changeRenderObjectByMaterial(e,i)},s._parseCustomProps=function(t,e,i,n){var r=this.skinnedMeshRender,a=i.lightmapIndex;null!=a&&(r.lightmapIndex=a);var s,o,l=i.lightmapScaleOffset;if(l&&(r.lightmapScaleOffset=new Ne(l[0],l[1],l[2],l[3])),n.instanceParams)(s=n.instanceParams.loadPath)&&(o=v.getRes(e[s]),this.meshFilter.sharedMesh=o,o.loaded?r.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(s=i.meshPath)&&(o=v.getRes(e[s]),this.meshFilter.sharedMesh=o);var h=i.materials;if(h){var c=r.sharedMaterials,u=h.length;c.length=u;for(var _=0;_<u;_++)c[_]=v.getRes(e[h[_].path]);r.sharedMaterials=c}var d=i.rootBone;d&&r._setRootBone(d);var f=i.boundBox;if(f){var p=f.min,m=f.max,g=new Se(new Pe(p[0],p[1],p[2]),new Pe(m[0],m[1],m[2]));r.localBoundBox=g}else r._hasIndependentBound=!1;var y=i.boundSphere;if(y){var S=y.center,x=new Ee(new Pe(S[0],S[1],S[2]),y.radius);r.localBoundSphere=x}}},s._changeHierarchyAnimator=function(t){if(t){var e=this.skinnedMeshRender;e._setCacheAnimator(t);var i=t.avatar;i&&e._setCacheAvatar(i)}laya.d3.core.Sprite3D.prototype._changeHierarchyAnimator.call(this,t)},s._clearSelfRenderObjects=function(){this._scene.removeFrustumCullingObject(this._render)},s._addSelfRenderObjects=function(){this._scene.addFrustumCullingObject(this._render)},s._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},s.cloneTo=function(t){var e=t;e._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,n._rootBone=i._rootBone;var a=i.localBoundSphere;a&&(n.localBoundSphere=a.clone());var s=i.localBoundBox;s&&(n.localBoundBox=s.clone()),n._hasIndependentBound=i._hasIndependentBound,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},s.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy())},a(0,s,"meshFilter",function(){return this._geometryFilter}),a(0,s,"skinnedMeshRender",function(){return this._render}),e.__init__=function(){e.SHADERDEFINE_BONE=e.shaderDefines.registerDefine("BONE")},e.load=function(t){return i.loader.create(t,null,null,e)},e.SHADERDEFINE_BONE=8,e.BONES=0,n(e,["shaderDefines",function(){return this.shaderDefines=new Fe(_n.shaderDefines)}]),e}(_n),Sn=(function(t){function e(t,i,n,r,a){void 0===t&&(t=.1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=.3),void 0===a&&(a=1e3),this._tempMatrix=new be,this._leftViewMatrix=new be,this._leftProjectionMatrix=new be,this._leftProjectionViewMatrix=new be,this._leftViewport=new Oe(0,0,0,0),this._leftNormalizedViewport=new Oe(0,0,.5,1),this._leftAspectRatio=i,this._rightViewMatrix=new be,this._rightProjectionMatrix=new be,this._rightProjectionViewMatrix=new be,this._rightViewport=new Oe(0,0,0,0),this._rightNormalizedViewport=new Oe(.5,0,.5,1),this._rightAspectRatio=n,this._pupilDistande=t,this._leftBoundFrustumUpdate=!0,this._leftBoundFrustum=new xe(be.DEFAULT),this._rightBoundFrustumUpdate=!0,this._rightBoundFrustum=new xe(be.DEFAULT),e.__super.call(this,r,a),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}r(e,"laya.d3.core.VRCamera",un);var i=e.prototype;i._onWorldMatrixChanged=function(){this._leftBoundFrustumUpdate=this._rightBoundFrustumUpdate=!0},i._calculatePupilOffset=function(){var t=this._tempVector3;return Pe.scale(this.right,this._pupilDistande/2,t),t.elements},i._calculateLeftProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.leftAspectRatio*.5,e=.5*this.orthographicVerticalSize;be.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._leftProjectionMatrix)}else be.createPerspective(3.1416*this.fieldOfView/180,this.leftAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._leftBoundFrustumUpdate=!0},i._calculateRightProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.rightAspectRatio*.5,e=.5*this.orthographicVerticalSize;be.createOrthoOffCenterRH(-t,t,e,e,this.nearPlane,this.farPlane,this._rightProjectionMatrix)}else be.createPerspective(3.1416*this.fieldOfView/180,this.rightAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._rightBoundFrustumUpdate=!0},i._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.leftAspectRatio*.5,e=.5*this.orthographicVerticalSize,i=this.orthographicVerticalSize*this.rightAspectRatio*.5,n=.5*this.orthographicVerticalSize;be.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._leftProjectionMatrix),be.createOrthoOffCenterRH(-i,i,n,n,this.nearPlane,this.farPlane,this._rightProjectionMatrix)}else be.createPerspective(3.1416*this.fieldOfView/180,this.leftAspectRatio,this.nearPlane,this.farPlane,this._leftProjectionMatrix),be.createPerspective(3.1416*this.fieldOfView/180,this.rightAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._leftBoundFrustumUpdate=this._rightBoundFrustumUpdate=!0},i._renderCamera=function(t,e,i){var n,r;e.camera=this,this._prepareCameraToRender(),i._preRenderUpdateComponents(e),n=e._viewMatrix=this.leftViewMatrix;var a,s,o=this._renderTarget;o?(o.start(),be.multiply(un._invertYScaleMatrix,this._leftProjectionMatrix,un._invertYProjectionMatrix),be.multiply(un._invertYScaleMatrix,this.leftProjectionViewMatrix,un._invertYProjectionViewMatrix),r=e._projectionMatrix=un._invertYProjectionMatrix,e._projectionViewMatrix=un._invertYProjectionViewMatrix):(r=e._projectionMatrix=this._leftProjectionMatrix,e._projectionViewMatrix=this.leftProjectionViewMatrix),this._prepareCameraViewProject(n,r),e._viewport=this.leftViewport,i._preRenderScene(t,e,this.leftBoundFrustum),i._clear(t,e),i._renderScene(t,e),a=e._viewMatrix=this.rightViewMatrix,o?(o.start(),be.multiply(un._invertYScaleMatrix,this._rightProjectionMatrix,un._invertYProjectionMatrix),be.multiply(un._invertYScaleMatrix,this.rightProjectionViewMatrix,un._invertYProjectionViewMatrix),e._projectionMatrix=un._invertYProjectionMatrix,s=e._projectionViewMatrix=un._invertYProjectionViewMatrix):(s=e._projectionMatrix=this._rightProjectionMatrix,e._projectionViewMatrix=this.rightProjectionViewMatrix),this._prepareCameraViewProject(a,s),e._viewport=this.rightViewport,i._preRenderScene(t,e,this.rightBoundFrustum),i._clear(t,e),i._renderScene(t,e),i._postRenderUpdateComponents(e),o&&o.end()},a(0,i,"rightBoundFrustum",function(){return this._rightBoundFrustumUpdate&&(this._rightBoundFrustum.matrix=this.rightProjectionViewMatrix),this._rightBoundFrustum}),a(0,i,"leftNormalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var t=this._leftViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._leftNormalizedViewport.x=t.x/i,this._leftNormalizedViewport.y=t.y/n,this._leftNormalizedViewport.width=t.width/i,this._leftNormalizedViewport.height=t.height/n}return this._leftNormalizedViewport}),a(0,i,"rightViewport",function(){if(this._viewportExpressedInClipSpace){var t=this._rightNormalizedViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._rightViewport.x=t.x*i,this._rightViewport.y=t.y*n,this._rightViewport.width=t.width*i,this._rightViewport.height=t.height*n}return this._rightViewport}),a(0,i,"viewport",null,function(t){if(null!=this.renderTarget&&(t.x<0||t.y<0||0==t.width||0==t.height))throw new Error("VRCamera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._leftViewport=new Oe(0,0,t.width/2,t.height),this._rightViewport=new Oe(t.width/2,0,t.width/2,t.height),this._calculateProjectionMatrix()}),a(0,i,"leftAspectRatio",function(){if(0===this._leftAspectRatio){var t=this.leftViewport;return t.width/t.height}return this._leftAspectRatio}),a(0,i,"rightAspectRatio",function(){if(0===this._rightAspectRatio){var t=this.rightViewport;return t.width/t.height}return this._rightAspectRatio}),a(0,i,"aspectRatio",null,function(t){if(t<0)throw new Error("VRCamera: the aspect ratio has to be a positive real number.");this._leftAspectRatio=t,this._rightAspectRatio=t,this._calculateRightProjectionMatrix()}),a(0,i,"rightNormalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var t=this._rightViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._rightNormalizedViewport.x=t.x/i,this._rightNormalizedViewport.y=t.y/n,this._rightNormalizedViewport.width=t.width/i,this._rightNormalizedViewport.height=t.height/n}return this._rightNormalizedViewport}),a(0,i,"normalizedViewport",null,function(t){if(t.x<0||t.y<0||t.x+t.width>1||t.x+t.height>1)throw new Error("VRCamera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!0,this._leftNormalizedViewport=new Oe(0,0,t.width/2,t.height),this._rightNormalizedViewport=new Oe(t.width/2,0,t.width/2,t.height),this._calculateProjectionMatrix()}),a(0,i,"leftViewport",function(){if(this._viewportExpressedInClipSpace){var t=this._leftNormalizedViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._leftViewport.x=t.x*i,this._leftViewport.y=t.y*n,this._leftViewport.width=t.width*i,this._leftViewport.height=t.height*n}return this._leftViewport}),a(0,i,"needLeftViewport",function(){var t=this.leftNormalizedViewport;return 0===t.x&&0===t.y&&1===t.width&&1===t.height}),a(0,i,"needRightViewport",function(){var t=this.rightNormalizedViewport;return 0===t.x&&0===t.y&&1===t.width&&1===t.height}),a(0,i,"leftViewMatrix",function(){var t=this._calculatePupilOffset(),e=this._tempMatrix;this.transform.worldMatrix.cloneTo(e);var i=e.elements;return i[12]-=t[0],i[13]-=t[1],i[14]-=t[2],e.invert(this._leftViewMatrix),this._leftViewMatrix}),a(0,i,"rightViewMatrix",function(){var t=this._calculatePupilOffset(),e=this._tempMatrix;this.transform.worldMatrix.cloneTo(e);var i=e.elements;return i[12]+=t[0],i[13]+=t[1],i[14]+=t[2],e.invert(this._rightViewMatrix),this._rightViewMatrix}),a(0,i,"leftProjectionMatrix",function(){return this._leftProjectionMatrix}),a(0,i,"leftProjectionViewMatrix",function(){return be.multiply(this.leftProjectionMatrix,this.leftViewMatrix,this._leftProjectionViewMatrix),this._leftProjectionViewMatrix}),a(0,i,"rightProjectionMatrix",function(){return this._rightProjectionMatrix}),a(0,i,"rightProjectionViewMatrix",function(){return be.multiply(this.rightProjectionMatrix,this.rightViewMatrix,this._rightProjectionViewMatrix),this._rightProjectionViewMatrix}),a(0,i,"leftBoundFrustum",function(){return this._leftBoundFrustumUpdate&&(this._leftBoundFrustum.matrix=this.leftProjectionViewMatrix),this._leftBoundFrustum})}(),function(t){function e(){e.__super.call(this),this._geometryFilter=new Ai(this),this._render=new Ri(this),this._changeRenderObjectsByMaterial(this._render,0,Zi.defaultMaterial),this._render.on("materialchanged",this,this._changeRenderObjectsByMaterial),this._geometryFilter.on("trailfilterchange",this,this._changeRenderObjectsByRenderElement)}r(e,"laya.d3.core.trail.TrailSprite3D",t);var i=e.prototype;return i._changeRenderObjectsByMaterial=function(t,e,i){var n=this._geometryFilter.getRenderElementsCount();this._render._renderElements.length=n;for(var r=0;r<n;r++)this._changeRenderObjectByMaterial(r,i)},i._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements;e||(e=Zi.defaultMaterial);var n=i[t];n||(n=i[t]=new ct),n._sprite3D=this,n.renderObj=this._geometryFilter.getRenderElement(t),n._render=this._render,n._material=e},i._changeRenderObjectsByRenderElement=function(t,e){var i=this._render._renderElements,n=i[t];n||(n=i[t]=new ct),n._sprite3D=this,n.renderObj=e,n._render=this._render,n._material=this._render.sharedMaterial},i._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},i._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},i._update=function(e){t.prototype._update.call(this,e),this._geometryFilter._update(e)},i._parseCustomProps=function(t,e,i,n){var r=this._render,a=this._geometryFilter,s=0,o=0,l=i.materials;if(l){var h=r.sharedMaterials,c=l.length;for(h.length=c,s=0;s<c;s++)h[s]=v.getRes(e[l[s].path]);r.sharedMaterials=h}var u=n.props;a.time=u.time,a.minVertexDistance=u.minVertexDistance,a.widthMultiplier=u.widthMultiplier,a.textureMode=u.textureMode;var _=[],d=i.widthCurve;for(s=0,o=d.length;s<o;s++){var f=new yt;f.time=d[s].time,f.inTangent=d[s].inTangent,f.outTangent=d[s].outTangent,f.value=d[s].value,_.push(f)}a.widthCurve=_;var p=i.colorGradient,m=new pt;m.mode=p.mode;var g,y,S=[],x=p.colorKeys;for(s=0,o=x.length;s<o;s++)y=x[s],g=new gt(new ft(y.value[0],y.value[1],y.value[2],1),y.time),S.push(g);var E,T,w=[],C=p.alphaKeys;for(s=0,o=C.length;s<o;s++)T=C[s],E=new mt(T.value,T.time),w.push(E);m.setKeys(S,w),a.colorGradient=m},i.reset=function(){this.trailFilter.reset()},i.cloneTo=function(t){laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t);var e,i=0,n=t,r=n.trailFilter;r.time=this.trailFilter.time,r.minVertexDistance=this.trailFilter.minVertexDistance,r.widthMultiplier=this.trailFilter.widthMultiplier;var a=this.trailFilter.widthCurve,s=[];for(i=0,e=a.length;i<e;i++){var o=new yt;a[i].cloneTo(o),s.push(o)}r.widthCurve=s;var l=new pt;this.trailFilter.colorGradient.cloneTo(l),r.colorGradient=l,r.textureMode=this.trailFilter.textureMode,n.trailRender.sharedMaterial=this.trailRender.sharedMaterial},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy(),this._geometryFilter=null)},a(0,i,"trailFilter",function(){return this._geometryFilter}),a(0,i,"trailRender",function(){return this._render}),e.__init__=function(){e.SHADERDEFINE_GRADIENTMODE_BLEND=e.shaderDefines.registerDefine("GRADIENTMODE_BLEND")},e.CURTIME=3,e.LIFETIME=4,e.WIDTHCURVE=5,e.WIDTHCURVEKEYLENGTH=6,e.GRADIENTCOLORKEY=7,e.GRADIENTALPHAKEY=8,e.SHADERDEFINE_GRADIENTMODE_BLEND=0,n(e,["shaderDefines",function(){return this.shaderDefines=new Fe(_n.shaderDefines)}]),e}(_n)),xn=function(t){function e(t,i,n,r,a,s,o,l){e.__super.call(this,l),this._geometryFilter=new Pi(this,t,i,n,r,a,s,o),this._render=new Ni(this)}r(e,"laya.d3.terrain.TerrainChunk",t);var n=e.prototype;return n.buildRenderElementAndMaterial=function(t,e,i,n,r,a,s,o,l,h,c,u,_,d,f,p,m,g){void 0===c&&(c=1),void 0===u&&(u=1),void 0===_&&(_=1),void 0===d&&(d=1),void 0===f&&(f=1),void 0===p&&(p=1),void 0===m&&(m=1),void 0===g&&(g=1);var y=new Yi;l&&(y.diffuseColor=l),o&&(y.ambientColor=o),h&&(y.specularColor=h),y.splatAlphaTexture=v.getRes(i),y.normalTexture=e?v.getRes(e):null,y.diffuseTexture1=n?v.getRes(n):null,y.diffuseTexture2=r?v.getRes(r):null,y.diffuseTexture3=a?v.getRes(a):null,y.diffuseTexture4=s?v.getRes(s):null,y.setDiffuseScale1(c,u),y.setDiffuseScale2(_,d),y.setDiffuseScale3(f,p),y.setDiffuseScale4(m,g),y.setDetailNum(t),0!=this._render._renderElements.length&&(y.renderMode=2);var S=new ct;S._mainSortID=0,S._sprite3D=this,S.renderObj=this._geometryFilter,S._material=y,this._render._materials.push(y),this._render._renderElements.push(S)},n._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},n._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},n._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},n.cloneTo=function(t){console.log("Terrain Chunk can't clone")},n.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy())},a(0,n,"terrainFilter",function(){return this._geometryFilter}),a(0,n,"terrainRender",function(){return this._render}),e.load=function(t){return i.loader.create(t,null,null,e,null,1,!1)},e}(_n);!function(t){function e(t,i,n){this._minX=NaN,this._minZ=NaN,this._cellSize=null,this._heightMap=null,e.__super.call(this,t,n),this._heightMap=i,this._cellSize=new Le}r(e,"laya.d3.core.MeshTerrainSprite3D",gn);var i=e.prototype;i._disableRotation=function(){var t=this.transform.rotation;t.elements[0]=0,t.elements[1]=0,t.elements[2]=0,t.elements[3]=1,this.transform.rotation=t},i._getScaleX=function(){var t=this.transform.worldMatrix.elements,e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},i._getScaleZ=function(){var t=this.transform.worldMatrix.elements,e=t[8],i=t[9],n=t[10];return Math.sqrt(e*e+i*i+n*n)},i._initCreateFromMesh=function(t,e){this._heightMap=G.creatFromMesh(this.meshFilter.sharedMesh,t,e,this._cellSize);var i=this.meshFilter.sharedMesh.boundingBox,n=i.min;i.max,this._minX=n.x,this._minZ=n.z},i._initCreateFromMeshHeightMap=function(t,e,i){var n=this,r=this.meshFilter.sharedMesh.boundingBox;t.loaded?(this._heightMap=G.createFromImage(t,e,i),this._computeCellSize(r)):t.once("loaded",null,function(){n._heightMap=G.createFromImage(t,e,i),n._computeCellSize(r)});var a=r.min;r.max,this._minX=a.x,this._minZ=a.z},i._computeCellSize=function(t){var e=t.min,i=t.max,n=e.x,r=e.z,a=i.x-n,s=i.z-r;this._cellSize.elements[0]=a/(this._heightMap.width-1),this._cellSize.elements[1]=s/(this._heightMap.height-1)},i._update=function(t){this._disableRotation(),laya.d3.core.RenderableSprite3D.prototype._update.call(this,t)},i.getHeight=function(t,i){e._tempVector3.elements[0]=t,e._tempVector3.elements[1]=0,e._tempVector3.elements[2]=i,this._disableRotation();var n=this.transform.worldMatrix;n.invert(e._tempMatrix4x4),Pe.transformCoordinate(e._tempVector3,e._tempMatrix4x4,e._tempVector3),t=e._tempVector3.elements[0],i=e._tempVector3.elements[2];var r=(t-this._minX)/this._cellSize.x,a=(i-this._minZ)/this._cellSize.y,s=Math.floor(a),o=Math.floor(r),l=r-o,h=a-s,c=n.elements,u=c[4],_=c[5],d=c[6],f=Math.sqrt(u*u+_*_+d*d),p=c[13],m=this._heightMap.getHeight(s,o+1),g=this._heightMap.getHeight(s+1,o);if(isNaN(m)||isNaN(g))return NaN;if(l+h<=1){var y=this._heightMap.getHeight(s,o);return isNaN(y)?NaN:(y+l*(m-y)+h*(g-y))*f+p}var v=this._heightMap.getHeight(s+1,o+1);return isNaN(v)?NaN:(v+(1-l)*(g-v)+(1-h)*(m-v))*f+p},a(0,i,"minX",function(){var t=this.transform.worldMatrix.elements;return this._minX*this._getScaleX()+t[12]}),a(0,i,"width",function(){return(this._heightMap.width-1)*this._cellSize.x*this._getScaleX()}),a(0,i,"minZ",function(){var t=this.transform.worldMatrix.elements;return this._minZ*this._getScaleZ()+t[14]}),a(0,i,"depth",function(){return(this._heightMap.height-1)*this._cellSize.y*this._getScaleZ()}),e.createFromMesh=function(t,i,n,r){var a=new e(t,null,r);return t.loaded?a._initCreateFromMesh(i,n):t.once("loaded",a,a._initCreateFromMesh,[i,n]),a},e.createFromMeshAndHeightMap=function(t,i,n,r,a){var s=new e(t,null,a);return t.loaded?s._initCreateFromMeshHeightMap(i,n,r):t.once("loaded",s,s._initCreateFromMeshHeightMap,[i,n,r]),s},n(e,["_tempVector3",function(){return this._tempVector3=new Pe},"_tempMatrix4x4",function(){return this._tempMatrix4x4=new be}])}()}(window,document,Laya),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports],__WEBPACK_AMD_DEFINE_RESULT__=function(t,e){for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__);var Point=laya.maths.Point,Box=Laya.Box,List=Laya.List,LayaEvent=laya.events.Event,Loader=laya.net.Loader,Handler=laya.utils.Handler,BitmapData=laya.resource.Texture,Texture=laya.resource.Texture,Rectangle=Laya.Rectangle,SoundManager=Laya.SoundManager,HttpRequest=laya.net.HttpRequest,Browser=laya.utils.Browser,Vector2=laya.d3.math.Vector2,Vector3=laya.d3.math.Vector3,Vector4=laya.d3.math.Vector4,Scene=laya.d3.core.scene.Scene,Camera=laya.d3.core.Camera,Sprite3D=laya.d3.core.Sprite3D,MeshSprite3D=laya.d3.core.MeshSprite3D,SkinnedMeshSprite3D=Laya.SkinnedMeshSprite3D,ShuriKenParticle3D=Laya.ShuriKenParticle3D,Transform3D=Laya.Transform3D,Quaternion=laya.d3.math.Quaternion,Component3D=Laya.Component3D,BaseMesh=laya.d3.resource.models.BaseMesh,Mesh=laya.d3.resource.models.Mesh,BoxMesh=laya.d3.resource.models.BoxMesh,QuadMesh=laya.d3.resource.models.QuadMesh,SphereMesh=laya.d3.resource.models.SphereMesh,CylinderMesh=laya.d3.resource.models.CylinderMesh,StandardMaterial=laya.d3.core.material.StandardMaterial,BoxCollider=laya.d3.component.physics.BoxCollider,BoundBox=laya.d3.math.BoundBox,WxSettingManager=function(){function t(){this.onGetSetting=function(t){t.authSetting["scope.userInfo"]}}return t.setup=function(){},t.prototype.getSetting=function(){PlatfromKit.isNewFor("1.2.0")&&wx.getSetting({success:this.onGetSetting})},t}(),WxUpdateManager=function(){function t(){}return t.setup=function(){try{(t.updateManager=wx.getUpdateManager())&&(t.updateManager.onUpdateReady(t.onUpdateReady),t.checkUpdate())}catch(t){console.error("微信更新管理出错",t)}},t.checkUpdate=function(){if(t.updateManager)try{console.log("检查更新11111111111"),t.updateManager.onCheckForUpdate(t.onCheckForUpdate),setTimeout(t.checkUpdate,36e5)}catch(t){console.error("微信更新管理出错",t)}},t.onCheckForUpdate=function(t){console.log("微信更新信息， ",t),t&&1==t.hasUpdate&&console.log("有新版本需要更新")},t.onUpdateReady=function(){console.log("版本更新准备好了 执行更新------------------"),t.updateManager.applyUpdate()},t}(),WxNavigateToMiniProgramInfo=function(){},TimeUtil=function(){function t(){}return t.getTimeStr=function(){var t=new Date;return t.getFullYear()+"-"+(Number(t.getMonth())+1)+"-"+t.getDate()},t}(),WxLogin=function(){function t(){var t=this;this.onGetSetting=function(e){e.authSetting["scope.userInfo"]?t.getUserInfo():t.toLogin(null,null)},this.getUserInfoSuccess=function(e){t.toLogin(e.encryptedData,e.iv)},this.getUserInfoFail=function(e){return EventManager.dispatchEvent(LibEvent.LOG,"获取微信用户信息失败，请检查网络状态"),t.fail.call(new Error("获取微信用户信息失败，请检查网络状态"))}}return t.prototype.login=function(t,e,i){this._starteLogintTime=(new Date).getTime(),this.loginUrl=t,this.success=e,this.fail=i,PlatfromKit.wxLogin(new CallBackFunc(this,this.onWxLoginSuccess),new CallBackFunc(this,this.onWxloginFail))},t.prototype.onWxLoginSuccess=function(t){this.wxCode=t.code,this.getSetting()},t.prototype.onWxloginFail=function(){EventManager.dispatchEvent(LibEvent.LOG,"微信登录失败！！"),console.log("微信登录失败！！"),this.fail.call(new Error("微信登录失败！！"))},t.prototype.getSetting=function(){PlatfromKit.isNewFor("1.2.0")?wx.getSetting({success:this.onGetSetting}):this.toLogin(null,null)},t.prototype.getUserInfo=function(){wx.getUserInfo({success:this.getUserInfoSuccess,fail:this.getUserInfoFail})},t.prototype.toLogin=function(t,e){var i={"X-WX-Code":this.wxCode};null!=t&&(i["X-WX-Encrypted-Data"]=t,i["X-WX-IV"]=e);var n=new MiniHttpRequest;n.request(this.loginUrl,"GET",null,i),n.addEventListener(Laya.Event.COMPLETE,this,this.onRequestSuccess),n.addEventListener(Laya.Event.ERROR,this,this.onRequestFail)},t.prototype.onRequestSuccess=function(t){var e=t.data;if(!e||0!==e.code||!e.data||!e.data.skey)return this.fail.call(new Error("响应错误，"+JSON.stringify(e)));e.data,traceLog("本次登录耗时:"+((new Date).getTime()-this._starteLogintTime)+"毫秒"),this.success.call(t)},t.prototype.onRequestFail=function(t){return EventManager.dispatchEvent(LibEvent.LOG,"登录失败，可能是网络错误或者服务器发生异常"),EventManager.dispatchEvent(LibEvent.LOG,JSON.stringify(t)),console.error("登录失败，可能是网络错误或者服务器发生异常"),this.fail.call(t)},t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),EventDispatcher=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addEventListener=function(e,i,n,r){return t.prototype.on.call(this,e,i,n,r)},e.prototype.removeEventListener=function(e,i,n,r){return t.prototype.off.call(this,e,i,n,r)},e.prototype.hasEventListener=function(e){return t.prototype.hasListener.call(this,e)},e.prototype.dispatchEvent=function(e,i){return t.prototype.event.call(this,e,i)},e}(Laya.EventDispatcher),WriteUtils=function(){function t(){}return t.writeSingleUnknown=function(e,i,n){switch(t.write$TYPE_UINT32(e,i),7&i){case WireType.VARINT:t.write$TYPE_UINT64(e,n);break;case WireType.FIXED_64_BIT:t.write$TYPE_FIXED64(e,n);break;case WireType.LENGTH_DELIMITED:t.write$TYPE_BYTES(e,n);break;case WireType.FIXED_32_BIT:t.write$TYPE_FIXED32(e,n)}},t.writeUnknownPair=function(e,i,n){var r;if(n)for(var a=0,s=n;a<s.length;a++)r=s[a],t.writeSingleUnknown(e,i,r);else t.writeSingleUnknown(e,i,n)},t.writeVarint64=function(e,i,n){var r=0;if(0==n)t.write$TYPE_UINT32(e,i);else{for(r=0;r<4;)e.writeByte(127&i|128),i>>>=7,r++;0==(2147483640&n)?e.writeByte(n<<4|i):(e.writeByte(127&(n<<4|i)|128),t.write$TYPE_UINT32(e,n>>>3))}},t.writeTag=function(e,i,n){t.write$TYPE_UINT32(e,n<<3|i)},t.write$TYPE_DOUBLE=function(t,e){t.writeDouble(e)},t.write$TYPE_FLOAT=function(t,e){t.writeFloat(e)},t.write$TYPE_INT64=function(e,i){t.writeVarint64(e,i.low,i.high)},t.write$TYPE_UINT64=function(e,i){t.writeVarint64(e,i.low,i.high)},t.write$TYPE_INT32=function(e,i){i<0?t.writeVarint64(e,i,4294967295):t.write$TYPE_UINT32(e,i)},t.write$TYPE_FIXED64=function(t,e){t.writeUnsignedInt(e.low),t.writeUnsignedInt(e.high)},t.write$TYPE_FIXED32=function(t,e){t.writeUnsignedInt(e)},t.write$TYPE_BOOL=function(t,e){t.writeByte(e?1:0)},t.write$TYPE_STRING=function(t,e){var i=t.beginBlock();t.writeUTFBytes(e),t.endBlock(i)},t.write$TYPE_BYTES=function(e,i){t.write$TYPE_UINT32(e,i.length),e.writeBytes(i)},t.write$TYPE_UINT32=function(t,e){for(;;){if(e<128)return void t.writeByte(e);t.writeByte(127&e|128),e>>>=7}},t.write$TYPE_ENUM=function(e,i){t.write$TYPE_INT32(e,i)},t.write$TYPE_SFIXED32=function(t,e){t.writeInt(e)},t.write$TYPE_SFIXED64=function(t,e){t.writeUnsignedInt(e.low),t.writeInt(e.high)},t.write$TYPE_SINT32=function(t,e){},t.write$TYPE_SINT64=function(t,e){},t.writePackedRepeated=function(t,e,i){for(var n=t.beginBlock(),r=0;r<i.length;)e(t,i[r]),r++;t.endBlock(n)},t}(),WireType=function(){function t(){}return t.VARINT=0,t.FIXED_64_BIT=1,t.LENGTH_DELIMITED=2,t.FIXED_32_BIT=5,t}(),GameSocketDispatcher=function(){function t(){}return t.addListener=function(e,i,n){t._funDic.hasOwnProperty(e.getCmdStr())?console.log("重复注册相同的Socket事件【"+e.getCmdStr()+"】,返回!"+i):t._funDic[e.getCmdStr()]={caller:i,func:n}},t.removeListener=function(e,i){delete t._funDic[e.getCmdStr()]},t.excute=function(e,i){var n=t._funDic[e.getCmdStr()];if(null!=n){var r=n.func,a=n.caller;i instanceof Array?r.apply(a,i):r.apply(a,[i])}},t.hasListener=function(e){return t._funDic.hasOwnProperty(e.getCmdStr())},t.willTrigger=function(e,i){var n=t._funDic[e.getCmdStr()];return Boolean(n==i)},t._funDic=new Object,t}(),CmdType=function(){function t(t){this.msgId=0,this.msgId=t,this._cmdStr=""+t}return t.prototype.getCmdStr=function(){return this._cmdStr},t}(),CmdMap=function(){function t(){}return t.addCmd=function(t){var e=t.msgId;this.cmds[e]=t},t.getCmdType=function(t){var e=t;return this.cmds[e]},t.cmds=new Object,t}(),ClassUtils=laya.utils.ClassUtils,ByteArray=function(){function t(){this.classDic={},this._length=0,this._objectEncoding_=0,this._position_=0,this._allocated_=8,this._littleEndian_=!1,this.___resizeBuffer(this._allocated_)}return t.prototype.clear=function(){this._strTable=[],this._objTable=[],this._traitsTable=[],this._position_=0,this.length=0},t.prototype.ensureWrite=function(t){this._length<t&&(this.length=t)},t.prototype.readBoolean=function(){return 0!=this.readByte()},t.prototype.readBytes=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw new Error("Read error - Out of bounds"+this.length);0==i&&(i=this._length-this._position_),t.ensureWrite(e+i),t._byteView_.set(this._byteView_.subarray(this._position_,this._position_+i),e),t.pos=e,this._position_+=i,t.pos+i>t.length&&(t.length=t.pos+i)},t.prototype.readDouble=function(){var t=this._data_.getFloat64(this._position_,this._littleEndian_);return this._position_+=8,t},t.prototype.readFloat=function(){var t=this._data_.getFloat32(this._position_,this._littleEndian_);return this._position_+=4,t},t.prototype.readFullBytes=function(t,e,i){this.ensureWrite(i);for(var n=e;n<e+i;n++)this._data_.setInt8(this._position_++,t.get(n))},t.prototype.readInt=function(){var t=this._data_.getInt32(this._position_,this._littleEndian_);return this._position_+=4,t},t.prototype.readShort=function(){var t=this._data_.getInt16(this._position_,this._littleEndian_);return this._position_+=2,t},t.prototype.readUnsignedByte=function(){return this._data_.getUint8(this._position_++)},t.prototype.readByte=function(){return this._data_.getInt8(this._position_++)},t.prototype.readUnsignedInt=function(){var t=this._data_.getUint32(this._position_,this._littleEndian_);return this._position_+=4,Number(t)},t.prototype.readUnsignedShort=function(){var t=this._data_.getUint16(this._position_,this._littleEndian_);return this._position_+=2,t},t.prototype.readUTF=function(){return this.readUTFBytes(this.readUnsignedShort())},t.prototype.readUnicode=function(t){for(var e,i="",n=this._position_+t,r=0;this._position_<n;)r=this._byteView_[this._position_++],e=this._byteView_[this._position_++],i+=String.fromCharCode(e<<8|r);return i},t.prototype.readMultiByte=function(t,e){return"UNICODE"==e||"unicode"==e?this.readUnicode(t):this.readUTFBytes(t)},t.prototype.readUTFBytes=function(t){void 0===t&&(t=-1);for(var e,i,n="",r=this._position_+t,a=0;this._position_<r;)(e=this._data_.getUint8(this._position_++))<128?0!=e&&(n+=String.fromCharCode(e)):e<224?n+=String.fromCharCode((63&e)<<6|127&this._data_.getUint8(this._position_++)):e<240?(i=this._data_.getUint8(this._position_++),n+=String.fromCharCode((31&e)<<12|(127&i)<<6|127&this._data_.getUint8(this._position_++))):(i=this._data_.getUint8(this._position_++),a=this._data_.getUint8(this._position_++),n+=String.fromCharCode((15&e)<<18|(127&i)<<12|a<<6&127|127&this._data_.getUint8(this._position_++)));return n},t.prototype.toString=function(){var t=this._position_;this._position_=0;var e=this.readUTFBytes(this.length);return this._position_=t,e},t.prototype.writeBoolean=function(t){this.writeByte(t?1:0)},t.prototype.writeByte=function(t){this.ensureWrite(this._position_+1),this._data_.setInt8(this._position_,t),this._position_+=1},t.prototype.writeBytes=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw"writeBytes error - Out of bounds";0==i&&(i=t.length-e),this.ensureWrite(this._position_+i),this._byteView_.set(t._byteView_.subarray(e,e+i),this._position_),this._position_+=i},t.prototype.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this.ensureWrite(this._position_+i);var n=new Uint8Array(t);this._byteView_.set(n.subarray(e,e+i),this._position_),this._position_+=i},t.prototype.writeDouble=function(t){this.ensureWrite(this._position_+8),this._data_.setFloat64(this._position_,t,this._littleEndian_),this._position_+=8},t.prototype.writeFloat=function(t){this.ensureWrite(this._position_+4),this._data_.setFloat32(this._position_,t,this._littleEndian_),this._position_+=4},t.prototype.writeInt=function(t){this.ensureWrite(this._position_+4),this._data_.setInt32(this._position_,t,this._littleEndian_),this._position_+=4},t.prototype.writeShort=function(t){this.ensureWrite(this._position_+2),this._data_.setInt16(this._position_,t,this._littleEndian_),this._position_+=2},t.prototype.writeUnsignedInt=function(t){this.ensureWrite(this._position_+4),this._data_.setUint32(this._position_,t,this._littleEndian_),this._position_+=4},t.prototype.writeUnsignedShort=function(t){this.ensureWrite(this._position_+2),this._data_.setUint16(this._position_,t,this._littleEndian_),this._position_+=2},t.prototype.writeUTF=function(t){t+="",this.writeUnsignedShort(this._getUTFBytesCount(t)),this.writeUTFBytes(t)},t.prototype.writeUnicode=function(t){t+="",this.ensureWrite(this._position_+2*t.length);for(var e=0,i=0,n=t.length;i<n;i++)e=t.charCodeAt(i),this._byteView_[this._position_++]=255&e,this._byteView_[this._position_++]=e>>8},t.prototype.writeMultiByte=function(t,e){if(t+="","UNICODE"==e||"unicode"==e)return this.writeUnicode(t);this.writeUTFBytes(t)},t.prototype.writeUTFBytes=function(t){t+="",this.ensureWrite(this._position_+4*t.length);for(var e=0,i=t.length;e<i;e++){var n=t.charCodeAt(e);n<=127?this.writeByte(n):n<=2047?(this.writeByte(192|n>>6),this.writeByte(128|63&n)):n<=65535?(this.writeByte(224|n>>12),this.writeByte(128|n>>6&63),this.writeByte(128|63&n)):(this.writeByte(240|n>>18),this.writeByte(128|n>>12&63),this.writeByte(128|n>>6&63),this.writeByte(128|63&n))}this.length=this._position_},t.prototype.__fromBytes=function(t){this._byteView_=new Uint8Array(t.getData()),this.length=this._byteView_.length,this._allocated_=this.length},t.prototype.__get=function(t){return this._data_.getUint8(t)},t.prototype._getUTFBytesCount=function(t){for(var e=0,i=0,n=(t+="").length;i<n;i++){var r=t.charCodeAt(i);e+=r<=127?1:r<=2047?2:r<=65535?3:4}return e},t.prototype._byteAt_=function(t){return this._byteView_[t]},t.prototype._byteSet_=function(t,e){this.ensureWrite(t+1),this._byteView_[t]=e},t.prototype.uncompress=function(t){void 0===t&&(t="zlib")},t.prototype.compress=function(t){void 0===t&&(t="zlib")},t.prototype.___resizeBuffer=function(t){try{var e=new Uint8Array(t);null!=this._byteView_&&(this._byteView_.length<=t?e.set(this._byteView_):e.set(this._byteView_.subarray(0,t))),this._byteView_=e,this._data_=new DataView(e.buffer)}catch(e){throw"___resizeBuffer err:"+t}},t.prototype.__getBuffer=function(){return this._data_.buffer},t.prototype.__set=function(t,e){this._data_.setUint8(t,e)},t.__ofBuffer=function(e){var i=new t;return i.length=i.allocated=e.byteLength,i.data=new DataView(e),i.byteView=new Uint8Array(e),i},t.prototype.setUint8Array=function(t){this._byteView_=t,this._data_=new DataView(t.buffer),this._length=t.byteLength,this._position_=0},t.prototype.getUint8Array=function(){return this._byteView_},Object.defineProperty(t.prototype,"bytesAvailable",{get:function(){return this.length-this._position_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endian",{get:function(){return this._littleEndian_?t.LITTLE_ENDIAN:t.BIG_ENDIAN},set:function(e){this._littleEndian_=e==t.LITTLE_ENDIAN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(t){this.___resizeBuffer(this._allocated_=t),this._length=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.pos},set:function(t){this.pos=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return this._position_},set:function(t){t<this._length?this._position_=t<0?0:t:(this._position_=t,this.length=t)},enumerable:!0,configurable:!0}),t.prototype.readObject=function(){return this._strTable=[],this._objTable=[],this._traitsTable=[],this.readObject2()},t.prototype.readObject2=function(){var t=this.readByte();return this.readObjectValue(t)},t.prototype.readObjectValue=function(e){var i;switch(e){case t.NULL_TYPE:break;case t.STRING_TYPE:i=this.__readString();break;case t.INTEGER_TYPE:i=this.readInterger();break;case t.FALSE_TYPE:i=!1;break;case t.TRUE_TYPE:i=!0;break;case t.OBJECT_TYPE:i=this.readScriptObject();break;case t.ARRAY_TYPE:i=this.readArray();break;case t.DOUBLE_TYPE:i=this.readDouble();break;case t.BYTEARRAY_TYPE:i=this.readByteArray();break;default:console.log("Unknown object type tag!!!"+e)}return i},t.prototype.readByteArray=function(){var e=this.readUInt29();if(0==(1&e))return this.getObjRef(e>>1);var i=e>>1,n=new t;return this._objTable.push(n),this.readBytes(n,0,i),n},t.prototype.readInterger=function(){var t=this.readUInt29();return t=t<<3>>3,parseInt(t+"")},t.prototype.getStrRef=function(t){return this._strTable[t]},t.prototype.getObjRef=function(t){return this._objTable[t]},t.prototype.__readString=function(){var e=this.readUInt29();if(0==(1&e))return this.getStrRef(e>>1);var i=e>>1;if(0==i)return t.EMPTY_STRING;var n=this.readUTFBytes(i);return this._strTable.push(n),n},t.prototype.readTraits=function(t){var e;if(1==(3&t))return(e=this.getTraitReference(t>>2)).propoties?e:{obj:{}};var i=4==(4&t),n=8==(8&t),r=t>>4,a=this.__readString();if((e={}).className=a,e.propoties=[],e.dynamic=n,e.externalizable=i,r>0)for(var s=0;s<r;s++){var o=this.__readString();e.propoties.push(o)}return this._traitsTable.push(e),e},t.prototype.readScriptObject=function(){var t=this.readUInt29();if(0==(1&t))return this.getObjRef(t>>1);var e,i,n=this.readTraits(t),r=n.className,a=(n.externalizable,n.propoties);if(r&&""!=r){var s=ClassUtils.getRegClass(r);e=s?new s:{}}else e={};if(this._objTable.push(e),a)for(var o=0;o<a.length;o++)e[a[o]]=this.readObject2();if(n.dynamic)for(;null!=(i=this.__readString())&&0!=i.length;)e[i]=this.readObject2();return e},t.prototype.readArray=function(){var t=this.readUInt29();if(0==(1&t))return this.getObjRef(t>>1);for(var e,i=null,n=t>>1;null!=(e=this.__readString())&&0!=e.length;)null==i&&(i={},this._objTable.push(i)),i[e]=this.readObject2();if(null==i){i=[],this._objTable.push(i);var r=0;for(r=0;r<n;r++)i.push(this.readObject2())}else for(r=0;r<n;r++)i[r.toString()]=this.readObject2();return i},t.prototype.readUInt29=function(){var t=0,e=255&this.readByte();return e<128?e:(t=(127&e)<<7,(e=255&this.readByte())<128?t|e:(t=(t|127&e)<<7,(e=255&this.readByte())<128?t|e:(t=(t|127&e)<<8)|(e=255&this.readByte())))},t.prototype.writeObject=function(t){this._strTable=[],this._objTable=[],this._traitsTable=[],this.writeObject2(t)},t.prototype.writeObject2=function(e){if(null!=e){var i=(0,_typeof2.default)(e);"string"===i?this.writeAMFString(e):"boolean"===i?this.writeAMFBoolean(e):"number"===i?-1!=String(e).indexOf(".")?this.writeAMFDouble(e):this.writeAMFInt(e):"object"===i&&(e instanceof Array?this.writeArray(e):e instanceof t?this.writeAMFByteArray(e):this.writeCustomObject(e))}else this.writeAMFNull()},t.prototype.writeAMFNull=function(){this.writeByte(t.NULL_TYPE)},t.prototype.writeAMFString=function(e){this.writeByte(t.STRING_TYPE),this.writeStringWithoutType(e)},t.prototype.writeStringWithoutType=function(t){if(0!=t.length){var e=this._strTable.indexOf(t);if(e>=0)this.writeUInt29(e<<1);else{var i=this._getUTFBytesCount(t);this.writeUInt29(i<<1|1),this.writeUTFBytes(t),this._strTable.push(t)}}else this.writeUInt29(1)},t.prototype.writeAMFInt=function(e){e>=t.INT28_MIN_VALUE&&e<=t.INT28_MAX_VALUE?(e&=t.UINT29_MASK,this.writeByte(t.INTEGER_TYPE),this.writeUInt29(e)):this.writeAMFDouble(e)},t.prototype.writeAMFDouble=function(e){this.writeByte(t.DOUBLE_TYPE),this.writeDouble(e)},t.prototype.writeAMFBoolean=function(e){e?this.writeByte(t.TRUE_TYPE):this.writeByte(t.FALSE_TYPE)},t.prototype.writeCustomObject=function(e){this.writeByte(t.OBJECT_TYPE);var i=this._objTable.indexOf(e);if(-1!=i)this.writeUInt29(i<<1);else{this._objTable.push(e);var n=new Object;for(var r in n.className=this.getAliasByObj(e),n.dynamic=!1,n.externalizable=!1,n.properties=[],e)e[r]instanceof Function||(n.properties.push(r),n.properties.sort());var a=t.getTraitsInfoRef(this._traitsTable,n),s=n.properties.length,o=0;if(a>=0)this.writeUInt29(a<<2|1);else for(this._traitsTable.push(n),this.writeUInt29(3|(n.externalizable?4:0)|(n.dynamic?8:0)|s<<4),this.writeStringWithoutType(n.className),o=0;o<s;o++)this.writeStringWithoutType(n.properties[o]);for(o=0;o<s;o++)this.writeObject2(e[n.properties[o]])}},t.getTraitsInfoRef=function(e,i){var n,r=e.length;for(n=0;n<r;n++)if(t.equalsTraitsInfo(i,e[n]))return n;return-1},t.equalsTraitsInfo=function(t,e){if(t==e)return!0;if(!t.className===e.className)return!1;if(t.properties.length!=e.properties.length)return!1;var i=t.properties.length;t.properties.sort(),e.properties.sort();for(var n=0;n<i;n++)if(t.properties[n]!=e.properties[n])return!1;return!0},t.prototype.getAliasByObj=function(t){return""},t.prototype.writeArray=function(e){this.writeByte(t.ARRAY_TYPE);var i=e.length;if(this._objTable.indexOf(e)>-1)this.writeUInt29(i<<1);else{this.writeUInt29(i<<1|1),this.writeStringWithoutType(t.EMPTY_STRING);for(var n=0;n<i;n++)this.writeObject2(e[n]);this._objTable.push(e)}},t.prototype.writeAMFByteArray=function(e){this.writeByte(t.BYTEARRAY_TYPE);var i=this._objTable.indexOf(e);if(i>=0)this.writeUInt29(i<<1);else{var n=e.length;this.writeUInt29(n<<1|1),this.writeBytes(e,0,n)}},t.prototype.writeMapAsECMAArray=function(e){var i;for(i in this.writeByte(t.ARRAY_TYPE),this.writeUInt29(1),e)this.writeStringWithoutType(i),this.writeObject2(e[i]);this.writeStringWithoutType(t.EMPTY_STRING)},t.prototype.writeUInt29=function(t){t<128?this.writeByte(t):t<16384?(this.writeByte(t>>7&127|128),this.writeByte(127&t)):t<2097152?(this.writeByte(t>>14&127|128),this.writeByte(t>>7&127|128),this.writeByte(127&t)):t<1073741824?(this.writeByte(t>>22&127|128),this.writeByte(t>>15&127|128),this.writeByte(t>>8&127|128),this.writeByte(255&t)):console.log("Integer out of range: "+t)},t.prototype.getTraitReference=function(t){return this._traitsTable[t]},t.BIG_ENDIAN="bigEndian",t.LITTLE_ENDIAN="littleEndian",t.UNDEFINED_TYPE=0,t.NULL_TYPE=1,t.FALSE_TYPE=2,t.TRUE_TYPE=3,t.INTEGER_TYPE=4,t.DOUBLE_TYPE=5,t.STRING_TYPE=6,t.XML_TYPE=7,t.DATE_TYPE=8,t.ARRAY_TYPE=9,t.OBJECT_TYPE=10,t.AVMPLUSXML_TYPE=11,t.BYTEARRAY_TYPE=12,t.EMPTY_STRING="",t.UINT29_MASK=536870911,t.INT28_MAX_VALUE=268435455,t.INT28_MIN_VALUE=-268435456,t}(),Binary64=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.low=0,this.internalHigh=0,this.low=t,this.internalHigh=e}return t.prototype.div=function(t){var e;e=this.internalHigh%t;var i=(this.low%t+6*e)%t;this.internalHigh=this.internalHigh/t;var n=(4294967296*e+this.low)/t;return this.internalHigh=this.internalHigh+n/4294967296|0,this.low=n,i},t.prototype.mul=function(t){var e=this.low|0*t;this.internalHigh=this.internalHigh*t,this.internalHigh=this.internalHigh+(e/4294967296|0),this.low=this.low*t},t.prototype.add=function(t){var e=this.low|0+t;this.internalHigh=this.internalHigh+e/4294967296|0,this.low=e},t.prototype.bitwiseNot=function(){this.low=~this.low,this.internalHigh=~this.internalHigh},t}(),SocketConnection=function(){function t(){}return Object.defineProperty(t,"mainSocket",{get:function(){return Laya.Browser.onWeiXin?(null==t._wxSocket&&(t._wxSocket=new WxSocket),t._wxSocket):(null==t._mainSocket&&(t._mainSocket=new GameSocket),t._mainSocket)},enumerable:!0,configurable:!0}),t.addCmdListener=function(t,e,i){GameSocketDispatcher.addListener(t,e,i)},t.removeCmdListener=function(t,e){GameSocketDispatcher.removeListener(t,e)},t.dispatchCmd=function(t,e){GameSocketDispatcher.excute(t,e)},t.hasCmdListener=function(t){return GameSocketDispatcher.hasListener(t)},t.willTriggerCmd=function(t,e){return GameSocketDispatcher.willTrigger(t,e)},t.addGapSendMsg=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n]},t.send=function(e,i){void 0===i&&(i=null);var n=t.mainSocket;n.connected&&(i=i||new ByteArray,n.sendMk(e,i))},t.messsageUnCompress=function(t,e){return null},t}(),EventManager=function(){function t(){throw new Event("静态类")}return t.dispatchEvent=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r=t._evtMap[e];if(r){var a=r.concat(),s=0;for(s=0;s<a.length;s++){var o=a[s],l=o.fun,h=o.args||[],c=o.caller;if(null!=l){var u=[];h&&h.length&&(u=u.concat(h)),i&&i.length&&(u=u.concat(i)),u&&u.length?l.apply(c,u):l.apply(c)}}}},t.addEvent=function(e,i,n){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];if(t.hasEvent(e,i,n))console.error("重复注册相同事件:"+e+",返回!",i,n);else{var s=t._evtMap[e];s||(s=new Array,t._evtMap[e]=s),s[s.length]={fun:n,args:r,caller:i}}},t.removeEvent=function(e,i){var n=t._evtMap[e];if(n){for(var r=n.length-1;r>=0;r--)i==n[r].fun&&n.splice(r,1);0==n.length&&delete t._evtMap[e]}},t.hasTypeEvent=function(e){return t._evtMap.hasOwnProperty(e)},t.hasEvent=function(e,i,n){var r=t._evtMap[e];if(r)for(var a=r.length-1;a>=0;a--){var s=r[a];if(n==s.fun&&s.caller==i)return!0}return!1},t.removeAllEvents=function(){t._evtMap={}},t.getTypeEventList=function(e){var i=new Array,n=t._evtMap[e];if(n)for(var r=n.length-1;r>=0;r--){var a=n[r].fun;i.push(a)}return i},t.getTypeEventsNum=function(e){var i=t._evtMap[e];return i?i.length:0},t.isPrint=!1,t._evtMap={},t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ByteBuffer=function(t){function e(e){void 0===e&&(e="");var i=t.call(this)||this;return""==e||e==ByteArray.BIG_ENDIAN?i.endian=ByteArray.BIG_ENDIAN:i.endian=ByteArray.LITTLE_ENDIAN,i}return __extends(e,t),Object.defineProperty(e,"POW_2_32",{get:function(){return e._POW_2_32},enumerable:!0,configurable:!0}),e.prototype.readBytes=function(e,i,n){void 0===i&&(i=0),void 0===n&&(n=Number.MAX_VALUE),0!=n?n==Number.MAX_VALUE?t.prototype.readBytes.call(this,e,i,0):t.prototype.readBytes.call(this,e,i,n):console.log("\t警告！ByteBuffer.readBytes ：：：：  legth为0时，将不做任何处理，而不是读取所有可用数据。如果要读取所有可用数据,length应该为uint.MAX_VALUE")},e.prototype.readLong=function(){var t=0,i=0;return this.endian==ByteArray.BIG_ENDIAN?(t=this.readInt(),i=this.readUnsignedInt()):(i=this.readUnsignedInt(),t=this.readInt()),t*e.POW_2_32+i},e.prototype.writeLong=function(t){var i=t/e.POW_2_32,n=t%e.POW_2_32;this.endian==ByteArray.BIG_ENDIAN?(this.writeInt(i),this.writeUnsignedInt(n)):(this.writeUnsignedInt(n),this.writeInt(i))},e.prototype.writeVarint32=function(t){for(;;){if(0==(-128&t))return void this.writeByte(t);this.writeByte(127&t|128),t>>>=7}},e.prototype.readVarint32=function(){return 0|this.readUint32()},e.prototype.readUint32=function(){for(var t=0,e=0;;e+=7){var i=this.readUnsignedByte();if(!(e<32)){for(;this.readUnsignedByte()>=128;);break}if(!(i>=128)){t|=i<<e;break}t|=(127&i)<<e}return t},e.prototype.writeUint32=function(t){for(;;){if(t<128)return void this.writeByte(t);this.writeByte(127&t|128),t>>>=7}},e.prototype.readString=function(){var t=this.readVarint32();return this.readUTFBytes(t)},e.prototype.writeString=function(t){if(null==t)this.writeInt(0);else{var e=new ByteArray;e.writeUTFBytes(t),this.writeVarint32(e.length),this.writeBytes(e)}},e.prototype.printString=function(t){void 0===t&&(t=10);var e="",i=new ByteArray;if(i.writeBytes(this),i.pos=0,10==t)for(;i.bytesAvailable>0;)e+=i.readUnsignedByte().toString()+" ";else{if(16!=t)throw new Error("radix 只能为 10 或 16");for(var n;i.bytesAvailable>0;)1==(n=i.readUnsignedByte().toString(16)).length&&(n="0"+n),e+=n+" "}return e},e.prototype.readInt64Number=function(){return this.readInt64().toNumber()},e.prototype.readInt64=function(){var t=this.readInt(),e=this.readInt();return new Int64(t,e)},e.prototype.writeInt64=function(t){var e=Int64.fromNumber(t);this.writeInt(e.low),this.writeInt(e.high)},e.prototype.writeVarint64=function(t){var e=Int64.fromNumber(t),i=new WritingBuffer;i.endian=ByteArray.BIG_ENDIAN,WriteUtils.write$TYPE_INT64(i,e),this.writeBytes(i)},e.prototype.readVarint64=function(){return this.read$TYPE_INT64(this).toNumber()},e.prototype.leftMove=function(t,i,n){var r=t|i<<n;return r<0&&(r+=e._POW_2_32),r},e.prototype.read$TYPE_INT64=function(t){for(var e=0,i=new Int64,n=0;e=t.readUnsignedByte(),28!=n;){if(!(e>=128))return i.low=this.leftMove(i.low,e,n),i;i.low=this.leftMove(i.low,127&e,n),n+=7}if(!(e>=128))return i.low=this.leftMove(i.low,e,n),i.high=e>>>4,i;for(e&=127,i.low=this.leftMove(i.low,e,n),i.high=e>>>4,n=3;;){if(e=t.readUnsignedByte(),n<32){if(!(e>=128)){i.high=i.high|e_3C_3Cn;break}i.high=i.high|(127&e)<<n}n+=7}return i},e.SIZE_OF_INT64=8,e.SIZE_OF_UINT64=8,e._POW_2_32=Math.pow(2,32),e}(ByteArray),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Dictionary=laya.utils.Dictionary,GameSocket=function(t){function e(){var i=t.call(this)||this;return i._connecting=!1,i._connected=!1,i._easyProtocolOffset=0,i.onConnectError=function(t){i._connecting=!1,i.dispatchEvent(e.SOCKET_ERROR),console.error("连接失败， 请检查服务器状态")},i.socketConnectTimeout=function(){i._socket.readyState==WebSocket.CONNECTING&&(i._connecting=!1,i.dispatchEvent(e.SOCKET_TIME_OUT))},i._sendBytes=new ByteBuffer,i}return __extends(e,t),e.prototype.connect=function(t,e){var i;this._connecting?console.warn("socket is connecting..."):(this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket.close()),i=e?"wss://"+t+":"+e+"/ws":t,this._socket=new WebSocket(i),this._socket.par=this,window.par=this,this._socket.binaryType="arraybuffer",console.log("连接WEBSOCKET：：：：",i),this._easyProtocolOffset=0,this._socketConnectTimeoutId=setTimeout(this.socketConnectTimeout,5e3),this.addEvent(),this._connecting=!0)},e.prototype.sendMk=function(t,e){var i=t.msgId,n=new ByteBuffer;this._easyProtocolOffset++;var r=this.getOffsetByte(this._easyProtocolOffset);n.writeByte(r),n.writeVarint32(i),n.writeBytes(e);var a=this.getBytesCode(n);this._sendBytes.position=0,this._sendBytes.writeByte(a),this._sendBytes.writeBytes(n),this._sendBytes.position=0,this._socket.send(this._sendBytes.__getBuffer()),this._sendBytes.clear(),this.socketTrace(">> C==>S MSG_CODE:"+i+" length:"+e.length)},e.prototype.onDataMK=function(t){if(t instanceof ArrayBuffer){var e=new ByteBuffer;e.endian=ByteArray.BIG_ENDIAN,e.writeArrayBuffer(t),e.pos=2;var i=e.readVarint32(),n=CmdMap.getCmdType(i);n?(this.socketTrace("<< S==>C MSG_CODE:"+n.getCmdStr()+" length:"+e.length),GameSocketDispatcher.excute(n,e)):console.warn("未知消息 消息号："+i+" length:"+e.length)}},e.prototype.addEvent=function(){this._socket.onopen=this.onSocketOpen,this._socket.onmessage=this.onMessageReveived,this._socket.onclose=this.onSocketClose,this._socket.onerror=this.onConnectError},e.prototype.onSocketOpen=function(t){this.par.socketOpen()},e.prototype.socketOpen=function(){this.socketTrace("链接成功"),this._connecting=!1,this._connected=!0,this.dispatchEvent(e.SOCKET_OPEN)},e.prototype.onSocketClose=function(t){var i=this.par;i._connecting=!1,i._connected=!1,i.dispatchEvent(e.SOCKET_CLOSE),console.error("WebSocket closed")},e.prototype.socketClose=function(){},e.prototype.onMessageReveived=function(t){this.par.onDataMK(t.data)},e.prototype.socketError=function(){},e.prototype.socketTrace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Configs.isPrint&&console.log("[socket] "+t.join(","))},Object.defineProperty(e.prototype,"connected",{get:function(){return this._connected},enumerable:!0,configurable:!0}),e.prototype.getOffsetByte=function(t){var e=t;return e^=e>>8,255&(e^=e>>4)},e.prototype.getBytesCode=function(t){t.position=0;for(var e=0,i=t.length-1;i>=0;)e+=t.readByte(),i--;return 255&e},e.prototype.getTimer=function(){return(new Date).getTime()},e.SOCKET_OPEN="SOCKET_OPEN",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_ERROR="SOCKET_ERROR",e.SOCKET_TIME_OUT="SOCKET_TIME_OUT",e._lockMsgMap=new Dictionary,e._unLockMsgMap=new Dictionary,e._sendMsgTmMap=new Dictionary,e}(EventDispatcher),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Int64=function(t){function e(e,i){return void 0===e&&(e=0),void 0===i&&(i=0),t.call(this,e,i)||this}return __extends(e,t),e.fromNumber=function(t){return new e(t%4294967296,Math.floor(t/4294967296))},e.parsenumber64=function(t,i){void 0===i&&(i=0);var n=0,r=0==t.search(/^\-/),a=r?1:0;0==i&&(0==t.search(/^\-?0x/)?(i=16,a+=2):i=10),t=t.toLowerCase();for(var s=new e;a<t.length;)(n=t.charCodeAt(a))>="0".charCodeAt(0)&&n<="9".charCodeAt(0)?n-="0".charCodeAt(0):n>="a".charCodeAt(0)&&n<="z".charCodeAt(0)&&(n-="a".charCodeAt(0)),s.mul(i),s.add(n),a++;return r&&(s.bitwiseNot(),s.add(1)),s},Object.defineProperty(e.prototype,"high",{get:function(){return this.internalHigh},set:function(t){this.internalHigh=t},enumerable:!0,configurable:!0}),e.prototype.toNumber=function(){return 4294967296*this.high+this.low},e.prototype.toString=function(t){void 0===t&&(t=10);var i=0;switch(this.high){case 0:return this.low.toString(t);case-1:return Number(this.low).toString(t)}if(0==this.low&&0==this.high)return"0";var n=[],r=new e(this.low,this.high);this.high<0&&(r.bitwiseNot(),r.add(1));do{i=r.div(t),n.push((i<10?"0":"a").charCodeAt(0)+i)}while(0!=r.high);return this.high<0?"-"+r.low.toString(t)+String.fromCharCode.apply(String,n.reverse()):r.low.toString(t)+String.fromCharCode.apply(String,n.reverse())},e}(Binary64),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),UInt64=function(t){function e(e,i){return void 0===e&&(e=0),void 0===i&&(i=0),t.call(this,e,i)||this}return __extends(e,t),e.fromNumber=function(t){return new e(t,Math.floor(t/4294967296))},e.parseUInt64=function(t,i){void 0===i&&(i=0);var n=0,r=0;0==i&&(0==t.search(/^0x/)?(i=16,r=2):i=10),t=t.toLowerCase();for(var a=new e;r<t.length;)(n=t.charCodeAt(r))>="0".charCodeAt(0)&&n<="9".charCodeAt(0)?n-="0".charCodeAt(0):n>="a".charCodeAt(0)&&n<="z".charCodeAt(0)&&(n-="a".charCodeAt(0)),a.mul(i),a.add(n),r++;return a},Object.defineProperty(e.prototype,"high",{get:function(){return this.internalHigh},set:function(t){this.internalHigh=t},enumerable:!0,configurable:!0}),e.prototype.toNumber=function(){return 4294967296*this.high+this.low},e.prototype.toString=function(t){void 0===t&&(t=10);var i=0;if(0==this.high)return this.low.toString(t);var n=[],r=new e(this.low,this.high);do{i=r.div(t),n.push((i<10?"0":"a").charCodeAt(0)+i)}while(0!=r.high);return r.low.toString(t)+String.fromCharCode.apply(String,n.reverse())},e}(Binary64),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),WritingBuffer=function(t){function e(){var e=t.call(this)||this;return e.slices=new Array,e.endian=ByteArray.BIG_ENDIAN,e}return __extends(e,t),e.prototype.beginBlock=function(){this.slices.push(this.position);var t=this.slices.length;return this.slices.length=this.slices.length+2,this.slices.push(this.position),t},e.prototype.endBlock=function(t){this.slices.push(this.position);var e=this.slices[t+2];this.slices[t]=this.position,WriteUtils.write$TYPE_UINT32(this,this.position-e),this.slices[t+1]=this.position,this.slices.push(this.position)},e.prototype.toNormal=function(t){for(var e=0,i=0,n=0;i<this.slices.length;)e=this.slices[i],i++,e>n&&t.writeBytes(this,n,e-n),n=this.slices[i],i++;t.writeBytes(this,n)},e}(ByteArray),WxShareInfoParse=function(){function t(){}return t.parse=function(t,e,i){this.success=e,this.fail=i,EventManager.dispatchEvent(LibEvent.LOG,"parse.ticket")},t.onGetInfoSuccess=function(t){},t.onGetInfoFail=function(){},t.onDecryptSuccess=function(t){},t}(),LibEvent=function(){function t(){}return t.ON_GET_WX_CODE="on_get_wx_code",t.ON_SHOW="on_Show",t.ON_HIDE="ON_hide",t.LOG="LOG",t}(),WxModalInfo=function(){this.title="提示",this.showCancel=!0,this.cancelText="取消"},ShareImageUtil=function(){function t(){}return t.onLoadError=function(){t.onFail.call(),t._drawSp.scale(t._drawSp.scaleX/t.scaleRadio,t._drawSp.scaleY/t.scaleRadio)},t.share=function(e,i,n,r,a,s,o){var l=Laya.Browser.now();l-this.clickShareTime<2e3||(this.clickShareTime=l,t.canvasWidth=r||e.width,t.canvasHeight=a||e.height,t.offsetX=s||0,t.offsetY=o||0,Configs.isWx?(t._drawSp=e,t.onSuccess=i,t.onFail=n,null==t.canvas?(t.canvas=wx.createCanvas(),t._ctx=t.canvas.getContext("2d")):t.canvas.height=t.canvas.height,t.toDraw()):i.call())},t.clickShareTime=0,t.toDraw=function(){t.scaleRadio=Laya.Browser.clientWidth/t.canvasWidth,t._drawSp.scale(t.scaleRadio,t.scaleRadio);var e=e=t._drawSp.drawToCanvas(t.canvasWidth,t.canvasHeight,t.offsetX*t.scaleRadio,t.offsetY*t.scaleRadio);e.toBase64("image/png",.92,t.onToBaes64)},t.onLoadComplete=function(){t._ctx.drawImage(t._htmlImage,0,0),t.canvas.toTempFilePath({width:Laya.Browser.clientWidth,height:t.canvasHeight*t.scaleRadio,destWidth:Laya.Browser.clientWidth,destHeight:t.canvasHeight*t.scaleRadio,success:function(e){t.onSuccess.call(e)}}),t._drawSp.scale(t._drawSp.scaleX/t.scaleRadio,t._drawSp.scaleY/t.scaleRadio)},t.onToBaes64=function(e){(t._htmlImage=new laya.utils.Browser.window.Image).onerror=t.onLoadError,t._htmlImage.onload=t.onLoadComplete,t._htmlImage.src=e},t}(),GameRunningTimeManager=function(){function t(){}return Object.defineProperty(t,"runningTime",{get:function(){return t._runningTime},enumerable:!0,configurable:!0}),t.setup=function(){if(!t._isAlreadySetup){t._isAlreadySetup=!0,EventManager.addEvent(LibEvent.ON_SHOW,this,this.onShow),EventManager.addEvent(LibEvent.ON_HIDE,this,this.onHide);var e=Number(PlatfromKit.getValueFromLocal(t.RUNNING_TIME));this._runningTime=e,setInterval(this.onOneSceond,1e3)}},t.onShow=function(e){t._isShowing=!0},t.onHide=function(){PlatfromKit.setValueLocal(t.RUNNING_TIME,t.runningTime.toString()),t._isShowing=!1},t.onOneSceond=function(){t._isShowing&&++t._runningTime%10==0&&PlatfromKit.setValueLocal(t.RUNNING_TIME,t.runningTime.toString())},t.save=function(){PlatfromKit.setValueLocal(t.RUNNING_TIME,t.runningTime.toString())},t.reset=function(){t._runningTime=0,PlatfromKit.setValueLocal(t.RUNNING_TIME,t.runningTime.toString())},t.RUNNING_TIME="runningTime",t._runningTime=0,t._isShowing=!0,t._isAlreadySetup=!1,t}(),WxLaunchOption=function(){function t(){}return t.prototype.getAppId=function(){return this.referrerInfo&&this.referrerInfo.appId?this.referrerInfo.appId:null},t}(),CallBackFunc=function(){function t(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];this.thisArgs=t,this.func=e,this.args=i}return t.prototype.call=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.func){var i=new Array;if(t)for(n=0;n<t.length;++n)i.push(t[n]);if(this.args)for(var n=0;n<this.args.length;++n)i.push(this.args[n]);this.func.apply(this.thisArgs,i)}},t.prototype.compare=function(t){return this.thisArgs==t.thisArgs&&this.func==t.func},t}(),SystemInfo=function(){this.brand="",this.model="",this.pixelRatio=1,this.screenWidth=0,this.screenHeight=0,this.windowWidth=0,this.windowHeight=0,this.language="",this.version="",this.system="",this.platform="",this.fontSizeSetting=0,this.SDKVersion="2.0.9",this.benchmarkLevel=0,this.battery=0,this.wifiSignal=0},Configs=function(){function t(){}return t.isWx=!1,t.isPrint=!1,t}(),DisplayUtil=function(){function t(){}return t.removeForParent=function(t,e){void 0===e&&(e=!1),null!=t&&null!=t.parent&&t.parent.contains(t)&&t.parent.removeChild(t)},t.hasParent=function(t){return null!=t.parent&&t.parent.contains(t)},t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),DisplayObjectContainer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(Laya.Sprite),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Sprite=function(t){function e(){var e=t.call(this)||this;return e.autoSize=!0,e}return __extends(e,t),e.prototype.setRes=function(t){var e=Laya.loader.getRes(t);null!=e?this.texture=e:console.log("未知资源！！！"+t)},e.prototype.drawLineRect=function(t,e,i,n,r,a){void 0===a&&(a=4),this.graphics.drawLine(t,e,t+i,e,r,a),this.graphics.drawLine(t,e+n,t+i,e+n,r,a),this.graphics.drawLine(t,e,t,e+n,r,a),this.graphics.drawLine(t+i,e,t+i,e+n,r,a)},e.prototype.setPosition=function(t){this.x=t.x,this.y=t.y},e.prototype.setScale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.getPosition=function(){return new Laya.Point(this.x,this.y)},e.prototype.getLocation=function(){return new Laya.Point(this.mouseX,this.mouseY)},e.prototype.setVisible=function(t){this.visible=t},e.prototype.clear=function(){},e.prototype.centerToParcent=function(){this.parent&&(this.x=(this.parent.width-this.width)/2,this.y=(this.parent.height-this.height)/2)},e.prototype.addEventListener=function(t,e,i,n){return this.on(t,e,i,n)},e.prototype.removeEventListener=function(t,e,i,n){return this.off(t,e,i,n)},e.prototype.dispatchEvent=function(t,e){return this.event(t,e)},e.prototype.dispatchEventWith=function(t,e){return this.event(t,e)},e.prototype.hasEventListener=function(t){return this.hasListener(t)},e}(DisplayObjectContainer),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),BaseDisplayApp=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._parentSP=LayerManager.uiLevel,e._isAlreadySetMain=!1,e._config=new AppConfig,e}return __extends(e,t),e.prototype.setSkin=function(t){this._isAlreadySetMain||(this._Skin=t,this.addChild(t),this._isAlreadySetMain=!0)},e.prototype.show=function(t,e,i){if(void 0===t&&(t=null),void 0===e&&(e=""),void 0===i&&(i=null),this.data=t,this.openTable=e,this._parentSP=i||this._parentSP,null==this._parentSP&&(this._parentSP=LayerManager.uiLevel),this._config.isOnlyOperate&&(this._parentSP=LayerManager.topLevel),null==this.parent){if(this.clearScaleTween(),this.alpha=1,this._parentSP.addChild(this),this._appinfo&&this._appinfo.posType!=PanelPosType.MIDDLE_CENTRAL)this.onStageResize(Configs.sizeRect.width,Configs.sizeRect.height);else if(this._config.isAutoLayoutToStageCenter){var n=this.getAlignToStageCenterPoint();this.x=n.x,this.y=n.y}this.checkShow()}},e.prototype.getAlignToStageCenterPoint=function(){return new Laya.Point(Configs.sizeRect.width-this.width>>1,Configs.sizeRect.height-this.height>>1)},e.prototype.onStageResize=function(t,e){var i,n;if(this._addAlphaBgSp&&this.reSizeAddAlphaBG(),this._appinfo){switch(this._appinfo.posType){case PanelPosType.MIDDLE_CENTRAL:case PanelPosType.CENTER_MIDDLE:i=(t-this.width)/2,n=(e-this.height)/2;break;case PanelPosType.MIDDLE_LEFT:i=0,n=(e-this.height)/2;break;case PanelPosType.MIDDLE_RIGHT:i=t-this.width,n=(e-this.height)/2;break;case PanelPosType.TOP_CENTRAL:i=(t-this.width)/2,n=0;break;case PanelPosType.TOP_LEFT:i=0,n=0;break;case PanelPosType.TOP_RIGHT:i=t-this.width,n=0;break;case PanelPosType.BOTTOM_CENTRAL:i=(t-this.width)/2,n=e-this.height;break;case PanelPosType.BOTTOM_LEFT:i=0,n=e-this.height;break;case PanelPosType.BOTTOM_RIGHT:i=t-this.width,n=e-this.height}this.x=i,this.y=n}else i=(t-this.width)/2,n=(e-this.height)/2,this.x=i,this.y=n;this.clearScaleTween(),this.scaleX=this.scaleY=1},e.prototype.reSizeAddAlphaBG=function(){this._addAlphaBgSp},e.prototype.onHide=function(){this.clearScaleTween(),DisplayUtil.removeForParent(this._addAlphaBgSp),DisplayUtil.removeForParent(this),this.nextFrameDispathHide()},e.prototype.nextFrameDispathHide=function(){this.onEnterFrameDispathHide()},e.prototype.onEnterFrameDispathHide=function(){EventManager.dispatchEvent(AppEvent.APP_HIDE_COMPLETE,this._appinfo)},e.prototype.onHideComplete=function(){DisplayUtil.removeForParent(this),this.scaleX=this.scaleY=1,this.nextFrameDispathHide()},e.prototype.clearScaleTween=function(){},e.prototype.checkShow=function(){EventManager.dispatchEvent(AppEvent.APP_SHOW,this._appinfo)},e.prototype.superAddEvent=function(){},e.prototype.superRemoveEvent=function(){},e.prototype.close=function(){this.dispatchEvent(Laya.Event.CLOSE),this.isGuidePanelClose&&(this.isGuidePanelClose=!1)},Object.defineProperty(e.prototype,"parentContainer",{get:function(){return this.parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appinfo",{get:function(){return this._appinfo},set:function(t){this._appinfo=t},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},e.prototype.showCloseGuide=function(t,e){},e}(Sprite),AppInfo=function(t,e,i){this.posType=0},PanelPosType=function(){function t(){}return t.MIDDLE_CENTRAL=0,t.TOP_LEFT=1,t.TOP_CENTRAL=2,t.TOP_RIGHT=3,t.MIDDLE_RIGHT=4,t.BOTTOM_RIGHT=5,t.BOTTOM_CENTRAL=6,t.BOTTOM_LEFT=7,t.MIDDLE_LEFT=8,t.CENTER_MIDDLE=9,t}(),AppManager=function(){function t(){}return t.showApp=function(t,e){void 0===e&&(e=null)},t.viewDic={},t}(),AppEvent=function(){function t(){}return t.APP_SHOW="app_show",t.APP_INIT="app_init",t.APP_HIDE="app_hide",t.APP_HIDE_COMPLETE="app_hide_complete",t.APP_DESTORY="app_destory",t.APP_RES_LOADING_COMPLETE="APP_RES_LOADING_COMPLETE",t.APP_RES_LOADING_ERROR="APP_RES_LOADING_ERROR",t}(),AppConfig=function(){this.isAutoLayoutToStageCenter=!0,this.isShowEffect=!0,this.isOnlyOperate=!1,this.bgAlpha=0},NumberUtil=function(){function t(){}return t.randRange=function(t,e){var i=Math.floor(Math.random()*(e-t+1))+t;return Math.floor(i)},t}(),ServerEvent=function(){function t(){}return t.LOGIN_SUCCESS="login_success",t.LOGIN_FAIL="LOGIN_fail",t.ON_GET_SOCKET_URL="on_get_socket_url",t.SKEY_EXPIRE="SKEY_EXPIRE",t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),MiniHttpRequest=function(t){function e(){var e=t.call(this)||this;return e.onSuccess=function(t){Configs.isPrint&&traceLog("onHttpBack:",t);var i=t;console.log("请求耗时:",(new Date).getTime()-e._startTime,"-----》",e._url),e.event(Laya.Event.COMPLETE,i)},e.onFail=function(t){traceError("onHttpFail",JSON.stringify(t)),e.event(Laya.Event.ERROR,t)},e}return __extends(e,t),e.prototype.request=function(t,e,i,n){if(this._startTime=(new Date).getTime(),this._url=t,Configs.isPrint&&console.log(t),Configs.isWx){var r={url:t,method:e,success:this.onSuccess,fail:this.onFail};i&&(r.data=i),n&&(r.header=n),traceLog("发送给服务器的数据包",r),wx.request(r)}else{var a="";if(i instanceof Object)for(var s in i)a+=s+"="+i[s]+"&";a.length>0&&(i=a=a.substr(0,a.length-1));var o=new Laya.HttpRequest;if(o.on(Laya.Event.COMPLETE,this,this.onSuccess),o.on(Laya.Event.ERROR,this,this.onFail),n){var l=new Array;for(var s in n)l.push(s),l.push(n[s]);o.send(t,i,e,"json",l)}else o.send(t,i,e,"json")}},e}(EventDispatcher),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ani=function(t){function e(){var e=t.call(this)||this;return e._aniName="",e._maxFrame=0,e._currFrame=0,e._repeatNum=0,e._currentRepeat=0,e.autoSize=!0,e}return __extends(e,t),e.prototype.play=function(t,e,i,n){this._aniName=t,this._maxFrame=i,this._currentRepeat=0,this._repeatNum=n,Laya.timer.frameLoop(e,this,this.update)},e.prototype.stop=function(){Laya.timer.clear(this,this.update)},e.prototype.clear=function(){this.texture=null,this.graphics.clear()},e.prototype.update=function(){if(this._currFrame++,this._currFrame>this._maxFrame&&(this._currentRepeat++,this._currFrame=0,0!=this._repeatNum&&this._currentRepeat>=this._repeatNum))return Laya.timer.clear(this,this.update),this.texture=null,this.graphics.clear(),void this.event(Laya.Event.COMPLETE);var t=this._aniName+"/"+this._currFrame+".png";this.texture=Laya.Loader.getRes(t),null==this.texture&&traceError("未知资源："+t)},e}(Sprite),SetupInfo=function(){},SubDomainMessageManager=function(){function t(){}return t.setup=function(t){if(PlatfromKit.isNewFor("1.9.92"))try{this._openDataContext=wx.getOpenDataContext(),this._sharedCanvas=this._openDataContext.canvas,this._sharedCanvas.width=Configs.sizeRect.width,this._sharedCanvas.height=Configs.sizeRect.height,this.layaSharedCanvas=this._sharedCanvas,this.postSystemInfo(t)}catch(t){console.log("当前微信版本不支持开放数据域")}else console.log("当前微信版本不支持开放数据域")},t.postSystemInfo=function(e){t._openDataContext&&t.methodCall("setSystemInfo",e)},t.methodCall=function(e,i){void 0===i&&(i=null),t._openDataContext&&this._openDataContext.postMessage({operate:"methodCall",methodName:e,args:i})},t}(),EnumServerOperateType=function(){function t(){}return t.LOGIN="",t.SAVE_SINGLE="/app/data/save/",t.GET_SINGLE="/app/data/get/",t.DECRYPT="/weapp/decrypt",t.TUNNEL="/weapp/tunnel",t}(),PlatfromKit=function(){function t(){}return t.setup=function(e){this._gameName=e,Configs.isWx&&(wx.onShow(t.onShow),wx.onHide(t.onHide))},t.onShow=function(t){EventManager.dispatchEvent(LibEvent.ON_SHOW),WxUpdateManager.checkUpdate()},t.onHide=function(){EventManager.dispatchEvent(LibEvent.ON_HIDE)},t.getValueFromLocal=function(t){var e=null;if(Configs.isWx){var i=wx.getStorageSync(t);i&&(e=i.toString())}else e=laya.net.LocalStorage.getItem(this._gameName+"_"+t);return e},t.setValueLocal=function(t,e){if(Configs.isWx)try{wx.setStorageSync(t,e)}catch(i){console.error("缓存出错！",t,e),wx.setStorage({key:t,data:e})}else laya.net.LocalStorage.setItem(this._gameName+"_"+t,e)},t.shareToHelp=function(t,e,i,n,r){if(Configs.isWx){var a={title:t,success:n,fail:r};null!=e&&""!=e&&(a.imageUrl=e),a.query=i,wx.shareAppMessage(a)}else n.call(null)},t.setRankValue=function(t,e){Configs.isWx},t.preViewImg=function(t,e,i,n,r){Configs.isWx&&wx.previewImage({current:t,urls:e,success:i,fail:n,complete:r})},t.showLoading=function(e,i,n,r,a){var s={};if(s.title=e,s.mask=i,s.success=n,s.fail=r,s.complete=a,Configs.isWx&&t.isNewFor("1.1.0"))try{wx.showLoading(s)}catch(t){console.log("error-> wx.showLoading")}},t.hideLoading=function(e,i,n){var r={};if(r.success=e,r.fail=i,r.complete=n,Configs.isWx&&t.isNewFor("1.1.0"))try{wx.hideLoading(r)}catch(t){console.log("error-> wx.hideLoading")}},t.createGameClubButton=function(t,e,i,n,r){if(Configs.isWx&&this.isNewFor("2.0.3"))try{var a={};a.ico=t;var s={};return a.style=s,s.top=i,s.left=e,s.width=n,s.height=r,wx.createGameClubButton(a)}catch(t){console.log("error-> wx.createGameClubButton")}},t.createBannerAd=function(t,e,i,n,r){if(void 0===r&&(r=null),Configs.isWx)if(this.isNewFor("2.0.4"))try{var a={adUnitId:t,style:{left:e,top:i,width:n}};null!=r&&(a.style.height=r);var s=wx.createBannerAd(a);return s.show(),s}catch(t){console.log("error-> wx.createBannerAd")}else console.log("广告创建失败，sdk："+Configs.wxSystemInfo.SDKVersion)},t.setOnShareAppMessageFunc=function(t){Configs.isWx&&wx.onShareAppMessage(t)},t.createRewardedVideoAd=function(t,e,i,n){for(var r=[],a=4;a<arguments.length;a++)r[a-4]=arguments[a];this.errNum=0,this.onVideoShow_cb=e,this.onVideoClose_cb=i,this.onVideoError_cb=n,PlatformAPI.createVideoAd("reward",t=>{this.onVideoClose(t)})},t.showToast=function(t){try{wx.showToast({title:t})}catch(t){}},t.isNewFor=function(t){var e=Configs.wxSystemInfo.SDKVersion.split("."),i=t.split("."),n=Number(e[0]),r=Number(i[0]);if(n>r)return!0;if(n==r){if((n=Number(e[1]))>(r=Number(i[1])))return!0;if(n==r&&(n=Number(e[2]))>=(r=Number(i[2])))return!0}return!1},t.isOldRewardVideo=function(){return!this.isNewFor("2.1.0")},t.getLaunchOptionsSync=function(){if(Configs.isWx){var t=wx.getLaunchOptionsSync(),e=new WxLaunchOption;return e.scene=t.scene,e.isSticky=t.isSticky,e.scene=t.scene,e.shareTicket=t.shareTicket,e.query=t.query,e.ori=t,e.referrerInfo=new ReferrerInfo(t.referrerInfo),e}},t.showModal=function(t){if(Configs.isWx)wx.showModal(t);else{var e=confirm(t.content);t.success({confirm:e})}},t.wxLogin=function(t,e){Configs.isWx&&(console.log("开始微信登录！"),wx.login({success:function(e){console.log("微信登录成功，",e),t.call(e)},fail:function(t){console.error("微信登录失败~！",t),e.call()}}))},t.getShareInfo=function(t,e,i){Configs.isWx&&wx.getShareInfo({shareTicket:t,success:function(t){e.call(t)},fail:function(t){console.log("getShareInfo失败：",t),i.call()}})},t.navigateToMiniProgram=function(t){Configs.isWx&&this.isNewFor("2.2.0")&&wx.navigateToMiniProgram(t)},t._gameName="",t.errNum=0,t.onVideoLoad=function(){console.log("加载完成开始播放视频"),1!=t.isALrShow&&(t.isALrShow=!0,t.videoAd.show())},t.onVideoClose=function(e){console.log("激励视频广告关闭了",e),t.onVideoClose_cb.call(null,e)},t.onVideoError=function(e){console.log("视频加载失败！！",t.videoAd),t.videoAd&&(t.videoAd=null),t.onVideoError_cb&&t.onVideoError_cb.call(null,e)},t}(),MiniServer=function(){function t(){this._access_token=null,this._isPrint=!1,EventManager.addEvent(EnumServerOperateType.TUNNEL,this,this.onGetTunnel)}return Object.defineProperty(t.prototype,"access_token",{get:function(){return this._access_token},enumerable:!0,configurable:!0}),t.prototype.setup=function(t,e,i,n){this._appid=e,this._gameId=i,this._serverAddr=t,this._isPrint=n,Configs.isPrint=n},t.prototype.traceLog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._isPrint&&traceLog(t)},t.prototype.login=function(){},t.prototype.onWxLoginSuccess=function(){},t.prototype.getToken=function(t){var e=new MiniHttpRequest;e.request(t,"GET",null,null),e.on(Laya.Event.COMPLETE,this,this.onGetTokensuccess),e.on(Laya.Event.ERROR,this,this.onGetTokenFail)},t.prototype.onGetTokenFail=function(t){void 0===t&&(t=null),traceLog("onGetTokenFail",t),EventManager.dispatchEvent(ServerEvent.LOGIN_FAIL)},t.prototype.onGetTokensuccess=function(t){traceLog("tokenRes:",t);var e=t.data;if(0==e.code){var i=e.data,n=i.userInfo;n&&(this.openId=n.openId),this._regionID=i.regionId,this._access_token=i.skey,EventManager.dispatchEvent(ServerEvent.LOGIN_SUCCESS,e.data),this.request("/weapp/region_login",null,null,null,!0)}else EventManager.dispatchEvent(ServerEvent.LOGIN_FAIL)},t.prototype.onGetTunnel=function(t){if(0==t.code){var e=t.data;EventManager.dispatchEvent(ServerEvent.ON_GET_SOCKET_URL,e.connectUrl)}},Object.defineProperty(t.prototype,"isLoginSuccess",{get:function(){return!!this._access_token},enumerable:!0,configurable:!0}),t.prototype.request=function(e,i,n,r,a){if(void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=!1),this.isLoginSuccess){var s,o=new MiniHttpRequest;s=a&&this._regionID&&this._regionID>0?this._serverAddr+"/s"+this._regionID+e:this._serverAddr+e,-1!=e.indexOf("https:")&&(s=e),n||(n="GET",i&&(n="POST")),null==r?r={"X-WX-Skey":this._access_token}:r["X-WX-Skey"]=this._access_token,a&&(r[t.WX_HEADER_REGION]=this._regionID),o.request(s,n,i,r),o.on(Laya.Event.COMPLETE,this,this.onReqSuccess,[e]),o.on(Laya.Event.ERROR,this,this.onReqError,[e])}},t.prototype.onReqSuccess=function(t,e){e&&EventManager.dispatchEvent(t,e)},t.prototype.onReqError=function(t,e){e&&(EventManager.dispatchEvent(t,e),-2==e.code&&EventManager.dispatchEvent(ServerEvent.SKEY_EXPIRE,e))},t.prototype.saveSingleValue=function(t,e){var i,n=this._serverAddr+EnumServerOperateType.SAVE_SINGLE+this._gameId+"/"+this.openId+"/"+t+"?access_token="+this._access_token,r={data:e},a=new MiniHttpRequest;i=Configs.isWx?{"content-type":"application/x-www-form-urlencoded;charset=UTF-8;"}:["content-type","application/x-www-form-urlencoded;charset=UTF-8;"],a.request(n,"POST",r,i),a.on(Laya.Event.COMPLETE,this,this.onSingleSaveReqSuccess,[EnumServerOperateType.SAVE_SINGLE,t])},t.prototype.onSingleSaveReqSuccess=function(t,e,i){i&&EventManager.dispatchEvent(t,e,i)},t.WX_HEADER_CODE="X-WX-Code",t.WX_HEADER_ENCRYPTED_DATA="X-WX-Encrypted-Data",t.WX_HEADER_IV="X-WX-IV",t.WX_HEADER_ID="X-WX-Id",t.WX_HEADER_SKEY="X-WX-Skey",t.WX_HEADER_REGION="X-WX-Region",t.X_WX_GAME_ID="x-wx-game-id",t.X_WX_OPEN_ID="x-wx-open-id",t.CONTENT_TYPE="Content-Type",t.CONTENT_TYPE_CONTENT="application/x-www-form-urlencoded;charset=UTF-8;",t}(),LayerManager=function(){function t(){}return t.setup=function(e){t._root=e,(t._mapLevel=new Sprite).name="mapLevel",t._root.addChild(t._mapLevel),t._mapLevel.autoSize=!0,(t._attackFaceLevel=new Sprite).name="attackFaceLevel",t._attackFaceLevel.autoSize=!1,t._attackFaceLevel.mouseEnabled=!1,t._root.addChild(t._attackFaceLevel),(t._uiLevel=new Sprite).name="uiLevel",t._uiLevel.mouseEnabled=!1,t._root.addChild(t._uiLevel),(t._gameLevel=new Sprite).name="gameLevel",t._gameLevel.mouseEnabled=!1,t._root.addChild(t._gameLevel),(t._topLevel=new Sprite).name="topLevel",t._topLevel.autoSize=!0,t._topLevel.mouseEnabled=!1,t._root.addChild(t._topLevel)},Object.defineProperty(t,"root",{get:function(){return t._root},enumerable:!0,configurable:!0}),Object.defineProperty(t,"mapLevel",{get:function(){return t._mapLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"uiLevel",{get:function(){return t._uiLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"gameLevel",{get:function(){return t._gameLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"topLevel",{get:function(){return t._topLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"attackFaceLevel",{get:function(){return t._attackFaceLevel},enumerable:!0,configurable:!0}),t}(),MiNi=function(){function t(){}return Object.defineProperty(t,"miniHttpServer",{get:function(){return this._miniHttpSerer},enumerable:!0,configurable:!0}),t.setup=function(t){Configs.isWx=t.isWx,Configs.sizeRect=t.sizeRect,PlatfromKit.setup(t.gameName),this._miniHttpSerer=new MiniServer,this._miniHttpSerer.setup(t.servriceAddr,t.wx_appId,t.server_gameId,t.isServicePrint);var e=new SystemInfo;if(Configs.wxSystemInfo=e,t.isWx){for(var i in e){var n=t.systemInfo;n.hasOwnProperty(i)&&(e[i]=n[i])}SubDomainMessageManager.setup(t.systemInfo),WxUpdateManager.setup()}GameRunningTimeManager.setup()},t}(),logStr="",errStr="",allStr="",ReferrerInfo=function(){function t(t){t&&(this.appId=t.appId,this.extraData=t.extraData)}return t.prototype.getValue=function(t){if(null!=this.extraData){var e=this.extraData.split("&");for(var i in e)if(!(i.split("=").length<2)&&i.split("=")[0]==t)return i.split("=")[1]}return null},t}(),HDReport=function(){function t(){}return t.setup=function(t,e,i){this.gameId=t,this._loginServer=e,this._reportServer=i},t.report=function(e){if(null!=e){var i=this.getSkey();if(this.checkOpenId()&&null!=i)return this.reportToken=i,this.openId=this.getUserId(),void this.initWithOpenid(this.openId,e);this.reportToken=i;var n=!0;this.login(function(i){n=!1,t.init(i.code,e,new CallBackFunc(t,function(){console.log("SERV connect success!!!")}))},function(t){console.error("login error",t)},function(i){n&&Laya.timer.once(3e3,t,function(){t.doReport(e,"login fail")})})}},t.initWithOpenid=function(t,e){t&&(this.openId=t,this.resaveLocalUserInfo(this.openId,"openid")),Laya.timer.once(3e3,this,function(){this.doReport(e,"no login")})},t.init=function(e,i,n){var r=this.loginServer+"/weapp/login";this.request(r,"GET",function(e){1==e.code?(t.openId=e.data.openId,t.reportToken=e.data.access_token,t.resaveLocalUserInfo(t.openId,"openid",t.reportToken),Laya.timer.once(3e3,t,function(){t.doReport(i,"login success")})):console.error("login fail",e)},function(t){console.error("login fail",t)},null,{"X-WX-Code":e})},t.getUserId=function(){var t=PlatfromKit.getValueFromLocal("userid");return t||(t=this.genGuid(),this.resaveLocalUserInfo(t,"guid")),t},t.getSkey=function(){return PlatfromKit.getValueFromLocal("skey")},t.checkOpenId=function(){return"openid"==PlatfromKit.getValueFromLocal("useridtype")},t.doReport=function(t,e){var i=t.query.type;"share"==i?this.setAccountSource(i,t.query.shareid,t):"wxad"==i?this.setAccountSource(i,t.query.adid+"."+t.query.weixinadinfo,t):i?this.setAccountSource(i,t.query.adid,t):this.setAccountSource("std",t.scene,t)},t.setAccountSource=function(t,e,i){var n=this.reportServer+"/app/report";this.request(n,"POST",function(t){1==t.code?console.log("report success",t):0==t.code?console.warn("report ignore",t):console.error("report fail",t)},function(t){console.error("report fail",t)},{gameId:this.gameId,openId:this.getUserId(),appId:this.getAppId(i),scene:i.scene,sourceType:t,sourceId:e,options:""},null,this.reportToken)},t.resaveLocalUserInfo=function(t,e,i){void 0===i&&(i=null),PlatfromKit.setValueLocal("userid",t),PlatfromKit.setValueLocal("useridtype",e),null!=i&&PlatfromKit.setValueLocal("skey",i)},t.genGuid=function(){return"".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).tostring(16)})},t.getAppId=function(t){var e=t.getAppId();return null==e?PlatfromKit.setValueLocal(this.gameId+"_appId",e):e=PlatfromKit.getValueFromLocal(this.gameId+"_appId"),e},Object.defineProperty(t,"loginServer",{get:function(){return null==this._loginServer&&console.error("loginServer is null"),this._loginServer},enumerable:!0,configurable:!0}),Object.defineProperty(t,"reportServer",{get:function(){return null==this._reportServer&&console.error("reportServer is null"),this._reportServer},enumerable:!0,configurable:!0}),t.login=function(t,e,i){void 0===i&&(i=null),console.log("wxproxy login start, iswx:",Configs.isWx),Configs.isWx&&wx.login({success:function(e){this.wxCode=e.code,null!=t&&t(e)},fail:function(){null!=e&&e()},complete:function(){null!=i&&i()}})},t.request=function(t,e,i,n,r,a,s){void 0===r&&(r=null),void 0===a&&(a=null),void 0===s&&(s=null),null==a&&(a={}),"POST"==e&&(a[MiniServer.CONTENT_TYPE]=MiniServer.CONTENT_TYPE_CONTENT),a[MiniServer.WX_HEADER_SKEY]=s||this.reportToken,a[MiniServer.X_WX_GAME_ID]=this.gameId,a[MiniServer.X_WX_OPEN_ID]=this.openId,Configs.isWx&&(null==r&&(r={}),wx.request({url:t,method:e,data:r,header:a,success:function(t){null!=i&&i(t.data)},fail:function(){console.error("request is err"),null!=n&&n()}}))},t._loginServer="",t._reportServer="",t.wxCode="",t.gameId=0,t.reportToken="",t.openId="",t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),WxSocket=function(t){function e(){var e=t.call(this)||this;return e._connecting=!1,e._connected=!1,e._easyProtocolOffset=0,e.socketConnectTimeout=function(){e._connecting&&(e._connecting=!1,e.dispatchEvent(GameSocket.SOCKET_TIME_OUT))},e._sendBytes=new ByteBuffer,e}return __extends(e,t),e.prototype.connect=function(t,e){var i;this._connecting?console.warn("wxsocket is connecting..."):(this._socket&&(this._socket.onOpen=null,this._socket.onMessage=null,this._socket.onClose=null,this._socket.onError=null,this._socket.close(null)),i=e?"wss://"+t+":"+e+"/ws":t,this._socket=wx.connectSocket({url:i,fail:function(t){t&&console.error("WxSocket连接失败",t)}}),this._socket.par=this,window.par=this,console.log("连接WXSOCKET：：：：",i),this._easyProtocolOffset=0,this._socketConnectTimeoutId=setTimeout(this.socketConnectTimeout,5e3),this.addEvent(),this._connecting=!0)},e.prototype.sendMk=function(t,e){var i=t.msgId,n=new ByteBuffer;this._easyProtocolOffset++;var r=this.getOffsetByte(this._easyProtocolOffset);n.writeByte(r),n.writeVarint32(i),n.writeBytes(e);var a=this.getBytesCode(n);this._sendBytes.position=0,this._sendBytes.writeByte(a),this._sendBytes.writeBytes(n),this._sendBytes.position=0,this._socket.send({data:this._sendBytes.__getBuffer(),fail:function(t){console.error(t)}}),this._sendBytes.clear(),this.socketTrace(">> C==>S MSG_CODE:"+i+" length:"+e.length)},e.prototype.onDataMK=function(t){if(t.data instanceof ArrayBuffer){var e=new ByteBuffer;t.data,e.endian=ByteArray.BIG_ENDIAN,e.writeArrayBuffer(t.data),e.pos=2;var i=e.readVarint32(),n=CmdMap.getCmdType(i);n?(this.socketTrace("<< S==>C MSG_CODE:"+n.getCmdStr()+" length:"+e.length),GameSocketDispatcher.excute(n,e)):console.warn("未知消息 消息号："+i+" length:"+e.length)}else console.error("data instanceof is not ArrayBuffer")},e.prototype.addEvent=function(){this._socket.onOpen(this.onSocketOpen),this._socket.onMessage(this.onMessageReveived),this._socket.onClose(this.onSocketClose),this._socket.onError(this.onConnectError)},e.prototype.onSocketOpen=function(t){SocketConnection.mainSocket.socketOpen()},e.prototype.socketOpen=function(){this.socketTrace("链接WXS成功"),this._connecting=!1,this._connected=!0,this.dispatchEvent(GameSocket.SOCKET_OPEN)},e.prototype.onSocketClose=function(){SocketConnection.mainSocket.socketClose()},e.prototype.socketClose=function(){this._connecting=!1,this._connected=!1,this.dispatchEvent(GameSocket.SOCKET_CLOSE),console.error("WxSocket closed")},e.prototype.onMessageReveived=function(t){SocketConnection.mainSocket.onDataMK(t)},e.prototype.onConnectError=function(t){console.error("连接WXS失败，请检查服务器状态",t),SocketConnection.mainSocket.socketError()},e.prototype.socketError=function(){this._connecting=!1,this.dispatchEvent(GameSocket.SOCKET_ERROR)},e.prototype.socketTrace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Configs.isPrint&&console.log("[wxsocket] "+t.join(","))},Object.defineProperty(e.prototype,"connected",{get:function(){return this._connected},enumerable:!0,configurable:!0}),e.prototype.getOffsetByte=function(t){var e=t;return e^=e>>8,255&(e^=e>>4)},e.prototype.getBytesCode=function(t){t.position=0;for(var e=0,i=t.length-1;i>=0;)e+=t.readByte(),i--;return 255&e},e.prototype.getTimer=function(){return(new Date).getTime()},e.SOCKET_OPEN="SOCKET_OPEN",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_ERROR="SOCKET_ERROR",e.SOCKET_TIME_OUT="SOCKET_TIME_OUT",e._lockMsgMap=new Dictionary,e._unLockMsgMap=new Dictionary,e._sendMsgTmMap=new Dictionary,e}(EventDispatcher);!function(t,e){"object"==(0,_typeof2.default)(exports)&&void 0!==module?module.exports=e(t):void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=e)?__WEBPACK_AMD_DEFINE_FACTORY__.call(exports,__webpack_require__,exports,module):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}("undefined"!=typeof self?self:window,function(global){var _Base64=global.Base64,version="2.4.8",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(t){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(t){for(var e={},i=0,n=t.length;i<n;i++)e[t.charAt(i)]=i;return e}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?fromCharCode(192|e>>>6)+fromCharCode(128|63&e):fromCharCode(224|e>>>12&15)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return fromCharCode(240|e>>>18&7)+fromCharCode(128|e>>>12&63)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(t){return t.replace(re_utob,cb_utob)},cb_encode=function(t){var e=[0,2,1][t.length%3],i=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[b64chars.charAt(i>>>18),b64chars.charAt(i>>>12&63),e>=2?"=":b64chars.charAt(i>>>6&63),e>=1?"=":b64chars.charAt(63&i)].join("")},btoa=global.btoa?function(t){return global.btoa(t)}:function(t){return t.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t)).toString("base64")}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t)).toString("base64")}:function(t){return btoa(utob(t))},encode=function(t,e){return e?_encode(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):_encode(String(t))},encodeURI=function(t){return encode(t,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return fromCharCode(55296+(e>>>10))+fromCharCode(56320+(1023&e));case 3:return fromCharCode((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return fromCharCode((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},btou=function(t){return t.replace(re_btou,cb_btou)},cb_decode=function(t){var e=t.length,i=e%4,n=(e>0?b64tab[t.charAt(0)]<<18:0)|(e>1?b64tab[t.charAt(1)]<<12:0)|(e>2?b64tab[t.charAt(2)]<<6:0)|(e>3?b64tab[t.charAt(3)]:0),r=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(255&n)];return r.length-=[0,0,2,1][i],r.join("")},atob=global.atob?function(t){return global.atob(t)}:function(t){return t.replace(/[\s\S]{1,4}/g,cb_decode)},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t,"base64")).toString()}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t,"base64")).toString()}:function(t){return btou(atob(t))},decode=function(t){return _decode(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"../../default.htm"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var t=global.Base64;return global.Base64=_Base64,t};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"==typeof Object.defineProperty){var noEnum=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(t){return encode(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}return global.Meteor&&(Base64=global.Base64),module.exports?module.exports.Base64=global.Base64:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return global.Base64}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)),{Base64:global.Base64}});var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),XHttpRequest=function(t){function e(){var i=t.call(this)||this;return i._retryTimes=3,i._state=e.STATE_IDLE,i._http=new Laya.HttpRequest,i._http.http.timeout=1e4,i}return __extends(e,t),Object.defineProperty(e.prototype,"result",{get:function(){return this._result},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.send=function(t,i,n,r){void 0===r&&(r=""),console.log("send httpRequest "+t+", "+i+", "+n),this._url=t,this._dataType=n,this._method=i,this._data=r,this._http.on(Laya.Event.COMPLETE,this,this.completeHandler),this._http.on(Laya.Event.ERROR,this,this.errorHandler),this._send(),this._state=e.STATE_LOADING},e.prototype._send=function(){this._http.send(this._url,this._data,this._method,this._dataType,["content-type","application/x-www-form-urlencoded;charset=UTF-8;"])},e.prototype.completeHandler=function(t){console.log("httpRequest complete"+this._url),this._result=t,this._state=e.STATE_COMPLETE,this.event(e.DATA_COMPLETE,this),this._http.off(Laya.Event.COMPLETE,this,this.completeHandler),this._http.off(Laya.Event.ERROR,this,this.errorHandler)},e.prototype.errorHandler=function(t){console.log("httpRequest error "+this._url),this._retryTimes>0?(this._retryTimes--,Laya.timer.once(500*(3-this._retryTimes),this,this._send)):(this._result=t,this._state=e.STATE_ERROR,this.event(e.DATA_ERROR,this),this._http.off(Laya.Event.COMPLETE,this,this.completeHandler),this._http.off(Laya.Event.ERROR,this,this.errorHandler))},e.DATA_COMPLETE="dataComplete",e.DATA_ERROR="dataError",e.STATE_IDLE=0,e.STATE_LOADING=1,e.STATE_COMPLETE=2,e.STATE_ERROR=3,e}(Laya.EventDispatcher),PathWay=function(){function t(){}return Object.defineProperty(t.prototype,"amount",{get:function(){return this.ponits.length},enumerable:!0,configurable:!0}),t}(),WayPoint=function(){function t(t){this.point=t}return Object.defineProperty(t.prototype,"position",{get:function(){return this.point.position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.point.rotation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"euler",{get:function(){return this.point.localRotationEuler},enumerable:!0,configurable:!0}),t}(),Fence=function(t,e){this.max=t,this.min=e},EViewType;!function(t){t[t.HOME=0]="HOME",t[t.LOADING=1]="LOADING",t[t.SCENE=2]="SCENE",t[t.RANK=3]="RANK"}(EViewType||(EViewType={}));var EnumKey=function(){function t(){}return t.SYNC_CLIENT_DATA="../../weapp/sync_client_data",t.GET_WORLD_RANK="../../weapp/get_rank",t.LOGIN_SERVER="../../weapp/login",t.LOGIN_REGION_SERVER="../../weapp/region_login",t.REQ_MATCH_DATA="../../weapp/get_ai_data",t.GET_FRIEND_HELP="../../weapp/get_friend_help",t.UPDAGE_FRIEND_HELP="../../weapp/update_friend_help",t.UPDATE_SKIN_CONDITION="../../weapp/update_skin_condition",t.UPDATE_SKIN="../../weapp/update_skin",t.UPDATE_SKIN_LIST="../../weapp/buy_skin",t.UPDATE_SCORE="../../weapp/sync_game_result",t.GET_LOGIN_REWARD="../../weapp/get_login_reward",t.GET_ALL_MAIL="../../weapp/get_all_mail",t.GET_MAIL_REWARD="../../weapp/get_mail_reward",t.GET_NEWBIE_REWARD="../../weapp/get_newbie_reward",t.GET_FRIEND_HELP_REWARD="../../weapp/get_friend_help_reward",t.AUTO_SHOW_FRIEND="AUTO_SHOW_FRIEND",t.AUTO_SHOW_NOVIVE="AUTO_SHOW_NOVIVE",t.AUTO_SHOW_NOVICE_COUNT="0",t.SHOW_FLYSHOES_FREE_GET="SHOW_FLYSHOES_FREE_GET",t.CLICK_READY_GETBTN_COUNT="CLICK_READY_GETBTN_COUNT",t.HEIG_SCORE="HEIG_SCORE",t.LOCAL_GOLD="LOCAL_GOLD",t.GET_USER_INFO="GET_USER_INFO",t.LOGIN_SERVER_SUCCESS="LOGIN_SERVER_SUCCESS",t.SHOW_HIDE_HOME_BTNS="SHOW_HIDE_HOME_BTNS",t.UPDATE_GOLD="UPDATE_GOLD",t.AUDIO_STATE="AUDIO_STATE",t.MUSIC_STATE="MUSIC_STATE",t.SHAKE_STATE="SHAKE_STATE",t.LUCKY_BAG_DAY_TIMES="LUCKY_BAG_DAY_TIMES",t.IS_NEW_PLAYER="IS_NEW_PLAYER",t.NEW_PLAYER_POINTS="NEW_PLAYER_POINTS",t.CLICK_START_GAME="CLICK_START_GAME",t.Game_Mode="Game_Mode",t.ClassicPlayerGameData="classicPlayerGameData",t.SurvivalPlayerGameData="survivalPlayerGameData",t.AlreadyShiWanData="AlreadyShiWanData",t.LoginTime="LoginTime",t.SHI_WAN_HINT_TIME="SHI_WAN_HINT_TIME",t.Login_Reward_Day="Login_Reward_Day",t.INVITE_RED_POINT="INVITE_RED_POINT",t.LOTTERY_RED_POINT="LOTTERY_RED_POINT",t.FRIEND_RED_POINT="FRIEND_RED_POINT",t.NOVICE_RED_POINT="NOVICE_RED_POINT",t.SHARE_SUC_COUNT="SHARE_SUC_COUNT",t.SHIWAN_SHARE_SUC_COUNT="SHIWAN_SHARE_SUC_COUNT",t.NOVICE_SHARE_COUNT="NOVICE_SHARE_COUNT",t.maxPlayRankID="S1_maxPlayRankID",t.SKIN_GET_CONDITION_1=1,t.SKIN_GET_CONDITION_2=2,t.SKIN_GET_CONDITION_3=3,t.SKIN_GET_CONDITION_8=8,t.SKIN_GET_CONDITION_9=9,t.SEASON_ID="SEASON_ID",t.FIRST_WIN_TIME="FIRST_WIN_TIME",t.NOVICE_CLOSE_VIDEO="NOVICE_CLOSE_VIDEO",t.NOVICE_SEE_VIDEO_TIMES="NOVICE_SEE_VIDEO_TIMES",t.SEE_VIDEO_TIMES="SEE_VIDEO_TIMES",t.LOTTERY_SEE_VIDEO_TIMES="LOTTERY_SEE_VIDEO_TIMES",t.LOTTERY_SHARE_TIMES="LOTTERY_SHARE_TIMES",t.ACTIVITY_GET_STATUS="ACTIVITY_GET_STATUS",t.ACTIVE_SKIN_IDS="ACTIVE_SKIN_IDS",t.SYNC_DATA_SUCCESS="SYNC_DATA_SUCCESS",t.LAST_CLICK_SHARE="LAST_CLICK_SHARE",t.FIRST_CLICK_FRIEND_SHIWAN="FIRST_CLICK_FRIEND_SHIWAN",t.SYNC_DATA="SYNC_DATA",t.CUR_ADD_POWER_COUNT="ADD_POWER_COUNT",t.SHARE_SUC_RATE="SHARE_SUC_RATE",t.UPDATE_TEAM_LIST="UPDATE_TEAM_LIST",t.FIRST_CHIJI_TIME="FIRST_CHIJI_TIME",t.C2S_SYNC_TIME=1,t.C2S_LOGIN=2,t.C2S_CHAT=3,t.C2S_START_MATCH=50,t.C2S_LOAD_FINISH_READY=51,t.C2S_SYNC_EAT_BUILDING=52,t.C2S_SYNC_GAME_INFO=53,t.C2S_EXIT_GAME=54,t.C2S_SYNC_QUALITY=55,t.C2S_SYNC_KILL_PLAYER=56,t.C2S_SYNC_PICK_UP_GIFT_BAG=57,t.C2S_CREATE_TEAM=70,t.C2S_JOIN_TEAM=71,t.C2S_LEAVE_TEAM=72,t.C2S_KICK_OUT_TEAM_MEMBER=73,t.C2S_TEAM_START_OR_CANCEL_READY=74,t.S2C_SYNC_TIME=1,t.S2C_LOGIN=2,t.S2C_CHAT=3,t.S2C_COMMON_TIP=4,t.S2C_START_MATCH=50,t.S2C_LOAD_FINISH_READY=51,t.S2C_START_GAME=52,t.S2C_EAT_BUILDING_FAIL=53,t.S2C_SYNC_EAT_BUILDING=54,t.S2C_SYNC_GAME_INFO=55,t.S2C_SYNC_QUALITY=56,t.S2C_SYNC_KILL_PLAYER=57,t.S2C_EXIT_GAME=58,t.S2C_CHANGE_ROOM_MASTER=60,t.S2C_SYNC_GAME_COUNT_DOWN_TIME=61,t.S2C_GAME_OVER=62,t.S2C_SYNC_PICK_UP_GIFT_BAG=63,t.S2C_GIFT_BAG_BOMB=64,t.S2C_CREATE_TEAM=70,t.S2C_SELF_JOIN_TEAM=71,t.S2C_OTHER_JOIN_TEAM=72,t.S2C_LEAVE_TEAM=73,t.S2C_KICK_OUT_TEAM_MEMBER=74,t.S2C_UPDATE_TEAM_MEMBER_STATE=75,t.S2C_TEAM_MASTER_START_MATCH=76,t.S2C_RECONNECT_ENTER_TEAM=77,t.S2C_TEAM_START_AUTO_MATCH=78,t.S2C_TEAM_CANCEL_AUTO_MATCH=79,t}(),EOtherType,EShareFailType,EAnimateType;!function(t){t[t.SimpleAI=0]="SimpleAI",t[t.AdvanceAI=1]="AdvanceAI",t[t.AdvanceProAI=2]="AdvanceProAI",t[t.RemoteAI=3]="RemoteAI",t[t.RemotePlayer=4]="RemotePlayer"}(EOtherType||(EOtherType={})),function(t){t[t.USER_CALCLE=0]="USER_CALCLE",t[t.NOT_GROUP=1]="NOT_GROUP",t[t.GROUP_REPEAT=2]="GROUP_REPEAT"}(EShareFailType||(EShareFailType={})),function(t){t[t.boy_finder=0]="boy_finder",t[t.boy_stand=1]="boy_stand",t[t.car_finder=2]="car_finder",t[t.fish_finder=3]="fish_finder",t[t.ship_finder=4]="ship_finder"}(EAnimateType||(EAnimateType={}));var EnumShareId=function(){function t(){}return t.SHARE_homePage=1,t.SHARE_rank=2,t.SHARE_GAMEOVER_SHOW=3,t.VIDEO_DOUBLE_PRIZE=4,t.SHARE_gameOver_relive=5,t.SHIWAN_SHIN_VIDEO=6,t.SHIWAN_SHIN_SHARE=7,t.SHARE_DOUBLE_PRIZE=8,t.LOTTERY_SHARE_PRIZE=9,t.NOVICE_SHARE_ON_VIDEO_ERROR=10,t.SHARE_GROUP_RANK=12,t.SHARE_gameover_group_rank=17,t.SEE_VIDEO=20,t.FRIEND_HELP=21,t.ACTIVITY_HELP=22,t.LOTTERY_SHARE=23,t.LOTTERY_VIDEO=24,t.CLICK_HOME_LOTTERY=25,t.CLICK_HOME_FriendHelp=26,t.CLICK_HOME_StartGame=27,t.ON_GAME_LAST_60=28,t.ON_GAME_OVER=29,t.CLICK_GAME_FLYSHOE=30,t.CLICK_GAME_GOLD_RELIVE=31,t.CLICK_HOWTOPLAY=32,t.CLICK_HOME_SKIN=33,t.CLICK_EXITVIEW_GAME_EXIT=34,t.LUCKY_VIDEO=35,t.LUCKY_SHARE=36,t.LUCKY_VIEW_SHOW=37,t.ACTIVITY_VIEW_SHOW=38,t.Invite_Get_Gold=39,t.AUTO_SHARE=40,t.ACTIVITY_SEE_VIDEO=41,t.NOVICE_PRIVILEGE_COMPELET=42,t.LOGIN_SHARE_DOUBLE_GOLD=43,t.READY_SHARE_DOUBLE_SIZE=44,t.NOVICE_PRIVILEGE_SHARE=45,t.LOGIN_SHARE_GET_SKIN=46,t.LOTTERY_CLICK_SHARE=47,t.LOTTERY_CLICK_VIDEO=48,t.SHARE_SURVIVE=49,t.TEAM_INVITE_SURVIVE=50,t.NEW_HOME_ENTER=100,t.NEW_CLOSE_LOGINREWARD=101,t.NEW_COLSE_LOTTERY=102,t.NEW_START_MATCH=103,t.NEW_MATCHOVER=104,t.NEW_PLAY_TIME_30=105,t.NEW_PLAY_TIME_150=106,t.NEW_GAME_OVER=107,t.NEW_KILL_AMOUNT=108,t.NEW_UPGRADE_TO_2=109,t.NEW_HOLE_LEVEL_PLUS=110,t.NEW_CLICK_NOME_START_GAME=111,t.NEW_SHIWAN_VIDEO_START_GAME=112,t.NEW_CLICK_SHIWAN_START_GAME=113,t.NEW_TOTAL_RUN_TIME=114,t.NEW_TOTAL_RUN_TIME_OVER_10=115,t.NEW_TOTAL_RUN_TIME_OVER_30=116,t}(),EDataUpdateType=function(){function t(){}return t.ClassicPlayerGameDataUpdate="ClassicPlayerGameDataUpdate",t.SurvivalPlayerGameDataUpdate="SurvivalPlayerGameDataUpdate",t}(),EnumDailyID,EnumAdIId;!function(t){t[t.GAME_ROUND=1]="GAME_ROUND",t[t.LOTTERY=2]="LOTTERY",t[t.LOTTERY_FREE=3]="LOTTERY_FREE"}(EnumDailyID||(EnumDailyID={})),function(t){t[t.HOME_VIEW=1]="HOME_VIEW",t[t.ACTIVITY_VIEW=2]="ACTIVITY_VIEW",t[t.FRIEND_HELP_VIEW=3]="FRIEND_HELP_VIEW",t[t.SKIN_VIEW=4]="SKIN_VIEW",t[t.CLASSIC_OVER_VIEW=5]="CLASSIC_OVER_VIEW",t[t.RANK_VIEW=6]="RANK_VIEW",t[t.DUAN_WEI_VIEW=7]="DUAN_WEI_VIEW",t[t.lottery_VIEW=8]="lottery_VIEW",t[t.GAME_VIEW=9]="GAME_VIEW",t[t.LotteryRewardView=10]="LotteryRewardView",t[t.MailboxView=11]="MailboxView",t[t.LoginRewardView=12]="LoginRewardView",t[t.HowToPlayView=13]="HowToPlayView",t[t.ShiWanView=14]="ShiWanView",t[t.InviteView=15]="InviteView",t[t.NovicePrivilegeView=16]="NovicePrivilegeView",t[t.SURVIVE_OVER_VIEW=17]="SURVIVE_OVER_VIEW"}(EnumAdIId||(EnumAdIId={}));var level=function(t){this.id=parseInt(t.id),this.no=parseInt(t.no),this.speed=parseFloat(t.speed),this.radius=parseFloat(t.radius),this.upgrade_score=parseFloat(t.upgrade_score),this.camera_increase=parseFloat(t.camera_increase),this.worth=parseFloat(t.worth),this.simpleAIScore=parseFloat(t.simpleAIScore),this.hardAIScore=parseFloat(t.hardAIScore),this.btAIScore=parseFloat(t.btAIScore)},version=function(t,e,i){this.adStatus=t,this.gameVersion=e,this.resVersion=i},bulid=function(t){this.id=parseInt(t.id),this.buildName=t.buildName,this.buildClass=parseInt(t.buildClass),this.buildRadiusX=.65*parseFloat(t.buildRadiusX),this.buildRadiusZ=.65*parseFloat(t.buildRadiusZ),this.buildScore=parseFloat(t.buildScore),this.buildRefreshTime=1e3*parseFloat(t.buildRefreshTime)},skin=function(t){this.id=parseInt(t.id),this.name=t.name,this.skinName=t.skinName,this.obtainCondition=parseFloat(t.obtainCondition),this.conditionalValue=parseFloat(t.conditionalValue),this.skinAdd=parseFloat(t.skinAdd),this.skinAddValue=parseFloat(t.skinAddValue),this.haveDays=parseFloat(t.haveDays),this.AISkinWeight=parseFloat(t.AISkinWeight),this.skinValue=t.skinValue,this.quality=parseInt(t.quality),this.openDemo=parseFloat(t.openDemo),this.deathColour=parseInt(t.deathColour)-1,this.showSkin=1==parseInt(t.showSkin),this.isShield=1==parseInt(t.isShield),this.deathColourVec=MaterialUtility.getColorByIndex(this.deathColour)},Mail=function(t){this.id=parseInt(t.id),this.icon=t.icon,this.mailName=t.mailName,this.mailContent=t.mailContent},Sign=function(t){this.signDay=parseInt(t.signDay),this.signReward=t.signReward;var e=this.signReward.split(":");e.length>1&&(this.rewardItemID=Number(e[0]),this.rewardItemValue=Number(e[1]))},LevelConfig=function(){function t(){t.ins=this;var e=Laya.loader.getRes(ConfigUtility.LevelConfigURL);e||(e=[{id:"1",no:"1",speed:"5.5",radius:"0.6",upgrade_score:"8",camera_increase:"0",worth:"5",simpleAIScore:"1",hardAIScore:"2"},{id:"2",no:"2",speed:"7",radius:"1.1",upgrade_score:"25",camera_increase:"11",worth:"10",simpleAIScore:"2",hardAIScore:"4"},{id:"3",no:"3",speed:"7",radius:"2.05",upgrade_score:"55",camera_increase:"12",worth:"25",simpleAIScore:"3",hardAIScore:"6"},{id:"4",no:"4",speed:"7",radius:"3.2",upgrade_score:"130",camera_increase:"12",worth:"60",simpleAIScore:"4",hardAIScore:"8"},{id:"5",no:"5",speed:"7",radius:"4.6",upgrade_score:"300",camera_increase:"12",worth:"100",simpleAIScore:"6",hardAIScore:"10"},{id:"6",no:"6",speed:"7",radius:"6",upgrade_score:"600",camera_increase:"12",worth:"200",simpleAIScore:"8",hardAIScore:"12"},{id:"7",no:"7",speed:"7",radius:"7.6",upgrade_score:"1200",camera_increase:"12",worth:"300",simpleAIScore:"10",hardAIScore:"15"},{id:"8",no:"8",speed:"7",radius:"9.5",upgrade_score:"2000",camera_increase:"12",worth:"300",simpleAIScore:"12",hardAIScore:"18"},{id:"9",no:"9",speed:"7",radius:"10.9",upgrade_score:"3000",camera_increase:"6.5",worth:"300",simpleAIScore:"14",hardAIScore:"21"},{id:"10",no:"10",speed:"7",radius:"12.3",upgrade_score:"4500",camera_increase:"6",worth:"300",simpleAIScore:"16",hardAIScore:"24"},{id:"11",no:"11",speed:"7",radius:"13.6",upgrade_score:"6000",camera_increase:"6",worth:"300",simpleAIScore:"18",hardAIScore:"27"},{id:"12",no:"12",speed:"7",radius:"14.7",upgrade_score:"99999",camera_increase:"6",worth:"300",simpleAIScore:"20",hardAIScore:"30"}]),this._levelCount=e.length,this._allLevels=new Array;for(var i=0;i<e.length;++i){var n=new level(e[i]);this._allLevels.push(n)}Laya.loader.clearRes(ConfigUtility.LevelConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LevelCount",{get:function(){return this._levelCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allLevels",{get:function(){return this._allLevels},enumerable:!0,configurable:!0}),t.prototype.get_camera_increase=function(t,e){if(void 0===t&&(t=0),t==e)return 0;var i=0;if(t<e)for(;t<e;)t++,i+=this.allLevels[t].camera_increase;else for(;t>e;t--)i-=this.allLevels[t].camera_increase;return i},t}(),BuildConfig=function(){function t(){this._config=Array(),t.ins=this;var e=Laya.loader.getRes(ConfigUtility.BuildConfigURL);e||(e=[]);for(var i=e.length;i--;){var n=new bulid(e[i]);this._config.push(n)}Laya.loader.clearRes(ConfigUtility.BuildConfigURL)}return Object.defineProperty(t,"modelFallingBool",{get:function(){return GameSetting.instance.hasProperty("modelFallingBool")?parseInt(GameSetting.instance.config.modelFallingBool):1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelMoveBool",{get:function(){return GameSetting.instance.hasProperty("modelMoveBool")?parseInt(GameSetting.instance.config.modelMoveBool):1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelInclineBool",{get:function(){return GameSetting.instance.hasProperty("modelInclineBool")?parseInt(GameSetting.instance.config.modelInclineBool):0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelRotateBool",{get:function(){return GameSetting.instance.hasProperty("modelRotateBool")?parseInt(GameSetting.instance.config.modelRotateBool):0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelScaleBool",{get:function(){return GameSetting.instance.hasProperty("modelScaleBool")?parseInt(GameSetting.instance.config.modelScaleBool):0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelFallingSpeed",{get:function(){return GameSetting.instance.hasProperty("modelFallingSpeed")?parseFloat(GameSetting.instance.config.modelFallingSpeed):.01},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelGravity",{get:function(){return GameSetting.instance.hasProperty("modelGravity")?parseFloat(GameSetting.instance.config.modelGravity):100},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelGravityPlus",{get:function(){return GameSetting.instance.hasProperty("modelGravityPlus")?parseFloat(GameSetting.instance.config.modelGravityPlus):100},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelShakingRate",{get:function(){return GameSetting.instance.hasProperty("modelShakingRate")?parseFloat(GameSetting.instance.config.modelShakingRate):22},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modelShakeAngle",{get:function(){return GameSetting.instance.hasProperty("modelShakeAngle")?parseFloat(GameSetting.instance.config.modelShakeAngle):.36},enumerable:!0,configurable:!0}),Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.prototype.getConfigByName=function(t){for(var e=this._config.length;e--;)if(this._config[e].buildName==t)return this._config[e]},t.prototype.getConfigById=function(t){for(var e=this._config.length;e--;)if(this._config[e].id==t)return this._config[e]},t.id="id",t.buildName="buildName",t.buildClass="buildClass",t.buildRadius="buildRadius",t.buildScore="buildScore",t.buildRefreshTime="buildRefreshTime",t}(),RankConfig=function(){function t(){}return t.config=[{id:1,rankType:1,rankClass:1,rankName:"Bronze 1st",integral:0,hardAIPer:0,upgradeCoin:100,seasonReward:"1000:0"},{id:2,rankType:1,rankClass:2,rankName:"Bronze 2nd",integral:20,hardAIPer:.07,upgradeCoin:100,seasonReward:"1000:200"},{id:3,rankType:1,rankClass:3,rankName:"Bronze 3rd",integral:50,hardAIPer:.09,upgradeCoin:100,seasonReward:"1000:400"},{id:4,rankType:2,rankClass:1,rankName:"Silver 1st",integral:100,hardAIPer:.11,upgradeCoin:100,seasonReward:"1000:600"},{id:5,rankType:2,rankClass:2,rankName:"Silver 2nd",integral:150,hardAIPer:.14,upgradeCoin:100,seasonReward:"1000:800"},{id:6,rankType:2,rankClass:3,rankName:"Silver 3rd",integral:200,hardAIPer:.17,upgradeCoin:100,seasonReward:"1000:1000"},{id:7,rankType:3,rankClass:1,rankName:"Gold 1st",integral:300,hardAIPer:.21,upgradeCoin:100,seasonReward:"1000:1200"},{id:8,rankType:3,rankClass:2,rankName:"Gold 2nd",integral:400,hardAIPer:.25,upgradeCoin:100,seasonReward:"1000:1400"},{id:9,rankType:3,rankClass:3,rankName:"Gold 3rd",integral:500,hardAIPer:.29,upgradeCoin:100,seasonReward:"1000:1600"},{id:10,rankType:4,rankClass:1,rankName:"Platinum 1st",integral:700,hardAIPer:.33,upgradeCoin:100,seasonReward:"1000:1800"},{id:11,rankType:4,rankClass:2,rankName:"Platinum 2nd",integral:900,hardAIPer:.37,upgradeCoin:100,seasonReward:"1000:2000"},{id:12,rankType:4,rankClass:3,rankName:"Platinum 3rd",integral:1100,hardAIPer:.41,upgradeCoin:100,seasonReward:"1000:2200"},{id:13,rankType:5,rankClass:1,rankName:"Diamond 1st",integral:1500,hardAIPer:.45,upgradeCoin:100,seasonReward:"1000:2400"},{id:14,rankType:5,rankClass:2,rankName:"Diamond 2nd",integral:2e3,hardAIPer:.49,upgradeCoin:100,seasonReward:"1000:2600"},{id:15,rankType:5,rankClass:3,rankName:"Diamond 3rd",integral:2500,hardAIPer:.52,upgradeCoin:100,seasonReward:"1000:2800"},{id:16,rankType:6,rankClass:1,rankName:"Stars 1st",integral:3e3,hardAIPer:.57,upgradeCoin:100,seasonReward:"1000:3000"},{id:17,rankType:6,rankClass:2,rankName:"Stars 2nd",integral:3600,hardAIPer:.62,upgradeCoin:100,seasonReward:"1000:3200"},{id:18,rankType:6,rankClass:3,rankName:"Stars 3rd",integral:4200,hardAIPer:.67,upgradeCoin:100,seasonReward:"1000:3400"},{id:19,rankType:7,rankClass:1,rankName:"King's 1st",integral:5e3,hardAIPer:.72,upgradeCoin:100,seasonReward:"1000:3600"},{id:20,rankType:7,rankClass:2,rankName:"King's 2nd",integral:6e3,hardAIPer:.77,upgradeCoin:100,seasonReward:"1000:3800"},{id:21,rankType:7,rankClass:3,rankName:"King's 3rd",integral:7e3,hardAIPer:.82,upgradeCoin:100,seasonReward:"1000:4000"}],t}(),RankData=function(){},ScoreConfig=function(){function t(){}return t.config=[{id:1,ranking:1,score:20,settlementRewardCoin:"1000:100"},{id:2,ranking:2,score:15,settlementRewardCoin:"1000:80"},{id:3,ranking:3,score:12,settlementRewardCoin:"1000:80"},{id:4,ranking:4,score:10,settlementRewardCoin:"1000:60"},{id:5,ranking:5,score:8,settlementRewardCoin:"1000:60"},{id:6,ranking:6,score:6,settlementRewardCoin:"1000:50"},{id:7,ranking:7,score:4,settlementRewardCoin:"1000:40"},{id:8,ranking:8,score:2,settlementRewardCoin:"1000:30"},{id:9,ranking:9,score:1,settlementRewardCoin:"1000:20"},{id:10,ranking:10,score:1,settlementRewardCoin:"1000:10"},{id:11,ranking:11,score:-2,settlementRewardCoin:"1000:10"},{id:12,ranking:12,score:-4,settlementRewardCoin:"1000:10"},{id:13,ranking:13,score:-6,settlementRewardCoin:"1000:10"},{id:14,ranking:14,score:-8,settlementRewardCoin:"1000:10"},{id:15,ranking:15,score:-10,settlementRewardCoin:"1000:10"}],t}(),SkinConfig=function(){function t(){}return Object.defineProperty(t,"allSkins",{get:function(){return this._allSkins},enumerable:!0,configurable:!0}),Object.defineProperty(t,"totalAISkinWeight",{get:function(){return this._totalAISkinWeight},enumerable:!0,configurable:!0}),t.LoadConfig=function(){this._dic=new Laya.Dictionary;var t=Laya.loader.getRes(ConfigUtility.SkinConfigURL);t||console.error("skin config error");for(var e=0;e<t.length;++e){var i=new skin(t[e]);this._allSkins.push(i),this._dic.set(i.id,i),this._totalAISkinWeight+=i.AISkinWeight}Laya.loader.clearRes(ConfigUtility.SkinConfigURL)},t.getDataById=function(t){return this._dic.get(t)},t.getDataByQuality=function(t){var e=new Array;return this._allSkins.forEach(function(i){0!=t&&i.quality!=t||e.push(i)}),e},t.getDataByIndex=function(t){return t<0&&t>=this._allSkins.length?this._allSkins[0]:this._allSkins[t]},t._allSkins=new Array,t._totalAISkinWeight=0,t}(),SkinFeature=function(){function t(){}return t.SpeedFeature=1,t.WeightFeature=2,t}(),ActivityConfig=function(){function t(){this._dic=new Laya.Dictionary;var t=Laya.loader.getRes(ConfigUtility.ActivityConfigURL);t||(t={});for(var e=0;e<t.length;++e){var i=new ActivityData;i.setData(t[e]),this._dic.set(i.id,i)}Laya.loader.clearRes(ConfigUtility.ActivityConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),t.prototype.getDataById=function(t){return this._dic.get(t)},t}(),ActivityData=function(){function t(){this.startDate=null,this.endDate=null}return t.prototype.setData=function(t){this.id=t.id,this.openTime=t.openTime,this.endTime=t.endTime,this.activityCondition=t.activityCondition,this.conditionalValue=t.conditionalValue,this.conditionalValueMax=t.conditionalValueMax,this.rewardSkinId=t.rewardSkinId,this.type=t.type},t.prototype.isOpened=function(){if(!this.openTime)return!1;var t=Laya.Browser.now();this.startDate||(this.startDate=this.getDate(this.openTime)),this.endDate||(this.endDate=this.getDate(this.endTime));var e=this.startDate.getTime(),i=this.endDate.getTime();return t>=e&&t<i},t.prototype.getDate=function(t){var e=t.split("_"),i=e[0].split("-"),n=e[1].split(":"),r=Number(i[0]),a=Number(i[1]-1),s=Number(i[2]),o=Number(n[0]),l=Number(n[1]),h=Number(n[2]),c=new Date(r,a,s,o,l,h);return console.log("活动时间为：id=",this.id,r,a,s,o,l,h),c},t}(),LotteryCfg=function(){function t(){t.ins=this,this._dic=new Laya.Dictionary;var e=Laya.loader.getRes(ConfigUtility.LotteryConfigURL);e||(e={});for(var i=0;i<e.length;++i){var n=new LotteryData;n.setData(e[i]),t.allWeight+=n.rewardWeight,this._dic.set(n.id,n)}Laya.loader.clearRes(ConfigUtility.LotteryConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),t.prototype.getDataById=function(t){return this._dic.get(t)},t.allWeight=0,t}(),LotteryData=function(){function t(){}return t.prototype.setData=function(t){this.id=t.id,this.rewardID=t.rewardID,this.rewardValue=t.rewardValue,this.rewardWeight=t.rewardWeight},t}(),ItemConfig=function(){function t(){t.ins=this,this._dic=new Laya.Dictionary;var e=Laya.loader.getRes(ConfigUtility.ItemConfigURL);e||(e={});for(var i=0;i<e.length;++i){var n=new ItemData;n.setData(e[i]),this._dic.set(n.id,n)}Laya.loader.clearRes(ConfigUtility.ItemConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),t.prototype.getDataById=function(t){return this._dic.get(t)},t}(),EItemType;!function(t){t[t.GOLD=1]="GOLD",t[t.CLIP=2]="CLIP",t[t.SKIN=3]="SKIN",t[t.CLIP_BAG=4]="CLIP_BAG"}(EItemType||(EItemType={}));var ItemData=function(){function t(){}return t.prototype.setData=function(t){this.id=t.id,this.name=t.name,this.type=t.type,this.iconname=t.iconname},Object.defineProperty(t.prototype,"iconUrl",{get:function(){return ConfigUtility.baseUrl+"res/icon/"+this.iconname+".png"},enumerable:!0,configurable:!0}),t}(),SeasonCfg=function(){function t(){this._dic=new Laya.Dictionary;var t=Laya.loader.getRes(ConfigUtility.SeasonConfigURL);t||(t={});for(var e=0;e<t.length;++e){var i=new SeasonData;i.setData(t[e]),this._dic.set(i.id,i)}Laya.loader.clearRes(ConfigUtility.SeasonConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),t.prototype.getDataById=function(t){return this._dic.get(t)},t.prototype.getCurSeason=function(){for(var t=this._dic.values,e=0;e<t.length;e++){var i=t[e];if(TimerUtil.isInTime(i.openTime,i.endTime))return i}return null},t}(),SeasonData=function(){function t(){}return t.prototype.setData=function(t){this.id=t.id,this.openTime=t.openTime,this.endTime=t.endTime,this.seasonSkinRank=t.seasonSkinRank,this.rewardSkinId=t.rewardSkinId},t}(),SettlementCfg=function(){function t(){this._dic=new Laya.Dictionary;var t=Laya.loader.getRes(ConfigUtility.SettlementConfigURL);t||(t={});for(var e=0;e<t.length;++e){var i=new SettementData;i.setData(t[e]),this._dic.set(i.skinId,i)}Laya.loader.clearRes(ConfigUtility.SettlementConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),t.prototype.getDataById=function(t){return this._dic.get(t)},t.prototype.getAllRandomData=function(){var t=[];return this._dic.values.forEach(function(e){var i=SkinManager.getSkinData(e.skinId);(!i||i&&-1!=i.gainTime)&&t.push(e)}),t},t.prototype.getRandomData=function(){var t=this._dic.values;return t[NumberUtil.randRange(0,t.length-1)]},t.prototype.getDataByWeight=function(){var e=t.instance.getAllRandomData(),i=0;e.forEach(function(t){i+=t.weight});for(var n=NumberUtil.randRange(1,i),r=0;r<e.length;r++){var a=e[r];if(n<=a.weight)return a;n-=a.weight}return t.instance.getRandomData()},t.prototype.getDataBySkinBitsId=function(t){for(var e=this._dic.values,i=e.length;i--;)if(e[i].skinBitsId==t)return e[i];if(e.length>0)return e[0]},t}(),SettementData=function(){function t(){}return t.prototype.setData=function(t){this.skinId=t.skinId,this.skinBitsId=t.skinBitsId,this.weight=t.weight,this.num=t.number},t}(),SignConfig=function(){function t(){t.ins=this,this._dic=new Laya.Dictionary;var e=Laya.loader.getRes(ConfigUtility.SignConfigURL);e||(e=[{signDay:1,signReward:"1000:100"},{signDay:2,signReward:"3:-1"},{signDay:3,signReward:"1000:150"},{signDay:4,signReward:"1000:200"},{signDay:5,signReward:"1000:250"},{signDay:6,signReward:"1000:300"},{signDay:7,signReward:"23:-1"},{signDay:8,signReward:"1000:350"},{signDay:9,signReward:"1000:400"},{signDay:10,signReward:"1000:450"},{signDay:11,signReward:"1000:500"},{signDay:12,signReward:"1000:550"},{signDay:13,signReward:"1000:600"},{signDay:14,signReward:"24:-1"}]);for(var i=0;i<e.length;++i){var n=new Sign(e[i]);this._dic.set(n.signDay,n)}Laya.loader.clearRes(ConfigUtility.SignConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._dic.keys.length},enumerable:!0,configurable:!0}),t.prototype.getDataById=function(t){return this._dic.get(t)},t.prototype.getCurRewardSkin=function(t){for(var e=0;e<this.length;e++){var i=this._dic.values[e];if(null!=i&&1e3!=i.rewardItemID&&i.signDay>=t)return i.signDay}return 14},t}(),LuckyBagConfig=function(){function t(){this.allWeight=0,this._dic=new Laya.Dictionary;var t=Laya.loader.getRes(ConfigUtility.LuckyBagConfigURL);t||(t=[{id:1,rewardID:1e3,rewardValue:600,rewardWeight:250},{id:2,rewardID:1e3,rewardValue:650,rewardWeight:350},{id:3,rewardID:1e3,rewardValue:700,rewardWeight:150},{id:4,rewardID:1e4,rewardValue:1,rewardWeight:250}]);for(var e=0;e<t.length;++e)this._dic.set(t[e].id,t[e]),this.allWeight+=t[e].rewardWeight;Laya.loader.clearRes(ConfigUtility.LuckyBagConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),t.prototype.getDataById=function(t){return this._dic.get(t)},t.prototype.getRanomData=function(){for(var t=Math.floor(HelperExtension.random(0,this.allWeight)),e=this._dic.keys.length,i=0,n=0;n<e;n++)if(0!=this._dic.values[n].rewardWeight&&(i+=this._dic.values[n].rewardWeight)>=t)return this._dic.values[n];return this._dic.values[0]},t}(),MailConfig=function(){function t(){t.ins=this;var e=Laya.loader.getRes(ConfigUtility.MailConfigURL);e||(e=[{id:1,mailName:"更新补偿",mailContent:"亲爱的玩家，游戏于$进行版本更新，给您带来的不便请谅解，特此赠送更新奖励，请及时领取！"},{id:2,mailName:"赛季奖励",mailContent:"亲爱的玩家，您上赛季段位达到$，恭喜您获得赛季奖励，请查收，再接再厉哟！"}]),this._allMail=new Array;for(var i=0;i<e.length;++i){var n=new Mail(e[i]);this._allMail.push(n)}Laya.loader.clearRes(ConfigUtility.MailConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allMail",{get:function(){return this._allMail},enumerable:!0,configurable:!0}),t.prototype.getMailByID=function(t){for(var e=this._allMail.length;e--;)if(t==this._allMail[e].id)return this._allMail[e]},t}(),sceneData=function(t){if(this.occurrenceWeight=new Array,this.startrank=parseInt(t.startrank),this.endrank=parseInt(t.endrank),t.occurrenceWeight)for(var e=t.occurrenceWeight.split(":"),i=0;i<e.length;i++){var n=parseFloat(e[i]);isNaN(n)||this.occurrenceWeight.push(n)}},SceneConfig=function(){function t(){t.ins=this;var e=Laya.loader.getRes(ConfigUtility.SceneConfigURL);e||(e=[{startrank:1,endrank:3,occurrenceWeight:"100:0"},{startrank:4,endrank:9,occurrenceWeight:"50:50"},{startrank:10,endrank:21,occurrenceWeight:"30:70"}]),this._allSceneData=new Array;for(var i=0;i<e.length;++i){var n=new sceneData(e[i]);this._allSceneData.push(n)}Laya.loader.clearRes(ConfigUtility.SceneConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allSceneData",{get:function(){return this._allSceneData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sceneTag",{get:function(){for(var t=RankDataManager.rankData,e=0;e<this._allSceneData.length;e++){var i=this._allSceneData[e];if(i.startrank<=t.id&&i.endrank>=t.id)for(var n=HelperExtension.random(0,100),r=0;r<i.occurrenceWeight.length;r++)if(0!=i.occurrenceWeight[r]){if(i.occurrenceWeight[r]>=n)return r;n-=i.occurrenceWeight[r]}}return ESceneTag.HAIDAO1},enumerable:!0,configurable:!0}),t}(),FriendHelpRewardConfig=function(){function t(){t.ins=this,this._dic=new Array;var e=Laya.loader.getRes(ConfigUtility.FriendHelpRewardConfigURL);e||(e=[]);for(var i=0;i<e.length;++i){var n=new FriendHelpRewardData;n.setData(e[i]),this._dic.push(n)}Laya.loader.clearRes(ConfigUtility.FriendHelpRewardConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),t}(),FriendHelpRewardData=function(){function t(){}return t.prototype.setData=function(t){this.id=t.id,this.helpNumber=t.helpNumber,this.rewardID=t.rewardID,this.rewardValue=t.rewardValue},Object.defineProperty(t.prototype,"iconUrl",{get:function(){return ItemConfig.instance.getDataById(this.id).iconUrl},enumerable:!0,configurable:!0}),t}(),Message=function(t){this.id=parseInt(t.id),this.message=t.message},MessageConfig=function(){function t(){t.ins=this;var e=Laya.loader.getRes(ConfigUtility.MailConfigURL);e||(e=[{id:1,message:"您被请离了队伍"},{id:2,message:"只有队长才能开始游戏"},{id:3,message:"不存在该队伍"},{id:4,message:"队伍已经满员了哦"},{id:5,message:"还有人没有准备好，无法开始游戏"},{id:100,message:"你好，很高兴能和你们一起玩！"},{id:101,message:"快点开呀，我都等到海枯石烂了QAQ"},{id:102,message:"再等等，马上就开，别着急：）"},{id:103,message:"准备了，准备了，磨磨唧唧干啥呢= ="},{id:104,message:"敢不敢吞了这座城再走TT"},{id:105,message:"让你们见识一下我的厉害！"}]),this._allMessage=new Dictionary;for(var i=0;i<e.length;++i){var n=new Message(e[i]);this._allMessage.set(n.id,n)}console.log("————————————消息配置如下————————————"),console.log(this._allMessage),Laya.loader.clearRes(ConfigUtility.MessageConfigURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allMessage",{get:function(){return this._allMessage},enumerable:!0,configurable:!0}),t}(),EMBFeatureType;!function(t){t[t.WeightD=0]="WeightD",t[t.SpeedT=1]="SpeedT",t[t.WeightT=2]="WeightT"}(EMBFeatureType||(EMBFeatureType={}));var MysteriousBag=function(t){this.id=parseInt(t.id),this.bagID=parseInt(t.bagID),this.type=parseInt(t.type),this.changeValue=parseFloat(t.changeValue),this.time=parseInt(t.time),this.time=-1==this.time?this.time:1e3*this.time,this.tips=t.tips},MysteriousBagCfg=function(){function t(){t.ins=this;var e=Laya.loader.getRes(ConfigUtility.MysteriousBagCfgURL);e||(e=[{id:1,appearTime:90,bagID:1e4,type:0,changeValue:-66,time:-1,weight:50}]),this._allMysteriousBag=new Dictionary;for(var i=0;i<e.length;++i){var n=new MysteriousBag(e[i]);this._allMysteriousBag.set(n.id,n)}Laya.loader.clearRes(ConfigUtility.MysteriousBagCfgURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allMysteriousBag",{get:function(){return this._allMysteriousBag},enumerable:!0,configurable:!0}),t}(),TimedEvent=function(t,e){this.Callback=t,this.TimeToExecute=e},TimerEvent=function(){function t(){this.events=new Array,Laya.timer.frameLoop(1,this,this.Update)}return t.prototype.Add=function(t,e){var i=new TimedEvent(t,Laya.timer.currTimer+e);return this.events.push(i),i},t.prototype.Remove=function(t){var e=this.events.indexOf(t);e>=0&&this.events.splice(e,1)},t.prototype.Update=function(){if(null!=this.events&&0!=this.events.length)for(var t=0;t<this.events.length;t++){var e=this.events[t];e.TimeToExecute<=Laya.timer.currTimer&&(e.Callback(),this.events.splice(this.events.indexOf(e),1))}},t}(),EventListener=function(t,e){void 0===e&&(e=!1),this.method=t,this.isSingleShot=e},EventMap=function(t){this.eventName=t,this.eventArray=new Array},EventSetting=function(){function t(){}return t.on_ready_load_game="on_ready_load_game",t.on_local_player_update="on_local_player_update",t.on_local_player_joined="on_local_player_joined",t.on_already_to_play="on_already_to_play",t.on_restart_game="on_restart_game",t.on_exit_game="on_exit_game",t.on_classic_over="on_classic_over",t.on_classic_dead="on_classic_dead",t.on_match_start="on_match_start",t.on_match_over="on_match_over",t.on_resource_loaded="on_resource_loaded",t.on_scene_loaded_online="on_scene_loaded_online",t.on_player_ready_online="on_player_ready_online",t.on_game_start_online="on_game_start_online",t.on_survival_over="on_survival_over",t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),SimpleAIComponet=function(t){function e(){var e=t.call(this)||this;return e.AIChangeDirectRate=5e3,e.isAllowFollow=!0,e.isFollowing=!1,e.isAllowEscape=!0,e.isEscaping=!1,e.fishtailingOffset=new Vector2,e.followTime=PlayerUtility.PlayerFollowingTime,e.nextAllowTime=PlayerUtility.cdPlayerFollowTime,e.escapeTime=PlayerUtility.PlayerEscapingTime,e.nextEscapeTime=PlayerUtility.cdPlayerEscapeTime,e}return __extends(e,t),e.prototype._load=function(t){this.AIPlayer=t,this._pos=this.AIPlayer.getPostion(),this._quat=this.AIPlayer.getRotation(),this.randomDirect()},e.prototype._start=function(t){},e.prototype._update=function(t){this.isEscaping?this.escape():this.isFollowing?this.follow():this.randomMove()},e.prototype.resetPos=function(){this.AIPlayer&&(this._pos=this.AIPlayer.getPostion())},e.prototype.randomDirect=function(){this.deltaX=HelperExtension.random(-100,100),this.deltaY=HelperExtension.random(-100,100),this.angle=Math.atan2(this.deltaY,this.deltaX),Laya.Quaternion.createFromYawPitchRoll(-this.angle,0,0,this._quat),this.AIPlayer.setRotation(this._quat),this.radiansX=Math.cos(this.angle),this.radiansY=Math.sin(this.angle),this.randomMoveX=this.radiansX*this.AIPlayer.speed,this.randomMoveY=this.radiansY*this.AIPlayer.speed},e.prototype.setDirect=function(t,e){this.angle=Math.atan2(this.deltaY,this.deltaX),Laya.Quaternion.createFromYawPitchRoll(-this.angle,0,0,this._quat),this.AIPlayer.setRotation(this._quat),this.radiansX=Math.cos(this.angle),this.radiansY=Math.sin(this.angle),this.randomMoveX=this.radiansX*this.AIPlayer.speed,this.randomMoveY=this.radiansY*this.AIPlayer.speed},e.prototype.randomMove=function(){this.AIChangeDirectRate-=Laya.timer.delta,this.AIChangeDirectRate<0&&(this.randomDirect(),this.AIChangeDirectRate=5e3);var t=Laya.timer.delta/1e3,e=t*this.randomMoveX,i=t*this.randomMoveY;this._pos.x+=e,this._pos.z+=i,this.AIPlayer.setPostion(this._pos);var n=FenceEntity.fenceDetect(this.AIPlayer);if(0!=n){switch(n){case 1:this._pos.x-=e,this.deltaX=-this.deltaX;break;case 2:this._pos.z-=i,this.deltaY=-this.deltaY;break;case 3:this._pos.x-=e,this._pos.z-=i,this.deltaX=-this.deltaX,this.deltaY=-this.deltaY}this.setDirect(this.deltaX,this.deltaY),this.AIPlayer.setPostion(this._pos)}},e.prototype.pathfinderMove=function(){},e.prototype.whoIFollow=function(t){if(this.isAllowFollow){if(this.followedHole){if(this.followedHole.isLocalPlayer)return;if(this.AIPlayer.OtherType==EOtherType.AdvanceProAI&&t.isLocalPlayer)return this.followedHole=t,void(this.followTime=PlayerUtility.PlayerFollowingTime);if(this.followedHole.id==t.id)return;Vector3.distance(this._pos,t.transform.position)<Vector3.distance(this._pos,this.followedHole.transform.position)&&(this.followedHole=t,this.followTime=PlayerUtility.PlayerFollowingTime)}else this.followedHole=t;this.isFollowing=!0,this.reset_tail()}},e.prototype.follow=function(){if(this.followTime-=Laya.timer.delta,this.followTime<0||!this.followedHole||!this.followedHole.isAlive||this.followedHole.levelIndex>=this.AIPlayer.levelIndex)return this.isFollowing=!1,this.followTime=PlayerUtility.PlayerFollowingTime,this.followedHole=null,this.isAllowFollow=!1,Laya.timer.once(this.nextAllowTime,this,this.restartAllowFollow),void this.randomDirect();var t=Laya.timer.delta/1e3,e=this.followedHole.transform.position,i=new Vector3(e.x-this._pos.x,0,e.z-this._pos.z);this.fishtailingCode&&(this.fishtailing(t),i.x+=this.fishtailingOffset.x,i.z+=this.fishtailingOffset.y),this.angle=Math.atan2(i.z,i.x),Laya.Quaternion.createFromYawPitchRoll(-this.angle,0,0,this._quat),this.AIPlayer.setRotation(this._quat),this.radiansX=Math.cos(this.angle),this.radiansY=Math.sin(this.angle),this._pos.x+=this.radiansX*t*this.AIPlayer.speed,this._pos.z+=this.radiansY*t*this.AIPlayer.speed,this.AIPlayer.setPostion(this._pos)},e.prototype.restartAllowFollow=function(){this.isAllowFollow=!0},e.prototype.whoIEscape=function(t){if(this.isAllowEscape){if(this.escapeHole){if(this.escapeHole.id==t.id)return;Vector3.distance(this._pos,t.transform.position)<Vector3.distance(this._pos,this.escapeHole.transform.position)&&(this.escapeHole=t,this.escapeTime=PlayerUtility.PlayerEscapingTime)}else this.escapeHole=t;this.isEscaping=!0,this.reset_tail()}},e.prototype.escape=function(){if(this.escapeTime-=Laya.timer.delta,this.escapeTime<0||!this.escapeHole||!this.escapeHole.isAlive||this.escapeHole.levelIndex<=this.AIPlayer.levelIndex)return this.isEscaping=!1,this.escapeTime=PlayerUtility.PlayerEscapingTime,this.escapeHole=null,this.isAllowEscape=!1,Laya.timer.once(this.nextAllowTime,this,this.restartAllowEscape),void this.randomDirect();var t=Laya.timer.delta/1e3,e=this.escapeHole.transform.position,i=new Vector3(this._pos.x-e.x,0,this._pos.z-e.z);this.fishtailingCode&&(this.fishtailing(t),i.x+=this.fishtailingOffset.x,i.z+=this.fishtailingOffset.y),this.angle=Math.atan2(i.z,i.x),Laya.Quaternion.createFromYawPitchRoll(-this.angle,0,0,this._quat),this.AIPlayer.setRotation(this._quat),this.radiansX=Math.cos(this.angle),this.radiansY=Math.sin(this.angle),this._pos.x+=this.radiansX*t*this.AIPlayer.speed,this._pos.z+=this.radiansY*t*this.AIPlayer.speed,0!=FenceEntity.fenceDetect(this.AIPlayer)?(this.escapeTime=0,this._pos=this.AIPlayer.getPostion()):this.AIPlayer.setPostion(this._pos)},e.prototype.restartAllowEscape=function(){this.isAllowEscape=!0},e.prototype.reset_tail=function(){this.AIPlayer.levelIndex<3?this.fishtailingCode=!1:(this.fishtailingRate=0,this.fishtailingOffset=new Vector2,this.fishtailingCode=HelperExtension.coinTest(),this.fishtailingValue=HelperExtension.random(2,6),this.fishtailingSpeedInvert=HelperExtension.random(4,12))},e.prototype.fishtailing=function(t){if(this.fishtailingRate+=t,this.fishtailingRate>=2){var e=(this.fishtailingRate-2)/this.fishtailingSpeedInvert;e=this.fishtailingValue*Math.sin(e*HelperExtension.Rad2Deg),this.fishtailingOffset.x=e,this.fishtailingOffset.y=-e,this.fishtailingRate>=8.142&&this.reset_tail()}},e}(Laya.Script),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),AdvancedAIComponet=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._load=function(t){this.meshSprite3D=t},e.prototype._start=function(t){},e.prototype._update=function(t){},e}(Laya.Script),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),PathFindComponet=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._load=function(t){console.log("here _load")},e.prototype._start=function(t){},e.prototype._update=function(t){this.finder.automotor(),console.log("here _update")},e}(Laya.Script),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),RemoteComponet=function(t){function e(){var e=t.call(this)||this;return e.needRotate=!1,e.leftRot=new Quaternion,e.rotProgress=0,e.needTrans=!1,e.transProgress=0,e.transTotalTime=0,e.leftPos=new Vector3,e._targetPos=new Vector3,e.isNeedUpdateSync=!1,e}return __extends(e,t),e.prototype._load=function(t){this.player=t,this._pos=this.player.getPostion(),this._pos.y=PlayerUtility.posY,this._quat=this.player.getRotation()},e.prototype._update=function(t){if(this.isNeedUpdateSync){var e=Laya.timer.delta/1e3;this.lerpRot(e),this.lerpMove(e),this.needRotate||this.needTrans||(this.isNeedUpdateSync=!1)}},e.prototype.setDirect=function(t,e){if(this.player.isDetect){var i=new Vector3(t-this.player.transform.position.x,0,e-this.player.transform.position.z),n=Math.atan2(i.z,i.x);if(Laya.Quaternion.createFromYawPitchRoll(-n,0,0,this._quat),this.needRotate=!this.player.transform.rotation.equals(this._quat),this.needRotate&&(this.leftRot=this.player.getRotation(),this.rotProgress=0),this._targetPos=new Vector3(t,PlayerUtility.posY,e),this.needTrans=!Vector3.equals(this.player.transform.position,this._targetPos),this.needTrans){this.leftPos=this.player.getPostion(),this.transProgress=0;var r=Vector3.distance(this.leftPos,this._targetPos);this.transTotalTime=r/this.player.speed}this.needRotate||this.needTrans?this.isNeedUpdateSync=!0:this.isNeedUpdateSync=!1}else this._pos.x=t,this._pos.z=e,this.player.setPostion(this._pos),this.isNeedUpdateSync=!1},e.prototype.move=function(t){var e=t*this.directX,i=t*this.directY;this._pos.x+=e,this._pos.z+=i,this.player.setPostion(this._pos);var n=Math.abs(this._pos.x-this._targetPos.x),r=Math.abs(this._pos.z-this._targetPos.z);n<=.02&&r<=.02&&(this.isNeedUpdateSync=!1,this.player.setPostion(this._targetPos))},e.prototype.lerpRot=function(t){if(this.needRotate){this.rotProgress+=20*t,this.rotProgress>1&&(this.rotProgress=1,this.needRotate=!1);var e=new Quaternion;Quaternion.lerp(this.leftRot,this._quat,this.rotProgress,e),this.player.setRotation(e)}},e.prototype.lerpMove=function(t){if(this.needTrans){this.transProgress+=t/this.transTotalTime,this.transProgress>1&&(this.transProgress=1,this.needTrans=!1);var e=new Vector3;Vector3.lerp(this.leftPos,this._targetPos,this.transProgress,e),this.player.setPostion(e)}},e}(Laya.Script),EGetRewardType;!function(t){t[t.NONE=0]="NONE",t[t.video=1]="video",t[t.shareAndVideo=2]="shareAndVideo",t[t.share=3]="share"}(EGetRewardType||(EGetRewardType={}));var ConfigUtility=function(){function t(){}return Object.defineProperty(t,"userAvatar",{get:function(){return this.userInfo?this.userInfo.avatarUrl:this.defaultAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(t,"userNickName",{get:function(){return this.userInfo?this.userInfo.nickName:this.defaultName},enumerable:!0,configurable:!0}),Object.defineProperty(t,"userGender",{get:function(){return this.userInfo?this.userInfo.gender:EGenderType.BOY},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isAuthorization",{get:function(){return null!=this.userInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsSafeVersion",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isGM",{get:function(){return"owtvW5Ts1_8_oqE4kgItmGhWccHM"==t.openId},enumerable:!0,configurable:!0}),t.gameID=5086,t.gamePath="hdyfk",t.gameVersion="0.0.9",t.resVersion="2",t.versionName="version_"+t.gameVersion+".json",t.baseUrl="",t.versionUrl="https://file.xiaohuaiyule.com/xyx/qiuqiu/"+t.versionName,t.TuDo_versionUrl="https:../../../https@xcxapi-hyh.715083.com/open/data/config.json@key=crowdcity_"+t.gameVersion,t.configPrefix=t.baseUrl+"config/",t.configURL=t.configPrefix+"config.json",t.LevelConfigURL=t.configPrefix+"blackhole.json",t.BuildConfigURL=t.configPrefix+"build.json",t.SkinConfigURL=t.configPrefix+"skin.json",t.ActivityConfigURL=t.configPrefix+"activity.json",t.LuckyBagConfigURL=t.configPrefix+"luckybag.json",t.ItemConfigURL=t.configPrefix+"item.json",t.FriendHelpRewardConfigURL=t.configPrefix+"friendhelp.json",t.LotteryConfigURL=t.configPrefix+"disk.json",t.SeasonConfigURL=t.configPrefix+"season.json",t.SettlementConfigURL=t.configPrefix+"settlement.json",t.SignConfigURL=t.configPrefix+"sign.json",t.MailConfigURL=t.configPrefix+"mail.json",t.SceneConfigURL=t.configPrefix+"scene.json",t.MessageConfigURL=t.configPrefix+"message1.json",t.MysteriousBagCfgURL=t.configPrefix+"mysteriousbag.json",t.testNum="1",t.openId="",t.openLevel="",t.serverUrl="https://ball.xiaohuaiyule.com",t.socketUrl="jiaxin1.xiaohuaiyule.com",t.defaultAvatar="res/ui/avatar/unknow.png",t.defaultName="游客",t.localAtlas=new Array("res/atlas/loading.atlas"),t.homeNeedAtlas=new Array(t.baseUrl+"res/atlas/res/ui/home.atlas",t.baseUrl+"res/atlas/res/ui/common.atlas",t.baseUrl+"res/atlas/res/ui/avatar.atlas",t.baseUrl+"res/atlas/res/skinUI.atlas",t.baseUrl+"res/atlas/res/ui/rank.atlas",t.baseUrl+"res/atlas/res/ui/pipei.atlas",t.baseUrl+"res/atlas/res/ui/game.atlas",t.baseUrl+"res/atlas/res/ui/guide.atlas",t.baseUrl+"res/atlas/res/ui/gameover.atlas",t.baseUrl+"res/atlas/res/ui/activity.atlas",t.baseUrl+"res/atlas/res/ui/skin.atlas",t.baseUrl+"res/atlas/res/ui/lottery.atlas",t.baseUrl+"res/atlas/res/ui/mail.atlas",t.baseUrl+"res/atlas/res/ui/login.atlas",t.baseUrl+"res/atlas/res/ui/effect/kaishi.atlas",t.baseUrl+"res/atlas/res/ui/effect/pifu.atlas",t.baseUrl+"res/atlas/res/ui/novicePrivilege.atlas",t.baseUrl+"res/atlas/res/ui/invite.atlas",t.baseUrl+"res/atlas/res/ui/TeamPlay.atlas"),t.configs=new Array(t.configURL,t.LevelConfigURL,t.BuildConfigURL,t.SkinConfigURL,t.ActivityConfigURL,t.ItemConfigURL,t.LotteryConfigURL,t.SeasonConfigURL,t.SettlementConfigURL,t.SignConfigURL,t.LuckyBagConfigURL,t.MailConfigURL,t.SceneConfigURL,t.FriendHelpRewardConfigURL,t.MessageConfigURL,t.MysteriousBagCfgURL),t.isShowADInGame=!1,t.isShowHowToPlayVideo=!1,t.shareSucCountEnoughToShowVideo=!1,t.canShareShiwan=!1,t.newPlayerFirstEnterGameShowLoginReward=!1,t.newPlayerFirstOnlyShowStart=!1,t.showClickLuckyBoxView=!1,t.seeVideoErrorToShowShare=!1,t.openRefreshAd=!1,t.getRewardType=EGetRewardType.video,t.openShareOther=!1,t.ResetOpen=!1,t.LuckyBoxNum=5,t}(),ShareInfoConfig=function(){function t(){}return t.requestShareImageInfo=function(){},t.completeHandler=function(t){},t.getShareInfo=function(){var e=Math.floor(Math.random()*this.array.length);return t.array[e]},t.array=[{title:"推荐一款非常好玩的游戏，只需动动手指就变得大大大！根本停不下来！",imageUrl:ConfigUtility.baseUrl+"res/shareUI/share1.jpg",query:""},{title:"我控制球球可以碾压一座城！你也一起来碾压一切吧！",imageUrl:ConfigUtility.baseUrl+"res/shareUI/share2.jpg",query:""},{title:"报告长官！发现一枚机械球球，碾压之势无法阻挡~请求增援！",imageUrl:ConfigUtility.baseUrl+"res/shareUI/share3.jpg",query:""},{title:"火球降临，碾压万物生灵涂炭，快来拯救苍生吧！",imageUrl:ConfigUtility.baseUrl+"res/shareUI/share4.jpg"},{title:"我马上就能领取免费皮肤了，快来帮帮我，就点一下~",imageUrl:ConfigUtility.baseUrl+"res/shareUI/share4.jpg",query:""}],t}(),EChatType,EGenderType;!function(t){t[t.WORLD=1]="WORLD",t[t.TEAM=2]="TEAM",t[t.SYSTEM=3]="SYSTEM"}(EChatType||(EChatType={})),function(t){t[t.BOY=1]="BOY",t[t.GIRL=2]="GIRL",t[t.MINE=3]="MINE"}(EGenderType||(EGenderType={}));var MainSocket=function(){function t(){}return t.init=function(){SocketConnection.mainSocket.addEventListener(GameSocket.SOCKET_OPEN,this,this.onMainSocketConnect),SocketConnection.mainSocket.addEventListener(GameSocket.SOCKET_CLOSE,this,this.onSocketClose),SocketConnection.mainSocket.addEventListener(GameSocket.SOCKET_ERROR,this,this.onSocketError),SocketConnection.mainSocket.addEventListener(GameSocket.SOCKET_TIME_OUT,this,this.onSocketTimeOut),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_SYNC_TIME),this,this.on_S2C_SYNC_TIME),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_LOGIN),this,this.on_S2C_LOGIN),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_START_MATCH),this,this.on_S2C_START_MATCH),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_LOAD_FINISH_READY),this,this.on_S2C_LOAD_FINISH_READY),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_START_GAME),this,this.on_S2C_START_GAME),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_SYNC_EAT_BUILDING),this,this.on_S2C_SYNC_EAT_BUILDING),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_EAT_BUILDING_FAIL),this,this.on_S2C_EAT_BUILDING_FAIL),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_SYNC_GAME_INFO),this,this.on_S2C_SYNC_GAME_INFO),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_SYNC_QUALITY),this,this.on_S2C_SYNC_QUALITY),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_SYNC_KILL_PLAYER),this,this.on_S2C_SYNC_KILL_PLAYER),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_EXIT_GAME),this,this.on_S2C_EXIT_GAME),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_CHANGE_ROOM_MASTER),this,this.on_S2C_CHANGE_ROOM_MASTER),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_GAME_OVER),this,this.on_S2C_GAME_OVER),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_SYNC_GAME_COUNT_DOWN_TIME),this,this.on_S2C_SYNC_GAME_COUNT_DOWN_TIME),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_CREATE_TEAM),this,this.on_S2C_CREATE_TEAM),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_KICK_OUT_TEAM_MEMBER),this,this.on_S2C_KICK_OUT_TEAM_MEMBER),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_SELF_JOIN_TEAM),this,this.on_S2C_SELF_JOIN_TEAM),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_OTHER_JOIN_TEAM),this,this.on_S2C_OTHER_JOIN_TEAM),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_LEAVE_TEAM),this,this.on_S2C_LEAVE_TEAM),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_UPDATE_TEAM_MEMBER_STATE),this,this.on_S2C_UPDATE_TEAM_MEMBER_STATE),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_TEAM_MASTER_START_MATCH),this,this.on_S2C_TEAM_MASTER_START_MATCH),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_GIFT_BAG_BOMB),this,this.on_S2C_GIFT_BAG_BOMB),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_CHAT),this,this.on_S2C_CHAT),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_COMMON_TIP),this,this.on_S2C_COMMON_TIP),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_SYNC_PICK_UP_GIFT_BAG),this,this.on_S2C_SYNC_PICK_UP_GIFT_BAG),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_RECONNECT_ENTER_TEAM),this,this.on_S2C_RECONNECT_ENTER_TEAM),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_TEAM_START_AUTO_MATCH),this,this.on_S2C_TEAM_START_AUTO_MATCH),SocketConnection.addCmdListener(createCmdType(EnumKey.S2C_TEAM_CANCEL_AUTO_MATCH),this,this.on_S2C_TEAM_CANCEL_AUTO_MATCH)},t.onSocketClose=function(t){Laya.timer.clear(this,this.C2S_SYNC_TIME),GameDataManager.gameState==EGameState.InGame&&(GameView.ins.exitView.on_exit(),NoticeView.instance.show(["网络出错，已回到组队界面"]),WXUtility.aldSendEvent("游戏中断线",{}))},t.onSocketError=function(t){NoticeView.instance.show(["连接服务器失败，请重启游戏"]),WXUtility.hideLoading(),Laya.timer.clear(this,this.C2S_SYNC_TIME)},t.onSocketTimeOut=function(t){NoticeView.instance.show(["连接服务器超时，请重启游戏"]),WXUtility.hideLoading(),Laya.timer.clear(this,this.C2S_SYNC_TIME)},t.connectServer=function(){GameManager.isOpenOnline&&(HoleAppController.isLoginSever?ConfigUtility.socketUrl?SocketConnection.mainSocket.connected||(SocketConnection.mainSocket.connect(ConfigUtility.socketUrl),this.isFirstConnectSocket||(this.isFirstConnectSocket=!1,WXUtility.showLoading("网络连接中..."))):console.error("socket地址错误：url=",ConfigUtility.socketUrl):NoticeView.instance.show(["未连接上服务器，请检测您的网络"]))},t.disConnectServer=function(){SocketConnection.mainSocket.connected&&SocketConnection.mainSocket.socketClose()},t.onMainSocketConnect=function(t){void 0===t&&(t=null),console.log("socket连接成功"),WXUtility.hideLoading(),this.C2S_LOGIN(),Laya.timer.loop(4e3,this,this.C2S_SYNC_TIME)},t.C2S_SYNC_TIME=function(){SocketConnection.send(createCmdType(EnumKey.C2S_SYNC_TIME))},t.C2S_LOGIN=function(){console.log("C2S : ","开始请求登陆","access_token：",MiNi.miniHttpServer.access_token);var t=new ByteBuffer(ByteArray.BIG_ENDIAN);t.writeUTF(MiNi.miniHttpServer.access_token),SocketConnection.send(createCmdType(EnumKey.C2S_LOGIN),t)},t.C2S_START_MATCH=function(){if(!SocketConnection.mainSocket.connected)return NoticeView.instance.show(["正在尝试重新连接服务器"]),void this.connectServer();console.log("C2S : ","开始请求匹配");var t=new ByteBuffer(ByteArray.BIG_ENDIAN);t.writeVarint32(SkinManager.TheCurUseSkinID),SocketConnection.send(createCmdType(EnumKey.C2S_START_MATCH),t)},t.C2S_LOAD_FINISH_READY=function(){console.log("C2S : 已经完成加载，随时可以进入游戏"),SocketConnection.send(createCmdType(EnumKey.C2S_LOAD_FINISH_READY))},t.C2S_SYNC_EAT_BUILDING=function(t,e){if(GameDataManager.gameState==EGameState.InGame&&0!=e.length){var i=new ByteBuffer(ByteArray.BIG_ENDIAN);i.writeVarint32(t),i.writeVarint32(e.length);for(var n=0;n<e.length;n++)i.writeVarint32(e[n]);SocketConnection.send(createCmdType(EnumKey.C2S_SYNC_EAT_BUILDING),i),DetectManager.Instance.allTmpID=new Array}},t.C2S_EXIT_GAME=function(){console.log("C2S : ","请求离开游戏了"),SocketConnection.send(createCmdType(EnumKey.C2S_EXIT_GAME))},t.C2S_SYNC_GAME_INFO=function(t,e,i,n){DebugView.isPrintLog&&console.log("C2S : ","发送游戏信息",{index:t,x:e,z:i,weight:n});var r=new ByteBuffer(ByteArray.BIG_ENDIAN);r.writeVarint32(t),r.writeVarint32(Math.floor(e*this.Precision)),r.writeVarint32(Math.floor(i*this.Precision)),r.writeVarint32(n),SocketConnection.send(createCmdType(EnumKey.C2S_SYNC_GAME_INFO),r)},t.C2S_SYNC_QUALITY=function(t,e){if(GameDataManager.gameState==EGameState.InGame){var i=new ByteBuffer(ByteArray.BIG_ENDIAN);i.writeVarint32(t),i.writeVarint32(e),SocketConnection.send(createCmdType(EnumKey.C2S_SYNC_QUALITY),i)}},t.C2S_SYNC_KILL_PLAYER=function(t,e){var i=new ByteBuffer(ByteArray.BIG_ENDIAN);i.writeVarint32(t),i.writeVarint32(e),SocketConnection.send(createCmdType(EnumKey.C2S_SYNC_KILL_PLAYER),i),console.log("C2S","kill:",t,"dead:",e)},t.C2S_CREATE_TEAM=function(){if(!SocketConnection.mainSocket.connected)return NoticeView.instance.show(["正在尝试重新连接服务器"]),void this.connectServer();SocketConnection.send(createCmdType(EnumKey.C2S_CREATE_TEAM)),console.log("C2S 已经发送创建队伍消息")},t.C2S_JOIN_TEAM=function(t){var e=new ByteBuffer(ByteArray.BIG_ENDIAN);e.writeVarint32(t),SocketConnection.send(createCmdType(EnumKey.C2S_JOIN_TEAM),e),console.log("C2S 已经发送加入队伍消息：",t)},t.C2S_LEAVE_TEAM=function(){SocketConnection.send(createCmdType(EnumKey.C2S_LEAVE_TEAM)),console.log("C2S 已经发送离开队伍消息")},t.C2S_KICK_OUT_TEAM_MEMBER=function(t){var e=new ByteBuffer(ByteArray.BIG_ENDIAN);e.writeUTF(t),SocketConnection.send(createCmdType(EnumKey.C2S_KICK_OUT_TEAM_MEMBER),e),console.log("C2S 已经发送踢出某队员的消息,openId:",t)},t.C2S_TEAM_START_MATCH_GAME=function(){this.C2S_START_MATCH()},t.C2S_TEAM_START_OR_CANCEL_READY=function(t){var e=new ByteBuffer(ByteArray.BIG_ENDIAN);e.writeVarint32(t),SocketConnection.send(createCmdType(EnumKey.C2S_TEAM_START_OR_CANCEL_READY),e)},t.C2S_CHAT=function(t,e){var i=new ByteBuffer(ByteArray.BIG_ENDIAN);i.writeVarint32(t),i.writeVarint32(e),SocketConnection.send(createCmdType(EnumKey.C2S_CHAT),i)},t.C2S_SYNC_PICK_UP_GIFT_BAG=function(t,e){var i=new ByteBuffer(ByteArray.BIG_ENDIAN);i.writeVarint32(t),i.writeVarint32(e),SocketConnection.send(createCmdType(EnumKey.C2S_SYNC_PICK_UP_GIFT_BAG),i)},t.on_S2C_LOGIN=function(e){if(console.log("S2C 登陆成功"),this.isLoginSocket=!0,GameDataManager.gameState!=EGameState.InGame){var i=void 0,n=void 0;GameDataManager.query&&(i=Number(GameDataManager.query.teamId),n=String(GameDataManager.query.openId)),i&&!isNaN(i)&&(t.C2S_JOIN_TEAM(i),console.log("接受到分享参数 openId：",n,"teamId:",i),GameDataManager.query=null)}},t.on_S2C_START_MATCH=function(t){console.log("接受到匹配到的数据");var e=0,i=t.readVarint32();GameManager.sceneId=i;var n=t.readVarint32();GameManager.masterRoomIndex=n,t.readVarint32();var r=t.readVarint32();if(GameDataManager.onlineMatchData=new Array,!isNaN(r)&&r>0)for(_=0;_<r;_++){var a=t.readUTF(),s=t.readUTF(),o=t.readUTF(),l=t.readVarint32(),h=t.readVarint32(),c=t.readVarint32(),u={openId:a,nickName:s,avatarUrl:o,skinId:l,score:h,roomIndex:c,x:t.readVarint32(),z:t.readVarint32()};GameDataManager.onlineMatchData.push(u),""==a?(u.avatarUrl="res/ui/avatar/"+u.avatarUrl+".png",HelperExtension.coinTest(.5)&&(e+=1e3*HelperExtension.random(0,2)),Laya.timer.once(e,MatchView.Instance,MatchView.Instance.onSetAvatar_online,[c,_],!1)):a==ConfigUtility.openId&&(GameDataManager.onlineLocalData=u,u.roomIndex==n?GameManager.isMaster=!0:GameManager.isMaster=!1)}console.log("匹配到的数据：",r+"人, 详细数据：",GameDataManager.onlineMatchData);for(var _=0;_<GameDataManager.onlineMatchData.length;_++)GameDataManager.onlineMatchData[_].roomIndex==n&&console.log("Master 是",GameDataManager.onlineMatchData[_].nickName);GameDataManager.isGetMatchData=!0},t.on_S2C_LOAD_FINISH_READY=function(t){for(var e=t.readVarint32(),i=GameDataManager.onlineMatchData.length;i--;)if(GameDataManager.onlineMatchData[i].roomIndex==e){console.log("S2C 玩家：[",e,GameDataManager.onlineMatchData[i].nickName,"] 游戏加载完成");break}MatchView.Instance.onSetAvatar_online(e,i)},t.on_S2C_START_GAME=function(t){var e=t.readVarint32();e>0&&(GameManager.onlineGameTotalTime=e),console.log("S2C 游戏开始 : ",e),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_game_start_online)},t.on_S2C_SYNC_EAT_BUILDING=function(t){t.readVarint32();for(var e=t.readVarint32();e>0;){var i=t.readVarint32();DetectManager.Instance.remove_model_by_id(i),e--}},t.on_S2C_EAT_BUILDING_FAIL=function(t){},t.on_S2C_SYNC_TIME=function(t){},t.on_S2C_SYNC_GAME_INFO=function(t){var e=t.readVarint32(),i=t.readVarint32()/this.Precision,n=t.readVarint32()/this.Precision,r=t.readVarint32();DebugView.isPrintLog&&console.log("S2C : ","接收到的游戏信息",{index:e,x:i,z:n,weight:r}),OtherPlayerManager.SetRemoteData(e,i,n,r)},t.on_S2C_SYNC_QUALITY=function(t){var e={roomIndex:t.readVarint32(),weight:t.readVarint32()};OtherPlayerManager.SetRemoteWeight(e)},t.on_S2C_SYNC_KILL_PLAYER=function(t){var e=t.readVarint32(),i=t.readVarint32();OtherPlayerManager.SyncRemoteBroadcast(e,i);for(var n,r,a=0;a<GameDataManager.onlineMatchData.length;a++)GameDataManager.onlineMatchData[a].roomIndex==e?n=GameDataManager.onlineMatchData[a]:GameDataManager.onlineMatchData[a].roomIndex==i&&(r=GameDataManager.onlineMatchData[a]);console.log("S2C 接收到击杀广播",n.nickName,"击杀了",r.nickName)},t.on_S2C_EXIT_GAME=function(t){var e=t.readVarint32();OtherPlayerManager.SyncRemoteExitGame(e),console.log("S2C 有人离开游戏了：",e)},t.on_S2C_CHANGE_ROOM_MASTER=function(t){var e=t.readVarint32();OtherPlayerManager.SyncSwicthMaster(e)},t.on_S2C_GAME_OVER=function(t){GameDataManager.gameState==EGameState.InGame&&(console.log("S2C 强制游戏结束"),Scene3DController.Scene3DView.gameView&&Scene3DController.Scene3DView.gameView.on_time_up())},t.on_S2C_SYNC_GAME_COUNT_DOWN_TIME=function(t){var e=t.readVarint32();Scene3DController.Scene3DView.gameView&&(Scene3DController.Scene3DView.gameView.game_countdown=e,console.log("S2C 同步游戏倒计时时间",e))},t.on_S2C_CREATE_TEAM=function(t){var e=t.readVarint32();TeamManager.teamId=e,TeamManager.teamMasterOpenID=ConfigUtility.openId;var i=new TeamPlayer;i.index=0,i.state=ETeamPlayerState.READY,i.avatarUrl=ConfigUtility.userAvatar,i.nickName=ConfigUtility.userNickName,i.score=SyncDataManager.score,i.openId=ConfigUtility.openId,i.gender=ConfigUtility.userGender,TeamManager.push_team_player(i),console.log("S2C 收到创建队伍消息",e)},t.on_S2C_KICK_OUT_TEAM_MEMBER=function(t){var e=t.readUTF();if(e==ConfigUtility.openId)NoticeView.instance.show(["您已经被请出队伍"]),GameDataManager.gameState==EGameState.InTeamPlay&&(TeamPlayView.instance.onHide(),HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME)),TeamManager.clearAll();else{var i=TeamManager.get_team_player(e);i&&(TeamPlayView.instance.addSystemMessage("系统消息","玩家["+i.nickName+"]被请出了队伍",EChatType.SYSTEM),i=null),TeamManager.remove_team_player(e)}console.log("S2C 接收到某人被踢出信息:",e)},t.on_S2C_SELF_JOIN_TEAM=function(t){TeamManager.clearAll(),TeamManager.teamId=t.readVarint32(),TeamManager.teamMasterOpenID=t.readUTF();for(var e=t.readVarint32(),i=0;i<e;i++){var n=new TeamPlayer;n.index=t.readVarint32(),n.state=t.readVarint32(),n.score=t.readVarint32(),n.openId=t.readUTF(),n.nickName=t.readUTF(),n.avatarUrl=t.readUTF(),n.gender=t.readVarint32(),""==n.avatarUrl&&(n.nickName=ConfigUtility.defaultName,n.avatarUrl=ConfigUtility.defaultAvatar),TeamManager.push_team_player(n)}var r=new TeamPlayer;r.index=t.readVarint32(),r.state=ETeamPlayerState.NOT_READY,r.avatarUrl=ConfigUtility.userAvatar,r.nickName=ConfigUtility.userNickName,r.score=SyncDataManager.score,r.openId=ConfigUtility.openId,r.gender=ConfigUtility.userGender,TeamManager.push_team_player(r),GameDataManager.gameState!=EGameState.InTeamPlay&&(TeamPlayView.instance.onShow(),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.HOME)),console.log("S2C 接收到队伍信息 self:",TeamManager.teamPlayerListData)},t.on_S2C_OTHER_JOIN_TEAM=function(t){var e=new TeamPlayer;e.index=t.readVarint32(),e.state=t.readVarint32(),e.score=t.readVarint32(),e.openId=t.readUTF(),e.nickName=t.readUTF(),e.avatarUrl=t.readUTF(),e.gender=t.readVarint32(),TeamManager.push_team_player(e),TeamPlayView.instance.addSystemMessage("系统消息","玩家["+e.nickName+"]加入了队伍",EChatType.SYSTEM),console.log("S2C 接收到某人信息 other:",e)},t.on_S2C_LEAVE_TEAM=function(t){var e=t.readUTF();if(TeamManager.teamMasterOpenID=t.readUTF(),e==ConfigUtility.openId)TeamManager.clearAll();else{var i=TeamManager.get_team_player(e);i&&(TeamPlayView.instance.addSystemMessage("系统消息","玩家["+i.nickName+"]离开了队伍",EChatType.SYSTEM),i=null),TeamManager.remove_team_player(e)}console.log("S2C 接收到某人离开队伍消息")},t.on_S2C_UPDATE_TEAM_MEMBER_STATE=function(t){var e=t.readUTF(),i=t.readVarint32();TeamManager.update_team_player_state(e,i)},t.on_S2C_TEAM_MASTER_START_MATCH=function(t){GameDataManager.gameState!=EGameState.InMatch&&(GameDataManager.gameState==EGameState.InTeamPlay&&TeamPlayView.instance.onHide(),HomeView.Ins.startGame())},t.on_S2C_GIFT_BAG_BOMB=function(t){if(GameDataManager.gameState==EGameState.InGame){NoticeView.instance.show(["四周出现了一批神秘宝箱~"]);for(var e=t.readVarint32(),i=0;i<e;i++){var n=t.readVarint32(),r=t.readVarint32(),a=t.readVarint32()/100,s=t.readVarint32()/100;LiheManagaer.SpawnMysteriousBag(n,r,a,s)}}},t.on_S2C_CHAT=function(t){var e=t.readVarint32(),i=t.readVarint32(),n=t.readUTF();TeamPlayView.instance.on_S2C_CHAT(n,i,e)},t.on_S2C_COMMON_TIP=function(t){var e=t.readVarint32(),i=MessageConfig.instance.allMessage.get(e);i&&NoticeView.instance.show([i.message])},t.on_S2C_SYNC_PICK_UP_GIFT_BAG=function(t){var e=t.readVarint32(),i=t.readVarint32();OtherPlayerManager.SyncPickUpGiftBag(i,e)},t.on_S2C_RECONNECT_ENTER_TEAM=function(t){TeamManager.clearAll();var e=t.readVarint32(),i=t.readUTF();TeamManager.teamId=e,TeamManager.teamMasterOpenID=i;for(var n=t.readVarint32(),r=0;r<n;r++){var a=new TeamPlayer;a.index=t.readVarint32(),a.state=t.readVarint32(),a.score=t.readVarint32(),a.openId=t.readUTF(),a.nickName=t.readUTF(),a.avatarUrl=t.readUTF(),a.gender=t.readVarint32(),""==a.avatarUrl&&(a.nickName=ConfigUtility.defaultName,a.avatarUrl=ConfigUtility.defaultAvatar),TeamManager.push_team_player(a)}GameDataManager.gameState!=EGameState.InTeamPlay&&GameDataManager.gameState!=EGameState.InGame&&GameDataManager.gameState!=EGameState.GameOverOrExitGame&&(TeamPlayView.instance.onShow(),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.HOME))},t.on_S2C_TEAM_START_AUTO_MATCH=function(t){var e=t.readVarint32();TeamManager.auto_startGame(e),console.log("on_S2C_TEAM_START_AUTO_MATCH",e)},t.on_S2C_TEAM_CANCEL_AUTO_MATCH=function(t){TeamManager.clear_auto_startGame(),console.log("on_S2C_TEAM_CANCEL_AUTO_MATCH")},t.test=function(){},t.Precision=100,t.isLoginSocket=!1,t.isFirstConnectSocket=!0,t}(),WXUtility=function(){function t(){}return t.createGameClubButton=function(e,i,n,r,a){if(void 0===a&&(a=!0),Laya.Browser.onWeiXin){if(a){var s=t.sysWindowWidth/t.designWidth;e*=s,i*=s,n*=s,r*=s}wx.createGameClubButton({type:"image",icon:"green",style:{left:e,top:i,width:n,height:r}})}},t.init=function(e,i,n){if(t.isWX=e,t.designWidth=i,t.designHeight=n,e){wx.showShareMenu(),wx.updateShareMenu({withShareTicket:!0});var r=wx.getSystemInfoSync();t.systemInfo=r,t.sysWindowWidth=r.windowWidth,t.sysWindowHeight=r.windowHeight,t.getSetting();var a=new SetupInfo;a.servriceAddr=ConfigUtility.serverUrl,a.wx_appId="wx00bc7b4a1daec5fd",a.server_gameId=16,a.isServicePrint=!1,a.gameName="QiuQiu",a.systemInfo=r,a.sizeRect=new Laya.Rectangle(0,0,i,n),a.isWx=e,MiNi.setup(a),MiNi.miniHttpServer.login(),Configs.isPrint=!1}},t.onHide=function(t,e){Laya.Browser.onWeiXin&&wx.onHide&&wx.onHide(function(){e.call(t)})},t.createOpenSettingButton=function(e,i,n,r){if(Laya.Browser.onWeiXin){var a=t.sysWindowWidth/t.designWidth;return r.left*=a,r.top*=a,r.width*=a,r.height*=a,wx.createOpenSettingButton({type:e,text:i,image:n,style:r})}return null},t.authorize=function(t,e,i,n){Laya.Browser.onWeiXin&&wx.authorize({scope:t,success:function(){console.log("authorize success"),i.call(e)},fail:function(){console.log("authorize fail"),n.call(e)}})},t.getSetting=function(){Laya.Browser.onWeiXin&&wx.getSetting&&wx.getSetting({success:function(e){t.authSetting=e.authSetting,e&&e.authSetting&&e.authSetting["scope.userInfo"]&&wx.getUserInfo({success:function(t){ConfigUtility.userInfo=t.userInfo,EventManager.dispatchEvent(EnumKey.GET_USER_INFO)}}),t.authSetting.hasOwnProperty(t.SCOPE_WRITE_PHOTOS_ALBUM)&&console.log("wx getSetting success: "+t.authSetting[t.SCOPE_WRITE_PHOTOS_ALBUM])},fail:function(){console.log("wx getSetting fail")}})},t.saveImageToPhotosAlbum=function(t,e,i,n){Laya.Browser.onWeiXin&&wx.saveImageToPhotosAlbum({filePath:t,success:function(){console.log("saveImageToPhotosAlbum success"),i.call(e)},fail:function(t){console.log("saveImageToPhotosAlbum fail"),n.call(e,t)}})},t.onShareAppMessage=function(t,e){Laya.Browser.onWeiXin&&wx.aldOnShareAppMessage(function(){return{title:t,imageUrl:e,query:"play"}})},t.showLoading=function(e,i){void 0===e&&(e=""),void 0===i&&(i=!0),Laya.Browser.onWeiXin&&(t.isShowingLoading=!0,wx.showLoading({title:e,mask:i}))},t.hideLoading=function(){Laya.Browser.onWeiXin&&t.isShowingLoading&&(wx.hideLoading(),t.isShowingLoading=!1)},t.login=function(t){Laya.Browser.onWeiXin&&wx.login(t)},t.showToast=function(t){Laya.Browser.onWeiXin&&wx.showToast({title:t})},t.getShareInfo=function(t){if(Laya.Browser.onWeiXin)return wx.getUserInfo(t)},t.vibrateShort=function(t,e,i){this.isWX&&AudioController.ShakeState&&wx.vibrateShort({success:t,fail:e,compelete:i})},t.vibrateLong=function(t,e,i){this.isWX&&AudioController.ShakeState&&wx.vibrateLong({success:t,fail:e,compelete:i})},t.aldSendEvent=function(t,e){Browser.onWeiXin&&wx.aldSendEvent&&wx.aldSendEvent(t,e)},t.pointForNew=function(e,i,n){GameDataManager.isNewPlayer&&GameDataManager.CanIPoint(i)&&t.aldSendEvent(e,n)},t.pointForNew_muti=function(e,i){GameDataManager.isNewPlayer&&t.aldSendEvent(e,i)},t.point_with_new=function(e,i,n,r,a){void 0===i&&(i={}),void 0===r&&(r=!0),void 0===a&&(a=!0),a&&(r?t.pointForNew_muti("*"+e,i):t.pointForNew("*"+e,n,i)),t.aldSendEvent(e,i)},t.SCOPE_USER_INFO="scope.userInfo",t.SCOPE_WRITE_PHOTOS_ALBUM="scope.writePhotosAlbum",t.SCOPE_ADRESS="scope.address",t.SCOPE_CAMERA="scope.camera",t.closeBtnBottom=85,t}(),ENewPointTpye;!function(t){t[t.ENTER_HOME=100]="ENTER_HOME",t[t.HOME_START_GAME=101]="HOME_START_GAME",t[t.CG_SHIWAN_START_GAME=102]="CG_SHIWAN_START_GAME",t[t.SHIWAN_START_GAME=103]="SHIWAN_START_GAME",t[t.ENTER_MATCH=104]="ENTER_MATCH",t[t.ENTER_GAME_321=105]="ENTER_GAME_321",t[t.GAME_PLAYTIME_OVER_30=106]="GAME_PLAYTIME_OVER_30",t[t.GAME_PLAYTIME_OVER_90=107]="GAME_PLAYTIME_OVER_90",t[t.GAME_OVER_CLASSIC=108]="GAME_OVER_CLASSIC",t[t.CLASSIC_OVER_VIDEO_3BEI=109]="CLASSIC_OVER_VIDEO_3BEI",t[t.CLASSIC_OVER_SHARE_3BEI=110]="CLASSIC_OVER_SHARE_3BEI",t[t.CLASSIC_BACKWARD=111]="CLASSIC_BACKWARD",t[t.ENTER_LOGIN=112]="ENTER_LOGIN",t[t.ENTER_LOTTERY=113]="ENTER_LOTTERY",t[t.KILL_NUM=114]="KILL_NUM",t[t.UPGRAD_TO_2=115]="UPGRAD_TO_2",t[t.GROW_TO_2=116]="GROW_TO_2",t[t.RIGHT_POINT_EXIT=117]="RIGHT_POINT_EXIT",t[t.APP_RUNTIME_OVER_10=118]="APP_RUNTIME_OVER_10",t[t.APP_RUNTIME_OVER_30=119]="APP_RUNTIME_OVER_30",t[t.HOME_SHARE=120]="HOME_SHARE",t[t.HOME_FREESKIN=121]="HOME_FREESKIN",t[t.HOME_NOVICEPRIVILEGE=122]="HOME_NOVICEPRIVILEGE",t[t.HOME_SKIN=123]="HOME_SKIN",t[t.SKIN_STORE_SHIWAN=124]="SKIN_STORE_SHIWAN",t[t.HOME_LOTTERY=125]="HOME_LOTTERY",t[t.HOME_FREEGOLD=126]="HOME_FREEGOLD",t[t.CLASSIC_OVER_RESTART=127]="CLASSIC_OVER_RESTART",t[t.LOGINREWARD_SHARE_SUC=128]="LOGINREWARD_SHARE_SUC",t[t.SHIWAN_IN_A_BATCH=129]="SHIWAN_IN_A_BATCH",t[t.READY321_CHANGE_BIG_FREE=130]="READY321_CHANGE_BIG_FREE",t[t.READY321_CHANGE_BIG_SHARE=131]="READY321_CHANGE_BIG_SHARE",t[t.CLICK_GAME_MODE=132]="CLICK_GAME_MODE",t[t.TO_CLASSIC_MODE=133]="TO_CLASSIC_MODE",t[t.TO_SURVIVE_MODE=134]="TO_SURVIVE_MODE",t[t.ENTER_TEAM_VIEW=135]="ENTER_TEAM_VIEW",t[t.CLICK_TEAM_SHARE=136]="CLICK_TEAM_SHARE",t[t.CLICK_TEAM_READY=137]="CLICK_TEAM_READY",t[t.CLICK_QUICK=138]="CLICK_QUICK",t[t.QUICK_1=139]="QUICK_1",t[t.QUICK_2=140]="QUICK_2",t[t.QUICK_3=141]="QUICK_3",t[t.QUICK_4=142]="QUICK_4",t[t.QUICK_5=143]="QUICK_5",t[t.QUICK_6=144]="QUICK_6",t[t.CLICK_TEAM_BACK=145]="CLICK_TEAM_BACK",t[t.SURVIVE_START_GAME=146]="SURVIVE_START_GAME",t[t.SURVIVE_ENTER_MACTH=147]="SURVIVE_ENTER_MACTH",t[t.SURVIVE_ENTER_READY321=148]="SURVIVE_ENTER_READY321",t[t.SURVIVE_GAME_PLAYTIME_OVER_30=149]="SURVIVE_GAME_PLAYTIME_OVER_30",t[t.SURVIVE_ENTER_GAME_OVER=150]="SURVIVE_ENTER_GAME_OVER",t[t.SURVIVE_GAME_OVER_SHARE=151]="SURVIVE_GAME_OVER_SHARE",t[t.SURVIVE_GAME_OVER_VIDEO=152]="SURVIVE_GAME_OVER_VIDEO",t[t.SURVIVE_GAME_OVER_XUANYAO=153]="SURVIVE_GAME_OVER_XUANYAO",t[t.SURVIVE_GAME_OVER_BACK=154]="SURVIVE_GAME_OVER_BACK"}(ENewPointTpye||(ENewPointTpye={}));var MaterialUtility=function(){function t(){}return Object.defineProperty(t,"playerColors",{get:function(){return this._playerColors},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getSpawnColor",{get:function(){var t=this.playerColors.shift();return this.playerColors.push(t),new Laya.Vector4(t.elements[0],t.elements[1],t.elements[2],t.elements[3])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getSpawnMaterial",{get:function(){var t=new Laya.StandardMaterial;return t.albedo=this.getSpawnColor,t},enumerable:!0,configurable:!0}),t.getColorByIndex=function(t){return 0==this._playerColors.length?new Vector4(1,1,1,1):(t=(t=t<0?0:t)>=this._playerColors.length?0:t,this._playerColors[t].clone())},t._playerColors=new Array(new Laya.Vector4(0,1,0,1),new Laya.Vector4(1,0,0,1),new Laya.Vector4(0,0,1,1),new Laya.Vector4(1,1,0,1),new Laya.Vector4(1,0,1,1),new Laya.Vector4(0,1,1,1),new Laya.Vector4(.5,.5,0,1),new Laya.Vector4(.5,0,.5,1),new Laya.Vector4(1,.25,0,1),new Laya.Vector4(0,.5,0,1),new Laya.Vector4(1,1,1,1)),t}(),MouseUtility=function(){function t(){}return Object.defineProperty(t,"sensitivity",{get:function(){return GameSetting.instance.hasProperty("sensitivity")?GameSetting.instance.config.sensitivity:this._sensitivity},enumerable:!0,configurable:!0}),Object.defineProperty(t,"damping",{get:function(){return GameSetting.instance.hasProperty("damping")?GameSetting.instance.config.damping:this._damping},enumerable:!0,configurable:!0}),Object.defineProperty(t,"equalPrecision",{get:function(){return GameSetting.instance.hasProperty("equalPrecision")?GameSetting.instance.config.equalPrecision:1e-4},enumerable:!0,configurable:!0}),Object.defineProperty(t,"maxFilter",{get:function(){return GameSetting.instance.hasProperty("maxFilter")?GameSetting.instance.config.maxFilter:2.5},enumerable:!0,configurable:!0}),t._sensitivity=new Laya.Vector2(1,1),t._damping=new Laya.Vector2(20,20),t}(),CameraUtility=function(){function t(){var t=this;this.OffsetX=0,this.OffsetY=0,this.OffsetZ=0,this.offsetFOV=0,this.offsetAngleX=0,GameManager.EventManagerEx.AddListener(EventSetting.on_exit_game,new EventListener(function(){t.OffsetX=0,t.OffsetY=0,t.OffsetZ=0,t.offsetFOV=0,t.offsetAngleX=0}.bind(this)))}return Object.defineProperty(t.prototype,"initCameraOffX",{get:function(){return GameSetting.instance.hasProperty("initCameraOffX")?GameSetting.instance.config.initCameraOffX:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initCameraOffY",{get:function(){return GameSetting.instance.hasProperty("initCameraOffY")?GameSetting.instance.config.initCameraOffY:14.6},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initCameraOffZ",{get:function(){return GameSetting.instance.hasProperty("initCameraOffZ")?GameSetting.instance.config.initCameraOffZ:9.4},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initCameraFOV",{get:function(){return GameSetting.instance.hasProperty("initCameraFOV")?GameSetting.instance.config.initCameraFOV:60},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initCameraAngleX",{get:function(){return GameSetting.instance.hasProperty("initCameraAngleX")?GameSetting.instance.config.initCameraAngleX:-58},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offfsetDis",{get:function(){return Laya.Vector3.scalarLength(new Laya.Vector3(this.cameraOffsetX,this.cameraOffsetY,this.cameraOffsetZ))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraOffsetX",{get:function(){return this.initCameraOffX+this.OffsetX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraOffsetY",{get:function(){return this.initCameraOffY+this.OffsetY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraOffsetZ",{get:function(){return this.initCameraOffZ+this.OffsetZ},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraFOV",{get:function(){return this.initCameraFOV+this.offsetFOV},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraAngleX",{get:function(){return this.initCameraAngleX+this.offsetAngleX},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}(),ShareUtil=function(){function t(){}return Object.defineProperty(t,"CurShareSucCount",{get:function(){return this.curShareSucCount=Number(Laya.LocalStorage.getItem(EnumKey.SHARE_SUC_COUNT)),this.curShareSucCount||(this.curShareSucCount=0),this.curShareSucCount},set:function(t){this.curShareSucCount=t,Laya.LocalStorage.setItem(EnumKey.SHARE_SUC_COUNT,this.curShareSucCount+"")},enumerable:!0,configurable:!0}),t.setup=function(){Laya.Browser.onWeiXin},t.sharegame=function(t,e){if(Laya.Browser.onWeiXin){var i=this;wx.shareAppMessage({success:function(){i.onSharSuccess()}})}else this.onSharSuccess()},t.shareGameWithInfo=function(t){t.query&&""!=t.query?t.query+="&channel="+HoleAppController.channel+"&fission=yes":t.query="channel="+HoleAppController.channel+"&fission=yes",Laya.Browser.onWeiXin&&wx.aldShareAppMessage(t),Laya.Browser.onWeiXin&&SkinManager.setSkinData(EnumKey.SKIN_GET_CONDITION_3,1)},t.onSharSuccess=function(){},t.onShareFail=function(){},t.shareForGroupRank=function(e){var i=new ShareInfo;i.shareId=e,i.title="群里排第几，戳这里就知道，记住用力戳这里",i.imageUrl="res/image/share.jpg",i.query="op=rank",i.successFunc=new CallBackFunc(t,t.onSharGroupRankSuccess),i.failFunc=new CallBackFunc(t,t.onSharGroupRankFail),t.shareGameToGroup(i)},t.onSharGroupRankSuccess=function(t){t&&HoleContext.getInstance().event(HoleContext.SHOW_VIEW,[EViewType.RANK,t.shareTickets[0]])},t.onSharGroupRankFail=function(t){console.log("~~~~~~~~~~~~~~~~~~~分享失败",t)},t.shareGameByShareInfo=function(t){Laya.Browser.onWeiXin?wx.shareAppMessage({success:function(){t.successFunc&&t.successFunc.call()}}):t.successFunc&&t.successFunc.call()},t.shareGameToGroup=function(e){if(Browser.onWeiXin){var i={title:e.title,image:e.imageUrl};t._shareId=e.shareId,i.serial=e.shareId;var n=i;e.query&&(n.query+="&"+e.query),console.log("群分享的参数：",n),Laya.Browser.onWeiXin&&wx.aldShareAppMessage(n),t._shareInfo=e,Laya.Browser.onWeiXin&&SkinManager.setSkinData(EnumKey.SKIN_GET_CONDITION_3,1)}else e&&e.successFunc&&e.successFunc.call()},t.doSuccess=function(e){t._shareInfo&&(this.curDay=TimeUtil.getTimeStr(),this.lastDay=Laya.LocalStorage.getItem(EnumKey.LAST_CLICK_SHARE),this.lastDay==this.curDay?100*Math.random()<t.curRate?(t._shareInfo.doSuccess(e),this.CurShareSucCount+=1,t.curRate=GameSetting.instance.ShareOneSuccessrate,Laya.LocalStorage.setItem(EnumKey.SHARE_SUC_RATE,GameSetting.instance.ShareOneSuccessrate+""),console.log("当前成功率",t.curRate)):t.doFail():(t._shareInfo.doSuccess(e),this.CurShareSucCount+=1,t.curRate=GameSetting.instance.ShareOneSuccessrate,Laya.LocalStorage.setItem(EnumKey.SHARE_SUC_RATE,GameSetting.instance.ShareOneSuccessrate+""),Laya.LocalStorage.setItem(EnumKey.LAST_CLICK_SHARE,TimeUtil.getTimeStr()),console.log("当前成功率",t.curRate))),t.shareTime=0},t.doFail=function(e){switch(console.log("doFail"+e),t._shareInfo&&t._shareInfo.doFail(e),(t.curRate=Number(Laya.LocalStorage.getItem(EnumKey.SHARE_SUC_RATE)))||(t.curRate=100,Laya.LocalStorage.setItem(EnumKey.SHARE_SUC_RATE,"100")),t.curRate){case GameSetting.instance.ShareOneSuccessrate:t.curRate=GameSetting.instance.ShareTwoSuccessrate,Laya.LocalStorage.setItem(EnumKey.SHARE_SUC_RATE,GameSetting.instance.ShareTwoSuccessrate+""),console.log("当前成功率",t.curRate);break;case GameSetting.instance.ShareTwoSuccessrate:t.curRate=100,console.log("当前成功率",t.curRate),Laya.LocalStorage.setItem(EnumKey.SHARE_SUC_RATE,"100")}t.shareTime=0},t.onGetGidSuccess=function(t){console.log("群id:"+t),null!=t&&GameDataManager.isGroupShared(t)?this.doFail(EShareFailType.GROUP_REPEAT):(this.doSuccess(t),GameDataManager.addSharedGruop(t))},t.onGetGidFail=function(){this.doSuccess(null)},t.shareFailtips=function(){Math.random()>.5?NoticeView.instance.show(["发到群可邀请更多好友来协助你。"]):NoticeView.instance.show(["请不要频繁分享到同一个地方。"])},t.viewShareImage=function(t){},t._shareId=0,t.curRate=0,t.onSharGroupSuccess=function(e){var i="";e?void 0!=e.shareTickets?(i=e.shareTickets[0],t._shareInfo&&t._shareInfo.isNeedDiff?WxShareInfoParse.parse(i,new CallBackFunc(t,t.onGetGidSuccess),new CallBackFunc(t,t.onGetGidFail)):t.doSuccess(e)):(console.log("res.shareTickets 为空"),t.doFail(EShareFailType.NOT_GROUP)):(console.log("分享到群onSharGroupSuccess res 为空"),t.doFail(EShareFailType.NOT_GROUP))},t.onGroupShareFail=function(){traceLog("分享失败！"),t.doFail(EShareFailType.USER_CALCLE)},t}(),PlayerUtility=function(){function t(){}return t.setup=function(){this.innerMesh=new Laya.PlaneMesh(this.initHoleLength,this.initHoleLength),this.outerMesh=new Laya.PlaneMesh(this.initSkinLength,this.initSkinLength),this._playerSpawnPos[ESceneTag.CITY1]=new Array(new Laya.Vector2(58.5,30),new Laya.Vector2(55.5,30),new Laya.Vector2(52.5,30),new Laya.Vector2(55.5,27),new Laya.Vector2(52.5,27),new Laya.Vector2(-14.5,30),new Laya.Vector2(-17.5,30),new Laya.Vector2(-11.5,30),new Laya.Vector2(-11.5,27),new Laya.Vector2(-14.5,27),new Laya.Vector2(-17.5,110),new Laya.Vector2(-14.5,110),new Laya.Vector2(-11.5,110),new Laya.Vector2(-14.5,113),new Laya.Vector2(-11.5,113)),this._playerSpawnPos[ESceneTag.HAIDAO1]=new Array(new Laya.Vector2(38,75),new Laya.Vector2(38,78),new Laya.Vector2(38,81),new Laya.Vector2(35,75),new Laya.Vector2(35,78),new Laya.Vector2(77,-27),new Laya.Vector2(77,-24),new Laya.Vector2(77,-21),new Laya.Vector2(74,-27),new Laya.Vector2(74,-24),new Laya.Vector2(-98,-33),new Laya.Vector2(-98,-30),new Laya.Vector2(-98,-27),new Laya.Vector2(-101,-33),new Laya.Vector2(-101,-30)),this._liheSpawnPos[ESceneTag.CITY1]=new Array(new Laya.Vector2(55.5,37.5),new Laya.Vector2(-14.5,37.5),new Laya.Vector2(-14.5,102.5)),this._liheSpawnPos[ESceneTag.HAIDAO1]=new Array(new Laya.Vector2(-102,-26),new Laya.Vector2(76,-18),new Laya.Vector2(35,83))},Object.defineProperty(t,"PlayerFollowingTime",{get:function(){return GameSetting.instance.hasProperty("PlayerFollowingTime")?GameSetting.instance.config.PlayerFollowingTime:1e4},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PlayerEscapingTime",{get:function(){return GameSetting.instance.hasProperty("PlayerEscapingTime")?GameSetting.instance.config.PlayerEscapingTime:1e4},enumerable:!0,configurable:!0}),Object.defineProperty(t,"cdPlayerFollowTime",{get:function(){return GameSetting.instance.hasProperty("cdPlayerFollowTime")?GameSetting.instance.config.cdPlayerFollowTime:3e3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"cdPlayerEscapeTime",{get:function(){return GameSetting.instance.hasProperty("cdPlayerEscapeTime")?GameSetting.instance.config.cdPlayerEscapeTime:3e3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SimpleAIChance",{get:function(){return GameSetting.instance.hasProperty("SimpleAIChance")?GameSetting.instance.config.SimpleAIChance:.5},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HardAIChance",{get:function(){return GameSetting.instance.hasProperty("HardAIChance")?GameSetting.instance.config.HardAIChance:.6},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BTAIChance",{get:function(){return GameSetting.instance.hasProperty("BTAIChance")?GameSetting.instance.config.BTAIChance:.6},enumerable:!0,configurable:!0}),Object.defineProperty(t,"maxPlayers",{get:function(){return GameSetting.instance.hasProperty("maxPlayers")?GameSetting.instance.config.maxPlayers:15},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BuyReliveGold",{get:function(){return GameSetting.instance.hasProperty("BuyReliveGold")?GameSetting.instance.config.BuyReliveGold:100},enumerable:!0,configurable:!0}),Object.defineProperty(t,"playerSpawnPos",{get:function(){return this._playerSpawnPos[SceneManager.CurrentSceneTag]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getSpawnPos",{get:function(){var t=Math.floor(HelperExtension.random(0,this.playerSpawnPos.length-this.spawnPosTimes));this.spawnPosTimes==this.playerSpawnPos.length&&(this.spawnPosTimes=0),this.spawnPosTimes++;var e=this.playerSpawnPos.splice(t,1)[0];return this.playerSpawnPos.push(e),e.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getRelivePos",{get:function(){var t=Math.floor(HelperExtension.random(0,this.playerSpawnPos.length)),e=this.playerSpawnPos[t],i=HelperExtension.random(-10,10),n=HelperExtension.random(-10,10);return new Vector3(e.x+i,.5,e.y+n)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"liheSpawnPos",{get:function(){return this._liheSpawnPos[SceneManager.CurrentSceneTag]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getLiheRandomPos",{get:function(){var t=Math.floor(HelperExtension.random(0,this.liheSpawnPos.length)),e=this.liheSpawnPos[t];return new Vector3(e.x,.05,e.y)},enumerable:!0,configurable:!0}),t.initHoleLength=2,t.initSkinLength=6,t.posY=.2,t._playerSpawnPos=new Array,t.spawnPosTimes=0,t._liheSpawnPos=new Array,t}(),TimerUtil=function(){function t(){}return t.isInTime=function(t,e){if(!t)return!1;var i=Laya.Browser.now(),n=this.timeDic.get(t);n||(n=this.getDate(t),this.timeDic.set(t,n));var r=this.timeDic.get(e);r||(r=this.getDate(e),this.timeDic.set(e,r));var a=n.getTime(),s=r.getTime();return i>=a&&i<s},t.getDate=function(t){var e=t.split("_"),i=e[0].split("-"),n=e[1].split(":"),r=Number(i[0]),a=Number(i[1]-1),s=Number(i[2]),o=Number(n[0]),l=Number(n[1]),h=Number(n[2]);return new Date(r,a,s,o,l,h)},t.timeDic=new Laya.Dictionary,t}(),ShareInfo=function(){function t(){this.title="",this.imageUrl="",this.isNeedDiff=!1,this.query=""}return t.prototype.doSuccess=function(t){void 0===t&&(t=null),this.successFunc&&(t?this.successFunc.call(t):this.successFunc.call())},t.prototype.doFail=function(t){this.failFunc&&this.failFunc.call(t)},t}(),ETimeDiffType,EBtnType;!function(t){t[t.milliseconds=0]="milliseconds",t[t.second=1]="second",t[t.minute=2]="minute",t[t.hour=3]="hour",t[t.day=4]="day"}(ETimeDiffType||(ETimeDiffType={})),function(t){t[t.SHARE=0]="SHARE",t[t.VIDEO=1]="VIDEO"}(EBtnType||(EBtnType={}));var HelperExtension=function(){function t(){}return t.GetCorners=function(e,i){var n=new Array(4),r=.5*e.fieldOfView*t.Deg2Rad,a=e.aspectRatio,s=i*Math.tan(r),o=s*a,l=e.transform,h=l.right.clone();h.x*=o,h.y*=o,h.z*=o;var c=l.up.clone();c.x*=s,c.y*=s,c.z*=s;var u=l.forward.clone();return u.x*=i,u.y*=i,u.z*=i,n[0]=new Vector3,Vector3.subtract(l.position,h,n[0]),Vector3.add(n[0],c,n[0]),Vector3.add(n[0],u,n[0]),n[1]=new Vector3,Vector3.add(l.position,h,n[1]),Vector3.add(n[1],c,n[1]),Vector3.add(n[1],u,n[1]),n[2]=new Vector3,Vector3.subtract(l.position,h,n[2]),Vector3.subtract(n[2],c,n[2]),Vector3.add(n[2],u,n[2]),n[3]=new Vector3,Vector3.add(l.position,h,n[3]),Vector3.subtract(n[3],c,n[3]),Vector3.add(n[3],u,n[3]),n},t.AWHBR=function(t,e,i,n){var r=Math.abs(t.x-i.x),a=Math.abs(t.z-i.z),s=e.x+n,o=e.y+n;return r>s||a>o?0:r==s||a==o?1:2},t.ARBR=function(t,e,i,n){var r=Math.abs(t.x-i.x),a=Math.abs(t.z-i.z),s=e+n,o=Math.abs(e-n);return r>s||a>s?0:r==s||a==s?1:o<r&&o<a?2:3},t.AABP=function(t,e,i){var n=0;i.x>t.x?n=1:i.x<e.x&&(n=1);var r=0;return i.z>t.y?r=2:i.z<e.y&&(r=2),n+r},t.helperAxis=function(t){var e=t.addChild(new MeshSprite3D(new BoxMesh(2,.05,.05)));e.transform.rotation=t.transform.rotation.clone(),(n=new StandardMaterial).albedo=new Vector4(1,0,0,1),n.renderQueue=6e3,e.meshRender.material=n,e.transform.position=new Vector3(1,0,0);var i=t.addChild(new MeshSprite3D(new BoxMesh(.05,.05,2)));i.transform.rotation=t.transform.rotation.clone(),(n=new StandardMaterial).albedo=new Vector4(0,1,0,1),n.renderQueue=6e3,i.meshRender.material=n,i.transform.position=new Vector3(0,1,0);var n,r=t.addChild(new MeshSprite3D(new BoxMesh(.05,2,.05)));r.transform.rotation=t.transform.rotation.clone(),(n=new StandardMaterial).albedo=new Vector4(0,0,1,1),n.renderQueue=6e3,r.meshRender.material=n,r.transform.position=new Vector3(0,0,1)},t.helperPoint=function(t){var e=new MeshSprite3D(new Laya.BoxMesh(.1,.1,.1));e.transform.rotation=t.transform.rotation.clone();var i=MaterialUtility.getSpawnMaterial;i.renderQueue=6e3,e.meshRender.material=i,t.addChild(e)},t.helperRect=function(t){var e=t.addChild(new MeshSprite3D(new BoxMesh(2,.01,.01)));e.transform.rotation=t.transform.rotation.clone();var i=new StandardMaterial;i.albedo=new Vector4(1,0,0,1),i.renderQueue=5e3,e.meshRender.material=i,e.transform.position=new Vector3(0,0,-1);var n=t.addChild(new MeshSprite3D(new BoxMesh(2,.01,.01)));n.transform.rotation=t.transform.rotation.clone();var r=new StandardMaterial;r.albedo=new Vector4(0,1,0,1),r.renderQueue=5e3,n.meshRender.material=r,n.transform.position=new Vector3(0,0,1);var a=t.addChild(new MeshSprite3D(new BoxMesh(.01,2,.01)));a.transform.rotation=t.transform.rotation.clone();var s=new StandardMaterial;s.albedo=new Vector4(0,0,1,1),s.renderQueue=5e3,a.meshRender.material=s,a.transform.position=new Vector3(-1,0,0);var o=t.addChild(new MeshSprite3D(new BoxMesh(.01,2,.01)));o.transform.rotation=t.transform.rotation.clone();var l=new StandardMaterial;l.albedo=new Vector4(1,1,0,1),l.renderQueue=5e3,o.meshRender.material=l,o.transform.position=new Vector3(1,0,0)},t.helperScreen=function(t,e){var i=CameraController.getOffsetPos(),n=t.addChild(new MeshSprite3D(new BoxMesh(2*e.x,1,1)));n.transform.rotation=t.transform.rotation.clone();var r=new StandardMaterial;r.albedo=new Vector4(1,0,0,1),n.meshRender.material=r,n.transform.localPosition=new Vector3(0+i.x,0,-e.y+i.y);var a=t.addChild(new MeshSprite3D(new BoxMesh(2*e.x,1,1)));a.transform.rotation=t.transform.rotation.clone();var s=new StandardMaterial;s.albedo=new Vector4(0,1,0,1),a.meshRender.material=s,a.transform.localPosition=new Vector3(0+i.x,0,e.y+i.y);var o=t.addChild(new MeshSprite3D(new BoxMesh(1,2*e.y,1)));o.transform.rotation=t.transform.rotation.clone();var l=new StandardMaterial;l.albedo=new Vector4(0,0,1,1),o.meshRender.material=l,o.transform.localPosition=new Vector3(-e.x+i.x,0,0+i.y);var h=t.addChild(new MeshSprite3D(new BoxMesh(1,2*e.y,1)));h.transform.rotation=t.transform.rotation.clone();var c=new StandardMaterial;c.albedo=new Vector4(1,1,0,1),h.meshRender.material=c,h.transform.localPosition=new Vector3(e.x+i.x,0,0+i.y)},t.helperPlane=function(t,e,i){void 0===i&&(i=6e3);var n=new MeshSprite3D(new Laya.BoxMesh(e,e,.01)),r=MaterialUtility.getSpawnMaterial;r.renderQueue=i,n.meshRender.material=r,n.transform.rotation=t.transform.rotation.clone(),t.addChild(n)},t.coinTest=function(t){return void 0===t&&(t=.5),Math.random()-t<=0},t.random=function(t,e){var i=e-t;return(i=i>0?i:-i)*Math.random()+t},t.shiftName=function(t,e){return void 0===e&&(e=6),t?t.length<=e?t:t.substring(0,10)+"...":"游客"},t.formatTime=function(t,e){void 0===e&&(e="yyyy-MM-dd hh:mm:ss");var i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return e},t.ABCSetOffsetX=function(t,e,i){var n=t.width*t.scaleX,r=i.width,a=e.width*e.scaleX,s=0,o=0;isNaN(e.anchorX)||(s=e.anchorX),isNaN(t.anchorX)||(o=t.anchorX),0==t.visible&&(e.x=r/2-a/2+a*s),0==e.visible&&(t.x=(r-n)/2+n*o),t.visible&&e.visible&&(t.x=(r-2*n)/3+n*o,e.x=(r-2*n)/3*2+n+a*s)},t.GetDateDiff=function(t,e,i){var n,r;void 0===i&&(i=ETimeDiffType.second),t instanceof Date?n=t:isNaN(t)||(n=new Date(t)),e instanceof Date?r=e:isNaN(e)||(r=new Date(e));var a=1;switch(i){case ETimeDiffType.second:a=1e3;break;case ETimeDiffType.minute:a=6e4;break;case ETimeDiffType.hour:a=36e5;break;case ETimeDiffType.day:a=864e5}return parseInt(String((r.getTime()-n.getTime())/parseInt(String(a))))},t.BtnControl=function(t,e){if(e==EBtnType.SHARE)switch(ConfigUtility.getRewardType){case EGetRewardType.video:t.visible=!1;break;case EGetRewardType.shareAndVideo:case EGetRewardType.share:}else if(e==EBtnType.VIDEO)switch(ConfigUtility.getRewardType){case EGetRewardType.video:case EGetRewardType.shareAndVideo:break;case EGetRewardType.share:t.visible=!1}},t.Deg2Rad=Math.PI/180,t.Rad2Deg=180/Math.PI,t.DoublePI=2*Math.PI,t.PI_4=4*Math.PI,t}(),GameSetting=function(){function t(){t.ins=this,this._config=Laya.loader.getRes(ConfigUtility.configURL)}return Object.defineProperty(t,"instance",{get:function(){return null==t.ins&&(t.ins=new t),t.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.prototype.hasProperty=function(t){return null!=this.config&&null!=this.config[t]},Object.defineProperty(t.prototype,"maxRollTimes",{get:function(){return this.maxRollShareTimes+this.maxRollVideoTimes+1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxRollShareTimes",{get:function(){return t.instance.hasProperty("dayDiskShareTimes")?t.instance.config.dayDiskShareTimes:3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxRollVideoTimes",{get:function(){return t.instance.hasProperty("dayDiskVideoTimes")?t.instance.config.dayDiskVideoTimes:7},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropChipRate",{get:function(){return t.instance.hasProperty("settlementDropSkinBitPro")?t.instance.config.settlementDropSkinBitPro:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"luckyBagPro",{get:function(){return t.instance.hasProperty("luckyBagPro")?t.instance.config.luckyBagPro:50},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"luckyBagDayTimes",{get:function(){return ConfigUtility.LuckyBoxNum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShareSuccessTimes",{get:function(){return t.instance.hasProperty("ShareSuccessTimes")?t.instance.config.ShareSuccessTimes:2e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShareOneSuccessrate",{get:function(){return t.instance.hasProperty("ShareOneSuccessrate")?t.instance.config.ShareOneSuccessrate:50},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShareTwoSuccessrate",{get:function(){return t.instance.hasProperty("ShareTwoSuccessrate")?t.instance.config.ShareTwoSuccessrate:70},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MatchWaitTimes",{get:function(){return t.instance.hasProperty("MatchWaitTimes")?t.instance.config.MatchWaitTimes:3e4},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SkinDemoTimes",{get:function(){return t.ins.hasProperty("SkinDemoTimes")?t.ins.config.SkinDemoTimes:3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"VideoDemoShareTimes",{get:function(){return t.ins.hasProperty("VideoDemoShareTimes")?t.ins.config.VideoDemoShareTimes:4},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"VideoOpenTimes",{get:function(){return t.ins.hasProperty("VideoOpenTimes")?t.ins.config.VideoOpenTimes:5},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ClickOneAddProgress",{get:function(){return t.ins.hasProperty("ClickOneAddProgress")?t.ins.config.ClickOneAddProgress:3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ClickChestCoinMax",{get:function(){return t.ins.hasProperty("ClickChestCoinMax")?t.ins.config.ClickChestCoinMax:1e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ClickChestCoinMin",{get:function(){return t.ins.hasProperty("ClickChestCoinMin")?t.ins.config.ClickChestCoinMin:200},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"BigFreeTimes",{get:function(){return t.ins.hasProperty("BigFreeTimes")?t.ins.config.BigFreeTimes:1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShoesCostGold",{get:function(){return t.ins.hasProperty("ShoesCostGold")?t.ins.config.ShoesCostGold:100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"BigCostGold",{get:function(){return t.ins.hasProperty("BigCostGold")?t.ins.config.BigCostGold:300},enumerable:!0,configurable:!0}),t}(),BasePathfinder=function(){function t(){}return Object.defineProperty(t.prototype,"currentIndex",{get:function(){return this._currentIndex},set:function(t){t==this.pathway.ponits.length-1?this._currentIndex=0:this._currentIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.pathway.ponits[this.currentIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this.pathway.ponits[this.currentIndex+1]},enumerable:!0,configurable:!0}),t.prototype.setUp_pw=function(t){this._currentIndex=0,this.pathway=t},t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),BasePlayerSprite=function(t){function e(i,n){void 0===i&&(i=!1);var r=t.call(this)||this;return r._rollEnable=!0,r._isAlive=!0,r.isDetect=!1,r._riseTotalTime=500,r.MBFeature=new HoleMBFeature,e._tmpIndex++,r.index=e._tmpIndex%16,r.detect=DetectManager.Instance,r.level_instance=LevelConfig.instance,r.isLocalPlayer=i,r._kill=0,r._weight=0,r._levelIndex=0,r._currentLevel=r.level_instance.allLevels[r._levelIndex],r._radius=r.currentLevel.radius,r._speed=r.currentLevel.speed,r.s=new Sprite3D("scaleNode"),r.addChild(r.s),r.r=new Sprite3D("rotationNode"),r.addChild(r.r),r.isLocalPlayer?(r._rank=Math.floor(HelperExtension.random(4,15)),SkinManager.isUseShiWanSkin?(r.skinIndex=SkinManager.getSkinIndexByID(SkinManager.curUseShiwanID),GameDataManager.prevUseSkinID=SkinManager.curUseShiwanID,SkinManager.isUseShiWanSkin=!1):(r.skinIndex=SkinManager.getSkinIndexByID(SyncDataManager.curSkinId),GameDataManager.prevUseSkinID=SyncDataManager.curSkinId)):r.skinIndex=void 0!==n?SkinManager.getSkinIndexByID(n):SkinManager.RandomSkinIndex,SkinConfig.allSkins[r.skinIndex].isShield&&!ConfigUtility.IsSafeVersion&&(r.skinIndex=27),r.skin=SkinConfig.getDataByIndex(r.skinIndex),r.loadMesh(),r}return __extends(e,t),Object.defineProperty(e.prototype,"rollEnable",{get:function(){return this._rollEnable},set:function(t){this._rollEnable=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAlive",{get:function(){return this._isAlive},set:function(t){!this._isAlive&&t&&GameManager.judge_close_master(),this._isAlive=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"levelIndex",{get:function(){return this._levelIndex},set:function(t){t>=this.level_instance.LevelCount&&(t=this.level_instance.LevelCount-1),this._levelIndex=t,this._currentLevel=this.level_instance.allLevels[this._levelIndex],this.radius=this.currentLevel.radius,this.speed=this.currentLevel.speed,WXUtility.pointForNew("*球球升阶",ENewPointTpye.GROW_TO_2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kill",{get:function(){return this._kill},set:function(t){this._kill=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rank",{get:function(){return this._rank},set:function(t){this._rank=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this.autoScale()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(t){if(this._weight<t){if((i=this._levelIndex)!=this.level_instance.LevelCount-1){for(this.isLocalPlayer&&1==this.currentLevel.id&&GameDataManager.friendHelpNum>0&&GameDataManager.friendHelpNum;t>=this.level_instance.allLevels[i].upgrade_score&&i!=this.level_instance.LevelCount-1;)i++;i>this._levelIndex&&(this.isLocalPlayer&&(e.growView||(e.growView=new GrowView),i==this.level_instance.LevelCount-1?e.growView.text_content.text="体积最大":e.growView.text_content.text="球球成长",e.growView.show(),2==this.currentLevel.id&&GameDataManager.friendHelpNum>0&&(t+=GameDataManager.friendHelpNum,NoticeView.instance.show(["好友助力成功",GameDataManager.friendHelpNum+"个好友帮助了你"])),i>0)&&(r=this.level_instance.get_camera_increase(this._levelIndex,i),GameManager.CameraController.updateCameraOffset(r),this.detect.screenFpsMax=i),this.levelIndex=i)}}else if(this._weight>t&&t<this.prevLevel.upgrade_score)if(t<=this.level_instance.allLevels[0].upgrade_score)t=0,this.isLocalPlayer&&(e.growView||(e.growView=new GrowView),e.growView.text_content.text="球球缩小",e.growView.show(),r=this.level_instance.get_camera_increase(this._levelIndex,0),GameManager.CameraController.updateCameraOffset(r),this.detect.screenFpsMax=0),this.levelIndex=0;else{var i=this._levelIndex,n=i;if(i>0)for(;t<this.level_instance.allLevels[i-1].upgrade_score&&0!=--i;);if(i<this._levelIndex){if(this.isLocalPlayer){e.growView||(e.growView=new GrowView),e.growView.text_content.text="球球缩小",e.growView.show();var r=this.level_instance.get_camera_increase(n,i);GameManager.CameraController.updateCameraOffset(r),this.detect.screenFpsMax=i}this.levelIndex=i}}this._weight=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this.set_speed_feature(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentLevel",{get:function(){return this._currentLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prevLevel",{get:function(){var t=this._levelIndex-1;return t=t>=0?t:0,this.level_instance.allLevels[t]},enumerable:!0,configurable:!0}),e.prototype.release=function(){this.isAlive||this.isLocalPlayer||(GameManager.isOnline?this.remove():DetectManager.Instance.OtherPlayers.set(this.roomIndex,this)),Laya.timer.clearAll(this),this.destroyed||(this.b&&(this.b.removeSelf(),this.b.destroy(!0)),this.o&&(this.o.removeSelf(),this.o.destroy(!0)),this.particle_ballbreak&&(this.particle_ballbreak.removeSelf(),this.particle_ballbreak.destroy(!0)),this.b=null,this.o=null,this.particle_ballbreak=null,this.s=null,this.r=null,this.outerMat=null,this.removeSelf(),this.removeAllComponent(),this.destroy(!0))},e.prototype.loadMesh=function(){var t=SkinConfig.allSkins[this.skinIndex].skinName,e=Laya.loader.getRes(SceneManager.ballTag);if(null!=e){var i=e.getChildByName(t);if(null==i)throw console.log("bodyPrefab is null! "+t),new Error("没有该皮肤的模型："+t);this.b=Laya.Sprite3D.instantiate(i,this.s,!1,Vector3.ZERO.clone(),Quaternion.DEFAULT.clone()),this.b.transform.position=new Vector3(0,.5+PlayerUtility.posY,0),this.b.transform.scale=new Vector3(.8,.8,.8),null==this.b&&console.log("avatarBody is null!")}this.outerMat=new Laya.StandardMaterial,this.outerMat.renderMode=Laya.StandardMaterial.RENDERMODE_CUTOUT,this.outerMat.depthWrite=!1,this.outerMat.renderQueue=3001+this.index;var n=Laya.Texture2D.load(ConfigUtility.baseUrl+"res/skinGame/skin.png");this.outerMat.diffuseTexture=n,this.outerMat.albedo=this.skin.deathColourVec.clone(),this.o=new Laya.MeshSprite3D(PlayerUtility.outerMesh),this.o.meshRender.material=this.outerMat,this.s.addChild(this.o),DebugView.isConstruct&&(HelperExtension.helperAxis(this.s),HelperExtension.helperRect(this.s)),this.setScale(new Laya.Vector3(this.radius,this.radius,this.radius)),this.skin.skinAdd==SkinFeature.WeightFeature&&this.MBFeature.addMutiFeature(EMBFeatureType.WeightT,this.skin.skinAddValue/100)},e.prototype.set_onlineData=function(t){this.name=t.nickName,this.avatarUrl=t.avatarUrl,this.roomIndex=t.roomIndex,this.transform.position=new Laya.Vector3(t.x,PlayerUtility.posY,t.z)},e.prototype.set_speed_feature=function(t){var e=1;this.isLocalPlayer&&FlyingShoesView.is_FlyingShoes&&(e+=.4),e+=this.MBFeature.speedMuti,this.skin.skinAdd==SkinFeature.SpeedFeature&&(e+=this.skin.skinAddValue/100),this._speed=t*=e},e.prototype.add_weight=function(t){var e=0;e+=this.MBFeature.weightMuti,t+=Math.floor(t*e),this.weight+=t,this.isLocalPlayer&&(Laya.Pool.getItemByClass("BonusView",BonusView).show("+"+t),WXUtility.vibrateShort(),AudioController.play(ESoundType.hole_eat_model))},e.prototype.setPostion=function(t){var e=new Vector3(t.x-this.transform.position.x,0,t.z-this.transform.position.z);this.roll(e),this.transform.position=t.clone(),this.r.transform.position=this.b._childs[0].transform.position.clone()},e.prototype.getPostion=function(){return this.transform.position.clone()},e.prototype.setRotation=function(t){this.o.transform.rotation=t.clone()},e.prototype.getRotation=function(){return this.o.transform.rotation.clone()},e.prototype.setScale=function(t){this.s.transform.scale=t.clone()},e.prototype.getScale=function(){return this.s.transform.scale.clone()},e.prototype.getScaleX=function(){return this.s.transform.scale.x},e.prototype.addAttach=function(t){var e=t.transform.worldMatrix.clone(),i=t.transform.position.clone();this.r.addChild(t);var n=new Vector3;Vector3.subtract(i.clone(),this.transform.position.clone(),n),t.transform.position=new Vector3,t.transform.localPosition.x=n.x,t.transform.localPosition.y=i.y,t.transform.localPosition.z=n.z,t.transform.worldMatrix=e},e.prototype.roll=function(t){if(this.rollEnable){var e=Math.sqrt(t.x*t.x+t.z*t.z)/this.getScaleX(),i=new Vector3;Vector3.normalize(this.o.transform.forward.clone(),i),i.x*=e,i.y*=e,i.z*=e,this.b.transform.rotate(i,!1,!0),this.r.transform.rotation=this.b.transform.rotation.clone()}},e.prototype.autoScale=function(){this._targetSize=this.radius,this._startSize=this.getScaleX(),this._startRiseTime=0,Laya.timer.frameLoop(1,this,this.to_slow_scale)},e.prototype.to_slow_scale=function(){this._startRiseTime+=Laya.timer.delta;var t=this._startRiseTime/this._riseTotalTime;(this._startRiseTime>this._riseTotalTime||t>=1)&&(Laya.timer.clear(this,this.to_slow_scale),t=1);var e=Laya.MathUtil.lerp(this._startSize,this._targetSize,t);this.setScale(new Laya.Vector3(e,e,e))},e.prototype.update=function(){this.detectWithModels()},e.prototype.detectWithModels=function(){for(var t=0;t<this.detect.InScreenModels.values.length;++t){var e=this.detect.InScreenModels.values[t];if(this.isLocalPlayer||!(this.currentLevel.no<e.info.buildClass)){if(this.destroyed)return;switch(HelperExtension.AWHBR(e.transform.position,new Vector2(e.info.buildRadiusX,e.info.buildRadiusZ),this.getPostion(),this.radius)){case 0:this.isLocalPlayer&&(e.toPaque(),e.toStopShake());break;case 1:case 2:this.isLocalPlayer&&(this.levelIndex+2==e.info.buildClass&&e.toShake(),this.currentLevel.no<e.info.buildClass&&e.toTransparent()),this.currentLevel.no>=e.info.buildClass&&e.toAttach(this)}}}},e.prototype.toKill=function(t){if(GameManager.isOnline)(this.isLocalPlayer||GameManager.isMaster)&&(e=t.currentLevel.worth,this.isLocalPlayer&&GameDataManager.isFriendHelp&&(e*=2),SkinConfig.allSkins[this.skinIndex].skinAdd==SkinFeature.WeightFeature&&(e=Math.floor(e+e*SkinConfig.allSkins[this.skinIndex].skinAddValue/100)),this.weight+=e,this.kill++,this.isLocalPlayer&&(AudioController.play(ESoundType.hole_dead),(i=Laya.Pool.getItemByClass("HoleAteView",HoleAteView)).show("Crushing opponent +"+e)));else{var e=t.currentLevel.worth;if(this.isLocalPlayer&&GameDataManager.isFriendHelp&&(e*=2),SkinConfig.allSkins[this.skinIndex].skinAdd==SkinFeature.WeightFeature&&(e=Math.floor(e+e*SkinConfig.allSkins[this.skinIndex].skinAddValue/100)),this.weight+=e,this.kill++,this.isLocalPlayer){AudioController.play(ESoundType.hole_dead);var i=Laya.Pool.getItemByClass("HoleAteView",HoleAteView);i.show("Crushing opponent +"+e)}}},e.prototype.toDie=function(t){var e;if(this.isAlive=!1,this.play_dead_particle(),this.b.removeSelf(),this.o.removeSelf(),this.isLocalPlayer)GameDataManager.playerDeadTimes++,AudioController.play(ESoundType.hole_dead),this.detect.Players.shift(),GameManager.mouseController.enable(!1),GameManager.isOnline?SurvivalOverView.ins.toShow(t.name):GameView.reliveView.show(t.name);else if(e=this.detect.removeOtherWithID(this.id))if(e.AIComponent.enable=!1,GameManager.isOnline)switch(e.OtherType){case EOtherType.RemotePlayer:case EOtherType.RemoteAI:default:Laya.timer.once(2e3,e,e.remove)}else Laya.timer.once(2e3,this,this.relive)},e.prototype.play_dead_particle=function(){if(null==this.particle_ballbreak){var t=Laya.loader.getRes(SceneManager.particle_BallBreak_Tag);if(t){var e=t.getChildByName("particle_BallBreak");if(null==e)return;this.particle_ballbreak=Laya.Sprite3D.instantiate(e,this.s,!1,Vector3.ZERO.clone(),e.transform.rotation.clone()),this.particle_ballbreak.transform.position=new Vector3,this.particle_ballbreak.transform.localPosition=new Vector3;var i=this.particle_ballbreak.particleRender.material;i.tintColor=this.skin.deathColourVec.clone(),this.particle_ballbreak.particleRender.material=i,this.particle_ballbreak.particleSystem.play()}}else this.particle_ballbreak.particleSystem.play()},e.prototype.remove=function(){this&&(this.removeAllComponent(),this.removeSelf())},e.prototype.relive=function(){this.radius=this.currentLevel.radius,this.s.addChild(this.b),this.s.addChild(this.o)},e.prototype.relive_to_random_place=function(){var t=0,e=0,i=GameManager.PlayerEntity,n=FenceEntity.currentFence;if(n&&1==n.length){var r=i.transform.position.x+2*i.radius,a=i.transform.position.x-2*i.radius;t=r>=n[0].max.x-5?HelperExtension.random(n[0].min.x,a):a<=n[0].min.x+5?HelperExtension.random(r,n[0].max.x):HelperExtension.coinTest()?HelperExtension.random(r,n[0].max.x):HelperExtension.random(n[0].min.x,a),e=HelperExtension.random(n[0].min.y,n[0].max.y)}else{var s=Math.floor(HelperExtension.random(0,n.length));this.isLocalPlayer||(s=s==i.fenceIndex?(s+1)%n.length:s),this.fenceIndex=s,t=HelperExtension.random(n[s].min.x,n[s].max.x),e=HelperExtension.random(n[s].min.y,n[s].max.y)}this.destroyed||(this.transform.position=new Laya.Vector3(t,PlayerUtility.posY,e))},e.prototype.relive_to_level0=function(){this.isLocalPlayer&&(GameManager.CameraController.reset(),this.kill=0),this.levelIndex=0,this._weight=0},e.prototype.set_level=function(t){if(void 0===t&&(t=0),this.levelIndex!=t){this.levelIndex=t,this.autoScale();var e=this.level_instance.get_camera_increase(this.levelIndex,t);GameManager.CameraController.updateCameraOffset(e)}},e.prototype.change_level=function(){this.levelIndex+1>=this.level_instance.LevelCount?(this.isLocalPlayer&&GameManager.CameraController.reset(),this.levelIndex=0,this._weight=0,this.radius=this.currentLevel.radius):this.weight=this.currentLevel.upgrade_score},e.prototype.add_myterious_feature=function(t){var e=MysteriousBagCfg.instance.allMysteriousBag.get(t);switch(e.type){case EMBFeatureType.WeightD:this.weight+=e.changeValue;break;case EMBFeatureType.SpeedT:this.MBFeature.addMutiFeature(e.type,e.changeValue,e.time),this.set_speed_feature(this.currentLevel.speed),e.time>=0&&(this.MBFeature.isSpeedDelaying?(this.MBFeature.speedDelayValue+=e.changeValue,Laya.timer.once(e.time,this,this.remove_myterious_feature,[e.type,this.MBFeature.speedDelayValue]),this.MBFeature.speedRecoverTime=Laya.timer.currTimer+e.time):(this.MBFeature.isSpeedDelaying=!0,this.MBFeature.speedDelayValue=e.changeValue,Laya.timer.once(e.time,this,this.remove_myterious_feature,[e.type,this.MBFeature.speedDelayValue]),this.MBFeature.speedRecoverTime=Laya.timer.currTimer+e.time))}},e.prototype.remove_myterious_feature=function(t,e){null==this||this.destroyed||(this.MBFeature.delayRemoveFeature(t,e),this.set_speed_feature(this.currentLevel.speed),this.MBFeature.isSpeedDelaying=!1)},e._tmpIndex=0,e}(Laya.Sprite3D),HoleMBFeature=function(){function t(){this.isSpeedDelaying=!1,this.speedDelayValue=0,this.speedRecoverTime=0,this._speedMuti=0,this._weightMuti=0}return Object.defineProperty(t.prototype,"speedMuti",{get:function(){return this._speedMuti},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weightMuti",{get:function(){return this._weightMuti},enumerable:!0,configurable:!0}),t.prototype.addMutiFeature=function(t,e,i){switch(void 0===i&&(i=-1),t){case EMBFeatureType.SpeedT:this._speedMuti+=e;break;case EMBFeatureType.WeightT:this._weightMuti+=e}},t.prototype.delayRemoveFeature=function(t,e){switch(t){case EMBFeatureType.SpeedT:this._speedMuti-=e;break;case EMBFeatureType.WeightT:this._weightMuti-=e}},t}(),BaseModel=function(){function t(){this.isDetect=!1,this.inclineAxis=new Laya.Vector3,this.fallingOffset=new Laya.Vector2,this.beginFrame=0,this.shakingTag=0}return Object.defineProperty(t.prototype,"IsShaking",{get:function(){return this.isShaking},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFaded",{get:function(){return this.isFaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsAttached",{get:function(){return this.isFaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsTransparent",{get:function(){return this.isTransparent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this.info.buildScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"respawnTime",{get:function(){return this.info.buildRefreshTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Sprite3D",{get:function(){return this._sprite3D},set:function(t){this._sprite3D=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"meshRender",{get:function(){return this.isSkinnedMesh?this.animateType==EAnimateType.ship_finder?this.Mesh3D.meshRender:this.Mesh3D.skinnedMeshRender:this.Mesh3D.meshRender},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.Sprite3D.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this.Sprite3D.transform},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.transform.position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"euler",{get:function(){return this.transform.localRotationEuler},enumerable:!0,configurable:!0}),t.prototype.recover=function(){if(this.isSkinnedMesh&&(this.animateType==EAnimateType.boy_stand||this.animateType==EAnimateType.boy_finder)){var t=new EventListener(this.on_local_joined_boy.bind(this));GameManager.EventManagerEx.RemoveListener(EventSetting.on_local_player_joined,t)}GameManager.EventManagerEx.RemoveListener(EventSetting.on_exit_game,new EventListener(this.on_exit_game.bind(this)))},t.prototype.setUp=function(t,e,i,n,r){void 0===n&&(n=!1),void 0===r&&(r=EAnimateType.boy_finder),this.isSkinnedMesh=n,this.Mesh3D=i;var a=2;if(i&&i.meshFilter&&i.meshFilter._originalBoundingBox&&(a=i.meshFilter._originalBoundingBox.max.z-i.meshFilter._originalBoundingBox.min.z),this.Sprite3D=t,this.parent=t.parent,n){this.animateType=r;var s=t.getChildAt(0);if(this.animator=s.getComponentByType(Laya.Animator),this.animateType==EAnimateType.ship_finder?this.originMaterials=i.meshRender.materials:this.originMaterials=i.skinnedMeshRender.materials,this.animateType==EAnimateType.boy_stand||this.animateType==EAnimateType.boy_finder){var o=new EventListener(this.on_local_joined_boy.bind(this));GameManager.EventManagerEx.AddListener(EventSetting.on_local_player_joined,o)}}else this.originMaterials=i.meshRender.materials;if(this.info=e,null!=t&&null!=t.transform.localRotationEuler&&t.transform.localRotationEuler.z%180>30){var l=this.info.buildRadiusX;this.info.buildRadiusX=this.info.buildRadiusZ,this.info.buildRadiusZ=l}this._radius=this.info.buildRadiusX>this.info.buildRadiusZ?this.info.buildRadiusX:this.info.buildRadiusZ,this.height=a,this.doubleHeight=2*a,this.originPosition=t.transform.position.clone(),this.originRotation=t.transform.rotation.clone(),this.originScale=t.transform.scale.clone(),this.originEuler=t.transform.localRotationEuler.clone(),DetectManager.Instance.insert_model(this),GameManager.EventManagerEx.AddListener(EventSetting.on_exit_game,new EventListener(this.on_exit_game.bind(this)))},t.prototype.toAttach=function(t){this.isFaded||(this.isFaded=!0,t&&t.add_weight(this.info.buildScore),DetectManager.Instance.splice_model(this),this.parent.removeChild(this.Sprite3D),t.addAttach(this.Sprite3D),Laya.timer.once(5e3,this,this.toRemoveAttach))},t.prototype.toRemoveAttach=function(){this.Sprite3D.removeSelf()},t.prototype.toDirectRemove=function(){this.IsFaded||(this.isFaded=!0,DetectManager.Instance.splice_model(this),this.parent.removeChild(this.Sprite3D))},t.prototype.toRespawn=function(){if(this.isFaded&&(this.isFaded=!1,null!=this.Sprite3D&&!this.Sprite3D.destroyed)){if(this.isSkinnedMesh)switch(this.animateType){case EAnimateType.boy_finder:this.playAnimation(BoyClipName.escape);break;case EAnimateType.boy_stand:this.playAnimation(BoyClipName.idle)}this.meshRender.materials=this.originMaterials,this.transform.position=this.originPosition.clone(),this.transform.rotation=this.originRotation.clone(),this.transform.scale=this.originScale.clone(),this.parent.addChild(this.Sprite3D),DetectManager.Instance.insert_model(this)}},t.prototype.toShake=function(){this.isShaking||(this.isShaking=!0,this.beginFrame=Laya.timer.currFrame,0==this.shakingTag?(this.shakingTag=1,this.shakingOne=new Laya.Vector3(0,0,BuildConfig.modelShakeAngle),this.shakingTwo=new Laya.Vector3(0,0,-BuildConfig.modelShakeAngle)):(this.shakingTag=0,this.shakingOne=new Laya.Vector3(0,0,-BuildConfig.modelShakeAngle),this.shakingTwo=new Laya.Vector3(0,0,BuildConfig.modelShakeAngle)),Laya.timer.frameLoop(2,this,this.shaking))},t.prototype.shaking=function(){this.Sprite3D&&!this.isFaded&&((Laya.timer.currFrame-this.beginFrame)%BuildConfig.modelShakingRate<BuildConfig.modelShakingRate/2?this.transform.rotate(this.shakingOne,!1,!1):this.transform.rotate(this.shakingTwo,!1,!1))},t.prototype.toStopShake=function(){this.isShaking&&(this.isShaking=!1,Laya.timer.clear(this,this.shaking))},t.prototype.toTransparent=function(){if(!this.isTransparent){this.isTransparent=!0;for(var t=new Array,e=this.meshRender.materials.length,i=0;i<e;++i){var n=this.meshRender.materials[i],r=new Laya.StandardMaterial;r.albedo=new Laya.Vector4(n.albedoColor.x,n.albedoColor.y,n.albedoColor.z,.5),r.diffuseTexture=n.albedoTexture,r.renderMode=Laya.StandardMaterial.RENDERMODE_TRANSPARENT,r.renderQueue=6e3,t.push(r)}this.meshRender.materials=t}},t.prototype.toPaque=function(){this.isTransparent&&(this.isTransparent=!1,this.meshRender.materials=this.originMaterials)},t.prototype.on_local_joined_boy=function(){if(null!=this.Sprite3D&&!this.Sprite3D.destroyed)switch(this.animateType){case EAnimateType.boy_finder:this.playAnimation(BoyClipName.escape);break;case EAnimateType.boy_stand:this.playAnimation(BoyClipName.idle)}},t.prototype.on_exit_game=function(){this.isDetect=!1,this.isShaking=!1,Laya.timer.clear(this,this.shaking),this.IsFaded&&(Laya.timer.clear(this,this.toRemoveAttach),this.toRemoveAttach(),Laya.timer.once(0,this,this.toRespawn)),this.isSkinnedMesh&&this.animateType!=EAnimateType.boy_stand&&Laya.timer.once(1,this,this.toReset)},t.prototype.toReset=function(){null==this.Sprite3D||this.Sprite3D.destroyed||(this.transform.position=new Vector3(-500,this.transform.position.y,this.transform.position.z))},t.prototype.playAnimation=function(t,e){void 0===e&&(e=1),this.animator.play(t,e)},t.shakingTotalTime=2e3,t.loopTimes=3,t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),BaseRollBall=function(t){function e(e,i){void 0===e&&(e=!1);var n=t.call(this,e,i)||this;return n._rollEnable=!0,n.setUp(),n}return __extends(e,t),Object.defineProperty(e.prototype,"rollEnable",{get:function(){return this._rollEnable},set:function(t){this._rollEnable=t},enumerable:!0,configurable:!0}),e.prototype.setUp=function(){var t="92";this.skinIndex<3?t="06":this.skinIndex<5&&(t="90"),t=this.skinIndex<7?"92":this.skinIndex<10?"100":this.skinIndex<14?"93":"90";var e=Laya.loader.getRes(SceneManager.ballTag);if(this.isLocalPlayer&&console.log(e),e){var i=e.getChildByName("Ball_"+t);if(null==i)throw console.log("bodyPrefab is null! Ball_"+t),new Error("没有该皮肤的模型：Ball_"+t);this.b=Laya.Sprite3D.instantiate(i,this.s,!1,Vector3.ZERO,Quaternion.DEFAULT),HelperExtension.helperAxis(this.b),this.b.transform.position=new Vector3(0,.5,0),null==this.b&&console.log("avatarBody is null!")}},e.prototype.setPostion=function(e){var i=new Vector3(e.x-this.transform.position.x,0,e.z-this.transform.position.z);this.roll_2d(i),t.prototype.setPostion.call(this,e),this.r.transform.position=this.b._childs[0].transform.position.clone()},e.prototype.roll_2d=function(t){if(this.rollEnable){var e=Math.sqrt(t.x*t.x+t.z*t.z)/this.getScaleX(),i=new Vector3;Vector3.normalize(this.o.transform.forward.clone(),i),i.x*=e,i.y*=e,i.z*=e,this.b.transform.rotate(i,!1,!0),this.r.transform.rotation=this.b.transform.rotation.clone()}},e}(BasePlayerSprite),RollBallManager=function(){function t(){}return t.setUp=function(){this.rollBallNode=new Sprite3D("RollBallNode")},t.add_to_scene=function(){(null==this.rollBallNode||this.rollBallNode.destroyed)&&(this.rollBallNode=new Sprite3D("RollBallNode")),SceneManager.scene.addChild(this.rollBallNode)},t.reset_node=function(){this.rollBallNode=null},t}(),DetectManager=function(){function t(){this.Models=new Dictionary,this.InScreenModels=new Dictionary,this.Players=new Array,this.OtherPlayers=new Dictionary,this.TmpOtherPlayers=new Dictionary,this.InScreenOPs=new Dictionary,this.allTmpID=new Array,this.AIDetectIndex=0,this._screenFpsMax=15,this.screenFrameNum=0,this.screenIndex=0,this.onlineAIIndex=0,console.log("___________________DetectManager___________________"),this._broadcastView=new BroadcastView,GameManager.EventManagerEx.AddListener(EventSetting.on_already_to_play,new EventListener(this.on_already_to_play.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_exit_game,new EventListener(this.on_exit_game.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_match_start,new EventListener(this.on_match_start.bind(this)))}return Object.defineProperty(t,"Instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OtherPlayerCount",{get:function(){return this.OtherPlayers.values.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPlayerNumber",{get:function(){return 1+this.OtherPlayers.values.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenFpsMax",{set:function(t){this._screenFpsMax=58-t,this.screenFrameNum=Math.floor(this.Models.keys.length/this._screenFpsMax)+1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"broadcastView",{get:function(){return this._broadcastView},enumerable:!0,configurable:!0}),t.prototype.on_match_start=function(){this.OtherPlayers=new Dictionary,this.Players=new Array},t.prototype.on_already_to_play=function(){if(this.broadcastView.recover(),this.screenFrameNum=Math.floor(this.Models.keys.length/this._screenFpsMax)+1,this.InScreenModels.clear(),this.InScreenOPs.clear(),Laya.timer.loop(1e3/30,this,this.frameUpdate),GameManager.isOnline){this.allTmpID=new Array;for(var t=OtherPlayerManager.AllRemoteOther.values.length;t--;)OtherPlayerManager.AllRemoteOther.values[t].online_active();Laya.timer.loop(25,this,this.fixedTimeUpdate)}else this.OtherPlayers.values.forEach(function(t){t.AIComponent.enable=!0})},t.prototype.on_Game_over=function(){Laya.timer.clear(this,this.fixedTimeUpdate),Laya.timer.clear(this,this.frameUpdate),this.OtherPlayers.values.forEach(function(t){t.AIComponent.enable=!1});for(var t=0;t<this.TmpOtherPlayers.keys.length;t++){var e=this.TmpOtherPlayers.keys[t],i=this.TmpOtherPlayers.get(e);this.OtherPlayers.set(e,i)}OtherPlayerManager.clearAll()},t.prototype.on_exit_game=function(){Laya.timer.clear(this,this.fixedTimeUpdate),Laya.timer.clear(this,this.frameUpdate),this.release()},t.prototype.release=function(){this.Players=new Array,this.OtherPlayers.values.forEach(function(t){t.destroyed||(t.componentsCount>0&&t.removeAllComponent(),t.release())}),this.OtherPlayers.clear(),this.TmpOtherPlayers.clear(),this.AIDetectIndex=0},t.prototype.destroyOtherWithID=function(t){for(var e=this.OtherPlayers.keys.length;e--;){var i=this.OtherPlayers.keys[e],n=this.OtherPlayers.get(i);n.id==t&&(n.destroy(),this.OtherPlayers.remove(i))}},t.prototype.removeOtherWithID=function(t){for(var e=this.OtherPlayers.keys.length;e--;){var i=this.OtherPlayers.keys[e],n=this.OtherPlayers.get(i);if(n.id==t)return this.OtherPlayers.remove(i),n}},t.prototype.frameUpdate=function(){this.screening();for(var t=this.Players.length;t--;)this.Players[t].update();this.detectAllPlayer(),this.updateInScreenAI(),AnimatedManager.update()},t.prototype.fixedTimeUpdate=function(){if(MouseController.instance.IsMouseDown){var t=GameManager.PlayerEntity;null!=t&&MainSocket.C2S_SYNC_GAME_INFO(t.roomIndex,t.transform.position.x,t.transform.position.z,t.weight)}if(GameManager.isMaster&&OtherPlayerManager.AllRemoteAI.values.length>0){this.onlineAIIndex>=OtherPlayerManager.AllRemoteAI.values.length&&(this.onlineAIIndex=0);var e=OtherPlayerManager.AllRemoteAI.values[this.onlineAIIndex];this.onlineAIIndex++,e.isAlive&&e.transform&&MainSocket.C2S_SYNC_GAME_INFO(e.roomIndex,e.transform.position.x,e.transform.position.z,e.weight)}},t.prototype.detectInScreenPlayer=function(){var t=new Array;t=this.Players.length>0&&this.Players[0].isInvincible?t.concat(this.InScreenOPs.values):t.concat(this.InScreenOPs.values,this.Players),this.detectPlayers(t)},t.prototype.updateInScreenAI=function(){for(var t=this.InScreenOPs.values.length;t--;)this.InScreenOPs.values[t].update()},t.prototype.detectAllPlayer=function(){if(GameDataManager.gameState==EGameState.InGame){var t=new Array;t=this.Players.length>0&&this.Players[0].isInvincible?t.concat(this.OtherPlayers.values):t.concat(this.OtherPlayers.values,this.Players),this.detectPlayers(t)}},t.prototype.detectPlayers=function(t){for(;t.length>0;)for(var e=t.pop(),i=0;i<t.length;i++){var n=t[i];if(e.radius!=n.radius){var r=void 0,a=void 0;if(e.radius>n.radius?(r=e,a=n):(r=n,a=e),!a.destroyed&&a.isAlive){var s=r.getPostion(),o=a.getPostion();if(r.isLocalPlayer||a.isLocalPlayer)switch(HelperExtension.ARBR(s,1.8*r.radius,o,a.radius)){case 0:!r.isLocalPlayer&&r.levelIndex>a.levelIndex&&((l=r).OtherType!=EOtherType.AdvanceAI&&l.OtherType!=EOtherType.AdvanceProAI||l.AIComponent.whoIFollow(a));continue;case 1:case 2:case 3:!r.isLocalPlayer&&r.levelIndex>a.levelIndex&&(l=r).AIComponent.whoIFollow(a),!a.isLocalPlayer&&r.isLocalPlayer&&r.levelIndex>a.levelIndex&&(l=a).AIComponent.whoIEscape(r)}switch(HelperExtension.ARBR(s,r.radius,o,a.radius)){case 0:!r.isLocalPlayer&&r.levelIndex>a.levelIndex&&((l=r).OtherType!=EOtherType.AdvanceAI&&l.OtherType!=EOtherType.AdvanceProAI||l.AIComponent.whoIFollow(a));break;case 1:if(!a.isLocalPlayer){var l=a;l.AIComponent.randomDirect()}break;case 2:case 3:r.toKill(a),a.toDie(r);var h=new BroadcastNode;if(h.init(r,a),this.broadcastView.push(h),GameManager.isOnline&&MainSocket.C2S_SYNC_KILL_PLAYER(r.roomIndex,a.roomIndex),!a.isLocalPlayer){if(a.id==e.id)break;t.splice(i,1)}}}}}},t.prototype.updateALLAI=function(){0!=this.OtherPlayerCount&&(this.AIDetectIndex==this.OtherPlayerCount&&(this.AIDetectIndex=0),this.OtherPlayers.values[this.AIDetectIndex]&&this.OtherPlayers.values[this.AIDetectIndex].update(),this.AIDetectIndex++,this.AIDetectIndex)},t.prototype.sort_rank_bonus=function(){var t=new Array;(t=t.concat(this.OtherPlayers.values,this.Players)).sort(this.sort_func);var e=1;return t.forEach(function(i){if(i.destroyed)t.splice(t.indexOf(i),1);else{if(i.rank=e,!i.isLocalPlayer&&!i.isDetect){var n=i;if(GameDataManager.isGodMode&&!GameManager.isOnline)n.weight<GameManager.PlayerEntity.weight&&(n.weight=HelperExtension.coinTest(PlayerUtility.SimpleAIChance)?n.weight+n.currentLevel.simpleAIScore:n.weight);else switch(n.OtherType){case EOtherType.SimpleAI:n.weight=HelperExtension.coinTest(PlayerUtility.SimpleAIChance)?n.weight+n.currentLevel.simpleAIScore:n.weight;break;case EOtherType.AdvanceAI:n.weight=HelperExtension.coinTest(PlayerUtility.HardAIChance)?n.weight+n.currentLevel.hardAIScore:n.weight;break;case EOtherType.AdvanceProAI:n.levelIndex<=GameManager.PlayerEntity.levelIndex?n.weight+=n.currentLevel.btAIScore:n.weight=HelperExtension.coinTest(PlayerUtility.BTAIChance)?n.weight+n.currentLevel.btAIScore:n.weight}}e++}}),t},t.prototype.sort_rank=function(){var t=new Array;(t=t.concat(this.OtherPlayers.values,this.Players)).sort(this.sort_func);var e=1;return t.forEach(function(i){i.destroyed?t.splice(t.indexOf(i),1):(i.rank=e,e++)}),t},t.prototype.sort_func=function(t,e){return e.weight-t.weight},t.prototype.insert_model=function(t){this.Models.set(t.Sprite3D.id,t)},t.prototype.splice_model=function(e){var i=t.Instance.Models.values.indexOf(e);this.screenIndex>i&&this.screenIndex--,this.Models.remove(e.Sprite3D.id),this.InScreenModels.remove(e.Sprite3D.id),this.allTmpID.push(e.Sprite3D.id)},t.prototype.remove_model_by_id=function(e){var i=t.Instance.Models.keys.indexOf(e);this.screenIndex>i&&this.screenIndex--;var n=this.Models.get(e);null!=n&&(n.toDirectRemove(),this.Models.remove(e),this.InScreenModels.remove(e))},t.prototype.screening=function(){for(var t=GameManager.PlayerEntity,e=t.getScreenPos(),i=CameraController.ScreeningOffset[t.levelIndex],n=this.screenFrameNum;n--;){this.screenIndex++,this.screenIndex>=this.Models.values.length&&(this.screenIndex=0);var r=this.Models.values[this.screenIndex];2!=(h=HelperExtension.AWHBR(e,i,r.transform.position,r.radius))?this.removeModelInScene(r):this.addModelToScene(r)}for(var a=this.OtherPlayerCount;a--;){var s=this.OtherPlayers.values[a],o=2*s.radius,l=new Vector2(i.x+o,i.y+o),h=HelperExtension.AWHBR(e,l,s.transform.position,s.radius);0==h||1==h?this.removeAIInScene(a):2==h&&this.addAIToScene(a)}},t.prototype.removeAIInScene=function(t){var e=this.OtherPlayers.values[t];e.isDetect&&(e.isDetect=!1,this.InScreenOPs.values.indexOf(e)>=0&&this.InScreenOPs.remove(e.roomIndex))},t.prototype.addAIToScene=function(t){var e=this.OtherPlayers.values[t];e.isDetect||(e.isDetect=!0,this.InScreenOPs.set(e.roomIndex,e),Laya.Pool.getItemByClass("NearPlayerView",NearPlayerView).show(e))},t.prototype.removeModelInScene=function(t){t.isDetect&&(t.isDetect=!1,this.InScreenModels.remove(t.Sprite3D.id))},t.prototype.addModelToScene=function(t){t.isDetect||(t.isDetect=!0,this.InScreenModels.set(t.Sprite3D.id,t))},t.prototype.reset_all_model=function(){this.InScreenModels.clear();for(var t=this.Models.keys.length;t--;){var e=this.Models.values[t];e.recover(),e instanceof ModelEntity?Laya.Pool.recover("ModelEntity",e):e instanceof AnimateModelEntity?Laya.Pool.recover("AnimateModelEntity",e):e instanceof MysteriousBagEnitity&&Laya.Pool.recover("MysteriousBagEnitity",e),this.Models.remove(e.Sprite3D.id)}this.Models.clear()},t}(),EGameMode;!function(t){t[t.Classic=0]="Classic",t[t.Survive=1]="Survive"}(EGameMode||(EGameMode={}));var BattleResult=function(){},GameManager=function(){function t(){}return Object.defineProperty(t,"PlayerEntity",{get:function(){return null==t._localPlayer&&((t._localPlayer=new PlayerEntity).name=ConfigUtility.userNickName,t._localPlayer.avatarUrl=ConfigUtility.userAvatar,console.log("______________GameManager____PlayerEntity__________________"),this._isFirstLoaded&&(this._isFirstLoaded=!1,t.EventManagerEx.AddListener(EventSetting.on_exit_game,new EventListener(function(){t._localPlayer&&t._localPlayer.invicibleView&&t._localPlayer.invicibleView.destroy(!0),t._localPlayer&&(Laya.timer.clearAll(t._localPlayer),t._localPlayer.release()),t._localPlayer=null})))),t._localPlayer},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TimerEvent",{get:function(){return null==t._timerEvent&&(t._timerEvent=new TimerEvent),t._timerEvent},enumerable:!0,configurable:!0}),Object.defineProperty(t,"EventManagerEx",{get:function(){return null==t._eventManager&&(t._eventManager=new EventManagerEx),t._eventManager},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CameraController",{get:function(){return t._cameraController?t._cameraController:console.error("GameManager._cameraController is NULL")},set:function(e){t._cameraController=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UIViewsController",{get:function(){if(t._uiViewsController)return t._uiViewsController},set:function(e){t._uiViewsController=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CurrentGameMode",{get:function(){return this._CurrentGameMode},set:function(t){HoleAppController.isLoginSever&&this.isOpenOnline||(t=EGameMode.Classic),this._CurrentGameMode=t,this._isOnline=this._CurrentGameMode==EGameMode.Survive},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isOnline",{get:function(){return this._isOnline},enumerable:!0,configurable:!0}),t.setUp=function(){t.EventManagerEx.AddListener(EventSetting.on_game_start_online,new EventListener(this.on_game_start_online))},t.on_game_start_online=function(){HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.SCENE),t.EventManagerEx.RaiseEvent(EventSetting.on_local_player_joined),MatchView.Instance.toHide()},Object.defineProperty(t,"isMaster",{get:function(){return this._isMaster},set:function(t){this._isMaster=t},enumerable:!0,configurable:!0}),t.judge_close_master=function(){if(t.isMaster){t.isMaster=!1,console.log("不再是房主了：",t.PlayerEntity.name);for(var e=0;e<OtherPlayerManager.AllRemoteAI.values.length;e++){var i=OtherPlayerManager.AllRemoteAI.values[e];i.isAlive&&(i.OtherType=EOtherType.RemoteAI,i.remoteComponet.enable=!0,i.AIComponent.enable=!1)}}},t._isFirstLoaded=!0,t._CurrentGameMode=EGameMode.Classic,t._isOnline=!1,t._isMaster=!1,t.onlineGameTotalTime=181,t.isOpenOnline=!1,t.GameResult=new BattleResult,t}(),EventManagerEx=function(){function t(){this.eventList=new Array}return t.prototype.AddListener=function(t,e){if(this.eventList.length>0)for(var i=this.eventList.length,n=0;n<i;++n){var r=this.eventList[n];if(r.eventName==t)for(var a=r.eventArray.length,s=0;s<a;++s){if(r.eventArray[s]==e)return;if(s==a-1)return void r.eventArray.push(e)}else if(n==i-1)return this.eventList.push(new EventMap(t)),void this.eventList[this.eventList.length-1].eventArray.push(e)}else this.eventList.push(new EventMap(t)),this.eventList[this.eventList.length-1].eventArray.push(e)},t.prototype.RemoveListener=function(t,e){if(this.eventList.length>0)for(var i=this.eventList.length,n=0;n<i;++n){var r=this.eventList[n];if(r.eventName==t)for(var a=r.eventArray.length,s=0;s<a;++s)if(r.eventArray[s]==e)return console.log("事件["+t+"] ：移除此监听"+e),void r.eventArray.splice(r.eventArray.indexOf(e),1)}},t.prototype.RaiseEvent=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=this.eventList.length,r=0;r<n;++r){var a=this.eventList[r];if(a.eventName==t){for(var s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];for(var l=0;l<a.eventArray.length;++l)a.eventArray[l].method(s),a.eventArray[l].isSingleShot&&(a.eventArray.splice(l,1),l--);return}}},t.prototype.RemoveEvent=function(t){for(var e=0;e<this.eventList.length;++e)this.eventList[e].eventName==t&&this.eventList.splice(e,1)},t.prototype.IsContainsKey=function(t){return this.eventList.forEach(function(e){if(e.eventName==t)return!0}),!1},t.prototype.IsContainsValue=function(t,e){return this.eventList.forEach(function(i){i.eventName==t&&i.eventArray.forEach(function(t){return t==e})}),!1},t}(),OtherPlayerManager=function(){function t(){}return Object.defineProperty(t,"AIPlayers",{get:function(){return DetectManager.Instance.OtherPlayers.values},enumerable:!0,configurable:!0}),t.clearAll=function(){this.AllRemoteAI.clear(),this.AllRemotePlayer.clear(),this.AllRemoteOther.clear()},t.GenerateAIPlayer=function(){var t=PlayerUtility.maxPlayers-DetectManager.Instance.currentPlayerNumber;if(!(t<=0)){var e=new Laya.Sprite3D(Scene3DController.AIParentName);if(GameDataManager.ClassicPlayerGameData.loserComboTimes>=3)for(r=0;r<t;++r)(s=new AIPlayerEntity(EOtherType.SimpleAI)).name=GameDataManager.tmpMatchData[r].nickName,s.avatarUrl=GameDataManager.tmpMatchData[r].avatarUrl,s.init(),e.addChild(s);else{var i=0,n=GameDataManager.ClassicPlayerGameData.winnerComboTimes-2;if(n>=0)for(i=(i=n+1+Math.floor(HelperExtension.random(0,3)))>t?t:i,r=0;r<i;++r)a=EOtherType.AdvanceProAI,(s=new AIPlayerEntity(a)).name=GameDataManager.tmpMatchData[r].nickName,s.avatarUrl=GameDataManager.tmpMatchData[r].avatarUrl,s.init(),e.addChild(s);for(var r=i;r<t;++r){var a=HelperExtension.coinTest(RankConfig.config[RankDataManager.configIndex].hardAIPer)?EOtherType.AdvanceAI:EOtherType.SimpleAI,s=new AIPlayerEntity(a);s.name=GameDataManager.tmpMatchData[r].nickName,s.avatarUrl=GameDataManager.tmpMatchData[r].avatarUrl,s.init(),e.addChild(s)}}return e}},t.GenerateRemotePlayer=function(){for(var t=new Laya.Sprite3D("RemoteNode"),e=0;e<GameDataManager.onlineMatchData.length;e++){var i=GameDataManager.onlineMatchData[e];if(i.openId!=ConfigUtility.openId){var n=EOtherType.RemotePlayer;n=GameManager.isMaster?""!=i.openId?EOtherType.RemotePlayer:EOtherType.SimpleAI:""!=i.openId?EOtherType.RemotePlayer:EOtherType.RemoteAI;var r=new RemotePlayerEntity(i.skinId,n);t.addChild(r),r.set_onlineData(i),r.init(),r.initCom(),this.AllRemoteOther.set(r.roomIndex,r),""!=i.openId?this.AllRemotePlayer.set(r.roomIndex,r):this.AllRemoteAI.set(r.roomIndex,r)}}return console.log("我的客户端中生成好了玩家"),t},t.SpawnAIPlayer=function(){var t=new AIPlayerEntity;return t.name="AI_"+(DetectManager.Instance.currentPlayerNumber+1),t.init(),t},t.ChangeAILevel=function(){for(var t=0;t<this.AIPlayers.length;++t)this.AIPlayers[t].change_level()},t.SetRemoteData=function(t,e,i,n){var r=this.AllRemoteOther.get(t);r&&(r.remoteComponet.setDirect(e,i),r.weight=n)},t.SetRemoteWeight=function(t){var e=this.AllRemoteOther.get(t.roomIndex);e&&(e.weight=t.weight)},t.SyncRemoteBroadcast=function(t,e){var i,n;if(e==GameManager.PlayerEntity.roomIndex){if(i=this.AllRemoteOther.get(t),n=GameManager.PlayerEntity,!GameManager.PlayerEntity.isAlive)return;SurvivalOverView.ins.toShow(i.name)}else t==GameManager.PlayerEntity.roomIndex?(i=GameManager.PlayerEntity,n=this.AllRemoteOther.get(e)):(i=this.AllRemoteOther.get(t),n=this.AllRemoteOther.get(e));if(i&&n){i.toKill(n),n.toDie(i);var r=new BroadcastNode;r.init(i,n),DetectManager.Instance.broadcastView.push(r)}},t.SyncRemoteExitGame=function(t){var e=this.AllRemoteOther.get(t);e&&e.directToRemove()},t.SyncSwicthMaster=function(t){if(GameDataManager.gameState==EGameState.InGame&&GameManager.PlayerEntity.isAlive&&GameManager.PlayerEntity.roomIndex==t){GameManager.isMaster=!0,GameManager.masterRoomIndex=t,console.log("新matser：",t,"名字",GameManager.PlayerEntity.name);for(var e=0;e<this.AllRemoteAI.values.length;e++){var i=this.AllRemoteAI.values[e];i.isAlive&&(i.OtherType=EOtherType.SimpleAI,i.remoteComponet.enable=!1,i.AIComponent.enable=!0,i.AIComponent.resetPos(),i.AIComponent.randomMove())}}},t.SyncPickUpGiftBag=function(t,e){if(GameDataManager.gameState==EGameState.InGame){var i;if(GameManager.PlayerEntity.roomIndex==t)i=GameManager.PlayerEntity;else if(!(i=this.AllRemoteOther.get(t)))return;var n=LiheManagaer.allMBE.get(e);if(n){if(i.isLocalPlayer){var r=Laya.Pool.getItemByClass("HoleAteView",HoleAteView);n.MB.changeValue>=0?r.text_ate.color="#00cc00":r.text_ate.color="#cc0000",r.show(n.MB.tips)}i.add_myterious_feature(n.MB.id),Laya.Pool.getItemByClass("EatBagView",EatBagView).show(i.name,n.MB.id)}}},t.screening_online=function(){for(var t=0;t<this.AllRemotePlayer.values.length;++t)for(var e=this.AllRemotePlayer.values[t],i=e.transform.position,n=CameraController.ScreeningOffset[e.levelIndex],r=this.AllRemoteAI.values.length;r--;){var a=this.AllRemoteAI.values[r];if(a.OtherType!=EOtherType.RemotePlayer){var s=new Vector2(n.x,n.y),o=HelperExtension.AWHBR(i,s,a.transform.position,a.radius);0!=o&&1!=o&&2==o&&MainSocket.C2S_SYNC_GAME_INFO(a.roomIndex,a.transform.position.x,a.transform.position.z,a.weight)}}},t.judge_kaijubianda=function(){if(!GameManager.isOnline)for(var t=this.AIPlayers,e=t.length;e--;)HelperExtension.coinTest(.15)&&(t[e].weight+=8)},t.AllRemoteOther=new Dictionary,t.AllRemotePlayer=new Dictionary,t.AllRemoteAI=new Dictionary,t}(),AdapterManager=function(){function t(){}return t.setup=function(){if(Laya.Browser.onPC)return Laya.stage.scaleMode=Laya.Stage.SCALE_SHOWALL,Laya.stage.screenMode=Laya.Stage.SCREEN_NONE,Laya.stage.alignH="center",void(Laya.stage.alignV="middle");Laya.Browser.clientWidth/Laya.Browser.clientHeight<t.designScreenRadio?(Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH,t.scaleRadio=(Laya.Browser.onWeiXin,Laya.Browser.clientWidth/t.designScreenSize.x),t.offsetY=(Laya.Browser.clientHeight-t.designScreenSize.y*t.scaleRadio)/2):(Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_HEIGHT,t.scaleRadio=(Laya.Browser.onWeiXin,Laya.Browser.clientHeight/t.designScreenSize.y),t.offsetX=(Laya.Browser.clientWidth-t.designScreenSize.x*t.scaleRadio)/2),window.renders=this.optimization},t.offsetY=0,t.offsetX=0,t.ADBannerSize=new Laya.Vector2(640,0),t.designScreenSize=new Laya.Vector2(640,1136),t.designScreenRadio=640/1136,t.optimization=2,t}(),RankDataManager=function(){function t(){}return t.setup=function(){var t=Number(PlatfromKit.getValueFromLocal(EnumKey.maxPlayRankID));console.log("maxPlayRankID",t),t&&!isNaN(t)&&t>this._maxPlayRankID&&(this._maxPlayRankID=t),this.updateRankData(),this._IsUpgrade=!Browser.onWeiXin,this.maxPlayRankID=RankConfig.config[this.configIndex].id},t.getHeigScore=function(){var t=0,e=PlatfromKit.getValueFromLocal(EnumKey.HEIG_SCORE);return null!=e&&"NaN"!=e&&(t=Number(e)),t},Object.defineProperty(t,"IsUpgrade",{get:function(){return this._IsUpgrade},enumerable:!0,configurable:!0}),Object.defineProperty(t,"rankIndex",{get:function(){return this._rankIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t,"set_rankIndex",{set:function(t){this._rankIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"skinUrlNumber",{get:function(){return this._skinUrlNumber},enumerable:!0,configurable:!0}),Object.defineProperty(t,"set_skinUrlNumber",{set:function(t){this._skinUrlNumber=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"configIndex",{get:function(){return this._configIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t,"set_configIndex",{set:function(t){this._configIndex+1==t?this._IsUpgrade=!0:this._IsUpgrade=!1,1==this._configIndex&&WXUtility.pointForNew("*新人升阶",ENewPointTpye.UPGRAD_TO_2),this._configIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"rankData",{get:function(){return RankConfig.config[this._configIndex]},enumerable:!0,configurable:!0}),t.getRankTypeByScore=function(t){RankConfig.config.forEach(function(t){console.log(t)})},t.getRankDataByScore=function(t){if(t>=0){var e=RankConfig.config.length-1;if(t>=RankConfig.config[e].integral)return RankConfig.config[e];for(var i=RankConfig.config.length-1;i>=0;i--){var n=i-1;if(t>=RankConfig.config[n].integral&&t<RankConfig.config[i].integral)return RankConfig.config[n]}}},t.updateRankData=function(){var t=SyncDataManager.score;if(t>=0){var e=RankConfig.config.length-1;if(t>=RankConfig.config[e].integral)this.set_configIndex=e,this.set_skinUrlNumber=RankConfig.config[e].rankType,this.set_rankIndex=RankConfig.config[e].rankClass;else for(var i=RankConfig.config.length-1;i>=0;i--){var n=i-1;if(t>=RankConfig.config[n].integral&&t<RankConfig.config[i].integral){this.set_configIndex=n,this.set_skinUrlNumber=RankConfig.config[n].rankType,this.set_rankIndex=RankConfig.config[n].rankClass;break}}}},Object.defineProperty(t,"openRankProtect",{get:function(){return GameSetting.instance.hasProperty("openRankProtect")?GameSetting.instance.config.openRankProtect:6},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isRankProtect",{get:function(){return this.configIndex<this.openRankProtect},enumerable:!0,configurable:!0}),Object.defineProperty(t,"maxPlayRankID",{get:function(){return this._maxPlayRankID},set:function(t){t>this._maxPlayRankID&&(this._maxPlayRankID=t,PlatfromKit.setValueLocal(EnumKey.maxPlayRankID,this._maxPlayRankID.toString()),console.log("玩家的历史的最高段位：",this._maxPlayRankID))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isHasBeenAwarded",{get:function(){return console.log("历史的最高段位：",this._maxPlayRankID,"当前的段位：",RankConfig.config[t.configIndex].id),this._maxPlayRankID>=RankConfig.config[t.configIndex].id},enumerable:!0,configurable:!0}),t.resetPlayerRankID=function(){this._maxPlayRankID=0,PlatfromKit.setValueLocal(EnumKey.maxPlayRankID,this._maxPlayRankID.toString())},t._IsUpgrade=!1,t._rankIndex=1,t._skinUrlNumber=0,t._configIndex=0,t._maxPlayRankID=0,t}(),EGameState;!function(t){t[t.InLoading=0]="InLoading",t[t.InHome=1]="InHome",t[t.InTeamPlay=2]="InTeamPlay",t[t.InShiWan=3]="InShiWan",t[t.InMatch=4]="InMatch",t[t.InGame=5]="InGame",t[t.GameOverOrExitGame=6]="GameOverOrExitGame"}(EGameState||(EGameState={}));var ClassicPlayerGameData=function(){this.playTimes=0,this.winnerTimes=0,this.winnerComboTimes=0,this.loserComboTimes=0},SurvivalPlayerGameData=function(){this.playTimes=0,this.winnerTimes=0},LoginRewardDay=function(){this.localTag=-1,this.severTag=-1},GameDataManager=function(){function t(){}return Object.defineProperty(t,"LoginRewardDay",{get:function(){return this._localLoginRewardDay},enumerable:!0,configurable:!0}),t.setLoginRewardCurrentDay=function(t){this._localLoginRewardDay.localTag=t,Laya.LocalStorage.setJSON(EnumKey.Login_Reward_Day,JSON.stringify(this._localLoginRewardDay))},t.setLoginRewardSeverDay=function(t){this._localLoginRewardDay.severTag=t,Laya.LocalStorage.setJSON(EnumKey.Login_Reward_Day,JSON.stringify(this._localLoginRewardDay))},Object.defineProperty(t,"ClassicPlayerGameData",{get:function(){return this._classicPlayerGameData},enumerable:!0,configurable:!0}),Object.defineProperty(t,"classicGameDataText",{get:function(){return this._classicPlayerGameData.playTimes+"："+this._classicPlayerGameData.winnerTimes+"："+this._classicPlayerGameData.winnerComboTimes+"："+this._classicPlayerGameData.loserComboTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SurvivalPlayerGameData",{get:function(){return this._survivalPlayerGameData},enumerable:!0,configurable:!0}),Object.defineProperty(t,"survivalGameDataText",{get:function(){return this._survivalPlayerGameData.playTimes+"："+this._survivalPlayerGameData.winnerTimes},enumerable:!0,configurable:!0}),t.initServerData=function(e){var i=Laya.LocalStorage.getJSON("newbieReward");i?t.newbieReward=i<2:(t.newbieReward=!1,Laya.LocalStorage.setJSON("newbieReward",2))},t.setUp=function(){var t=Laya.LocalStorage.getJSON(EnumKey.ClassicPlayerGameData);this._classicPlayerGameData=t?JSON.parse(t):new ClassicPlayerGameData;var e=Laya.LocalStorage.getJSON(EnumKey.SurvivalPlayerGameData);this._survivalPlayerGameData=e?JSON.parse(e):new SurvivalPlayerGameData;var i=Laya.LocalStorage.getJSON(EnumKey.SEE_VIDEO_TIMES),n=TimeUtil.getTimeStr();i&&n==i.time?this.seeVideoTimes=i:this.seeVideoTimes={time:n,num:0},traceLog("今天观看视频的时间和次数：",this.seeVideoTimes.time,this.seeVideoTimes.num),(i=Laya.LocalStorage.getJSON(EnumKey.LOTTERY_SEE_VIDEO_TIMES))&&n==i.time?this.lotterySeeVideoTimes=i:this.lotterySeeVideoTimes={time:n,num:0},(i=Laya.LocalStorage.getJSON(EnumKey.LOTTERY_SHARE_TIMES))&&n==i.time?this.lotteryShareTimes=i:this.lotteryShareTimes={time:n,num:0};var r=Laya.LocalStorage.getItem(EnumKey.ACTIVE_SKIN_IDS);if(this.activeSkinIDs=r?r.split(","):[],r=Laya.LocalStorage.getItem(EnumKey.NOVICE_SEE_VIDEO_TIMES),this.noviceSeeVideoTimes=r?Laya.Utils.parseInt(r):0,r=Laya.LocalStorage.getItem(EnumKey.NOVICE_CLOSE_VIDEO),this.isShowHelpVideo=!r,r=Laya.LocalStorage.getItem(EnumKey.SEASON_ID),this.seasonId=r?Laya.Utils.parseInt(r):0,this.firstWinTime=Laya.LocalStorage.getItem(EnumKey.FIRST_WIN_TIME),Laya.LocalStorage.getItem(EnumKey.LoginTime)!=n)Laya.LocalStorage.setItem(EnumKey.LoginTime,n),Laya.LocalStorage.setItem(EnumKey.SHARE_SUC_COUNT,"0"),Laya.LocalStorage.setItem(EnumKey.SHIWAN_SHARE_SUC_COUNT,"0"),this.isBrandNewDay=!0,SkinManager.reset_shiwan(),Laya.LocalStorage.setItem(EnumKey.LUCKY_BAG_DAY_TIMES,this.luckyLiheTotalTimes.toString());else{var a=Number(Laya.LocalStorage.getItem(EnumKey.LUCKY_BAG_DAY_TIMES));null==a||isNaN(a)||(this._luckyLiheTotalTimes=a),SkinManager.setup_shiwan()}var s=Laya.LocalStorage.getItem(EnumKey.IS_NEW_PLAYER);if(null!=s&&""!=s&&s!=n||SyncDataManager.score>31)this.isNewPlayer=!1;else{null!=s&&""!=s||Laya.LocalStorage.setItem(EnumKey.IS_NEW_PLAYER,n),this.isNewPlayer=!0;var o=Laya.LocalStorage.getJSON(EnumKey.NEW_PLAYER_POINTS);o&&(this.newPointArr=JSON.parse(o))}EventManager.addEvent(EDataUpdateType.ClassicPlayerGameDataUpdate,this,this.onClassicGameDataUpdate),EventManager.addEvent(EDataUpdateType.SurvivalPlayerGameDataUpdate,this,this.onSurvivalGameDataUpdate)},t.setActiveSkinIDs=function(t){this.activeSkinIDs=t;var e=this.activeSkinIDs.toString();Laya.LocalStorage.setItem(EnumKey.ACTIVE_SKIN_IDS,e)},t.onClassicGameDataUpdate=function(){var t=JSON.stringify(this._classicPlayerGameData);Laya.LocalStorage.setJSON(EnumKey.ClassicPlayerGameData,t)},t.onSurvivalGameDataUpdate=function(){var t=JSON.stringify(this._survivalPlayerGameData);Laya.LocalStorage.setJSON(EnumKey.SurvivalPlayerGameData,t)},t.getRandomMatchData=function(){for(var t=new Array,e=0;this.matchData.length>0;){e++;var i=this.matchData.splice(Math.floor(Math.random()*this.matchData.length),1)[0];i.nickName||(i.nickName=ConfigUtility.defaultName+e),i.avatarUrl||(i.avatarUrl=ConfigUtility.defaultAvatar),t.push(i)}return this.matchData=t,t.slice(0,14)},t.isGroupShared=function(e){return t.groupShareData.hasOwnProperty(e)},t.addSharedGruop=function(e){t.groupShareData[e]=e},t.addSeeVideoTimes=function(){var e=TimeUtil.getTimeStr(),i=t.seeVideoTimes.time,n=t.seeVideoTimes.num;e==i?t.seeVideoTimes.num=n+1:(t.seeVideoTimes.time=e,t.seeVideoTimes.num=1),Laya.LocalStorage.setJSON(EnumKey.SEE_VIDEO_TIMES,t.seeVideoTimes),t.noviceSeeVideoTimes++,Laya.LocalStorage.setItem(EnumKey.NOVICE_SEE_VIDEO_TIMES,t.noviceSeeVideoTimes+"")},Object.defineProperty(t,"isSeeAllVideo",{get:function(){return this.seeVideoTimes.num>=this.MAX_SEE_VIDEO_TIMES},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isPassMaxRound",{get:function(){return SyncDataManager.getDailyData(EnumDailyID.GAME_ROUND)>this.MAX_GOLD_ROUND},enumerable:!0,configurable:!0}),t.set_isGodMode=function(){this.isBrandNewDay&&RankDataManager.rankData.id<13||0==this.ClassicPlayerGameData.playTimes&&0==SyncDataManager.score?this.isGodMode=!0:this.isGodMode=!1},t.CanIPoint=function(t){for(var e=this.newPointArr.length;e--;)if(this.newPointArr[e]==t)return!1;return this.newPointArr.push(t),Laya.LocalStorage.setJSON(EnumKey.NEW_PLAYER_POINTS,JSON.stringify(this.newPointArr)),!0},Object.defineProperty(t,"isNewPlayerPlay",{get:function(){var t=Laya.LocalStorage.getItem(EnumKey.CLICK_START_GAME);return(null==t||""==t)&&0==SyncDataManager.score},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isNewTagEmpty",{get:function(){var t=Laya.LocalStorage.getItem(EnumKey.CLICK_START_GAME);return null==t||""==t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"luckyLiheTotalTimes",{get:function(){return this._luckyLiheTotalTimes},set:function(t){this._luckyLiheTotalTimes=t,Laya.LocalStorage.setItem(EnumKey.LUCKY_BAG_DAY_TIMES,this.luckyLiheTotalTimes.toString())},enumerable:!0,configurable:!0}),t.MAX_SEE_VIDEO_TIMES=10,t.MAX_GOLD_ROUND=100,t.SHARE_WAIT_FRAME=180,t.seasonId=0,t.friendHelpNum=0,t.isFriendHelp=!1,t.playTimes=0,t.matchReqTimes=0,t.rankForAuthorizeTimes=0,t.gameState=EGameState.InLoading,t.isSeeVideoAtGameOver=!1,t.prevUseSkinID=0,t.activeSkinIDs=[],t.noviceSeeVideoTimes=0,t.newbieReward=!0,t.isShowHelpVideo=!0,t.haveLoginReward=!1,t.loginRewardDay_server=0,t._localLoginRewardDay=new LoginRewardDay,t.isAlreadyInit=!1,t.matchData=[{nickName:"alex",avatarUrl:"res/ui/avatar/robot_1.png",province:"Hubei"},{nickName:"joker",avatarUrl:"res/ui/avatar/robot_2.png",province:"Jilin"},{nickName:"ηκηβ",avatarUrl:"res/ui/avatar/robot_3.png",province:"Jiangsu"},{nickName:"κηκλη",avatarUrl:"res/ui/avatar/robot_4.png",province:"Liaoning"},{nickName:"ζβκμζθξ",avatarUrl:"res/ui/avatar/robot_5.png",province:"Ningxia"},{nickName:"τΒΓχω",avatarUrl:"res/ui/avatar/robot_6.png",province:"Hubei"},{nickName:"じゅんやすひろ",avatarUrl:"res/ui/avatar/robot_7.png",province:"Zhejiang"},{nickName:"ふたばやまみか",avatarUrl:"res/ui/avatar/robot_8.png",province:"Tianjin"},{nickName:"いちざわひろし",avatarUrl:"res/ui/avatar/robot_9.png",province:"Sichuan"},{nickName:"たけちとしこ",avatarUrl:"res/ui/avatar/robot_10.png",province:"Sichuan"},{nickName:"Elma Yeates",avatarUrl:"res/ui/avatar/robot_11.png",province:"Shanghai"},{nickName:"Daphne Ted",avatarUrl:"res/ui/avatar/robot_12.png",province:"Shaanxi"},{nickName:"Carl Saxton",avatarUrl:"res/ui/avatar/robot_13.png",province:"Shandong"},{nickName:"Natalie Carey",avatarUrl:"res/ui/avatar/robot_14.png",province:"Ningxia"},{nickName:"Kerwin Black",avatarUrl:"res/ui/avatar/robot_15.png",province:"Liaoning"},{nickName:"Vivian Joyce",avatarUrl:"res/ui/avatar/robot_16.png",province:"Guangdong"},{nickName:"Trần Đức Lương",avatarUrl:"res/ui/avatar/robot_17.png",province:"Liaoning"},{nickName:"Nông Đức Mạnh",avatarUrl:"res/ui/avatar/robot_18.png",province:"Hunan"},{nickName:"Phan Văn Khải",avatarUrl:"res/ui/avatar/robot_19.png",province:"Guangdong"},{nickName:"Viola Robin",avatarUrl:"res/ui/avatar/robot_20.png",province:"Guangdong"},{nickName:"Tracy Harte",avatarUrl:"res/ui/avatar/robot_21.png",province:"Guangdong"},{nickName:"Orville Daisy",avatarUrl:"res/ui/avatar/robot_22.png"},{nickName:"Ronald Wolf",avatarUrl:"res/ui/avatar/robot_23.png"},{nickName:"Mark Cissie",avatarUrl:"res/ui/avatar/robot_24.png"},{nickName:"Kennedy Hazlitt",avatarUrl:"res/ui/avatar/robot_25.png"},{nickName:"Donna Tennyson",avatarUrl:"res/ui/avatar/robot_26.png"},{nickName:"Odelia Tate",avatarUrl:"res/ui/avatar/robot_27.png"},{nickName:"Jay Lindsay",avatarUrl:"res/ui/avatar/robot_29.png"},{nickName:"Conrad Pearson",avatarUrl:"res/ui/avatar/robot_30.png"},{nickName:"Bart Ernest",avatarUrl:"res/ui/avatar/robot_31.png"},{nickName:"Tabitha Hutt",avatarUrl:"res/ui/avatar/robot_32.png"},{nickName:"Alice McCarthy",avatarUrl:"res/ui/avatar/robot_33.png"},{nickName:"Ernest Woolley",avatarUrl:"res/ui/avatar/robot_34.png"},{nickName:"Edwiin Ferguson",avatarUrl:"res/ui/avatar/robot_35.png"},{nickName:"Alberta Chapman",avatarUrl:"res/ui/avatar/robot_36.png"},{nickName:"Winni Adams",avatarUrl:"res/ui/avatar/robot_37.png"},{nickName:"Luther Benson",avatarUrl:"res/ui/avatar/robot_38.png"},{nickName:"Cash Spender",avatarUrl:"res/ui/avatar/robot_39.png"},{nickName:"Claude Curme",avatarUrl:"res/ui/avatar/robot_40.png"},{nickName:"Poppy Dierser",avatarUrl:"res/ui/avatar/robot_41.png"},{nickName:"Luther Benson",avatarUrl:"res/ui/avatar/robot_42.png"},{nickName:"Cash Spender",avatarUrl:"res/ui/avatar/robot_43.png"},{nickName:"Eugênia Câmara",avatarUrl:"res/ui/avatar/robot_44.png"},{nickName:"Letícia",avatarUrl:"res/ui/avatar/robot_45.png"},{nickName:"José Basilio",avatarUrl:"res/ui/avatar/robot_46.png"},{nickName:"José",avatarUrl:"res/ui/avatar/robot_47.png"},{nickName:"Luís Filipe",avatarUrl:"res/ui/avatar/robot_48.png"},{nickName:"Leilah Assunção",avatarUrl:"res/ui/avatar/robot_49.png"},{nickName:"Márcia",avatarUrl:"res/ui/avatar/robot_50.png"}],t.groupShareData={},t.isNewPlayer=!1,t.newPointArr=new Array,t.isBrandNewDay=!1,t.isGetLuckyLihe=!1,t._luckyLiheTotalTimes=0,t}(),SkinManager=function(){function t(){}return t.getSkinData=function(t){for(var e=SyncDataManager.skinData,i=0;i<e.length;i++){var n=e[i];if(t==n.skinId)return n}return null},t.isHaveSkin=function(e){var i=t.getSkinData(e);return!(!i||-1!=i.gainTime)},t.buySkin=function(t){for(var e=!1,i=SkinConfig.getDataById(t),n=SyncDataManager.skinData,r=0;r<n.length;r++){var a=n[r];if(a.skinId==t){a.finishCount=i.conditionalValue,a.gainTime=-1,e=!0;break}}if(!e){var s={};s.finishCount=i.conditionalValue,s.gainTime=-1,s.skinId=i.id,n.push(s)}SyncDataManager.skinData=n},t.addSkin=function(t,e){var i=Laya.Browser.now();if(-1!=e){for(var n=SyncDataManager.skinData,r=0;r<n.length;r++)if(t==n[r].skinId&&-1==n[r].gainTime)return;e=i+24*e*60*60*1e3}var a=!1,s=SkinConfig.getDataById(t);for(n=SyncDataManager.skinData,r=0;r<n.length;r++){var o=n[r];if(o.skinId==t){o.finishCount=s.conditionalValue,-1==e||-1==o.gainTime?o.gainTime=-1:o.gainTime>i?o.gainTime+=e-i:o.gainTime=e,a=!0;break}}if(!a){var l={};l.finishCount=s.conditionalValue,l.gainTime=e,l.skinId=s.id,n.push(l)}SyncDataManager.skinData=n},t.setSkinData_video=function(t,e){for(var i=SyncDataManager.skinData,n=0;n<SkinConfig.allSkins.length;n++)if(SkinConfig.allSkins[n].id==t){for(var r=SkinConfig.allSkins[n],a=null,s=0;s<i.length;s++){var o=i[s];if(o.skinId==r.id){o.finishCount>=r.conditionalValue?o.gainTime>0&&o.gainTime<Laya.Browser.now()&&(o.finishCount=e,o.finishCount>=r.conditionalValue&&(o.finishCount=r.conditionalValue,-1!=r.haveDays?o.gainTime=Laya.Browser.now()+24*r.haveDays*60*60*1e3:o.gainTime=-1)):(o.finishCount+=e,o.finishCount>=r.conditionalValue&&(o.finishCount=r.conditionalValue,-1!=r.haveDays?o.gainTime=Laya.Browser.now()+24*r.haveDays*60*60*1e3:o.gainTime=-1)),a=o;break}}a||((a={}).skinId=r.id,a.finishCount=e,e>=r.conditionalValue&&(-1!=r.haveDays?a.gainTime=Laya.Browser.now()+24*r.haveDays*60*60*1e3:a.gainTime=-1),i.push(a))}SyncDataManager.skinData=i},t.setSkinData=function(t,e){for(var i=SyncDataManager.skinData,n=0;n<SkinConfig.allSkins.length;n++)if(SkinConfig.allSkins[n].obtainCondition==t){for(var r=SkinConfig.allSkins[n],a=null,s=0;s<i.length;s++){var o=i[s];if(o.skinId==r.id){o.finishCount>=r.conditionalValue?o.gainTime>0&&o.gainTime<Laya.Browser.now()&&(o.finishCount=e,o.finishCount>=r.conditionalValue&&(o.finishCount=r.conditionalValue,-1!=r.haveDays?o.gainTime=Laya.Browser.now()+24*r.haveDays*60*60*1e3:o.gainTime=-1)):(o.finishCount+=e,o.finishCount>=r.conditionalValue&&(o.finishCount=r.conditionalValue,-1!=r.haveDays?o.gainTime=Laya.Browser.now()+24*r.haveDays*60*60*1e3:o.gainTime=-1)),a=o;break}}a||((a={}).skinId=r.id,a.finishCount=e,e>=r.conditionalValue&&(-1!=r.haveDays?a.gainTime=Laya.Browser.now()+24*r.haveDays*60*60*1e3:a.gainTime=-1),i.push(a))}SyncDataManager.skinData=i},t.getSkinIndexByID=function(t){for(var e=SkinConfig.allSkins.length;e--;)if(SkinConfig.allSkins[e].id==t)return e;return 0},Object.defineProperty(t,"RandomSkinIndex_fix",{get:function(){var t=0;return((t=HelperExtension.coinTest(.88)?Math.floor(HelperExtension.random(0,8)):HelperExtension.coinTest(.5)?Math.floor(HelperExtension.random(8,13)):Math.floor(HelperExtension.random(14,17)))<0||t>=SkinConfig.allSkins.length)&&(t=5),t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"RandomSkinIndex",{get:function(){for(var t=Math.floor(HelperExtension.random(0,SkinConfig.totalAISkinWeight)),e=SkinConfig.allSkins.length,i=0,n=0;n<e;n++)if(0!=SkinConfig.allSkins[n].AISkinWeight&&(i+=SkinConfig.allSkins[n].AISkinWeight)>=t)return n;return 0},enumerable:!0,configurable:!0}),t.skinGameOutUrlByID=function(t){return ConfigUtility.baseUrl+this.skinGame_prefix+SkinConfig.getDataById(t).skinName+".png"},t.skinGameOutUrlByIndex=function(t){return t>=0&&t<SkinConfig.allSkins.length?ConfigUtility.baseUrl+this.skinGame_prefix+SkinConfig.allSkins[t].skinName+".png":ConfigUtility.baseUrl+this.skinGame_prefix+SkinConfig.allSkins[0].skinName+".png"},t.getSkinUIUrlByID=function(t){var e=SkinConfig.getDataById(t);return e?this.skinUI_prefix+e.skinName+".png":null},Object.defineProperty(t,"TheCurUseSkinID",{get:function(){return this.isUseShiWanSkin?this.curUseShiwanID:SyncDataManager.curSkinId},enumerable:!0,configurable:!0}),t.getAllCanShiYongSkins=function(){for(var e=[],i=SkinConfig.getDataByQuality(3),n=0;n<i.length;n++)i[n].isShield&&!ConfigUtility.IsSafeVersion&&(i.splice(n,1),n--);i.forEach(function(i){var n=!1,r=t.getSkinData(i.id);(r&&(-1==r.gainTime||r.finishCount>=i.conditionalValue)||0==i.obtainCondition)&&(n=!0),!n&&i.openDemo>0&&t.localALreadyShiWanSkin.get(i.id)<GameSetting.instance.SkinDemoTimes&&e.push(i)}),Math.min(e.length,4);var r=[],a=[];for(n=0;n<e.length;n++)7==e[n].obtainCondition&&(a.push(e[n]),e.splice(n,1),n--);if(a.forEach(function(t){Math.ceil(100*Math.random())<100*t.openDemo&&(r[0]=t)}),r[0])if(e.length>3)this.getArrayItems(e,3).forEach(function(t){r.push(t)});else for(this.getArrayItems(e,e.length).forEach(function(t){r.push(t)}),n=e.length;n<3;n++)r.push(null);else if(e.length>4)this.getArrayItems(e,4).forEach(function(t){r.push(t)});else for(this.getArrayItems(e,e.length).forEach(function(t){r.push(t)}),n=e.length;n<4;n++)r.push(null);return r},t.setup_shiwan=function(){var t=Laya.LocalStorage.getJSON(EnumKey.AlreadyShiWanData);if(t)for(var e=JSON.parse(t),i=e._keys.length;i--;)this.localALreadyShiWanSkin.set(e._keys[i],e._values[i])},t.reset_shiwan=function(){var t=JSON.stringify(this.localALreadyShiWanSkin);Laya.LocalStorage.setJSON(EnumKey.AlreadyShiWanData,t)},t.judge_isuse_shiwan_skin=function(){t.isUseShiWanSkin&&null!=this.allShiWanSkin.get(this.curUseShiwanID)&&this.allShiWanSkin.remove(this.curUseShiwanID)},t.add_shiwan_skin=function(t){this.allShiWanSkin.set(t,t);var e=this.localALreadyShiWanSkin.get(t);e?e++:e=1,this.localALreadyShiWanSkin.set(t,e),this.reset_shiwan()},t.judge_the_skin=function(e){return null!=t.allShiWanSkin.get(e)?1:t.localALreadyShiWanSkin.keys.length>=100?3:t.localALreadyShiWanSkin.get(e)>GameSetting.instance.SkinDemoTimes?0:2},t.getArrayItems=function(t,e){var i=new Array;for(var n in t)i.push(t[n]);for(var r=new Array,a=0;a<e&&i.length>0;a++){var s=Math.floor(Math.random()*i.length);r[a]=i[s],i.splice(s,1)}return r},t.skinUI_prefix="res/skinUI/",t.skinGame_prefix="res/skinGame/",t.defaultSkinID=1,t.isUseShiWanSkin=!1,t.curUseShiwanID=0,t.localALreadyShiWanSkin=new Laya.Dictionary,t.allShiWanSkin=new Laya.Dictionary,t}(),EAnimateModeType;!function(t){t[t.BOY=0]="BOY",t[t.CAR=1]="CAR",t[t.FISH=2]="FISH",t[t.SHIP=3]="SHIP"}(EAnimateModeType||(EAnimateModeType={}));var standInfo=function(){},AnimatedManager=function(){function t(){}return Object.defineProperty(t,"AnimatePeopleCopy",{get:function(){var t=this.AllAnimatePeople.shift();return this.AllAnimatePeople.push(t),t.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AnimateCarCopy",{get:function(){var t=this.AllAnimateCar.shift();return this.AllAnimateCar.push(t),t.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AnimateSharkCopy",{get:function(){var t=this.AllAnimateShark.shift();return this.AllAnimateShark.push(t),t.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AnimateBoatCopy",{get:function(){var t=this.AllAnimateBoat.shift();return this.AllAnimateBoat.push(t),t.clone()},enumerable:!0,configurable:!0}),t.update=function(){for(var t=this.AllStandBoy.length;t--;)this.AllStandBoy[t].isDetect&&this.AllStandBoy[t].standUpdate()},t.resetAll=function(){for(var t=this.AllStandBoy.length;t--;)this.AllStandBoy[t].playAnimation(BoyClipName.idle)},t.recover_Animated=function(){this.AllStandBoy=new Array},t.init=function(e){for(var i=e.numChildren;i--;){var n=e.getChildAt(i);if(n){for(var r=n.numChildren;r--;){var a=n.getChildAt(r),s=a.name.substring(0,a.name.lastIndexOf("_"));"boy01"==s?t.AllAnimatePeople.push(a):"probs_car"==s?t.AllAnimateCar.push(a):"shark"==s?t.AllAnimateShark.push(a):"Island"==s&&t.AllAnimateBoat.push(a)}n.removeChildren(0,n.numChildren),e.removeChild(n)}}},t.GenerateStand=function(e){var i=new Sprite3D("StandNode");switch(e){case EAnimateModeType.BOY:for(var n=this.AllStandInfoMap[SceneManager.CurrentSceneTag].length;n--;){var r=this.AnimatePeopleCopy;i.addChild(r),r.transform.position=this.AllStandInfoMap[SceneManager.CurrentSceneTag][n].pos.clone(),r.transform.rotation=this.AllStandInfoMap[SceneManager.CurrentSceneTag][n].rot.clone();var a=BuildConfig.instance.getConfigByName(r.name),s=new AnimateModelEntity;s.setUp(r,a,EAnimateType.boy_stand),t.AllStandBoy.push(s)}break;case EAnimateModeType.CAR:case EAnimateModeType.FISH:case EAnimateModeType.SHIP:}return i},t.setUp=function(t){if(null==this.AllStandInfoMap[SceneManager.CurrentSceneTag]&&(this.AllStandInfoMap[SceneManager.CurrentSceneTag]=new Array),!(null!=this.AllStandInfoMap[SceneManager.CurrentSceneTag]&&this.AllStandInfoMap[SceneManager.CurrentSceneTag].length>0)){var e=t.getChildByName("allStand");if(e){for(var i=e.numChildren;i--;){var n=e.getChildAt(i);if("boy01"==n.name.substring(0,n.name.lastIndexOf("_"))){var r=new standInfo;r.pos=n.transform.position.clone(),r.rot=n.transform.rotation.clone(),this.AllStandInfoMap[SceneManager.CurrentSceneTag].push(r)}}e.removeChildren(0,e.numChildren),t.removeChild(e)}}},t.AllAnimatePeople=new Array,t.AllAnimateCar=new Array,t.AllAnimateShark=new Array,t.AllAnimateBoat=new Array,t.AllStandBoy=new Array,t.AllStandInfoMap=new Array,t}(),PathFinderManager=function(){function t(){this.PeopleNode=new Sprite3D("PeopleNode"),this.CarNode=new Sprite3D("CarNode"),this.BoatNode=new Sprite3D("BoatNode"),this.SharkNode=new Sprite3D("SharkNode"),this.AllFinder=new Array,this.PeopleAmount=6,this.CarAmount=5,this.BoatAmount=5,this.SharkAmount=3,this.PeopleDelay=6500,this.CarDelay=7e3,this.BoatDelay=7e3,this.SharkDelay=8e3,this.PeopleSpeed=.003,this.CarSpeed=.006,this.BoatSpeed=.005,this.SharkSpeed=.006,console.log("___________________PathFinderManager___________________"),GameManager.EventManagerEx.AddListener(EventSetting.on_already_to_play,new EventListener(this.on_already_to_play.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_classic_over,new EventListener(this.on_game_over.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_survival_over,new EventListener(this.on_game_over.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_exit_game,new EventListener(this.on_exit_game.bind(this)))}return Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.SpawnBoyFinder=function(t){var e=AnimatedManager.AnimatePeopleCopy;this.PeopleNode.addChild(e);var i=BuildConfig.instance.getConfigByName(e.name),n=Laya.Pool.getItemByClass("AnimateModelEntity",AnimateModelEntity);n.setUp(e,i,EAnimateType.boy_finder);var r=Laya.Pool.getItemByClass("PathfinderEntity",PathfinderEntity);r.setUp(t,n,this.PeopleSpeed),null==this.AllFinder[t.name]&&(this.AllFinder[this.AllFinder.length]=this.AllFinder[t.name]=new Array),this.AllFinder[t.name].push(r)},t.prototype.SpawnCarFinder=function(t){var e=AnimatedManager.AnimateCarCopy;this.CarNode.addChild(e);var i=BuildConfig.instance.getConfigByName(e.name),n=Laya.Pool.getItemByClass("AnimateModelEntity",AnimateModelEntity);n.setUp(e,i,EAnimateType.car_finder);var r=Laya.Pool.getItemByClass("PathfinderEntity",PathfinderEntity);r.setUp(t,n,this.CarSpeed),null==this.AllFinder[t.name]&&(this.AllFinder[this.AllFinder.length]=this.AllFinder[t.name]=new Array),this.AllFinder[t.name].push(r)},t.prototype.SpawnBoatFinder=function(t){var e=AnimatedManager.AnimateBoatCopy;this.BoatNode.addChild(e);var i=BuildConfig.instance.getConfigByName(e.name),n=Laya.Pool.getItemByClass("AnimateModelEntity",AnimateModelEntity);n.setUp(e,i,EAnimateType.ship_finder);var r=Laya.Pool.getItemByClass("PathfinderEntity",PathfinderEntity);r.setUp(t,n,this.BoatSpeed),null==this.AllFinder[t.name]&&(this.AllFinder[this.AllFinder.length]=this.AllFinder[t.name]=new Array),this.AllFinder[t.name].push(r)},t.prototype.SpawnSharkFinder=function(t){var e=AnimatedManager.AnimateSharkCopy;this.SharkNode.addChild(e);var i=BuildConfig.instance.getConfigByName(e.name),n=Laya.Pool.getItemByClass("AnimateModelEntity",AnimateModelEntity);n.setUp(e,i,EAnimateType.fish_finder);var r=Laya.Pool.getItemByClass("PathfinderEntity",PathfinderEntity);r.setUp(t,n,this.SharkSpeed),null==this.AllFinder[t.name]&&(this.AllFinder[this.AllFinder.length]=this.AllFinder[t.name]=new Array),this.AllFinder[t.name].push(r)},t.prototype.GenerateAnimateBoy=function(){for(var t=PathWayManager.AllPeoplePathWay.length;t--;)for(var e=PathWayManager.AllPeoplePathWay[t],i=this.PeopleAmount;i--;)this.SpawnBoyFinder(e);return this.PeopleNode},t.prototype.GenerateAnimateCar=function(){for(var t=PathWayManager.AllCarPathWay.length;t--;)for(var e=PathWayManager.AllCarPathWay[t],i=this.CarAmount;i--;)this.SpawnCarFinder(e);return this.CarNode},t.prototype.GenerateAnimateBoat=function(){for(var t=PathWayManager.AllBoatPathWay.length;t--;)for(var e=PathWayManager.AllBoatPathWay[t],i=this.BoatAmount;i--;)this.SpawnBoatFinder(e);return this.BoatNode},t.prototype.GenerateAnimateShark=function(){for(var t=PathWayManager.AllSharkPathWay.length;t--;)for(var e=PathWayManager.AllSharkPathWay[t],i=this.SharkAmount;i--;)this.SpawnSharkFinder(e);return this.SharkNode},t.prototype.GenerateAnimate=function(t){switch(t){case EAnimateType.boy_finder:return this.GenerateAnimateBoy();case EAnimateType.car_finder:return this.GenerateAnimateCar();case EAnimateType.fish_finder:return this.GenerateAnimateShark();case EAnimateType.ship_finder:return this.GenerateAnimateBoat()}},t.prototype.on_already_to_play=function(){this.active_finder()},t.prototype.on_game_over=function(){this.unactive_finder()},t.prototype.on_exit_game=function(){this.unactive_finder()},t.prototype.active_finder=function(){for(var t=this.AllFinder.length;t--;)for(var e=this.AllFinder[t],i=0;i<e.length;i++)switch(e[i].animateType){case EAnimateType.boy_finder:Laya.timer.once(i*this.PeopleDelay,e[i],e[i].enable,[!0]);break;case EAnimateType.car_finder:Laya.timer.once(i*this.CarDelay,e[i],e[i].enable,[!0]);break;case EAnimateType.fish_finder:Laya.timer.once(i*this.SharkDelay,e[i],e[i].enable,[!0]);break;case EAnimateType.ship_finder:Laya.timer.once(i*this.BoatDelay,e[i],e[i].enable,[!0])}},t.prototype.unactive_finder=function(){for(var t=this.AllFinder.length;t--;)for(var e=this.AllFinder[t],i=0;i<e.length;i++)e[i].enable(!1)},t.prototype.recover_finder=function(){for(var t=this.AllFinder.length;t--;)for(var e=this.AllFinder.pop(),i=0;i<e.length;i++){var n=e.pop();Laya.Pool.recover("PathfinderEntity",n)}this.AllFinder=new Array,this.PeopleNode=new Sprite3D("PeopleNode"),this.CarNode=new Sprite3D("CarNode")},t}(),EPathType;!function(t){t[t.BOY=0]="BOY",t[t.CAR=1]="CAR",t[t.SHARK=2]="SHARK",t[t.BOAT=3]="BOAT"}(EPathType||(EPathType={}));var PathWayManager=function(){function t(){}return Object.defineProperty(t,"AllPeoplePathWay",{get:function(){return this.AllPathWay[EPathType.BOY]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AllCarPathWay",{get:function(){return this.AllPathWay[EPathType.CAR]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AllSharkPathWay",{get:function(){return this.AllPathWay[EPathType.SHARK]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AllBoatPathWay",{get:function(){return this.AllPathWay[EPathType.BOAT]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PeoplePathWay",{get:function(){return this.AllPeoplePathWay&&this.peopleIndex!=this.AllPeoplePathWay.length||(this.peopleIndex=0),this.AllPeoplePathWay[this.peopleIndex++]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CarPathWay",{get:function(){return this.AllCarPathWay&&this.carIndex!=this.AllCarPathWay.length||(this.carIndex=0),this.AllCarPathWay[this.carIndex++]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SharkPathWay",{get:function(){return this.AllSharkPathWay&&this.sharkIndex!=this.AllSharkPathWay.length||(this.sharkIndex=0),this.AllSharkPathWay[this.sharkIndex++]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BoatPathWay",{get:function(){return this.AllBoatPathWay&&this.boatIndex!=this.AllBoatPathWay.length||(this.boatIndex=0),this.AllBoatPathWay[this.boatIndex++]},enumerable:!0,configurable:!0}),t.setUp=function(t){switch(SceneManager.CurrentSceneTag){case ESceneTag.CITY1:var e=t.getChildByName("allPeoplePath");if(e)if(null!=this.AllPathWay[EPathType.BOY]&&this.AllPathWay[EPathType.BOY].length>0);else{for(this.AllPathWay[EPathType.BOY]=new Array,a=e.numChildren;a--;)if((s=e.getChildAt(a)).numChildren>0){for((o=new PathWay).name="peoplePath_"+a,o.ponits=new Array,l=0;l<s.numChildren;l++)h=s.getChildAt(l),o.ponits.push(new WayPoint(h.transform));this.AllPathWay[EPathType.BOY].push(o)}e.removeChildren(0,e.numChildren),t.removeChild(e)}var i=t.getChildByName("allCarPath");if(i)if(null!=this.AllPathWay[EPathType.CAR]&&this.AllPathWay[EPathType.CAR].length>0);else{for(this.AllPathWay[EPathType.CAR]=new Array,a=i.numChildren;a--;)if((s=i.getChildAt(a)).numChildren>0){for((o=new PathWay).name="carPath_"+a,o.ponits=new Array,l=0;l<s.numChildren;l++)h=s.getChildAt(l),o.ponits.push(new WayPoint(h.transform));this.AllPathWay[EPathType.CAR].push(o)}i.removeChildren(0,i.numChildren),t.removeChild(i)}break;case ESceneTag.HAIDAO1:var n=t.getChildByName("allFishPath");if(n)if(null!=this.AllPathWay[EPathType.SHARK]&&this.AllPathWay[EPathType.SHARK].length>0);else{for(this.AllPathWay[EPathType.SHARK]=new Array,a=n.numChildren;a--;)if((s=n.getChildAt(a)).numChildren>0){for((o=new PathWay).name="carPath_"+a,o.ponits=new Array,l=0;l<s.numChildren;l++)h=s.getChildAt(l),o.ponits.push(new WayPoint(h.transform));this.AllPathWay[EPathType.SHARK].push(o)}n.removeChildren(0,n.numChildren),t.removeChild(n)}var r=t.getChildByName("allBoatPath");if(r)if(null!=this.AllPathWay[EPathType.BOAT]&&this.AllPathWay[EPathType.BOAT].length>0);else{this.AllPathWay[EPathType.BOAT]=new Array;for(var a=r.numChildren;a--;){var s=r.getChildAt(a);if(s.numChildren>0){var o=new PathWay;o.name="carPath_"+a,o.ponits=new Array;for(var l=0;l<s.numChildren;l++){var h=s.getChildAt(l);o.ponits.push(new WayPoint(h.transform))}this.AllPathWay[EPathType.BOAT].push(o)}}r.removeChildren(0,r.numChildren),t.removeChild(r)}}},t.AllPathWay=new Array,t.peopleIndex=0,t.carIndex=0,t.sharkIndex=0,t.boatIndex=0,t}(),GameObjectManager=function(){},ActivityManager=function(){function t(){}return t.setup=function(t){this.openedIdAry=t||new Array},Object.defineProperty(t,"getStatus",{get:function(){if(!this._getStatus){var t=Laya.LocalStorage.getJSON(EnumKey.ACTIVITY_GET_STATUS);this._getStatus=t||{}}return this._getStatus},set:function(t){t&&(this._getStatus=t,Laya.LocalStorage.setJSON(EnumKey.ACTIVITY_GET_STATUS,this._getStatus))},enumerable:!0,configurable:!0}),t.hasGotPrize=function(t){return this.getStatus.activityId==t&&this.getStatus.status},t._getStatus=null,t}(),ParticleManager=function(){function t(){}return t.init=function(t){for(var e,i=t.numChildren;i--;){var n=t.getChildAt(i);switch(n.name.substring(n.name.lastIndexOf("_")+1,n.name.length)){case"u":case"d":var r=(e=t.getChildAt(i)).name.lastIndexOf("_"),a=e.name.substring(0,r);e.transform.position=new Vector3(0,e.transform.position.y,0),e.transform.scale=new Vector3(2.5,2.5,2.5),this.allParticle[a]=e;break;case"m":var s=(e=t.getChildAt(i)).name.lastIndexOf("_"),o=e.name.substring(0,s);e.transform.position=new Vector3(0,e.transform.position.y,0),e.transform.scale=new Vector3(2.5,2.5,2.5),this.allParticle[o]=e;break;case"x":var l=(e=t.getChildAt(i)).name.lastIndexOf("_"),h=e.name.substring(0,l);e.transform.position=new Vector3(0,e.transform.position.y,0),e.transform.scale=new Vector3(2.5,2.5,2.5),this.allParticleSkin[h]=e}}},t.setParticle=function(t,e){if(this.allParticle&&this.allParticle[e]){var i=Sprite3D.instantiate(this.allParticle[e]);switch(i.name.substring(i.name.lastIndexOf("_")+1,i.name.length)){case"u":var n=i;n.particleRender.material.renderQueue=5e3,t.addChild(n);break;case"d":var r=i;r.particleRender.material.renderQueue=3e3,t.addChild(r);break;case"m":for(var a=i,s=a.numChildren;s--;){var o=a.getChildAt(s);if(o instanceof Laya.ShuriKenParticle3D)"u"==(l=o.name.substring(o.name.lastIndexOf("_")+1,o.name.length))?o.particleRender.material.renderQueue=5e3:"d"==l&&(o.particleRender.material.renderQueue=3e3);else if(o instanceof MeshSprite3D){var l=o.name.substring(o.name.lastIndexOf("_")+1,o.name.length);"u"==l?o.meshRender.material.renderQueue=5e3:"d"==l&&(o.meshRender.material.renderQueue=3e3)}}t.addChild(a)}}},t.setParticleSkin=function(t,e){if(this.allParticleSkin&&this.allParticleSkin[e]){var i=Sprite3D.instantiate(this.allParticleSkin[e]);this.setAllRenderQueue(i),t.addChild(i)}},t.setAllRenderQueue=function(t){for(var e=t.numChildren;e--;){var i=t.getChildAt(e);i instanceof MeshSprite3D?i.meshRender.material.renderQueue=3e3:i instanceof ShuriKenParticle3D&&(i.particleRender.material.renderQueue=5e3),this.setAllRenderQueue(i)}},t.allParticle=new Array,t.allParticleSkin=new Array,t}(),ESceneTag;!function(t){t[t.CITY1=0]="CITY1",t[t.HAIDAO1=1]="HAIDAO1"}(ESceneTag||(ESceneTag={}));var SceneEntity=function(){},SceneManager=function(){function t(){}return Object.defineProperty(t,"IsCommonLoaded",{set:function(t){this._isCommonLoaded=t,this.IsSceneLoaded&&(GameManager.isOnline||GameManager.EventManagerEx.RaiseEvent(EventSetting.on_resource_loaded))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsSceneLoaded",{get:function(){return this._isSceneLoaded&&this._isCommonLoaded},set:function(t){this._isSceneLoaded=t,this.IsSceneLoaded&&(GameManager.isOnline||GameManager.EventManagerEx.RaiseEvent(EventSetting.on_resource_loaded))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CurrentSceneTag",{get:function(){return this._CurrentSceneTag},set:function(t){this._CurrentSceneTag=t,Laya.LocalStorage.setItem(EnumKey.Game_Mode,this._CurrentSceneTag.toString())},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsNeedChangeScene",{get:function(){return this._PreSceneTag!=this._CurrentSceneTag},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsNeedLoadOther",{get:function(){return FenceEntity.IsNeedLoadOther},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PreScene",{get:function(){return this.allSceneMap[this._PreSceneTag]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CurrentScene",{get:function(){return this.allSceneMap[this._CurrentSceneTag]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"mainTag",{get:function(){return this.allSceneMap[this._CurrentSceneTag].mainTag},enumerable:!0,configurable:!0}),Object.defineProperty(t,"otherTag",{get:function(){return this.allSceneMap[this._CurrentSceneTag].otherTag},enumerable:!0,configurable:!0}),Object.defineProperty(t,"commonTag",{get:function(){return ConfigUtility.baseUrl+"res/scenes/common/LayaScene_common/common.ls"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"particleTag",{get:function(){return ConfigUtility.baseUrl+"res/scenes/common/LayaScene_particle/particle.ls"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"animateTag",{get:function(){return ConfigUtility.baseUrl+"res/scenes/common/LayaScene_animate/animate.ls"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ballTag",{get:function(){return ConfigUtility.baseUrl+"res/scenes/ball/LayaScene_ball/ball.lh"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"particle_BallBreak_Tag",{get:function(){return ConfigUtility.baseUrl+"res/scenes/particle/LayaScene_particle/particle_BallBreak.lh"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"commonSceneUrl",{get:function(){return[this.commonTag,this.animateTag,this.ballTag,this.particle_BallBreak_Tag]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"mainSceneUrl",{get:function(){return[this.otherTag,this.mainTag]},enumerable:!0,configurable:!0}),t.setUp=function(){var t=ConfigUtility.baseUrl+"res/scenes/";this.allSceneMap=new Array;var e=new SceneEntity;e.mainTag=t+"haidao1/LayaScene_Island/Island.ls",e.otherTag=t+"haidao1/LayaScene_other/other.ls",e.disposeTag=t+"haidao1/LayaScene_Island/Island.json",this.allSceneMap[ESceneTag.HAIDAO1]=e;var i=new SceneEntity;i.mainTag=t+"city2/LayaScene_main/main.ls",i.otherTag=t+"city2/LayaScene_other/other.ls",i.disposeTag=t+"city2/LayaScene_main/main.json",this.allSceneMap[ESceneTag.CITY1]=i;var n=Number(Laya.LocalStorage.getItem(EnumKey.Game_Mode));null==n||isNaN(n)||(this._CurrentSceneTag=n),GameManager.EventManagerEx.AddListener(EventSetting.on_match_over,new EventListener(this.on_match_over.bind(this)))},t.judge_change_scene=function(){if(LiheManagaer.removeAllLihe(),null==this._PreSceneTag)this._isSceneLoaded=!1,this.load_sence();else{var t=this.scene.removeChildByName("MysteriousBagNode");t&&t.destroy(),LiheManagaer.clearAll(),this.IsNeedChangeScene?(this._isSceneLoaded=!1,DetectManager.Instance.reset_all_model(),PathFinderManager.instance.recover_finder(),AnimatedManager.recover_Animated(),this.scene.removeChildByName("PeopleNode"),this.scene.removeChildByName("CarNode"),this.scene.removeChildByName("StandNode"),this.scene.removeChildByName("BoatNode"),this.scene.removeChildByName("SharkNode"),this.scene.removeChildByName("RemoteNode"),this.scene.removeChildByName("AINode"),this.scene.removeChildByName("LiheNode"),this.scene.removeChild(CrownEntity.Sprite3D),Laya.loader.clearRes(this.PreScene.mainTag),this.scene.destroy(),this.load_sence(this.IsNeedLoadOther)):(this.scene.removeChildByName("AINode"),this._isSceneLoaded=!0)}},t.init_common=function(){var e=Laya.loader.getRes(t.commonTag);if(null!=e){var i=e.getChildByName("HG");i&&CrownEntity.init(i);var n=e.getChildByName("L");if(n){var r=n.getChildByName("lihe");LiheManagaer.init(r)}}var a=Laya.loader.getRes(t.particleTag);null!=a&&ParticleManager.init(a);var s=Laya.loader.getRes(t.animateTag);null!=s&&AnimatedManager.init(s)},t.init_other=function(){var e=Loader.getRes(t.otherTag);null!=e&&(PathWayManager.setUp(e),FenceEntity.setup(e),AnimatedManager.setUp(e)),Loader.clearRes(t.otherTag)},t.init_main=function(){this.init_pickable(),this.init_unPickable()},t.load_common=function(){Laya.loader.create(t.commonSceneUrl,Laya.Handler.create(this,this.onCommonLoaded))},t.onCommonLoaded=function(){this.init_common(),this.IsCommonLoaded=!0},t.load_sence=function(e){void 0===e&&(e=!0),e?Laya.loader.create(t.mainSceneUrl,Laya.Handler.create(this,this.onSceneLoaded)):Laya.loader.create(t.mainTag,Laya.Handler.create(this,this.onSceneLoaded))},t.onSceneLoaded=function(){if(this._isCommonLoaded){if(this.scene=Laya.loader.getRes(t.mainTag),null!=this.scene)switch(this.init_other(),this.init_main(),this.CurrentSceneTag){case ESceneTag.CITY1:this.scene.addChild(PathFinderManager.instance.GenerateAnimateBoy()),this.scene.addChild(PathFinderManager.instance.GenerateAnimateCar()),this.scene.addChild(AnimatedManager.GenerateStand(EAnimateModeType.BOY));break;case ESceneTag.HAIDAO1:this.scene.addChild(PathFinderManager.instance.GenerateAnimate(EAnimateType.fish_finder)),this.scene.addChild(PathFinderManager.instance.GenerateAnimate(EAnimateType.ship_finder))}CameraController.instance.init(),this.IsSceneLoaded=!0,this._PreSceneTag=this._CurrentSceneTag}else Laya.timer.once(500,this,this.onSceneLoaded)},t.init_pickable=function(){var t=this.scene.getChildByName(Scene3DController.ModelParentName);if(t){for(var e=0;e<t.numChildren;e++){var i=t.getChildAt(e);i.meshRender.castShadow=!0;var n=BuildConfig.instance.getConfigByName(i.name);n?Laya.Pool.getItemByClass("ModelEntity",ModelEntity).setUp(i,n):console.log(i.name)}console.log("pickAble children num",t.numChildren)}},t.init_unPickable=function(){var t=this.scene.getChildByName("unPickable");if(t)switch(this.CurrentSceneTag){case ESceneTag.CITY1:t.getChildByName("road01_dabang").meshRender.material.renderQueue=5e3;break;case ESceneTag.HAIDAO1:t.getChildByName("Island_Baobian").meshRender.material.renderQueue=5e3}},t.init_standAnimate=function(){var t=this.scene.getChildByName(Scene3DController.StandAnimateParentName);if(t)for(var e=0;e<t.numChildren;e++){var i=t.getChildAt(e);if("boy01"==i.name.substring(0,i.name.lastIndexOf("_"))){var n=BuildConfig.instance.getConfigByName(i.name),r=new AnimateModelEntity;r.setUp(i,n,EAnimateType.boy_stand),AnimatedManager.AllStandBoy.push(r)}}},t.on_match_over=function(){this.scene.addChild(GameManager.PlayerEntity),GameManager.isOnline?(this.scene.addChild(OtherPlayerManager.GenerateRemotePlayer()),FenceEntity.reset(),CrownEntity.reset(),MainSocket.C2S_LOAD_FINISH_READY()):(this.scene.addChild(OtherPlayerManager.GenerateAIPlayer()),FenceEntity.reset(),CrownEntity.reset(),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_local_player_joined))},t.assetsDispose=function(t){Laya.loader.load([{url:t,type:Laya.Loader.JSON}],Laya.Handler.create(this,this.onAssetsOK,[t]))},t.onAssetsOK=function(t){for(var e=Laya.loader.getRes(t),i=e.length-1;i>-1;i--){var n=Laya.loader.getRes(e[i].url);console.log(e[i].url,n),n&&n.dispose()}},t._isCommonLoaded=!1,t._isSceneLoaded=!1,t.scene=new Laya.Scene,t._CurrentSceneTag=ESceneTag.CITY1,t._IsNeedChangeScene=!1,t}(),AdManager=function(){function t(){}return t.show=function(t,e,i){},t.startRefresh=function(){},t.endRefresh=function(){},t.setAdToBottom=function(){},t.resize=function(t,e){},t.hideAll=function(){},t.hide=function(t,e,i){},t.HOME_PAGE_AD="adunit",t.RESULT_AD="adunit",t.GAME_AD="adunit",t.LOTTERY_REWARD_AD="adunit",t.LUCK_REWARD_AD="adunit",t.SCALE_RATE=1,t.adHeight=0,t.viewHeightDic=new Laya.Dictionary,t.refreshAd=function(){},t.onError=function(t){},t.onAdReSize=function(t){},t}(),RewardVideoManager=function(){function t(){}return t.show=function(t,e,i,n){this._videoType=t,this._unCompleteTxt=n,this._onErrorFunc=i,this._preVidePlayTime=(new Date).getTime(),this.isPaying=!0,this._completeFunc=e;var r=Math.floor(HelperExtension.random(0,3));r=(r=r<0?0:r)>=this.allVideoID.length?this.allVideoID.length-1:r,PlatfromKit.createRewardedVideoAd(this.allVideoID[r],this.onShow,this.onVideoClose,this.onError),PlatfromKit.showLoading("视频加载中...",!1,null,null,null),setTimeout(function(){PlatfromKit.hideLoading(null,null,null)},1e3)},t.allVideoID=new Array("adunit","adunit","adunit"),t.onError=function(e){t.isPaying=!1,t._onErrorFunc&&t._onErrorFunc.call(null),ShareUtil.sharegame(EnumShareId.AUTO_SHARE)},t.onShow=function(){AdManager.hide("",!1,!0),PlatfromKit.hideLoading(null,null,null)},t.onVideoClose=function(e){t.isPaying=!1,e||GameDataManager.addSeeVideoTimes(),t._completeFunc&&t._completeFunc.call(null,e)},t}(),SyncDataManager=function(){function t(){}return t.reqSyncData=function(){var t,e=TimeUtil.getTimeStr(),i=Laya.LocalStorage.getItem(EnumKey.SYNC_DATA);i&&(t=JSON.parse(i)),t&&(!t.nowday||t.nowday&&e!=t.nowday)&&(this.allData.dailyData=[],this.savaLocalData())},t.initSyncData=function(){var t=Laya.LocalStorage.getItem(EnumKey.SYNC_DATA);null!=t&&""!=t?this.allData=JSON.parse(t):(this.allData={},this.allData.curSkinId=1,this.allData.gold=0,this.allData.clientResetTime=0,this.allData.score=RankDataManager.getHeigScore(),this.allData.skinData=[],this.allData.chipData=[],this.allData.dailyData=[],JSON.stringify(this.allData))},t.setServerData=function(t){if(t){try{t=Base64.decode(t.data)}catch(t){return void console.warn("数据解密错误",t)}if(t=JSON.parse(t),this.allData.clientResetTime=t.clientResetTime,this.gold=t.gold,this.score=t.score,this.curSkinId=t.curSkinId,t.skinData&&(this.allData.skinData=t.skinData),t.chipData&&(this.allData.chipData=t.chipData),t.dailyData&&(this.allData.dailyData=t.dailyData),t.serverTime>t.resetTime){for(var e=0;e<this.allData.dailyData.length;e++)this.allData.dailyData[e].count=0;this.allData.clientResetTime=t.resetTime}EventManager.dispatchEvent(EnumKey.SYNC_DATA_SUCCESS),this.savaLocalData()}},Object.defineProperty(t,"serverTime",{get:function(){return this.allData.serverTime},enumerable:!0,configurable:!0}),Object.defineProperty(t,"gold",{get:function(){return this.allData.gold},set:function(t){this.allData.gold=t,EventManager.dispatchEvent(EnumKey.UPDATE_GOLD),Laya.timer.callLater(this,this.savaLocalData)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"score",{get:function(){return this.allData.score},set:function(t){this.allData.score=t,Laya.Browser.onWeiXin&&(PlatfromKit.setRankValue("score",t),null!=SubDomainMessageManager.layaSharedCanvas&&void 0!=SubDomainMessageManager.layaSharedCanvas&&SubDomainMessageManager.methodCall("setSelfHeighScore",t)),Laya.timer.callLater(this,this.savaLocalData)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"curSkinId",{get:function(){return this.allData.curSkinId},set:function(t){this.allData.curSkinId=t,Laya.timer.callLater(this,this.savaLocalData)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"skinData",{get:function(){return this.allData.skinData},set:function(t){this.allData.skinData=t,Laya.timer.callLater(this,this.savaLocalData)},enumerable:!0,configurable:!0}),t.setDailyData=function(t,e){for(var i=!1,n=0;n<this.allData.dailyData.length;n++){var r=this.allData.dailyData[n];r.id==t&&(r.count=e,i=!0)}i||this.allData.dailyData.push({id:t,count:e}),Laya.timer.callLater(this,this.savaLocalData)},t.savaLocalData=function(){this.allData.nowday=TimeUtil.getTimeStr();var t=JSON.stringify(this.allData);Laya.LocalStorage.setItem(EnumKey.SYNC_DATA,t)},t.getChipData=function(t){if(!this.allData.chipData)return 0;for(var e=0;e<this.allData.chipData.length;e++){var i=this.allData.chipData[e];if(i.chipId==t)return i.count}return 0},t.setChipData=function(t,e){for(var i=!1,n=0;n<this.allData.chipData.length;n++){var r=this.allData.chipData[n];r.chipId==t&&(r.count=e,i=!0)}i||this.allData.chipData.push({chipId:t,count:e}),Laya.timer.callLater(this,this.savaLocalData)},t.addChipData=function(e,i){var n=t.getChipData(e);t.setChipData(e,n+i)},t.addDailyDataOnce=function(e){var i=t.getDailyData(e);i++,this.setDailyData(e,i)},t.getDailyData=function(t){if(!this.allData.dailyData)return 0;for(var e=0;e<this.allData.dailyData.length;e++){var i=this.allData.dailyData[e];if(i.id==t)return i.count}return 0},t.isSameDay=function(t,e){var i=new Date(t),n=new Date(e);return i.getFullYear()==n.getFullYear()&&i.getMonth()==n.getMonth()&&i.getDay()==n.getDay()},t.addItem=function(e,i){switch(e.type){case 1:return t.gold+=i,e;case 2:return t.addChipData(e.id,i),e;case 3:return SkinManager.addSkin(e.id,i),e;case 4:var n=SettlementCfg.instance.getDataByWeight();return this.addChipData(n.skinBitsId,i),n}},t}(),TeamPlayer=function(){},ETeamPlayerState,ETeamState;!function(t){t[t.NOT_READY=1]="NOT_READY",t[t.READY=2]="READY",t[t.IN_GAME=3]="IN_GAME"}(ETeamPlayerState||(ETeamPlayerState={})),function(t){t[t.NOT_ALL_READY=0]="NOT_ALL_READY",t[t.SOME_IN_GAME=1]="SOME_IN_GAME",t[t.CAN_START_GAME=2]="CAN_START_GAME"}(ETeamState||(ETeamState={}));var TeamManager=function(){function t(){}return Object.defineProperty(t,"teamId",{get:function(){return this._teamId},set:function(t){this._teamId=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isTeamMaster",{get:function(){return this.teamMasterOpenID==ConfigUtility.openId},enumerable:!0,configurable:!0}),Object.defineProperty(t,"allTeamPlayer",{get:function(){return this._allTeamPlayer},enumerable:!0,configurable:!0}),Object.defineProperty(t,"teamPlayerCount",{get:function(){return this._allTeamPlayer.keys.length},enumerable:!0,configurable:!0}),Object.defineProperty(t,"teamPlayerListData",{get:function(){for(var t=new Array,e=0;e<this._allTeamPlayer.keys.length;e++){var i=this._allTeamPlayer.keys[e],n=this._allTeamPlayer.get(i);t.push(n)}return t.sort(this.sort_team_player)},enumerable:!0,configurable:!0}),t.clearAll=function(){this._allTeamPlayer.clear(),this.hasTeam=!1,TeamPlayView.instance.clearChatData()},t.push_team_player=function(t){this.hasTeam=!0,this._allTeamPlayer.set(t.openId,t),this.update_team_list(),t.openId==ConfigUtility.openId&&this.check_auto_exitTeam(t)},t.remove_team_player=function(t){this._allTeamPlayer.remove(t),this.update_team_list()},t.get_team_player=function(t){return this._allTeamPlayer.get(t)},t.update_team_player_state=function(t,e){var i=this._allTeamPlayer.get(t);i&&(i.state=e,this.update_team_list())},t.update_team_list=function(){EventManager.dispatchEvent(EnumKey.UPDATE_TEAM_LIST)},t.sort_team_player=function(t,e){return t.index-e.index},t.can_i_start_game=function(){for(var e=0;e<this._allTeamPlayer.values.length;e++){var i=this._allTeamPlayer.values[e];if(i.openId!=t.teamMasterOpenID){if(i.state==ETeamPlayerState.READY)continue;switch(i.state){case ETeamPlayerState.IN_GAME:return ETeamState.SOME_IN_GAME;case ETeamPlayerState.NOT_READY:return ETeamState.NOT_ALL_READY}}}return ETeamState.CAN_START_GAME},t.check_auto_startGame=function(){if(this.isTeamMaster&&this.teamPlayerCount>1){for(var e=0,i=0;i<this.teamPlayerCount;i++){var n=this._allTeamPlayer.values[i];if(n.openId==t.teamMasterOpenID)break;if(n.state!=ETeamPlayerState.READY)return void Laya.timer.clear(this,this.auto_startGame);e++}e==this.teamPlayerCount-1?this.auto_startGame(15):Laya.timer.clear(this,this.auto_startGame)}else Laya.timer.clear(this,this.auto_startGame)},t.auto_startGame=function(e){this.hasTeam?0!=e?e>0&&(e<=10&&TeamPlayView.instance.addSystemMessage("系统消息","全员已准备，等待队长开始游戏，或"+e+"秒后自动开始",EChatType.SYSTEM),Laya.timer.once(1e3,this,this.auto_startGame,[e-1])):t.isTeamMaster&&(NoticeView.instance.show(["系统已经自动开始游戏"]),TeamPlayView.instance.startGame()):Laya.timer.clear(this,this.auto_startGame)},t.clear_auto_startGame=function(){Laya.timer.clear(this,this.auto_startGame)},t.check_auto_exitTeam=function(t){this.isTeamMaster?Laya.timer.clear(this,this.auto_exitTeam):t&&(t.state==ETeamPlayerState.NOT_READY?this.auto_exitTeam(30):Laya.timer.clear(this,this.auto_exitTeam))},t.auto_exitTeam=function(t){this.hasTeam&&(0!=t?t>0&&(t<=10&&TeamPlayView.instance.addSystemMessage("系统消息","请您及时准备，否则"+t+"秒后自动离开队伍",EChatType.SYSTEM),Laya.timer.once(1e3,this,this.auto_exitTeam,[t-1])):TeamPlayView.instance.exitTeam())},t.maxTeamPlayerCount=10,t.hasTeam=!1,t._allTeamPlayer=new Dictionary,t}(),LiheManagaer=function(){function t(){}return Object.defineProperty(t,"allMBE",{get:function(){return this._allMBE},enumerable:!0,configurable:!0}),t.init=function(t){this.lihePrefab=t,this.lihePrefab.transform.position=new Vector3(0,0,0),this.lihePrefab.transform.scale=new Vector3(1,1,1)},t.SpawnMysteriousBag=function(t,e,i,n){var r=MysteriousBagCfg.instance.allMysteriousBag.get(e),a=Sprite3D.instantiate(this.lihePrefab);a.transform.position=new Vector3(i,15,n);var s=BuildConfig.instance.getConfigById(r.bagID),o=3*s.buildRadiusZ;a.transform.scale=new Vector3(o,o,o);var l=Laya.Pool.getItemByClass("MysteriousBagEnitity",MysteriousBagEnitity);l.setUp(a,s,r),l.uniqueId=t,this._allMBE.set(t,l),l.removeAtDetect(),l.addToScene(),l.falling()},t.clearAll=function(){if(this._allMBE){for(var t=this._allMBE.values.length;t--;){var e=this._allMBE.values[t];e.recover(),Laya.timer.clearAll(e),DetectManager.Instance.splice_model(e)}this._allMBE.clear()}},t.judge_join_lihe=function(){},t.removeAllLihe=function(){for(var t=0;t<this.allLihe.length;t++)this.allLihe[t].removeAtParent();this.allLihe=new Array},t._allMBE=new Dictionary,t.liheSpawnPos=new Array(new Laya.Vector2(55.5,37.5),new Laya.Vector2(-14.5,37.5),new Laya.Vector2(-14.5,102.5),new Laya.Vector2(8.3,-17.8),new Laya.Vector2(-19.7,-37.5),new Laya.Vector2(60.3,-72.5),new Laya.Vector2(-30.5,126.7)),t.allLihe=new Array,t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),HoleContext=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e._holeContext||(e._holeContext=new e),e._holeContext},e.SHOW_VIEW="showView",e.HIDE_VIEW="hideView",e}(Laya.EventDispatcher),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ModelEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"MeshSprite3D",{get:function(){return this._meshSprite3D},set:function(t){this._meshSprite3D=t},enumerable:!0,configurable:!0}),e.prototype.setUp=function(e,i){t.prototype.setUp.call(this,e,i,e),this._meshSprite3D=e,this._meshSprite3D.meshRender.material.renderQueue=5e3},e}(BaseModel),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),AnimateModelEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"SkinnedMeshSprite3D",{get:function(){return this._skinnedMeshSprite3D},set:function(t){this._skinnedMeshSprite3D=t},enumerable:!0,configurable:!0}),e.prototype.setUp=function(i,n,r){var a;n||console.log(i.name),r==EAnimateType.ship_finder?(a=e.findMesh(i)).meshRender.material.renderQueue=5e3:(a=e.findSkinedMesh(i),this._skinnedMeshSprite3D=a,this._skinnedMeshSprite3D.skinnedMeshRender.material.renderQueue=5e3),t.prototype.setUp.call(this,i,n,a,!0,r),r==EAnimateType.boy_stand&&(this.idleTime=2533,this.nullStateTime=0,this.IdleStateTag=1)},e.findSkinedMesh=function(t){for(var e=t.numChildren;e--;){var i=t.getChildAt(e);return i instanceof SkinnedMeshSprite3D?i:this.findSkinedMesh(i)}},e.findMesh=function(t){for(var e=t.numChildren;e--;){var i=t.getChildAt(e);return i instanceof MeshSprite3D?i:this.findMesh(i)}},e.prototype.standUpdate=function(){if(this.nullStateTime-=Laya.timer.delta,this.nullStateTime<=0){var t=HelperExtension.random(0,this.idleTime);this.nullStateTime=Math.floor(HelperExtension.random(0,4))*this.idleTime+ +t,0==this.IdleStateTag?(this.IdleStateTag=1,Laya.timer.once(t,this,this.playAnimation,[BoyClipName.idle])):(this.IdleStateTag=0,Laya.timer.once(t,this.animator,this.animator.stop))}},e}(BaseModel),BoyClipName=function(){function t(){}return t.escape="escape",t.falling="falling",t.idle="idle",t.walk="walk",t.run="run",t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),PlayerEntity=function(t){function e(){var e=t.call(this,!0)||this;if(e._isInvincible=!1,e.isOnlineDead=!1,GameManager.isOnline)e.set_onlineData(GameDataManager.onlineLocalData);else{var i=PlayerUtility.getSpawnPos;e.transform.position=new Laya.Vector3(i.x,PlayerUtility.posY,i.y),e.roomIndex=15}return DetectManager.Instance.Players.push(e),e}return __extends(e,t),Object.defineProperty(e.prototype,"isInvincible",{get:function(){return this._isInvincible},set:function(t){this._isInvincible=t,this._isInvincible&&(null==this.invicibleView&&(this.invicibleView=new hole.ui.Game.InvincibleViewUI,this.invicibleView.y=Laya.stage.height/2,this.invicibleView.x=Laya.stage.width/2-this.invicibleView.width/2),Laya.stage.addChild(this.invicibleView),Laya.timer.once(5e3,this,this.reset_invincible_state))},enumerable:!0,configurable:!0}),e.prototype.reset_invincible_state=function(){this._isInvincible=!1,this.isAlive=!0,Laya.stage.removeChild(this.invicibleView)},e.prototype.getScreenPos=function(){var t=this.getPostion(),e=CameraController.getOffsetPos();return new Vector3(t.x+e.x,t.y,t.z+e.y)},e}(BasePlayerSprite),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),AIPlayerEntity=function(t){function e(e,i){void 0===e&&(e=EOtherType.SimpleAI);var n=t.call(this,!1,i)||this;return n.OtherType=e,n}return __extends(e,t),e.prototype.init=function(){if(!GameManager.isOnline){var t=PlayerUtility.getSpawnPos;this.transform.position.x=t.x,this.transform.position.y=PlayerUtility.posY,this.transform.position.z=t.y,this.transform.position=this.transform.position,this.roomIndex=DetectManager.Instance.OtherPlayers.values.length}DetectManager.Instance.OtherPlayers.set(this.roomIndex,this),DetectManager.Instance.TmpOtherPlayers.set(this.roomIndex,this),this.AIComponent=this.addComponent(SimpleAIComponet),this.AIComponent.enable=!1},e.prototype.relive=function(){GameDataManager.gameState==EGameState.InGame&&(this.relive_to_random_place(),DetectManager.Instance.OtherPlayers.set(this.roomIndex,this),this.AIComponent.resetPos(),this.AIComponent.enable=!0,HelperExtension.coinTest(.5)&&(this.weight-=50),this.changeAlive(!0),t.prototype.relive.call(this))},e.prototype.changeAlive=function(t){this&&!this.destroyed&&(this.isAlive=t)},e}(BasePlayerSprite),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),PathfinderEntity=function(t){function e(){var e=t.call(this)||this;return e._pos=new Vector3,e._quat=new Quaternion,e}return __extends(e,t),Object.defineProperty(e.prototype,"transform",{get:function(){return this.finderModel.transform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animateType",{get:function(){return this.finderModel.animateType},enumerable:!0,configurable:!0}),e.prototype.setUp=function(e,i,n){t.prototype.setUp_pw.call(this,e),this.speed=n,this.finderModel=i,this.isMoving=!1,this.needRotate=!1,this.pathLength=0,this.progress=0},e.prototype.enable=function(t){if(t){if(GameDataManager.gameState!=EGameState.InGame)return;this.isMoving=!1,this.needRotate=!1,this.pathLength=0,this.progress=0,Laya.timer.frameLoop(1,this,this.automotor)}else Laya.timer.clear(this,this.automotor)},e.prototype.automotor=function(){this.isMoving||(this.isMoving=!0,this.currentPoint=this.current,this.nextPoint=this.next,this.pathLength=Vector3.distance(this.currentPoint.position,this.nextPoint.position),this.needRotate=!this.currentPoint.rotation.equals(this.nextPoint.rotation),0==this.currentIndex&&(this._quat=this.currentPoint.rotation.clone()));var t=new Vector3;if(this.progress+=this.speed*Laya.timer.delta/this.pathLength,Vector3.lerp(this.currentPoint.position,this.nextPoint.position,this.progress,t),this._pos=new Vector3(t.x,.06,t.z),this.needRotate){var e=new Quaternion;Quaternion.lerp(this.currentPoint.rotation,this.nextPoint.rotation,this.progress,e),this._quat=e}this.progress>=1&&(this.isMoving=!1,this.progress=0,this.currentIndex++),this.finderModel.IsFaded||this.transform&&(this.transform.position=this._pos,this.transform.rotation=this._quat)},e}(BasePathfinder),CrownEntity=function(){function t(){}return Object.defineProperty(t,"Sprite3D",{get:function(){return this._sprite3D},set:function(t){this._sprite3D=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MeshSprite3D",{get:function(){return this._meshSprite3D},set:function(t){this._meshSprite3D=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"transform",{get:function(){return this.Sprite3D.transform},enumerable:!0,configurable:!0}),t.WearCrown=function(t){this.hole=t},t.reset=function(){if(SceneManager.scene.addChild(this.Sprite3D),HelperExtension.coinTest(.4))this.hole=GameManager.PlayerEntity;else{var t=Math.floor(HelperExtension.random(0,DetectManager.Instance.OtherPlayers.values.length));this.hole=DetectManager.Instance.OtherPlayers.values[t]}this.update(Laya.timer.delta/1e3)},t.update=function(t){if(this.hole){var e=this.hole.getPostion();this.transform.position=new Vector3(e.x,2.5*this.hole.radius,e.z);var i=Vector3.Up.clone(),n=-t;i.x*=n,i.y*=n,i.z*=n,this.transform.rotate(i,!1);var r=this.hole.getScaleX();this.transform.scale.x!=r&&(this.transform.scale=new Vector3(r,r,r))}},t.init=function(e){(t.MeshSprite3D=(t.Sprite3D=e).getChildAt(0)).transform.scale=new Vector3(1,1,1)},t}(),FenceEntity=function(){function t(){}return Object.defineProperty(t,"IsNeedLoadOther",{get:function(){return null==this._allFenceMap[SceneManager.CurrentSceneTag]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"currentFence",{get:function(){return this._allFenceMap[SceneManager.CurrentSceneTag]},enumerable:!0,configurable:!0}),t.setup=function(t){if(null==this._allFenceMap[SceneManager.CurrentSceneTag]&&(this._allFenceMap[SceneManager.CurrentSceneTag]=new Array),!(null!=this._allFenceMap[SceneManager.CurrentSceneTag]&&this._allFenceMap[SceneManager.CurrentSceneTag].length>0)){var e=t.getChildByName("fence");if(null!=e)for(var i,n,r,a=0;a<e.numChildren;a++){n=(i=e.getChildAt(a)).getChildAt(0),r=i.getChildAt(1);var s=new Vector2,o=new Vector2;n.transform.position.x>r.transform.position.x?(s.x=n.transform.position.x,o.x=r.transform.position.x):(s.x=r.transform.position.x,o.x=n.transform.position.x),n.transform.position.z>r.transform.position.z?(s.y=n.transform.position.z,o.y=r.transform.position.z):(s.y=r.transform.position.z,o.y=n.transform.position.z);var l=new Fence(s,o);this._allFenceMap[SceneManager.CurrentSceneTag].push(l)}}},t.reset=function(){for(var t=this._allFenceMap[SceneManager.CurrentSceneTag],e=DetectManager.Instance.Players.length;e--;)for(var i=DetectManager.Instance.Players[e],n=t.length;n--;)if(r=t[n],0==(a=HelperExtension.AABP(r.max,r.min,i.transform.position))){i.fenceIndex=n;break}for(e=DetectManager.Instance.OtherPlayers.values.length;e--;)for(i=DetectManager.Instance.OtherPlayers.values[e],n=t.length;n--;){var r=t[n],a=HelperExtension.AABP(r.max,r.min,i.transform.position);if(0==a){i.fenceIndex=n;break}}},t.reset_player=function(t){for(var e=this._allFenceMap[SceneManager.CurrentSceneTag],i=e.length;i--;){var n=e[i];if(0==HelperExtension.AABP(n.max,n.min,t.transform.position)){t.fenceIndex=i;break}}},t.fenceDetect=function(t){var e=this._allFenceMap[SceneManager.CurrentSceneTag];(t.fenceIndex<0||t.fenceIndex>=this._allFenceMap.length)&&this.reset_player(t);var i=e[t.fenceIndex],n=HelperExtension.AABP(i.max,i.min,t.transform.position);if(0==n)return n;if(e.length<2)return n;if(t.fenceIndex>0&&t.fenceIndex<e.length-1){i=e[t.fenceIndex+1];var r=HelperExtension.AABP(i.max,i.min,t.transform.position);if(0==r)return t.fenceIndex+=1,r;i=e[t.fenceIndex-1];var a=HelperExtension.AABP(i.max,i.min,t.transform.position);if(0==a)return t.fenceIndex-=1,a}else if(t.fenceIndex==e.length-1){i=e[t.fenceIndex-1];var s=HelperExtension.AABP(i.max,i.min,t.transform.position);if(0==s)return t.fenceIndex-=1,s}else{i=e[t.fenceIndex+1];var o=HelperExtension.AABP(i.max,i.min,t.transform.position);if(0==o)return t.fenceIndex+=1,o}return n},t._allFenceMap=new Array,t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),LiheEntity=function(t){function e(e,i){var n=t.call(this)||this;return t.prototype.setUp.call(n,e,i,e),n._meshSprite3D=e,n._meshSprite3D.meshRender.material.renderQueue=5e3,n}return __extends(e,t),Object.defineProperty(e.prototype,"MeshSprite3D",{get:function(){return this._meshSprite3D},set:function(t){this._meshSprite3D=t},enumerable:!0,configurable:!0}),e.prototype.addToParent=function(){var t=SceneManager.scene.getChildByName("LiheNode");(null==t||t.destroyed)&&(t=new Sprite3D("LiheNode"),SceneManager.scene.addChild(t)),t.addChild(this.MeshSprite3D),this.parent=t,DetectManager.Instance.insert_model(this),this.MeshSprite3D.meshRender.material.renderQueue=5e3;var e=3*this.info.buildRadiusZ;this._meshSprite3D.transform.scale=new Vector3(e,e,e)},e.prototype.removeAtParent=function(){DetectManager.Instance.splice_model(this),SceneManager.scene.removeChildByName("LiheNode")},e.prototype.toAttach=function(e){e.isLocalPlayer&&!GameDataManager.isGetLuckyLihe&&(NoticeView.instance.show(["吃到幸运礼包，结算时可开启~"]),GameDataManager.isGetLuckyLihe=!0),t.prototype.toAttach.call(this,e)},e}(BaseModel),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),RemotePlayerEntity=function(t){function e(e,i){return void 0===i&&(i=EOtherType.RemotePlayer),t.call(this,i,e)||this}return __extends(e,t),e.prototype.recive_data=function(t){this.remoteComponet.setDirect(t.x,t.z),this.weight=t.weight},e.prototype.initCom=function(){this.remoteComponet=this.addComponent(RemoteComponet),this.remoteComponet.enable=!1},e.prototype.switchCom=function(t){void 0===t&&(t=EOtherType.RemotePlayer),t==EOtherType.RemotePlayer||t==EOtherType.RemoteAI?(this.AIComponent.enable=!1,this.remoteComponet.enable=!0):(this.AIComponent.enable=!0,this.remoteComponet.enable=!1)},e.prototype.online_active=function(){this.OtherType==EOtherType.RemotePlayer||this.OtherType==EOtherType.RemoteAI?(this.AIComponent.enable=!1,this.remoteComponet.enable=!0):(this.AIComponent.enable=!0,this.remoteComponet.enable=!1)},e.prototype.directToRemove=function(){if(this.isAlive){this.isAlive=!1,this.isDetect=!1;var t=this.detect.removeOtherWithID(this.id);t.removeAllComponent(),t.removeSelf()}},e}(AIPlayerEntity),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),MysteriousBagEnitity=function(t){function e(){var e=t.call(this)||this;return e.tmp_totalTime=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"MeshSprite3D",{get:function(){return this._meshSprite3D},set:function(t){this._meshSprite3D=t},enumerable:!0,configurable:!0}),e.prototype.setUp=function(e,i,n){t.prototype.setUp.call(this,e,i,e),this._meshSprite3D=e,this._meshSprite3D.meshRender.material.renderQueue=5e3,this.MB=n,this.originPosition=new Vector3(e.transform.position.x,.05,e.transform.position.z)},e.prototype.addToScene=function(){var t=SceneManager.scene.getChildByName("MysteriousBagNode");null==t&&(t=new Sprite3D("MysteriousBagNode"),SceneManager.scene.addChild(t)),t.addChild(this.MeshSprite3D),this.parent=t,SceneManager.scene.addChild(t)},e.prototype.removeAtScene=function(){this.Sprite3D.removeSelf()},e.prototype.addToDetect=function(){DetectManager.Instance.insert_model(this)},e.prototype.removeAtDetect=function(){DetectManager.Instance.splice_model(this)},e.prototype.falling=function(){this.tmp_totalTime=0,Laya.timer.frameLoop(1,this,this.toFalling)},e.prototype.toFalling=function(){if(this.transform.position.y<=.28)return this.transform.position=new Vector3(this.transform.position.x,.28,this.transform.position.z),this.onFallingEnd(),void Laya.timer.clear(this,this.toFalling);var t=Laya.timer.delta/1e3;this.tmp_totalTime+=t;var e=this.tmp_totalTime*this.tmp_totalTime;this.transform.translate(new Laya.Vector3(0,-e,0),!1);var i=Vector3.Up.clone(),n=2*-t;i.x*=n,i.y*=n,i.z*=n,this.transform.rotate(i,!1)},e.prototype.onFallingEnd=function(){this.addToDetect()},e.prototype.toAttach=function(e){this.isFaded||(MainSocket.C2S_SYNC_PICK_UP_GIFT_BAG(this.uniqueId,e.roomIndex),t.prototype.toAttach.call(this,e))},e}(BaseModel),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),View=laya.ui.View,Dialog=laya.ui.Dialog,hole;!function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.ActivityViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Image",props:{y:119,x:35,width:570,skin:"res/image/tybj.png",sizeGrid:"252,226,118,26",height:820}},{type:"Image",props:{y:105,x:319,var:"imgTitle",skin:"res/ui/activity/xspfz.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:127,x:50,var:"img_bg_xshdbt",skin:"res/ui/activity/xshdbt.png"}},{type:"Image",props:{y:395,x:322,width:180,var:"imgSkin",skin:"res/skinUI/Ball_109.png",height:180,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:748,x:325,var:"btnShare",skin:"res/ui/activity/btn_hycn.png"}},{type:"Image",props:{y:748,x:52,var:"btnVideo",skin:"res/ui/activity/btn_mscn.png"}},{type:"Image",props:{y:704,x:385,skin:"res/ui/activity/xianshi_jingmei.png"}},{type:"Image",props:{y:756,x:119,var:"btnGet",skin:"res/ui/activity/btnGet.png"},child:[{type:"Label",props:{y:38,x:100,width:198,var:"GetLab",text:"立即领取",strokeColor:"#ce5e07",stroke:4,height:70,fontSize:50,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"center"}}]},{type:"Image",props:{y:501,x:232,width:175,skin:"res/ui/activity/gray.png",sizeGrid:"7,15,10,15"}},{type:"Image",props:{y:506,x:232,width:175,var:"imgProgress",skin:"res/ui/activity/red.png",sizeGrid:"0,5,0,7"}},{type:"Image",props:{y:489,x:202,var:"imgPoint0",skin:"res/ui/home/hui.png"}},{type:"Image",props:{y:489,x:395,var:"imgPoint1",skin:"res/ui/home/hui.png"}},{type:"Image",props:{y:112,x:566,skin:"res/ui/common/btnClose.png",name:"close",mouseEnabled:!0}},{type:"Label",props:{y:241,x:121,width:398,var:"lbTime",text:"活动时间：2018.9.23 - 2018.9.25",height:23,fontSize:18,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Text",props:{y:624,x:426,width:16,text:"1",strokeColor:"#1d1b89",stroke:2,pivotY:14,pivotX:8,height:28,fontSize:28,color:"#4dff20",bold:!0}},{type:"Text",props:{y:654,x:381,width:16,var:"lbLimitHelpNum",text:"1",strokeColor:"#1d1b89",stroke:2,pivotY:14,pivotX:8,height:28,fontSize:28,color:"#4dff20",bold:!0,align:"center"}},{type:"Label",props:{y:610,x:412,width:20,visible:!1,text:"1",strokeColor:"#1d1b89",stroke:2,height:31,fontSize:28,color:"#4dff20",bold:!0,align:"center"}},{type:"Label",props:{y:640,x:371,width:17,visible:!1,text:"1",strokeColor:"#1d1b89",stroke:2,height:31,fontSize:28,color:"#4dff20",bold:!0,align:"center"}},{type:"Label",props:{y:703,x:205,width:54,var:"lbLeftNum",text:"10",strokeColor:"#1d1b89",stroke:2,height:38,fontSize:40,font:"SimHei",color:"#4dff20",bold:!0,align:"center"}},{type:"Label",props:{y:533,x:379,width:44,visible:!1,text:"获得",strokeColor:"#1d1b89",stroke:2,height:23,fontSize:16,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:498,x:442,wordWrap:!1,width:60,var:"lbTotalNum",text:"10次",strokeColor:"#1d1b89",stroke:2,height:23,fontSize:18,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"left"}},{type:"Label",props:{y:530,x:290,width:60,var:"lbProgress",text:"0/5",strokeColor:"#1d1b89",stroke:2,height:23,fontSize:18,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:533,x:419,width:86,visible:!1,text:"精美皮肤！",strokeColor:"#1d1b89",stroke:2,height:23,fontSize:16,font:"Microsoft YaHei",color:"#ff0050",bold:!0,align:"center"}},{type:"Label",props:{y:580,x:121,width:397,text:"邀请好友助力或看视频能为皮肤充能，",height:29,fontSize:24,color:"#c7a9ff"}},{type:"Label",props:{y:612,x:121,width:397,text:"且每位好友每天最多助力你    次",height:29,fontSize:24,color:"#c7a9ff"}},{type:"Label",props:{y:642,x:221,width:197,text:"每天最多充能    次",height:29,fontSize:24,color:"#c7a9ff"}},{type:"Label",props:{y:711,x:126,width:260,text:"再充能         次即可获得",strokeColor:"#1d1b89",stroke:2,height:23,fontSize:24,color:"#ffffff",bold:!0,align:"center"}},{type:"Sprite",props:{y:953,x:126,width:387,var:"ad",height:48}}]},i}(Dialog),e.ActivityViewUI=i}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Common.GuideViewUI.uiView)},i.uiView={type:"View",props:{width:420,height:315},child:[{type:"Image",props:{y:0,x:0,width:420,skin:"res/ui/common/mask.png",sizeGrid:"40,36,38,27",height:315}},{type:"Image",props:{y:181.49999949089693,x:119.5,skin:"res/ui/common/arrow.png",name:"L",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:92.49999949089693,x:208.5,skin:"res/ui/common/arrow.png",rotation:90,name:"U",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:181.49999949089693,x:297.5,skin:"res/ui/common/arrow.png",rotation:180,name:"R",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:268.4999994908969,x:208.5,skin:"res/ui/common/arrow.png",rotation:270,name:"D",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:10,x:-110,width:640,var:"lb_tooltip",valign:"middle",text:"开局碾压小建筑群，成长更快哦~",height:44,fontSize:28,font:"SimHei",color:"#ffffff",align:"center"}},{type:"Animation",props:{y:181.49999949089693,x:208.5,var:"ani_hand",source:"Common/GuideAni.ani",index:0,autoPlay:!0}}]},i}(View);e.GuideViewUI=i})((e=t.ui||(t.ui={})).Common||(e.Common={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.BonusViewUI.uiView)},i.uiView={type:"View",props:{width:200,height:100},child:[{type:"Text",props:{y:80,x:100,width:200,var:"text_bonus",text:"+1",strokeColor:"#333333",stroke:2,pivotY:20,pivotX:100,height:40,fontSize:30,font:"Microsoft YaHei",color:"#ffdf2c",align:"center"},compId:2}],animations:[{nodes:[{target:2,keyframes:{y:[{value:80,tweenMethod:"linearNone",tween:!0,target:2,key:"y",index:0},{value:12,tweenMethod:"linearNone",tween:!0,target:2,key:"y",index:6},{value:12,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"y",index:9},{value:-50,tweenMethod:"linearNone",tween:!0,target:2,key:"y",index:16},{value:34,tweenMethod:"linearNone",tween:!0,target:2,key:"y",index:22}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:0},{value:1.25,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:6},{value:1.25,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"scaleY",index:9},{value:.3288461538461538,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:16},{value:.15,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:22}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:0},{value:1.25,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:6},{value:1.25,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"scaleX",index:9},{value:.3288461538461538,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:16},{value:.15,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:22}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i}(View);e.BonusViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.BroadcastViewUI.uiView)},i.uiView={type:"View",props:{width:358,height:75},child:[{type:"Image",props:{y:37,x:179,skin:"res/ui/game/gndiban.png",scaleY:.88,scaleX:.88,anchorY:.5,anchorX:.5},compId:2,child:[{type:"Image",props:{y:4,x:53,width:50,var:"img_big",height:50}},{type:"Image",props:{y:4,x:231,width:50,var:"img_small",height:50}}]}],animations:[{nodes:[{target:2,keyframes:{scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"scaleY",index:35},{value:0,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:39}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"scaleX",index:35},{value:0,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:39}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i}(View);e.BroadcastViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.ClassicOverViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1136},child:[{type:"Image",props:{y:74,x:30,width:580,skin:"res/ui/common/diban1.png",sizeGrid:"58,51,48,51",height:624}},{type:"Image",props:{y:51,x:42,width:556,skin:"res/ui/common/title.png",height:71}},{type:"Image",props:{y:121,x:48,width:544,skin:"res/ui/common/diban.png",height:558,sizeGrid:"33,36,51,29"}},{type:"Image",props:{y:58,x:235,var:"imgTitle",skin:"res/ui/gameover/youxijies.png",scaleY:1,scaleX:1}},{type:"Box",props:{y:21,x:0,width:640,var:"boxBtns",height:981},child:[{type:"Image",props:{y:512,x:62,width:515,skin:"res/ui/gameover/zijitiao.png",name:"BG",height:64,sizeGrid:"17,21,18,16"}},{type:"Image",props:{y:513,x:62,var:"img_di2",skin:"res/ui/gameover/paiming1.png"}},{type:"Image",props:{y:807,x:168,width:399,var:"btnDoublePrize",skin:"res/ui/gameover/img_shuangbei.png",scaleY:.6,scaleX:.6,height:150,anchorY:.5,anchorX:.5},child:[{type:"Label",props:{y:41,x:96,width:276,valign:"top",text:"视频变大",strokeColor:"#068ea0",stroke:4,mouseThrough:!0,height:80,fontSize:50,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"center"}},{type:"Image",props:{y:45,x:44,skin:"res/ui/gameover/shipin2.png"}}]},{type:"Image",props:{y:807,x:470,var:"btnShareForDP",skin:"res/ui/activity/btnGet.png",scaleY:.6,scaleX:.6,anchorY:.5,anchorX:.5},child:[{type:"Label",props:{y:37,x:96,width:276,valign:"top",text:"分享变大",strokeColor:"#c2491b",stroke:4,mouseThrough:!0,height:80,fontSize:50,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"center"}},{type:"Image",props:{y:39,x:48,skin:"res/ui/common/fenxiang1.png",scaleY:1.8,scaleX:1.8}}]},{type:"Button",props:{y:613,x:216,visible:!1,var:"btnAllRank",stateNum:1,skin:"res/ui/gameover/btn_zong.png"},child:[{type:"Label",props:{y:13,x:53,width:123,text:"查看总排行",mouseThrough:!0,height:27,fontSize:24,color:"#c56123",bold:!0}}]},{type:"Image",props:{y:528,x:532,skin:"res/ui/gameover/jifentubiao.png",name:"self_星星"}},{type:"Image",props:{y:518,x:69,visible:!1,var:"img_rank",skin:"res/ui/gameover/jiangpai1.png"}},{type:"Image",props:{y:680,x:4,var:"img_back_home",skin:"res/ui/common/btn_fanhui.png"}},{type:"Image",props:{y:483,x:220,width:200,visible:!1,var:"img_jiangli",skin:"res/ui/common/di3.png",sizeGrid:"11,27,14,24"}},{type:"Image",props:{y:777,x:320,visible:!1,var:"btnShare",skin:"res/ui/activity/btnGet.png",anchorY:.5,anchorX:.5},child:[{type:"Label",props:{y:35,x:45,width:315,text:"炫耀得分",strokeColor:"#ce5e07",stroke:3,mouseThrough:!0,height:72,fontSize:50,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"center"}}]},{type:"Image",props:{y:519,x:145,width:50,var:"img_avatar",height:50}},{type:"Text",props:{y:532,x:230,var:"text_weight",text:"8888",height:27,fontSize:18,font:"Microsoft YaHei",color:"#627b86",bold:!0,align:"right"}},{type:"Text",props:{y:533,x:272,width:30,text:"吨",name:"单位",height:27,fontSize:18,font:"Microsoft YaHei",color:"#627b86",bold:!0,align:"center"}},{type:"Text",props:{y:533,x:322,width:130,var:"text_name",text:"一二三四五六...",height:27,fontSize:18,font:"Microsoft YaHei",color:"#627b86",bold:!0,align:"center"}},{type:"Text",props:{y:533,x:477,width:44,var:"text_score",text:"+10",height:27,fontSize:20,font:"Microsoft YaHei",color:"#4169E1",bold:!0,align:"center"}},{type:"Text",props:{y:516,x:400,var:"text_protect",text:"",height:27,fontSize:16,font:"Microsoft YaHei",color:"#627b86",align:"center"}},{type:"Label",props:{y:669,x:55,width:525,var:"lbPrizeDesc",text:"获得奖励",height:36,fontSize:24,color:"#fcfbfd",bold:!0,align:"center"}},{type:"Text",props:{y:523,x:70,width:50,var:"lbRank",text:"10",height:39,fontSize:30,font:"Microsoft YaHei",color:"#FEFDD9",bold:!0,align:"center"}},{type:"Box",props:{y:532,x:225,var:"boxDouble"},child:[{type:"Sprite",props:{y:0,x:47,width:84,var:"boxPrize",height:89},child:[{type:"Image",props:{y:1,x:0,visible:!1,var:"imgDouble1",skin:"res/ui/gameover/bianjiao.png"}},{type:"Image",props:{y:1,x:35,visible:!1,var:"imgDouble2",skin:"res/ui/gameover/bianjiao.png"}}]},{type:"Image",props:{y:164,x:-59,var:"img_double_percent",skin:"res/ui/gameover/jb300.png"},child:[{type:"Image",props:{y:13,x:14,skin:"res/ui/common/jinbi.png"}},{type:"Text",props:{y:21,x:59,var:"multipleText",text:"+600%",fontSize:24,color:"#fff600",bold:!0}},{type:"Text",props:{y:21,x:137,text:"下局球球",fontSize:24,color:"#ffffff",bold:!0}},{type:"Text",props:{y:19,x:236,text:"变大",fontSize:28,color:"#68ff4a",bold:!0}}]}]}]},{type:"List",props:{y:136,x:62,width:515,var:"rank_list",spaceY:0,repeatY:6,mouseEnabled:!0,height:396},child:[{type:"Box",props:{y:0,x:0,width:515,renderType:"render",height:66},child:[{type:"Image",props:{y:0,x:0,width:515,skin:"res/ui/gameover/dizi1.png",sizeGrid:"18,16,11,20",name:"img_bg",height:64}},{type:"Image",props:{y:1,x:0,skin:"res/ui/gameover/paiming1.png",name:"img_di2"}},{type:"Image",props:{y:17,x:469,skin:"res/ui/gameover/jifentubiao.png",name:"img_xingxing"}},{type:"Image",props:{y:6,x:7,visible:!1,skin:"res/ui/gameover/jiangpai1.png",name:"img_rank"}},{type:"Image",props:{y:8,x:83,width:50,name:"img_avatar",height:50}},{type:"Text",props:{y:23,x:169,text:"8888",name:"text_weight",height:27,fontSize:18,font:"Microsoft YaHei",color:"#627b86",bold:!0,align:"right"}},{type:"Text",props:{y:22,x:260,width:130,text:"一二三四五六...",name:"text_name",height:27,fontSize:18,font:"Microsoft YaHei",color:"#627b86",bold:!0,align:"center"}},{type:"Text",props:{y:22,x:415,width:44,text:"-1",name:"text_score",height:27,fontSize:20,font:"Microsoft YaHei",color:"#627b86",bold:!0,align:"center"}},{type:"Text",props:{y:22,x:210,width:30,text:"吨",name:"单位",height:27,fontSize:18,font:"Microsoft YaHei",color:"#627b86",bold:!0,align:"center"}},{type:"Text",props:{y:5,x:400,text:"",name:"text_protect",height:27,fontSize:16,font:"Microsoft YaHei",color:"#627b86",bold:!0,align:"center"}},{type:"Text",props:{y:12,x:8,width:50,text:"10",name:"lbRank",height:37,fontSize:30,font:"Microsoft YaHei",color:"#FEFDD9",bold:!0,align:"center"}}]}]},{type:"Animation",props:{y:729,x:128,width:384,var:"ani_flash",source:"ani/KaishiFlash.ani",height:131}},{type:"Sprite",props:{y:907,x:123,width:387,var:"ad",height:230}},{type:"Box",props:{y:527,x:0,visible:!1},child:[{type:"Image",props:{x:7,skin:"res/ui/common/cnxh.png"}},{type:"Sprite",props:{y:18,x:23,width:60,var:"spAD",height:60}}]},{type:"Image",props:{y:521,x:320,var:"img6Bei",skin:"res/ui/gameover/zi.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:874,x:235,width:170,var:"reStart",underline:!0,text:"再来一局",mouseEnabled:!0,height:36,fontSize:30,color:"#ffffff",align:"center"}}]},i}(View);e.ClassicOverViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.CountDownViewUI.uiView)},i.uiView={type:"View",props:{width:373,height:113},child:[{type:"Box",props:{y:56,x:186,width:304,height:113,anchorY:.5,anchorX:.5},compId:10,child:[{type:"HBox",props:{y:0,width:373,var:"box_countdown",staticCache:!0,height:113},child:[{type:"Image",props:{y:0,x:36,skin:"res/ui/game/sz_0.png",name:"第一个零"}},{type:"Image",props:{y:0,x:108,skin:"res/ui/game/sz_0.png",name:"第二个零"}},{type:"Image",props:{y:15,x:183,skin:"res/ui/game/sz_maohao.png",name:"中间的两个点"}},{type:"Image",props:{y:0,x:207,var:"img_countdown1",skin:"res/ui/game/sz_0.png"}},{type:"Image",props:{y:0,x:272,var:"img_countdown2",skin:"res/ui/game/sz_5.png"}}]},{type:"Image",props:{y:0,x:-34,width:381,visible:!1,var:"img_sjd",skin:"res/ui/game/shijiandao.png",height:113}}]}],animations:[{nodes:[{target:10,keyframes:{x:[{value:186,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0}],scaleY:[{value:.3,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleY",index:6}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleX",index:6}]}}],name:"ani1",id:1,frameRate:24,action:0},{nodes:[{target:10,keyframes:{y:[{value:56,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:0},{value:58,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:2},{value:54,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:6}],x:[{value:186,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0},{value:184,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:4},{value:188,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:6}]}}],name:"ani2",id:2,frameRate:24,action:2}]},i}(View);e.CountDownViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.DebugViewUI.uiView)},i.uiView={type:"View",props:{width:200,height:320},child:[{type:"Text",props:{y:2,x:93,width:65,var:"text_player_level",text:"阶级:1",overflow:"scroll",height:30,fontSize:20,color:"#ffffff",align:"center"}},{type:"Text",props:{y:2,x:0,width:70,var:"text_player_num",text:"数量:20",overflow:"scroll",height:30,fontSize:20,color:"#ffffff",align:"center"}},{type:"Text",props:{y:30,x:0,width:102,var:"text_ai_type",text:"0：1：10",name:"AI类型比例",height:28,fontSize:20,font:"Microsoft YaHei",color:"#00ff14",align:"center"}},{type:"Text",props:{y:31,x:119,width:69,var:"text_model_num",text:"10：20",height:28,fontSize:20,font:"Microsoft YaHei",color:"#ff1400",bold:!1}},{type:"Text",props:{y:244,x:42,var:"text_game_times",text:"1：2：3：4",fontSize:20,font:"Microsoft YaHei",color:"#00adff",bold:!1}},{type:"Button",props:{y:58,x:0,width:200,var:"add_AI",labelSize:20,labelColors:"#ffff00",labelAlign:"center",label:"增加机器人",height:34}},{type:"Button",props:{y:105,x:0,width:200,var:"change_player_level",labelStrokeColor:"#ffffff",labelSize:20,labelColors:"#ffff00",labelAlign:"center",label:"改变玩家阶级",height:36}},{type:"Button",props:{y:155,x:0,width:200,var:"change_ai_level",labelStrokeColor:"#ffffff",labelSize:20,labelColors:"#ffff00",labelAlign:"center",label:"改变AI阶级",height:33}},{type:"Button",props:{y:204,x:0,width:200,var:"switch_stat",labelStrokeColor:"#ffffff",labelSize:20,labelColors:"#ffff00",labelAlign:"center",label:"性能面板开关",height:32}},{type:"Button",props:{y:281,x:0,width:200,var:"game_over",labelStrokeColor:"#ffffff",labelSize:20,labelColors:"#ffff00",labelAlign:"center",label:"结束游戏",height:32}}]},i}(View);e.DebugViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.EatBagViewUI.uiView)},i.uiView={type:"View",props:{width:600,height:50},child:[{type:"Image",props:{y:0,x:0,width:600,skin:"res/ui/common/baoxiangdi.png",sizeGrid:"15,20,20,16",height:50}},{type:"Label",props:{y:13,x:33,width:144,var:"lb_name",text:"吃瓜少年等等",strokeColor:"#323232",stroke:2,name:"吃瓜少年等等",height:24,fontSize:24,font:"SimSun",color:"#ffcd1f",align:"center"}},{type:"Label",props:{y:13,x:188,text:"吞了",strokeColor:"#323232",stroke:2,name:"吞了",fontSize:24,font:"SimSun",color:"#ffffff"}},{type:"Label",props:{y:13,x:343,text:"，",strokeColor:"#323232",stroke:2,name:"，",fontSize:24,font:"SimSun",color:"#ffffff"}},{type:"Label",props:{y:13,x:241,text:"神秘宝箱",strokeColor:"#323232",stroke:2,name:"神秘宝箱",fontSize:24,font:"SimSun",color:"#ff0000"}},{type:"Label",props:{y:13,x:362,var:"lb_tips",text:"10秒内速度降低20%",strokeColor:"#323232",stroke:2,fontSize:24,font:"SimSun",color:"#ffffff"}}]},i}(View);e.EatBagViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.ExitViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1136},child:[{type:"Image",props:{y:361,x:85,width:470,skin:"res/ui/common/diban1.png",sizeGrid:"55,48,52,53",height:370}},{type:"Text",props:{y:513,x:183,width:274,text:"退 出 将 没 有 结 算 奖 励",height:40,fontSize:24,font:"Microsoft YaHei",color:"#ffffff",bold:!0}},{type:"Text",props:{y:463,x:188,width:264,text:"是 否 退 出 本 局 游 戏 ？",height:40,fontSize:24,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Image",props:{y:573,x:343,visible:!1,var:"btn_video_for_exit",skin:"res/ui/game/img_shipinfuhuox.png"}},{type:"Image",props:{y:573,x:120,visible:!1,var:"btn_share_for_exit",skin:"res/ui/game/img_fenxiangfuhuox.png"}},{type:"Image",props:{y:605,x:133,var:"btn_exit",skin:"res/ui/game/img_shipinfuhuox.png"},child:[{type:"Label",props:{y:13,x:37,width:99,text:"退出游戏",mouseThrough:!0,height:27,fontSize:24,color:"#ffffff",bold:!0}}]},{type:"Image",props:{y:605,x:333,var:"btn_continue",skin:"res/ui/game/img_fenxiangfuhuox.png"},child:[{type:"Label",props:{y:14,x:37,width:99,text:"继续游戏",mouseThrough:!0,height:31,fontSize:24,color:"#c56123",bold:!0}}]},{type:"Sprite",props:{y:746,x:0,width:640,var:"ad",height:120}}]},i}(View);e.ExitViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.FlyingShoesViewUI.uiView)},i.uiView={type:"View",props:{y:82,x:0,width:640,height:166},child:[{type:"Image",props:{y:21,x:580,var:"img_shoes",skin:"res/ui/game/xiezi.png",rotation:0,anchorY:.5,anchorX:.5},compId:2},{type:"Image",props:{y:-82,x:530,var:"img_help",skin:"res/ui/game/qipao.png",alpha:1},compId:3},{type:"Image",props:{y:61,x:541,var:"img_lingqu",skin:"res/ui/game/mianfeilingqu.png",alpha:1},compId:4},{type:"Image",props:{y:58,x:543,var:"priceLab",skin:"res/ui/common/jinbi.png",scaleY:.6,scaleX:.6,alpha:1},compId:5,child:[{type:"Text",props:{y:2,x:46,width:65,var:"shoesCost",text:"100",height:36,fontSize:36,color:"#e0d931",bold:!0}},{type:"Box",props:{y:-158,x:-27,width:153,var:"img_lingqu_gold",height:200}}]}],animations:[{nodes:[{target:2,keyframes:{alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"alpha",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:2,key:"alpha",index:12},{value:1,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"alpha",index:24}]}}],name:"flash",id:1,frameRate:24,action:0},{nodes:[{target:3,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"x",index:0},{value:530,tweenMethod:"linearNone",tween:!0,target:3,key:"x",index:48}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:36},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:48}]}},{target:2,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:2,key:"x",index:0},{value:280,tweenMethod:"linearNone",tween:!0,target:2,key:"x",index:4},{value:340,tweenMethod:"linearNone",tween:!0,target:2,key:"x",index:15},{value:380,tweenMethod:"linearNone",tween:!0,target:2,key:"x",index:25},{value:580,tweenMethod:"linearNone",tween:!0,target:2,key:"x",index:36}]}},{target:4,keyframes:{x:[{value:-44,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:0},{value:541,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:48}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:36},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:48}]}},{target:5,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:0},{value:397.5,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:36},{value:543,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:48}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:36},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:48}]}}],name:"ani1",id:2,frameRate:24,action:0},{nodes:[{target:2,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:2,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"rotation",index:62},{value:30,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"rotation",index:64},{value:-30,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"rotation",index:66},{value:0,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"rotation",index:68},{value:30,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"rotation",index:70},{value:0,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"rotation",index:72}]}}],name:"shake",id:3,frameRate:24,action:0}]},i}(View);e.FlyingShoesViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.GameViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1136},child:[{type:"Image",props:{y:250,x:0,visible:!1,var:"btnSuggestList",skin:"res/ui/common/btnOn.png"}},{type:"Image",props:{y:249,x:53,visible:!1,skin:"res/ui/home/hd.png"}},{type:"Image",props:{y:206,x:0,width:149,var:"img_bg_player_count",skin:"res/ui/home/img_youxiheidi.png",height:39}},{type:"Image",props:{y:20,x:0,width:269,skin:"res/ui/game/zuobian.png",name:"右边背景",height:183}},{type:"Image",props:{y:86,x:499,skin:"res/ui/game/youbian.png",name:"左边背景"}},{type:"Image",props:{y:208,x:600,var:"img_exit",skin:"res/ui/game/img_tuichu.png"}},{type:"Image",props:{y:400,x:450,visible:!1,var:"img_xiezi",skin:"res/ui/game/xiezi.png",alpha:.8666666666666667},compId:158},{type:"Text",props:{y:124,x:14,width:16,var:"text_no3_rank",text:"3",overflow:"hidden",name:"第三",height:21,fontSize:17,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Text",props:{y:79,x:8,width:17,var:"text_no2_rank",text:"2",overflow:"hidden",name:"第二",height:21,fontSize:17,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Text",props:{y:29,x:1,width:25,var:"text_no1_rank",text:"1",overflow:"hidden",name:"第一",height:24,fontSize:19,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:164,x:508,width:128,var:"text_kill_amount",text:"碾碎 : 0个球球",overflow:"hidden",height:27,fontSize:18,font:"Microsoft YaHei",color:"#E743E3"}},{type:"Label",props:{y:210,x:7,width:202,var:"lbDoubleTime",text:"双倍时间：10秒",height:33,fontSize:22,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Label",props:{y:94,x:513,width:123,var:"text_timing",text:"02 : 00",overflow:"hidden",height:48,fontSize:36,font:"Microsoft YaHei",color:"#FFCD1E"}},{type:"Label",props:{y:29,x:43,width:124,var:"text_no1",text:"吃瓜要不六六...",name:"名字",height:27,fontSize:19,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Label",props:{y:79,x:45,width:103,var:"text_no2",text:"吃瓜666",name:"名字2",height:26,fontSize:17,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Label",props:{y:124,x:45,width:103,var:"text_no3",text:"吃瓜方六",name:"名字2",height:26,fontSize:17,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Label",props:{y:170,x:42,width:103,var:"text_self",text:"吃",name:"名字2",height:26,fontSize:17,font:"Microsoft YaHei",color:"#67ff01"}},{type:"Label",props:{y:171,x:9,width:25,var:"text_self_rank",text:"15",height:23,fontSize:17,font:"Microsoft YaHei",color:"#67ff01",align:"center"}},{type:"Label",props:{y:29,x:171,width:64,var:"text_no1_weight",text:"10000",overflow:"hidden",height:26,fontSize:19,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:79,x:155,width:51,var:"text_no2_weight",text:"1000",overflow:"hidden",height:26,fontSize:17,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:124,x:155,width:51,var:"text_no3_weight",text:"100",overflow:"hidden",height:26,fontSize:17,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:169,x:155,width:51,var:"text_self_weight",text:"10",overflow:"hidden",height:26,fontSize:17,font:"Microsoft YaHei",color:"#67ff01",align:"center"}},{type:"Label",props:{y:420,x:190,width:260,var:"text_player_name",text:"一二三四五六七八九十",strokeColor:"#000000",stroke:6,overflow:"hidden",height:40,fontSize:26,font:"Microsoft YaHei",color:"#67ff01",align:"center"}},{type:"Label",props:{y:29,x:236,width:21,var:"text_weight_unit_1",text:"吨",overflow:"hidden",name:"单位1",height:26,fontSize:19,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:79,x:203,width:27,var:"text_weight_unit_2",text:"吨",overflow:"hidden",name:"单位2",height:26,fontSize:17,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:124,x:203,width:27,var:"text_weight_unit_3",text:"吨",overflow:"hidden",name:"单位3",height:26,fontSize:17,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:168,x:203,width:27,text:"吨",overflow:"hidden",name:"单位自己",height:26,fontSize:17,font:"Microsoft YaHei",color:"#67ff01",align:"center"}},{type:"Label",props:{y:216,x:14,width:128,var:"lb_playerCount",text:"剩余球球：10",name:"剩余球球：10",height:22,fontSize:20,font:"SimHei",color:"#ffffff"}},{type:"Image",props:{y:26,x:2,width:35,skin:"res/ui/gameover/jiangpai1.png",height:35}},{type:"Image",props:{y:72,x:3,width:35,skin:"res/ui/gameover/jiangpai2.png",height:35}},{type:"Image",props:{y:119,x:3,width:35,skin:"res/ui/gameover/jiangpai3.png",height:35}}],animations:[{nodes:[{target:158,keyframes:{x:[{value:450,tweenMethod:"linearNone",tween:!0,target:158,key:"x",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:158,key:"alpha",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:158,key:"alpha",index:12},{value:1,tweenMethod:"linearNone",tween:!0,target:158,key:"alpha",index:24}]}}],name:"xiezi_flash",id:1,frameRate:24,action:0}]},i}(View);e.GameViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.GetGoldViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Sprite",props:{y:0,x:0,width:640,var:"bgMask",mouseEnabled:!0,height:1136,alpha:.7}},{type:"Image",props:{y:445,x:318,var:"bg",skin:"res/ui/common/guang.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:239,x:178,var:"img_title",skin:"res/ui/common/getPrize.png"}},{type:"HBox",props:{y:486,x:320,width:450,var:"hbox_container",height:233,anchorY:.5,anchorX:.5},child:[{type:"Box",props:{y:0,x:113,width:223,var:"box_gold",height:230},child:[{type:"Image",props:{y:60,x:108,var:"img_reward",skin:"res/ui/common/yiduijinbi2.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:168,x:3,width:215,var:"lbGold",text:"+100",strokeColor:"#ffffff",stroke:4,height:65,fontSize:40,font:"Microsoft YaHei",color:"#3ea72d",bold:!0,align:"center"}}]},{type:"Box",props:{x:142,width:223,var:"box_img",height:230},child:[{type:"Image",props:{y:61,x:120,var:"img_skin",skin:"res/skinUI/Ball_01.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:168,x:0,width:243,var:"lb_skin_text",text:"开局体积变大",height:65,fontSize:40,font:"Microsoft YaHei",color:"#ffffff",align:"center"}}]}]}]},i}(Dialog);e.GetGoldViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.GrowViewUI.uiView)},i.uiView={type:"View",props:{width:400,height:160},child:[{type:"Text",props:{y:80,x:0,width:400,var:"text_content",valign:"middle",text:"球球成长",strokeColor:"#000000",stroke:6,height:80,fontSize:30,font:"Microsoft YaHei",color:"#00a3ff",align:"center"},compId:2}],animations:[{nodes:[{target:2,keyframes:{y:[{value:80,tweenMethod:"linearNone",tween:!0,target:2,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:2,key:"y",index:24}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:2,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:2,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:2,key:"visible",index:25}],fontSize:[{value:30,tweenMethod:"linearNone",tween:!0,target:2,key:"fontSize",index:0},{value:52,tweenMethod:"linearNone",tween:!0,target:2,key:"fontSize",index:24}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"alpha",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:2,key:"alpha",index:24}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i}(View);e.GrowViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.GuideViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1136},child:[{type:"Image",props:{y:805,x:0,width:640,skin:"res/ui/common/di1.png",sizeGrid:"1,0,1,0",height:310}},{type:"Image",props:{y:916,x:194,skin:"res/ui/common/quanquan.png"}},{type:"Text",props:{y:815,x:113,text:"开局碾压小建筑群，成长更快哦~",height:40,fontSize:28,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Image",props:{y:835,x:160,skin:"res/ui/guide/0.png"},compId:10}],animations:[{nodes:[{target:10,keyframes:{x:[{value:160,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0}],skin:[{value:"res/ui/guide/0.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:0},{value:"res/ui/guide/1.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:1},{value:"res/ui/guide/2.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:2},{value:"res/ui/guide/3.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:3},{value:"res/ui/guide/4.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:4},{value:"res/ui/guide/5.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:5},{value:"res/ui/guide/6.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:6},{value:"res/ui/guide/7.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:7},{value:"res/ui/guide/8.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:8},{value:"res/ui/guide/9.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:9},{value:"res/ui/guide/10.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:10},{value:"res/ui/guide/11.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:11},{value:"res/ui/guide/12.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:12},{value:"res/ui/guide/13.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:13},{value:"res/ui/guide/14.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:14},{value:"res/ui/guide/15.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:15},{value:"res/ui/guide/16.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:16},{value:"res/ui/guide/17.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:17},{value:"res/ui/guide/18.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:18},{value:"res/ui/guide/19.png",tweenMethod:"linearNone",tween:!1,target:10,key:"skin",index:19},{value:"res/ui/guide/19.png",tweenMethod:"linearNone",tween:!1,target:10,label:null,key:"skin",index:29}]}}],name:"ani1",id:1,frameRate:19,action:0}]},i}(View);e.GuideViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.HoleAteViewUI.uiView)},i.uiView={type:"View",props:{width:500,height:120},child:[{type:"Box",props:{y:70,x:50,visible:!0},compId:5,child:[{type:"Text",props:{y:0,x:0,width:400,var:"text_ate",text:"碾碎对手 +100",height:50,fontSize:40,font:"Microsoft YaHei",color:"#ffcc00",align:"center"}}]}],animations:[{nodes:[{target:5,keyframes:{y:[{value:70,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:35}],x:[{value:50,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:0},{value:-50,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:35}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:36}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:35}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:35}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:.8,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:35}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i}(View);e.HoleAteViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.InvincibleViewUI.uiView)},i.uiView={type:"View",props:{width:200,height:40},child:[{type:"Text",props:{y:0,x:0,width:200,text:"无  敌",strokeColor:"#000000",stroke:6,height:40,fontSize:26,font:"Microsoft YaHei",color:"#ffffff",align:"center"},compId:2}],animations:[{nodes:[{target:2,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:2,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:2,label:null,key:"x",index:25}],color:[{value:"#ffffff",tweenMethod:"linearNone",tween:!1,target:2,key:"color",index:0},{value:"#ff0000",tweenMethod:"linearNone",tween:!1,target:2,key:"color",index:5},{value:"#00ff33",tweenMethod:"linearNone",tween:!1,target:2,key:"color",index:10},{value:"#ffd600",tweenMethod:"linearNone",tween:!1,target:2,key:"color",index:15},{value:"#00c1ff",tweenMethod:"linearNone",tween:!1,target:2,key:"color",index:20},{value:"#ffffff",tweenMethod:"linearNone",tween:!1,target:2,label:null,key:"color",index:25}]}}],name:"ani1",id:1,frameRate:24,action:2}]},i}(View);e.InvincibleViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.ItemGridUI.uiView)},i.uiView={type:"View",props:{width:84,height:89},child:[{type:"Image",props:{y:0,x:0,skin:"res/ui/common/daoju.png"}},{type:"Image",props:{y:44,x:44,width:56,var:"icon",skin:"res/ui/common/jinbi.png",height:56,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:52,x:3,width:76,var:"lbCount",text:"20",strokeColor:"#ffffff",stroke:2,height:26,fontSize:24,font:"Microsoft YaHei",color:"#3ea72d",bold:!0,align:"right"}}]},i}(View);e.ItemGridUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.KillTipViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:151},child:[{type:"Box",props:{y:0,x:640,width:321,height:151},compId:9,child:[{type:"Image",props:{y:0,x:0,var:"img_tip",skin:"res/ui/game/8lian.png"}}]}],animations:[{nodes:[{target:9,keyframes:{x:[{value:640,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:0},{value:300,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:3},{value:159,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:15},{value:159,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:25},{value:30,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:37},{value:-321,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:40}]}}],name:"KillTipMove",id:1,frameRate:24,action:0}]},i}(View);e.KillTipViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.MatchViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1136},child:[{type:"Image",props:{y:292,x:50,width:540,skin:"res/ui/common/diban1.png",sizeGrid:"58,45,49,45",name:"BG",height:487}},{type:"Image",props:{y:193,x:21,skin:"res/ui/common/landi.png"}},{type:"ProgressBar",props:{y:420,x:140,width:360,visible:!1,var:"bar_loading",skin:"loading/jiazaitiao.png",sizeGrid:"6,20,8,13",height:40}},{type:"Text",props:{y:30,x:140,var:"lb_time",text:"2分钟",name:"2分钟",fontSize:80,font:"SimHei",color:"#ffdc19"}},{type:"Text",props:{y:199,x:160,width:188,text:"争取第一",name:"争取第一",height:63,fontSize:47,color:"#ffffff"}},{type:"Text",props:{y:860,x:246,visible:!1,text:"吃鸡攻略",name:"吃鸡攻略",fontSize:37,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Text",props:{y:940,x:170,visible:!1,text:"黑洞会成长",name:"吞无不胜",fontSize:60,font:"Microsoft YaHei",color:"#ff8830"}},{type:"Text",props:{y:402,x:282,width:75,var:"lbMatchNum",text:"5 / 15",height:35,fontSize:26,font:"Microsoft YaHei",color:"#00afb5"}},{type:"Text",props:{y:355,x:196,text:"正在搜索全球球球",name:"正在",height:45,fontSize:30,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Text",props:{y:355,x:444,text:"..",name:"。。。",height:45,fontSize:31,font:"Microsoft YaHei",color:"#ffffff"},compId:163},{type:"Image",props:{y:480,x:136,var:"img_11",skin:"res/ui/pipei/touxiangk.png",name:"1 1"}},{type:"Image",props:{y:480,x:213,var:"img_12",skin:"res/ui/pipei/touxiangk.png",name:"1 2"}},{type:"Image",props:{y:480,x:290,var:"img_13",skin:"res/ui/pipei/touxiangk.png",name:"1 3"}},{type:"Image",props:{y:480,x:367,var:"img_14",skin:"res/ui/pipei/touxiangk.png",name:"1 4"}},{type:"Image",props:{y:480,x:444,var:"img_15",skin:"res/ui/pipei/touxiangk.png",name:"1 5"}},{type:"Image",props:{y:557,x:136,var:"img_21",skin:"res/ui/pipei/touxiangk.png",name:"2 1"}},{type:"Image",props:{y:557,x:213,var:"img_22",skin:"res/ui/pipei/touxiangk.png",name:"2 2"}},{type:"Image",props:{y:557,x:290,var:"img_23",skin:"res/ui/pipei/touxiangk.png",name:"2 3"}},{type:"Image",props:{y:557,x:367,var:"img_24",skin:"res/ui/pipei/touxiangk.png",name:"2 4"}},{type:"Image",props:{y:557,x:444,var:"img_25",skin:"res/ui/pipei/touxiangk.png",name:"2 5"}},{type:"Image",props:{y:634,x:136,var:"img_31",skin:"res/ui/pipei/touxiangk.png",name:"3 1"}},{type:"Image",props:{y:634,x:213,var:"img_32",skin:"res/ui/pipei/touxiangk.png",name:"3 2"}},{type:"Image",props:{y:634,x:290,var:"img_33",skin:"res/ui/pipei/touxiangk.png",name:"3 3"}},{type:"Image",props:{y:634,x:367,var:"img_34",skin:"res/ui/pipei/touxiangk.png",name:"3 4"}},{type:"Image",props:{y:634,x:444,var:"img_35",skin:"res/ui/pipei/touxiangk.png",name:"3 5"}},{type:"Image",props:{y:356,x:146,skin:"res/ui/pipei/tub.png"},compId:100},{type:"Image",props:{y:510,x:165,width:52,var:"avatar0",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item0",height:52}},{type:"Image",props:{y:510,x:242,width:52,var:"avatar1",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item1",height:52}},{type:"Image",props:{y:510,x:319,width:52,var:"avatar2",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item2",height:52}},{type:"Image",props:{y:510,x:396,width:52,var:"avatar3",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item3",height:52}},{type:"Image",props:{y:510,x:473,width:52,var:"avatar4",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item4",height:52}},{type:"Image",props:{y:587,x:165,width:52,var:"avatar5",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item5",height:52}},{type:"Image",props:{y:587,x:242,width:52,var:"avatar6",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item6",height:52}},{type:"Image",props:{y:587,x:319,width:52,var:"avatar7",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item7",height:52}},{type:"Image",props:{y:587,x:396,width:52,var:"avatar8",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item8",height:52}},{type:"Image",props:{y:587,x:473,width:52,var:"avatar9",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item9",height:52}},{type:"Image",props:{y:664,x:165,width:52,var:"avatar10",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item10",height:52}},{type:"Image",props:{y:664,x:242,width:52,var:"avatar11",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item11",height:52}},{type:"Image",props:{y:664,x:319,width:52,var:"avatar12",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item12",height:52}},{type:"Image",props:{y:664,x:396,width:52,var:"avatar13",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item13",height:52}},{type:"Image",props:{y:664,x:473,width:52,var:"avatar14",skin:"res/ui/avatar/unknow.png",pivotY:26,pivotX:26,name:"item14",height:52}}],animations:[{nodes:[{target:100,keyframes:{y:[{value:360,tweenMethod:"linearNone",tween:!0,target:100,key:"y",index:0},{value:350,tweenMethod:"linearNone",tween:!0,target:100,key:"y",index:10},{value:360,tweenMethod:"linearNone",tween:!0,target:100,key:"y",index:20},{value:370,tweenMethod:"linearNone",tween:!0,target:100,key:"y",index:30},{value:360,tweenMethod:"linearNone",tween:!0,target:100,key:"y",index:40}],x:[{value:130,tweenMethod:"linearNone",tween:!0,target:100,key:"x",index:0},{value:140,tweenMethod:"linearNone",tween:!0,target:100,key:"x",index:10},{value:150,tweenMethod:"linearNone",tween:!0,target:100,key:"x",index:20},{value:140,tweenMethod:"linearNone",tween:!0,target:100,key:"x",index:30},{value:130,tweenMethod:"linearNone",tween:!0,target:100,key:"x",index:40}]}},{target:163,keyframes:{x:[{value:444,tweenMethod:"linearNone",tween:!0,target:163,key:"x",index:0}],text:[{value:"...",tweenMethod:"linearNone",tween:!1,target:163,key:"text",index:0},{value:"..",tweenMethod:"linearNone",tween:!1,target:163,key:"text",index:10},{value:".",tweenMethod:"linearNone",tween:!1,target:163,key:"text",index:20},{value:"..",tweenMethod:"linearNone",tween:!1,target:163,key:"text",index:30},{value:"...",tweenMethod:"linearNone",tween:!1,target:163,key:"text",index:40}]}}],name:"ani1",id:1,frameRate:24,action:2}]},i}(View);e.MatchViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.NearPlayerViewUI.uiView)},i.uiView={type:"View",props:{y:320,x:320,width:640,rotation:0,mouseEnabled:!1,height:640,anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:320,x:625,width:43,var:"img_arrow",skin:"res/ui/game/shanjiao.png",rotation:90,height:20,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:399,x:609,visible:!1,var:"img_xiezi",skin:"res/ui/game/xiezi.png",scaleY:.4,scaleX:.4,rotation:90,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:320,x:600,width:118,var:"text_name",text:"吃瓜一号选手...的",strokeColor:"#333333",stroke:2,rotation:90,overflow:"hidden",height:24,fontSize:17,font:"Microsoft YaHei",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"}}]},i}(View);e.NearPlayerViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.PromptInterfaceViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Box",props:{y:410,x:77},child:[{type:"Image",props:{width:486,skin:"res/ui/common/baoxiangdi.png",sizeGrid:"19,98,25,44",height:316}},{type:"Image",props:{y:216,x:60,var:"btn_Left",skin:"res/ui/game/img_shipinfuhuox.png"}},{type:"Image",props:{y:216,x:260,var:"btn_Right",skin:"res/ui/game/img_fenxiangfuhuox.png"}},{type:"Label",props:{y:229,x:97,width:99,var:"lab_Left",mouseThrough:!0,height:27,fontSize:24,color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:230,x:297,width:99,var:"lab_Right",mouseThrough:!0,height:31,fontSize:24,color:"#c56123",bold:!0,align:"center"}},{type:"Label",props:{y:70,x:57,wordWrap:!0,width:375,var:"lab_hint",valign:"middle",text:"这是一段测试文字，这是一段测试文字，这是一段测试文字，这是一段测试文字",height:79,fontSize:24,color:"#ffffff",align:"center"}}]}]},i}(Dialog);e.PromptInterfaceViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.Ready321ViewUI.uiView)},i.uiView={type:"View",props:{width:231,height:600},child:[{type:"Image",props:{y:0,x:-215,width:660,skin:"res/ui/game/daojishidi.png",name:"BG",height:231}},{type:"Image",props:{y:52,x:42,visible:!1,var:"img_start",skin:"res/ui/game/daojishiks.png",name:"开始"}},{type:"Image",props:{y:59,x:66,var:"img_number",skin:"res/ui/game/daojishi3.png"}},{type:"Box",props:{visible:!1,var:"boxDoubleSize"},child:[{type:"Image",props:{y:239,x:-51,width:333,skin:"res/ui/common/diban1.png",sizeGrid:"50,50,50,53",height:392}},{type:"Image",props:{y:277,x:27,skin:"res/ui/game/bianda.png"}},{type:"Text",props:{y:482,x:12,text:"开局增加2倍的大小",fontSize:24,color:"#ffffff"}},{type:"Image",props:{y:527,x:28,var:"img_lingqu",skin:"res/ui/game/img_fenxiangfuhuox.png"},child:[{type:"Text",props:{y:11,x:17,width:139,text:"免 费 领 取",height:32,fontSize:26,color:"#c56123",bold:!0,align:"center"}}]},{type:"Image",props:{y:527,x:28,var:"img_gold_lingqu",skin:"res/ui/game/img_fenxiangfuhuox.png"},child:[{type:"Image",props:{y:4,x:10,skin:"res/ui/common/jinbi.png"}},{type:"Text",props:{y:11,x:43,width:116,var:"bigCost",text:"100",height:32,fontSize:30,color:"#c56123",bold:!0,align:"center"}}]},{type:"Image",props:{y:527,x:28,var:"img_share_lingqu",skin:"res/ui/game/img_fenxiangfuhuox.png"},child:[{type:"Image",props:{y:8,x:18,skin:"res/ui/common/fenxiang1.png"}},{type:"Text",props:{y:13,x:50,width:116,text:"分享领取",height:32,fontSize:24,color:"#c56123",bold:!0,align:"center"}}]}]}]},i}(View);e.Ready321ViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.ReadyOneViewUI.uiView)},i.uiView={type:"View",props:{width:230,height:230},child:[{type:"Image",props:{y:0,x:-214,width:660,skin:"res/ui/game/daojishidi.png",height:231}},{type:"Box",props:{y:115,x:115,width:230,scaleY:1,scaleX:1,height:230,anchorY:.5,anchorX:.5},compId:6,child:[{type:"Image",props:{y:73,x:36,var:"img_second",skin:"res/ui/game/daojishi60m.png",name:"XX秒"}},{type:"Image",props:{y:35,x:73,skin:"res/ui/game/daojishi.png",name:"倒计时"}}]}],animations:[{nodes:[{target:6,keyframes:{y:[{value:115,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0}],x:[{value:115,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0}],scaleY:[{value:.3,tweenMethod:"bounceInOut",tween:!0,target:6,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:6}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0},{value:1,tweenMethod:"bounceOut",tween:!0,target:6,key:"scaleX",index:6}]}}],name:"ani_show",id:1,frameRate:24,action:0},{nodes:[{target:6,keyframes:{x:[{value:115,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0}],scaleY:[{value:1,tweenMethod:"bounceInOut",tween:!0,target:6,key:"scaleY",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:6}],scaleX:[{value:1,tweenMethod:"bounceOut",tween:!0,target:6,key:"scaleX",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:6}]}}],name:"ani_hide",id:2,frameRate:24,action:0}]},i}(View);e.ReadyOneViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.ReliveViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1136},child:[{type:"Image",props:{y:705,x:343,var:"btn_pay_for_relive",skin:"res/ui/game/btn_jinbifuhuo.png"},child:[{type:"Image",props:{y:-33,x:205,width:81,skin:"res/ui/gameover/dibanxiao.png",sizeGrid:"-7,-19,0,-12",height:49},child:[{type:"Text",props:{y:2,x:8,width:55,text:"变大",height:32,fontSize:26,color:"#ffcd1f",bold:!0}}]},{type:"Text",props:{y:33,x:174,width:59,text:"复活",strokeColor:"#068ea0",stroke:3,mouseThrough:!0,height:37,fontSize:28,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"right"}},{type:"Text",props:{y:33,x:80,width:55,var:"text_gold",text:"50",strokeColor:"#068ea0",stroke:3,mouseThrough:!0,height:37,fontSize:28,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"center"}},{type:"Text",props:{y:82,x:70,text:"(立即复活)",fontSize:20,font:"Microsoft YaHei",color:"#15494e",bold:!0}}]},{type:"Image",props:{y:705,x:40,var:"btn_share_for_relive",skin:"res/ui/game/btn_fenxiangfuhuo.png"},child:[{type:"Text",props:{y:33,x:80,width:140,text:"分享复活",strokeColor:"#ce5e07",stroke:3,height:40,fontSize:28,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"center"}},{type:"Text",props:{y:82,x:82,text:"(立即复活)",fontSize:20,font:"Microsoft YaHei",color:"#FCCA90",bold:!0}},{type:"Image",props:{y:-33,x:204,width:81,skin:"res/ui/gameover/dibanxiao.png",sizeGrid:"-7,-19,0,-12",height:49},child:[{type:"Text",props:{y:2,x:8,width:55,text:"变大",height:32,fontSize:26,color:"#ffcd1f",bold:!0}}]}]},{type:"Image",props:{y:286,x:21,skin:"res/ui/game/di2.png"}},{type:"Text",props:{y:294,x:102,width:246,var:"text_enemy",text:"超级梦梦梦",overflow:"hidden",height:61,fontSize:44,font:"Microsoft YaHei",color:"#FBC824",align:"center"}},{type:"Text",props:{y:294,x:354,width:176,text:"碾碎了你",height:61,fontSize:44,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Text",props:{y:616,x:141,width:357,text:"(倒计时复活球球大小不变)",height:35,fontSize:20,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Text",props:{y:378,x:220,width:199,var:"text_countdown",text:"10",height:231,fontSize:170,font:"Microsoft YaHei",color:"#ff9409",align:"center"}},{type:"Label",props:{y:860,x:291,width:57,visible:!1,var:"text_skip",underlineColor:"#ffffff",underline:!0,text:"跳 过",height:36,fontSize:25,font:"SimHei",color:"#ffffff"}},{type:"Label",props:{y:860,x:269,width:102,var:"text_exit",underlineColor:"#ffffff",underline:!0,text:"重新开局",height:36,fontSize:25,font:"SimHei",color:"#ffffff"}}]},i}(View);e.ReliveViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Game.RemoteSenseViewUI.uiView)},i.uiView={type:"View",props:{y:0,x:0,width:120,pivotY:0,pivotX:0,height:120},child:[{type:"Image",props:{y:0,x:0,skin:"res/ui/game/yaogan.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:0,x:0,var:"img_little_circle",skin:"res/ui/game/yaoganyuan.png",anchorY:.5,anchorX:.5}}]},i}(View);e.RemoteSenseViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Game.SurvivalOverViewUI.uiView)},i.uiView={type:"Dialog",props:{y:0,x:0,width:640,height:1136},child:[{type:"Image",props:{y:-288,x:0,width:640,skin:"res/ui/home/img_youxiheidi.png",sizeGrid:"1,0,1,0",name:"BG",height:1e3}},{type:"Image",props:{y:475,x:375,skin:"res/ui/common/jifentubiao.png",name:"五角星"}},{type:"Image",props:{y:720,x:13,var:"img_continue",skin:"res/ui/common/btn_fanhui.png",name:"close"}},{type:"Image",props:{y:158,x:11,skin:"res/ui/common/landi.png",name:"蓝底"}},{type:"Text",props:{y:331,x:197,text:"获得排名",name:"获得排名",fontSize:32,font:"SimHei",color:"#ffffff",bold:!0}},{type:"Text",props:{y:483,x:218,width:104,text:"段位积分：",name:"奖励",height:24,fontSize:22,font:"SimHei",color:"#ffffff",bold:!0}},{type:"Text",props:{y:481,x:323,width:50,var:"text_award",text:"100",height:24,fontSize:26,font:"SimHei",color:"#fcff00",bold:!0}},{type:"Text",props:{y:394,x:135,width:104,text:"Crushing score:",name:"碾压得分：",height:24,fontSize:22,font:"SimHei",color:"#ffffff",bold:!0}},{type:"Text",props:{y:394,x:233,width:90,var:"lb_weight",text:"66666分",name:"6666",height:27,fontSize:23,font:"SimHei",color:"#ff1818",bold:!0,align:"right"}},{type:"Text",props:{y:394,x:346,width:104,text:"Crushing opponents:",name:"碾压对手：",height:27,fontSize:22,font:"SimHei",color:"#ffffff",bold:!0}},{type:"Text",props:{y:394,x:449,width:52,var:"lb_kill",text:"10人",name:"10人",height:26,fontSize:23,font:"SimHei",color:"#ff1818",bold:!0,align:"right"}},{type:"Box",props:{y:25,x:0,width:640,visible:!1,var:"box_winner",name:"吃鸡面板",height:642},child:[{type:"Image",props:{y:-8,x:160,skin:"res/ui/gameover/shenglizi.png",name:"头衔"}},{type:"Image",props:{y:409,x:192,var:"img_6bei",skin:"res/ui/gameover/zi.png"}},{type:"Text",props:{y:228,x:104,width:432,var:"text_winner_tips",text:"坚持就是胜利",height:55,fontSize:48,font:"SimHei",color:"#ffcd1f",align:"center"}},{type:"Text",props:{y:285,x:346,width:51,var:"text_winner_rank",text:"1",height:66,fontSize:68,font:"SimHei",color:"#f40f0b",bold:!0,align:"center"}}]},{type:"Box",props:{y:25,x:0,width:640,var:"box_loser",height:618},child:[{type:"Text",props:{y:290,x:343,width:59,var:"text_loser_rank",text:"12",name:"排名",height:62,fontSize:60,font:"SimHei",color:"#0ff1ff",align:"center"}},{type:"Text",props:{y:225,x:105,width:50,text:"被",name:"被",height:50,fontSize:45,font:"SimHei",color:"#ffffff",align:"center"}},{type:"Text",props:{y:225,x:155,width:216,var:"text_other_name",text:"吃瓜少年",name:"吃瓜少年熊猫",height:50,fontSize:45,font:"SimHei",color:"#ffcd1f",align:"center"}},{type:"Text",props:{y:225,x:385,width:208,text:"压碎了T-T",name:"压碎了T-T",height:50,fontSize:45,font:"SimHei",color:"#ffffff",align:"center"}},{type:"Image",props:{y:113,x:320,skin:"res/ui/gameover/beitunle.png",anchorY:.5,anchorX:.5}}]},{type:"Box",props:{y:518,x:230,width:180,var:"box_reward",height:86}},{type:"Box",props:{y:608,x:190,var:"box_xuanyao"},child:[{type:"Image",props:{var:"btnShare",skin:"res/ui/lottery/btn_viedo.png"}},{type:"Label",props:{y:27,x:65,width:160,var:"lb_xuanyao_tip",valign:"top",text:"求助好友",strokeColor:"#e24716",stroke:4,mouseThrough:!0,height:42,fontSize:38,font:"SimHei",color:"#e0feef",bold:!0,align:"center"}},{type:"Image",props:{y:30,x:26,skin:"res/ui/common/fenxiang1.png"}}]},{type:"Box",props:{y:762,x:43,width:399,var:"box_video_reward",scaleY:.65,scaleX:.65,height:196},child:[{type:"Image",props:{y:128,x:199.5,var:"btnVideo",skin:"res/ui/gameover/img_shuangbei.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:98,x:42,skin:"res/ui/gameover/shipin2.png",name:"视频标记"}},{type:"Image",props:{y:-7,x:100,width:210,skin:"res/ui/gameover/jb300.png",sizeGrid:"26,175,39,35",name:"300%BG",height:90}},{type:"Text",props:{y:17,x:188,var:"text_300or600",text:"+200%",fontSize:30,font:"SimHei",color:"#fff600",bold:!0}},{type:"Label",props:{y:95,x:98,width:276,var:"lb_3or6",valign:"top",text:"双倍奖励",strokeColor:"#068ea0",stroke:4,mouseThrough:!0,height:58,fontSize:56,font:"SimHei",color:"#e0feef",bold:!0,align:"center"}},{type:"Image",props:{y:10,x:136,skin:"res/ui/common/jinbi.png"}}]},{type:"Box",props:{y:761,x:336,width:399,var:"box_share_reward",scaleY:.65,scaleX:.65,height:198},child:[{type:"Image",props:{y:128,x:199.5,var:"btn_share_double",skin:"res/ui/home/img_haoyouzhuli.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:-7,x:100,width:210,skin:"res/ui/gameover/jb300.png",sizeGrid:"26,175,39,35",name:"300%BG",height:90}},{type:"Image",props:{y:10,x:137,skin:"res/ui/common/jinbi.png"}},{type:"Image",props:{y:98,x:42,skin:"res/ui/common/fenxiang1.png",scaleY:1.5,scaleX:1.5,name:"分享标记"}},{type:"Text",props:{y:17,x:187,text:"+300%",fontSize:30,font:"SimHei",color:"#fff600",bold:!0}},{type:"Label",props:{y:95,x:97,width:276,valign:"top",text:"三倍奖励",strokeColor:"#bc3c01",stroke:4,mouseThrough:!0,height:58,fontSize:56,font:"SimHei",color:"#e0feef",bold:!0,align:"center"}}]},{type:"Sprite",props:{y:920,x:0,width:640,var:"ad",height:100}},{type:"Sprite",props:{y:595,x:525,var:"spTousu"}}]},i}(Dialog);e.SurvivalOverViewUI=i})((e=t.ui||(t.ui={})).Game||(e.Game={}))}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.GuessViewUI.uiView)},i.uiView={type:"View",props:{width:484,height:121},child:[{type:"Image",props:{y:0,x:0,name:"BG"}},{type:"Image",props:{y:10,x:45,width:100,var:"img_1",height:100}},{type:"Image",props:{y:10,x:155,width:100,var:"img_2",height:100}},{type:"Image",props:{y:10,x:264,width:100,var:"img_3",height:100}},{type:"Image",props:{y:10,x:374,width:100,var:"img_4",height:100}}]},i}(View),e.GuessViewUI=i}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.HelpVideoViewUI.uiView)},i.uiView={type:"View",props:{width:202,height:280},child:[{type:"Image",props:{y:0,x:0,width:202,skin:"res/ui/home/helpBg.png",height:280}},{type:"Image",props:{y:5,x:165,var:"btnClose",skin:"res/ui/home/btnShipinX.png"}}]},i}(View),e.HelpVideoViewUI=i}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.ChatViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:228},child:[{type:"Panel",props:{y:0,x:0,width:640,var:"chatPanel",height:228}}]},i}(View);e.ChatViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.DuanWeiViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Image",props:{y:101,x:33,width:573,skin:"res/ui/common/diban1.png",sizeGrid:"50,50,50,50",height:795}},{type:"Image",props:{y:150,x:53,var:"img_diban3",skin:"res/ui/common/diban3.png"}},{type:"Image",props:{y:241,x:262,width:116,var:"imgRank",skin:"res/ui/common/duanwei_7.png",height:95}},{type:"Image",props:{y:76,x:45,width:549,skin:"res/ui/common/title.png"}},{type:"Image",props:{y:98,x:548,skin:"res/ui/common/btnClose.png",name:"close",mouseEnabled:!0}},{type:"Image",props:{y:389,x:211,skin:"res/ui/common/reward.png"}},{type:"Image",props:{y:83,x:234,visible:!0,skin:"res/ui/home/zi2.png"}},{type:"Image",props:{y:662,x:320,width:200,var:"imgSkin",skin:"res/skinUI/Ball_01.png",rotation:0,height:200,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:292,x:202,width:235,skin:"res/ui/game/daojishidi.png",height:35}},{type:"Label",props:{y:346,x:222,width:196,visible:!0,var:"lbRank",text:"当前段位：白银1阶",height:26,fontSize:18,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:171,x:274,width:92,visible:!0,var:"lbSaiJi",text:"S1 赛季",strokeColor:"#ffffff",stroke:2,height:26,fontSize:24,font:"Microsoft YaHei",color:"#DF5119",bold:!0,align:"center"}},{type:"Label",props:{y:204,x:222,width:196,visible:!0,var:"lbTime",text:"2018-10-1 至 2018-11-1",height:26,fontSize:16,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:503,x:172,width:295,visible:!0,var:"lbPrizeSkin",text:"S1 赛季王者奖励",strokeColor:"#ffffff",stroke:4,height:34,fontSize:26,font:"Microsoft YaHei",color:"#f34933",bold:!0,align:"center"}},{type:"Label",props:{y:430,x:222,width:196,visible:!0,text:"赛季奖励",strokeColor:"#c2491b",stroke:2,mouseThrough:!0,height:26,fontSize:20,color:"#fff9ff",bold:!0,align:"center"}},{type:"Label",props:{y:815,x:123,width:393,visible:!0,text:"The season will be awarded at the end of the\nseason and the season points will be reset.",height:26,fontSize:18,font:"Microsoft YaHei",color:"#243c6f",bold:!0,align:"center"}},{type:"Label",props:{y:404,x:254,width:131,var:"lbPrizeNum",text:"Gold X 100",strokeColor:"#c2491b",stroke:2,height:26,fontSize:20,color:"#fff9ff",bold:!0,align:"center"}},{type:"Label",props:{y:767,x:123,width:393,visible:!0,var:"lbSkinName",text:"皮肤名称",strokeColor:"#ffffff",stroke:4,height:38,fontSize:24,font:"Microsoft YaHei",color:"#0050ff",bold:!0,align:"center"}},{type:"Label",props:{y:639,x:163,width:313,var:"lbQiDai",text:"敬请期待",strokeColor:"#ffffff",stroke:5,height:83,fontSize:75,color:"#000000",bold:!0}},{type:"Label",props:{y:302,x:239,text:"赛季结束后可领取奖励",fontSize:16,color:"#ffffff",align:"center"}},{type:"Sprite",props:{y:930,x:126,width:387,var:"ad",height:185}}]},i}(Dialog);e.DuanWeiViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.FriendHelpRenderUI.uiView)},i.uiView={type:"View",props:{width:100,height:500},child:[{type:"Image",props:{y:30,x:19,width:61,skin:"res/ui/home/huitouxiang.png",height:61}},{type:"Image",props:{y:34,x:23,width:54,var:"imgAvatar",height:54}},{type:"Image",props:{y:43,x:32,var:"jiahao",skin:"res/ui/home/yaoqingjia.png"}},{type:"Image",props:{y:96,x:4,visible:!1,var:"imgName",skin:"res/ui/home/mingzidi_friend.png"}},{type:"Image",props:{y:93,x:16,var:"btnInvite",skin:"res/ui/home/yaoqing.png"},child:[{type:"Label",props:{y:8,x:17,width:32,text:"邀请",strokeColor:"#1b5f07",stroke:1,height:17,fontSize:16,color:"#ffffff",bold:!0,align:"center"}}]},{type:"Image",props:{y:223,x:50,width:55,var:"rewardItemBg",skin:"res/ui/common/daoju.png",height:58,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:220,x:51,width:50,var:"rewardID",skin:"res/ui/common/yiduijinbi.png",height:41.6,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:269,x:51,var:"rewardStateLab",text:"未获得",fontSize:18,font:"Microsoft YaHei",color:"#959595",bold:!0,anchorY:.5,anchorX:.5,align:"center"}},{type:"Label",props:{y:238,x:48,width:50,var:"goldNum",text:"1000",strokeColor:"#ffffff",stroke:2,height:16,fontSize:14,font:"Microsoft YaHei",color:"#3ea72d",bold:!0,anchorY:.5,anchorX:.5,align:"right"}},{type:"Label",props:{y:97,x:5,width:90,var:"lbName",text:"玩家名字123",overflow:"hidden",height:26,fontSize:14,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Image",props:{y:269,x:50,var:"rewardBtn",skin:"res/ui/novicePrivilege/lq.png",anchorY:.5,anchorX:.5}}]},i}(View);e.FriendHelpRenderUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.FriendHelpViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Sprite",props:{y:909,x:126,width:387,var:"ad",height:170}},{type:"Image",props:{y:125,x:31,width:578,skin:"res/image/tybj.png",sizeGrid:"50,50,50,50",height:783}},{type:"Image",props:{y:159,x:73,skin:"res/image/mianfei_diban.png"}},{type:"Image",props:{y:118,x:570,var:"btnClose",skin:"res/ui/common/btnClose.png"}},{type:"List",props:{y:256,x:119,width:401,var:"list",spaceX:50,repeatY:1,repeatX:3,renderType:"render",height:300}},{type:"Button",props:{y:741,x:120,var:"btnHelp",stateNum:1,skin:"res/ui/home/img_haoyouzhuli.png"},child:[{type:"Label",props:{y:40,x:99,width:200,text:"立即邀请",strokeColor:"#ce5e07",stroke:4,height:67,fontSize:50,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"center"}}]},{type:"Image",props:{y:70,x:172,skin:"res/ui/home/zi.png"}},{type:"Image",props:{y:408,x:177,width:285,skin:"res/ui/activity/gray.png",sizeGrid:"6,15,10,15"}},{type:"Image",props:{y:413,x:177,width:0,var:"imgProgress1",skin:"res/ui/activity/red.png",sizeGrid:"0,5,0,7"}},{type:"Image",props:{y:397,x:148,var:"imgPoint0",skin:"res/ui/home/hui.png"}},{type:"Image",props:{y:397,x:299,var:"imgPoint1",skin:"res/ui/home/hui.png"}},{type:"Image",props:{y:397,x:448,var:"imgPoint2",skin:"res/ui/home/hui.png"}},{type:"Image",props:{y:552,x:249,skin:"res/ui/common/di3.png"}},{type:"Text",props:{y:556,x:265,width:110,text:"规则说明",height:30,fontSize:25,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:610,x:112,wordWrap:!0,width:431,text:"1.                            \\n2.  邀请的玩家需点击该界面分享链接才能成功助力。",leading:20,height:90,fontSize:18,font:"Microsoft YaHei",color:"#ffffff"}},{type:"Label",props:{y:608,x:138,text:"所邀请的玩家必须是之前未进入过游戏才能计数。",strokeColor:"#005122",stroke:4,fontSize:18,font:"Microsoft YaHei",color:"#4dff20"}},{type:"Label",props:{y:693,x:155,text:"再邀请      位玩家即可获得",fontSize:28,font:"Microsoft YaHei",color:"#ffffff",bold:!1}},{type:"Label",props:{y:687,x:243,width:45,var:"lbNum",text:"5",strokeColor:"#005122",stroke:4,height:40,fontSize:40,font:"Microsoft YaHei",color:"#4dff20",bold:!0,align:"center"}},{type:"Label",props:{y:529,x:443,visible:!1,var:"alreadyShiWan",text:"已试玩",fontSize:18,color:"#4dff20",bold:!0}},{type:"Image",props:{y:525,x:435,width:72,visible:!1,var:"btnShiWan",skin:"res/ui/common/btnShiWan.png",height:30},child:[{type:"Label",props:{y:3,x:27,width:36,text:"试 玩",height:17,fontSize:14,font:"Microsoft YaHei",color:"#c56123",bold:!0,align:"center"}}]}]},i}(Dialog);e.FriendHelpViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.HomePageUI.uiView)},i.uiView={type:"View",props:{y:0,x:0,width:640,labelStroke:-33,height:1136},child:[{type:"Image",props:{y:0,x:0,var:"img_background",skin:"loading/img_bj.png",sizeGrid:"0,1,1000,1",rotation:0,name:"img_background"}},{type:"Image",props:{y:339.73525,x:132,width:375,skin:"loading/img_chengshi.png",name:"城市背景",height:281}},{type:"Image",props:{y:226.73525,x:320,skin:"loading/logo.png",scaleY:.9,scaleX:.9,name:"LOGO",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:554.73525,x:320,var:"img_skin",skin:"res/skinUI/Ball_01.png",scaleY:.7,scaleX:.7,anchorY:.5,anchorX:.5}},{type:"Box",props:{y:620,x:0,width:640,var:"box_btn",name:"下方按钮",height:295},child:[{type:"Box",props:{y:-215,x:534,var:"boxLottery"},child:[{type:"Image",props:{skin:"res/ui/home/xiaozhuanp.png"}},{type:"Image",props:{y:35,x:40,width:19,var:"imgArrow",skin:"res/ui/home/xiaojiangtou .png",rotation:0,pivotY:13,pivotX:9,height:23}}]},{type:"Image",props:{y:-428,x:63,var:"btnActivity",skin:"res/ui/home/active27.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:200,x:155,var:"img_share",skin:"res/ui/home/img_fenxiang.png",name:"声音"}},{type:"Image",props:{y:200,x:279,var:"btnRank",skin:"res/ui/home/img_paihang.png"}},{type:"Image",props:{y:105,x:200,visible:!1,var:"img_zudui",skin:"res/ui/home/img_duizhan.png"}},{type:"Image",props:{y:140,x:193,var:"img_mode",skin:"res/ui/home/jingdian.png"}},{type:"Image",props:{y:165,x:588,visible:!1,var:"img_mode_select",skin:"res/ui/home/img_youxidi.png"},child:[{type:"Image",props:{y:42,x:-18,visible:!1,skin:"res/ui/home/img_moshi.png"}}]},{type:"Image",props:{y:-82,x:535,var:"btnSkin",skin:"res/ui/home/btnPifu.png"}},{type:"Image",props:{y:-77,x:587,var:"imgRedPointSkin",skin:"res/ui/home/hd.png"}},{type:"Image",props:{y:-215,x:20,var:"btnZhuLi",skin:"res/ui/home/btnZhuli.png"}},{type:"Image",props:{y:-30,x:63,var:"btnNovicePrivilege",skin:"res/ui/home/xsthlibao.png",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:16,x:60,visible:!1,var:"img_novice_red",skin:"res/ui/home/hd.png"}}]},{type:"Image",props:{y:-215,x:534,visible:!1,var:"btnInvite",skin:"res/ui/home/img_yqsjb.png"}},{type:"Image",props:{y:200,x:403,var:"btnShezhi",skin:"res/ui/home/img_shezhi.png"}},{type:"Image",props:{y:-210,x:587,visible:!1,var:"inviteRedPoint",skin:"res/ui/home/hd.png"}},{type:"Image",props:{y:-209,x:587,var:"lotteryRedPoint",skin:"res/ui/home/hd.png"}},{type:"Image",props:{y:-210,x:68,var:"friendRedPoint",skin:"res/ui/home/hd.png"}},{type:"Animation",props:{y:11,x:183,width:275,visible:!1,var:"ani_kaishi",source:"ani/KaishiFlash.ani",name:"开始",height:131,autoPlay:!1}},{type:"Animation",props:{y:-248,x:511,width:128,visible:!1,var:"ani_zhuli",source:"ani/ButtonFlash.ani",name:"好友组力",height:128,autoPlay:!1}},{type:"Animation",props:{y:-248,x:-4,width:128,visible:!0,var:"ani_mail",source:"ani/ButtonFlash.ani",name:"邮箱",height:128,autoPlay:!1}},{type:"Animation",props:{y:-100,x:511,width:128,var:"ani_skin",source:"ani/ButtonFlash.ani",name:"黑洞皮肤",height:128,autoPlay:!1}},{type:"Animation",props:{y:-100,x:0,width:128,visible:!1,var:"ani_award",source:"ani/ButtonFlash.ani",name:"赛季奖励",height:128,autoPlay:!1}},{type:"Image",props:{y:-74,x:31,width:61,visible:!1,var:"img_player_rank",skin:"res/ui/common/duanwei_1.png",height:50.5}},{type:"Image",props:{y:-613,x:5,skin:"res/ui/home/touxiangnew.png",name:"段位背景"}},{type:"ProgressBar",props:{y:-608,x:67,visible:!1,var:"bar_rank_progress",skin:"res/ui/home/jingyantiao.png",sizeGrid:"6,19,5,17"}},{type:"Image",props:{y:-605,x:67,width:190,var:"jingyantiao",skin:"res/ui/home/jingyantiao.png",height:20}},{type:"Image",props:{y:-612,x:2,width:72,var:"img_rank_ui",skin:"res/ui/common/duanwei_1.png",height:60}},{type:"Label",props:{y:-577,x:103,width:78,var:"lbGold",text:"42142",strokeColor:"#000000",stroke:2,height:18,fontSize:19,font:"SimHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:-603,x:82,width:146,var:"text_rank_percent",text:"0/10",strokeColor:"#000000",stroke:2,height:19,fontSize:17,font:"SimHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:-545,x:15,wordWrap:!0,width:45,var:"text_rank_class",text:"青铜一阶",strokeColor:"#000000",stroke:2,height:34,fontSize:16,font:"SimHei",color:"#ffffff",align:"center"}}]},{type:"Image",props:{y:650,x:199,var:"btn_start_game",skin:"res/ui/home/img_kaishi.png"}},{type:"Box",props:{y:449.73525,x:213,width:214,var:"boxSelf",name:"个人信息",height:59},child:[{type:"Image",props:{var:"img_self_bg",skin:"res/ui/home/mingzidi.png",name:"BG",alpha:1}},{type:"Image",props:{y:28.5,x:29,width:56,var:"avatar",skin:"res/ui/avatar/unknow.png",height:56,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:15,x:58,width:140,var:"lbName",text:"玩家名字七个字",overflow:"hidden",height:29,fontSize:20,font:"Microsoft YaHei",color:"#ffffff",align:"center"}}]},{type:"Image",props:{y:337,x:2,visible:!1,var:"btnSuggestList",skin:"res/ui/common/btnOn.png"},child:[{type:"Image",props:{y:1,x:55,visible:!1,var:"imgGuessRedPoint",skin:"res/ui/home/hd.png"}}]},{type:"Box",props:{y:99,x:440,visible:!1,var:"boxVideo"},child:[{type:"Image",props:{y:1,x:-1,width:203,skin:"res/ui/home/helpBg.png",height:265}},{type:"Box",props:{y:-9,x:153,width:54,var:"btnCloseVideo",height:54},child:[{type:"Image",props:{y:14,x:14,skin:"res/ui/home/btnShipinX.png"}}]}]},{type:"Sprite",props:{y:947,x:119,width:387,var:"ad",height:48}}]},i}(View);e.HomePageUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.LoginRewardViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Image",props:{y:94,x:34,width:571,skin:"res/ui/common/diban1.png",sizeGrid:"33,36,51,37",name:"BG",height:747}},{type:"Image",props:{y:60,x:48,width:543,skin:"res/ui/common/title.png",height:71}},{type:"Image",props:{y:89,x:320,skin:"res/ui/login/login_title.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:132,x:53,var:"img_skinBG",skin:"res/ui/login/login_bg.png",name:"skinBG"}},{type:"Image",props:{y:608,x:321,width:110,var:"img_skin",skin:"res/skinUI/Ball_01.png",scaleY:2,scaleX:2,height:110,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:277,x:320,width:60,var:"img_gold",skin:"res/skinUI/Ball_05.png",height:60,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:302,x:282,width:75,var:"text_gold_num",text:"200",strokeColor:"#ffffff",stroke:4,height:26,fontSize:20,font:"Microsoft YaHei",color:"#3ea72d",bold:!0,align:"center"}},{type:"Text",props:{y:195,x:264,width:111,text:"今 日 奖 励",height:31,fontSize:20,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Text",props:{y:429,x:190,width:258,var:"text_jijiang_day",text:"累 积 登 录 x 天 可 获 得",strokeColor:"#ffffff",stroke:3,height:29,fontSize:20,font:"Microsoft YaHei",color:"#dc4f10",bold:!0,align:"center"}},{type:"Text",props:{y:722,x:222,width:195,var:"text_jijiang_name",text:"魅蓝星舰",strokeColor:"#ffffff",stroke:3,height:36,fontSize:24,font:"Microsoft YaHei",color:"#0050ff",bold:!0,align:"center"}},{type:"Text",props:{y:340,x:230,width:135,text:"登 录 天 数 ：",strokeColor:"#c56123",stroke:2,height:27,fontSize:20,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Text",props:{y:339.5,x:352,width:60,var:"text_login_percent",text:"2 / 7",strokeColor:"#c56123",stroke:2,height:30,fontSize:20,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:869,x:235,width:170,var:"btnSingle",underline:!0,text:"单倍领取",mouseEnabled:!0,height:36,fontSize:30,font:"SimHei",color:"#ffffff",align:"center"}},{type:"Label",props:{y:869,x:214,width:211,var:"btnlinqu",underline:!0,text:"不了，直接领取",mouseEnabled:!0,height:36,fontSize:30,font:"SimHei",color:"#ffffff",align:"center"}},{type:"Image",props:{y:792,x:215,width:209,var:"btnDouble",skin:"res/ui/game/img_fenxiangfuhuox.png",height:72},child:[{type:"Image",props:{y:15,x:27,width:33,skin:"res/ui/common/fenxiang1.png",height:30}},{type:"Text",props:{y:18,x:56,width:137,text:"分享双倍",strokeColor:"#d6956d",stroke:1,height:27,fontSize:26,font:"SimHei",color:"#c56123",bold:!0,align:"center"}}]},{type:"Image",props:{y:792,x:215,width:209,var:"btnlingqu_skin",skin:"res/ui/game/img_fenxiangfuhuox.png",height:72},child:[{type:"Image",props:{y:15,x:27,width:33,skin:"res/ui/common/fenxiang1.png",height:30}},{type:"Text",props:{y:18,x:56,width:137,text:"炫耀分享",strokeColor:"#d6956d",stroke:1,height:27,fontSize:26,font:"SimHei",color:"#c56123",bold:!0,align:"center"}}]},{type:"Image",props:{y:792,x:215,width:209,var:"img_lingqu",skin:"res/ui/login/btn_linquJL.png",height:72}},{type:"Sprite",props:{y:906,x:77,width:486,var:"ad",height:230}}]},i}(Dialog);e.LoginRewardViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.LotteryRewardViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Sprite",props:{y:0,x:0,width:640,var:"bgMask",mouseEnabled:!0,height:1136,alpha:.7}},{type:"Image",props:{y:445,x:318,var:"bg",skin:"res/ui/common/guang.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:284,x:319,var:"img_title",skin:"res/ui/common/getPrize.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:381,x:264,visible:!1,var:"imgSkin",skin:"res/skinUI/bigsuipian.png",scaleY:1.5,scaleX:1.5}},{type:"Image",props:{y:472,x:251,visible:!1,var:"imgChip",skin:"res/ui/skin/suipian.png"}},{type:"Box",props:{y:381,x:195,var:"boxGold"},child:[{type:"Image",props:{y:0,x:17,skin:"res/ui/common/yiduijinbi2.png"}}]},{type:"Label",props:{y:549,x:212,width:215,var:"lbNum",text:"+100",height:65,fontSize:40,color:"#ffffff",align:"center"}},{type:"Label",props:{y:834,x:235,width:170,var:"text_close",underline:!0,text:"不了，谢谢!",name:"close",mouseEnabled:!0,height:36,fontSize:30,color:"#ffffff",align:"center"}},{type:"Box",props:{width:640,var:"box_lucky"},child:[{type:"Image",props:{y:354,x:200,skin:"res/ui/gameover/lihe.png"}},{type:"Image",props:{y:546,x:256,skin:"res/ui/gameover/imagetitle.png"}},{type:"Image",props:{y:716,x:64,width:399,var:"img_luck_video",skin:"res/ui/gameover/img_shuangbei.png",scaleY:.6,scaleX:.6,height:150},child:[{type:"Image",props:{y:47,x:41,skin:"res/ui/gameover/shipin2.png"}},{type:"Label",props:{y:44,x:132,width:205,text:"视频领取",strokeColor:"#068ea0",stroke:4,height:54,fontSize:50,color:"#e0feef",bold:!0}}]},{type:"Image",props:{y:715,x:355,width:399,var:"img_luck_share",skin:"res/ui/activity/btnGet.png",scaleY:.6,scaleX:.6,height:150},child:[{type:"Image",props:{y:42,x:44,skin:"res/ui/common/fenxiang1.png",scaleY:1.7,scaleX:1.7}},{type:"Label",props:{y:42,x:135,width:205,text:"分享领取",strokeColor:"#c2491b",stroke:4,height:54,fontSize:50,color:"#e0feef",bold:!0}}]},{type:"Box",props:{y:0,x:320,width:131,var:"boxClick"},child:[{type:"Image",props:{y:1002,x:3,var:"clickBtn",skin:"res/ui/gameover/clickBtn.png",anchorY:.5,anchorX:.5},compId:30},{type:"Image",props:{y:984,x:39,var:"clickHand",skin:"res/ui/gameover/clickHander.png"}},{type:"Image",props:{y:680,x:-200,skin:"res/ui/gameover/cao.png"}},{type:"Image",props:{y:684,x:-196,width:131,var:"clickProgress",skin:"res/ui/gameover/jytiao.png"}},{type:"Text",props:{y:772,x:-237,width:478,text:"点得越快，奖励越多！",height:50,fontSize:50,color:"#ffffff"}}]}]},{type:"Button",props:{y:703,x:48,var:"btnVedeo",stateNum:1,skin:"res/ui/lottery/btn_3beiViedo.png"}},{type:"Button",props:{y:703,x:340,var:"btnShare",stateNum:1,skin:"res/ui/lottery/btn_3beiShare.png"}},{type:"Image",props:{y:716,x:63,width:399,var:"img_click_video",skin:"res/ui/gameover/img_shuangbei.png",scaleY:.6,scaleX:.6,height:150},child:[{type:"Image",props:{y:47,x:41,skin:"res/ui/gameover/shipin2.png"}},{type:"Label",props:{y:44,x:132,width:205,text:"视频领取",strokeColor:"#068ea0",stroke:4,height:54,fontSize:50,color:"#e0feef",bold:!0}}]},{type:"Image",props:{y:716,x:356,width:399,var:"img_click_share",skin:"res/ui/activity/btnGet.png",scaleY:.6,scaleX:.6,height:150},child:[{type:"Image",props:{y:42,x:44,skin:"res/ui/common/fenxiang1.png",scaleY:1.7,scaleX:1.7}},{type:"Label",props:{y:42,x:135,width:205,text:"分享领取",strokeColor:"#c2491b",stroke:4,height:54,fontSize:50,color:"#e0feef",bold:!0}}]},{type:"Sprite",props:{y:880,x:82,width:475,var:"ad",height:200}}],animations:[{nodes:[{target:30,keyframes:{y:[{value:1002,tweenMethod:"linearNone",tween:!0,target:30,key:"y",index:0}],x:[{value:3,tweenMethod:"linearNone",tween:!0,target:30,key:"x",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleY",index:1},{value:1.25,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleY",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleY",index:3}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:0},{value:1.125,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:1},{value:1.25,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:2},{value:1.125,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:24}],anchorY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:30,key:"anchorY",index:0}],anchorX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:30,key:"anchorX",index:0}]}}],name:"mad_btn",id:1,frameRate:24,action:2}]},i}(Dialog);e.LotteryRewardViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.LotteryViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Sprite",props:{y:0,x:0,width:640,var:"spMask",height:1136,alpha:.7}},{type:"Image",props:{y:730,x:0,var:"btnClose",skin:"res/ui/common/btn_fanhui.png"}},{type:"Image",props:{y:107,x:40,skin:"res/ui/lottery/zhuanpandi.png"}},{type:"Button",props:{y:828,x:344,var:"btnFree",stateNum:1,skin:"res/ui/lottery/btn_friend.png"},child:[{type:"Text",props:{y:23,x:28,text:"免费转一次",strokeColor:"#45cf33",stroke:2,fontSize:38,color:"#ffffff",bold:!0}}]},{type:"Button",props:{y:830,x:344,var:"btnFriend",stateNum:1,skin:"res/ui/lottery/btn_friend.png"},child:[{type:"Label",props:{y:23,x:33,width:183,text:"分享转动",mouseThrough:!0,height:53,fontSize:38,color:"#ffffff",bold:!0,align:"center"}}]},{type:"Button",props:{y:830,x:45,var:"btnVideo",stateNum:1,skin:"res/ui/lottery/btn_viedo.png"},child:[{type:"Image",props:{y:25,x:20,skin:"res/ui/lottery/shipin1.png"}},{type:"Label",props:{y:23,x:70,width:152,text:"视频转动",height:43,fontSize:38,color:"#ffffff",bold:!0,align:"center"}}]},{type:"Box",props:{y:223,x:252,name:"item0"},child:[{type:"Image",props:{y:50,x:72,var:"img0",skin:"res/ui/common/yiduijinbi.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:-24,x:0,width:137,var:"lb0",text:"Gold X 50",strokeColor:"#676767",stroke:2,height:36,fontSize:20,color:"#d53f00",align:"center"}}]},{type:"Box",props:{y:355,x:465,rotation:60,name:"item1",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:108,x:72,var:"img1",skin:"res/ui/common/yiduijinbi.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:16,x:4,width:137,var:"lb1",text:"Gold X 50",strokeColor:"#676767",stroke:2,height:36,fontSize:20,color:"#d53f00",align:"center"}}]},{type:"Box",props:{y:510,x:450,scaleY:.9,scaleX:.9,rotation:120,name:"item2",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:93,x:71,var:"img2",skin:"res/ui/common/yiduijinbi.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:1,x:0,width:137,var:"lb2",text:"Gold X 50",strokeColor:"#676767",stroke:2,height:36,fontSize:20,color:"#d53f00",align:"center"}}]},{type:"Box",props:{y:607,x:319,rotation:180,name:"item3",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:100,x:72,var:"img3",skin:"res/ui/common/yiduijinbi.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:22,x:0,width:137,var:"lb3",text:"Gold X 50",strokeColor:"#676767",stroke:2,height:36,fontSize:20,color:"#d53f00",align:"center"}}]},{type:"Box",props:{y:521,x:172,rotation:240,name:"item4",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:108,x:72,var:"img4",skin:"res/ui/common/yiduijinbi.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:31,x:0,width:137,var:"lb4",text:"Gold X 50",strokeColor:"#676767",stroke:2,height:36,fontSize:20,color:"#d53f00",align:"center"}}]},{type:"Box",props:{y:338,x:161,width:195,rotation:300,name:"item5",height:185,anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:134,x:97,var:"img5",skin:"res/ui/common/yiduijinbi.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:41,x:29,width:137,var:"lb5",text:"Gold X 50",strokeColor:"#676767",stroke:2,height:36,fontSize:20,color:"#d53f00",align:"center"}}]},{type:"Image",props:{y:427,x:322,width:117,var:"imgArrow",skin:"res/ui/lottery/jiantou.png",rotation:0,pivotY:140,pivotX:59,height:200}},{type:"Label",props:{y:748,x:123,width:401,visible:!1,var:"lbHint",underline:!0,text:"今日次数已用完，请明日再来",height:36,fontSize:30,color:"#ffffff"}},{type:"Sprite",props:{y:934,x:126,width:387,var:"ad",height:48}}]},i}(Dialog);e.LotteryViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.MailboxViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Image",props:{y:154,x:32,width:575,skin:"res/ui/common/diban1.png",sizeGrid:"50,50,51,50",height:738}},{type:"Image",props:{y:125,x:44,width:551,skin:"res/ui/common/title.png"}},{type:"Image",props:{y:133,x:270,skin:"res/ui/mail/img_title.png",name:"title"}},{type:"Image",props:{y:198,x:53,width:534,skin:"res/ui/common/diban.png",height:645,sizeGrid:"33,36,51,29"}},{type:"Image",props:{y:146,x:548,skin:"res/ui/common/btnClose.png",name:"close",mouseEnabled:!0}},{type:"Label",props:{y:845,x:245,width:150,text:"邮 件 只 保 留 7 天",height:26,fontSize:18,font:"Microsoft YaHei",color:"#0084aa"}},{type:"Panel",props:{y:210,x:65,width:510,var:"panel_mail",height:617}},{type:"Label",props:{y:498,x:258,width:123,var:"noHaveEmailLab",text:"没有邮件~",height:29,fontSize:26,color:"#0084aa"}},{type:"Sprite",props:{y:914,x:126,width:387,var:"ad",height:48}}]},i}(Dialog);e.MailboxViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.MailItemUI.uiView)},i.uiView={type:"View",props:{width:510,height:350},child:[{type:"Image",props:{y:0,x:0,width:510,var:"img_bg",skin:"res/ui/mail/diban.png",sizeGrid:"27,34,34,28",height:340}},{type:"Image",props:{y:18,x:339,var:"img_linqu",skin:"res/ui/mail/btn-linqu.png"}},{type:"Image",props:{y:9,x:20,skin:"res/ui/mail/img_gift.png",scaleY:1,scaleX:1}},{type:"Box",props:{y:100,x:0,visible:!1,var:"box_attach",height:229},child:[{type:"Image",props:{y:-12,x:2,width:506,skin:"res/ui/mail/diban2.png",height:195}},{type:"Label",props:{y:0,x:16,wordWrap:!0,width:477,var:"text_content",text:"邮件消息:正在加载",leading:5,height:73,fontSize:18,font:"Microsoft YaHei",color:"#000000"}},{type:"Image",props:{y:189,x:235,var:"img_recover",skin:"res/ui/mail/btn-shouqi.png"}},{type:"HBox",props:{y:129,x:254,width:200,var:"box_item",space:10,height:89,anchorY:.5,anchorX:.5}}]},{type:"Label",props:{y:10,x:91,wordWrap:!0,width:250,var:"text_title",text:"更新奖励",strokeColor:"#795623",stroke:2,height:30,fontSize:24,font:"Microsoft YaHei",color:"#ff47ec",bold:!0}},{type:"Label",props:{y:46,x:91,wordWrap:!0,width:200,var:"text_time",text:"2014.9.18",height:23,fontSize:18,font:"Microsoft YaHei",color:"#142932",bold:!0}},{type:"Image",props:{y:19,x:339,width:152,var:"btnYiLingQu",skin:"res/ui/skin/img_yilingqu.png",height:60}}]},i}(View);e.MailItemUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.ModeSelectViewUI.uiView)},i.uiView={type:"View",props:{y:0,x:0,width:640,height:338},child:[{type:"Image",props:{y:0,x:0,width:640,skin:"res/ui/home/img_youxiheidi.png",name:"BG",height:338}},{type:"Image",props:{y:10,x:235,skin:"res/ui/home/youximoshi.png",name:"title"}},{type:"Image",props:{y:15,x:594,var:"btn_close",skin:"res/ui/home/img_guanbi.png"}},{type:"Image",props:{y:72,x:100,var:"btn_classic",skin:"res/ui/home/jingdian2.png"},child:[{type:"Text",props:{y:170,x:16,text:"2分钟内挑战高分",fontSize:20,font:"Microsoft YaHei",color:"#ffffff"}}]},{type:"Image",props:{y:72,x:365.3,width:184,var:"btn_survive",skin:"res/ui/home/shengcun2.png"},child:[{type:"Text",props:{y:170,x:22,text:"好友比拼来吃鸡",fontSize:20,font:"Microsoft YaHei",color:"#ffffff"}}]}]},i}(View);e.ModeSelectViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.NovicePrivilegeViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Image",props:{y:103,x:35,width:570,skin:"res/image/tybj.png",sizeGrid:"252,217,118,204",height:815}},{type:"Image",props:{y:50,x:172,skin:"res/ui/novicePrivilege/xsthz.png"}},{type:"Image",props:{y:148,x:69,skin:"res/ui/novicePrivilege/dtb.png"}},{type:"Image",props:{y:696,x:123,skin:"res/ui/novicePrivilege/td.png",sizeGrid:"0,17,0,19"}},{type:"Image",props:{y:705,x:132,var:"imgProgress",skin:"res/ui/novicePrivilege/t.png",sizeGrid:"0,20,0,17"},child:[{type:"Sprite",props:{y:-8,width:375,var:"progressMask",renderType:"mask",height:28}}]},{type:"List",props:{y:313,x:70,width:500,var:"list",spaceY:10,spaceX:40,repeatY:2,repeatX:2,height:359},child:[{type:"Box",props:{y:0,x:0,width:218,renderType:"render",height:187},child:[{type:"Image",props:{skin:"res/ui/novicePrivilege/kk.png"}},{type:"Image",props:{y:16,x:59,visible:!1,skin:"res/skinUI/Ball_BG_Using.png",name:"imgSelect"}},{type:"Image",props:{y:76,x:119,width:120,skin:"res/skinUI/Ball_01.png",name:"imgSkin",height:120,anchorY:.5,anchorX:.5}},{type:"Text",props:{y:121,x:30,visible:!1,text:"已拥有",name:"lbYiYongYou",fontSize:24,color:"#75ffc6",bold:!0}},{type:"Box",props:{y:23,x:24,visible:!1,name:"boxSuo"},child:[{type:"Image",props:{y:-13,x:-14,skin:"res/ui/novicePrivilege/suo.png"}}]}]}]},{type:"Image",props:{y:204,x:396,width:27,skin:"res/ui/common/jinbi.png",height:29}},{type:"Image",props:{y:98,x:566,skin:"res/ui/common/btnClose.png",name:"close",mouseEnabled:!0}},{type:"Box",props:{y:751,x:45,width:550,var:"box_tmpC",height:130},child:[{type:"Image",props:{y:20,x:0,var:"img_video",skin:"res/ui/gameover/img_shuangbei.png",scaleY:.6,scaleX:.6},child:[{type:"Image",props:{y:47,x:45,skin:"res/ui/gameover/shipin2.png"}},{type:"Text",props:{y:51,x:140,width:168,text:"视频获得",strokeColor:"#068ea0",stroke:4,height:41,fontSize:42,font:"SimHei",color:"#e0feef",bold:!0}}]},{type:"Image",props:{y:20,x:310,var:"img_share",skin:"res/ui/activity/btnGet.png",scaleY:.6,scaleX:.6},child:[{type:"Image",props:{y:41,x:45,skin:"res/ui/common/fenxiang1.png",scaleY:1.7,scaleX:1.7}},{type:"Text",props:{y:50,x:139,width:168,text:"分享获得",strokeColor:"#c2491b",stroke:4,height:43,fontSize:42,font:"SimHei",color:"#e0feef",bold:!0}},{type:"Text",props:{y:-33,x:17,text:"分享3次可增加1次视频进度",fontSize:30,color:"#ffffff"}}]}]},{type:"Image",props:{y:743,x:120,var:"btnGet",skin:"res/ui/home/img_haoyouzhuli.png"},child:[{type:"Text",props:{y:24,x:140,width:119,text:"挑选一款皮肤",height:26,fontSize:20,font:"Microsoft YaHei",color:"#b73a00",bold:!0}},{type:"Text",props:{y:51,x:30,width:168,text:"领取奖励",strokeColor:"#ce5e07",stroke:4,height:54,fontSize:42,font:"Microsoft YaHei",color:"#e0feef",bold:!0}}]},{type:"Label",props:{y:167,x:164,width:184,text:"游戏中任意位置观看",height:32,fontSize:24,color:"#ffffff"}},{type:"Text",props:{y:166,x:342,text:"3次",strokeColor:"#005122",stroke:4,fontSize:24,color:"#00ff00"}},{type:"Text",props:{y:166,x:440,text:"in game,",fontSize:24,color:"#ffffff"}},{type:"Text",props:{y:204,x:165,text:"将获得价值                   皮肤一个",fontSize:24,color:"#ffffff"}},{type:"Text",props:{y:203,x:422,width:74,text:"16888",strokeColor:"#795623",stroke:4,height:26,fontSize:26,color:"#fff950"}},{type:"Text",props:{y:279,x:256,text:"以下皮肤任选其一",strokeColor:"#1d1b89",stroke:4,fontSize:16,color:"#ffffff"}},{type:"Text",props:{y:701,x:299,width:42,var:"lbProgress",text:"0/6",strokeColor:"#000000",stroke:4,height:20,fontSize:18,color:"#ffffff",align:"center"}},{type:"Sprite",props:{y:931,x:133,width:387,var:"ad",height:200}}]},i}(Dialog);e.NovicePrivilegeViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.SettingViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Box",props:{width:640,var:"sp",height:1136}},{type:"Image",props:{y:630,x:158,width:323,skin:"res/ui/home/shezhidi.png",sizeGrid:"38,57,44,56",mouseThrough:!1,mouseEnabled:!1,height:206}},{type:"Image",props:{y:642,x:279,var:"audio_on",skin:"res/ui/home/img_yinxiao.png"}},{type:"Image",props:{y:642,x:279,var:"audio_off",skin:"res/ui/home/img_yinxiaogb.png"}},{type:"Image",props:{y:642,x:178,var:"music_on",skin:"res/ui/home/img_yinyue.png"}},{type:"Image",props:{y:642,x:178,var:"music_off",skin:"res/ui/home/img_yinyuegb.png"}},{type:"Image",props:{y:642,x:380,var:"shake_on",skin:"res/ui/home/img_zhendong.png"}},{type:"Image",props:{y:642,x:380,var:"shake_off",skin:"res/ui/home/img_zhendonggb.png"}},{type:"Image",props:{y:727,x:227,var:"spClub"}},{type:"Image",props:{y:727,x:331,var:"spTousu"}}]},i}(Dialog);e.SettingViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.ShiWanRenderUI.uiView)},i.uiView={type:"View",props:{width:218,height:252},child:[{type:"Image",props:{y:0,x:0,var:"bg",skin:"res/ui/skin/qualityBg3.png"}},{type:"Box",props:{y:6,x:-4,var:"box"},child:[{type:"Box",props:{y:0,x:9,width:208,var:"img_shiwan",height:240},child:[{type:"Image",props:{y:199,x:56,skin:"res/ui/common/btnShiWan.png"}}]},{type:"Box",props:{y:0,x:8,width:208,var:"share_shiwan",height:240},child:[{type:"Image",props:{y:199,x:58,skin:"res/ui/skin/btnApply.png"},child:[{type:"Image",props:{y:5,x:12,width:28,skin:"res/ui/home/img_share.png",height:23}}]}]},{type:"Image",props:{y:199,x:63,visible:!1,var:"btnApply",skin:"res/ui/skin/btnApply.png"},child:[{type:"Label",props:{y:4,x:15,width:73,text:"使用",height:24,fontSize:18,font:"Microsoft YaHei",color:"#c56123",bold:!0,align:"center"}}]},{type:"Image",props:{y:121,x:113,width:120,var:"imgSkin",mouseThrough:!0,height:120,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:-3,x:7,width:211,var:"lbDesc",height:27,fontSize:20,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:23,x:8,width:211,var:"lbStatus",height:27,fontSize:18,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:206,x:108,width:36,text:"试 玩",height:24,fontSize:18,font:"Microsoft YaHei",color:"#c56123",bold:!0,align:"center"}},{type:"Box",props:{y:109,x:67,visible:!1,var:"boxSelect",mouseThrough:!0},child:[{type:"Image",props:{y:8,x:47,width:49,skin:"res/skinUI/gougou.png",height:41,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:81.5,skin:"res/ui/skin/shiyongzhong.png"}}]},{type:"Image",props:{y:39,x:9,visible:!1,var:"img_wangzhe",skin:"res/ui/skin/wzpf.png"}},{type:"Image",props:{y:38,x:9,visible:!1,var:"img_remen",skin:"res/ui/skin/rmpf.png"}}]},{type:"Text",props:{y:107,x:65,visible:!1,var:"lbNull",text:"敬请期待",fontSize:22,font:"Microsoft YaHei",color:"#000000"}}]},i}(View);e.ShiWanRenderUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.ShiWanViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Image",props:{y:105,x:36,width:567,skin:"res/image/tybj.png",sizeGrid:"252,217,118,204",height:789}},{type:"Image",props:{y:134,x:107,skin:"res/ui/activity/shiwanTxt.png"}},{type:"Image",props:{y:773,x:176,width:288,var:"btnStart",skin:"res/ui/home/img_queding.png",height:98},child:[{type:"Label",props:{y:31,x:20,text:"不了，直接开始",strokeColor:"#30a625",stroke:3,fontSize:30,color:"#ffffff",bold:!0}}]},{type:"Image",props:{y:184,x:67,width:505,skin:"res/ui/home/diban5.png",sizeGrid:"20,20,20,20",height:540}},{type:"List",props:{y:195,x:80,width:480,var:"list",spaceY:10,spaceX:40,repeatY:4,repeatX:2,height:516}},{type:"Sprite",props:{y:884,x:98,width:452,var:"ad",height:32}},{type:"Box",props:{y:739,x:180,width:180,var:"checkBox",height:26},child:[{type:"Image",props:{y:0,x:0,var:"kuang",skin:"res/ui/skin/gouxuan.png"},child:[{type:"Label",props:{y:4,x:36,text:"今日之内不再显示",fontSize:18,color:"#c7a9ff"}}]},{type:"Image",props:{y:-2,x:1,visible:!1,var:"gou",skin:"res/ui/skin/gou.png"}}]},{type:"Image",props:{y:51,x:172,skin:"res/ui/activity/title-shiwan.png"}},{type:"Image",props:{y:737,x:466,var:"img_exchange",skin:"res/ui/novicePrivilege/shuaxin.png"}}]},i}(Dialog);e.ShiWanViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.SkinItemUI.uiView)},i.uiView={type:"View",props:{width:218,height:272},child:[{type:"Image",props:{y:0,x:0,var:"bg",skin:"res/ui/skin/qualityBg1.png"}},{type:"Box",props:{y:116.5,x:60,var:"boxSelect"},child:[{type:"Image",props:{y:10,x:49,skin:"res/skinUI/Ball_BG_Using.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:86,x:-60,width:218,var:"skinNameLab",text:"使用中",strokeColor:"#047501",stroke:4,height:35,fontSize:24,font:"Microsoft YaHei",color:"#3AEB01",bold:!0,align:"center"}}]},{type:"Image",props:{y:59,x:159,visible:!1,var:"img_shiwan",skin:"res/ui/skin/shiwan.png"}},{type:"Image",props:{y:205,x:57,var:"btnApply",skin:"res/ui/skin/btnApply.png"},child:[{type:"Label",props:{y:4,x:15,width:73,text:"使 用",height:24,fontSize:18,font:"Microsoft YaHei",color:"#c56123",bold:!0,align:"center"}}]},{type:"Image",props:{y:127,x:109,width:120,var:"imgSkin",skin:"res/skinUI/Ball_01.png",height:120,anchorY:.5,anchorX:.5}},{type:"Sprite",props:{y:0,x:0,width:218,var:"sp",height:252}},{type:"Label",props:{y:4,x:5,width:211,var:"lbDesc",text:"连续三天登录游戏",height:27,fontSize:16,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:29,x:3,width:211,var:"lbStatus",text:"已拥有",height:27,fontSize:14,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:203,x:0,width:218,visible:!1,var:"lb_skinName",text:"球球",strokeColor:"#047501",stroke:4,height:35,fontSize:24,font:"Microsoft YaHei",color:"#3AEB01",bold:!0,align:"center"}},{type:"Box",props:{y:194,x:47,var:"boxGold"},child:[{type:"Image",props:{y:11,x:8,skin:"res/ui/skin/goldBg.png"}},{type:"Label",props:{y:19,x:42,width:75,var:"lbCostGold",text:"999999",height:24,fontSize:18,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Image",props:{y:7,x:2,skin:"res/ui/common/jinbi.png"}}]},{type:"Box",props:{y:194,x:40,var:"boxChip"},child:[{type:"Image",props:{y:11,x:15,skin:"res/ui/skin/goldBg.png"}},{type:"Label",props:{y:20,x:37,width:91,var:"lbChip",text:"0/40",height:27,fontSize:18,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Image",props:{y:9,x:8,skin:"res/ui/skin/suipian.png"}}]},{type:"Box",props:{y:194,x:39,var:"boxVideo"},child:[{type:"Image",props:{y:11,x:15,skin:"res/ui/skin/goldBg.png"}},{type:"Label",props:{y:19,x:40,width:91,text:"看视频",height:27,fontSize:18,font:"Microsoft YaHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Image",props:{y:22,x:30,width:25,skin:"res/ui/gameover/shipin2.png",height:17}}]}]},i}(View);e.SkinItemUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.SkinSelectViewUI.uiView)},i.uiView={type:"View",props:{y:0,x:0,width:640,height:1136},child:[{type:"Sprite",props:{y:0,x:0,width:640,var:"bg",mouseThrough:!1,mouseEnabled:!0,height:1136,alpha:.6}},{type:"Image",props:{y:143,x:44,width:552,skin:"res/ui/common/diban1.png",sizeGrid:"50,50,50,50",height:763}},{type:"Image",props:{y:255,x:63,width:513,skin:"res/ui/common/diban.png",height:628,sizeGrid:"33,36,51,29"}},{type:"Image",props:{y:130,x:56,width:528,skin:"res/ui/common/title.png",height:71}},{type:"Image",props:{y:151,x:538,var:"btnClose",skin:"res/ui/common/btnClose.png",mouseEnabled:!0}},{type:"List",props:{y:273,x:92,width:456,var:"list",spaceY:0,spaceX:20,repeatY:4,repeatX:2,height:607}},{type:"Sprite",props:{y:920,x:111,width:387,var:"ad",height:170}},{type:"Image",props:{y:137,x:234,skin:"res/ui/skin/title.png"}},{type:"Tab",props:{y:204,x:71,var:"tab",selectedIndex:0},child:[{type:"Button",props:{stateNum:2,skin:"res/ui/skin/btn_skin.png",name:"item0"}},{type:"Button",props:{x:126,stateNum:2,skin:"res/ui/skin/btn_skin.png",name:"item1"}},{type:"Button",props:{x:253,stateNum:2,skin:"res/ui/skin/btn_skin.png",name:"item2"}},{type:"Button",props:{x:379,stateNum:2,skin:"res/ui/skin/btn_skin.png",name:"item3"}}]},{type:"Label",props:{y:217,x:118,width:47,text:"全 部",strokeColor:"#e66916",stroke:2,name:"全 部",height:30,fontSize:20,font:"Microsoft YaHei",color:"#ffffff",bold:!0}},{type:"Label",props:{y:217,x:220,width:49,text:"普 通",strokeColor:"#373f73",stroke:2,name:"普 通",height:30,fontSize:20,font:"Microsoft YaHei",color:"#a9ff7f",bold:!0}},{type:"Label",props:{y:217,x:362,width:48,text:"稀 有",strokeColor:"#373f73",stroke:2,name:"稀 有",height:30,fontSize:20,font:"Microsoft YaHei",color:"#8bf5ff",bold:!0}},{type:"Label",props:{y:217,x:455,width:49,text:"史 诗",strokeColor:"#373f73",stroke:2,name:"史 诗",height:30,fontSize:20,font:"Microsoft YaHei",color:"#fd70ed",bold:!0}}]},i}(View);e.SkinSelectViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.Home.TeamPlayerItemUI.uiView)},i.uiView={type:"View",props:{width:95,height:120},child:[{type:"Image",props:{y:6,x:17,skin:"res/ui/home/huitouxiang.png",name:"BG"}},{type:"Image",props:{y:16,x:29,var:"img_jiahao",skin:"res/ui/home/yaoqingjia.png"}},{type:"Box",props:{y:-6,x:2,var:"box_player_data"},child:[{type:"Image",props:{y:78,skin:"res/ui/home/mingzidi_friend.png",name:"名字背景"}},{type:"Image",props:{y:16,x:19,width:53,var:"img_avatar",height:53}},{type:"Image",props:{y:7,x:13,var:"img_duizhang",skin:"res/ui/TeamPlay/duizhang1.png",name:"duizhang"}},{type:"Image",props:{y:60,x:43,var:"img_state",skin:"res/ui/TeamPlay/weizhunbei.png"}},{type:"Image",props:{y:11,x:75,var:"btn_close",skin:"res/ui/TeamPlay/zudui-guanbi.png",scaleY:1,scaleX:1,name:"btn_close",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:104,x:1,var:"img_rankIcon",skin:"res/ui/common/duanwei_1.png",scaleY:.15,scaleX:.15,name:"rankIcon"}},{type:"Label",props:{y:108,x:26,var:"lb_rank",text:"钻石一阶",name:"rank",fontSize:14,font:"SimSun",color:"#ffffff",align:"center"}},{type:"Label",props:{y:83,x:4,width:84,var:"lb_nickName",text:"幻影皮卡丘君",name:"nickName",height:14,fontSize:14,font:"SimSun",color:"#ffffff",align:"center"}}]}]},i}(View);e.TeamPlayerItemUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.TeamPlayViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1136},child:[{type:"Image",props:{y:0,x:0,var:"img_background",skin:"loading/img_bj.png",sizeGrid:"0,1,1000,1",name:"BG"}},{type:"Image",props:{y:116,x:29,width:582,skin:"res/ui/common/diban1.png",sizeGrid:"50,50,50,50",name:"组队BG",height:540}},{type:"Image",props:{y:168,x:47,width:545,skin:"res/ui/common/diban.png",sizeGrid:"33,36,51,29",name:"中间玩家地板BG",height:348}},{type:"Image",props:{y:95,x:41,width:558,skin:"res/ui/common/title.png",name:"组队BG",height:71}},{type:"Button",props:{y:683,x:15,var:"btn_back",stateNum:1,skin:"res/ui/common/btn_fanhui.png"}},{type:"Image",props:{y:568,x:116,var:"btn_invite",skin:"res/ui/game/img_shipinfuhuox.png",name:"标题"}},{type:"Image",props:{y:837,x:0,width:641,skin:"res/ui/game/daojishidi.png",name:"聊天BG",height:298}},{type:"Image",props:{y:568,x:350,var:"btn_start_game_or_ready",skin:"res/ui/game/img_fenxiangfuhuox.png",name:"标题"}},{type:"Sprite",props:{y:844,x:0,var:"panel_chat_node"}},{type:"Image",props:{y:102,x:234,skin:"res/ui/TeamPlay/title-7.png",name:"标题"}},{type:"Image",props:{y:1079,x:0,width:640,skin:"res/ui/TeamPlay/liaotian1.png",sizeGrid:"4,6,5,4",name:"聊天输入BG",height:59}},{type:"Image",props:{y:1085,x:498,var:"btn_quick_reply",skin:"res/ui/TeamPlay/kuaijie.png",name:"快捷键"}},{type:"Image",props:{y:1078,x:470,width:326,var:"img_reply_BG",skin:"res/ui/TeamPlay/liaotian2.png",sizeGrid:"11,84,24,15",scaleY:1,name:"快捷语",height:200,anchorY:1,anchorX:.5},child:[{type:"Label",props:{y:10,x:12,width:305,var:"lb_quick100",text:"你好，很高兴和你们一起玩~",name:"lb_quick100",hitTestPrior:!0,height:20,fontSize:16,color:"#ffffff"}},{type:"Label",props:{y:40,x:12,width:305,var:"lb_quick101",text:"快点开啊，我都等到海枯石烂了~",name:"lb_quick101",height:20,fontSize:16,color:"#ffffff"}},{type:"Label",props:{y:70,x:12,width:305,var:"lb_quick102",text:"再等等，马上就开，别着急~",name:"lb_quick102",height:20,fontSize:16,color:"#ffffff"}},{type:"Label",props:{y:100,x:12,width:305,var:"lb_quick103",text:"准备了，准备了，磨磨唧唧干啥呢= =",name:"lb_quick103",height:20,fontSize:16,color:"#ffffff"}},{type:"Label",props:{y:130,x:12,width:305,var:"lb_quick104",text:"敢不敢吞了这座城再走？",name:"lb_quick104",height:20,fontSize:16,color:"#ffffff"}},{type:"Label",props:{y:160,x:12,width:305,var:"lb_quick105",text:"让你们见识一下我的厉害！",name:"lb_quick105",height:20,fontSize:16,color:"#ffffff"}}]},{type:"Image",props:{y:786,x:36,skin:"res/ui/rank/btnRank1.png",name:"队伍BG"}},{type:"Text",props:{y:795,x:70,text:"队伍",strokeColor:"#f67046",stroke:2,name:"队伍",fontSize:25,font:"Microsoft YaHei",color:"#ffffff",bold:!0}},{type:"Label",props:{y:182,x:238,width:163,var:"text_team_num",text:"当前人数10/10",name:"人数",height:25,fontSize:24,font:"SimSun",color:"#ffffff",align:"center"}},{type:"Label",props:{y:529,x:160,text:"任意人数都能直接开始匹配其他玩家",name:"任",fontSize:20,font:"SimSun",color:"#ffffff"}},{type:"Label",props:{y:581,x:388,width:98,var:"btn_start_game_Lab",text:"直接开始",height:28,fontSize:24,font:"SimSun",color:"#c56123",bold:!0,align:"center"}},{type:"Label",props:{y:581,x:154,width:97,var:"btn_invite_Lab",text:"邀请好友",height:28,fontSize:24,font:"SimSun",color:"#ffffff",bold:!0}},{type:"List",props:{y:220,x:56,width:528,var:"list_team",spaceY:20,spaceX:12,repeatY:2,repeatX:5,height:272}}]},i}(View);e.TeamPlayViewUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Home.UserUpgradeUI.uiView)},i.uiView={type:"View",props:{width:640,height:560},child:[{type:"Image",props:{y:-166,x:91,skin:"res/ui/common/jinjiebg.png",sizeGrid:"1,0,1,0",name:"BG"}},{type:"Image",props:{y:50,x:321,var:"img_grade",skin:"res/ui/common/duanwei_1.png",scaleY:1,scaleX:1,anchorY:.5,anchorX:.5},compId:7},{type:"Box",props:{y:202,x:262,var:"box_award"},child:[{type:"Image",props:{y:39,x:16,skin:"res/ui/common/daoju.png"}},{type:"Image",props:{y:53,x:30,width:60,skin:"res/ui/common/jinbi.png",height:60}},{type:"Label",props:{y:97,x:18,width:78,var:"text_gold",text:"1000",strokeColor:"#ffffff",stroke:2,height:25,fontSize:20,font:"Microsoft YaHei",color:"#3ea72d",bold:!0,align:"right"}},{type:"Text",props:{y:3,x:9,width:97,text:"获得奖励",strokeColor:"#ffffff",stroke:2,height:47,fontSize:24,font:"Microsoft YaHei",color:"#eb1fc2",bold:!0}}]},{type:"Text",props:{y:122,x:262,width:115,var:"text_grade",text:"青铜2阶",height:33,fontSize:24,font:"Microsoft YaHei",color:"#783e00",bold:!0,align:"center"}},{type:"Label",props:{y:205,x:213,width:213,visible:!1,var:"text_already_grade",text:"已获得该阶奖励",strokeColor:"#000000",stroke:3,height:34,fontSize:24,font:"Microsoft YaHei",color:"#ffea00",bold:!0,align:"center"}},{type:"Image",props:{y:-190,x:160,skin:"res/ui/home/gongxijinjie.png"}},{type:"Image",props:{y:347,x:194,var:"btn_confirm",skin:"res/ui/home/img_queding.png"},child:[{type:"Label",props:{y:25,x:32,width:186,text:"确 定",strokeColor:"#30a625",stroke:4,height:46,fontSize:30,font:"Microsoft YaHei",color:"#fff9ff",bold:!0,align:"center"}}]}],animations:[{nodes:[{target:5,keyframes:{y:[{value:192,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:24,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:10},{value:-25,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:13},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:14}],x:[{value:256,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:0},{value:32,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"x",index:10},{value:-32,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:13},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:14}],scaleY:[{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0},{value:.9,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"scaleY",index:10},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:14}],scaleX:[{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0},{value:.9,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"scaleX",index:10},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:14}]}}],name:"ani1",id:1,frameRate:24,action:1},{nodes:[{target:7,keyframes:{x:[{value:319,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:0},{value:1.1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:3},{value:.9,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"scaleY",index:30}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:3},{value:.8,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"scaleX",index:30}]}}],name:"ani2",id:2,frameRate:24,action:2}]},i}(View);e.UserUpgradeUI=i})((e=t.ui||(t.ui={})).Home||(e.Home={}))}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.HowToPlayIconUI.uiView)},i.uiView={type:"View",props:{width:70,height:87},child:[{type:"Image",props:{var:"img_icon",skin:"res/ui/game/howtoplay.png"}}]},i}(View),e.HowToPlayIconUI=i}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.HowToPlayViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Image",props:{y:78,x:36,width:568,skin:"res/ui/common/diban1.png",sizeGrid:"52,50,50,50",height:757}},{type:"Image",props:{y:96,x:53,var:"img_bangzhu",skin:"res/image/bangzhu.png"}},{type:"Image",props:{y:105,x:538,skin:"res/ui/common/btnClose.png",name:"close",mouseEnabled:!0}},{type:"Sprite",props:{y:865,x:126,width:387,var:"ad",height:170}}]},i}(Dialog),e.HowToPlayViewUI=i}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.InviteViewUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1136},child:[{type:"Image",props:{y:100,x:35,width:570,skin:"res/image/tybj.png",sizeGrid:"252,226,118,26",height:792}},{type:"Image",props:{y:114,x:101,skin:"res/ui/invite/title.png"}},{type:"Image",props:{y:258,x:58,width:524,skin:"res/ui/home/diban5.png",sizeGrid:"20,20,20,20",height:462}},{type:"Label",props:{y:208,x:131,width:378,var:"title_lab",text:"每次邀请好友首次进入游戏可领取100金币",height:23,fontSize:20,font:"Microsoft YaHei",color:"#683314",bold:!0,align:"center"}},{type:"Label",props:{y:611,x:181,width:277,var:"lbHint",text:"快去邀请好友获得奖励吧！",strokeColor:"#ffffff",stroke:3,height:35,fontSize:24,font:"Microsoft YaHei",color:"#eb1fc2",bold:!0}},{type:"Image",props:{y:727,x:120,var:"btn_yaoqing",skin:"res/ui/home/img_haoyouzhuli.png"},child:[{type:"Label",props:{y:46,x:98,width:203,text:"邀请好友",strokeColor:"#ce5e07",stroke:4,mouseThrough:!0,height:72,fontSize:50,font:"Microsoft YaHei",color:"#e0feef",bold:!0,align:"center"}}]},{type:"List",props:{y:258,x:58,width:524,var:"list",repeatX:1,height:460}},{type:"Image",props:{y:117,x:550,skin:"res/ui/common/btnClose.png",name:"close",mouseEnabled:!0}},{type:"Sprite",props:{y:906,x:143,width:387,var:"ad",height:200}}]},i}(Dialog),e.InviteViewUI=i}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.InviteViewListRenderUI.uiView)},i.uiView={type:"View",props:{width:524,height:105},child:[{type:"Image",props:{y:5,x:7,width:510,skin:"res/ui/gameover/dizi1.png",sizeGrid:"10,10,10,10",height:95}},{type:"Image",props:{y:19,x:26,width:66,var:"img_Avatar",skin:"res/ui/home/huitouxiang.png",height:66}},{type:"Label",props:{y:39,x:114,width:120,var:"lbName",text:"吃瓜要六个字",height:27,fontSize:20,font:"Microsoft YaHei",color:"#cf3f00",align:"center"}},{type:"Label",props:{y:39,x:238,width:60,text:"赠送您",height:27,fontSize:20,font:"Microsoft YaHei",color:"#6a81b3"}},{type:"Image",props:{y:17,x:318,width:70,skin:"res/ui/common/daoju.png",height:70}},{type:"Image",props:{y:34,x:398,var:"ReceiveBtn",skin:"res/ui/skin/btnApply.png"},child:[{type:"Label",props:{y:5,x:31,width:41,text:"领 取",height:25,fontSize:18,font:"Microsoft YaHei",color:"#c56123",bold:!0}}]},{type:"Image",props:{y:21,x:321,width:65,skin:"res/ui/common/yiduijinbi.png",height:57}},{type:"Label",props:{y:61,x:336,width:46,var:"lbGold",text:"1000",strokeColor:"#ffffff",stroke:2,height:19,fontSize:18,font:"Microsoft YaHei",color:"#3ea72d",bold:!0,align:"right"}},{type:"Image",props:{y:34,x:398,var:"yilingqu",skin:"res/ui/skin/img_yilingqu.png"}}]},i}(View),e.InviteViewListRenderUI=i}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.LoadingViewUI.uiView)},i.uiView={type:"View",props:{y:0,x:0,width:640,height:1136},child:[{type:"Image",props:{y:0,x:0,var:"img_background",skin:"loading/img_bj.png",sizeGrid:"0,1,1000,1"}},{type:"Image",props:{y:300,x:59,width:522,skin:"loading/logo.png",name:"LOGO",height:162}},{type:"ProgressBar",props:{y:756,x:70,width:500,var:"bar_loading",value:.9310344827586207,skin:"loading/jiazaitiao.png",sizeGrid:"15,22,18,19"}},{type:"Label",props:{y:761,x:0,width:640,var:"text_jingdu",text:"90%",strokeColor:"0cb196",stroke:2,height:30,fontSize:24,font:"Arial",color:"#ffffff",align:"center"}},{type:"Box",props:{y:651,x:211},child:[{type:"Text",props:{y:0,x:-20,width:217,valign:"middle",text:"正在努力加载",strokeColor:"#000000",stroke:5,name:"提示语",height:100,fontSize:36,font:"Microsoft YaHei",color:"#ffffff",align:"left"},compId:6},{type:"Text",props:{y:5,x:200,width:30,valign:"middle",text:".",strokeColor:"#000000",stroke:5,name:"。。。",height:100,fontSize:30,font:"Microsoft YaHei",color:"#ffffff",align:"left"},compId:10}]}],animations:[{nodes:[{target:6,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0}],text:[{value:"正在装扮城市",tweenMethod:"linearNone",tween:!1,target:6,key:"text",index:0},{value:"正在努力加载",tweenMethod:"linearNone",tween:!1,target:6,key:"text",index:40},{value:"正在打扫场景",tweenMethod:"linearNone",tween:!1,target:6,key:"text",index:80},{value:"正在装扮城市",tweenMethod:"linearNone",tween:!1,target:6,key:"text",index:120}]}}],name:"ani1",id:1,frameRate:24,action:2}]},i}(View),e.LoadingViewUI=i}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.NoticeViewUI.uiView)},i.uiView={type:"View",props:{width:420,height:100},child:[{type:"Image",props:{y:50,x:210,width:420,skin:"res/ui/common/baoxiangdi.png",height:100,anchorY:.5,anchorX:.5},compId:2,child:[{type:"Label",props:{y:0,x:10,wordWrap:!0,width:400,var:"text_content",valign:"middle",text:"阿萨德法师法撒旦法阿士大夫是否大是大非",leading:4,height:100,fontSize:22,font:"Microsoft YaHei",color:"#ffffff",align:"center"}}]}],animations:[{nodes:[{target:2,keyframes:{x:[{value:210,tweenMethod:"linearNone",tween:!0,target:2,key:"x",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"alpha",index:60},{value:.3,tweenMethod:"linearNone",tween:!0,target:2,key:"alpha",index:83},{value:0,tweenMethod:"linearNone",tween:!0,target:2,key:"alpha",index:84}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i}(View),e.NoticeViewUI=i}(hole||(hole={})),function(t){var e;(function(e){var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.Rank.RankViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1136},child:[{type:"Sprite",props:{y:0,x:0,width:640,var:"bg",mouseThrough:!1,mouseEnabled:!0,height:1136,alpha:.6}},{type:"Image",props:{y:91,x:25,width:590,skin:"res/ui/common/diban1.png",sizeGrid:"50,50,50,50",name:"BG",height:695},child:[{type:"Image",props:{y:69,x:17,width:555,skin:"res/ui/common/diban.png",sizeGrid:"33,36,51,29",height:608}},{type:"Box",props:{y:104,x:30,width:529,var:"box_rankView",height:535}}]},{type:"Image",props:{y:80,x:0,var:"btnClose",skin:"res/ui/common/btn_fanhui.png",name:"关闭"}},{type:"Image",props:{y:785,x:194,var:"btn_share",skin:"res/ui/rank/img_xuanyao.png",name:"炫耀"},child:[{type:"Text",props:{y:25,x:0,width:251,text:"炫    耀",strokeColor:"#c2491b",stroke:3,mouseThrough:!0,height:40,fontSize:30,font:"Microsoft YaHei",color:"#fff9ff",bold:!0,align:"center"}}]},{type:"Image",props:{y:800,x:80,var:"btn_prev",skin:"openRes/prev.png",name:"prev"}},{type:"Image",props:{y:800,x:470,var:"btn_next",skin:"openRes/next.png",name:"next"}},{type:"Label",props:{y:886,x:34,width:570,var:"lbRankHint",text:"",height:37,fontSize:22,font:"Microsoft YaHei",color:"#FFFFFF",align:"center"}},{type:"Box",props:{y:111,x:60,var:"boxRank"}},{type:"Label",props:{y:125,x:268,width:110,text:"LeaderBoard",mouseEnabled:!1,height:29,fontSize:22,font:"Microsoft YaHei",color:"#FFFFFF",align:"center"}},{type:"Box",props:{y:119,x:233,visible:!1,var:"boxRankGroup"},child:[{type:"Image",props:{y:-8,x:6,width:165,skin:"res/ui/rank/btnRank1.png"}},{type:"Label",props:{y:4,x:34,width:110,text:"群排行",mouseEnabled:!1,height:29,fontSize:22,font:"Microsoft YaHei",color:"#FFFFFF",align:"center"}}]},{type:"Sprite",props:{y:934,x:126,width:387,var:"ad",height:170}}]},i}(View);e.RankViewUI=i})((e=t.ui||(t.ui={})).Rank||(e.Rank={}))}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.ui.SuggestListRenderUI.uiView)},i.uiView={type:"View",props:{width:100,height:120},child:[{type:"Text",props:{y:96,x:2,width:96,var:"lbName",text:"挖矿小队啊",overflow:"hidden",height:20,fontSize:18,color:"#ffffff",align:"center"}},{type:"Sprite",props:{y:7,x:10,width:80,var:"spIcon",height:80}}]},i}(View),e.SuggestListRenderUI=i}(hole||(hole={})),function(t){var e,i;e=t.ui||(t.ui={}),i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ui.SuggestListViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:160},child:[{type:"Image",props:{y:1,x:0,width:640,skin:"res/ui/game/daojishidi.png",height:158}},{type:"List",props:{y:34,x:0,width:640,var:"list",spaceX:16,repeatY:1,height:120}},{type:"Image",props:{y:8,x:5,width:114,skin:"res/ui/home/cnxh.png",height:21}}]},i}(View),e.SuggestListViewUI=i}(hole||(hole={}));var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),LoadingView=function(t){function e(){var e=t.call(this)||this;return e.isHided=!1,e.screen_adapter(),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e,this._instance.onShow()),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Handler",{get:function(){return Handler.create(this.instance,this.instance.onProgress,null,!1)},enumerable:!0,configurable:!0}),e.prototype.onShow=function(){window.showBannerAd&&window.showBannerAd("loading"),Laya.stage.addChild(this),this.bar_loading.value=0,this.text_jingdu.text="1%"},e.prototype.onLoop=function(){1==this.bar_loading.value&&(this.bar_loading.value=0),this.bar_loading.value+=.01},e.prototype.onHide=function(){Laya.timer.clear(this,this.onLoop),this.isHided=!0,this.bar_loading.value=1,this.text_jingdu.text="100%",Laya.timer.once(500,this,this.delayHide)},e.prototype.delayHide=function(){window.hideBannerAd&&window.hideBannerAd("loading"),this.bar_loading.value=1,Laya.stage.removeChild(this),this.destroy(!0)},e.prototype.onProgress=function(t){!this.loaded&&window.FBInstant.startGameAsync().then(function(){clearInterval(window.fakeloadingInterval)}),this.loaded=!0,this.isHided||(this.text_jingdu.text=Math.floor(100*t)+"%",this.bar_loading.value=t)},e.prototype.screen_adapter=function(){this.y=AdapterManager.offsetY,this.x=AdapterManager.offsetX,0==this.x&&0==this.y||(this.img_background.size(Laya.Browser.clientWidth/AdapterManager.designScreenRadio,Laya.Browser.clientHeight/AdapterManager.designScreenRadio),this.img_background.y=-this.y,this.img_background.x=-this.x)},e}(hole.ui.LoadingViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),NoticeView=function(t){function e(){var e=t.call(this)||this;return e.x=Laya.stage.width-e.width>>1,e.y=Laya.stage.height-e.height>>1,e.zOrder=1001,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.show=function(t){this.displayedInStage||(Laya.stage.addChild(this),this.currentTextArr=t,this.loopShow(this.currentTextArr.length))},e.prototype.loopShow=function(t){this.ani1.play(0,!1),this.text_content.text=this.currentTextArr[this.currentTextArr.length-t],--t>0?Laya.timer.once(3e3,this,this.loopShow,[t]):Laya.timer.once(3e3,this,this.hide)},e.prototype.hide=function(){this.removeSelf(),this.ani1.stop()},e}(hole.ui.NoticeViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ActivityView=function(t){function e(){var e=t.call(this)||this;return e.helpType=2,e.onSeeVideoError=function(){NoticeView.instance.show(["您看视频太频繁了，休息一下再来吧~"])},e.onSeeVideoComplete=function(){Laya.Browser.onWeiXin&&(WXUtility.aldSendEvent("限时活动看视频成功"),MiNi.miniHttpServer.request(EnumKey.UPDAGE_FRIEND_HELP,{helpType:e.helpType,activityId:e.activityID,isVideo:!0},null,null,!0))},e.isModal=!0,e.btnGet.visible=!1,e.closeEffect=null,e.img_bg_xshdbt.skin=ConfigUtility.baseUrl+"res/ui/activity/xshdbt.png",e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.toShow=function(t){this.ins.activityID=t,this.ins.popup()},e.prototype.onGetChangeDate=function(t){if(traceLog("视频充能服务器返回",t),traceLog("更新界面显示"),t&&t.data){var e=t.data;if(2==e.data.helpType){var i=e.data.result,n=Number(Laya.LocalStorage.getItem(EnumKey.CUR_ADD_POWER_COUNT));n==i&&NoticeView.instance.show(["今日充能已达上限!"]),Laya.LocalStorage.setItem(EnumKey.CUR_ADD_POWER_COUNT,n+""),this.updataData(i)}}},e.prototype.onOpened=function(){this.btnShare.visible=!1,this.btnGet.on(LayaEvent.CLICK,this,this.onClickGet),this.btnShare.on(LayaEvent.CLICK,this,this.onShareClick),this.btnVideo.on(LayaEvent.CLICK,this,this.onVideoClick),EventManager.addEvent(EnumKey.UPDAGE_FRIEND_HELP,this,this.onGetChangeDate),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1),AdManager.resize(EnumAdIId.ACTIVITY_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio),this.updateUI(),EventManager.addEvent(EnumKey.GET_FRIEND_HELP,this,this.onGetFriendHelpData),Laya.Browser.onWeiXin&&MiNi.miniHttpServer.request(EnumKey.GET_FRIEND_HELP,{helpType:this.helpType,activityID:this.activityID},null,null,!0)},e.prototype.onGetFriendHelpData=function(t){if(console.log("打开界面获取到好友助力数据：",t),t&&t.data){var e=t.data;if(0==e.code&&2==e.data.helpType){var i=e.data.result;this.updataData(i)}}},e.prototype.updateUI=function(){if(this.activityID){this.data=ActivityConfig.instance.getDataById(this.activityID),this.imgTitle.skin="res/ui/activity/title"+this.data.id+".png";var t=SkinConfig.getDataById(this.data.rewardSkinId).skinName;this.imgSkin.skin="res/skinUI/"+t+".png";var e=this.data.openTime.split("_"),i=this.data.endTime.split("_");switch(this.lbTime.text="活动时间："+e[0]+" - "+i[0],this.lbLimitHelpNum.text=this.data.conditionalValueMax+"",this.data.type){case 1:this.imgTitle.skin="res/ui/activity/title"+this.data.id+".png";break;case 2:this.imgTitle.skin="res/ui/activity/xspfz.png"}}},e.prototype.updataData=function(t){this.lbTotalNum.text=this.data.conditionalValue+"次",this.lbProgress.text=t+"/"+this.data.conditionalValue,this.imgProgress.width=t/this.data.conditionalValue*177,this.lbLeftNum.text=this.data.conditionalValue-t+"",this.isActive=t==this.data.conditionalValue,this.imgPoint0.skin=t>0?"res/ui/activity/hong.png":"res/ui/home/hui.png",this.imgPoint1.skin=this.isActive?"res/ui/activity/hong.png":"res/ui/home/hui.png",ActivityManager.hasGotPrize(this.activityID)?(this.btnGet.skin="res/ui/activity/btnGot.png",this.GetLab.text="已领取"):(this.btnGet.skin="res/ui/activity/btnGet.png",this.GetLab.text="立即领取"),this.isActive?(this.btnGet.visible=!0,this.btnShare.visible=!1,this.btnVideo.visible=!1):(this.btnGet.visible=!1,this.btnShare.visible=!1,this.btnVideo.visible=!0)},e.prototype.onClickGet=function(){NoticeView.instance.show(["已领取活动皮肤，快去皮肤里使用吧"]),ActivityManager.hasGotPrize(this.activityID)||(this.btnGet.skin="res/ui/activity/btnGot.png",this.GetLab.text="已领取",ActivityManager.getStatus={activityId:this.activityID,status:!0})},e.prototype.onVideoClick=function(){Laya.Browser.onWeiXin?(RewardVideoManager.show(EnumShareId.ACTIVITY_SEE_VIDEO,this.onSeeVideoComplete,this.onSeeVideoError,"广告未播放完毕，无法获得奖励"),WXUtility.aldSendEvent("限时活动看视频")):this.onSeeVideoComplete()},e.prototype.onShareClick=function(){if(Laya.Browser.onWeiXin){var t="helpType="+this.helpType+"&activityId="+this.activityID+"&openId="+ConfigUtility.openId;ShareUtil.sharegame(EnumShareId.ACTIVITY_HELP,t),WXUtility.aldSendEvent("限时活动分享")}},e.prototype.onClosed=function(){EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0),this.btnGet.off(LayaEvent.CLICK,this,this.onClickGet),this.btnShare.off(LayaEvent.CLICK,this,this.onShareClick),this.btnVideo.off(LayaEvent.CLICK,this,this.onVideoClick),EventManager.removeEvent(EnumKey.GET_FRIEND_HELP,this.onGetFriendHelpData),EventManager.removeEvent(EnumKey.UPDAGE_FRIEND_HELP,this.onGetChangeDate)},e}(hole.ui.ActivityViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),DebugView=function(t){function e(){var e=t.call(this)||this;return e.x=260+AdapterManager.offsetX,e.y=AdapterManager.offsetY,e.add_AI.on("click",e,e.on_add_AI),e.change_player_level.on("click",e,e.on_change_player_level),e.change_ai_level.on("click",e,e.on_change_Ai_level),e.switch_stat.on("click",e,e.on_switch_stat),e.game_over.on("click",e,e.on_set_game_over),GameManager.EventManagerEx.AddListener(EventSetting.on_already_to_play,new EventListener(e.show.bind(e))),GameManager.EventManagerEx.AddListener(EventSetting.on_exit_game,new EventListener(e.hide.bind(e))),GameManager.EventManagerEx.AddListener(EventSetting.on_classic_over,new EventListener(e.hide.bind(e))),e}return __extends(e,t),Object.defineProperty(e,"Instance",{get:function(){return(null==this._Instance||this._Instance.destroyed)&&(this.isConstruct=!0,this._Instance=new e),this._Instance},enumerable:!0,configurable:!0}),e.prototype.show=function(){this.text_player_num.text="数量:"+DetectManager.Instance.currentPlayerNumber,this.text_player_level.text="阶级:1",this.text_game_times.text=GameDataManager.classicGameDataText;for(var t=0,i=0,n=0,r=DetectManager.Instance.OtherPlayers.values.length;r--;)switch(DetectManager.Instance.OtherPlayers.values[r].AIType){case EOtherType.SimpleAI:t++;break;case EOtherType.AdvanceAI:i++;break;case EOtherType.AdvanceProAI:n++}e.Instance.text_ai_type.text=t+"："+i+"："+n,Laya.timer.loop(1,this,this.update),Laya.stage.addChild(this)},e.prototype.update=function(){e.Instance.text_model_num.text=DetectManager.Instance.InScreenModels.values.length+"："+DetectManager.Instance.InScreenOPs.values.length},e.prototype.hide=function(){this.removeSelf()},e.prototype.release=function(){this.add_AI.off("click",this,this.on_add_AI),this.change_player_level.off("click",this,this.on_change_player_level),this.change_ai_level.off("click",this,this.on_change_Ai_level),this.switch_stat.off("click",this,this.on_switch_stat),e.isConstruct=!1,this.destroy(!0)},e.prototype.on_add_AI=function(){var t=OtherPlayerManager.SpawnAIPlayer();SceneManager.scene.addChild(t),FenceEntity.reset(),t.AIComponent.enable=!0,this.text_player_num.text="数量:"+DetectManager.Instance.currentPlayerNumber},e.prototype.on_change_player_level=function(){GameManager.PlayerEntity.change_level(),this.text_player_level.text="阶级:"+(GameManager.PlayerEntity.levelIndex+1)},e.prototype.on_change_Ai_level=function(){OtherPlayerManager.ChangeAILevel()},e.prototype.on_switch_stat=function(){Laya.Stat._show?(e.isPrintLog=!1,Laya.Stat.hide()):(e.isPrintLog=!0,Laya.Stat.show(0,200))},e.prototype.on_set_game_over=function(){Scene3DController.Scene3DView.gameView.on_time_up()},e.isPrintLog=!1,e.isConstruct=!1,e}(hole.ui.Game.DebugViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),HowToPlayIcon=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"Instance",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.show=function(t,e,i){this.x=t,this.y=e,this.img_icon.on("click",this,this.on_click),i.addChild(this)},e.prototype.hide=function(){this.img_icon.off("click",this,this.on_click),this.removeSelf()},e.prototype.on_click=function(){HowToPlayView.instance.popup(!0,!0)},e}(hole.ui.HowToPlayIconUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),HowToPlayView=function(t){function e(){var e=t.call(this)||this;return e.popupCenter=!0,e.isModal=!0,e.closeEffect=null,e.img_bangzhu.skin=ConfigUtility.baseUrl+"res/image/bangzhu.png",e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.onOpened=function(){ConfigUtility.isShowHowToPlayVideo&&HelpVideoView.ins.show(this.x+387,this.y+147,NumberUtil.randRange(0,1)),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1),AdManager.resize(EnumAdIId.HowToPlayView,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.onClosed=function(){HelpVideoView.ins.hide(),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0),ConfigUtility.isShowADInGame&&GameDataManager.gameState==EGameState.InGame&&AdManager.setAdToBottom()},e}(hole.ui.HowToPlayViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),HelpVideoView=function(t){function e(){var e=t.call(this)||this;return e.zOrder=1001,e.btnClose.on(LayaEvent.CLICK,e,e.onClose),e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return e._ins||(e._ins=new e),e._ins},enumerable:!0,configurable:!0}),e.prototype.createHelpVideo=function(t){ConfigUtility.isShowHowToPlayVideo&&(this.video&&this.video.destroy(),Browser.onWeiXin&&wx.createVideo&&(this.video=wx.createVideo({x:(this.x+5)*AdapterManager.scaleRadio,y:(this.y+40)*AdapterManager.scaleRadio,width:190*AdapterManager.scaleRadio,height:190*AdapterManager.scaleRadio,src:e.MP4_URL[t],controls:!1,autoplay:!0,loop:!0})))},e.prototype.onClose=function(){this.video&&this.hide()},e.prototype.show=function(t,e,i){this.pos(t,e),Laya.stage.addChild(this),this.createHelpVideo(i)},e.prototype.hide=function(){this.removeSelf(),this.video&&(this.video.destroy(),this.video=null)},e.MP4_URL=[ConfigUtility.baseUrl+"res/video/video_0.mp4",ConfigUtility.baseUrl+"res/video/video_1.mp4"],e}(hole.ui.HelpVideoViewUI),Scene3DView=function(){function t(){this.gameView=new GameView,GameManager.EventManagerEx.AddListener(EventSetting.on_local_player_joined,new EventListener(this.on_local_player_joined.bind(this)))}return t.prototype.on_local_player_joined=function(){this.gameView.onShow(),this.gameView.mouseEnabled=!1,this.gameView.text_player_name.text=HelperExtension.shiftName(GameManager.PlayerEntity.name),GameManager.isOnline||LiheManagaer.judge_join_lihe()},t.prototype.onShow=function(){Laya.stage.addChild(SceneManager.scene)},t.prototype.onHide=function(){Laya.stage.removeChild(SceneManager.scene)},t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),GameView=function(t){function e(){var i=t.call(this)||this;return i.selfColor="#67ff01",e._ins=i,i.screen_adapter(),i.img_exit.on("click",i,i.on_exit),GameManager.EventManagerEx.AddListener(EventSetting.on_already_to_play,new EventListener(i.on_alrady_play.bind(i))),GameManager.EventManagerEx.AddListener(EventSetting.on_classic_over,new EventListener(i.on_classic_over.bind(i))),GameManager.EventManagerEx.AddListener(EventSetting.on_exit_game,new EventListener(i.on_exit_game.bind(i))),GameManager.EventManagerEx.AddListener(EventSetting.on_survival_over,new EventListener(i.on_survival_over.bind(i))),i}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"game_countdown",{set:function(t){this._game_countdown=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exitView",{get:function(){return null==this._exitView&&(this._exitView=new ExitView),this._exitView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"game_total_time",{get:function(){return 120},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"game_run_time",{get:function(){return this.game_total_time-this._game_countdown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"countdownView",{get:function(){return null==this._countdownView&&(this._countdownView=new CountDownView(this)),this._countdownView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyOneView",{get:function(){return null==this._readyOneView&&(this._readyOneView=new ReadyOneView(this)),this._readyOneView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyView",{get:function(){return null==this._readyView&&(this._readyView=new Ready321View(this)),this._readyView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flyingShoesView",{get:function(){return null==this._flyingShoesView&&(this._flyingShoesView=new FlyingShoesView(this)),this._flyingShoesView},enumerable:!0,configurable:!0}),Object.defineProperty(e,"reliveView",{get:function(){return null==this._reliveView&&(this._reliveView=new ReliveView),this._reliveView},enumerable:!0,configurable:!0}),e.prototype.screen_adapter=function(){this.y=AdapterManager.offsetY,this.x=AdapterManager.offsetX},e.prototype.onShow=function(){GameDataManager.gameState=EGameState.InGame;var t=Math.floor(this.game_total_time/60),e=t<10?"0"+t:""+t,i=parseInt(this.game_total_time%60+""),n=i<10?"0"+i:""+i;this.text_timing.text=e+" : "+n,this.update_information_bar(DetectManager.Instance.OtherPlayers.values),Laya.stage.addChild(this),this.readyView.show(),this.lbDoubleTime.visible=!1,null!=SubDomainMessageManager.layaSharedCanvas&&void 0!=SubDomainMessageManager.layaSharedCanvas&&SubDomainMessageManager.methodCall("updateRank"),GameManager.isOnline?(this.lb_playerCount.visible=!0,this.lb_playerCount.text="剩余球球："+DetectManager.Instance.currentPlayerNumber,this.img_bg_player_count.visible=!0,this.img_xiezi.visible=!1):(this.lb_playerCount.visible=!1,this.img_bg_player_count.visible=!1,this.img_xiezi.visible=!1)},e.prototype.startFriendHelp=function(){GameDataManager.friendHelpNum>0?(this._doubleTime=3*GameDataManager.friendHelpNum,Laya.timer.loop(1e3,this,this.onDoubleTime),this.onDoubleTime(),this.lbDoubleTime.visible=!0,GameDataManager.isFriendHelp=!0):(GameDataManager.isFriendHelp=!1,this.lbDoubleTime.visible=!1)},e.prototype.onDoubleTime=function(){this._doubleTime>0@(this.lbDoubleTime.text="双倍得分："+this._doubleTime+"秒",this._doubleTime--):(GameDataManager.isFriendHelp=!1,this.lbDoubleTime.visible=!1,Laya.timer.clear(this,this.onDoubleTime))},e.prototype.onHide=function(){this.destroyed||(this.lbDoubleTime.visible&&(this.lbDoubleTime.visible=!1,Laya.timer.clear(this,this.onDoubleTime)),this._countdownView&&this._countdownView.hide(),this._flyingShoesView&&this._flyingShoesView.hide(),Laya.stage.removeChild(this),Laya.timer.clear(this,this.onGameLoop))},e.prototype.onGameLoop=function(){if(this._game_countdown--,!(this._game_countdown<0)&&(this.update_game_countdown(),this.update_information_bar(DetectManager.Instance.sort_rank_bonus()),this.update_time_judge(),GameManager.isOnline)){if(0!=GameManager.PlayerEntity.MBFeature.speedMuti){this.img_xiezi.visible=!0,GameManager.PlayerEntity.MBFeature.speedMuti>0@this.img_xiezi.skin="res/ui/game/xiezi.png":this.img_xiezi.skin="res/ui/game/xiezi2.png";var t=GameManager.PlayerEntity.MBFeature.speedRecoverTime-Laya.timer.currTimer;0<t&&t<=3e3&&this.xiezi_flash.play(0,!1)}else this.img_xiezi.visible=!1;GameManager.PlayerEntity.levelIndex<3?DetectManager.Instance.allTmpID.length>3&&MainSocket.C2S_SYNC_EAT_BUILDING(GameManager.PlayerEntity.roomIndex,DetectManager.Instance.allTmpID):DetectManager.Instance.allTmpID.length>6&&MainSocket.C2S_SYNC_EAT_BUILDING(GameManager.PlayerEntity.roomIndex,DetectManager.Instance.allTmpID);var e=DetectManager.Instance.currentPlayerNumber;this.lb_playerCount.text="剩余球球："+e,1==e&&this.on_time_up()}},e.prototype.vibrateLong=function(t){WXUtility.vibrateLong(),t>1&&Laya.timer.once(500,this,this.vibrateLong,[t-1])},e.prototype.on_classic_game_over=function(){this.commitUserRankData(),GameDataManager.playTimes++,AudioController.stopBG(),GameDataManager.isGetLuckyLihe?LotteryRewardView.ins.toShow(null,null,ERewardType.LuckyLihe):GameManager.EventManagerEx.RaiseEvent(EventSetting.on_classic_over)},e.prototype.commitUserRankData=function(){var t=0;if(GameManager.PlayerEntity.rank<=ScoreConfig.config.length&&(t=ScoreConfig.config[GameManager.PlayerEntity.rank-1].score),0!=t){if(t<0&&RankDataManager.isRankProtect)return;SyncDataManager.score+=t,PlatformAPI.updateLeaderboard("rolllingBallRank",SyncDataManager.score)}},e.prototype.update_game_countdown=function(){var t=Math.floor(this._game_countdown/60),e=t<10?"0"+t:""+t,i=parseInt(this._game_countdown%60+""),n=i<10?"0"+i:""+i;this.text_timing.text=e+" : "+n},e.prototype.update_information_bar=function(t){var e=GameManager.PlayerEntity;switch(this.text_self_rank.text=e.rank+"",this.text_self.text=HelperExtension.shiftName(e.name),this.text_self_weight.text=e.weight+"",this.text_kill_amount.text="Crushing: "+e.kill,t.length>0&&(this.text_no1.text=HelperExtension.shiftName(t[0].name),this.text_no1_weight.text=t[0].weight+"",this.text_no1.color="#ffffff",this.text_no1_weight.color="#ffffff",this.text_no1_rank.color="#ffffff",this.text_weight_unit_1.color="#ffffff",CrownEntity.WearCrown(t[0])),t.length>1&&(this.text_no2.text=HelperExtension.shiftName(t[1].name),this.text_no2_weight.text=t[1].weight+"",this.text_no2.color="#ffffff",this.text_no2_weight.color="#ffffff",this.text_no2_rank.color="#ffffff",this.text_weight_unit_2.color="#ffffff"),t.length>2&&(this.text_no3.text=HelperExtension.shiftName(t[2].name),this.text_no3_weight.text=t[2].weight+"",this.text_no3.color="#ffffff",this.text_no3_weight.color="#ffffff",this.text_no3_rank.color="#ffffff",this.text_weight_unit_3.color="#ffffff"),e.rank){case 1:this.text_no1.color=this.selfColor,this.text_no1_weight.color=this.selfColor,this.text_no1_rank.color=this.selfColor,this.text_weight_unit_1.color=this.selfColor;break;case 2:this.text_no2.color=this.selfColor,this.text_no2_weight.color=this.selfColor,this.text_no2_rank.color=this.selfColor,this.text_weight_unit_2.color=this.selfColor;break;case 3:this.text_no3.color=this.selfColor,this.text_no3_weight.color=this.selfColor,this.text_no3_rank.color=this.selfColor,this.text_weight_unit_3.color=this.selfColor}},e.prototype.update_time_judge=function(){if(60==this._game_countdown||30==this._game_countdown||10==this._game_countdown)this.readyOneView.show(this._game_countdown),GameManager.isOnline||(60==this._game_countdown?WXUtility.aldSendEvent("游戏60S",{"场景":ESceneTag[SceneManager.CurrentSceneTag]+""}):30==this._game_countdown&&WXUtility.pointForNew("*游戏90S",ENewPointTpye.GAME_PLAYTIME_OVER_90));else{if(0==this._game_countdown)return this.countdownView.show(this._game_countdown),void this.on_time_up();this._game_countdown<=5?this.countdownView.show(this._game_countdown):100==this._game_countdown&&(GameManager.isOnline||(this.flyingShoesView.show(),WXUtility.pointForNew("*游戏30S",ENewPointTpye.GAME_PLAYTIME_OVER_30)))}GameManager.isOnline&&30==this.game_run_time&&WXUtility.point_with_new("游戏30S（吃鸡）",{},ENewPointTpye.SURVIVE_GAME_PLAYTIME_OVER_30)},e.prototype.on_exit=function(){this.exitView.show()},e.prototype.on_alrady_play=function(){this.mouseEnabled=!0,GameManager.isOnline?this._game_countdown=GameManager.onlineGameTotalTime:this._game_countdown=this.game_total_time,AudioController.playBG(),Laya.timer.loop(1e3,this,this.onGameLoop),ConfigUtility.isShowADInGame&&AdManager.show(AdManager.GAME_AD,EnumAdIId.GAME_VIEW)},e.prototype.on_classic_over=function(){this.onHide(),ClassicOverView.instance.onShow()},e.prototype.on_survival_over=function(){this.onHide()},e.prototype.on_exit_game=function(){this.onHide()},e.prototype.on_time_up=function(){GameManager.isOnline?(GameManager.EventManagerEx.RaiseEvent(EventSetting.on_survival_over),GameManager.PlayerEntity.isAlive&&SurvivalOverView.ins.toShow()):Laya.timer.once(1500,this,this.on_classic_game_over),DetectManager.Instance.on_Game_over(),GameManager.mouseController.enable(!1),Laya.timer.once(450,this,this.vibrateLong,[3]),GameDataManager.gameState=EGameState.GameOverOrExitGame,GameDataManager.isBrandNewDay=!1},e}(hole.ui.Game.GameViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ready321View=function(t){function e(e){var i=t.call(this)||this;return i.OffsetX=204,i.OffsetY=173,i.ready_countdown=3,i.parentView=e,i.x=i.OffsetX,i.y=i.OffsetY,i.maskSprite=new Laya.Sprite,i.maskSprite.name="guide-mask",i.maskSprite.graphics.drawRect(-i.x,-i.y-AdapterManager.offsetY,Laya.stage.width,Laya.stage.height+100,"#000000"),i.maskSprite.alpha=.7,i}return __extends(e,t),e.prototype.addEvent=function(){this.img_lingqu.on(LayaEvent.CLICK,this,this.onDoubleSize),this.img_gold_lingqu.on(LayaEvent.CLICK,this,this.onDoubleSize_Gold),this.img_share_lingqu.on(LayaEvent.CLICK,this,this.onDoubleSize_Share)},e.prototype.removeEvent=function(){this.img_lingqu.off(LayaEvent.CLICK,this,this.onDoubleSize),this.img_gold_lingqu.off(LayaEvent.CLICK,this,this.onDoubleSize_Gold),this.img_share_lingqu.off(LayaEvent.CLICK,this,this.onDoubleSize_Share)},e.prototype.show=function(){if(GameManager.isOnline?WXUtility.point_with_new("进入游戏321（吃鸡）",{},ENewPointTpye.SURVIVE_ENTER_READY321):WXUtility.pointForNew("*进入321",ENewPointTpye.ENTER_GAME_321),this.addEvent(),this.addChildAt(this.maskSprite,0),Laya.stage.addChild(this),this.img_number.visible=!0,this.img_start.visible=!1,this.boxDoubleSize.visible=!1,this.img_number.skin="res/ui/game/daojishi"+this.ready_countdown+".png",this.bigCost.text=GameSetting.instance.BigCostGold+"",AudioController.play(ESoundType.countdown,3),this.onReadyLoop(this.ready_countdown),GameManager.isOnline)GameDataManager.isSeeVideoAtGameOver=!1;else if(GameDataManager.isSeeVideoAtGameOver)GameDataManager.isSeeVideoAtGameOver=!1,this.boxDoubleSize.visible=!1,this.changeDoubleSize();else if(ConfigUtility.IsSafeVersion){this.boxDoubleSize.visible=!0,this.img_gold_lingqu.visible=!1,this.img_share_lingqu.visible=!1;var t=Number(Laya.LocalStorage.getItem(EnumKey.CLICK_READY_GETBTN_COUNT));if(t||(t=0),t<GameSetting.instance.BigFreeTimes)this.img_lingqu.visible=!0;else switch(ConfigUtility.getRewardType){case EGetRewardType.video:this.img_gold_lingqu.visible=!0;break;case EGetRewardType.shareAndVideo:case EGetRewardType.share:this.img_share_lingqu.visible=!0}}OtherPlayerManager.judge_kaijubianda()},e.prototype.onDoubleSize=function(){Laya.LocalStorage.setItem(EnumKey.CLICK_READY_GETBTN_COUNT,"1"),WXUtility.pointForNew("*球球变大（免费）",ENewPointTpye.READY321_CHANGE_BIG_FREE),this.changeDoubleSize(),this.boxDoubleSize.visible=!1},e.prototype.onDoubleSize_Gold=function(){var t=GameSetting.instance.BigCostGold;SyncDataManager.gold<t?NoticeView.instance.show(["金币不足，欢乐转盘得金币哟~"]):(SyncDataManager.gold-=t,this.changeDoubleSize(),this.boxDoubleSize.visible=!1)},e.prototype.onDoubleSize_Share=function(){var t=new ShareInfo;t.shareId=EnumShareId.READY_SHARE_DOUBLE_SIZE,t.successFunc=new CallBackFunc(this,this.onShareSuccess),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.onShareSuccess=function(){WXUtility.aldSendEvent("球球变大（分享）"),this.changeDoubleSize(),this.boxDoubleSize.visible=!1,WXUtility.pointForNew("*球球变大（分享）",ENewPointTpye.READY321_CHANGE_BIG_SHARE)},e.prototype.onShareFail=function(){ShareUtil.shareFailtips()},e.prototype.onReadyLoop=function(t){t>0@this.img_number.skin="res/ui/game/daojishi"+t+".png":(this.img_number.visible=!1,this.img_start.visible=!0,AudioController.play(ESoundType.game_start),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_already_to_play),this.removeChild(this.maskSprite),Laya.timer.once(100,this,this.hide)),t>0&&Laya.timer.once(1e3,this,this.onReadyLoop,[t-1])},e.prototype.hide=function(){this.removeEvent(),Laya.stage.removeChild(this)},e.prototype.changeDoubleSize=function(){GameManager.PlayerEntity.weight+=8,NoticeView.instance.show(["获得开局变大"])},e}(hole.ui.Game.Ready321ViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ReadyOneView=function(t){function e(e){var i=t.call(this)||this;return i.OffsetX=204,i.OffsetY=173,i.parentView=e,i.x=i.OffsetX,i.y=i.OffsetY,i.zOrder=1,i}return __extends(e,t),e.prototype.show=function(t){this.img_second.skin="res/ui/game/daojishi"+t+"m.png",this.ani_show.play(0,!1),AudioController.play(ESoundType.countdown,3),Laya.timer.once(2700,this,this.hide),this.parentView.addChild(this)},e.prototype.hide=function(){this.ani_hide.play(0,!1),Laya.timer.once(300,this,this.on_hide_over)},e.prototype.on_hide_over=function(){this.parent.removeChild(this)},e}(hole.ui.Game.ReadyOneViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),GuideView=function(t){function e(){var e=t.call(this)||this;return e.zOrder=2,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return null==this._ins&&(this._ins=Laya.Pool.getItemByClass("GuideView",e)),this._ins},enumerable:!0,configurable:!0}),e.prototype.show=function(t,e,i){void 0===t&&(t="手指滑动起来吧"),void 0===e&&(e=110),void 0===i&&(i=790),this.x=e+AdapterManager.offsetX,this.y=i+AdapterManager.offsetY,this.lb_tooltip.text=t,this.ani_hand.play(0,!0),Laya.stage.addChild(this)},e.prototype.hide=function(t){void 0===t&&(t=!0),Laya.stage.removeChild(this),t&&this.recover()},e.prototype.recover=function(){e._ins=null,Laya.Pool.recover("GuideView",this)},e}(hole.ui.Common.GuideViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ExitView=function(t){function e(){var e=t.call(this)||this;e.x=AdapterManager.offsetX,e.y=AdapterManager.offsetY;var i=new Sprite;return i.graphics.drawRect(-AdapterManager.offsetX,-AdapterManager.offsetY,Laya.stage.width,Laya.stage.height,0),i.alpha=.6,i.mouseEnabled=!0,i.mouseThrough=!1,e.addChildAt(i,0),e.zOrder=100,e}return __extends(e,t),e.prototype.show=function(){this.add_events(),Laya.stage.addChild(this)},e.prototype.add_events=function(){this.btn_continue.on("click",this,this.on_continue),this.btn_exit.on("click",this,this.on_exit),this.btn_share_for_exit.on("click",this,this.on_share_for_exit),this.btn_video_for_exit.on("click",this,this.on_video_for_exit)},e.prototype.remove_events=function(){this.btn_continue.off("click",this,this.on_continue),this.btn_exit.off("click",this,this.on_exit),this.btn_share_for_exit.off("click",this,this.on_share_for_exit),this.btn_video_for_exit.off("click",this,this.on_video_for_exit)},e.prototype.hide=function(){this.remove_events(),this.removeSelf()},e.prototype.on_continue=function(){this.hide()},e.prototype.on_exit=function(){GameDataManager.gameState=EGameState.GameOverOrExitGame,HowToPlayIcon.Instance.hide(),GameManager.isOnline&&TeamManager.hasTeam?TeamPlayView.instance.onShow():HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_exit_game),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.SCENE),this.hide(),Laya.SoundManager.stopAll(),GameManager.isOnline?MainSocket.C2S_EXIT_GAME():GameView.reliveView.hide()},e.prototype.on_close=function(){this.hide()},e.prototype.on_share_for_exit=function(){HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_exit_game),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.SCENE),this.hide(),AudioController.stopBG()},e.prototype.on_video_for_exit=function(){Laya.Browser.onWeiXin,HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_exit_game),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.SCENE),this.hide(),AudioController.stopBG()},e}(hole.ui.Game.ExitViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),MatchView=function(t){function e(){var e=t.call(this)||this;e.isRaiseMatchOver=!1,e.totalMatchNum=15,e.x=0,e.y=0,e.avatarNum=new Array,e.avatarShowed=new Array,e.screen_adapter();var i=new Sprite,n=e.localToGlobal(new Point);return i.graphics.drawRect(-n.x,-n.y,Laya.stage.width,Laya.stage.height,0),i.alpha=.6,i.mouseEnabled=!0,e.addChildAt(i,0),EventManager.addEvent(EnumKey.REQ_MATCH_DATA,e,e.onGetMatchRank),e}return __extends(e,t),Object.defineProperty(e,"Instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.screen_adapter=function(){this.y=AdapterManager.offsetY,this.x=AdapterManager.offsetX},e.prototype.show=function(){if(GameManager.isOnline?WXUtility.point_with_new("进入匹配（吃鸡）",{},ENewPointTpye.SURVIVE_ENTER_MACTH):(WXUtility.aldSendEvent("进入匹配"),WXUtility.pointForNew_muti("*进入匹配")),GameDataManager.gameState=EGameState.InMatch,Laya.stage.addChild(this),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_match_start),GuideView.ins.show("开局碾压小建筑群，成长更快哦~"),GameDataManager.isNewPlayer&&ConfigUtility.isShowHowToPlayVideo&&(HelpVideoView.ins.show(this.x+442,this.y+90,SceneManager.CurrentSceneTag),Laya.timer.once(6e4,HelpVideoView.ins,HelpVideoView.ins.hide)),GameManager.isOnline){for(this.lb_time.text="3分钟",GameDataManager.isGetMatchData=!1,this.matchNum=0,this.lbMatchNum.text="0/15",this.avatarShowed.length=0,t=0;t<15;t++)this.avatarShowed.push(this["avatar"+t]),this.avatarShowed[t].skin="res/ui/pipei/jiazai.png",this.avatarShowed[t].rotation=0;for(e=new Array;this.avatarShowed.length>0;)e.push(this.avatarShowed.splice(Math.floor(Math.random()*this.avatarShowed.length),1)[0]);this.avatarShowed=e}else{this.lb_time.text="2分钟",Laya.Browser.onWeiXin&&HoleAppController.isLoginSever&&Math.floor(GameDataManager.matchReqTimes/10)>=GameDataManager.matchReqTimes?MiNi.miniHttpServer.request(EnumKey.REQ_MATCH_DATA,null,null,null,!0):this.onGetMatchRank(null),this.matchNum=1,this.lbMatchNum.text="1/15",ConfigUtility.userInfo?ConfigUtility.userInfo.avatarUrl&&(this.avatar0.skin=ConfigUtility.userInfo.avatarUrl):this.avatar0.skin=ConfigUtility.defaultAvatar,this.avatarShowed.length=0;for(var t=1;t<15;t++)this.avatarShowed.push(this["avatar"+t]),this.avatarShowed[t-1].skin="res/ui/pipei/jiazai.png",this.avatarShowed[t-1].rotation=0;for(var e=new Array;this.avatarShowed.length>0;)e.push(this.avatarShowed.splice(Math.floor(Math.random()*this.avatarShowed.length),1)[0]);this.avatarShowed=e}this.tmpWaiteMatchTime=GameSetting.instance.MatchWaitTimes,this.isRaiseMatchOver=!1,Laya.timer.loop(1e3/30,this,this.onLoop)},e.prototype.onLoop=function(){this.rotationAvatar(),this.bar_loading.value>=.99&&(this.bar_loading.value=0),this.bar_loading.value+=.005,SceneManager.IsSceneLoaded&&(GameManager.isOnline&&GameDataManager.isGetMatchData?this.isRaiseMatchOver||(this.isRaiseMatchOver=!0,GameManager.EventManagerEx.RaiseEvent(EventSetting.on_match_over),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_ready_load_game)):this.matchNum>=15&&(this.bar_loading.value=1,Laya.timer.clear(this,this.onLoop),Laya.timer.once(1e3,this,this.hide))),this.tmpWaiteMatchTime-=33,this.tmpWaiteMatchTime<=0&&(this.tmpWaiteMatchTime=GameSetting.instance.MatchWaitTimes,console.log("超时处理"),GameManager.isOnline?0==this.matchNum&&(Laya.Pool.getItemByClass("ReMatchView",ReMatchView).show(),console.log("here ReMatchView")):1==this.matchNum&&this.onGetMatchRank(null))},e.prototype.rotationAvatar=function(){for(var t=1;t<15;t++)"res/ui/pipei/jiazai.png"==this.avatarShowed[t-1].skin&&this.avatarShowed[t-1].rotation++},e.prototype.onSetAvatar_online=function(t,e){this.matchNum++,this.lbMatchNum.text=this.matchNum+"/15";var i=GameDataManager.onlineMatchData[e];if(!(t>=this.avatarShowed.length)){var n=this.avatarShowed[t];i.avatarUrl?n.skin=i.avatarUrl:n.skin=ConfigUtility.defaultAvatar,n.rotation=0}},e.prototype.onSetAvatar=function(t){this.matchNum++,this.lbMatchNum.text=this.matchNum+"/15";var e=GameDataManager.tmpMatchData[t-1],i=this.avatarShowed[t-1];e.avatarUrl?i.skin=e.avatarUrl:i.skin=ConfigUtility.defaultAvatar,i.rotation=0},e.prototype.setAvatar=function(t){for(var e=0,i=0;i<t;i++)e+=this.avatarNum[i];for(var n=0,r=1;r<this.avatarNum[t]+1;r++){var a=n+50*r;Laya.timer.once(a,this,this.onSetAvatar,[e+r],!1),n=a}},e.prototype.setAvatar_for_load_scene=function(){for(var t=0,e=0;e<this.avatarNum.length;e++)t+=this.avatarNum[e];for(var i=0,n=14-t,r=1;r<=n;r++){var a=i+50*r;Laya.timer.once(a,this,this.onSetAvatar,[t+r],!1),i=a}},e.prototype.onGetMatchRank=function(t){if(GameDataManager.matchReqTimes++,traceLog("获得匹配的玩家数据",t),t&&t.data&&t.data.data&&t.data.data.length>0){var e=t.data.data,i=e.length;i<14?(GameDataManager.matchData.splice(0,i),GameDataManager.matchData=GameDataManager.matchData.concat(e)):GameDataManager.matchData=e}GameDataManager.tmpMatchData=GameDataManager.getRandomMatchData(),this.matchTime=1e3*NumberUtil.randRange(3,5);var n=NumberUtil.randRange(3,5),r=Math.floor(this.matchTime/n);this.avatarNum.length=0;for(var a=Math.floor(15/n),s=0;s<n;s++){for(var o=0,l=0;l<this.avatarNum.length;l++)o+=this.avatarNum[l];if(s==n-1)this.avatarNum.push(14-o);else{var h=NumberUtil.randRange(-1,1)+a;o+h>14&&(h=14-o),this.avatarNum.push(h)}}if(!SceneManager.IsSceneLoaded){for(var c=NumberUtil.randRange(1,3),u=(this.avatarNum.length,0);u<c;u++){var _=NumberUtil.randRange(0,this.avatarNum.length);this.avatarNum[_]>0?this.avatarNum[_]--:u--}GameManager.EventManagerEx.AddListener(EventSetting.on_resource_loaded,new EventListener(this.setAvatar_for_load_scene.bind(this),!0))}traceLog("``````````````每次显示的人：",this.avatarNum);for(var d=0,f=1;f<n+1;f++){var p=d+NumberUtil.randRange(-300,300)+r;Laya.timer.once(p,this,this.setAvatar,[f-1],!1),d=p}},e.prototype.hide=function(){window.hideBannerAd&&window.hideBannerAd("loading"),Laya.timer.clear(this,this.onLoop),Laya.stage.removeChild(this),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_ready_load_game),HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.SCENE),GameDataManager.playerDeadTimes=0,GameManager.EventManagerEx.RaiseEvent(EventSetting.on_match_over)},e.prototype.toHide=function(t){void 0===t&&(t=!1),Laya.timer.clear(this,this.onLoop),Laya.stage.removeChild(this),t&&GuideView.ins.displayedInStage&&GuideView.ins.hide()},e}(hole.ui.Game.MatchViewUI),ReMatchView=function(){function t(){}return t.prototype.show=function(){PromptInterfaceView.Ins.onShow("重新匹配","退出匹配","当前网络不稳定，是否重新匹配",this.on_reMatch.bind(this),this.on_exitMatch.bind(this))},t.prototype.hide=function(){PromptInterfaceView.Ins.hide(),Laya.Pool.recover("ReMatchView",this)},t.prototype.on_reMatch=function(){this.hide(),TeamManager.hasTeam?(MainSocket.C2S_EXIT_GAME(),MainSocket.C2S_LEAVE_TEAM(),TeamManager.clearAll(),NoticeView.instance.show(["已经离开队伍","开始重新匹配"]),Laya.timer.callLater(MainSocket,MainSocket.C2S_START_MATCH)):(NoticeView.instance.show(["开始重新匹配"]),MainSocket.C2S_EXIT_GAME(),MainSocket.C2S_START_MATCH())},t.prototype.on_exitMatch=function(){MainSocket.C2S_EXIT_GAME(),this.hide(),MatchView.Instance.toHide(!0),HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME)},t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ReliveView=function(t){function e(){var e=t.call(this)||this;e.draw=function(){},e.screen_adapter();var i=new Laya.Sprite;return i.name="countdown-mask",i.graphics.drawRect(-e.x,-e.y,Laya.stage.width,Laya.stage.height,"#000000"),i.alpha=.6,e.addChildAt(i,0),e.zOrder=1,e.surPss=new Sprite,e.surPss.y=175,e.addChild(e.surPss),e}return __extends(e,t),e.prototype.screen_adapter=function(){this.y=AdapterManager.offsetY,this.x=AdapterManager.offsetX},e.prototype.show=function(t){console.log(GameManager.isOnline),this.add_events(),this.text_enemy.text=t,this.text_gold.text=PlayerUtility.BuyReliveGold+"",this.btn_share_for_relive.visible=!1,this.btn_pay_for_relive.visible=!1,HelperExtension.ABCSetOffsetX(this.btn_share_for_relive,this.btn_pay_for_relive,this),this.reliveLoopTime=3,this.text_countdown.text=this.reliveLoopTime+"",Laya.stage.addChild(this),Laya.timer.loop(1e3,this,this.loop)},e.prototype.hide=function(){this.remove_events(),Laya.timer.clear(this,this.loop),Laya.stage.removeChild(this),null!=SubDomainMessageManager.layaSharedCanvas&&void 0!=SubDomainMessageManager.layaSharedCanvas&&SubDomainMessageManager.methodCall("setPassVisible",!1)},e.prototype.loop=function(){if(0==--this.reliveLoopTime||GameDataManager.gameState==EGameState.GameOverOrExitGame)return GameManager.isOnline?SurvivalOverView.ins.toShow(this.text_enemy.text,1):(Laya.timer.clear(this,this.on_share_succeed),this.revive_player.call(this)),void this.hide();this.text_countdown.text=this.reliveLoopTime+""},e.prototype.add_events=function(){this.btn_share_for_relive.visible=!1,this.text_skip.on("click",this,this.on_skip_to_revive),this.btn_share_for_relive.on("click",this,this.on_share_for_revive),this.btn_pay_for_relive.on("click",this,this.on_pay_to_revive),this.text_exit.on("click",this,this.on_exit)},e.prototype.remove_events=function(){this.text_skip.off("click",this,this.on_skip_to_revive),this.btn_share_for_relive.off("click",this,this.on_share_for_revive),this.btn_pay_for_relive.off("click",this,this.on_pay_to_revive),this.text_exit.off("click",this,this.on_exit)},e.prototype.on_exit=function(){PlatformAPI.createVideoAd("restart",t=>{t||GameDataManager.addSeeVideoTimes(),GameView.ins.exitView.show()})},e.prototype.on_share_for_revive=function(){PlatformAPI.createVideoAd("revive",t=>{t?this.on_pay_to_revive():(GameDataManager.addSeeVideoTimes(),this.on_share_succeed())})},e.prototype.on_share_succeed=function(){WXUtility.aldSendEvent("复活成功分享"),this.revive_player.call(this),GameManager.PlayerEntity.change_level(),this.hide()},e.prototype.on_share_failed=function(){ShareUtil.shareFailtips()},e.prototype.on_video_for_revive=function(){this.revive_player.call(this),GameManager.PlayerEntity.change_level(),this.hide()},e.prototype.on_pay_to_revive=function(){var t=PlayerUtility.BuyReliveGold;GameManager.isOnline&&(t=500),SyncDataManager.gold<t?NoticeView.instance.show(["金币不足，欢乐转盘得金币哟~"]):(SyncDataManager.gold-=t,GameManager.isOnline?this.revive_player.call(this):(this.revive_player.call(this),GameManager.PlayerEntity.change_level()),this.hide())},e.prototype.on_skip_to_revive=function(){GameManager.PlayerEntity.relive_to_level0(),this.revive_player.call(this),this.hide()},e.prototype.revive_player=function(){GameManager.PlayerEntity.relive(),GameManager.PlayerEntity.isInvincible=!0,DetectManager.Instance.Players.push(GameManager.PlayerEntity),GameManager.mouseController&&GameManager.mouseController.enable(!0)},e.prototype.check_online_relive=function(){},e}(hole.ui.Game.ReliveViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),GrowView=function(t){function e(){var e=t.call(this)||this;return e.offsetX=120,e.offsetY=300,e.x=e.offsetX+AdapterManager.offsetX,e.y=e.offsetY+AdapterManager.offsetY,e}return __extends(e,t),e.prototype.show=function(){this.ani1.play(0,!1),Laya.stage.addChild(this),Laya.timer.once(1e3,this,this.hide)},e.prototype.hide=function(){Laya.stage.removeChild(this)},e}(hole.ui.Game.GrowViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),BonusView=function(t){function e(){var e=t.call(this)||this;return e.offsetX=220,e.offsetY=550,e.x=e.offsetX+AdapterManager.offsetX,e.y=e.offsetY+AdapterManager.offsetY,e}return __extends(e,t),e.prototype.show=function(t){this.text_bonus.text=t,this.ani1.play(0,!1),Laya.stage.addChild(this),Laya.timer.once(1e3,this,this.hide)},e.prototype.hide=function(){Laya.stage.removeChild(this),Laya.Pool.recover("BonusView",this)},e}(hole.ui.Game.BonusViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),CountDownView=function(t){function e(e){var i=t.call(this)||this;return i.OffsetX=133,i.OffsetY=210,i.parentView=e,i.x=i.OffsetX,i.y=i.OffsetY,i.mask_sprite=new Laya.Sprite,i.mask_sprite.name="countdown-mask",i.mask_sprite.graphics.drawRect(-i.OffsetX,-i.OffsetY-AdapterManager.offsetY,Laya.stage.width,Laya.stage.height,"#000000"),i.mask_sprite.alpha=.6,i.mask_sprite.visible=!1,i.addChildAt(i.mask_sprite,0),i}return __extends(e,t),e.prototype.show=function(t){this.parent!=this.parentView&&(this.delayNumber=0,this.parentView.addChild(this),AudioController.play(ESoundType.countdown,6)),t<10&&(this.img_countdown1.skin="res/ui/game/sz_0.png",this.img_countdown2.skin="res/ui/game/sz_"+t+".png",this.ani1.play(0,!1),this.delayNumber++,0==t?(this.box_countdown.visible=!1,this.img_sjd.visible=!0,this.mask_sprite.visible=!0):(this.box_countdown.visible=!0,this.img_sjd.visible=!1,this.mask_sprite.visible=!1))},e.prototype.hide=function(){this.parentView.removeChild(this)},e}(hole.ui.Game.CountDownViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),HoleAteView=function(t){function e(){var e=t.call(this)||this;return e.offsetX=60,e.offsetY=550,e.x=e.offsetX+AdapterManager.offsetX,e.y=e.offsetY+AdapterManager.offsetY,e}return __extends(e,t),e.prototype.show=function(t){this.text_ate.text=t,this.ani1.play(0,!1),Laya.stage.addChild(this),setTimeout(this.hide.bind(this),800)},e.prototype.hide=function(){this.text_ate.color="#ffcc00",Laya.stage.removeChild(this),Laya.Pool.recover("HoleAteView",this)},e}(hole.ui.Game.HoleAteViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),KillTipView=function(t){function e(){var e=t.call(this)||this;return e.offsetX=0,e.offsetY=280,e.x=e.offsetX+AdapterManager.offsetX,e.y=e.offsetY+AdapterManager.offsetY,e}return __extends(e,t),e.prototype.show=function(t){t=t>8?8:t;var e=Laya.loader.getRes("res/ui/game/"+t+"lian.png");this.img_tip.skin=e.url,this.img_tip.x=(321-e.width)/2,this.img_tip.y=(151-e.height)/2,Laya.stage.addChild(this),this.KillTipMove.play(0,!1)},e.prototype.hide=function(){Laya.stage.removeChild(this)},e}(hole.ui.Game.KillTipViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),BroadcastView=function(t){function e(){var e=t.call(this)||this;return e.offsetX=141,e.offsetY=220,e.isAlreadyShow=!1,e.x=e.offsetX+AdapterManager.offsetX,e.y=e.offsetY+AdapterManager.offsetY,e.broadcastQueue=new Array,e.killTipView=new KillTipView,e}return __extends(e,t),e.prototype.push=function(t){if(t.bigIsLocal){var e=this.broadcastQueue.shift();null!=e?this.broadcastQueue.unshift(e,t):this.broadcastQueue.unshift(t)}else this.broadcastQueue.push(t);1==this.broadcastQueue.length&&this.show()},e.prototype.show=function(){var t=this.broadcastQueue[0];if(this.img_big.skin=t.bigUrl,this.img_small.skin=t.smallUrl,t.bigKill>1&&(this.killTipView.show(t.bigKill),t.bigIsLocal)){var e=t.bigKill>8?8:t.bigKill;AudioController.play_kill(e)}this.isAlreadyShow||(this.isAlreadyShow=!0,Laya.stage.addChildAt(this,1)),this.ani1.play(0,!1),Laya.timer.once(2e3,this,this.hide)},e.prototype.hide=function(){this.isAlreadyShow=!1,Laya.stage.removeChild(this),this.killTipView&&this.killTipView.displayedInStage&&this.killTipView.hide(),this.broadcastQueue.shift(),this.broadcastQueue.length>0&&GameDataManager.gameState==EGameState.InGame&&this.show()},e.prototype.recover=function(){for(var t=this.broadcastQueue.length;t--;){var e=this.broadcastQueue.pop();Laya.Pool.recover("BroadcastNode",e)}},e}(hole.ui.Game.BroadcastViewUI),BroadcastNode=function(){function t(){}return t.prototype.init=function(t,e){this.bigUrl=t.avatarUrl,this.smallUrl=e.avatarUrl,this.bigKill=t.kill,this.bigIsLocal=t.isLocalPlayer},t}(),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),NearPlayerView=function(t){function e(){var e=t.call(this)||this;return e.x+=(Laya.stage.width-e.width)/2,e.y+=(Laya.stage.height-e.height)/2,e}return __extends(e,t),e.prototype.show=function(t){this.nearPlayer=t,this.localPlayer=GameManager.PlayerEntity,this.text_name.text=t.name,this.onLoop(),Laya.stage.addChildAt(this,1),Laya.timer.frameLoop(1,this,this.onLoop)},e.prototype.onLoop=function(){if(!this.nearPlayer||!this.localPlayer||this.nearPlayer.destroyed||!this.nearPlayer.isDetect||this.localPlayer.destroyed||!this.nearPlayer.isAlive)return Laya.timer.clear(this,this.onLoop),void this.hide();var t=this.localPlayer.transform.position.x-this.nearPlayer.transform.position.x,e=this.localPlayer.transform.position.z-this.nearPlayer.transform.position.z,i=0;switch(CameraController.ECameraLookType){case ECameraLookType.E:this.text_name.rotation=t<0?270:90,i=90;break;case ECameraLookType.S:this.text_name.rotation=e<0?270:90;break;case ECameraLookType.W:this.text_name.rotation=t>0?270:90,i=270;break;case ECameraLookType.N:this.text_name.rotation=e>0?270:90,i=180}this.img_xiezi.rotation=this.text_name.rotation,0==this.nearPlayer.MBFeature.speedMuti?this.img_xiezi.visible=!1:(this.img_xiezi.visible=!0,this.nearPlayer.MBFeature.speedMuti>0@this.img_xiezi.skin="res/ui/game/xiezi.png":this.img_xiezi.skin="res/ui/game/xiezi2.png");var n=Math.atan(Number(e.toFixed(2))/Number(t.toFixed(2)))*HelperExtension.Rad2Deg+i;t>0&&(n+=180),this.rotation=n},e.prototype.hide=function(){this.removeSelf(),this.nearPlayer=null,this.localPlayer=null,Laya.Pool.recover("NearPlayerView",this)},e}(hole.ui.Game.NearPlayerViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),GetGoldView=function(t){function e(){var e=t.call(this)||this;return e.popupCenter=!1,e.x=AdapterManager.offsetX,e.y=AdapterManager.offsetY,e.bgMask.graphics.drawRect(-AdapterManager.offsetX,-AdapterManager.offsetY,Laya.stage.width,Laya.stage.height,"#000000"),e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.toShow=function(t,e,i){switch(this.cunrrentType=i,this.hbox_container.width=225,this.box_img.visible=!1,i){case ERewardType.GetGold_Login:this.img_title.skin="res/ui/common/getPrize.png",this.img_reward.skin="res/ui/common/yiduijinbi2.png",this.lbGold.text="+"+t;break;case ERewardType.GetGold_Double:this.hbox_container.width=450,this.box_img.visible=!0,this.img_skin.skin=SkinManager.getSkinUIUrlByID(GameDataManager.prevUseSkinID),this.img_reward.skin="res/ui/common/yiduijinbi2.png",this.lbGold.text="+"+t,Laya.timer.once(5e3,this,this.close);break;case ERewardType.GetGold_Double_S:this.img_reward.skin="res/ui/common/yiduijinbi2.png",this.lbGold.text="+"+t,Laya.timer.once(5e3,this,this.close);break;case ERewardType.GetSkin_Login:this.img_title.skin="res/ui/common/getPrize.png",this.img_reward.skin="res/skinUI/"+e.iconname+".png",this.lbGold.text=-1==t?" 永 久 ":" "+t+" 天 "}this.popup()},e.prototype.onOpened=function(){this.bgMask.on(LayaEvent.CLICK,this,this.close),this.bg.rotation=0,Laya.timer.frameLoop(1,this,this.onTimer)},e.prototype.onTimer=function(){this.bg.rotation++},e.prototype.onClosed=function(){this.bgMask.off(LayaEvent.CLICK,this,this.close),Laya.timer.clear(this,this.close),Laya.timer.clear(this,this.onTimer),this.x=AdapterManager.offsetX,this.y=AdapterManager.offsetY,this.cunrrentType==ERewardType.GetSkin_Login||this.cunrrentType==ERewardType.GetGold_Login?Laya.timer.once(100,LotteryView.ins,LotteryView.ins.show):this.cunrrentType==ERewardType.GetGold_Double&&(GameDataManager.isSeeVideoAtGameOver=!0)},e}(hole.ui.Game.GetGoldViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),FlyingShoesView=function(t){function e(e){var i=t.call(this)||this;return i.OffsetX=10,i.OffsetY=400,i.parentView=e,i}return __extends(e,t),e.prototype.show=function(){this.shoesCost.text=GameSetting.instance.ShoesCostGold+"",ConfigUtility.IsSafeVersion&&("1"!=Laya.LocalStorage.getItem(EnumKey.SHOW_FLYSHOES_FREE_GET)?(this.img_lingqu.visible=!0,this.priceLab.visible=!1):(this.img_lingqu.visible=!1,ConfigUtility.getRewardType==EGetRewardType.video?this.priceLab.visible=!0:this.priceLab.visible=!1),this.x=this.OffsetX,this.y=this.OffsetY,this.img_help.visible=!0,this.img_shoes.alpha=1,this.ani1.play(0,!1),this.shake.play(0,!0),this.parentView.addChild(this),this.add_events())},e.prototype.add_events=function(){this.img_shoes.on("click",this,this.on_flying_shoes),this.img_help.on("click",this,this.on_flying_shoes),this.img_lingqu.on("click",this,this.on_flying_shoes),this.img_lingqu_gold.on("click",this,this.on_flying_shoes)},e.prototype.remove_events=function(){this.img_shoes.off("click",this,this.on_flying_shoes),this.img_help.off("click",this,this.on_flying_shoes),this.img_lingqu.off("click",this,this.on_flying_shoes),this.img_lingqu_gold.off("click",this,this.on_flying_shoes)},e.prototype.hide=function(){this.removeSelf(),this.remove_events(),this.flash.stop(),Laya.timer.clearAll(this)},e.prototype.on_flying_shoes=function(){if("1"!=Laya.LocalStorage.getItem(EnumKey.SHOW_FLYSHOES_FREE_GET))Laya.LocalStorage.setItem(EnumKey.SHOW_FLYSHOES_FREE_GET,"1"),NoticeView.instance.show(["成功使用飞鞋，移速+40%"]),e.is_FlyingShoes=!0,GameManager.PlayerEntity.set_speed_feature(GameManager.PlayerEntity.currentLevel.speed),this.x=100-this.parentView.text_player_name.x,this.y=400,this.img_help.visible=!1,this.shake.stop(),this.img_lingqu.visible=!1,this.beginFlying(20),this.remove_events();else if(ConfigUtility.getRewardType==EGetRewardType.video){var t=GameSetting.instance.ShoesCostGold;if(SyncDataManager.gold<t)return void NoticeView.instance.show(["金币不足，欢乐转盘得金币哟~"]);SyncDataManager.gold-=t,this.fly()}else{var i=new ShareInfo;i.shareId=EnumShareId.CLICK_GAME_FLYSHOE,i.successFunc=new CallBackFunc(this,this.on_share_succeed),i.failFunc=new CallBackFunc(this,this.on_share_failed),ShareUtil.shareGameByShareInfo(i)}},e.prototype.on_share_succeed=function(){WXUtility.aldSendEvent("飞鞋成功分享"),this.fly()},e.prototype.fly=function(){NoticeView.instance.show(["成功使用飞鞋，移速+40%"]),e.is_FlyingShoes=!0,GameManager.PlayerEntity.set_speed_feature(GameManager.PlayerEntity.currentLevel.speed),this.x=100-this.parentView.text_player_name.x,this.y=400,this.img_help.visible=!1,this.shake.stop(),this.img_lingqu.visible=!1,this.priceLab.visible=!1,this.beginFlying(20),this.remove_events()},e.prototype.beginFlying=function(t){5==--t&&this.flash.play(0,!0),t>0?Laya.timer.once(1e3,this,this.beginFlying,[t]):0==t&&(e.is_FlyingShoes=!1,GameManager.PlayerEntity.set_speed_feature(GameManager.PlayerEntity.currentLevel.speed),this.hide())},e.prototype.on_share_failed=function(){ShareUtil.shareFailtips()},e.is_FlyingShoes=!1,e}(hole.ui.Game.FlyingShoesViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ItemGrid=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setIcon=function(t){var e=ItemConfig.instance.getDataById(t);this.icon.skin=e.iconUrl},Object.defineProperty(e.prototype,"count",{set:function(t){this.lbCount.text=t+""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"day",{set:function(t){this.lbCount.text=t+""},enumerable:!0,configurable:!0}),e}(hole.ui.Game.ItemGridUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),EatBagView=function(t){function e(){var e=t.call(this)||this;return e.x=(Laya.stage.width-e.width)/2,e}return __extends(e,t),e.prototype.show=function(t,i){this.y=AdapterManager.offsetY+(Laya.stage.height-this.height)/2+100,this.lb_name.text=HelperExtension.shiftName(t);var n=MysteriousBagCfg.instance.allMysteriousBag.get(i);n&&(this.lb_tips.text=n.tips,n.changeValue>=0?this.lb_tips.color="#00cc00":this.lb_tips.color="#cc0000"),Laya.stage.addChild(this),Laya.Tween.to(this,{y:this.y-150+e.count*this.height},2e3,Laya.Ease.strongOut,Handler.create(this,this.hide),0,!1,!0),e.count++},e.prototype.hide=function(){e.count--,Laya.stage.removeChild(this),Laya.Pool.recover("EatBagView",this)},e.count=0,e}(hole.ui.Game.EatBagViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),PromptInterfaceView=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return null==this._ins&&(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.addEvents=function(){this.btn_Left.on(LayaEvent.CLICK,this,this.leftFuc),this.btn_Right.on(LayaEvent.CLICK,this,this.rightFuc)},e.prototype.removeEvent=function(){this.btn_Left.off(LayaEvent.CLICK,this,this.leftFuc),this.btn_Right.off(LayaEvent.CLICK,this,this.rightFuc)},e.prototype.onShow=function(t,e,i,n,r){this.lab_hint.text=i,this.lab_Right.text=e,this.lab_Left.text=t,this.leftFuc=n,this.rightFuc=r,this.addEvents(),this.popup()},e.prototype.hide=function(){this.leftFuc&&this.rightFuc&&this.removeEvent(),this.close()},e.prototype.close=function(e,i){void 0===i&&(i=!0),"side"!==e&&t.prototype.close.call(this)},e}(hole.ui.Game.PromptInterfaceViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),RemoteSense=function(t){function e(){var e=t.call(this)||this;return e.radius=50,e.downPos=new Vector2,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.show=function(t){this.downPos=t,this.x=t.x,this.y=t.y,Laya.stage.addChild(this)},e.prototype.setPos=function(t){this.img_little_circle.x=t.x*this.radius,this.img_little_circle.y=t.y*this.radius},e.prototype.hide=function(){this.img_little_circle.x=0,this.img_little_circle.y=0,this.removeSelf()},e}(hole.ui.Game.RemoteSenseViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),HomeView=function(t){function e(){var e=t.call(this)||this;e.isBeginCanIPlay=!1,e.clickRestart=!1,e.expMask=new Sprite,e.screen_adapter(),e.checkBtnZhuliVisible(),e.btnNovicePrivilege.visible=!GameDataManager.newbieReward,e.btnActivity.visible=!1,e.checkBtnVisible(),e.setSpData();var i=new Sprite;return i.graphics.drawCircle(e.avatar.x-.5,e.avatar.y,(e.avatar.width-4)/2,0),e.avatar.mask=i,e.expMask.graphics.drawRect(0,0,e.jingyantiao.width,e.jingyantiao.height,0),e.jingyantiao.mask=e.expMask,e.timeLine=new Laya.TimeLine,e.timeLine.addLabel("1",0).to(e.btnActivity,{rotation:30},100,null,0).addLabel("2",0).to(e.btnActivity,{rotation:-30},100,null,0).addLabel("3",0).to(e.btnActivity,{rotation:30},100,null,0).addLabel("4",0).to(e.btnActivity,{rotation:-30},100,null,0).addLabel("5",0).to(e.btnActivity,{rotation:30},100,null,0).addLabel("6",0).to(e.btnActivity,{rotation:-30},100,null,0).addLabel("7",0).to(e.btnActivity,{rotation:30},100,null,0).addLabel("8",0).to(e.btnActivity,{rotation:-30},100,null,0).addLabel("9",0).to(e.btnActivity,{rotation:0},100,null,0),e.timeLine.addLabel("1",0).to(e.btnNovicePrivilege,{rotation:30},100,null,0).addLabel("2",0).to(e.btnNovicePrivilege,{rotation:-30},100,null,0).addLabel("3",0).to(e.btnNovicePrivilege,{rotation:30},100,null,0).addLabel("4",0).to(e.btnNovicePrivilege,{rotation:-30},100,null,0).addLabel("5",0).to(e.btnNovicePrivilege,{rotation:30},100,null,0).addLabel("6",0).to(e.btnNovicePrivilege,{rotation:-30},100,null,0).addLabel("7",0).to(e.btnNovicePrivilege,{rotation:30},100,null,0).addLabel("8",0).to(e.btnNovicePrivilege,{rotation:-30},100,null,0).addLabel("9",0).to(e.btnNovicePrivilege,{rotation:0},100,null,0),e}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return null==this._ins&&(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.checkBtnZhuliVisible=function(){this.btnZhuLi.visible=!1},e.prototype.createHelpVideo=function(){ConfigUtility.isShowHowToPlayVideo&&Browser.onWeiXin&&(this.video&&this.video.destroy(),wx.createVideo&&(this.video=wx.createVideo({x:(this.x+this.boxVideo.x+5)*AdapterManager.scaleRadio,y:(this.y+this.boxVideo.y+38)*AdapterManager.scaleRadio,width:190*AdapterManager.scaleRadio,height:190*AdapterManager.scaleRadio,src:HelpVideoView.MP4_URL[1],controls:!1,autoplay:!0,loop:!0}),this.boxVideo.visible=!0))},e.prototype.checkBtnVisible=function(){0==this.btnNovicePrivilege.visible?this.btnActivity.y=this.btnNovicePrivilege.y:this.btnActivity.y=-428},e.prototype.addEvents=function(){this.btnRank.visible=!1,this.img_share.visible=!1,this.btn_start_game.on("click",this,this.on_start_game),this.img_share.on("click",this,this.on_share),this.btnRank.on("click",this,this.on_rank),this.btnSkin.on("click",this,this.on_skin),this.img_mode_select.on("click",this,this.on_mode_select),this.btnActivity.on(LayaEvent.CLICK,this,this.onActivityClick),this.btnInvite.on(LayaEvent.CLICK,this,this.onInvite),this.boxLottery.on(LayaEvent.CLICK,this,this.onLotteryClick),this.btnCloseVideo.on(LayaEvent.CLICK,this,this.onCloseVideo),this.btnNovicePrivilege.on(LayaEvent.CLICK,this,this.onClickNovicePrivilege),this.img_zudui.on(LayaEvent.CLICK,this,this.on_team),this.btnShezhi.on(LayaEvent.CLICK,this,this.onSheZhi),SuggestListView.Instance.addTimer()},e.prototype.removeEvents=function(){this.btn_start_game.off("click",this,this.on_start_game),this.img_share.off("click",this,this.on_share),this.btnRank.off("click",this,this.on_rank),this.btnSkin.off("click",this,this.on_skin),this.img_mode_select.off("click",this,this.on_mode_select),this.btnActivity.off(LayaEvent.CLICK,this,this.onActivityClick),this.btnInvite.off(LayaEvent.CLICK,this,this.onInvite),this.boxLottery.off(LayaEvent.CLICK,this,this.onLotteryClick),this.btnCloseVideo.off(LayaEvent.CLICK,this,this.onCloseVideo),this.btnNovicePrivilege.off(LayaEvent.CLICK,this,this.onClickNovicePrivilege),this.img_zudui.off(LayaEvent.CLICK,this,this.on_team),this.btnShezhi.off(LayaEvent.CLICK,this,this.onSheZhi),SuggestListView.Instance.removeTimer()},e.prototype.onSheZhi=function(){Browser.onWeiXin&&SettingView.Ins.popup()},e.prototype.on_team=function(){WXUtility.point_with_new("进入组队界面",{},ENewPointTpye.ENTER_TEAM_VIEW),TeamPlayView.instance.onShow(),this.onHide(),MainSocket.C2S_CREATE_TEAM()},e.prototype.onCloseVideo=function(){this.video.destroy(),this.video=null,this.boxVideo.removeSelf(),GameDataManager.isShowHelpVideo=!1,Laya.LocalStorage.setItem(EnumKey.NOVICE_CLOSE_VIDEO,"1"),this.setBoxBtnVisible(!0)},e.prototype.onClickNovicePrivilege=function(){WXUtility.pointForNew("*点主界面新手特惠",ENewPointTpye.HOME_NOVICEPRIVILEGE),Laya.LocalStorage.setItem(EnumKey.NOVICE_RED_POINT,TimeUtil.getTimeStr()),this.img_novice_red.visible=!1,NovicePrivilegeView.ins.popup(!0)},e.prototype.onLotteryClick=function(){WXUtility.pointForNew("*点主界面转盘",ENewPointTpye.HOME_LOTTERY),LotteryView.ins.show(!0);var t=TimeUtil.getTimeStr();Laya.LocalStorage.setItem(EnumKey.LOTTERY_RED_POINT,t),this.lotteryRedPoint.visible=!1},e.prototype.onMailBoxClick=function(){},e.prototype.onLogin=function(t){console.log("主页面授权登录按钮点击返回：",t),this.onLogin2(t),this.on_rank()},e.prototype.onLogin2=function(t){!ConfigUtility.userInfo&&t.userInfo&&(MiNi.miniHttpServer.login(),this.showHideLoginBtn2(!1)),ConfigUtility.userInfo=t.userInfo,this.setMyselfInfo()},e.prototype.setMyselfInfo=function(){ConfigUtility.userInfo?(ConfigUtility.userInfo.avatarUrl?this.avatar.skin=ConfigUtility.userInfo.avatarUrl:this.avatar.skin=ConfigUtility.defaultAvatar,this.lbName.text=ConfigUtility.userInfo.nickName?HelperExtension.shiftName(ConfigUtility.userInfo.nickName):""):(this.avatar.skin=ConfigUtility.defaultAvatar,this.lbName.text=HelperExtension.shiftName(ConfigUtility.defaultName))},e.prototype.updateGold=function(){this.lbGold.text=SyncDataManager.gold+""},e.prototype.UpdateHomeData=function(){this.setMyselfInfo(),this.updateGold(),this.img_player_rank.skin="res/ui/common/duanwei_"+RankDataManager.skinUrlNumber+".png";var t=SyncDataManager.score,e=RankDataManager.configIndex,i=RankConfig.config[e].integral;if(e==RankConfig.config.length-1)n=RankConfig.config[e].integral,this.expMask.x=-190,this.text_rank_percent.text=n+"/"+n;else{var n,r=(n=RankConfig.config[e+1].integral)-i,a=t-i,s=a/r;this.expMask.x=190*s-190,this.text_rank_percent.text=a+"/"+r}switch(this.text_rank_class.text=RankConfig.config[e].rankName,this.img_rank_ui.skin="res/ui/common/duanwei_"+RankDataManager.skinUrlNumber+".png",RankDataManager.IsUpgrade&&!GameDataManager.isNewTagEmpty&&(new UserUpgradeView(this).show(),RankDataManager.maxPlayRankID=RankConfig.config[RankDataManager.configIndex].id),this.updateCurSkin(),GameManager.CurrentGameMode){case EGameMode.Classic:this.img_mode.skin="res/ui/home/jingdian.png";break;case EGameMode.Survive:this.img_mode.skin="res/ui/home/shengcun.png"}},e.prototype.updateCurSkin=function(){SkinManager.isUseShiWanSkin?this.img_skin.skin=SkinManager.getSkinUIUrlByID(SkinManager.curUseShiwanID):this.img_skin.skin=SkinManager.getSkinUIUrlByID(SyncDataManager.curSkinId)},e.prototype.playAni=function(){this.ani_kaishi.play(0,!0)},e.prototype.updateUI=function(){RankDataManager.updateRankData(),this.UpdateHomeData(),GameDataManager.set_isGodMode(),HoleAppController.isLoginSever&&GameDataManager.gameState==EGameState.InHome&&e.isFirstPopup&&!this.clickRestart&&(GameDataManager.isNewPlayerPlay&&GameDataManager.isNewPlayer?(ConfigUtility.newPlayerFirstEnterGameShowLoginReward&&GameDataManager.haveLoginReward&&ConfigUtility.IsSafeVersion&&GameDataManager.loginRewardDay_server+1<=SignConfig.instance.length&&LoginRewardView.ins.toShow(),ConfigUtility.newPlayerFirstOnlyShowStart&&(this.box_btn.visible=!1,SuggestListView.Instance.hide(this))):(this.box_btn.visible=!0,this.firstShowView())),this.img_mode_select.visible=GameManager.isOpenOnline&&HoleAppController.isLoginSever},e.prototype.checkRedPoint=function(){var t=TimeUtil.getTimeStr(),e=Laya.LocalStorage.getItem(EnumKey.FRIEND_RED_POINT),i=Laya.LocalStorage.getItem(EnumKey.LOTTERY_RED_POINT),n=Laya.LocalStorage.getItem(EnumKey.NOVICE_RED_POINT);this.friendRedPoint.visible=t!=e,this.lotteryRedPoint.visible=t!=i,this.img_novice_red.visible=t!=n},e.prototype.onShow=function(){SSSGameConfig.setSSSmoregameBtn(this.img_mode),GameDataManager.gameState=EGameState.InHome,this.checkRedPoint(),WXUtility.pointForNew("*进入主界面",ENewPointTpye.ENTER_HOME),this.ani_award.play(0,!0),this.ani_skin.play(0,!0),this.ani_mail.play(0,!0),Laya.timer.once(2e3,this,this.playAni),this.setBoxBtnVisible(!0),EventManager.addEvent(EnumKey.GET_USER_INFO,this,this.setMyselfInfo),EventManager.addEvent(EnumKey.LOGIN_SERVER_SUCCESS,this,this.loginServerSuccess),EventManager.addEvent(EnumKey.SHOW_HIDE_HOME_BTNS,this,this.setBoxBtnVisible),EventManager.addEvent(EnumKey.UPDATE_GOLD,this,this.updateGold),EventManager.addEvent(EnumKey.SYNC_DATA_SUCCESS,this,this.updateUI),this.updateUI(),Laya.stage.addChild(this),Browser.onWeiXin&&(SuggestListView.Instance.show(this),this.box_btn.visible=!0),AdManager.show(AdManager.HOME_PAGE_AD,EnumAdIId.HOME_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio),AdManager.hide("",!1,!0),this.curFrame=0,this.btnActivity.rotation=0,Laya.timer.frameLoop(1,this,this.onFrameLoop),this.redPointCheck(),this.addEvents(),0==this.btnZhuLi.visible&&(this.friendRedPoint.visible=!1,this.ani_mail.visible=!1)},e.prototype.firstShowView=function(t){if(void 0===t&&(t=!1),HoleAppController.isLoginSever){if(GameDataManager.gameState==EGameState.InHome)if(e.isFirstPopup=!1,GameDataManager.haveLoginReward&&ConfigUtility.IsSafeVersion&&GameDataManager.loginRewardDay_server+1<=SignConfig.instance.length)LoginRewardView.ins.toShow();else{var i=TimeUtil.getTimeStr(),n=Laya.LocalStorage.getItem(EnumKey.AUTO_SHOW_NOVIVE);Number(Laya.LocalStorage.getItem(EnumKey.AUTO_SHOW_NOVICE_COUNT)),GameDataManager.haveLoginReward||i==n||GameDataManager.newbieReward?this.toShowLotteryView():(NovicePrivilegeView.ins.popup(),NovicePrivilegeView.ins.autoShowNovice=!0,Laya.LocalStorage.setItem(EnumKey.AUTO_SHOW_NOVIVE,i))}}else t?this.toShowLotteryView():Laya.timer.once(1e3,this,this.firstShowView,[!0])},e.prototype.toShowLotteryView=function(){GameDataManager.gameState==EGameState.InHome&&SyncDataManager.getDailyData(EnumDailyID.LOTTERY)<GameSetting.instance.maxRollTimes&&(LotteryView.ins.resizeAD(),WXUtility.pointForNew("*弹出转盘",ENewPointTpye.ENTER_LOTTERY),LotteryView.ins.show())},e.prototype.redPointCheck=function(){for(var t=SyncDataManager.skinData,e=[],i=0;i<t.length;i++){var n=t[i],r=SkinConfig.getDataById(n.skinId);r&&n.finishCount>=r.conditionalValue&&(-1==n.gainTime||n.gainTime>0&&n.gainTime>=Laya.Browser.now())&&e.push(n.skinId+"")}var a=GameDataManager.activeSkinIDs.length;0==a?(this.imgRedPointSkin.visible=!1,GameDataManager.setActiveSkinIDs(e)):this.imgRedPointSkin.visible=e.length!=a,this.imgRedPointSkin.visible=SkinManager.localALreadyShiWanSkin.keys.length<5},e.prototype.onFrameLoop=function(){this.boxLottery.visible&&this.imgArrow.rotation++,this.curFrame++,this.curFrame%601==0&&this.timeLine.play(0,!1)},e.prototype.showHideLoginBtn2=function(t){Laya.Browser.onWeiXin&&this._loginBtn2&&(t?ConfigUtility.userInfo?this._loginBtn2.hide():this._loginBtn2.show():this._loginBtn2&&this._loginBtn2.hide())},e.prototype.onWxLoginSucceed=function(t){console.log("主页面微信登录成功：",t)},e.prototype.onDuanWeiClick=function(){DuanWeiView.ins.popup(),this.setBoxBtnVisible(!1)},e.prototype.onActivityClick=function(){ActivityView.toShow(ActivityManager.openedIdAry[0]),WXUtility.aldSendEvent("打开限时活动")},e.prototype.onInvite=function(){WXUtility.pointForNew("*点主界面免费金币",ENewPointTpye.HOME_FREEGOLD),InviteView.toShow();var t=TimeUtil.getTimeStr();Laya.LocalStorage.setItem(EnumKey.INVITE_RED_POINT,t)},e.prototype.loginServerSuccess=function(){if(ActivityManager.openedIdAry&&ActivityManager.openedIdAry.length>0&&ConfigUtility.IsSafeVersion){var t=ActivityManager.openedIdAry[0];if(!ActivityConfig.instance.getDataById(t))return void(this.btnActivity.visible=!1);console.log("活动开启中，活动ID=",t),this.btnActivity.visible=!0,this.btnActivity.skin="res/ui/home/active"+t+".png",2==ActivityConfig.instance.getDataById(t).type&&(this.btnActivity.skin="res/ui/home/active27.png")}else this.btnActivity.visible=!1;this.img_mode_select.visible=GameManager.isOpenOnline&&HoleAppController.isLoginSever},e.prototype.setSpData=function(){},e.prototype.onHide=function(){this.removeEvents(),Laya.timer.clear(this,this.onFrameLoop),Laya.stage.removeChild(this),this.setBoxBtnVisible(!1),EventManager.removeEvent(EnumKey.GET_USER_INFO,this.setMyselfInfo),EventManager.removeEvent(EnumKey.LOGIN_SERVER_SUCCESS,this.loginServerSuccess),EventManager.removeEvent(EnumKey.SHOW_HIDE_HOME_BTNS,this.setBoxBtnVisible),EventManager.removeEvent(EnumKey.UPDATE_GOLD,this.updateGold),EventManager.removeEvent(EnumKey.SYNC_DATA_SUCCESS,this.updateUI),AdManager.hide("",!1,!0),this.ani_award.stop(),this.ani_kaishi.stop(),this.ani_skin.stop()},e.prototype.onShowHideLoginBtn1=function(t){t?(AdManager.resize(EnumAdIId.HOME_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio),AdManager.hide(AdManager.HOME_PAGE_AD,!1,!0)):AdManager.hide(AdManager.HOME_PAGE_AD,!1,!0)},e.prototype.screen_adapter=function(){this.y=AdapterManager.offsetY,this.x=AdapterManager.offsetX,0==this.x&&0==this.y||(this.img_background.size(Laya.Browser.clientWidth/AdapterManager.designScreenRadio,Laya.Browser.clientHeight/AdapterManager.designScreenRadio),this.img_background.y=-this.y,this.img_background.x=-this.x)},e.prototype.on_share=function(){Laya.Browser.onWeiXin&&(ShareUtil.sharegame(EnumShareId.SHARE_homePage),WXUtility.pointForNew("*点主界面分享",ENewPointTpye.HOME_SHARE))},e.prototype.on_zhuli=function(){WXUtility.pointForNew("*点主界面免费皮肤",ENewPointTpye.HOME_FREESKIN),this.setBoxBtnVisible(!1),FriendHelpView.instance.toShow(!1,!0);var t=TimeUtil.getTimeStr();Laya.LocalStorage.setItem(EnumKey.FRIEND_RED_POINT,t),this.friendRedPoint.visible=!1},e.prototype.on_skin=function(){if(WXUtility.pointForNew("*点击主界面皮肤",ENewPointTpye.HOME_SKIN),this.setBoxBtnVisible(!1),this.skinView||(this.skinView=new SkinSelectView(this)),this.skinView.show(),this.imgRedPointSkin.visible){this.imgRedPointSkin.visible=!1;for(var t=SyncDataManager.skinData,e=[],i=0;i<t.length;i++){var n=t[i],r=SkinConfig.getDataById(n.skinId);n.finishCount>=r.conditionalValue&&(-1==n.gainTime||n.gainTime>0&&n.gainTime>=Laya.Browser.now())&&e.push(n.skinId+"")}GameDataManager.setActiveSkinIDs(e)}},e.prototype.on_skin_select_over=function(){this.setBoxBtnVisible(!0),this.updateCurSkin()},e.prototype.on_rank=function(){HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.RANK)},e.prototype.on_mode_select=function(){HoleAppController.isLoginSever?(WXUtility.point_with_new("点击游戏模式",{type:"成功"},ENewPointTpye.CLICK_GAME_MODE),this.setBoxBtnVisible(!1),null==this.modeView&&(this.modeView=new ModeSelectView(this)),this.modeView.show()):(WXUtility.point_with_new("点击游戏模式",{type:"失败"},ENewPointTpye.CLICK_GAME_MODE),NoticeView.instance.show(["网络出现了点问题，请重启再试一次"]))},e.prototype.on_mode_select_over=function(t){null!=t&&(t==EGameMode.Survive?(this.img_mode.skin="res/ui/home/shengcun.png",GameManager.CurrentGameMode=EGameMode.Survive,WXUtility.point_with_new("切换吃鸡模式",{},ENewPointTpye.TO_SURVIVE_MODE)):t==EGameMode.Classic&&(this.img_mode.skin="res/ui/home/jingdian.png",GameManager.CurrentGameMode=EGameMode.Classic,WXUtility.point_with_new("切换经典模式",{},ENewPointTpye.TO_CLASSIC_MODE))),this.setBoxBtnVisible(!0)},e.prototype.on_user_upgrade_over=function(){this.box_btn.visible=!0},e.prototype.setClickStartTime=function(){var t=TimeUtil.getTimeStr();Laya.LocalStorage.setItem(EnumKey.CLICK_START_GAME,t)},e.prototype.on_start_game=function(t){if(GameManager.isOnline)this.on_team();else{WXUtility.pointForNew("*点击开始游戏",ENewPointTpye.HOME_START_GAME),WXUtility.aldSendEvent("开始游戏"),e.Ins.clickRestart=!1,e.Ins.setClickStartTime();var i=SkinManager.getAllCanShiYongSkins(),n=Laya.LocalStorage.getItem(EnumKey.SHI_WAN_HINT_TIME),r=TimeUtil.getTimeStr(),a=!1;if(SkinManager.localALreadyShiWanSkin.keys.length<20)for(var s=0;s<i.length;s++)if(null!=i[s]){a=!0;break}if(a&&n!=r)return this.setBoxBtnVisible(!1),void ShiWanView.ins.popup(!0);this.startGame()}},e.prototype.startGame=function(){SceneManager.judge_change_scene(),GameDataManager.isGetLuckyLihe=!1,MatchView.Instance.show(),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.HOME),SkinManager.judge_isuse_shiwan_skin(),FriendHelpView.instance.isShiWan=!1},e.prototype.setBoxBtnVisible=function(t){GameDataManager.isShowHelpVideo&&(t?this.createHelpVideo():Browser.onWeiXin&&(this.boxVideo.visible=!1,this.video&&(this.video.destroy(),this.video=null))),this.showHideLoginBtn2(t),this.onShowHideLoginBtn1(t)},e.isFirstPopup=!0,e}(hole.ui.Home.HomePageUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ModeSelectView=function(t){function e(e){var i=t.call(this)||this;return i.OffsetX=0,i.OffsetY=618,i.parentView=e,i.x=i.OffsetX,i.y=i.OffsetY,i}return __extends(e,t),e.prototype.add_events=function(){this.btn_close.on("click",this,this.on_close),this.btn_classic.on("click",this,this.on_classic),this.btn_survive.on("click",this,this.on_survive)},e.prototype.remove_events=function(){this.btn_close.off("click",this,this.on_close),this.btn_classic.off("click",this,this.on_classic),this.btn_survive.off("click",this,this.on_survive)},e.prototype.show=function(){this.add_events(),this.parentView.addChild(this)},e.prototype.on_close=function(){this.parent.removeChild(this),this.remove_events(),this.parentView.on_mode_select_over()},e.prototype.on_classic=function(){this.on_close(),this.parentView.on_mode_select_over(EGameMode.Classic)},e.prototype.on_survive=function(){this.on_close(),this.parentView.on_mode_select_over(EGameMode.Survive)},e}(hole.ui.Home.ModeSelectViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),SkinSelectView=function(t){function e(i){var n=t.call(this)||this;return n.scollBarValue=0,n.firstIndex=0,n.parentView=i,e.Ins=n,n.bg.graphics.drawRect(-AdapterManager.offsetX-n.parentView.x,-AdapterManager.offsetY-n.parentView.y,Laya.stage.width+500,Laya.stage.height+500,"#000000"),n.x=(Laya.stage.width-n.width)/2-n.parentView.x,n.y=(Laya.stage.height-n.height)/2-n.parentView.y,n.init_skin_list(),n.tab.selectHandler=new Handler(n,n.onTabClick),n.onTabClick(0),n}return __extends(e,t),e.prototype.init_skin_list=function(){this.list.itemRender=SkinItem,this.list.vScrollBarSkin="",this.list.selectEnable=!1,this.list.renderHandler=new Handler(this,this.renderHandler),this.addChild(this.list)},e.prototype.onTabClick=function(t){for(var e=SkinConfig.getDataByQuality(t),i=0;i<e.length;i++)(!e[i].showSkin||e[i].isShield&&!ConfigUtility.IsSafeVersion)&&(e.splice(i,1),i--);this.list.array=e,this.list.scrollTo(0)},e.prototype.renderHandler=function(t,e){t.setData(t.dataSource,e)},e.prototype.selectHandler=function(t){},e.prototype.add_events=function(){this.btnClose.on("click",this,this.on_close),EventManager.addEvent(EnumKey.UPDATE_SKIN_LIST,this,this.onBuySkin)},e.prototype.remove_events=function(){this.btnClose.off("click",this,this.on_close),EventManager.removeEvent(EnumKey.UPDATE_SKIN_LIST,this.onBuySkin)},e.prototype.onBuySkin=function(){this.list.refresh()},e.prototype.show=function(){WXUtility.aldSendEvent("打开皮肤"),this.add_events(),this.parentView.addChild(this),this.tab.selectedIndex=0,this.list.refresh(),AdManager.resize(EnumAdIId.SKIN_VIEW,(this.y+this.ad.y+this.parentView.y)*AdapterManager.scaleRadio)},e.prototype.hide=function(){this.parentView.removeChild(this),this.remove_events()},e.prototype.on_close=function(){this.hide(),this.parentView.on_skin_select_over()},e}(hole.ui.Home.SkinSelectViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),UserUpgradeView=function(t){function e(e){var i=t.call(this)||this;i.OffsetX=0,i.OffsetY=313,i.parentView=e,i.x=i.OffsetX,i.y=i.OffsetY,i.add_events();var n=new Laya.Sprite;return n.name="upgrade-mask",n.graphics.drawRect(-AdapterManager.offsetX-i.OffsetX,-AdapterManager.offsetY-i.OffsetY,Laya.stage.width,Laya.stage.height,"#000000"),n.alpha=.9,i.addChildAt(n,0),i}return __extends(e,t),e.prototype.add_events=function(){this.btn_confirm.on("click",this,this.on_confirm)},e.prototype.remove_events=function(){this.btn_confirm.off("click",this,this.on_confirm)},e.prototype.show=function(){if(this.img_grade.skin="res/ui/common/duanwei_"+RankDataManager.skinUrlNumber+".png",this.text_grade.text=RankConfig.config[RankDataManager.configIndex].rankName,RankDataManager.isHasBeenAwarded)this.text_already_grade.visible=!0,this.box_award.visible=!1;else{this.text_already_grade.visible=!1,this.box_award.visible=!0;var t=RankConfig.config[RankDataManager.configIndex].upgradeCoin;this.text_gold.text=t+"",SyncDataManager.gold+=t}this.parentView.addChild(this),AudioController.play(ESoundType.hole_upgrade),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1)},e.prototype.hide=function(){EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0),this.parentView.removeChild(this),this.remove_events(),this.destroy(!0)},e.prototype.on_confirm=function(){this.hide(),this.parentView.on_user_upgrade_over()},e}(hole.ui.Home.UserUpgradeUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),SkinItem=function(t){function e(){var e=t.call(this)||this;return e.onShareSuccess=function(){NoticeView.instance.show(["分享成功"]),e.set_ShiWan()},e.btnApply.on(LayaEvent.CLICK,e,e.onApply),e.boxGold.on(LayaEvent.CLICK,e,e.onBuy),e.boxChip.on(LayaEvent.CLICK,e,e.onExchange),e.img_shiwan.on(LayaEvent.CLICK,e,e.on_seeVideo_for_skin),e.boxVideo.on(LayaEvent.CLICK,e,e.seeVideo_get_skin),e}return __extends(e,t),Object.defineProperty(e.prototype,"isShiwaning",{get:function(){return!(!SkinManager.isUseShiWanSkin||this._config.id!=SkinManager.curUseShiwanID)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canIShiwan",{get:function(){return null!=SkinManager.allShiWanSkin.get(this._config.id)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAlreadyShiwan",{get:function(){return SkinManager.localALreadyShiWanSkin.get(this._config.id)>=GameSetting.instance.SkinDemoTimes},enumerable:!0,configurable:!0}),e.prototype.set_ShiWan=function(){WXUtility.pointForNew("*点皮肤商城试玩",ENewPointTpye.SKIN_STORE_SHIWAN),SkinManager.add_shiwan_skin(this._config.id),EventManager.dispatchEvent(EnumKey.UPDATE_SKIN_LIST),this.onApply()},e.prototype.seeVideo_get_skin=function(){Laya.Browser.onWeiXin?(RewardVideoManager.show(EnumShareId.LOTTERY_VIDEO,this.seeVideoGetSkinSuc.bind(this),this.seeVideoGetSkinErr.bind(this),"要观看完视频哦~"),WXUtility.aldSendEvent("皮肤界面看视频")):this.seeVideoGetSkinSuc()},e.prototype.seeVideoGetSkinSuc=function(t){if(t)return PlatformAPI.showToast({title:"No video to watch, please try again later."});WXUtility.aldSendEvent("皮肤界面看视频成功"),NoticeView.instance.show(["观看视频成功，皮肤进度增加"]),SkinManager.setSkinData_video(this._config.id,1),SkinSelectView.Ins.onBuySkin()},e.prototype.seeVideoGetSkinErr=function(){this.on_share_for_skin()},e.prototype.onApply=function(){this.canIShiwan?(SkinManager.curUseShiwanID=this._config.id,SkinManager.isUseShiWanSkin=!0,EventManager.dispatchEvent(EnumKey.UPDATE_SKIN_LIST)):(SkinManager.isUseShiWanSkin=!1,SyncDataManager.curSkinId=this._config.id,EventManager.dispatchEvent(EnumKey.UPDATE_SKIN_LIST))},e.prototype.onBuy=function(){var t=this._config.skinValue.split(":");if(t.length>=2){var e=Number(t[1]);SyncDataManager.gold>=e?(SyncDataManager.gold-=e,SkinManager.buySkin(this._config.id),PlatfromKit.showToast("Purchase success"),EventManager.dispatchEvent(EnumKey.UPDATE_SKIN_LIST)):PlatfromKit.showToast("Gold inadequate")}},e.prototype.on_seeVideo_for_skin=function(){switch(SkinManager.judge_the_skin(this._config.id)){case 0:NoticeView.instance.show(["每个皮肤每天只能试玩一次！"]);break;case 1:NoticeView.instance.show(["该皮肤已经可以试玩了"]);break;case 2:Laya.Browser.onWeiXin?RewardVideoManager.show(EnumShareId.SHIWAN_SHIN_VIDEO,this.onSeeVideoComplete.bind(this),this.onSeeVideoError.bind(this),"广告未播放完毕，无法获得奖励"):this.onSeeVideoComplete();break;case 3:NoticeView.instance.show(["每天最多试玩5个皮肤"])}},e.prototype.onSeeVideoComplete=function(t){if(t)return PlatformAPI.showToast({title:"No video to watch, please try again later."});NoticeView.instance.show(["该皮肤已经可以试玩了"]),WXUtility.aldSendEvent("皮肤界面试玩"),this.set_ShiWan()},e.prototype.onSeeVideoError=function(){this.on_share_for_skin()},e.prototype.on_share_for_skin=function(){var t=new ShareInfo;t.shareId=EnumShareId.LOTTERY_SHARE,t.successFunc=new CallBackFunc(this,this.onShareSuccess),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.onShareFail=function(){ShareUtil.shareFailtips()},e.prototype.onExchange=function(){var t=this._config.skinValue.split(":");if(t.length>=2){var e=SyncDataManager.getChipData(Number(t[0])),i=Number(t[1]);e>=i?(e-=i,SyncDataManager.setChipData(Number(t[0]),e),SkinManager.buySkin(this._config.id),PlatfromKit.showToast("Exchange success"),EventManager.dispatchEvent(EnumKey.UPDATE_SKIN_LIST)):PlatfromKit.showToast("Insufficient fragmentation")}},e.prototype.setData=function(t,e){this._config=t;var i=1==t.openDemo&&!this.isAlreadyShiwan;if(t){var n="";if(this.skinNameLab.text=t.name,this.hideAllBtns(),this.bg.skin="res/ui/skin/qualityBg"+t.quality+".png",this.img_shiwan.visible=!1,0==t.obtainCondition)this.imgSkin.skin=SkinManager.getSkinUIUrlByID(t.id),n="已拥有",this.lbStatus.color="#75ffc6",this.lbDesc.text=this.getSkinDesc(t.skinAdd,t.skinAddValue),SkinManager.isUseShiWanSkin||SyncDataManager.curSkinId!=t.id?this.btnApply.visible=!0:this.boxSelect.visible=!0;else{var r=SkinManager.getSkinData(t.id);if(r&&(-1==r.gainTime||r.finishCount>=t.conditionalValue)){if(r.gainTime>0){var a=Laya.Browser.now(),s=Math.floor((r.gainTime-a)/36e5);s<0&&(s=0),n=s>=24?"Owned(remaining"+Math.round(s/24)+"days)":"Owned(remaining"+s+"hours)"}else n="已拥有";this.lbStatus.color="#75ffc6",this.lbDesc.text=this.getSkinDesc(t.skinAdd,t.skinAddValue),this.imgSkin.skin=SkinManager.getSkinUIUrlByID(t.id),SyncDataManager.curSkinId==t.id?this.boxSelect.visible=!0:this.btnApply.visible=!0}else{i&&10!=t.obtainCondition&&(this.img_shiwan.visible=!0),this.imgSkin.skin=SkinManager.getSkinUIUrlByID(t.id);var o=r?r.finishCount:0;if(n=5==t.obtainCondition||4==t.obtainCondition||6==t.obtainCondition?"Not owned":"Not owned("+o+"/"+t.conditionalValue+")",this.lbStatus.color="#33315b",this.lbDesc.text=this.getSkinCase(t.obtainCondition,t.conditionalValue),6==t.obtainCondition){this.boxChip.visible=!0;var l=t.skinValue.split(":"),h=SyncDataManager.getChipData(Number(l[0])),c=Number(l[1]);this.lbChip.text=h>=c?"可兑换":h+"/"+c}else if(10==t.obtainCondition)this.boxVideo.visible=!0;else if((l=t.skinValue.split(":")).length>=2){this.boxGold.visible=!0;var u=t.skinValue.split(":");this.lbCostGold.text=u[1]}}}this.lbStatus.text=n,this.visible=!0}else this.visible=!1;t&&(this.canIShiwan&&(this.hideAllBtns(),this.btnApply.visible=!0),SkinManager.isUseShiWanSkin&&(this._config.id==SyncDataManager.curSkinId?(this.boxSelect.visible=!1,this.btnApply.visible=!0):this._config.id==SkinManager.curUseShiwanID&&(this.boxSelect.visible=!0,this.btnApply.visible=!1)),this.boxChip.visible||this.boxGold.visible||this.btnApply.visible||this.boxSelect.visible||this.boxVideo.visible?this.lb_skinName.visible=!1:(this.lb_skinName.visible=!0,this.lb_skinName.text=t.name))},e.prototype.hideAllBtns=function(){this.btnApply.visible=!1,this.boxChip.visible=!1,this.boxGold.visible=!1,this.boxSelect.visible=!1,this.boxVideo.visible=!1},e.prototype.getSkinCase=function(t,e){return 0==t?"初始拥有":1==t?"Accumulative landing "+e+" days":2==t?"Classic mode first "+e+" times":3==t?"Shared Share "+e+" times":4==t?"活动获得":5==t?"金币购买":6==t?"碎片兑换":7==t?"赛季王者奖励":8==t?e+" days login reward":9==t?"Get the first "+e+" times":10==t?"Look at the video":""},e.prototype.getSkinDesc=function(t,e){return 0==t?"无皮肤特性":1==t?"Ball speed +"+e+"%":2==t?"Ball growth +"+e+"%":""},e}(hole.ui.Home.SkinItemUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),FriendHelpView=function(t){function e(){var e=t.call(this)||this;return e.helpType=1,e.isShiWan=!1,e.rewardSkinID=29,e.x=AdapterManager.offsetX,e.y=AdapterManager.offsetY,e.closeEffect=null,e.popupCenter=!1,e.list.itemRender=FriendHelpRender,e.list.renderHandler=new Handler(e,e.updateItem),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.updateItem=function(t,e){var i=ItemConfig.instance.getDataById(FriendHelpRewardConfig.instance._dic[e].rewardID);FriendHelpRewardConfig.instance._dic[e]&&(1e3!=FriendHelpRewardConfig.instance._dic[e].rewardID&&(t.rewardItemBg.width=71.5,t.rewardItemBg.height=75.5,t.rewardItemBg.y=228,t.rewardID.width=60,t.rewardID.height=60,t.rewardID.y=228,t.goldNum.y=250,t.rewardBtn.y=275,t.rewardStateLab.y=278,this.id=FriendHelpRewardConfig.instance._dic[e].rewardID),t.rewardID.skin=i.iconUrl,t.setData(t.dataSource,e),t.goldNum.text=FriendHelpRewardConfig.instance._dic[e].rewardValue)},e.prototype.onShare=function(){if(WXUtility.aldSendEvent("免费皮肤邀请"),Laya.Browser.onWeiXin){var t="helpType="+this.helpType+"&openId="+ConfigUtility.openId;console.log("好友助力分享的openid=",t),ShareUtil.sharegame(EnumShareId.FRIEND_HELP,t)}},e.prototype.onGetFriendHelpData=function(t){var e;if(console.log("获取到好友助力数据：",t),t&&t.data){if(0==t.data.code){e=t.data.data.result,GameDataManager.friendHelpNum=e.length;for(var i=e.length;i<3;i++)e.push(null)}}else e=[null,null,null];this.listData=e,this.list.array=this.listData,this.setProgress()},e.prototype.onGetFriendReward=function(t){if(t&&t.data){var e=t.data;if(0==e.code)for(var i=0;i<this.listData.length;i++){var n=this.listData[i];if(n.openId==e.data.openId){NoticeView.instance.show(["领取奖励成功~"]),1e3==FriendHelpRewardConfig.instance._dic[i].rewardID?SyncDataManager.gold+=FriendHelpRewardConfig.instance._dic[i].rewardValue:(SkinManager.addSkin(FriendHelpRewardConfig.instance._dic[i].rewardID,-1),GameManager.UIViewsController.HomeView.checkBtnZhuliVisible()),n.rewardState=e.data.rewardState,this.list.refresh();break}}}},e.prototype.setProgress=function(){for(var t=0,e=0;e<3;e++)this.list.array[e]?(this["imgPoint"+e].skin="res/ui/activity/hong.png",e>0&&(this.imgProgress1.width=142.5*e)):(this["imgPoint"+e].skin="res/ui/home/hui.png",e>0&&(this.imgProgress1.width=0),t++);this.lbNum.text=t+""},e.prototype.toShow=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.isShowAtGameOver=t,EventManager.addEvent(EnumKey.GET_FRIEND_HELP,this,this.onGetFriendHelpData),EventManager.addEvent(EnumKey.GET_FRIEND_HELP_REWARD,this,this.onGetFriendReward),this.btnClose.on("click",this,this.on_close),this.btnHelp.on("click",this,this.onShare),this.btnShiWan.on("click",this,this.onShiWan),this.y=t?0:50,Laya.Browser.onWeiXin&&MiNi.miniHttpServer.request(EnumKey.GET_FRIEND_HELP,{helpType:this.helpType},null,null,!0),this.isShiWan&&(this.alreadyShiWan.visible=!0,this.btnShiWan.visible=!1),this.popup(),e?WXUtility.aldSendEvent("打开免费皮肤"):WXUtility.aldSendEvent("推送免费皮肤")},e.prototype.onOpened=function(){AdManager.resize(EnumAdIId.FRIEND_HELP_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.hide=function(){EventManager.removeEvent(EnumKey.GET_FRIEND_HELP,this.onGetFriendHelpData),EventManager.removeEvent(EnumKey.GET_FRIEND_HELP_REWARD,this.onGetFriendReward),this.btnClose.off("click",this,this.on_close),this.btnHelp.off("click",this,this.onShare),this.btnShiWan.off("click",this,this.onShiWan),this.close()},e.prototype.onShiWan=function(){var t=Laya.LocalStorage.getItem(EnumKey.FIRST_CLICK_FRIEND_SHIWAN),e=TimeUtil.getTimeStr();if(t!=e)this.onSeeVideoComplete(),Laya.LocalStorage.setItem(EnumKey.FIRST_CLICK_FRIEND_SHIWAN,e);else{if(!this.id)return;if(1e3!=this.id){var i=SkinManager.judge_the_skin(this.id);console.log("试玩皮肤状态：1 可以试玩  2 看视频",i),RewardVideoManager.show(EnumShareId.SHIWAN_SHIN_VIDEO,this.onSeeVideoComplete.bind(this),this.onSeeVideoError.bind(this),"广告未播放完毕，无法试玩皮肤")}}},e.prototype.onSeeVideoComplete=function(){WXUtility.aldSendEvent("免费皮肤试玩"),NoticeView.instance.show(["试玩成功"]),SkinManager.allShiWanSkin.set(this.id,this.id),e.instance.isShiWan=!0,SkinManager.curUseShiwanID=this.id,SkinManager.isUseShiWanSkin=!0,this.alreadyShiWan.visible=!0,this.btnShiWan.visible=!1,HomeView.Ins.updateCurSkin()},e.prototype.onSeeVideoError=function(){NoticeView.instance.show(["您看视频太频繁了，休息一下再来吧~"])},e.prototype.on_close=function(){this.hide(),this.isShowAtGameOver||EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0)},e}(hole.ui.Home.FriendHelpViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),FriendHelpRender=function(t){function e(){var e=t.call(this)||this;return e.btnInvite.on(LayaEvent.CLICK,e,e.onInvite),e.rewardBtn.visible=!1,e}return __extends(e,t),e.prototype.setData=function(t,e){if(this.index=e,this.lbName.text="",t){if(this.jiahao.visible=!1,t.avatarUrl?this.imgAvatar.skin=t.avatarUrl:this.imgAvatar.skin="res/ui/avatar/unknow.png",t.openId&&(this.openId=t.openId),t.nickName?this.lbName.text=t.nickName:this.lbName.text="匿名好友",this.btnInvite.visible=!1,this.imgName.visible=!0,t.rewardState)switch(t.rewardState){case 1:this.rewardBtn.visible=!0,this.rewardBtn.on(LayaEvent.CLICK,this,this.getReward),this.rewardStateLab.visible=!1,FriendHelpView.instance.btnShiWan.visible=!1,FriendHelpView.instance.alreadyShiWan.visible=!1;break;case 2:this.rewardStateLab.visible=!0,this.rewardStateLab.color="#039903",this.rewardStateLab.text="已领取",this.rewardBtn.visible=!1,FriendHelpView.instance.btnShiWan.visible=!1,FriendHelpView.instance.alreadyShiWan.visible=!1}}else this.btnInvite.visible=!0,this.imgName.visible=!1,1e3==FriendHelpRewardConfig.instance._dic[e].rewardID||FriendHelpView.instance.isShiWan||(this.rewardStateLab.visible=!1,FriendHelpView.instance.btnShiWan.visible=!0,FriendHelpView.instance.alreadyShiWan.visible=!1)},e.prototype.getReward=function(){this.rewardBtn.off(LayaEvent.CLICK,this,this.getReward),Laya.Browser.onWeiXin&&MiNi.miniHttpServer.request(EnumKey.GET_FRIEND_HELP_REWARD,{helpType:FriendHelpView.instance.helpType,openId:this.openId},null,null,!0),GameManager.UIViewsController.HomeView.checkBtnZhuliVisible()},e.prototype.onInvite=function(){if(Laya.Browser.onWeiXin&&this.btnInvite.visible){var t="helpType="+FriendHelpView.instance.helpType+"&openId="+ConfigUtility.openId;ShareUtil.sharegame(EnumShareId.FRIEND_HELP,t)}},e}(hole.ui.Home.FriendHelpRenderUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),DuanWeiView=function(t){function e(){var e=t.call(this)||this;return e.popupCenter=!0,e.isModal=!0,e.x=AdapterManager.offsetX,e.y=AdapterManager.offsetY,e.img_diban3.skin=ConfigUtility.baseUrl+"res/ui/common/diban3.png",e.closeEffect=null,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.updateUI=function(){var t=SeasonCfg.instance.getCurSeason();if(t){var e=t.openTime.split("_"),i=t.endTime.split("_");this.lbTime.text=e[0]+" - "+i[0],this.lbSaiJi.text="Season "+t.id,this.lbPrizeSkin.text="S"+t.id+" award for King's";var n=RankDataManager.configIndex,r=RankConfig.config[n];this.lbRank.text="Current segment: "+r.rankName,this.imgRank.skin="res/ui/common/duanwei_"+RankDataManager.skinUrlNumber+".png";var a=SkinManager.getSkinUIUrlByID(t.rewardSkinId);a&&""!=a?(this.lbQiDai.visible=!1,this.imgSkin.visible=!0,this.lbSkinName.visible=!0,this.imgSkin.skin=a,this.lbSkinName.text=SkinConfig.getDataById(t.rewardSkinId).name):(this.imgSkin.visible=!1,this.lbSkinName.visible=!1,this.lbQiDai.visible=!0);var s=r.seasonReward.split(":");ItemConfig.instance.getDataById(s[0]),this.lbPrizeNum.text="Gold x"+s[1]}},e.prototype.onOpened=function(){WXUtility.aldSendEvent("打开赛季奖励"),this.updateUI(),AdManager.resize(EnumAdIId.DUAN_WEI_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.onClosed=function(){this.x=AdapterManager.offsetX,this.y=AdapterManager.offsetY,EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0)},e}(hole.ui.Home.DuanWeiViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),LotteryView=function(t){function e(){var e=t.call(this)||this;e.rewardAngle=[[331,390],[30,90],[91,150],[151,210],[211,270],[271,330]],e.GOLD_ITEM_ID=1e3,e.onSeeVideoError=function(){NoticeView.instance.show(["您看视频太频繁了，休息一下再来吧~"])},e.onShareSuccess=function(){WXUtility.aldSendEvent("分享转盘次数"),NoticeView.instance.show(["分享成功"]),e.startRoll(),e.addShareTimes()},e.onSeeVideoComplete=function(t){if(t)return PlatformAPI.showToast({title:"No video to watch, please try again later."});WXUtility.aldSendEvent("视频转盘次数"),e.startRoll(),e.addSeeVideoTimes()},e.popupCenter=!1,e.x=AdapterManager.offsetX,e.y=AdapterManager.offsetY,e.closeEffect=null;for(var i=1;i<7;i++){var n=LotteryCfg.instance.getDataById(i);if(n)if(n.rewardID!=e.GOLD_ITEM_ID){var r=ItemConfig.instance.getDataById(n.rewardID);e["lb"+(i-1)].text=r.name,e["img"+(i-1)].skin=r.iconUrl,e["img"+(i-1)].width=110,e["img"+(i-1)].height=110}else e["lb"+(i-1)].text="Gold X "+n.rewardValue}return e.spMask.graphics.drawRect(-AdapterManager.offsetX,-AdapterManager.offsetY,Laya.stage.width,Laya.stage.height,"#000000"),e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.getTargetAngle=function(t){var e=this.rewardAngle[t];return NumberUtil.randRange(e[0],e[1])+5040},e.prototype.startRoll=function(){this.skinId=0,this.settementData=null;for(var t=NumberUtil.randRange(1,LotteryCfg.allWeight),e=0;e<6;e++){var i=LotteryCfg.instance.getDataById(e+1);if(t<=i.rewardWeight)break;t-=i.rewardWeight}var n=ItemConfig.instance.getDataById(i.rewardID);if(4==n.type)this.settementData=SettlementCfg.instance.getDataByWeight();else if(3==n.type){if(SkinManager.isHaveSkin(i.rewardID))return void this.startRoll();this.skinId=i.rewardID}this.lotteryId=e+1;var r=this.getTargetAngle(e);this.isRunning=!0,this.imgArrow.rotation=this.imgArrow.rotation%360,Laya.Tween.to(this.imgArrow,{rotation:r},8e3,Laya.Ease.cubicInOut,Handler.create(this,this.onEndRoll)),SyncDataManager.addDailyDataOnce(EnumDailyID.LOTTERY),WXUtility.aldSendEvent("转盘转动次数")},e.prototype.onEndRoll=function(){this.isRunning=!1,LotteryRewardView.ins.toShow(this.lotteryId,this.settementData,ERewardType.Lottery,this.skinId);var t=LotteryCfg.instance.getDataById(this.lotteryId),e=ItemConfig.instance.getDataById(t.rewardID);if(1==e.type)console.log("转盘增加金币：",t.rewardValue),SyncDataManager.gold+=t.rewardValue;else if(2==e.type)console.log("转盘增加皮肤碎片，皮肤碎片id=：",e.id),i=SyncDataManager.getChipData(e.id),SyncDataManager.setChipData(e.id,i+t.rewardValue);else if(3==e.type)console.log("转盘增加皮肤，皮肤id=：",this.skinId),SkinManager.addSkin(this.skinId,-1);else if(4==e.type){console.log("转盘增加皮肤碎片，皮肤碎片id=：",this.settementData.skinBitsId);var i=SyncDataManager.getChipData(this.settementData.skinBitsId);SyncDataManager.setChipData(this.settementData.skinBitsId,i+this.settementData.num)}this.updateBtn()},e.prototype.updateBtn=function(){if(SyncDataManager.getDailyData(EnumDailyID.LOTTERY_FREE)>0?this.btnFree.visible=!1:this.btnFree.visible=!0,this.btnFriend.visible=!1,SyncDataManager.getDailyData(EnumDailyID.LOTTERY)>=GameSetting.instance.maxRollTimes?(this.btnFree.visible=!1,this.btnFriend.visible=ConfigUtility.IsSafeVersion,this.btnFriend.gray=!0,this.btnVideo.gray=!0,this.lbHint.visible=!0):(this.btnFriend.visible=!this.btnFree.visible&&ConfigUtility.IsSafeVersion,this.btnFriend.gray=GameDataManager.lotteryShareTimes.num>=GameSetting.instance.maxRollShareTimes,this.btnVideo.gray=GameDataManager.lotterySeeVideoTimes.num>=GameSetting.instance.maxRollVideoTimes,this.lbHint.visible=!1),ConfigUtility.IsSafeVersion)switch(ConfigUtility.getRewardType){case EGetRewardType.video:this.btnFriend.visible=!1;break;case EGetRewardType.shareAndVideo:break;case EGetRewardType.share:ShareUtil.CurShareSucCount<GameSetting.instance.VideoOpenTimes&&ConfigUtility.shareSucCountEnoughToShowVideo?(this.btnVideo.visible=!1,this.btnFree.visible=!this.btnFriend.visible):this.btnVideo.visible=!0}else this.btnFree.visible||(this.btnFree.visible=!0,this.btnFree.gray=!0);this.btnFree.visible?HelperExtension.ABCSetOffsetX(this.btnVideo,this.btnFree,this):HelperExtension.ABCSetOffsetX(this.btnVideo,this.btnFriend,this)},e.prototype.onOpened=function(){this.x=AdapterManager.offsetX,this.y=AdapterManager.offsetY,this.btnClose.on(LayaEvent.CLICK,this,this.onClose),this.btnFree.on(LayaEvent.CLICK,this,this.onFreeClick),this.btnFriend.on(LayaEvent.CLICK,this,this.onFriendClick),this.btnVideo.on(LayaEvent.CLICK,this,this.onVideoClick),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1),AdManager.resize(EnumAdIId.lottery_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.resizeAD=function(){AdManager.resize(EnumAdIId.lottery_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.onClosed=function(){EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0),this.btnClose.off(LayaEvent.CLICK,this,this.onClose),this.btnFree.off(LayaEvent.CLICK,this,this.onFreeClick),this.btnFriend.off(LayaEvent.CLICK,this,this.onFriendClick),this.btnVideo.off(LayaEvent.CLICK,this,this.onVideoClick),this.x=AdapterManager.offsetX,this.y=AdapterManager.offsetY,AdManager.hide("",!1,!0)},e.prototype.onFreeClick=function(){this.isRunning||(SyncDataManager.getDailyData(EnumDailyID.LOTTERY_FREE)>0?NoticeView.instance.show(["明天再来免费抽吧！"]):(WXUtility.aldSendEvent("免费转盘次数"),this.startRoll(),SyncDataManager.addDailyDataOnce(EnumDailyID.LOTTERY_FREE)))},e.prototype.onFriendClick=function(){if(!this.isRunning){var t=SyncDataManager.getDailyData(EnumDailyID.LOTTERY);if(GameDataManager.lotteryShareTimes.num>=GameSetting.instance.maxRollShareTimes||t>=GameSetting.instance.maxRollTimes)NoticeView.instance.show(["该次数已用完，试试其他方式吧"]);else{var e=new ShareInfo;e.shareId=EnumShareId.LOTTERY_SHARE,e.successFunc=new CallBackFunc(this,this.onShareSuccess),e.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(e)}}},e.prototype.onClose=function(){this.isRunning||(Laya.timer.clear(this,this.onShareSuccess),this.close())},e.prototype.onVideoClick=function(){if(!this.isRunning){var t=SyncDataManager.getDailyData(EnumDailyID.LOTTERY);GameDataManager.lotterySeeVideoTimes.num>=GameSetting.instance.maxRollVideoTimes||t>=GameSetting.instance.maxRollTimes?NoticeView.instance.show(["该次数已用完，试试其他方式吧"]):Laya.Browser.onWeiXin?RewardVideoManager.show(EnumShareId.LOTTERY_VIDEO,this.onSeeVideoComplete,this.onSeeVideoError,"广告未播放完毕，无法获得奖励"):this.onSeeVideoComplete()}},e.prototype.onShareFail=function(t){traceLog("分享失败！"),ShareUtil.shareFailtips()},e.prototype.addSeeVideoTimes=function(){var t=TimeUtil.getTimeStr(),e=GameDataManager.lotterySeeVideoTimes.time,i=GameDataManager.lotterySeeVideoTimes.num;t==e?GameDataManager.lotterySeeVideoTimes.num=i+1:(GameDataManager.lotterySeeVideoTimes.time=t,GameDataManager.lotterySeeVideoTimes.num=1),Laya.LocalStorage.setJSON(EnumKey.LOTTERY_SEE_VIDEO_TIMES,GameDataManager.lotterySeeVideoTimes)},e.prototype.addShareTimes=function(){var t=TimeUtil.getTimeStr(),e=GameDataManager.lotteryShareTimes.time,i=GameDataManager.lotteryShareTimes.num;t==e?GameDataManager.lotteryShareTimes.num=i+1:(GameDataManager.lotteryShareTimes.time=t,GameDataManager.lotteryShareTimes.num=1),Laya.LocalStorage.setJSON(EnumKey.LOTTERY_SHARE_TIMES,GameDataManager.lotteryShareTimes)},e.prototype.toPop=function(){ConfigUtility.IsSafeVersion&&SyncDataManager.getDailyData(EnumDailyID.LOTTERY)<GameSetting.instance.maxRollTimes&&(e.ins.show(),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1))},e.prototype.show=function(e,i,n){void 0===e&&(e=!1),GameDataManager.gameState==EGameState.InHome&&(e?WXUtility.aldSendEvent("打开转盘"):WXUtility.aldSendEvent("推送转盘"),this.updateBtn(),t.prototype.show.call(this,i,n))},e}(hole.ui.Home.LotteryViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ERewardType;!function(t){t[t.GetGold=0]="GetGold",t[t.GetGold_Double=1]="GetGold_Double",t[t.GetGold_Double_S=2]="GetGold_Double_S",t[t.GetGold_Login=3]="GetGold_Login",t[t.GetSkin_Login=4]="GetSkin_Login",t[t.Lottery=5]="Lottery",t[t.LuckyLihe=6]="LuckyLihe",t[t.GetLuckyLihe=7]="GetLuckyLihe"}(ERewardType||(ERewardType={}));var LotteryRewardView=function(t){function e(){var e=t.call(this)||this;return e.isDone=!1,e.beginTimer=!1,e.onSeeVideoError=function(){e.onShareClick()},e.onShareSuccess=function(){WXUtility.aldSendEvent("转盘翻倍分享"),e.addDoublePrize()},e.onSeeVideoComplete=function(){WXUtility.aldSendEvent("转盘翻倍视频"),e.addDoublePrize()},e.onLuckVideoCompelete=function(){WXUtility.aldSendEvent("视频开箱"),e.getLuckyReward()},e.onLuckVideoError=function(){e.onLuckyShareClick()},e.onLuckyShareSuccess=function(){WXUtility.aldSendEvent("分享开箱"),e.getLuckyReward()},e.popupCenter=!1,e.closeEffect=null,e.popupEffect=null,e.x=AdapterManager.offsetX,e.y=AdapterManager.offsetY,e.bgMask.graphics.drawRect(-AdapterManager.offsetX,-AdapterManager.offsetY,Laya.stage.width,Laya.stage.height,"#000000"),e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.addEvents=function(){this.btnShare.on(LayaEvent.CLICK,this,this.onShareClick),this.btnVedeo.on(LayaEvent.CLICK,this,this.onVideoClick),this.img_luck_video.on(LayaEvent.CLICK,this,this.onLuckVideoClick),this.img_luck_share.on(LayaEvent.CLICK,this,this.onLuckyShareClick),this.clickBtn.on(LayaEvent.CLICK,this,this.clickButton),this.img_click_share.on(LayaEvent.CLICK,this,this.onClickViewShare),this.img_click_video.on(LayaEvent.CLICK,this,this.onClickViewVideo),this.btnShare.visible=!1},e.prototype.removeEvents=function(){this.btnShare.off(LayaEvent.CLICK,this,this.onShareClick),this.btnVedeo.off(LayaEvent.CLICK,this,this.onVideoClick),this.img_luck_video.off(LayaEvent.CLICK,this,this.onLuckVideoClick),this.img_luck_share.off(LayaEvent.CLICK,this,this.onLuckyShareClick),this.clickBtn.off(LayaEvent.CLICK,this,this.clickButton),this.img_click_share.off(LayaEvent.CLICK,this,this.onClickViewShare),this.img_click_video.off(LayaEvent.CLICK,this,this.onClickViewVideo)},e.prototype.onClickViewShare=function(){var t=new ShareInfo;t.shareId=EnumShareId.LOTTERY_CLICK_SHARE,t.successFunc=new CallBackFunc(this,this.onClickViewShareSuc),t.failFunc=new CallBackFunc(this,this.onClickViewShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.onClickViewShareSuc=function(){SyncDataManager.addChipData(1001,this.clickRewardNum),NoticeView.instance.show(["获得碎片奖励"]),this.close()},e.prototype.onClickViewShareFail=function(){ShareUtil.shareFailtips()},e.prototype.onClickViewVideo=function(){Laya.Browser.onWeiXin?RewardVideoManager.show(EnumShareId.LOTTERY_CLICK_VIDEO,this.onClickViewVideoSuc.bind(this),this.onClickViewVideoFail.bind(this),"广告未播放完毕，未获得碎片奖励"):this.onClickViewVideoSuc()},e.prototype.onClickViewVideoSuc=function(){SyncDataManager.addChipData(1001,this.clickRewardNum),NoticeView.instance.show(["获得碎片奖励"]),this.close()},e.prototype.onClickViewVideoFail=function(){var t=new ShareInfo;t.shareId=EnumShareId.LOTTERY_CLICK_SHARE,t.successFunc=new CallBackFunc(this,this.onClickViewShareSuc),t.failFunc=new CallBackFunc(this,this.onClickViewShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.clickButton=function(){var t=this;if(this.clickProgress.width+=395*GameSetting.instance.ClickOneAddProgress/100,this.clickProgress.width>=390&&(this.clickProgress.width=390,this.isDone=!0),0==this.beginTimer){this.beginTimer=!0,this.progressReduce();var e=Math.floor(1e3*(Math.random()+2));Laya.timer.once(e,this,function(){t.isDone=!0,t.beginTimer=!1}),Laya.timer.frameLoop(1,this,this.checkClickEnd)}},e.prototype.checkClickEnd=function(){this.isDone&&(Browser.onWeiXin&&AdManager.currentAd.show(),this.progressNum=Math.floor(this.clickProgress.width/395*100),console.log("进度",this.progressNum),WXUtility.aldSendEvent("点击开箱"),this.getLuckyReward(!0),this.isDone=!1,Laya.timer.clear(this,this.progress),Laya.timer.clear(this,this.checkClickEnd))},e.prototype.toShow=function(t,e,i,n,r){var a=this;switch(void 0===i&&(i=ERewardType.Lottery),void 0===n&&(n=0),void 0===r&&(r=!1),this.addEvents(),this.cunrrentType=i,i){case ERewardType.Lottery:this.img_title.skin="res/ui/common/getPrize.png",this.box_lucky.visible=!1,this.lbNum.visible=!0,this.text_close.visible=!1,this.img_click_share.visible=!1,this.img_click_video.visible=!1,this.btnVedeo.visible=!0,this.btnShare.visible=!1,Laya.timer.once(1e3,this,function(){this.text_close.visible=!0}),this.y=150,this.onShowLottery(t,e,n),AdManager.show(AdManager.LOTTERY_REWARD_AD,EnumAdIId.LotteryRewardView,(this.y-150+this.ad.y)*AdapterManager.scaleRadio),AdManager.hide("",!1,!0),this.delayShowAd();break;case ERewardType.LuckyLihe:WXUtility.aldSendEvent("弹出宝箱"),this.img_title.skin="res/ui/gameover/texttitle.png",this.box_lucky.visible=!0,this.text_close.visible=!1,this.imgSkin.visible=!1,this.boxGold.visible=!1,this.btnVedeo.visible=!1,this.btnShare.visible=!1,this.lbNum.visible=!1,this.img_click_share.visible=!1,this.img_click_video.visible=!1,this.text_close.text="放 弃 福 利",this.text_close.on(LayaEvent.CLICK,this,this.onLuckyTextClose),AdManager.show(AdManager.HOME_PAGE_AD,EnumAdIId.LotteryRewardView,(this.y+this.ad.y)*AdapterManager.scaleRadio),HelperExtension.coinTest(1)&&ConfigUtility.IsSafeVersion&&ConfigUtility.showClickLuckyBoxView?(this.img_luck_share.visible=!1,this.img_luck_video.visible=!1,this.clickProgress.width=0,this.boxClick.visible=!0,AdManager.show(AdManager.LUCK_REWARD_AD,EnumAdIId.LotteryRewardView,(this.y+this.ad.y)*AdapterManager.scaleRadio),AdManager.hide("",!1,!0)):(this.boxClick.visible=!1,this.img_luck_share.visible=!0,this.img_luck_video.visible=!0,Laya.timer.once(2e3,this,function(){this.text_close.visible=!0}));break;case ERewardType.GetLuckyLihe:if(this.img_title.skin="res/ui/common/getPrize.png",this.box_lucky.visible=!1,this.text_close.visible=!1,this.imgSkin.visible=!1,this.boxGold.visible=!1,this.btnVedeo.visible=!1,this.btnShare.visible=!1,this.lbNum.visible=!0,this.img_click_share.visible=!1,this.img_click_video.visible=!1,this.text_close.text="确 定",r)this.boxGold.visible=!1,AdManager.resize(EnumAdIId.LotteryRewardView),this.clickRewardNum=Math.ceil(GameSetting.instance.ClickChestCoinMax*this.progressNum/100)+1,this.clickRewardNum<2&&(this.clickRewardNum=2),this.lbNum.text=this.clickRewardNum+"",this.imgSkin.visible=!0,this.imgSkin.skin="res/skinUI/bigsuipian.png",SyncDataManager.getChipData(1001),this.img_click_share.visible=!0,this.img_click_video.visible=!0,this.text_close.visible=!1,this.text_close.text="放弃福利",Laya.timer.once(2e3,this,function(){a.text_close.visible=!0});else{this.bgMask.on(LayaEvent.CLICK,this,this.close),AdManager.show(AdManager.HOME_PAGE_AD,EnumAdIId.LotteryRewardView,(this.y+this.ad.y)*AdapterManager.scaleRadio);var s=LuckyBagConfig.instance.getRanomData();if(s){var o=ItemConfig.instance.getDataById(s.rewardID),l=SyncDataManager.addItem(o,s.rewardValue);if(l instanceof SettementData)this.imgSkin.visible=!0,this.imgSkin.skin="res/skinUI/bigsuipian.png",this.lbNum.text=s.rewardValue+"";else switch(l.type){case 1:this.boxGold.visible=!0;var h=100*-GameDataManager.luckyLiheTotalTimes;this.lbNum.text=s.rewardValue-100*GameDataManager.luckyLiheTotalTimes+"",SyncDataManager.addItem(o,h);break;case 2:SettlementCfg.instance.getDataBySkinBitsId(l.id),this.imgSkin.visible=!0,this.imgSkin.skin="res/skinUI/bigsuipian.png",this.lbNum.text=s.rewardValue+""}}}}if(ConfigUtility.IsSafeVersion)switch(ConfigUtility.getRewardType){case EGetRewardType.video:this.btnShare.visible=!1,this.img_luck_share.visible=!1,this.img_click_share.visible=!1;break;case EGetRewardType.shareAndVideo:break;case EGetRewardType.share:ShareUtil.CurShareSucCount<GameSetting.instance.VideoOpenTimes&&ConfigUtility.shareSucCountEnoughToShowVideo&&(this.btnVedeo.visible=!1,this.img_luck_video.visible=!1,this.img_click_video.visible=!1)}else this.img_luck_share.visible=!1,this.btnShare.visible=!1,this.img_click_share.visible=!1;switch(i){case ERewardType.Lottery:this.btnVedeo.visible=!0;break;case ERewardType.LuckyLihe:case ERewardType.GetLuckyLihe:this.btnVedeo.visible=!1,this.btnShare.visible=!1}HelperExtension.ABCSetOffsetX(this.img_luck_video,this.img_luck_share,this),HelperExtension.ABCSetOffsetX(this.btnVedeo,this.btnShare,this),HelperExtension.ABCSetOffsetX(this.img_click_video,this.img_click_share,this),this.popup()},e.prototype.onShowLottery=function(t,e,i){this.settementData=e,this.rewardData=LotteryCfg.instance.getDataById(t),e?(this.boxGold.visible=!1,this.imgSkin.visible=!0,this.imgSkin.skin=SkinManager.getSkinUIUrlByID(e.skinId),this.lbNum.text="+"+e.num,this.addGold=0,this.text_close.text="不了，谢谢"):i?(this.boxGold.visible=!1,this.imgSkin.visible=!0,this.imgSkin.skin=SkinManager.getSkinUIUrlByID(i),this.lbNum.text="+1",this.text_close.text="确定"):1001==this.rewardData.rewardID?(this.boxGold.visible=!1,this.imgSkin.visible=!0,this.imgSkin.skin="res/skinUI/bigsuipian.png",this.text_close.text="不了，谢谢",this.lbNum.text=this.rewardData.rewardValue+"",this.rewardData&&(this.lbNum.text="+"+this.rewardData.rewardValue)):(this.boxGold.visible=!0,this.imgSkin.visible=!1,this.rewardData&&(this.lbNum.text="+"+this.rewardData.rewardValue),this.addGold=this.rewardData.rewardValue,this.text_close.text="不了，谢谢"),i&&(this.btnVedeo.visible=!1,this.btnShare.visible=!1),GameDataManager.isSeeAllVideo&&(this.btnVedeo.visible=!1)},e.prototype.onShareClick=function(){var t=new ShareInfo;t.shareId=EnumShareId.LOTTERY_SHARE_PRIZE,t.successFunc=new CallBackFunc(this,this.onShareSuccess),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.onVideoClick=function(){Laya.Browser.onWeiXin?RewardVideoManager.show(EnumShareId.LOTTERY_VIDEO,this.onSeeVideoComplete,this.onSeeVideoError,"广告未播放完毕，未获得三倍奖励"):this.onSeeVideoComplete()},e.prototype.onShareFail=function(t){ShareUtil.shareFailtips(),traceLog("分享失败！")},e.prototype.addDoublePrize=function(){if(NoticeView.instance.show(["恭喜获得三倍奖励"]),this.close(),this.addGold>0)SyncDataManager.gold+=2*this.addGold;else if(this.settementData)t=SyncDataManager.getChipData(this.settementData.skinBitsId),SyncDataManager.setChipData(this.settementData.skinBitsId,t+2*this.settementData.num);else if(this.rewardData&&1001==this.rewardData.rewardID){var t=SyncDataManager.getChipData(this.rewardData.rewardID);SyncDataManager.setChipData(this.rewardData.rewardID,t+2*this.rewardData.rewardValue)}},e.prototype.onLuckyTextClose=function(){AdManager.show(AdManager.HOME_PAGE_AD,EnumAdIId.lottery_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio),ERewardType.LuckyLihe&&Laya.timer.once(1e3,this,this.delayCallGameOver)},e.prototype.onLuckVideoClick=function(){Laya.Browser.onWeiXin?RewardVideoManager.show(EnumShareId.LUCKY_VIDEO,this.onLuckVideoCompelete,this.onLuckVideoError,"广告未播放完毕，未获得礼包奖励"):this.onLuckVideoCompelete()},e.prototype.onLuckyShareClick=function(){var t=new ShareInfo;t.shareId=EnumShareId.LUCKY_SHARE,t.successFunc=new CallBackFunc(this,this.onLuckyShareSuccess),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.getLuckyReward=function(t){this.close(),this.toShow(null,null,ERewardType.GetLuckyLihe,0,t)},e.prototype.delayCallGameOver=function(){GameManager.EventManagerEx.RaiseEvent(EventSetting.on_classic_over)},e.prototype.onOpened=function(){this.bg.rotation=0,Laya.timer.frameLoop(1,this,this.onTimer)},e.prototype.delayShowAd=function(){this.y=0,AdManager.resize(EnumAdIId.LotteryRewardView,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.onTimer=function(){this.bg.rotation++},e.prototype.onClosed=function(){switch(this.removeEvents(),Laya.timer.clear(this,this.onTimer),this.x=AdapterManager.offsetX,this.y=AdapterManager.offsetY,this.bgMask.hasListener(LayaEvent.CLICK)&&this.bgMask.off(LayaEvent.CLICK,this,this.close),this.cunrrentType){case ERewardType.Lottery:LotteryView.ins.resizeAD();break;case ERewardType.GetLuckyLihe:this.bgMask.hasListener(LayaEvent.CLICK)&&this.bgMask.off(LayaEvent.CLICK,this,this.close),Laya.timer.once(1e3,this,this.delayCallGameOver);break;case ERewardType.LuckyLihe:this.text_close.off(LayaEvent.CLICK,this,this.onLuckyTextClose)}},e.prototype.progressReduce=function(){Laya.timer.frameLoop(12,this,this.progress)},e.prototype.progress=function(){this.clickProgress.width>5&&(this.clickProgress.width-=3.9)},e}(hole.ui.Home.LotteryRewardViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),MailboxView=function(t){function e(){var e=t.call(this)||this;return e.allMailData=new Array,e.popupCenter=!0,e.panel_mail.vScrollBarSkin="",e.closeEffect=null,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.toShow=function(){this.recover(),EventManager.addEvent(EnumKey.GET_ALL_MAIL,this,this.on_get_mail_request),EventManager.addEvent(EnumKey.GET_MAIL_REWARD,this,this.get_mail_reward),Laya.Browser.onWeiXin&&MiNi.miniHttpServer.request(EnumKey.GET_ALL_MAIL,null,null,null,!0),this.popup()},e.prototype.onCompelete=function(){WXUtility.hideLoading(),this.popup()},e.prototype.onOpened=function(){EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1),AdManager.resize(EnumAdIId.MailboxView,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.onClosed=function(){EventManager.removeEvent(EnumKey.GET_MAIL_REWARD,this.get_mail_reward),EventManager.removeEvent(EnumKey.GET_ALL_MAIL,this.on_get_mail_request),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0),this.recover()},e.prototype.on_get_mail_request=function(t){if(console.log("on_get_mail_request",t),t&&t.data&&t.data.data){for(var e=t.data.data,i=new Array,n=e.length;n--;){var r=e[n];if(null==r.mailTemplateId||0==r.mailTemplateId){if((s={}).mailId=r.mailId,s.sendTime=r.sendTime,s.mailState=r.mailState,s.mailAttach=r.mailAttach,null!=(l=r.mailContentParam)&&""!=l){var a=l.split("$");null!=a[0]&&(s.mailIcon=a[0]),null!=a[1]&&(s.mailTitle=a[1]),null!=a[2]&&(s.mailContent=a[2])}i.push(s)}else{var s={};s.mailId=r.mailId,s.sendTime=r.sendTime,s.mailState=r.mailState,s.mailAttach=r.mailAttach;var o=MailConfig.instance.getMailByID(r.mailTemplateId);if(o){s.mailIcon=o.icon,s.mailTitle=o.mailName;var l=r.mailContentParam;if(null!=l&&""!=l){for(var h=l.split("$"),c=o.mailContent,u=0;u<h.length;u++)c=c.replace("$",h[u]);s.mailContent=c}else s.mailContent=o.mailContent}i.push(s)}}for(this.allMailData=i,this.allMailData.sort(this.sort_email),n=0;n<this.allMailData.length;n++){var _=Laya.Pool.getItemByClass("MailItem",MailItem);this.panel_mail.addChild(_),_.setData(this.allMailData[n],n),_.addEvents(),n==this.allMailData.length-1&&_.resort(MailItem.currentExtendIndex)}this.noHaveEmailLab.visible=0==this.allMailData.length}},e.prototype.get_mail_reward=function(t){if(WXUtility.hideLoading(),console.log(t),t&&t.data)if(0==t.data.code){for(var e=0;e<this.allMailData.length;e++)if(this.allMailData[e].mailId==t.data.data&&this.allMailData[e].mailState<3){this.allMailData[e].mailState=3;var i=this.allMailData[e].mailAttach.split(",");if(i.length>0)for(var n=i.length,r=0;r<n;++r){var a=i[r].split(":");if(a.length>1){var s=ItemConfig.instance.getDataById(Number(a[0])),o=Number(a[1]);SyncDataManager.addItem(s,o)}}this.fresh_mail(),NoticeView.instance.show(["成功领取附件~"])}}else t.data.code},e.prototype.sort_email=function(t,e){return t.mailState==e.mailState?e.sendTime-t.sendTime:t.mailState-e.mailState},e.prototype.recover=function(){if(this.panel_mail.numChildren>0)for(var t=this.panel_mail.numChildren;t--;){var e=this.panel_mail.removeChildAt(t);e.removeEvents(),Laya.Pool.recover("MailItem",e)}},e.prototype.fresh_mail=function(){if(this.panel_mail.numChildren>0&&this.allMailData.length>0)for(var t=this.panel_mail.numChildren;t--;){var e=this.panel_mail.getChildAt(t);e.setData(this.allMailData[t],t),0==t&&e.resort(MailItem.currentExtendIndex)}},e}(hole.ui.Home.MailboxViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),MailItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addEvents=function(){this.img_bg.on(LayaEvent.CLICK,this,this.on_click),this.img_recover.on(LayaEvent.CLICK,this,this.on_recover)},e.prototype.removeEvents=function(){this.img_bg.off(LayaEvent.CLICK,this,this.on_click),this.img_recover.off(LayaEvent.CLICK,this,this.on_recover),this.img_linqu.off(LayaEvent.CLICK,this,this.on_lingqu)},e.prototype.setData=function(t,i){if(this.dataSource=t,this.index=i,this.y=i*e.mailItemNormalHeight,this.height=e.mailItemNormalHeight,this.box_attach.visible=!1,this.dataSource){this.text_title.text=this.dataSource.mailTitle;var n=new Date(this.dataSource.sendTime);if(this.text_time.text=HelperExtension.formatTime(n,"yyyy-MM-dd hh:mm:ss"),this.dataSource.mailState>=3?(this.img_linqu.visible=!1,this.btnYiLingQu.visible=!0,this.img_linqu.off(LayaEvent.CLICK,this,this.on_lingqu)):(this.img_linqu.visible=!0,this.btnYiLingQu.visible=!1,this.img_linqu.on(LayaEvent.CLICK,this,this.on_lingqu)),this.box_item.numChildren>0)for(o=this.box_item.numChildren;o--;){var r=this.box_item.removeChildAt(o);Laya.Pool.recover("ItemGrid",r)}var a=this.dataSource.mailAttach.split(",");if(i=0,a.length>0&&0==this.box_item.numChildren){var s=a.length;this.box_item.width=84*s+50*(s-1),this.box_item.space=50;for(var o=0;o<s;++o){var l=a[o].split(":");if(l.length>1){var h=Number(l[0]),c=Number(l[1]),u=ItemConfig.instance.getDataById(h),_=Laya.Pool.getItemByClass("ItemGrid",ItemGrid);_.setIcon(h),3==u.type?_.day=-1==c?"永久":c+"天":_.count=c,this.box_item.addChild(_)}}}}},e.prototype.on_click=function(){this.dataSource&&this.resort(this.index)},e.prototype.on_recover=function(){this.resort(-1)},e.prototype.on_lingqu=function(){Laya.Browser.onWeiXin&&(WXUtility.showLoading(),MiNi.miniHttpServer.request(EnumKey.GET_MAIL_REWARD,{mailId:this.dataSource.mailId},null,null,!0))},e.prototype.resort=function(t){e.currentExtendIndex=t;for(var i=0,n=0;n<this.parent.numChildren;n++){var r=this.parent.getChildAt(n);r.y=i,t!=n?(r.box_attach.visible=!1,r.height=e.mailItemNormalHeight,i+=e.mailItemNormalHeight):(r.box_attach.visible=!0,r.text_content.text=r.dataSource.mailContent,i+=e.mailItemExtendHeight,r.height=e.mailItemExtendHeight),r.img_bg.height=r.height-10}},e.mailItemNormalHeight=100,e.mailItemExtendHeight=350,e.currentExtendIndex=0,e}(hole.ui.Home.MailItemUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),LoginRewardView=function(t){function e(){var e=t.call(this)||this;return e.popupCenter=!0,e.isModal=!0,e.img_skinBG.skin=ConfigUtility.baseUrl+"res/ui/login/login_bg.png",e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.toShow=function(){this.btnDouble.visible=!1,this.btnlinqu.visible=!1,this.btnSingle.visible=!1,this.btnlingqu_skin.visible=!1,this.img_lingqu.visible=!1;var t=SignConfig.instance.getDataById(GameDataManager.loginRewardDay_server+1),e=ItemConfig.instance.getDataById(t.rewardItemID);switch(this.img_gold.skin=e.iconUrl,e.type){case EItemType.GOLD:this.text_gold_num.text=t.rewardItemValue+"",1==ConfigUtility.getRewardType?this.img_lingqu.visible=!0:(this.btnDouble.visible=!0,Laya.timer.once(3e3,this,function(){this.btnSingle.visible=!0}));break;case EItemType.CLIP:break;case EItemType.SKIN:-1==t.rewardItemValue?this.text_gold_num.text="永久":this.text_gold_num.text=t.rewardItemValue+"天",1==ConfigUtility.getRewardType?this.img_lingqu.visible=!0:(this.btnlingqu_skin.visible=!0,Laya.timer.once(3e3,this,function(){this.btnlinqu.visible=!0}));break;case EItemType.CLIP_BAG:}var i=SignConfig.instance.getCurRewardSkin(t.signDay),n=SignConfig.instance.getDataById(i),r=ItemConfig.instance.getDataById(n.rewardItemID);this.img_skin.skin="res/skinUI/"+r.iconname+".png",this.text_jijiang_name.text=r.name,this.text_jijiang_day.text="累 计 登 录 "+i+" 天 可 获 得",this.text_login_percent.text=t.signDay+" / "+i,EventManager.addEvent(EnumKey.GET_LOGIN_REWARD,this,this.on_get_login_reward),this.popup()},e.prototype.onOpened=function(){WXUtility.pointForNew("*弹出登录奖励",ENewPointTpye.ENTER_LOGIN),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1),this.btnSingle.on(LayaEvent.CLICK,this,this.on_linqu),this.btnlinqu.on(LayaEvent.CLICK,this,this.on_linqu),this.btnDouble.on(LayaEvent.CLICK,this,this.getDoubleGold),this.btnlingqu_skin.on(LayaEvent.CLICK,this,this.getSkinShare),this.img_lingqu.on(LayaEvent.CLICK,this,this.on_linqu),AdManager.resize(EnumAdIId.LoginRewardView,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.onClosed=function(){EventManager.removeEvent(EnumKey.GET_LOGIN_REWARD,this.on_get_login_reward),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0),this.btnSingle.off(LayaEvent.CLICK,this,this.on_linqu),this.btnlinqu.off(LayaEvent.CLICK,this,this.on_linqu),this.btnDouble.off(LayaEvent.CLICK,this,this.getDoubleGold),this.btnlingqu_skin.on(LayaEvent.CLICK,this,this.getSkinShare),this.img_lingqu.off(LayaEvent.CLICK,this,this.on_linqu),Laya.loader.clearRes(ConfigUtility.baseUrl+"res/atlas/res/ui/login.atlas")},e.prototype.on_linqu=function(){if(Laya.Browser.onWeiXin)if(e.isLinquReward)NoticeView.instance.show(["已经领取该天的奖励"]);else{e.isLinquReward=!0,GameDataManager.setLoginRewardCurrentDay(GameDataManager.loginRewardDay_server),MiNi.miniHttpServer.request(EnumKey.GET_LOGIN_REWARD,null,null,null,!0);var t=SignConfig.instance.getDataById(GameDataManager.loginRewardDay_server+1),i=ItemConfig.instance.getDataById(t.rewardItemID);SyncDataManager.addItem(i,t.rewardItemValue),SkinManager.setSkinData(EnumKey.SKIN_GET_CONDITION_8,1),i.type==EItemType.GOLD?GetGoldView.ins.toShow(t.rewardItemValue,null,ERewardType.GetGold_Login):GetGoldView.ins.toShow(t.rewardItemValue,i,ERewardType.GetSkin_Login)}else{GameDataManager.setLoginRewardCurrentDay(GameDataManager.loginRewardDay_server);t=SignConfig.instance.getDataById(GameDataManager.loginRewardDay_server+1),i=ItemConfig.instance.getDataById(t.rewardItemID);SyncDataManager.addItem(i,t.rewardItemValue),SkinManager.setSkinData(EnumKey.SKIN_GET_CONDITION_8,1),i.type==EItemType.GOLD?GetGoldView.ins.toShow(t.rewardItemValue,null,ERewardType.GetGold_Login):GetGoldView.ins.toShow(t.rewardItemValue,i,ERewardType.GetSkin_Login)}GameDataManager.haveLoginReward=!1,this.close()},e.prototype.on_get_login_reward=function(t){t&&t.data&&0==t.data.code?(GameDataManager.setLoginRewardSeverDay(GameDataManager.loginRewardDay_server),null!=t.data.data&&isNaN(t.data.data)):(NoticeView.instance.show(["领取失败"]),this.close())},e.prototype.getDoubleGold=function(){var t=new ShareInfo;t.shareId=EnumShareId.LOGIN_SHARE_DOUBLE_GOLD,t.successFunc=new CallBackFunc(this,this.on_share_succeed),t.failFunc=new CallBackFunc(this,this.on_share_failed),ShareUtil.shareGameByShareInfo(t)},e.prototype.on_share_succeed=function(){if(WXUtility.aldSendEvent("登录奖励成功分享"),WXUtility.pointForNew("*登录奖励成功分享",ENewPointTpye.LOGINREWARD_SHARE_SUC),Laya.Browser.onWeiXin)if(e.isLinquReward)NoticeView.instance.show(["已经领取该天的奖励"]);else{e.isLinquReward=!0,GameDataManager.setLoginRewardCurrentDay(GameDataManager.loginRewardDay_server),MiNi.miniHttpServer.request(EnumKey.GET_LOGIN_REWARD,null,null,null,!0);var t=SignConfig.instance.getDataById(GameDataManager.loginRewardDay_server+1),i=ItemConfig.instance.getDataById(t.rewardItemID);SyncDataManager.addItem(i,2*t.rewardItemValue),SkinManager.setSkinData(EnumKey.SKIN_GET_CONDITION_8,1),GetGoldView.ins.toShow(2*t.rewardItemValue,null,ERewardType.GetGold_Login)}else{GameDataManager.setLoginRewardCurrentDay(GameDataManager.loginRewardDay_server);t=SignConfig.instance.getDataById(GameDataManager.loginRewardDay_server+1),i=ItemConfig.instance.getDataById(t.rewardItemID);SyncDataManager.addItem(i,2*t.rewardItemValue),SkinManager.setSkinData(EnumKey.SKIN_GET_CONDITION_8,1),GetGoldView.ins.toShow(2*t.rewardItemValue,null,ERewardType.GetGold_Login)}GameDataManager.haveLoginReward=!1,this.close()},e.prototype.on_share_failed=function(){ShareUtil.shareFailtips()},e.prototype.getSkinShare=function(){var t=this;ShareUtil.sharegame(EnumShareId.SHARE_homePage),WXUtility.aldSendEvent("登陆奖励分享皮肤"),Laya.timer.frameOnce(500,this,function(){t.on_linqu()})},e.isLinquReward=!1,e}(hole.ui.Home.LoginRewardViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),SuggestListView=function(t){function e(){}return __extends(e,t),Object.defineProperty(e,"Instance",{get:function(){return null==this._ins&&(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.renderHandler=function(t,e){},e.prototype.getSpData=function(){},e.prototype.completeHandler=function(t){},e.prototype.show=function(t){},e.prototype.hide=function(t){},e.prototype.onClickList=function(){},e.prototype.moveAni=function(){},e.prototype.playAni=function(){},e.prototype.removeTimer=function(){},e.prototype.addTimer=function(){},e.prototype.setCNXHData=function(t){},e.prototype.randomNum=function(t){},e.prototype.onCNXHClick=function(t){},e.prototype.onComplete=function(t){console.log("跳转点击成功",t)},e}(hole.ui.SuggestListViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),SuggestListRender=function(t){function e(){var e=t.call(this)||this;return e.on(LayaEvent.CLICK,e,e.onClick),e}return __extends(e,t),e.prototype.setData=function(t,e){},e.prototype.onClick=function(){},e}(hole.ui.SuggestListRenderUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ShiWanView=function(t){function e(){var e=t.call(this)||this;return e.haveWangzhe=!1,e.detalTime=1,e.isModal=!0,e.list.itemRender=ShiWanRender,e.list.vScrollBarSkin="",e.list.selectEnable=!1,e.list.renderHandler=new Handler(e,e.renderHandler),e}return __extends(e,t),e.prototype.renderHandler=function(t,e){t.setData(t.dataSource,e)},Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.onStart=function(){window.showBannerAd&&window.showBannerAd("loading");var t=Laya.LocalStorage.getItem(EnumKey.SHI_WAN_HINT_TIME),e=TimeUtil.getTimeStr();this.gou.visible&&t!=e&&(t=e,Laya.LocalStorage.setItem(EnumKey.SHI_WAN_HINT_TIME,t)),this.close(),Laya.timer.once(500,GameManager.UIViewsController.HomeView,GameManager.UIViewsController.HomeView.startGame)},e.prototype.to_start_game=function(){window.createVideoAd(()=>{WXUtility.pointForNew("*不试玩皮肤",ENewPointTpye.SHIWAN_START_GAME),this.onStart()})},e.prototype.updateUI=function(){this.list.refresh(),this.onStart()},e.prototype.detalReduce=function(){this.detalTime+=Laya.timer.delta/1e3},e.prototype.show_shiwan_next=function(){this.gou.visible=!this.gou.visible},e.prototype.onExchange=function(){Laya.timer.frameLoop(1,this,this.detalReduce),this.detalTime>=1?(WXUtility.aldSendEvent("点击换一批"),WXUtility.pointForNew("*点击换一批",ENewPointTpye.SHIWAN_IN_A_BATCH),this.list.array=SkinManager.getAllCanShiYongSkins(),this.list.refresh(),this.detalTime=0):NoticeView.instance.show(["刷新太快了，请稍后再试"])},e.prototype.onOpened=function(){if(this.btnStart.on(LayaEvent.CLICK,this,this.to_start_game),EventManager.addEvent(EnumKey.UPDATE_SKIN_LIST,this,this.updateUI),this.checkBox.on(LayaEvent.CLICK,this,this.show_shiwan_next),this.img_exchange.on(LayaEvent.CLICK,this,this.onExchange),this.gou.visible=!1,GameDataManager.isNewPlayerPlay){AdManager.hide("",!1,!0);var t=new Laya.Sprite;t.name="newPlayerPlay-mask",t.graphics.drawRect(-this.x,-this.y,Laya.stage.width,Laya.stage.height,"#000000"),t.alpha=.7,this.addChildAt(t,0)}else AdManager.resize(EnumAdIId.ShiWanView,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.checkWangzhe=function(){7==this.list.array[0].obtainCondition?this.haveWangzhe=!0:this.haveWangzhe=!1},e.prototype.onClosed=function(){if(this.btnStart.off(LayaEvent.CLICK,this,this.to_start_game),this.img_exchange.off(LayaEvent.CLICK,this,this.onExchange),EventManager.removeEvent(EnumKey.UPDATE_SKIN_LIST,this.updateUI),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0),AdManager.hide("",!1,!0),GameDataManager.isNewPlayerPlay){var t=this.removeChildByName("newPlayerPlay-mask");t&&t.destroy()}},e.prototype.popup=function(e,i){GameDataManager.gameState=EGameState.InShiWan,this.list.array=SkinManager.getAllCanShiYongSkins(),this.checkWangzhe(),t.prototype.popup.call(this,e,i)},e}(hole.ui.Home.ShiWanViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ShiWanRender=function(t){function e(){var e=t.call(this)||this;return e.onShareSuccess=function(){WXUtility.aldSendEvent("分享试玩成功",{"皮肤ID":e._config.id}),NoticeView.instance.show(["分享成功"]),e.ShareSucCount?e.ShareSucCount++:e.ShareSucCount=1,e.set_ShiWan()},e.btnApply.on(LayaEvent.CLICK,e,e.onApply),e.img_shiwan.on(LayaEvent.CLICK,e,e.on_seeVideo_for_skin),e.share_shiwan.on(LayaEvent.CLICK,e,e.on_share),e}return __extends(e,t),Object.defineProperty(e.prototype,"ShareSucCount",{get:function(){return this.shareSucCount=Number(Laya.LocalStorage.getItem(EnumKey.SHIWAN_SHARE_SUC_COUNT)),this.shareSucCount},set:function(t){this.shareSucCount+=t,Laya.LocalStorage.setItem(EnumKey.SHIWAN_SHARE_SUC_COUNT,this.shareSucCount+"")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isShiwaning",{get:function(){return!(!SkinManager.isUseShiWanSkin||this._config.id!=SkinManager.curUseShiwanID)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canIShiwan",{get:function(){return null!=SkinManager.allShiWanSkin.get(this._config.id)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAlreadyShiwan",{get:function(){return SkinManager.localALreadyShiWanSkin.get(this._config.id)>=GameSetting.instance.SkinDemoTimes},enumerable:!0,configurable:!0}),e.prototype.set_ShiWan=function(){WXUtility.pointForNew("*试玩皮肤",ENewPointTpye.CG_SHIWAN_START_GAME),NoticeView.instance.show(["试玩成功"]),SkinManager.add_shiwan_skin(this._config.id),SkinManager.curUseShiwanID=this._config.id,SkinManager.isUseShiWanSkin=!0,EventManager.dispatchEvent(EnumKey.UPDATE_SKIN_LIST)},e.prototype.onApply=function(){this.canIShiwan?(SkinManager.curUseShiwanID=this._config.id,SkinManager.isUseShiWanSkin=!0,EventManager.dispatchEvent(EnumKey.UPDATE_SKIN_LIST)):(SkinManager.isUseShiWanSkin=!1,SyncDataManager.curSkinId=this._config.id,EventManager.dispatchEvent(EnumKey.UPDATE_SKIN_LIST))},e.prototype.on_seeVideo_for_skin=function(){if(this._config)switch(SkinManager.judge_the_skin(this._config.id)){case 0:NoticeView.instance.show(["每个皮肤每天只能试玩一次！"]);break;case 1:NoticeView.instance.show(["该皮肤已经可以试玩了"]);break;case 2:Laya.Browser.onWeiXin?(WXUtility.aldSendEvent("点击试玩看视频"),RewardVideoManager.show(EnumShareId.SHIWAN_SHIN_VIDEO,this.onSeeVideoComplete.bind(this),this.onSeeVideoError.bind(this),"广告未播放完毕，无法获得奖励")):this.onSeeVideoComplete();break;case 3:NoticeView.instance.show(["每天最多试玩5个皮肤"])}},e.prototype.on_share=function(){if(this._config)switch(SkinManager.judge_the_skin(this._config.id)){case 0:NoticeView.instance.show(["每个皮肤每天只能试玩一次！"]);break;case 1:NoticeView.instance.show(["该皮肤已经可以试玩了"]);break;case 2:Laya.Browser.onWeiXin?(WXUtility.aldSendEvent("点击试玩分享"),this.on_share_for_skin()):this.onShareSuccess();break;case 3:NoticeView.instance.show(["每天最多试玩5个皮肤"])}},e.prototype.onSeeVideoComplete=function(t){if(t)return PlatformAPI.showToast({title:"No video to watch, please try again later."});WXUtility.aldSendEvent("看视频试玩成功",{"皮肤ID":this._config.id}),this.set_ShiWan(),this.onApply(),ShiWanView.ins.onStart()},e.prototype.onSeeVideoError=function(){WXUtility.aldSendEvent("点击试玩分享"),this.on_share_for_skin()},e.prototype.on_share_for_skin=function(){var t=new ShareInfo;t.shareId=EnumShareId.SHIWAN_SHIN_SHARE,t.successFunc=new CallBackFunc(this,this.onShareSuccess),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.onShareFail=function(){ShareUtil.shareFailtips()},e.prototype.setData=function(t,e){if(this._config=t,this.ShareSucCount<=GameSetting.instance.VideoDemoShareTimes&&ConfigUtility.IsSafeVersion&&ConfigUtility.canShareShiwan&&ConfigUtility.getRewardType==EGetRewardType.share?(this.share_shiwan.visible=!0,this.img_shiwan.visible=!1):(this.share_shiwan.visible=!1,this.img_shiwan.visible=!0),0==e?(this.img_remen.visible=!ShiWanView.ins.haveWangzhe,this.img_wangzhe.visible=ShiWanView.ins.haveWangzhe):1==e&&(this.img_remen.visible=ShiWanView.ins.haveWangzhe),t){var i=t.openDemo>0&&!this.isAlreadyShiwan,n="";if(this.hideAllBtns(),this.bg.skin="res/ui/skin/qualityBg"+t.quality+".png",this.img_shiwan.visible=!1,0==t.obtainCondition)this.imgSkin.skin=SkinManager.getSkinUIUrlByID(t.id),n="Already owned",this.lbStatus.color="#43ff01",this.lbDesc.text=this.getSkinDesc(t.skinAdd,t.skinAddValue),SkinManager.isUseShiWanSkin||SyncDataManager.curSkinId!=t.id?this.btnApply.visible=!0:this.boxSelect.visible=!0;else{var r=SkinManager.getSkinData(t.id);if(r&&(-1==r.gainTime||r.finishCount>=t.conditionalValue)){if(r.gainTime>0){var a=Laya.Browser.now(),s=Math.floor((r.gainTime-a)/36e5);s<0&&(s=0),n=s>=24?"has owned (remaining"+Math.round(s/24)+"days)":"has owned (remaining"+s+"hours)"}else n="Already owned";this.lbStatus.color="#43ff01",this.lbDesc.text=this.getSkinDesc(t.skinAdd,t.skinAddValue),this.imgSkin.skin=SkinManager.getSkinUIUrlByID(t.id),SyncDataManager.curSkinId==t.id?this.boxSelect.visible=!0:this.btnApply.visible=!0}else{i&&(this.img_shiwan.visible=!0),this.imgSkin.skin=SkinManager.getSkinUIUrlByID(t.id);var o=r?r.finishCount:0;n=5==t.obtainCondition||4==t.obtainCondition||6==t.obtainCondition?"Not owned":100==t.obtainCondition?"":"Not owned("+o+"/"+t.conditionalValue+")",this.lbStatus.color="#ff2b01",this.lbDesc.y=-3,this.lbDesc.text=this.getSkinCase(t.obtainCondition,t.conditionalValue)}}this.lbStatus.text=n,this.box.visible=!0,this.lbNull.visible=!1}else this.box.visible=!1,this.lbNull.visible=!0;t&&(this.canIShiwan&&(this.hideAllBtns(),this.btnApply.visible=!0),SkinManager.isUseShiWanSkin&&(this._config.id==SyncDataManager.curSkinId?(this.boxSelect.visible=!1,this.btnApply.visible=!0):this._config.id==SkinManager.curUseShiwanID&&(this.boxSelect.visible=!0,this.btnApply.visible=!1)))},e.prototype.hideAllBtns=function(){this.btnApply.visible=!1,this.boxSelect.visible=!1},e.prototype.getSkinCase=function(t,e){return 0==t?"初始拥有":1==t?"Accumulative landing "+e+" days":2==t?"Classic mode first "+e+" times":3==t?"Shared Share "+e+" times":4==t?"活动获得":5==t?"金币购买":6==t?"碎片兑换":7==t?"赛季王者奖励":8==t?e+" days login reward":100==t?(this.lbDesc.y=7,this.lbDesc.text=this._config.name):""},e.prototype.getSkinDesc=function(t,e){return 0==t?"无皮肤特性":1==t?"Ball speed +"+e+"%":2==t?"Ball growth +"+e+"%":""},e}(hole.ui.Home.ShiWanRenderUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),NovicePrivilegeView=function(t){function e(){var e=t.call(this)||this;e.SKIN_IDS=[15,16,17,18],e.curSelectIndex=-1,e.MIN_SEE_VIDEO_TIMES=3,e.autoShowNovice=!1,e.onSeeVideoComplete=function(t){if(t)return PlatformAPI.showToast({title:"No video to watch, please try again later."});e.updateUI(),WXUtility.aldSendEvent("新手特惠看视频")},e.onSeeVideoError=function(){ShareUtil.sharegame(EnumShareId.NOVICE_SHARE_ON_VIDEO_ERROR)},e.isModal=!0,e.closeEffect=null,e.list.selectEnable=!0,e.list.selectHandler=new Handler(e,e.selectHandler),e.list.renderHandler=Handler.create(e,e.renderHandler,null,!1);for(var i=[],n=0;n<4;n++){var r=SkinConfig.getDataById(e.SKIN_IDS[n]);i.push(r)}return e.list.array=i,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.selectHandler=function(t){GameDataManager.noviceSeeVideoTimes>=this.MIN_SEE_VIDEO_TIMES&&(this.curSelectIndex=t)},e.prototype.renderHandler=function(t,e){var i=t.dataSource,n=SkinManager.getSkinData(i.id),r=GameDataManager.noviceSeeVideoTimes>=this.MIN_SEE_VIDEO_TIMES,a=!1;n&&-1==n.gainTime&&(a=!0),t.getChildByName("imgSkin").skin=SkinManager.getSkinUIUrlByID(i.id),r||a?a?(t.getChildByName("boxSuo").visible=!1,t.getChildByName("lbYiYongYou").visible=n&&-1==n.gainTime):(t.getChildByName("boxSuo").visible=!1,t.getChildByName("imgSelect").visible=this.curSelectIndex==e,t.getChildByName("lbYiYongYou").visible=n&&-1==n.gainTime,this.btnGet.gray=!1):(t.getChildByName("boxSuo").visible=!0,t.getChildByName("imgSelect").visible=!1,t.getChildByName("lbYiYongYou").visible=!1,this.btnGet.gray=!0)},e.prototype.updateUI=function(){if(this.list.refresh(),this.lbProgress.text=GameDataManager.noviceSeeVideoTimes+"/"+this.MIN_SEE_VIDEO_TIMES,this.progressMask.graphics.drawRect(0,0,370,28,"#000000"),this.progressMask.x=370*GameDataManager.noviceSeeVideoTimes/this.MIN_SEE_VIDEO_TIMES-370,GameDataManager.noviceSeeVideoTimes>=this.MIN_SEE_VIDEO_TIMES?(this.img_video.visible=!1,this.img_share.visible=!1,this.btnGet.visible=!0,NoticeView.instance.show(["请选取一款喜爱的皮肤吧！"])):(this.btnGet.visible=!1,this.img_video.visible=!0,this.img_share.visible=ConfigUtility.IsSafeVersion),ConfigUtility.IsSafeVersion)switch(ConfigUtility.getRewardType){case EGetRewardType.video:this.img_share.visible=!1;break;case EGetRewardType.shareAndVideo:case EGetRewardType.share:}else this.img_share.visible=!1;this.img_video.visible&&0==this.img_share.visible?(this.img_video.scale(1,1),this.img_video.y=0):(this.img_video.scale(.6,.6),this.img_video.y=20),HelperExtension.ABCSetOffsetX(this.img_video,this.img_share,this.box_tmpC)},e.prototype.onGetPrize=function(){if(0==this.checkSkinIsHave()){if(GameDataManager.noviceSeeVideoTimes<this.MIN_SEE_VIDEO_TIMES)return void NoticeView.instance.show(["未完成任务不能领取"]);if(this.curSelectIndex<0)return void NoticeView.instance.show(["请选择一款皮肤"]);var t=this.list.getCell(this.curSelectIndex);if(t.getChildByName("lbYiYongYou").visible)return void NoticeView.instance.show(["该皮肤已拥有，请换一个"]);Laya.Browser.onWeiXin&&MiNi.miniHttpServer.request(EnumKey.GET_NEWBIE_REWARD,null,null,null,!0);var e=t.dataSource;SkinManager.addSkin(e.id,-1),NoticeView.instance.show(["领取皮肤成功，去皮肤界面使用吧~"]),this.checkSkinIsHave()?(Laya.LocalStorage.setItem(EnumKey.GET_NEWBIE_REWARD,"alreadyGet"),WXUtility.aldSendEvent("完成新手特惠"),Laya.LocalStorage.setItem("newbieReward",1),GameManager.UIViewsController.HomeView.btnNovicePrivilege.visible=!1,GameManager.UIViewsController.HomeView.checkBtnVisible(),this.close()):(GameDataManager.noviceSeeVideoTimes=0,Laya.LocalStorage.setItem(EnumKey.NOVICE_SEE_VIDEO_TIMES,GameDataManager.noviceSeeVideoTimes+""),this.updateUI())}else NoticeView.instance.show(["已获得4款特惠皮肤，不能再次领取哦"]),GameManager.UIViewsController.HomeView.btnNovicePrivilege.visible=!1,GameManager.UIViewsController.HomeView.checkBtnVisible(),this.close()},e.prototype.onVideo=function(){Browser.onWeiXin?RewardVideoManager.show(EnumShareId.VIDEO_DOUBLE_PRIZE,this.onSeeVideoComplete,this.onSeeVideoError,"广告未播放完毕，未增加次数"):(GameDataManager.noviceSeeVideoTimes++,this.onSeeVideoComplete())},e.prototype.onShare=function(){var t=new ShareInfo;t.shareId=EnumShareId.NOVICE_PRIVILEGE_SHARE,t.successFunc=new CallBackFunc(this,this.onShareSuc),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.onShareSuc=function(){WXUtility.aldSendEvent("新手特惠分享成功"),NoticeView.instance.show(["分享成功，3次分享能增加皮肤进度哟~"]);var t=Number(Laya.LocalStorage.getItem(EnumKey.NOVICE_SHARE_COUNT));t?++t>=3&&(GameDataManager.noviceSeeVideoTimes++,this.updateUI(),WXUtility.aldSendEvent("新手特惠分享成功"),t=0):t=1,Laya.LocalStorage.setItem(EnumKey.NOVICE_SHARE_COUNT,t+"")},e.prototype.onShareFail=function(){ShareUtil.shareFailtips()},e.prototype.popup=function(e,i,n){void 0===e&&(e=!1),GameDataManager.gameState!=EGameState.InTeamPlay&&(e?WXUtility.aldSendEvent("打开新手特惠"):WXUtility.aldSendEvent("推送新手特惠"),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1),this.updateUI(),t.prototype.popup.call(this,i,n))},e.prototype.onOpened=function(){EventManager.addEvent(EnumKey.GET_NEWBIE_REWARD,this,this.getNewbieReward),this.btnGet.on(LayaEvent.CLICK,this,this.onGetPrize),this.img_video.on(LayaEvent.CLICK,this,this.onVideo),this.img_share.on(LayaEvent.CLICK,this,this.onShare),AdManager.resize(EnumAdIId.NovicePrivilegeView,(this.y+this.ad.y)*AdapterManager.scaleRadio)},e.prototype.onClosed=function(){EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0),EventManager.removeEvent(EnumKey.GET_NEWBIE_REWARD,this.getNewbieReward),this.btnGet.off(LayaEvent.CLICK,this,this.onGetPrize),this.img_video.off(LayaEvent.CLICK,this,this.onVideo),this.img_share.off(LayaEvent.CLICK,this,this.onShare),Number(Laya.LocalStorage.getItem(EnumKey.AUTO_SHOW_NOVICE_COUNT)),this.autoShowNovice&&(Laya.timer.once(100,LotteryView.ins,LotteryView.ins.show),this.autoShowNovice=!1)},e.prototype.checkSkinIsHave=function(){for(var t=!0,e=0;e<this.SKIN_IDS.length&&0!=(t=SkinManager.isHaveSkin(this.SKIN_IDS[e]));e++);return t},e.prototype.getNewbieReward=function(t){console.log("新手特惠领奖",t),t&&t.data&&-1==t.data.code&&(NoticeView.instance.show(["已获得4款特惠皮肤，不能再次领取哦"]),GameManager.UIViewsController.HomeView.btnNovicePrivilege.visible=!1,GameManager.UIViewsController.HomeView.checkBtnVisible(),this.close())},e}(hole.ui.Home.NovicePrivilegeViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),InviteRender=function(t){function e(){var e=t.call(this)||this;return e.lbGold.text=InviteView.InvitationOnePeopleGold+"",e}return __extends(e,t),e.prototype.setData=function(t,e){this.ReceiveBtn.off(LayaEvent.CLICK,this,this.getReward),t&&(t.avatarUrl?this.img_Avatar.skin=t.avatarUrl:this.img_Avatar.skin=ConfigUtility.defaultAvatar,t.nickName?this.lbName.text=t.nickName.length<=6?t.nickName:t.nickName.substr(0,5)+"...":this.lbName.text="匿名好友",t.rewardState&&t.openId&&(1==t.rewardState?(this.ReceiveBtn.visible=!0,this.yilingqu.visible=!1,this.ReceiveBtn.on(LayaEvent.CLICK,this,this.getReward),this.openId=t.openId):(this.ReceiveBtn.visible=!1,this.yilingqu.visible=!0)))},e.prototype.getReward=function(){MiNi.miniHttpServer.request(EnumKey.GET_FRIEND_HELP_REWARD,{helpType:InviteView.Ins.helpType,openId:this.openId})},e}(hole.ui.InviteViewListRenderUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),InviteView=function(t){function e(){var i=t.call(this)||this;return i.helpType=3,i.isModal=!0,i.title_lab.text="每次邀请好友首次进入游戏可领取"+e.InvitationOnePeopleGold+"金币",i.list.itemRender=InviteRender,i.list.renderHandler=new Handler(i,i.updateItem),i.list.vScrollBarSkin="",i.list.array=[],i.closeEffect=null,i}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return null==this._ins&&(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),Object.defineProperty(e,"InvitationOnePeopleGold",{get:function(){return GameSetting.instance.hasProperty("InvitationOnePeopleGold")?GameSetting.instance.config.InvitationOnePeopleGold:200},enumerable:!0,configurable:!0}),e.prototype.updateItem=function(t,e){t.setData(t.dataSource,e)},e.toShow=function(){this.Ins.popup()},e.prototype.onInvite=function(){if(Laya.Browser.onWeiXin){var t="helpType="+this.helpType+"&openId="+ConfigUtility.openId;ShareUtil.sharegame(EnumShareId.Invite_Get_Gold,t)}WXUtility.aldSendEvent("免费金币邀请")},e.prototype.onOpened=function(){this.btn_yaoqing.on(LayaEvent.CLICK,this,this.onInvite),EventManager.addEvent(EnumKey.GET_FRIEND_HELP,this,this.onGetInviteData),EventManager.addEvent(EnumKey.GET_FRIEND_HELP_REWARD,this,this.onGetPrizeSuccess),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1),Laya.Browser.onWeiXin&&(MiNi.miniHttpServer.request(EnumKey.GET_FRIEND_HELP,{helpType:this.helpType,openId:ConfigUtility.openId}),AdManager.resize(EnumAdIId.InviteView,(this.y+this.ad.y)*AdapterManager.scaleRadio))},e.prototype.onGetPrizeSuccess=function(t){if(t&&t.data){var i=t.data;if(0==i.code)for(var n=0;n<this.listData.length;n++){var r=this.listData[n];if(r.openId==i.data.openId){NoticeView.instance.show(["领取奖励成功~"]),SyncDataManager.gold+=e.InvitationOnePeopleGold,r.rewardState=i.data.rewardState,this.list.refresh();break}}}},e.prototype.onGetInviteData=function(t){var e=[];t&&t.data&&t.data.data&&(e=t.data.data.result),this.listData=e,this.list.array=this.listData,this.lbHint.visible=0==this.listData.length,WXUtility.aldSendEvent("打开免费金币",{"邀请人数":e.length})},e.prototype.onClosed=function(){this.btn_yaoqing.off(LayaEvent.CLICK,this,this.onInvite),EventManager.removeEvent(EnumKey.GET_FRIEND_HELP,this.onGetInviteData),EventManager.removeEvent(EnumKey.GET_FRIEND_HELP_REWARD,this.onGetPrizeSuccess),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0)},e}(hole.ui.InviteViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),TeamPlayView=function(t){function e(){var e=t.call(this)||this;return e.isShowQuickReply=!0,e.tmpShowQuickReplyCount=0,e.tmpQPSendTime=0,e.screen_adapter(),e.list_team.renderHandler=new Handler(e,e.renderItem),e.list_team.itemRender=TeamPlayerItem,e.chatView=new ChatView,e.panel_chat_node.addChild(e.chatView),ConfigUtility.isAuthorization||Laya.Browser.onWeiXin&&wx.createUserInfoButton&&(e._loginBtn=wx.createUserInfoButton({type:"text",text:"",style:{left:(e.btn_start_game_or_ready.x+AdapterManager.offsetX)*AdapterManager.scaleRadio,top:(e.btn_start_game_or_ready.y+AdapterManager.offsetY)*AdapterManager.scaleRadio,width:174*AdapterManager.scaleRadio,height:60*AdapterManager.scaleRadio,lineHeight:0,backgroundColor:"#FF000000",color:"#ffffff",textAlign:"center",fontSize:0,borderRadius:4}}),e._loginBtn.onTap(e.onLogin.bind(e))),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.onLogin=function(t){if(ConfigUtility.isAuthorization)return this._loginBtn.hide(),void this.on_startGame_or_ready();!ConfigUtility.userInfo&&t.userInfo&&(MiNi.miniHttpServer.login(),this._loginBtn&&this._loginBtn.hide()),ConfigUtility.userInfo=t.userInfo},e.prototype.screen_adapter=function(){this.y=AdapterManager.offsetY,this.x=AdapterManager.offsetX,0==this.x&&0==this.y||(this.img_background.size(Laya.Browser.clientWidth/AdapterManager.designScreenRadio,Laya.Browser.clientHeight/AdapterManager.designScreenRadio),this.img_background.y=-this.y,this.img_background.x=-this.x)},e.prototype.onShow=function(){TeamManager.isTeamMaster&&MainSocket.C2S_TEAM_START_OR_CANCEL_READY(ETeamPlayerState.READY),GameManager.CurrentGameMode=EGameMode.Survive,GameDataManager.gameState=EGameState.InTeamPlay,HomeView.Ins.setClickStartTime(),Dialog.closeAll(),Laya.timer.once(500,this,this.delayHideAD),this.addEvents(),this.update_team_list(),Laya.stage.addChild(this)},e.prototype.delayHideAD=function(){AdManager.hide("",!1,!0)},e.prototype.addEvents=function(){EventManager.addEvent(EnumKey.UPDATE_TEAM_LIST,this,this.update_team_list),this.btn_back.on(LayaEvent.CLICK,this,this.on_back),this.btn_invite.on(LayaEvent.CLICK,this,this.on_invite),this.btn_start_game_or_ready.on(LayaEvent.CLICK,this,this.on_startGame_or_ready),this.btn_quick_reply.on(LayaEvent.CLICK,this,this.on_quick_reply),this.lb_quick100.on(LayaEvent.CLICK,this,this.on_send_quick_reply,[100]),this.lb_quick101.on(LayaEvent.CLICK,this,this.on_send_quick_reply,[101]),this.lb_quick102.on(LayaEvent.CLICK,this,this.on_send_quick_reply,[102]),this.lb_quick103.on(LayaEvent.CLICK,this,this.on_send_quick_reply,[103]),this.lb_quick104.on(LayaEvent.CLICK,this,this.on_send_quick_reply,[104]),this.lb_quick105.on(LayaEvent.CLICK,this,this.on_send_quick_reply,[105])},e.prototype.removeEvents=function(){EventManager.removeEvent(EnumKey.UPDATE_TEAM_LIST,this.update_team_list),this.btn_back.off(LayaEvent.CLICK,this,this.on_back),this.btn_invite.off(LayaEvent.CLICK,this,this.on_invite),this.btn_start_game_or_ready.off(LayaEvent.CLICK,this,this.on_startGame_or_ready),this.btn_quick_reply.off(LayaEvent.CLICK,this,this.on_quick_reply),this.lb_quick100.off(LayaEvent.CLICK,this,this.on_send_quick_reply),this.lb_quick101.off(LayaEvent.CLICK,this,this.on_send_quick_reply),this.lb_quick102.off(LayaEvent.CLICK,this,this.on_send_quick_reply),this.lb_quick103.off(LayaEvent.CLICK,this,this.on_send_quick_reply),this.lb_quick104.off(LayaEvent.CLICK,this,this.on_send_quick_reply),this.lb_quick105.off(LayaEvent.CLICK,this,this.on_send_quick_reply)},e.prototype.onHide=function(){Laya.timer.clear(this,this.delayHideAD),this.removeEvents(),Laya.stage.removeChild(this),Laya.Pool.recover("TeamPlayView",this)},e.prototype.on_back=function(){PromptInterfaceView.Ins.onShow("取消","确定","您确定要离开队伍吗？",this.on_cancel_exit.bind(this),this.on_exit_team.bind(this))},e.prototype.on_cancel_exit=function(){PromptInterfaceView.Ins.hide()},e.prototype.to_invite=function(){this.on_invite()},e.prototype.on_invite=function(){if(Laya.Browser.onWeiXin){wx.shareAppMessage({success:function(){}})}},e.prototype.exitTeam=function(){NoticeView.instance.show(["由于您未及时准备，已被系统请出队伍"]),this.on_exit_team()},e.prototype.on_exit_team=function(){PromptInterfaceView.Ins.hide(),this.onHide(),HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME),MainSocket.C2S_LEAVE_TEAM(),TeamManager.clearAll(),WXUtility.point_with_new("点击组队返回",{},ENewPointTpye.CLICK_TEAM_BACK)},e.prototype.startGame=function(){this.on_startGame_or_ready()},e.prototype.on_startGame_or_ready=function(){if(WXUtility.point_with_new("点击组队准备",{},ENewPointTpye.CLICK_TEAM_READY),TeamManager.teamMasterOpenID==ConfigUtility.openId)switch(TeamManager.can_i_start_game()){case ETeamState.CAN_START_GAME:WXUtility.point_with_new("开始游戏（吃鸡）",{},ENewPointTpye.SURVIVE_START_GAME),NoticeView.instance.show(["游戏马上开始！"]),MainSocket.C2S_TEAM_START_MATCH_GAME();break;case ETeamState.NOT_ALL_READY:NoticeView.instance.show(["抱歉，有玩家还未准备！"]);break;case ETeamState.SOME_IN_GAME:NoticeView.instance.show(["抱歉，有玩家还在游戏中！"])}else{if(this.selfTp){switch(this.selfTp.state){case ETeamPlayerState.NOT_READY:this.selfTp.state=ETeamPlayerState.READY,MainSocket.C2S_TEAM_START_OR_CANCEL_READY(this.selfTp.state);break;case ETeamPlayerState.READY:this.selfTp.state=ETeamPlayerState.NOT_READY,MainSocket.C2S_TEAM_START_OR_CANCEL_READY(this.selfTp.state);break;case ETeamPlayerState.IN_GAME:}this.set_btn_start_game_or_ready_state(this.selfTp.state),TeamManager.check_auto_exitTeam(this.selfTp)}this.list_team.refresh()}},e.prototype.on_quick_reply=function(){this.isShowQuickReply=!this.isShowQuickReply,this.isShowQuickReply?Laya.Tween.to(this.img_reply_BG,{scaleY:1},200,null,null,0,!1):Laya.Tween.to(this.img_reply_BG,{scaleY:0},200,null,null,0,!1)},e.prototype.on_send_quick_reply=function(t){if(0==this.tmpShowQuickReplyCount)this.tmpQPSendTime=Laya.timer.currTimer;else if(2==this.tmpShowQuickReplyCount){if(Laya.timer.currTimer-this.tmpQPSendTime<2e3)return Laya.timer.once(2e3,this,this.reset_tmpShowQuickReplyCount,[],!1),NoticeView.instance.show(["您说话太快了，请等一会吧~"]),void(this.tmpShowQuickReplyCount=4);this.tmpShowQuickReplyCount=0,this.tmpQPSendTime=Laya.timer.currTimer}else if(this.tmpShowQuickReplyCount>2)return;WXUtility.point_with_new("点击快捷按钮",{},ENewPointTpye.CLICK_QUICK);var e=t-99;switch(e){case 1:WXUtility.point_with_new("发送快捷内容"+e,{},ENewPointTpye.QUICK_1);break;case 2:WXUtility.point_with_new("发送快捷内容"+e,{},ENewPointTpye.QUICK_2);break;case 3:WXUtility.point_with_new("发送快捷内容"+e,{},ENewPointTpye.QUICK_3);break;case 4:WXUtility.point_with_new("发送快捷内容"+e,{},ENewPointTpye.QUICK_4);break;case 5:WXUtility.point_with_new("发送快捷内容"+e,{},ENewPointTpye.QUICK_5);break;case 6:WXUtility.point_with_new("发送快捷内容"+e,{},ENewPointTpye.QUICK_6)}var i=this.img_reply_BG.getChildByName("lb_quick"+t);i&&(MainSocket.C2S_CHAT(EChatType.TEAM,t),this.addChatMessage(ConfigUtility.userNickName,"",i.text,EChatType.TEAM,EGenderType.MINE),this.tmpShowQuickReplyCount++)},e.prototype.reset_tmpShowQuickReplyCount=function(){this.tmpShowQuickReplyCount=0},e.prototype.update_team_list=function(){var t=TeamManager.teamPlayerListData;this.text_team_num.text="当前人数："+t.length+"/"+TeamManager.maxTeamPlayerCount;var e=new Array(TeamManager.maxTeamPlayerCount-t.length);t=t.concat(e),this.list_team.array=t,this.list_team.refresh(),ConfigUtility.openId!=TeamManager.teamMasterOpenID?(this.selfTp=TeamManager.get_team_player(ConfigUtility.openId),this.selfTp&&(this.set_btn_start_game_or_ready_state(this.selfTp.state),TeamManager.check_auto_exitTeam(this.selfTp))):(this.btn_start_game_Lab.text="直接开始",this.btn_start_game_Lab.color="#c56123",this.btn_start_game_or_ready.skin="res/ui/game/img_fenxiangfuhuox.png")},e.prototype.renderItem=function(t,e){var i=t.dataSource;t.setData(i,e)},e.prototype.set_btn_start_game_or_ready_state=function(t){switch(t){case ETeamPlayerState.NOT_READY:this.btn_start_game_Lab.text="准备",this.btn_start_game_Lab.color="#336d13",this.btn_start_game_or_ready.skin="res/ui/TeamPlay/btn_zhunbei.png";break;case ETeamPlayerState.READY:this.btn_start_game_Lab.text="取消准备",this.btn_start_game_Lab.color="#c56123",this.btn_start_game_or_ready.skin="res/ui/game/img_fenxiangfuhuox.png";break;case ETeamPlayerState.IN_GAME:}},e.prototype.set_not_ready=function(){ConfigUtility.openId!=TeamManager.teamMasterOpenID&&(this.btn_start_game_Lab.text="取消准备",this.btn_start_game_Lab.color="#c56123",this.btn_start_game_or_ready.skin="res/ui/game/img_fenxiangfuhuox.png",this.selfTp=TeamManager.get_team_player(ConfigUtility.openId),this.selfTp&&(this.selfTp.state=ETeamPlayerState.NOT_READY),this.update_team_list())},e.prototype.clearChatData=function(){this.chatView.clearChatData()},e.prototype.on_S2C_CHAT=function(t,i,n){if(t!=ConfigUtility.openId){var r=MessageConfig.instance.allMessage.get(i),a=TeamManager.get_team_player(t);a&&r&&e.instance.addChatMessage(a.nickName,"",r.message,n,a.gender)}},e.prototype.addChatMessage=function(t,e,i,n,r,a,s,o){this.chatView.msgReceive(t,e,i,n,r)},e.prototype.addSystemMessage=function(t,e,i,n,r,a){this.chatView.msgReceive(t,"",e,i)},e}(hole.ui.Home.TeamPlayViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),TeamPlayerItem=function(t){function e(){var e=t.call(this)||this;return e.btn_close.on(LayaEvent.CLICK,e,e.on_close),e.img_jiahao.on(LayaEvent.CLICK,e,e.on_jiaHao),e}return __extends(e,t),e.prototype.setData=function(t,e){if(t){if(this.box_player_data.visible=!0,this.img_jiahao.visible=!1,this.img_avatar.skin=t.avatarUrl,this.lb_nickName.text=HelperExtension.shiftName(t.nickName),TeamManager.teamMasterOpenID==ConfigUtility.openId&&t.openId!=ConfigUtility.openId?this.btn_close.visible=!0:this.btn_close.visible=!1,TeamManager.teamMasterOpenID==t.openId)this.img_duizhang.visible=!0,t.state!=ETeamPlayerState.IN_GAME?this.img_state.visible=!1:(this.img_state.visible=!0,this.img_state.skin="res/ui/TeamPlay/youxizhong.png");else switch(this.img_duizhang.visible=!1,this.img_state.visible=!0,t.state){case ETeamPlayerState.NOT_READY:this.img_state.skin="res/ui/TeamPlay/weizhunbei.png";break;case ETeamPlayerState.READY:this.img_state.skin="res/ui/TeamPlay/zhunbei.png";break;case ETeamPlayerState.IN_GAME:this.img_state.skin="res/ui/TeamPlay/youxizhong.png"}t.openId==ConfigUtility.openId?this.lb_nickName.color="#00ff33":this.lb_nickName.color="#ffffff",(null==t.score||t.score<0)&&(t.score=0);var i=RankDataManager.getRankDataByScore(t.score);this.img_rankIcon.skin="res/ui/common/duanwei_"+(i.rankType||1)+".png",this.lb_rank.text=i.rankName}else this.box_player_data.visible=!1,this.img_jiahao.visible=!0},e.prototype.on_close=function(){PromptInterfaceView.Ins.onShow("取消","确定","您确定要踢出该队员吗？",this.to_cancel_close.bind(this),this.to_close.bind(this))},e.prototype.to_close=function(){var t=this.dataSource;t&&MainSocket.C2S_KICK_OUT_TEAM_MEMBER(t.openId),PromptInterfaceView.Ins.hide()},e.prototype.to_cancel_close=function(){PromptInterfaceView.Ins.hide()},e.prototype.on_jiaHao=function(){TeamPlayView.instance.to_invite()},e}(hole.ui.Home.TeamPlayerItemUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ChatLineView=function(t){function e(){var e=t.call(this)||this;return e.chatLineWidth=640,e.chatLineHeight_offset=2,e}return __extends(e,t),e.prototype.setUp=function(t,e,i){void 0!==t&&(this.chatLineWidth=t),void 0!==e&&(this.chatLineHeight_offset=e),void 0!==i&&null==this.textfiled&&(this.textfiled=new Laya.HTMLDivElement,this.addChild(this.textfiled),this.textfiled.style.color=i.color,this.textfiled.style.fontFamily=i.fontFamily,this.textfiled.style.fontSize=i.fontSize,this.textfiled.style.valign=i.valign)},e.prototype.init=function(t,e,i,n,r){console.log("chat:",t),this.pos(0,0),null==this.textfiled&&(this.textfiled=new Laya.HTMLDivElement,this.addChild(this.textfiled),this.textfiled.style.color="#ffffff",this.textfiled.style.fontFamily="黑体",this.textfiled.style.fontSize=20,this.textfiled.style.valign="middle"),this.textfiled.width=this.chatLineWidth;var a,s="#f5ff00";if(void 0!==r)switch(r){case EGenderType.BOY:s="#3beaff";break;case EGenderType.GIRL:s="#d65aff";break;case EGenderType.MINE:s="#00ff33"}a="<span style='color:"+s+";bold:true;'>"+t+"：</span>";var o=i;this.textfiled.innerHTML=a+o,this.textfiled.height=this.textfiled.contextHeight+this.chatLineHeight_offset},e}(Box),ChatView=function(t){function e(){var e=t.call(this)||this;return e.chatLineArr=new Array,e.msgTotalHeight=0,e.chatPanel.vScrollBarSkin="",e.chatPanel.vScrollBar.isVertical=!0,e.chatPanel.vScrollBar.elasticBackTime=600,e.chatPanel.vScrollBar.elasticDistance=200,e}return __extends(e,t),e.prototype.msgReceive=function(t,e,i,n,r,a,s,o){var l=Laya.Pool.getItemByClass("chatLine",ChatLineView);if(l.setUp(a,s,o),l.init(t,e,i,n,r),this.chatPanel.addChild(l),this.chatLineArr.length>15){var h=this.chatLineArr.shift();h.removeSelf(),Laya.Pool.recover("chatLine",h),this.reChatLinePos()}l.y=this.msgTotalHeight,this.msgTotalHeight+=l.height,this.chatLineArr.push(l),this.chatPanel.vScrollBar.max=this.chatPanel.contentHeight,this.chatPanel.vScrollBar.value=this.chatPanel.vScrollBar.max},e.prototype.reChatLinePos=function(){this.msgTotalHeight=0;for(var t,e=0,i=this.chatLineArr.length;e<i;e++)(t=this.chatLineArr[e]).y=this.msgTotalHeight,this.msgTotalHeight+=t.height},e.prototype.test_msg=function(){var t=ConfigUtility.userNickName,e=ConfigUtility.userAvatar,i="哈哈哈 ： "+(new Date).toString(),n=HelperExtension.coinTest()?EChatType.TEAM:EChatType.WORLD,r=HelperExtension.coinTest()?EGenderType.BOY:EGenderType.GIRL;this.msgReceive(t,e,i,n,r)},e.prototype.clearChatData=function(){for(var t=this.chatLineArr.length;t>0;){var e=this.chatLineArr.shift();e.removeSelf(),Laya.Pool.recover("chatLine",e),t--}this.chatLineArr=new Array,this.msgTotalHeight=0},e}(hole.ui.Home.ChatViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),SettingView=function(t){function e(){var e=t.call(this)||this;return e.isModal=!0,e.closeEffect=null,e.popupEffect=null,e.clubLeft=(e.x+e.spClub.x)*AdapterManager.scaleRadio+AdapterManager.offsetX,e.clubTop=(e.y+e.spClub.y)*AdapterManager.scaleRadio+AdapterManager.offsetY,e.feedLeft=(e.x+e.spTousu.x)*AdapterManager.scaleRadio+AdapterManager.offsetX,e.feedTop=(e.y+e.spTousu.y)*AdapterManager.scaleRadio+AdapterManager.offsetY,e.createBtn(),e}return __extends(e,t),Object.defineProperty(e.prototype,"FeedBackButton",{get:function(){return this.feedBackButton},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Ins",{get:function(){return null==this.ins&&(this.ins=new e),this.ins},enumerable:!0,configurable:!0}),e.prototype.onOpened=function(){this.addEvents(),AudioController.AudioState?(this.audio_on.visible=!0,this.audio_off.visible=!1):(this.audio_on.visible=!1,this.audio_off.visible=!0),AudioController.MusicState?(this.music_on.visible=!0,this.music_off.visible=!1):(this.music_on.visible=!1,this.music_off.visible=!0),AudioController.ShakeState?(this.shake_on.visible=!0,this.shake_off.visible=!1):(this.shake_on.visible=!1,this.shake_off.visible=!0),this.feedBackButton&&this.clubButton&&(this.feedBackButton.style.left=this.feedLeft,this.feedBackButton.style.top=this.feedTop,this.feedBackButton.show(),this.clubButton.style.left=this.clubLeft,this.clubButton.style.top=this.clubTop,this.clubButton.show()),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!1)},e.prototype.onClosed=function(){this.removeEvents(),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0)},e.prototype.addEvents=function(){this.music_on.on(LayaEvent.CLICK,this,this.on_music_on),this.music_off.on(LayaEvent.CLICK,this,this.on_music_off),this.audio_on.on(LayaEvent.CLICK,this,this.on_audio_on),this.audio_off.on(LayaEvent.CLICK,this,this.on_audio_off),this.shake_on.on(LayaEvent.CLICK,this,this.on_shake_on),this.shake_off.on(LayaEvent.CLICK,this,this.on_shake_off),this.sp.on(LayaEvent.CLICK,this,this.Hide)},e.prototype.removeEvents=function(){this.music_on.off(LayaEvent.CLICK,this,this.on_music_on),this.music_off.off(LayaEvent.CLICK,this,this.on_music_off),this.audio_on.off(LayaEvent.CLICK,this,this.on_audio_on),this.audio_off.off(LayaEvent.CLICK,this,this.on_audio_off)},e.prototype.on_music_on=function(){this.music_off.visible=!0,this.music_on.visible=!1,AudioController.MusicState=!1},e.prototype.on_music_off=function(){this.music_off.visible=!1,this.music_on.visible=!0,AudioController.MusicState=!0},e.prototype.on_audio_on=function(){this.audio_on.visible=!1,this.audio_off.visible=!0,AudioController.AudioState=!1},e.prototype.on_audio_off=function(){this.audio_on.visible=!0,this.audio_off.visible=!1,AudioController.AudioState=!0},e.prototype.on_shake_on=function(){this.shake_on.visible=!1,this.shake_off.visible=!0,AudioController.ShakeState=!1},e.prototype.on_shake_off=function(){this.shake_off.visible=!1,this.shake_on.visible=!0,AudioController.ShakeState=!0},e.prototype.Hide=function(){this.sp.off(LayaEvent.CLICK,this,this.Hide),this.feedBackButton&&this.clubButton&&(this.feedBackButton.hide(),this.clubButton.hide()),HowToPlayIcon.Instance.hide(),this.close()},e.prototype.createBtn=function(){if(wx.createGameClubButton){var t={type:"image",image:"res/image/gameClub.png"},e={};t.style=e,e.left=this.clubLeft,e.top=this.clubTop,e.width=82*AdapterManager.scaleRadio,e.height=95*AdapterManager.scaleRadio,this.clubButton=wx.createGameClubButton(t),this.clubButton.hide()}wx.createFeedbackButton&&(this.feedBackButton=wx.createFeedbackButton({type:"image",image:"res/image/tousufankui.png",style:{left:this.feedLeft,top:this.feedTop,width:82*AdapterManager.scaleRadio,height:95*AdapterManager.scaleRadio}}),this.feedBackButton.hide())},e}(hole.ui.Home.SettingViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ClassicOverView=function(t){function e(){var e=t.call(this)||this;e.isGotDouble=!1,e.onSeeVideoError=function(){e.onShare()},e.onDoubleGoldShareSuccess=function(){e.isGotDouble?(NoticeView.instance.show(["炫耀成功!"]),e.onRestart()):(WXUtility.aldSendEvent("结算分享"),WXUtility.pointForNew_muti("*分享3倍"),e.addDoublePrize(),e.onRestart())},e.onSeeVideoComplete=function(){WXUtility.aldSendEvent("结算看视频"),WXUtility.pointForNew_muti("*视频3倍"),e.addDoublePrize(),e.onRestart()},e.screen_adapter(),e.prev_img_rank_x=e.img_rank.x,e.prev_img_rank_y=e.img_rank.y,e.rank_list.vScrollBarSkin="",e.rank_list.selectEnable=!0,e.rank_list.cacheContent=!0,e.rank_list.renderHandler=new laya.utils.Handler(e,e.renderItem),e.itemGrid1=new ItemGrid,e.itemGrid1.setIcon(1e3),e.boxPrize.addChild(e.itemGrid1),e.itemGrid1.addChild(e.imgDouble1),e.imgDouble1.x=2,e.imgDouble1.y=2,e.itemGrid2=new ItemGrid,e.itemGrid2.x=100,e.boxPrize.addChild(e.itemGrid2),e.itemGrid2.addChild(e.imgDouble2),e.imgDouble2.x=2,e.imgDouble2.y=2;var i=new Laya.Sprite;return i.name="gameover-mask",i.graphics.drawRect(0,-AdapterManager.offsetY,Laya.stage.width,Laya.stage.height,"#000000"),i.alpha=.6,e.addChildAt(i,0),e.timeLine=new Laya.TimeLine,e.timeLine.addLabel("1",0).to(e.btnDoublePrize,{scaleX:e.btnDoublePrize.scaleX+.2,scaleY:e.btnDoublePrize.scaleY+.2},160,null,0).addLabel("2",0).to(e.btnDoublePrize,{scaleX:e.btnDoublePrize.scaleX,scaleY:e.btnDoublePrize.scaleY},160,null,0).addLabel("3",0).to(e.btnShare,{scaleX:1.2,scaleY:1.2},160,null,0).addLabel("4",0).to(e.btnShare,{scaleX:1,scaleY:1},160,null,0).addLabel("5",0).to(e.img6Bei,{scaleX:1.2,scaleY:1.2},160,null,0).addLabel("6",0).to(e.img6Bei,{scaleX:1,scaleY:1},160,null,0).addLabel("7",0).to(e.btnShareForDP,{scaleX:e.btnShareForDP.scaleX+.2,scaleY:e.btnShareForDP.scaleY+.2},160,null,0).addLabel("8",0).to(e.btnShareForDP,{scaleX:e.btnShareForDP.scaleX,scaleY:e.btnShareForDP.scaleY},160,null,0),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e.ins&&(e.ins=new e),e.ins},enumerable:!0,configurable:!0}),e.prototype.screen_adapter=function(){this.y=AdapterManager.offsetY,this.x=AdapterManager.offsetX},e.prototype.onShow=function(){if(PlatformAPI.createVideoAd("over",t=>{t||GameDataManager.addSeeVideoTimes(),console.error("overvideo")}),WXUtility.pointForNew("*碾碎球球",ENewPointTpye.KILL_NUM,{"击杀数":GameManager.PlayerEntity.kill}),WXUtility.pointForNew("*进入结算",ENewPointTpye.GAME_OVER_CLASSIC),WXUtility.aldSendEvent("进入结算_经典模式"),this.timeLine.play(0,!0),this.isFirstWin=!1,this.isGotDouble=!1,HowToPlayIcon.Instance.hide(),this.add_events(),this.update_rank_data(),this.update_player_data(),AudioController.play(ESoundType.game_over),AdManager.show(AdManager.RESULT_AD,EnumAdIId.CLASSIC_OVER_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio),this.ani_flash.play(0,!0),this.addGold=0,this.chipPrize=null,this.itemGrid2.visible=!1,!GameDataManager.isPassMaxRound){var t=ScoreConfig.config[GameManager.PlayerEntity.rank-1].settlementRewardCoin;if(t){var e=t.split(":");this.addGold=e&&e.length>1?Number(e[1]):0}}if(ConfigUtility.IsSafeVersion)switch(this.showFriendhelpView(),ConfigUtility.getRewardType){case EGetRewardType.video:this.updateUI(!0,!1);break;case EGetRewardType.shareAndVideo:this.updateUI(!0,!0);break;case EGetRewardType.share:ShareUtil.CurShareSucCount<GameSetting.instance.VideoOpenTimes&&ConfigUtility.shareSucCountEnoughToShowVideo?this.updateUI(!1,!0):GameDataManager.isSeeAllVideo?this.updateUI(!1,!0):this.updateUI(!0,!0)}else GameDataManager.isSeeAllVideo?this.updateUI(!1,!1):this.updateUI(!0,!1),this.img_double_percent.visible=!1,this.img6Bei.visible=!1,this.boxPrize.visible=!1;HelperExtension.ABCSetOffsetX(this.btnDoublePrize,this.btnShareForDP,this),Laya.stage.addChild(this)},e.prototype.updateUI=function(t,e){this.addGold>0?(this.isFirstWin?(this.addGold*=2,this.lbPrizeDesc.visible=!1,this.img_jiangli.visible=!1,this.imgDouble1.visible=this.imgDouble2.visible=!0,this.img6Bei.visible=!0,this.multipleText.text="+600%",this.lbPrizeDesc.text=""):(this.img6Bei.visible=!1,this.imgDouble1.visible=this.imgDouble2.visible=!1,this.lbPrizeDesc.visible=!0,this.img_jiangli.visible=!0,this.lbPrizeDesc.text="获得奖励",this.multipleText.text="+300%"),this.boxDouble.visible=!0,this.itemGrid1.count=this.addGold,this.btnDoublePrize.visible=!0,this.btnShareForDP.visible=e,this.chipPrize=this.getChipPrize(),this.chipPrize?(this.itemGrid2.visible=!0,this.boxPrize.x=0,this.itemGrid2.setIcon(this.chipPrize.skinBitsId),this.itemGrid2.count=this.isFirstWin?2*this.chipPrize.num:this.chipPrize.num,SyncDataManager.addChipData(this.chipPrize.skinBitsId,this.isFirstWin?2*this.chipPrize.num:this.chipPrize.num)):this.boxPrize.x=47,this.img6Bei.skin=t?"res/ui/gameover/zi.png":"res/ui/gameover/fenxiang6.png",this.img_double_percent.visible=this.btnDoublePrize.visible||this.btnShareForDP.visible,SyncDataManager.gold+=this.addGold):(this.isGotDouble=!0,this.lbPrizeDesc.text=GameDataManager.isPassMaxRound?"已达今日金币奖励次数上限":"未获得排名奖励",this.img_jiangli.visible=!1,this.boxDouble.visible=!1,this.img6Bei.visible=!1,this.btnDoublePrize.visible=!1,this.btnShareForDP.visible=!1,this.img_double_percent.visible=!1,this.btnShare.visible=!1,this.img_double_percent.visible=!1,this.boxPrize.x=47),this.boxDouble.visible=!0,this.itemGrid1.count=this.addGold,this.btnShareForDP.visible||this.btnDoublePrize.visible,this.btnShare.visible=!1,this.ani_flash.visible=this.btnShare.visible,this.img_jiangli.visible=!this.img6Bei.visible,this.img_jiangli.visible=this.lbPrizeDesc.visible=!1},e.prototype.showFriendhelpView=function(){var t=TimeUtil.getTimeStr(),e=Laya.LocalStorage.getItem(EnumKey.AUTO_SHOW_FRIEND);if(GameDataManager.rankForAuthorizeTimes<2&&HelperExtension.coinTest(.7)&&t==e){var i=Number(Laya.LocalStorage.getItem(EnumKey.AUTO_SHOW_NOVICE_COUNT));i||(i=0),!GameDataManager.newbieReward&&i<3?(NovicePrivilegeView.ins.popup(),Laya.LocalStorage.setItem(EnumKey.AUTO_SHOW_NOVIVE,t),i++,Laya.LocalStorage.setItem(EnumKey.AUTO_SHOW_NOVICE_COUNT,i+"")):(Laya.timer.once(200,this,this.clickAllRank),GameDataManager.rankForAuthorizeTimes++)}if(t!=e){var n=SkinManager.getSkinData(FriendHelpView.instance.rewardSkinID);(n&&-1!=n.gainTime||!n)&&FriendHelpView.instance.toShow(!0),Laya.LocalStorage.setItem(EnumKey.AUTO_SHOW_FRIEND,t)}},e.prototype.toGetChipPrize=function(){return this.getChipPrize()},e.prototype.getChipPrize=function(){if(NumberUtil.randRange(0,100)>GameSetting.instance.dropChipRate)return null;var t=SettlementCfg.instance.getAllRandomData(),e=0;t.forEach(function(t){e+=t.weight});for(var i=null,n=NumberUtil.randRange(1,e),r=0;r<t.length;r++){var a=t[r];if(n<=a.weight){i=a;break}n-=a.weight}return i},e.prototype.update_rank_data=function(){for(var t=DetectManager.Instance.sort_rank(),e=new Array,i=0;i<t.length&&!(i>=ScoreConfig.config.length);++i){var n=ScoreConfig.config[i].score,r=!1;RankDataManager.isRankProtect&&n<0&&(n=0,r=!0),e.push({rank:t[i].rank,weight:t[i].weight,name:t[i].name,score:n,avatarUrl:t[i].avatarUrl,isNeedProtect:r})}this.rank_list.array=e},e.prototype.update_player_data=function(){var t=GameManager.PlayerEntity.rank;if(1==t&&Laya.Browser.onWeiXin&&SkinManager.setSkinData(EnumKey.SKIN_GET_CONDITION_2,1),t<=3){this.img_rank.visible=!0,this.lbRank.visible=!1,this.img_rank.skin="res/ui/gameover/jiangpai"+t+".png",this.img_di2.skin="res/ui/gameover/paiming"+t+".png",GameDataManager.ClassicPlayerGameData.winnerComboTimes++,GameDataManager.ClassicPlayerGameData.winnerTimes++,GameDataManager.ClassicPlayerGameData.loserComboTimes=0;var e=TimeUtil.getTimeStr();GameDataManager.firstWinTime!=e&&(GameDataManager.firstWinTime=e,this.isFirstWin=!0,Laya.LocalStorage.setItem(EnumKey.FIRST_WIN_TIME,e))}else t<=9&&t>3?(this.img_rank.visible=!1,this.lbRank.visible=!0,this.lbRank.text=t+"",this.img_di2.skin="res/ui/gameover/paiming.png",GameDataManager.ClassicPlayerGameData.winnerComboTimes=0,GameDataManager.ClassicPlayerGameData.loserComboTimes=0):(this.img_rank.visible=!1,this.lbRank.visible=!0,this.lbRank.text=t+"",this.img_di2.skin="res/ui/gameover/paiming.png",GameDataManager.ClassicPlayerGameData.winnerComboTimes=0,GameDataManager.ClassicPlayerGameData.loserComboTimes++);this.text_weight.text=GameManager.PlayerEntity.weight+"",this.text_name.text=HelperExtension.shiftName(GameManager.PlayerEntity.name);var i=ScoreConfig.config[GameManager.PlayerEntity.rank-1].score;RankDataManager.isRankProtect&&i<0?(i=0,this.text_protect.visible=!0):this.text_protect.visible=!1;var n=i>=0;this.text_score.text=n?"+"+i:""+i,this.text_score.color=n?"#4169E1":"#f60c00",this.img_avatar.skin=GameManager.PlayerEntity.avatarUrl,GameDataManager.ClassicPlayerGameData.playTimes++,SyncDataManager.addDailyDataOnce(EnumDailyID.GAME_ROUND),EventManager.dispatchEvent(EDataUpdateType.ClassicPlayerGameDataUpdate)},e.prototype.omImgTitleTweenComplete=function(t){for(var e=0;e<5;e++){var i=this.rank_list.cells[e];Laya.Tween.to(i,{y:t[4-e],alpha:1},300,null,null,300*e)}Laya.timer.once(1500,this,this.delayShowImg)},e.prototype.delayShowImg=function(){this.boxBtns.visible=!0,this.ani_flash.play(0,!0)},e.prototype.showFriendHelp=function(){FriendHelpView.instance.toShow(!0)},e.prototype.onHide=function(){this.remove_events(),this.removeSelf(),this.rank_list.array=null,this.ani_flash.stop(),this.timeLine.pause()},e.prototype.add_events=function(){this.btnShareForDP.visible=!1,this.btnShare.visible=!1,this.btnDoublePrize.on("click",this,this.onDoublePrize),this.btnShareForDP.on("click",this,this.onDouleShare),this.btnShare.on(LayaEvent.CLICK,this,this.onShare),this.img_back_home.on("click",this,this.on_back_home),this.reStart.on("click",this,this.on_back_home),this.btnAllRank.clickHandler=Handler.create(this,this.clickAllRank,null,!1)},e.prototype.remove_events=function(){this.btnDoublePrize.off("click",this,this.onDoublePrize),this.btnShareForDP.off("click",this,this.onDouleShare),this.btnShare.off(LayaEvent.CLICK,this,this.onShare),this.img_back_home.off("click",this,this.on_back_home),this.btnAllRank.clickHandler=null,this.reStart.off("click",this,this.on_back_home)},e.prototype.onRestart=function(){WXUtility.aldSendEvent("再来一局"),WXUtility.pointForNew("*再来一局",ENewPointTpye.CLASSIC_OVER_RESTART),HomeView.Ins.clickRestart=!0,HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_exit_game),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.SCENE),this.onHide(),HomeView.Ins.on_start_game(EGameMode.Classic)},e.prototype.clickAllRank=function(){HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.RANK)},e.prototype.clickGroupRank=function(){ShareUtil.shareForGroupRank(EnumShareId.SHARE_gameover_group_rank)},e.prototype.onDoublePrize=function(){this.seeVideo()},e.prototype.onDouleShare=function(){var t=new ShareInfo;t.shareId=EnumShareId.SHARE_DOUBLE_PRIZE,t.successFunc=new CallBackFunc(this,this.onDoubleGoldShareSuccess),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.onShare=function(){var t=new ShareInfo;t.shareId=EnumShareId.SHARE_GAMEOVER_SHOW,t.successFunc=new CallBackFunc(this,function(){NoticeView.instance.show(["炫耀成功"])}),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.on_back_home=function(){WXUtility.pointForNew("*结算返回",ENewPointTpye.CLASSIC_BACKWARD),HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_exit_game),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.SCENE),this.onHide()},e.prototype.renderItem=function(t,e){var i,n=t.dataSource;i=t.getChildByName("text_score");var r,a=n.score>=0;i.text=a?"+"+n.score:""+n.score,i.color=a?"#4169E1":"#f60c00",(i=t.getChildByName("text_weight")).text=n.weight,(i=t.getChildByName("text_name")).text=HelperExtension.shiftName(n.name),(i=t.getChildByName("text_protect")).visible=n.isNeedProtect,(r=t.getChildByName("img_avatar")).skin=n.avatarUrl,r=t.getChildByName("img_rank");var s=t.getChildByName("img_di2"),o=t.getChildByName("lbRank");e<3?(r.visible=!0,o.visible=!1,r.skin="res/ui/gameover/jiangpai"+n.rank+".png",s.skin="res/ui/gameover/paiming"+n.rank+".png"):(r.visible=!1,o.visible=!0,o.text=n.rank,s.skin="res/ui/gameover/paiming.png")},e.prototype.seeVideo=function(){Laya.Browser.onWeiXin?RewardVideoManager.show(EnumShareId.VIDEO_DOUBLE_PRIZE,this.onSeeVideoComplete,this.onSeeVideoError,"广告未播放完毕，未获得双倍奖励"):this.onSeeVideoComplete()},e.prototype.onShareFail=function(t){traceLog("分享失败！"),ShareUtil.shareFailtips()},e.prototype.addDoublePrize=function(){traceLog("增加三倍奖励"),this.isGotDouble=!0,this.addGold>0&&(GetGoldView.ins.toShow(2*this.addGold,null,ERewardType.GetGold_Double),SyncDataManager.gold+=2*this.addGold,this.btnShare.visible=!1,this.btnDoublePrize.visible=!1,this.btnShareForDP.visible=!1,this.img_double_percent.visible=!1)},e}(hole.ui.Game.ClassicOverViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),SurvivalOverView=function(t){function e(){var e=t.call(this)||this;return e.isFirstWin=!1,e.addGold=0,e.isGotDouble=!1,e.tmpRank=1,e.onSeeVideoComplete=function(){e.addDoublePrize(),WXUtility.point_with_new("结算看视频（吃鸡）",{},ENewPointTpye.SURVIVE_GAME_OVER_VIDEO)},e.onSeeVideoError=function(){e.onShare_double()},e.onDoubleGoldShareSuccess=function(){e.isGotDouble?NoticeView.instance.show(["炫耀成功!"]):(WXUtility.point_with_new("结算分享（吃鸡）",{},ENewPointTpye.SURVIVE_GAME_OVER_SHARE),e.addDoublePrize(2))},e.itemGrid1=new ItemGrid,e.itemGrid2=new ItemGrid,e.imgDouble1=new Laya.Image("res/ui/gameover/bianjiao.png"),e.imgDouble2=new Laya.Image("res/ui/gameover/bianjiao.png"),e.imgDouble1.x=2,e.imgDouble1.y=2,e.imgDouble2.x=2,e.imgDouble2.y=2,e.itemGrid1.addChild(e.imgDouble1),e.itemGrid2.addChild(e.imgDouble2),e.box_reward.addChild(e.itemGrid1),e.box_reward.addChild(e.itemGrid2),e.imgDouble1.visible=!1,e.imgDouble2.visible=!1,e.itemGrid1.visible=!1,e.itemGrid2.visible=!1,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return null==this._ins&&(this._ins=Laya.Pool.getItemByClass("SurvivalOverView",e)),this._ins},enumerable:!0,configurable:!0}),e.prototype.toShow=function(t,e){void 0===e&&(e=1),GameManager.PlayerEntity.isOnlineDead||(GameView.ins.game_run_time<=90&&0==e?GameView.reliveView.show(t):(GameDataManager.gameState=EGameState.GameOverOrExitGame,this.setViewData(t),this.popup(!0),WXUtility.point_with_new("进入结算（吃鸡）",{},ENewPointTpye.SURVIVE_ENTER_GAME_OVER)))},e.prototype.toHide=function(t){void 0===t&&(t=!0),this.close(),t&&this.recover()},e.prototype.recover=function(){e._ins=null,Laya.Pool.recover("SurvivalOverView",this)},e.prototype.onOpened=function(){this.add_events(),AdManager.show(AdManager.RESULT_AD,EnumAdIId.SURVIVE_OVER_VIEW,(this.y+this.ad.y)*AdapterManager.scaleRadio);var t=SettingView.Ins.FeedBackButton;null!=t&&(t.style.left=(this.x+this.spTousu.x)*AdapterManager.scaleRadio,t.style.top=(this.y+this.spTousu.y)*AdapterManager.scaleRadio,t.show())},e.prototype.onClosed=function(){var t=SettingView.Ins.FeedBackButton;null!=t&&t.hide(),this.remove_events()},e.prototype.add_events=function(){this.img_continue.on(LayaEvent.CLICK,this,this.on_continue),this.btnVideo.on(LayaEvent.CLICK,this,this.onVideo_double),this.btnShare.on(LayaEvent.CLICK,this,this.onXuanYao),this.btn_share_double.on(LayaEvent.CLICK,this,this.onShare_double)},e.prototype.remove_events=function(){this.img_continue.off(LayaEvent.CLICK,this,this.on_continue),this.btnVideo.off(LayaEvent.CLICK,this,this.onVideo_double),this.btnShare.off(LayaEvent.CLICK,this,this.onXuanYao),this.btn_share_double.off(LayaEvent.CLICK,this,this.onShare_double)},e.prototype.on_continue=function(){WXUtility.point_with_new("结算返回（吃鸡）",{},ENewPointTpye.SURVIVE_GAME_OVER_BACK),MainSocket.C2S_EXIT_GAME(),TeamManager.hasTeam?TeamPlayView.instance.onShow():HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME),GameManager.EventManagerEx.RaiseEvent(EventSetting.on_exit_game),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.SCENE),this.toHide()},e.prototype.onVideo_double=function(){this.seeVideo()},e.prototype.seeVideo=function(){Laya.Browser.onWeiXin?RewardVideoManager.show(EnumShareId.VIDEO_DOUBLE_PRIZE,this.onSeeVideoComplete,this.onSeeVideoError,"广告未播放完毕，未获得双倍奖励"):this.onSeeVideoComplete()},e.prototype.addDoublePrize=function(t){void 0===t&&(t=1),traceLog("增加三倍奖励"),this.isGotDouble=!0,this.addGold>0&&(GetGoldView.ins.toShow(this.addGold*t,null,ERewardType.GetGold_Double_S),SyncDataManager.gold+=this.addGold*t,this.btnShare.visible=!1,this.box_video_reward.visible=!1,this.box_share_reward.visible=!1)},e.prototype.onXuanYao=function(){if("求助好友"==this.lb_xuanyao_tip.text){wx.shareAppMessage({success:function(){}})}else WXUtility.point_with_new("结算炫耀（吃鸡）",{},ENewPointTpye.SURVIVE_GAME_OVER_XUANYAO),ShareImageUtil.share(this,new CallBackFunc(this,this.onImageSuccess),new CallBackFunc(this,this.onImageFail),500,400,-70+this.x,-30+this.y)},e.prototype.onImageSuccess=function(t){if(console.log("onImageSuccess:",t),t){var e=new ShareInfo;e.title="我在联机对战中获得第"+this.tmpRank+"名！碾压之势无法阻挡~",e.imageUrl=t.tempFilePath,ShareUtil.shareGameWithInfo(e)}},e.prototype.onImageFail=function(){console.log("排行榜截图分享失败"),ShareUtil.sharegame(EnumShareId.SHARE_SURVIVE)},e.prototype.onShare_double=function(){var t=new ShareInfo;t.shareId=EnumShareId.SHARE_GAMEOVER_SHOW,t.successFunc=new CallBackFunc(this,this.onDoubleGoldShareSuccess),t.failFunc=new CallBackFunc(this,this.onShareFail),ShareUtil.shareGameByShareInfo(t)},e.prototype.onShareFail=function(t){traceLog("分享失败！"),ShareUtil.shareFailtips()},e.prototype.setViewData=function(t){var e,i=GameManager.PlayerEntity;this.isFirstWin=!1,this.isGotDouble=!1,this.addGold=0,this.chipPrize=ClassicOverView.instance.toGetChipPrize(),this.lb_weight.text=i.weight+"",this.lb_kill.text=i.kill+"",this.box_share_reward.visible=!0,this.box_video_reward.visible=!0,void 0!==t?(e=DetectManager.Instance.OtherPlayers.values.length+1,this.text_other_name.text=HelperExtension.shiftName(t)):e=i.rank,e=(e=e>15?15:e)<1?1:e,this.tmpRank=e;var n=ScoreConfig.config[e-1].score;if(n>=0?(this.text_award.text="+"+n,this.text_award.color="#fcff00"):(this.text_award.text=""+n,this.text_award.color="#1dfffc"),SyncDataManager.score+=n,i.isAlive){a=TimeUtil.getTimeStr(),GameDataManager.firstWinTime!=a&&(GameDataManager.firstWinTime=a,this.isFirstWin=!0,Laya.LocalStorage.setItem(EnumKey.FIRST_WIN_TIME,a)),this.box_loser.visible=!1,this.box_winner.visible=!0,this.text_winner_rank.text=e+"",1==e?(this.text_winner_tips.text="大吉大利，今晚吃鸡",SkinManager.setSkinData(EnumKey.SKIN_GET_CONDITION_9,1),GameDataManager.SurvivalPlayerGameData.winnerTimes++):this.text_winner_tips.text="坚持就是胜利";var r=ScoreConfig.config[e-1].settlementRewardCoin;if(!(this.chipPrize||r&&""==r)){var a=TimeUtil.getTimeStr();GameDataManager.firstWinTime!=a&&(GameDataManager.firstWinTime=a,this.isFirstWin=!0,Laya.LocalStorage.setItem(EnumKey.FIRST_WIN_TIME,a))}this.isFirstWin?this.img_6bei.visible=!0:this.img_6bei.visible=!1,this.lb_xuanyao_tip.text="炫耀得分"}else i.isOnlineDead=!0,this.box_loser.visible=!0,this.box_winner.visible=!1,this.text_loser_rank.text=e+"",this.lb_xuanyao_tip.text="求助好友";GameDataManager.SurvivalPlayerGameData.playTimes++,EventManager.dispatchEvent(EDataUpdateType.SurvivalPlayerGameDataUpdate);var s=ScoreConfig.config[e-1].settlementRewardCoin;if(s&&""!=s){this.itemGrid1.visible=!0;var o=s.split(":");if(o&&2==o.length){var l=Number(o[0]),h=Number(o[1]);this.isFirstWin?(this.imgDouble1.visible=!0,this.addGold=2*h,SyncDataManager.gold+=this.addGold):(this.imgDouble1.visible=!1,this.addGold=h,SyncDataManager.gold+=this.addGold),this.itemGrid1.setIcon(l),this.itemGrid1.count=this.addGold}}else this.itemGrid1.visible=!1;if(this.chipPrize){this.itemGrid2.visible=!0;var c=this.chipPrize.num;this.isFirstWin?(this.imgDouble2.visible=!0,c*=2):this.imgDouble2.visible=!1,SyncDataManager.addChipData(this.chipPrize.skinBitsId,c),this.itemGrid2.setIcon(this.chipPrize.skinBitsId),this.itemGrid2.count=c}else this.itemGrid2.visible=!1;HelperExtension.ABCSetOffsetX(this.itemGrid1,this.itemGrid2,this.box_reward),this.box_xuanyao.visible=!0,ConfigUtility.IsSafeVersion||(this.box_share_reward.visible=!1),HelperExtension.BtnControl(this.box_video_reward,EBtnType.VIDEO),HelperExtension.BtnControl(this.box_share_reward,EBtnType.SHARE),HelperExtension.ABCSetOffsetX(this.box_video_reward,this.box_share_reward,this),1==e&&(WXUtility.aldSendEvent("吃鸡人数",{}),this.check_point())},e.prototype.check_point=function(){var t=Laya.LocalStorage.getItem(EnumKey.FIRST_CHIJI_TIME);if(null==t||""==t)Laya.LocalStorage.setItem(EnumKey.FIRST_CHIJI_TIME,Date.now()+"");else{if(0==HelperExtension.GetDateDiff(Number(t),Date.now(),ETimeDiffType.day))return;switch(HelperExtension.GetDateDiff(Number(t),Date.now(),ETimeDiffType.day)){case 1:WXUtility.aldSendEvent("第2天玩吃鸡",{});break;case 2:WXUtility.aldSendEvent("第3天玩吃鸡",{});break;case 3:WXUtility.aldSendEvent("第4天玩吃鸡",{});break;case 4:WXUtility.aldSendEvent("第5天玩吃鸡",{});break;case 5:WXUtility.aldSendEvent("第6天玩吃鸡",{});break;case 6:WXUtility.aldSendEvent("第7天玩吃鸡",{})}}},e}(hole.ui.Game.SurvivalOverViewUI),__extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),RankView=function(t){function e(){var e=t.call(this)||this;return e._clickProvinceTime=0,e._clickCountryTime=0,e.REQ_TIME=18e4,e.draw=function(){},e.bg.graphics.drawRect(-AdapterManager.offsetX,-AdapterManager.offsetY,Laya.stage.width,Laya.stage.height,"#000000"),e.x=AdapterManager.offsetX,e.y=AdapterManager.offsetY,e._rank=new Sprite,e._rank.x=55,e._rank.y=175,e.addChild(e._rank),e.btn_share.on(LayaEvent.CLICK,e,e.onShare),e.btn_share.visible=!1,e}return __extends(e,t),e.prototype.onShare=function(){ShareUtil.sharegame(EnumShareId.SHARE_rank)},e.prototype.onLogin1=function(t){},e.prototype.onLogin2=function(t){},e.prototype.showHideLoginBtn=function(t){},e.prototype.show=function(t){PlatformAPI.createVideoAd("rank",t=>{t||GameDataManager.addSeeVideoTimes(),console.error("rankvideo")}),this.rankLoading=!1,void 0===t&&(t=null),this.add_events(),Laya.stage.addChild(this),this.showRank()},e.prototype.add_events=function(){this.btnClose.on("click",this,this.on_close),this.btn_share.on("click",this,this.on_share),this.btn_prev.on("click",this,this.prevPage),this.btn_next.on("click",this,this.nextPage)},e.prototype.remove_events=function(){this.btnClose.off("click",this,this.on_close),this.btn_share.off("click",this,this.on_share),this.btn_prev.off("click",this,this.prevPage),this.btn_next.off("click",this,this.nextPage)},e.prototype.hide=function(){this.remove_events(),this.removeSelf(),null!=SubDomainMessageManager.layaSharedCanvas&&void 0!=SubDomainMessageManager.layaSharedCanvas&&SubDomainMessageManager.methodCall("setRankVisible",!1),EventManager.dispatchEvent(EnumKey.SHOW_HIDE_HOME_BTNS,!0)},e.prototype.parseInfo=function(t){var e=t.getPlayer();return{nickName:e.getName(),score:t.getScore(),avatarUrl:e.getPhoto(),rank:t.getRank(),openid:e.getID()}},e.prototype.drawItem=function(t,e,i){var n=new Laya.Image;if(this.rankNode){var r=new Laya.Image,a=new Laya.Label,s=(new Laya.Image,new Laya.Image),o=new Laya.Label,l=new Laya.Image,h=new Laya.Label;n.skin=i?"openRes/dizi3.png":"openRes/dizi1.png",n.sizeGrid="17,22,17,17",n.width=520,n.height=64,t.rank<=3?(r.skin="openRes/paiming"+t.rank+".png",r.y=1,n.addChild(r)):(r.skin="openRes/paiming.png",r.x=0,r.y=1,n.addChild(r),a.text=t.rank,a.x=24,a.y=15,a.color="#ffffff",a.fontSize=24,n.addChild(a)),s.skin=t.avatarUrl,s.width=40,s.height=40,s.x=110,s.y=12,n.addChild(s),o.text=t.nickName.length>15?t.nickName.substring(0,12)+"...":t.nickName,o.color="#627b86",o.fontSize=20,o.x=180,o.y=20,o.width=160,o.align="center",n.addChild(o),l.skin="openRes/duanwei_"+this.getRankType(t.score)+".png",l.scaleX=l.scaleY=.4,l.x=360,l.y=3,n.addChild(l),h.text=t.score,h.color="#627b86",h.fontSize=20,h.x=440,h.y=20,n.addChild(h),n.y=i?520:65*e}return n},e.prototype.getRankType=function(t){return t>=5e3?7:t>=3e3?6:t>=1500?5:t>=700?4:t>=300?3:t>=100?2:1},e.prototype.setRankData=function(t,e){t?this.selfData=e:this.rankData=e,this.rankData&&this.selfData&&(this.rankNode=new Laya.Box,this.boxRank.addChild(this.rankNode),this.rankNode.y=60,this.drawSelfRank(this.selfData),this.drawRank(this.rankData))},e.prototype.drawSelfRank=function(t){this.rankNode.addChild(this.drawItem(this.selfData,0,1))},e.prototype.drawRank=function(t){t.forEach((t,e)=>{this.rankNode.addChild(this.drawItem(t,e))})},e.prototype.showRank=function(t=1){this.rankLoading=!0,setTimeout(()=>{this.rankLoading=!1},1500),this.boxRank.removeChildren(),this.rankNode=null,this.page=t=t<1?1:t>5?5:t;var e=this,i=[];FBInstant.getLeaderboardAsync("rolllingBallRank").then(i=>{const n=i.getEntriesAsync;return i.getPlayerEntryAsync().then(t=>{var i=e.parseInfo(t);e.setRankData(1,i)}),n.call(i,8,8*(t-1))}).then(t=>{t.forEach((t,n)=>{var r=e.parseInfo(t);i.push(r)}),e.setRankData(0,i)}),console.log("showrank")},e.prototype.prevPage=function(){this.rankLoading||(this.page--,this.showRank(this.page))},e.prototype.nextPage=function(){this.rankLoading||(this.page++,this.showRank(this.page))},e.prototype.on_close=function(){HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.RANK)},e.prototype.on_share=function(){},e.prototype.getProvinceName=function(t){},e}(hole.ui.Rank.RankViewUI),AudioController=function(){function t(){}return Object.defineProperty(t,"AudioState",{get:function(){return this.is_audio_on},set:function(t){this.is_audio_on=t,Laya.LocalStorage.setItem(EnumKey.AUDIO_STATE,String(t))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MusicState",{get:function(){return this.is_music_on},set:function(t){this.is_music_on=t,Laya.LocalStorage.setItem(EnumKey.MUSIC_STATE,String(t))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ShakeState",{get:function(){return this.is_shake_on},set:function(t){this.is_shake_on=t,Laya.LocalStorage.setItem(EnumKey.SHAKE_STATE,String(t))},enumerable:!0,configurable:!0}),t.setup=function(){var t=Laya.LocalStorage.getItem(EnumKey.AUDIO_STATE);this.is_audio_on="false"!=t;var e=Laya.LocalStorage.getItem(EnumKey.MUSIC_STATE);this.is_music_on="false"!=e;var i=Laya.LocalStorage.getItem(EnumKey.SHAKE_STATE);this.is_shake_on="false"!=i},t.playBG=function(){this.is_music_on&&Laya.SoundManager.playMusic(this.background,0,null,0)},t.stopBG=function(){Laya.SoundManager.stopMusic()},t.stopAll=function(){Laya.SoundManager.stopAll()},t.play=function(t,e){if(void 0===e&&(e=1),this.is_audio_on)switch(t){case ESoundType.countdown:Laya.SoundManager.playSound(this.countdown,e);break;case ESoundType.game_start:Laya.SoundManager.playSound(this.game_start,e);break;case ESoundType.game_over:Laya.SoundManager.playSound(this.game_over,e);break;case ESoundType.hole_dead:Laya.SoundManager.playSound(this.hole_dead,e);break;case ESoundType.hole_eat_model:if(this.is_already_play_eat_model)return;this.is_already_play_eat_model=!0,setTimeout(this.reset_eat_model_statu,300),Laya.SoundManager.playSound(this.hole_eat_model,e);break;case ESoundType.hole_upgrade:Laya.SoundManager.playSound(this.hole_grow,e);break;case ESoundType.hole_use_tool:Laya.SoundManager.playSound(this.hole_use_tool,e)}},t.play_kill=function(t){this.is_audio_on&&Laya.SoundManager.playSound(this.kill_prefix+"kill_"+t+".mp3",1)},t.reset_eat_model_statu=function(){t.is_already_play_eat_model=!1},t.countdown=ConfigUtility.baseUrl+"res/sounds/countdown.mp3",t.game_start=ConfigUtility.baseUrl+"res/sounds/game_start.mp3",t.game_over=ConfigUtility.baseUrl+"res/sounds/game_over.mp3",t.hole_dead=ConfigUtility.baseUrl+"res/sounds/ball_confiction.mp3",t.hole_eat_model=ConfigUtility.baseUrl+"res/sounds/hole_eat_model.mp3",t.kill_prefix=ConfigUtility.baseUrl+"res/sounds/kill/",t.is_already_play_eat_model=!1,t.hole_grow=ConfigUtility.baseUrl+"res/sounds/hole_grow.mp3",t.hole_use_tool=ConfigUtility.baseUrl+"res/sounds/hole_use_tool.mp3",t.background=ConfigUtility.baseUrl+"res/music/BGM_InGame.mp3",t}(),ESoundType;!function(t){t[t.countdown=0]="countdown",t[t.game_start=1]="game_start",t[t.game_over=2]="game_over",t[t.hole_dead=3]="hole_dead",t[t.hole_eat_model=4]="hole_eat_model",t[t.hole_upgrade=5]="hole_upgrade",t[t.hole_use_tool=6]="hole_use_tool"}(ESoundType||(ESoundType={}));var UIViewsController=function(){function t(){HoleContext.getInstance().on(HoleContext.SHOW_VIEW,this,this.showView),HoleContext.getInstance().on(HoleContext.HIDE_VIEW,this,this.hideView),this._loadingView=LoadingView.instance,GameDataManager.shareTicket&&GameDataManager.query&&"rank"==GameDataManager.query.op&&HoleContext.getInstance().event(HoleContext.SHOW_VIEW,[EViewType.RANK,GameDataManager.shareTicket]),GameManager.UIViewsController=this}return Object.defineProperty(t.prototype,"HomeView",{get:function(){return this._homePageView||(this._homePageView=HomeView.Ins),this._homePageView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RankView",{get:function(){return this._rankView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Scene3DView",{get:function(){return Scene3DController.Scene3DView},enumerable:!0,configurable:!0}),t.prototype.showView=function(t,e){switch(t){case EViewType.HOME:this.HomeView.onShow();break;case EViewType.LOADING:this._loadingView.onShow();break;case EViewType.SCENE:this.Scene3DView.onShow();break;case EViewType.RANK:this._rankView||(this._rankView=new RankView),this._rankView.show(e)}},t.prototype.hideView=function(t){switch(t){case EViewType.HOME:this.HomeView.onHide();break;case EViewType.LOADING:this._loadingView.onHide();break;case EViewType.SCENE:this.Scene3DView.onHide();break;case EViewType.RANK:this._rankView&&this._rankView.hide()}},t}(),ECameraLookType;!function(t){t[t.E=0]="E",t[t.S=1]="S",t[t.W=2]="W",t[t.N=3]="N"}(ECameraLookType||(ECameraLookType={}));var CameraController=function(){function t(){this._default_pos=new Laya.Vector3,this._pos=new Laya.Vector3,this._quat=new Laya.Quaternion,this._riseTotalTime=500,console.log("...................CameraController..................."),GameManager.CameraController=this}return Object.defineProperty(t,"instance",{get:function(){return null==this._ins&&(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ScreeningOffset",{get:function(){return this._ScreeningOffset},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OffsetPos",{get:function(){return this._OffsetPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),t.switchScreeningOffset=function(t){if(this._curScreeningOffsetflag!=t){for(var e=this._ScreeningOffset.length;e--;){var i=this._ScreeningOffset[e].x;this._ScreeningOffset[e].x=this._ScreeningOffset[e].y,this._ScreeningOffset[e].y=i}this._curScreeningOffsetflag=t}},t.switchOffsetPos=function(t){switch(t){case ECameraLookType.E:case ECameraLookType.S:case ECameraLookType.W:case ECameraLookType.N:}},t.randomLookType=function(){Math.floor(HelperExtension.random(0,4)),t.ECameraLookType=ECameraLookType.S,t.switchScreeningOffset(0)},t.getOffsetPos=function(){var t=GameManager.PlayerEntity.levelIndex;switch(this.ECameraLookType){case ECameraLookType.E:return new Vector2(-this._OffsetPos[t],0);case ECameraLookType.S:return new Vector2(0,-this._OffsetPos[t]);case ECameraLookType.W:return new Vector2(this._OffsetPos[t],0);case ECameraLookType.N:return new Vector2(0,this._OffsetPos[t])}return new Vector2(0,-this._OffsetPos[t])},t.prototype.init=function(){var t=SceneManager.scene;if(this._camera=t.getChildByName("Main Camera"),this._camera){this._camera.fieldOfView=CameraUtility.Instance.initCameraFOV,this._camera.nearPlane=1,this._camera.farPlane=600,this.reset_camera_rotation();var e=this._camera.getChildByName("Directional Light");e&&(e.transform.localPosition=new Vector3,Quaternion.createFromYawPitchRoll(30*HelperExtension.Deg2Rad,-5*HelperExtension.Deg2Rad,-30*HelperExtension.Deg2Rad,e.transform.localRotation))}},t.prototype.reset=function(){CameraUtility.Instance.OffsetX=0,CameraUtility.Instance.OffsetY=0,CameraUtility.Instance.OffsetZ=0,this.set_camera_pos(new Vector3(CameraUtility.Instance.initCameraOffX,CameraUtility.Instance.initCameraOffY,CameraUtility.Instance.initCameraOffZ)),this.reset_camera_rotation()},t.prototype.update=function(){this.set_camera_pos(new Vector3(CameraUtility.Instance.cameraOffsetX,CameraUtility.Instance.cameraOffsetY,CameraUtility.Instance.cameraOffsetZ))},t.prototype.onStageKeyDown=function(t){switch(t.keyCode){case Laya.Keyboard.E:this.camera.transform.rotate(new Laya.Vector3(.1,0,0),!1,!1),CameraUtility.Instance.offsetAngleX+=.1;break;case Laya.Keyboard.Q:this.camera.transform.rotate(new Laya.Vector3(-.1,0,0),!1,!1),CameraUtility.Instance.offsetAngleX-=.1;break;case Laya.Keyboard.W:this.updateCameraOffsetByLookAt(.5);break;case Laya.Keyboard.S:this.updateCameraOffsetByLookAt(-.5);break;case Laya.Keyboard.K:CameraUtility.Instance.OffsetY+=.05;break;case Laya.Keyboard.L:CameraUtility.Instance.OffsetY-=.05;break;case Laya.Keyboard.LEFT:CameraUtility.Instance.OffsetX+=.05;break;case Laya.Keyboard.RIGHT:CameraUtility.Instance.OffsetX-=.05;break;case Laya.Keyboard.UP:CameraUtility.Instance.OffsetZ+=.05;break;case Laya.Keyboard.DOWN:CameraUtility.Instance.OffsetZ-=.05;break;case Laya.Keyboard.A:this.camera.fieldOfView+=.1;break;case Laya.Keyboard.D:this.camera.fieldOfView-=.1;break;case Laya.Keyboard.R:this.camera.transform.rotate(new Laya.Vector3(0,.5,0),!1,!1);break;case Laya.Keyboard.T:this.camera.transform.rotate(new Laya.Vector3(0,-.5,0),!1,!1);break;case Laya.Keyboard.LEFTBRACKET:this._lookAtTarget.transform.position.y+=.01;break;case Laya.Keyboard.RIGHTBRACKET:this._lookAtTarget.transform.position.y-=.01}console.log("角度X ："+CameraUtility.Instance.cameraAngleX+", 距离dis ："+CameraUtility.Instance.offfsetDis+", 视域FOV ："+CameraUtility.Instance.cameraFOV),console.log("X : "+CameraUtility.Instance.cameraOffsetX+", Y : "+CameraUtility.Instance.cameraOffsetY+", Z: "+CameraUtility.Instance.cameraOffsetZ),0!=this.camera.transform.localRotationEuler.y&&console.log("角度Y : "+this.camera.transform.localRotationEuler.y)},t.prototype.onStageKeyUp=function(t){},t.prototype.updateCameraOffsetByLookAt=function(t){var e=new Laya.Vector3;Laya.Vector3.normalize(this.camera.transform.forward.clone(),e),e.x*=t,e.y*=t,e.z*=t,CameraUtility.Instance.OffsetX+=e.x,CameraUtility.Instance.OffsetY+=e.y,CameraUtility.Instance.OffsetZ+=e.z},t.prototype.updateCameraOffset=function(t){var e=new Laya.Vector3;if(Laya.Vector3.subtract(this._default_pos,this._lookAtTarget.transform.position,e),Laya.Vector3.normalize(e.clone(),e),this._isSlow){var i=new Vector3(e.x*t,e.y*t,e.z*t);Vector3.add(i,this._targetPosition.clone(),this._targetPosition)}else this._targetPosition=new Laya.Vector3(CameraUtility.Instance.OffsetX+e.x*t,CameraUtility.Instance.OffsetY+e.y*t,CameraUtility.Instance.OffsetZ+e.z*t);this._risePosition=new Laya.Vector3(CameraUtility.Instance.OffsetX,CameraUtility.Instance.OffsetY,CameraUtility.Instance.OffsetZ),this._startRiseTime=0,this._isSlow=!0,Laya.timer.frameLoop(1,this,this.ToSlowMotion)},t.prototype.ToSlowMotion=function(){this._startRiseTime+=Laya.timer.delta;var t=this._startRiseTime/this._riseTotalTime;(this._startRiseTime>this._riseTotalTime||t>=1)&&(this._isSlow=!1,Laya.timer.clear(this,this.ToSlowMotion),t=1),CameraUtility.Instance.OffsetX=Laya.MathUtil.lerp(this._risePosition.x,this._targetPosition.x,t),CameraUtility.Instance.OffsetY=Laya.MathUtil.lerp(this._risePosition.y,this._targetPosition.y,t),CameraUtility.Instance.OffsetZ=Laya.MathUtil.lerp(this._risePosition.z,this._targetPosition.z,t)},Object.defineProperty(t.prototype,"enable",{set:function(t){t?(this._lookAtTarget=GameManager.PlayerEntity,this._pos=new Laya.Vector3,this._default_pos=new Laya.Vector3,this.reset_camera_rotation(),this._camera.transform.position=this._pos,Laya.stage.on(Laya.Event.KEY_DOWN,this,this.onStageKeyDown),Laya.stage.on(Laya.Event.KEY_UP,this,this.onStageKeyUp),this.update()):(Laya.stage.off(Laya.Event.KEY_DOWN,this,this.onStageKeyDown),Laya.stage.off(Laya.Event.KEY_UP,this,this.onStageKeyUp),this._lookAtTarget=null,this._pos=new Laya.Vector3,this._quat=new Laya.Quaternion)},enumerable:!0,configurable:!0}),t.prototype.reset_camera_rotation=function(){switch(this._quat=new Laya.Quaternion,t.ECameraLookType){case ECameraLookType.E:Laya.Quaternion.createFromYawPitchRoll(Math.PI/2,HelperExtension.Deg2Rad*CameraUtility.Instance.initCameraAngleX,0,this._quat);break;case ECameraLookType.S:Laya.Quaternion.createFromYawPitchRoll(0,HelperExtension.Deg2Rad*CameraUtility.Instance.initCameraAngleX,0,this._quat);break;case ECameraLookType.W:Laya.Quaternion.createFromYawPitchRoll(1.5*Math.PI,HelperExtension.Deg2Rad*CameraUtility.Instance.initCameraAngleX,0,this._quat);break;case ECameraLookType.N:Laya.Quaternion.createFromYawPitchRoll(Math.PI,HelperExtension.Deg2Rad*CameraUtility.Instance.initCameraAngleX,0,this._quat)}this._camera.transform.rotation=this._quat},t.prototype.set_camera_pos=function(e){switch(t.ECameraLookType){case ECameraLookType.E:this._pos.x=this._lookAtTarget.transform.position.x+e.z,this._pos.z=this._lookAtTarget.transform.position.z+e.x;break;case ECameraLookType.S:this._pos.x=this._lookAtTarget.transform.position.x+e.x,this._pos.z=this._lookAtTarget.transform.position.z+e.z;break;case ECameraLookType.W:this._pos.x=this._lookAtTarget.transform.position.x-e.z,this._pos.z=this._lookAtTarget.transform.position.z-e.x;break;case ECameraLookType.N:this._pos.x=this._lookAtTarget.transform.position.x-e.x,this._pos.z=this._lookAtTarget.transform.position.z-e.z}this._default_pos.x=this._lookAtTarget.transform.position.x+e.x,this._default_pos.z=this._lookAtTarget.transform.position.z+e.z,this._pos.y=this._lookAtTarget.transform.position.y+e.y,this._default_pos.y=this._pos.y,this._camera.transform.position=this._pos},t.prototype.release=function(){this._lookAtTarget=null,this._pos=new Laya.Vector3,this._quat=new Laya.Quaternion,GameManager.CameraController=null},t.prototype.helperCornerPoint=function(t){var e=HelperExtension.GetCorners(this.camera,this.distanceWithTarget),i=this.camera.addChild(new MeshSprite3D(new BoxMesh(1,1,1))),n=new StandardMaterial;n.albedo=new Vector4(1,0,0,1),n.renderQueue=5e3,i.meshRender.material=n,i.transform.position=e[0].clone(),t.addChild(i);var r=this.camera.addChild(new MeshSprite3D(new BoxMesh(1,1,1))),a=new StandardMaterial;a.albedo=new Vector4(0,1,0,1),a.renderQueue=5e3,r.meshRender.material=a,r.transform.position=e[1].clone(),t.addChild(r);var s=this.camera.addChild(new MeshSprite3D(new BoxMesh(1,1,1))),o=new StandardMaterial;o.albedo=new Vector4(0,0,1,1),o.renderQueue=5e3,s.meshRender.material=o,s.transform.position=e[2].clone(),t.addChild(s);var l=this.camera.addChild(new MeshSprite3D(new BoxMesh(1,1,1))),h=new StandardMaterial;h.albedo=new Vector4(1,1,1,1),h.renderQueue=5e3,l.meshRender.material=h,l.transform.position=e[3].clone(),t.addChild(l)},Object.defineProperty(t.prototype,"distanceWithTarget",{get:function(){return Vector3.distance(this.camera.transform.position,this._lookAtTarget.transform.position)},enumerable:!0,configurable:!0}),t.prototype.toFindConers=function(){console.log("当前阶级",GameManager.PlayerEntity.levelIndex+1);for(var t=this.distanceWithTarget,e=HelperExtension.GetCorners(this.camera,t);e[0].y>0;)t+=.01,e=HelperExtension.GetCorners(this.camera,t),console.log("...1");for(var i=this.distanceWithTarget,n=HelperExtension.GetCorners(this.camera,i);n[2].y<0;)i-=.01,n=HelperExtension.GetCorners(this.camera,i),console.log("...2");console.log(" x/2 距离",Math.abs(e[0].x-e[1].x)/2),console.log("0-1距离",Vector3.distance(e[0],e[1])),console.log(" z/2 距离",Math.abs(e[0].z-n[2].z)/2),console.log("0-2距离",Vector3.distance(e[0],n[2])),console.log("2-3距离",Vector3.distance(n[2],n[3])),console.log("最远点",t),console.log("最近点",i)},t._ScreeningOffset=new Array(new Vector2(4,12),new Vector2(6,19),new Vector2(9,24.5),new Vector2(11.5,31),new Vector2(14.8,39.8),new Vector2(18.1,45.4),new Vector2(21.9,53.9),new Vector2(25.5,65),new Vector2(28.7,72.2),new Vector2(31.8,78.9),new Vector2(34.3,84.7),new Vector2(36.6,89.7)),t._OffsetPos=new Array(0,3,7,10,14,16,16,18,18,22,24,28),t._curScreeningOffsetflag=0,t}(),MouseController=function(){function t(){GameManager.mouseController=this,console.log("___________________MouseController___________________")}return Object.defineProperty(t,"instance",{get:function(){return null==this._ins&&(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMouseDown",{get:function(){return this._isMouseDowning},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(this._isMouseDowning){var e,i;if(e=Laya.stage.mouseX-this._lastMouseX,i=Laya.stage.mouseY-this._lastMouseY,0==e&&0==i)return;var n=Math.atan2(i,e),r=Math.cos(n),a=Math.sin(n);switch(RemoteSense.instance.setPos(new Vector2(r,a)),CameraController.ECameraLookType){case ECameraLookType.E:n-=Math.PI/2;var s=a;a=-r,r=s;break;case ECameraLookType.S:break;case ECameraLookType.W:n+=Math.PI/2;var o=a;a=r,r=-o;break;case ECameraLookType.N:n+=Math.PI,r=-r,a=-a}Laya.Quaternion.createFromYawPitchRoll(-n,0,0,this._quat),this._controlTarget.setRotation(this._quat);var l=1*r*t*this._controlTarget.speed,h=1*a*t*this._controlTarget.speed;this._pos.x+=l,this._pos.z+=h,this._controlTarget.setPostion(this._pos);var c=FenceEntity.fenceDetect(this._controlTarget);if(0!=c){switch(c){case 1:this._pos.x-=l;break;case 2:this._pos.z-=h;break;case 3:this._pos.x-=l,this._pos.z-=h}this._controlTarget.setPostion(this._pos)}}},t.prototype.onStageMouseDown=function(){this._isMouseDowning=!0,this._lastMouseX=Laya.stage.mouseX,this._lastMouseY=Laya.stage.mouseY,this._pos=this._controlTarget.getPostion(),this._quat=this._controlTarget.getRotation(),RemoteSense.instance.show(new Vector2(this._lastMouseX,this._lastMouseY))},t.prototype.onStageMouseUp=function(){this._isMouseDowning=!1,RemoteSense.instance.hide()},t.prototype.realease=function(){Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.onStageMouseDown),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onStageMouseUp),GameManager.mouseController=null,this._controlTarget=null},t.prototype.enable=function(t){t?(this._controlTarget=GameManager.PlayerEntity,this._pos=this._controlTarget.getPostion(),this._quat=this._controlTarget.getRotation(),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onStageMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onStageMouseUp)):(Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.onStageMouseDown),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onStageMouseUp),this._controlTarget=null,this._isMouseDowning=!1,RemoteSense.instance.hide())},t}(),Scene3DController=function(){function t(){console.log("___________________Scene3DController_________________"),t._scene3DView=new Scene3DView,GameManager.EventManagerEx.AddListener(EventSetting.on_ready_load_game,new EventListener(this.on_ready_load_game.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_local_player_joined,new EventListener(this.on_local_player_joined.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_already_to_play,new EventListener(this.on_already_to_play.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_exit_game,new EventListener(this.on_exit_game_or_game_over.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_classic_over,new EventListener(this.on_exit_game_or_game_over.bind(this))),GameManager.EventManagerEx.AddListener(EventSetting.on_survival_over,new EventListener(this.on_exit_game_or_game_over.bind(this)))}return Object.defineProperty(t,"Scene3DView",{get:function(){return this._scene3DView},enumerable:!0,configurable:!0}),t.prototype.on_ready_load_game=function(){CameraController.randomLookType(),CameraController.instance.enable=!0},t.prototype.on_already_to_play=function(){GuideView.ins.hide(),MouseController.instance.enable(!0)},t.prototype.on_local_player_joined=function(){Laya.timer.frameLoop(1,this,this.upadte)},t.prototype.on_exit_game_or_game_over=function(){Laya.timer.clear(this,this.upadte),CameraController.instance.enable=!1,MouseController.instance.enable(!1),AudioController.stopBG()},t.prototype.upadte=function(){var t=Laya.timer.delta/1e3;MouseController.instance.update(t),CameraController.instance.update(),CrownEntity.update(t)},t.AIParentName="AINode",t.ModelParentName="pickable",t.StandAnimateParentName="standAnimate",t}(),HoleAppController=function(){function t(){this.onWxShow=function(e){if(console.log("进入游戏参数:",e),t.isShow=!0,GameDataManager.query=e.query,GameDataManager.shareTicket=e.shareTicket,GameDataManager.gameState==EGameState.InGame&&AudioController.playBG(),ShareUtil.shareTime){var i=Laya.Browser.now();console.log(i-ShareUtil.shareTime),i-ShareUtil.shareTime>GameSetting.instance.ShareSuccessTimes?ShareUtil.doSuccess():ShareUtil.doFail()}t.connectSocket(),t.channel=Laya.LocalStorage.getItem("channel"),null!=e.query.channel&&(t.channel=e.query.channel),t.channel=t.channel?t.channel:"default",Laya.LocalStorage.setItem("channel",t.channel),console.log("渠道信息channel:"+t.channel)},this.init()}return t.prototype.init=function(){Laya.MiniAdpter.init(),Laya3D.init(AdapterManager.designScreenSize.x,AdapterManager.designScreenSize.y,!0),UIConfig.closeDialogOnSide=!1,UIConfig.popupBgAlpha=.6,SyncDataManager.initSyncData(),this.syncServer(),EventManager.addEvent(ServerEvent.LOGIN_SUCCESS,this,this.onLoginServerSuccess),EventManager.addEvent(EnumKey.LOGIN_REGION_SERVER,this,this.onLoginRegionServerSuccess),EventManager.addEvent(ServerEvent.LOGIN_FAIL,this,this.onLoginServerFail),EventManager.addEvent(ServerEvent.SKEY_EXPIRE,this,this.onLoginServerExpire),EventManager.addEvent(EnumKey.SYNC_CLIENT_DATA,this,this.onSyncData),this.setup(),Laya.loader.load(ConfigUtility.localAtlas,Laya.Handler.create(this,this.onLocalAtlasLoaded),null,Laya.Loader.ATLAS),Laya.Browser.onWeiXin&&(wx.onShow&&wx.onShow(this.onWxShow),this.onWxHide&&WXUtility.onHide(this,this.onWxHide)),Laya.timer.once(1e4,this,this.sdkServerCheck),Laya.timer.once(1e4,this,function(){WXUtility.pointForNew("*在线时长10S",ENewPointTpye.APP_RUNTIME_OVER_10)}),Laya.timer.once(3e4,this,function(){WXUtility.pointForNew("*在线时长30S",ENewPointTpye.APP_RUNTIME_OVER_30)}),Laya.Browser.onWeiXin&&GameDataManager.initServerData()},t.prototype.loginSuccess=function(t){},t.prototype.completeHandler=function(t){},t.prototype.upLoadingSuc=function(t){console.log("上报完成························",t)},t.prototype.syncServer=function(){var t=new Date(Laya.Browser.now());console.log("同步服务器数据，时间：",t.toTimeString()),Laya.Browser.onWeiXin&&SyncDataManager.reqSyncData()},t.prototype.sdkServerCheck=function(){Laya.Browser.onWeiXin||(console.warn("SDK服务器连接超时！！！"),WXUtility.init(Laya.Browser.onWeiXin,AdapterManager.designScreenSize.x,AdapterManager.designScreenSize.y))},t.prototype.onSyncData=function(t){t&&t.data&&SyncDataManager.setServerData(t.data)},t.prototype.setup=function(){AdapterManager.setup(),RankDataManager.setup(),AudioController.setup(),PlayerUtility.setup(),GameDataManager.setUp(),SceneManager.setUp(),GameManager.setUp(),MainSocket.init(),this.onShareAppMessage()},t.connectSocket=function(){if(Browser.onWeiXin&&GameManager.isOpenOnline&&t.isLoginSever&&t.isLoadedRes)if(SocketConnection.mainSocket.connected){if(MainSocket.isLoginSocket){var e=void 0,i=void 0;GameDataManager.query&&(e=Number(GameDataManager.query.teamId),i=String(GameDataManager.query.openId)),e&&!isNaN(e)&&(MainSocket.C2S_JOIN_TEAM(e),console.log("接受到分享参数 openId：",i,"teamId:",e),GameDataManager.query=null)}}else MainSocket.connectServer()},t.prototype.onWxHide=function(){if(t.isShow=!1,GameDataManager.isNewPlayer){var e=Math.floor((Laya.timer.currTimer-t.runTimeBegin)/1e3);WXUtility.pointForNew("*右上退出",ENewPointTpye.RIGHT_POINT_EXIT,{"时长":e})}TeamManager.hasTeam&&(TeamPlayView.instance.set_not_ready(),MainSocket.C2S_TEAM_START_OR_CANCEL_READY(ETeamPlayerState.NOT_READY))},t.prototype.onLoginRegionServerSuccess=function(e){console.log("连接分区服务器成功:",e),t.isLoginSever=!0;var i=e.data.data;if(i&&Laya.Browser.onWeiXin){var n;if(ConfigUtility.openId||null!=SubDomainMessageManager.layaSharedCanvas&&void 0!=SubDomainMessageManager.layaSharedCanvas&&(SubDomainMessageManager.methodCall("setOpenId",i.userInfo.openId),0==SyncDataManager.score&&(SyncDataManager.score=0)),GameDataManager.initServerData(i),GameDataManager.query&&(n=Number(GameDataManager.query.helpType)),GameDataManager.query&&n){switch(n){case 1:GameDataManager.query.openId&&GameDataManager.query.openId!=ConfigUtility.openId&&(console.log("更新服务器数据，当前活动类型免费助力",n),MiNi.miniHttpServer.request(EnumKey.UPDAGE_FRIEND_HELP,{helpType:n,openId:GameDataManager.query.openId},null,null,!0));break;case 2:GameDataManager.query.activityId&&GameDataManager.query.openId&&GameDataManager.query.openId!=ConfigUtility.openId&&GameDataManager.query.openId!=ConfigUtility.openId&&MiNi.miniHttpServer.request(EnumKey.UPDAGE_FRIEND_HELP,{helpType:n,openId:GameDataManager.query.openId,activityId:GameDataManager.query.activityId},null,null,!0);break;case 3:GameDataManager.query.openId&&GameDataManager.query.openId!=ConfigUtility.openId&&MiNi.miniHttpServer.request(EnumKey.UPDAGE_FRIEND_HELP,{helpType:n,openId:GameDataManager.query.openId},null,null,!0)}GameDataManager.query=null}i.seasonId&&(GameDataManager.seasonId>0&&GameDataManager.seasonId!=i.seasonId&&(console.log("赛季重置，积分清空！！！"),SyncDataManager.score=0,RankDataManager.resetPlayerRankID()),GameDataManager.seasonId=i.seasonId,Laya.LocalStorage.setItem(EnumKey.SEASON_ID,i.seasonId)),SyncDataManager.reqSyncData(),EventManager.dispatchEvent(EnumKey.LOGIN_SERVER_SUCCESS),t.connectSocket(),HomeView.Ins.img_mode_select.visible=GameManager.isOpenOnline&&t.isLoginSever}},t.prototype.onLoginServerSuccess=function(t){console.log("连接服务器成功:",t)},t.prototype.onLoginServerFail=function(){},t.prototype.onLoginServerExpire=function(){traceError("服务器的SKEY过期了！！！"),MiNi.miniHttpServer.login()},t.prototype.onShareAppMessage=function(){Browser.onWeiXin&&wx.aldOnShareAppMessage(function(){return{success:function(){}}})},t.prototype.onLocalAtlasLoaded=function(){this.onVersionSelfLoaded()},t.prototype.onConfigLoaded=function(){console.log("onConfigLoaded && onHomeNeedAtlasLoaded"),t.isLoadedRes=!0,t.connectSocket(),Browser.onWeiXin&&wx.login&&wx.login({success:this.loginSuccess.bind(this)}),this._uiViewsController=new UIViewsController,this._scene3DController=new Scene3DController,SceneManager.load_common(),SkinConfig.LoadConfig(),ActivityConfig.instance,BuildConfig.instance,ItemConfig.instance,LevelConfig.instance,LotteryCfg.instance,LuckyBagConfig.instance,MailConfig.instance,SceneConfig.instance,SeasonCfg.instance,SettlementCfg.instance,SignConfig.instance,Laya.timer.callLater(this,function(){GameDataManager.gameState!=EGameState.InTeamPlay&&HoleContext.getInstance().event(HoleContext.SHOW_VIEW,EViewType.HOME),HoleContext.getInstance().event(HoleContext.HIDE_VIEW,EViewType.LOADING)})},t.prototype.onVersionSelfLoaded=function(t){if(t={adStatus:"1",openLevel:"2",isShowVideo:"1",gameVersion:"0.0.2",resVersion:"12",serverType:"0",reliveBtnStatus:"0",closeVideoShowShareState:"0",isShowHowToPlayVideo:"0",canShareShiwan:"1",shareSucCountEnoughToShowVideo:"1",newPlayerFirstEnterGameShowLoginReward:"0",newPlayerFirstOnlyShowStart:"0",getRewardType:"3",showClickLuckyBoxView:"1",seeVideoErrorToShowShare:"0",testNum:"0",isOpenOnline:"1",openRefreshAd:"0",openShareOther:"1",LuckyBoxNum:"5",SubSwitch:"0",ResetOpen:"1",OpeningGame:"1",OpeningGameNum:"1",OpeningGameStart:"2"},console.log("onVersionSelfLoaded",t),t){if(t.data&&t.data.openLevel?ConfigUtility.openLevel=t.data.openLevel:t.openLevel&&(ConfigUtility.openLevel=t.openLevel),t.data&&t.data.adStatus?ConfigUtility.isShowADInGame="1"==t.data.adStatus:t.adStatus&&(ConfigUtility.isShowADInGame="1"==t.adStatus),t.data&&t.data.isShowHowToPlayVideo?ConfigUtility.isShowHowToPlayVideo="1"==t.data.isShowHowToPlayVideo:t.isShowHowToPlayVideo&&(ConfigUtility.isShowHowToPlayVideo="1"==t.isShowHowToPlayVideo),t.data&&t.data.shareSucCountEnoughToShowVideo?ConfigUtility.shareSucCountEnoughToShowVideo="1"==t.data.shareSucCountEnoughToShowVideo:t.shareSucCountEnoughToShowVideo&&(ConfigUtility.shareSucCountEnoughToShowVideo="1"==t.shareSucCountEnoughToShowVideo),t.data&&t.data.canShareShiwan?ConfigUtility.canShareShiwan="1"==t.data.canShareShiwan:t.canShareShiwan&&(ConfigUtility.canShareShiwan="1"==t.canShareShiwan),t.data&&t.data.newPlayerFirstEnterGameShowLoginReward?ConfigUtility.newPlayerFirstEnterGameShowLoginReward="1"==t.data.newPlayerFirstEnterGameShowLoginReward:t.newPlayerFirstEnterGameShowLoginReward&&(ConfigUtility.newPlayerFirstEnterGameShowLoginReward="1"==t.newPlayerFirstEnterGameShowLoginReward),t.data&&t.data.newPlayerFirstOnlyShowStart?ConfigUtility.newPlayerFirstOnlyShowStart="1"==t.data.newPlayerFirstOnlyShowStart:t.newPlayerFirstOnlyShowStart&&(ConfigUtility.newPlayerFirstOnlyShowStart="1"==t.newPlayerFirstOnlyShowStart),t.data&&t.data.getRewardType?ConfigUtility.getRewardType=Number(t.data.getRewardType):t.getRewardType&&(ConfigUtility.getRewardType=Number(t.getRewardType)),t.data&&t.data.showClickLuckyBoxView?ConfigUtility.showClickLuckyBoxView="1"==t.data.showClickLuckyBoxView:t.showClickLuckyBoxView&&(ConfigUtility.showClickLuckyBoxView="1"==t.showClickLuckyBoxView),t.data&&t.data.seeVideoErrorToShowShare?ConfigUtility.seeVideoErrorToShowShare="1"==t.data.seeVideoErrorToShowShare:t.seeVideoErrorToShowShare&&(ConfigUtility.seeVideoErrorToShowShare="1"==t.seeVideoErrorToShowShare),t.data&&t.data.openRefreshAd?ConfigUtility.openRefreshAd="1"==t.data.openRefreshAd:t.openRefreshAd&&(ConfigUtility.openRefreshAd="1"==t.openRefreshAd),t.data&&t.data.serverType?"1"==t.data.serverType?ConfigUtility.serverUrl="https:../../../https@testball.xiaohuaiyule.com":"2"==t.serverType&&(ConfigUtility.serverUrl="../../../192.168.0.147_3A8085"):t.serverType&&("1"==t.serverType?ConfigUtility.serverUrl="https://testball.xiaohuaiyule.com":"2"==t.serverType&&(ConfigUtility.serverUrl="../../../192.168.0.147_3A8085")),t.data&&t.data.isOpenOnline?GameManager.isOpenOnline="1"==t.data.isOpenOnline:t.isOpenOnline&&(GameManager.isOpenOnline="1"==t.isOpenOnline),t.data&&t.data.openShareOther?ConfigUtility.openShareOther="1"==t.data.openShareOther:t.openShareOther&&(ConfigUtility.openShareOther="1"==t.openShareOther),t.data&&t.data.LuckyBoxNum)e=Number(t.data.LuckyBoxNum),isNaN(e)||(ConfigUtility.LuckyBoxNum=e);else if(t.LuckyBoxNum){var e=Number(t.LuckyBoxNum);isNaN(e)||(ConfigUtility.LuckyBoxNum=e)}t.data&&t.data.ResetOpen?ConfigUtility.ResetOpen="1"==t.data.ResetOpen:t.ResetOpen&&(ConfigUtility.ResetOpen="1"==t.ResetOpen);var i=!1;if(t.data&&t.data.ResetOpen?i="1"==t.data.SubSwitch:t.SubSwitch&&(i="1"==t.SubSwitch),i){var n=new MiniHttpRequest;n.once(LayaEvent.COMPLETE,this,this.on_pb_s),n.once(LayaEvent.ERROR,this,this.on_pb_e),n.request("../../../https@xcxpb.715083.com/h5res/gg/config.pb.json","GET",null,null)}var r=new Array;r=r.concat(ConfigUtility.configs,ConfigUtility.homeNeedAtlas),Laya.loader.load(r,Handler.create(this,this.onConfigLoaded),LoadingView.Handler)}ShareInfoConfig.requestShareImageInfo(),WXUtility.init(Laya.Browser.onWeiXin,AdapterManager.designScreenSize.x,AdapterManager.designScreenSize.y)},t.prototype.on_pb_s=function(t){console.log("子开关S",t),null!=t&&1==t.pb||(ConfigUtility.showClickLuckyBoxView=!1)},t.prototype.on_pb_e=function(t){console.log("子开关E",t),ConfigUtility.showClickLuckyBoxView=!1},t.prototype.onVersionSelfLoadedFail=function(t){var e=new Array;e=e.concat(ConfigUtility.configs,ConfigUtility.homeNeedAtlas),Laya.loader.load(e,Handler.create(this,this.onConfigLoaded),LoadingView.Handler),WXUtility.init(Laya.Browser.onWeiXin,AdapterManager.designScreenSize.x,AdapterManager.designScreenSize.y)},t.isLoginSever=!1,t.isLoadedRes=!1,t.isShow=!0,t}(),HoleApp=function(){this._appController=new HoleAppController,"666"==ConfigUtility.testNum&&DebugView.Instance};initSSSGameConfig(()=>{new HoleApp})}).call(this,__webpack_require__(1))}])});